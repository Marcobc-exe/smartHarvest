var DE=Object.defineProperty;var NE=(n,e,t)=>e in n?DE(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var x=(n,e,t)=>NE(n,typeof e!="symbol"?e+"":e,t);import{g as Z2,r as Gt}from"./index-xctSeu8s.js";async function aa(n,e,t,i){return i._parse(n,e,t,i)}function Rt(n,e){if(!n)throw new Error(e||"loader assertion failed.")}const Xc=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),Q0=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Q0&&parseFloat(Q0[1]);const Oa=globalThis,or=globalThis.process||{},FE=globalThis.navigator||{};function e1(n){var i,s;if(typeof window<"u"&&((i=window.process)==null?void 0:i.type)==="renderer"||typeof process<"u"&&((s=process.versions)!=null&&s.electron))return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function Xs(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||e1()}function LE(n){return Xs()?e1()?"Electron":(FE.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const t1="4.1.0";function kE(n){try{const e=window[n],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class UE{constructor(e,t,i="sessionStorage"){this.storage=kE(i),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function VE(n){let e;return n<10?e=`${n.toFixed(2)}ms`:n<100?e=`${n.toFixed(1)}ms`:n<1e3?e=`${n.toFixed(0)}ms`:e=`${(n/1e3).toFixed(2)}s`,e}function zE(n,e=8){const t=Math.max(e-n.length,0);return`${" ".repeat(t)}${n}`}var Ul;(function(n){n[n.BLACK=30]="BLACK",n[n.RED=31]="RED",n[n.GREEN=32]="GREEN",n[n.YELLOW=33]="YELLOW",n[n.BLUE=34]="BLUE",n[n.MAGENTA=35]="MAGENTA",n[n.CYAN=36]="CYAN",n[n.WHITE=37]="WHITE",n[n.BRIGHT_BLACK=90]="BRIGHT_BLACK",n[n.BRIGHT_RED=91]="BRIGHT_RED",n[n.BRIGHT_GREEN=92]="BRIGHT_GREEN",n[n.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",n[n.BRIGHT_BLUE=94]="BRIGHT_BLUE",n[n.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",n[n.BRIGHT_CYAN=96]="BRIGHT_CYAN",n[n.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Ul||(Ul={}));const HE=10;function Y0(n){return typeof n!="string"?n:(n=n.toUpperCase(),Ul[n]||Ul.WHITE)}function GE(n,e,t){return!Xs&&typeof n=="string"&&(e&&(n=`\x1B[${Y0(e)}m${n}\x1B[39m`),t&&(n=`\x1B[${Y0(t)+HE}m${n}\x1B[49m`)),n}function WE(n,e=["constructor"]){const t=Object.getPrototypeOf(n),i=Object.getOwnPropertyNames(t),s=n;for(const r of i){const o=s[r];typeof o=="function"&&(e.find(a=>r===a)||(s[r]=o.bind(n)))}}function vf(n,e){if(!n)throw new Error("Assertion failed")}function ar(){var e,t,i;let n;if(Xs()&&Oa.performance)n=(t=(e=Oa==null?void 0:Oa.performance)==null?void 0:e.now)==null?void 0:t.call(e);else if("hrtime"in or){const s=(i=or==null?void 0:or.hrtime)==null?void 0:i.call(or);n=s[0]*1e3+s[1]/1e6}else n=Date.now();return n}const lr={debug:Xs()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},jE={enabled:!0,level:0};function cr(){}const K0={},q0={once:!0};class io{constructor({id:e}={id:""}){this.VERSION=t1,this._startTs=ar(),this._deltaTs=ar(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new UE(`__probe-${this.id}__`,jE),this.timeStamp(`${this.id} started`),WE(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((ar()-this._startTs).toPrecision(10))}getDelta(){return Number((ar()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,lr.warn,arguments,q0)}error(e){return this._getLogFunction(0,e,lr.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,lr.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,lr.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,lr.debug||lr.info,arguments,q0)}table(e,t,i){return t?this._getLogFunction(e,t,console.table||cr,i&&[i],{tag:XE(t)}):cr}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||cr)}group(e,t,i={collapsed:!1}){const s=J0({logLevel:e,message:t,opts:i}),{collapsed:r}=i;return s.method=(r?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}groupCollapsed(e,t,i={}){return this.group(e,t,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||cr)}withGroup(e,t,i){this.group(e,t)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=n1(e)}_getLogFunction(e,t,i,s,r){if(this._shouldLog(e)){r=J0({logLevel:e,message:t,args:s,opts:r}),i=i||r.method,vf(i),r.total=this.getTotal(),r.delta=this.getDelta(),this._deltaTs=ar();const o=r.tag||r.message;if(r.once&&o)if(!K0[o])K0[o]=ar();else return cr;return t=$E(this.id,r.message,r),i.bind(console,t,...r.args)}return cr}}io.VERSION=t1;function n1(n){if(!n)return 0;let e;switch(typeof n){case"number":e=n;break;case"object":e=n.logLevel||n.priority||0;break;default:return 0}return vf(Number.isFinite(e)&&e>=0),e}function J0(n){const{logLevel:e,message:t}=n;n.logLevel=n1(e);const i=n.args?Array.from(n.args):[];for(;i.length&&i.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&i.unshift(t),n.message=e;break;case"object":Object.assign(n,e);break}typeof n.message=="function"&&(n.message=n.message());const s=typeof n.message;return vf(s==="string"||s==="object"),Object.assign(n,{args:i},n.opts)}function $E(n,e,t){if(typeof e=="string"){const i=t.time?zE(VE(t.total)):"";e=t.time?`${n}: ${i}  ${e}`:`${n}: ${e}`,e=GE(e,t.color,t.background)}return e}function XE(n){for(const e in n)for(const t in n[e])return t||"untitled";return"empty"}globalThis.probe={};const i1=new io({id:"@probe.gl/log"}),WA="4.3.2",QE=WA[0]>="0"&&WA[0]<="9"?`v${WA}`:"";function YE(){const n=new io({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=n,globalThis.loaders.version=QE,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=n,n}const KE=YE();function qE(n,e){return s1(n||{},e)}function s1(n,e,t=0){if(t>3)return e;const i={...n};for(const[s,r]of Object.entries(e))r&&typeof r=="object"&&!Array.isArray(r)?i[s]=s1(i[s]||{},e[s],t+1):i[s]=e[s];return i}function JE(n){var e;globalThis.loaders||(globalThis.loaders={}),(e=globalThis.loaders).modules||(e.modules={}),Object.assign(globalThis.loaders.modules,n)}function ZE(n){var t,i;return((i=(t=globalThis.loaders)==null?void 0:t.modules)==null?void 0:i[n])||null}const ex="latest";function tx(){var n;return(n=globalThis._loadersgl_)!=null&&n.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.2"),globalThis._loadersgl_.version}const r1=tx();function Fi(n,e){if(!n)throw new Error(e||"loaders.gl assertion failed.")}const Xn=typeof process!="object"||String(process)!=="[object process]"||process.browser,Tf=typeof importScripts=="function",nx=typeof window<"u"&&typeof window.orientation<"u",Z0=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Z0&&parseFloat(Z0[1]);class ix{constructor(e,t){x(this,"name");x(this,"workerThread");x(this,"isRunning",!0);x(this,"result");x(this,"_resolve",()=>{});x(this,"_reject",()=>{});this.name=e,this.workerThread=t,this.result=new Promise((i,s)=>{this._resolve=i,this._reject=s})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){Fi(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Fi(this.isRunning),this.isRunning=!1,this._reject(e)}}class jA{terminate(){}}const $A=new Map;function sx(n){Fi(n.source&&!n.url||!n.source&&n.url);let e=$A.get(n.source||n.url);return e||(n.url&&(e=rx(n.url),$A.set(n.url,e)),n.source&&(e=o1(n.source),$A.set(n.source,e))),Fi(e),e}function rx(n){if(!n.startsWith("http"))return n;const e=ox(n);return o1(e)}function o1(n){const e=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(e)}function ox(n){return`try {
  importScripts('${n}');
} catch (error) {
  console.error(error);
  throw error;
}`}function a1(n,e=!0,t){const i=t||new Set;if(n){if(eg(n))i.add(n);else if(eg(n.buffer))i.add(n.buffer);else if(!ArrayBuffer.isView(n)){if(e&&typeof n=="object")for(const s in n)a1(n[s],e,i)}}return t===void 0?Array.from(i):[]}function eg(n){return n?n instanceof ArrayBuffer||typeof MessagePort<"u"&&n instanceof MessagePort||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas:!1}const XA=()=>{};class Ah{constructor(e){x(this,"name");x(this,"source");x(this,"url");x(this,"terminated",!1);x(this,"worker");x(this,"onMessage");x(this,"onError");x(this,"_loadableURL","");const{name:t,source:i,url:s}=e;Fi(i||s),this.name=t,this.source=i,this.url=s,this.onMessage=XA,this.onError=r=>console.log(r),this.worker=Xn?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&Xn||typeof jA<"u"&&!Xn}destroy(){this.onMessage=XA,this.onError=XA,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||a1(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=sx({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new jA(i,{eval:!1})}else if(this.source)e=new jA(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}}class ax{constructor(e){x(this,"name","unnamed");x(this,"source");x(this,"url");x(this,"maxConcurrency",1);x(this,"maxMobileConcurrency",1);x(this,"onDebug",()=>{});x(this,"reuseWorkers",!0);x(this,"props",{});x(this,"jobQueue",[]);x(this,"idleQueue",[]);x(this,"count",0);x(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return Ah.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,t=(s,r,o)=>s.done(o),i=(s,r)=>s.error(r)){const s=new Promise(r=>(this.jobQueue.push({name:e,onMessage:t,onError:i,onStart:r}),this));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const i=new ix(t.name,e);e.onMessage=s=>t.onMessage(i,s.type,s.payload),e.onError=s=>t.onError(i,s),t.onStart(i);try{await i.result}catch(s){console.error(`Worker exception: ${s}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Xn||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new Ah({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return nx?this.maxMobileConcurrency:this.maxConcurrency}}const lx={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},es=class es{constructor(e){x(this,"props");x(this,"workerPools",new Map);this.props={...lx},this.setProps(e),this.workerPools=new Map}static isSupported(){return Ah.isSupported()}static getWorkerFarm(e={}){return es._workerFarm=es._workerFarm||new es({}),es._workerFarm.setProps(e),es._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:i,url:s}=e;let r=this.workerPools.get(t);return r||(r=new ax({name:t,source:i,url:s}),r.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,r)),r}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};x(es,"_workerFarm");let Vl=es;function cx(n,e={}){const t=e[n.id]||{},i=Xn?`${n.id}-worker.js`:`${n.id}-worker-node.js`;let s=t.workerUrl;if(!s&&n.id==="compression"&&(s=e.workerUrl),e._workerType==="test"&&(Xn?s=`modules/${n.module}/dist/${i}`:s=`modules/${n.module}/src/workers/${n.id}-worker-node.ts`),!s){let r=n.version;r==="latest"&&(r=ex);const o=r?`@${r}`:"";s=`https://unpkg.com/@loaders.gl/${n.module}${o}/dist/${i}`}return Fi(s),s}function Ax(n,e=r1){Fi(n,"no worker provided");const t=n.version;return!(!e||!t)}const QA={};async function Fs(n,e=null,t={},i=null){return e&&(n=ux(n,e,t,i)),QA[n]=QA[n]||hx(n),await QA[n]}function ux(n,e,t={},i=null){if(!t.useLocalLibraries&&n.startsWith("http"))return n;i=i||n;const s=t.modules||{};return s[i]?s[i]:Xn?t.CDN?(Fi(t.CDN.startsWith("http")),`${t.CDN}/${e}@${r1}/dist/libs/${i}`):Tf?`../src/libs/${i}`:`modules/${e}/src/libs/${i}`:`modules/${e}/dist/libs/${i}`}async function hx(n){if(n.endsWith("wasm"))return await dx(n);if(!Xn)try{const{requireFromFile:t}=globalThis.loaders||{};return await(t==null?void 0:t(n))}catch(t){return console.error(t),null}if(Tf)return importScripts(n);const e=await gx(n);return fx(e,n)}function fx(n,e){if(!Xn){const{requireFromString:i}=globalThis.loaders||{};return i==null?void 0:i(n,e)}if(Tf)return eval.call(globalThis,n),null;const t=document.createElement("script");t.id=e;try{t.appendChild(document.createTextNode(n))}catch{t.text=n}return document.body.appendChild(t),null}async function dx(n){const{readFileAsArrayBuffer:e}=globalThis.loaders||{};return Xn||!e||n.startsWith("http")?await(await fetch(n)).arrayBuffer():await e(n)}async function gx(n){const{readFileAsText:e}=globalThis.loaders||{};return Xn||!e||n.startsWith("http")?await(await fetch(n)).text():await e(n)}function px(n,e){return!Vl.isSupported()||!Xn&&!(e!=null&&e._nodeWorkers)?!1:n.worker&&(e==null?void 0:e.worker)}async function mx(n,e,t,i,s){const r=n.id,o=cx(n,t),l=Vl.getWorkerFarm(t).getWorkerPool({name:r,url:o});t=JSON.parse(JSON.stringify(t)),i=JSON.parse(JSON.stringify(i||{}));const f=await l.startJob("process-on-worker",_x.bind(null,s));return f.postMessage("process",{input:e,options:t,context:i}),await(await f.result).result}async function _x(n,e,t,i){switch(t){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:s,input:r,options:o}=i;try{const a=await n(r,o);e.postMessage("done",{id:s,result:a})}catch(a){const l=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:s,error:l})}break;default:console.warn(`parse-with-worker unknown message ${t}`)}}function yx(n,e=5){return typeof n=="string"?n.slice(0,e):ArrayBuffer.isView(n)?tg(n.buffer,n.byteOffset,e):n instanceof ArrayBuffer?tg(n,0,e):""}function tg(n,e,t){if(n.byteLength<=e+t)return"";const i=new DataView(n);let s="";for(let r=0;r<t;r++)s+=String.fromCharCode(i.getUint8(e+r));return s}function bx(n){try{return JSON.parse(n)}catch{throw new Error(`Failed to parse JSON from data starting with "${yx(n)}"`)}}function vx(n,e,t){if(t=t||n.byteLength,n.byteLength<t||e.byteLength<t)return!1;const i=new Uint8Array(n),s=new Uint8Array(e);for(let r=0;r<i.length;++r)if(i[r]!==s[r])return!1;return!0}function Tx(...n){return wx(n)}function wx(n){const e=n.map(r=>r instanceof ArrayBuffer?new Uint8Array(r):r),t=e.reduce((r,o)=>r+o.byteLength,0),i=new Uint8Array(t);let s=0;for(const r of e)i.set(r,s),s+=r.byteLength;return i.buffer}function wf(n,e,t){const i=t!==void 0?new Uint8Array(n).subarray(e,e+t):new Uint8Array(n).subarray(e);return new Uint8Array(i).buffer}function la(n,e){return Rt(n>=0),Rt(e>0),n+(e-1)&-4}function Ex(n,e,t){let i;if(n instanceof ArrayBuffer)i=new Uint8Array(n);else{const s=n.byteOffset,r=n.byteLength;i=new Uint8Array(n.buffer||n.arrayBuffer,s,r)}return e.set(i,t),t+la(i.byteLength,4)}async function xx(n){const e=[];for await(const t of n)e.push(t);return Tx(...e)}function ng(){let n;if(typeof window<"u"&&window.performance)n=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();n=e[0]*1e3+e[1]/1e6}else n=Date.now();return n}class ig{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=ng(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(ng()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class so{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:i}=e;let s=this.stats[t];return s||(e instanceof ig?s=e:s=new ig(t,i),this.stats[t]=s),s}}const Cx="Queued Requests",Sx="Active Requests",Ix="Cancelled Requests",Rx="Queued Requests Ever",Px="Active Requests Ever",Mx={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class l1{constructor(e={}){x(this,"props");x(this,"stats");x(this,"activeRequestCount",0);x(this,"requestQueue",[]);x(this,"requestMap",new Map);x(this,"updateTimer",null);this.props={...Mx,...e},this.stats=new so({id:this.props.id}),this.stats.get(Cx),this.stats.get(Sx),this.stats.get(Ix),this.stats.get(Rx),this.stats.get(Px)}scheduleRequest(e,t=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const i={handle:e,priority:0,getPriority:t},s=new Promise(r=>(i.resolve=r,i));return this.requestQueue.push(i),this.requestMap.set(e,s),this._issueNewRequests(),s}_issueRequest(e){const{handle:t,resolve:i}=e;let s=!1;const r=()=>{s||(s=!0,this.requestMap.delete(t),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,i?i({done:r}):Promise.resolve({done:r})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let t=0;t<e;++t){const i=this.requestQueue.shift();i&&this._issueRequest(i)}}}_updateAllRequests(){const e=this.requestQueue;for(let t=0;t<e.length;++t){const i=e[t];this._updateRequest(i)||(e.splice(t,1),this.requestMap.delete(i.handle),t--)}e.sort((t,i)=>t.priority-i.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}let Bx="";const sg={};function Ox(n){for(const e in sg)if(n.startsWith(e)){const t=sg[e];n=n.replace(e,t)}return!n.startsWith("http://")&&!n.startsWith("https://")&&(n=`${Bx}${n}`),n}function Dx(n){return n&&typeof n=="object"&&n.isBuffer}function c1(n){if(Dx(n))return n;if(n instanceof ArrayBuffer)return n;if(ArrayBuffer.isView(n))return n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength);if(typeof n=="string"){const e=n;return new TextEncoder().encode(e).buffer}if(n&&typeof n=="object"&&n._toArrayBuffer)return n._toArrayBuffer();throw new Error("toArrayBuffer")}function Nx(){var e;if(typeof process<"u"&&typeof process.cwd<"u")return process.cwd();const n=(e=window.location)==null?void 0:e.pathname;return(n==null?void 0:n.slice(0,n.lastIndexOf("/")+1))||""}function A1(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(e+1):""}function Ef(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(0,e):""}function Fx(...n){const e=[];for(let r=0;r<n.length;r++)e[r]=n[r];let t="",i=!1,s;for(let r=e.length-1;r>=-1&&!i;r--){let o;r>=0?o=e[r]:(s===void 0&&(s=Nx()),o=s),o.length!==0&&(t=`${o}/${t}`,i=o.charCodeAt(0)===Bo)}return t=Lx(t,!i),i?`/${t}`:t.length>0?t:"."}const Bo=47,YA=46;function Lx(n,e){let t="",i=-1,s=0,r,o=!1;for(let a=0;a<=n.length;++a){if(a<n.length)r=n.charCodeAt(a);else{if(r===Bo)break;r=Bo}if(r===Bo){if(!(i===a-1||s===1))if(i!==a-1&&s===2){if(t.length<2||!o||t.charCodeAt(t.length-1)!==YA||t.charCodeAt(t.length-2)!==YA){if(t.length>2){const l=t.length-1;let f=l;for(;f>=0&&t.charCodeAt(f)!==Bo;--f);if(f!==l){t=f===-1?"":t.slice(0,f),i=a,s=0,o=!1;continue}}else if(t.length===2||t.length===1){t="",i=a,s=0,o=!1;continue}}e&&(t.length>0?t+="/..":t="..",o=!0)}else{const l=n.slice(i+1,a);t.length>0?t+=`/${l}`:t=l,o=!1}i=a,s=0}else r===YA&&s!==-1?++s:s=-1}return t}const kx=n=>typeof n=="boolean",zo=n=>typeof n=="function",ca=n=>n!==null&&typeof n=="object",rg=n=>ca(n)&&n.constructor==={}.constructor,Ux=n=>!!n&&typeof n[Symbol.iterator]=="function",Vx=n=>n&&typeof n[Symbol.asyncIterator]=="function",Qs=n=>typeof Response<"u"&&n instanceof Response||n&&n.arrayBuffer&&n.text&&n.json,Ys=n=>typeof Blob<"u"&&n instanceof Blob,zx=n=>n&&typeof n=="object"&&n.isBuffer,Hx=n=>typeof ReadableStream<"u"&&n instanceof ReadableStream||ca(n)&&zo(n.tee)&&zo(n.cancel)&&zo(n.getReader),Gx=n=>ca(n)&&zo(n.read)&&zo(n.pipe)&&kx(n.readable),u1=n=>Hx(n)||Gx(n);class Wx extends Error{constructor(t,i){super(t);x(this,"reason");x(this,"url");x(this,"response");this.reason=i.reason,this.url=i.url,this.response=i.response}}const jx=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,$x=/^([-\w.]+\/[-\w.+]+)/;function og(n,e){return n.toLowerCase()===e.toLowerCase()}function Xx(n){const e=$x.exec(n);return e?e[1]:n}function ag(n){const e=jx.exec(n);return e?e[1]:""}const h1=/\?.*/;function Qx(n){const e=n.match(h1);return e&&e[0]}function xf(n){return n.replace(h1,"")}function Yx(n){if(n.length<50)return n;const e=n.slice(n.length-15);return`${n.substr(0,32)}...${e}`}function Qc(n){return Qs(n)?n.url:Ys(n)?n.name||"":typeof n=="string"?n:""}function Cf(n){if(Qs(n)){const e=n,t=e.headers.get("content-type")||"",i=xf(e.url);return Xx(t)||ag(i)}return Ys(n)?n.type||"":typeof n=="string"?ag(n):""}function Kx(n){return Qs(n)?n.headers["content-length"]||-1:Ys(n)?n.size:typeof n=="string"?n.length:n instanceof ArrayBuffer||ArrayBuffer.isView(n)?n.byteLength:-1}async function f1(n){if(Qs(n))return n;const e={},t=Kx(n);t>=0&&(e["content-length"]=String(t));const i=Qc(n),s=Cf(n);s&&(e["content-type"]=s);const r=await Zx(n);r&&(e["x-first-bytes"]=r),typeof n=="string"&&(n=new TextEncoder().encode(n));const o=new Response(n,{headers:e});return Object.defineProperty(o,"url",{value:i}),o}async function qx(n){if(!n.ok)throw await Jx(n)}async function Jx(n){const e=Yx(n.url);let t=`Failed to fetch resource (${n.status}) ${n.statusText}: ${e}`;t=t.length>100?`${t.slice(0,100)}...`:t;const i={reason:n.statusText,url:n.url,response:n};try{const s=n.headers.get("Content-Type");i.reason=!n.bodyUsed&&(s!=null&&s.includes("application/json"))?await n.json():await n.text()}catch{}return new Wx(t,i)}async function Zx(n){if(typeof n=="string")return`data:,${n.slice(0,5)}`;if(n instanceof Blob){const t=n.slice(0,5);return await new Promise(i=>{const s=new FileReader;s.onload=r=>{var o;return i((o=r==null?void 0:r.target)==null?void 0:o.result)},s.readAsDataURL(t)})}if(n instanceof ArrayBuffer){const t=n.slice(0,5);return`data:base64,${eC(t)}`}return null}function eC(n){let e="";const t=new Uint8Array(n);for(let i=0;i<t.byteLength;i++)e+=String.fromCharCode(t[i]);return btoa(e)}function tC(n){return!nC(n)&&!iC(n)}function nC(n){return n.startsWith("http:")||n.startsWith("https:")}function iC(n){return n.startsWith("data:")}async function lg(n,e){var t,i;if(typeof n=="string"){const s=Ox(n);return tC(s)&&(t=globalThis.loaders)!=null&&t.fetchNode?(i=globalThis.loaders)==null?void 0:i.fetchNode(s,e):await fetch(s,e)}return await f1(n)}const cg=new io({id:"loaders.gl"});class sC{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class rC{constructor(){x(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const d1={fetch:null,mimeType:void 0,nothrow:!1,log:new rC,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Xc,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},oC={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function g1(){globalThis.loaders=globalThis.loaders||{};const{loaders:n}=globalThis;return n._state||(n._state={}),n._state}function p1(){const n=g1();return n.globalOptions=n.globalOptions||{...d1},n.globalOptions}function aC(n,e,t,i){return t=t||[],t=Array.isArray(t)?t:[t],lC(n,t),AC(e,n,i)}function lC(n,e){Ag(n,null,d1,oC,e);for(const t of e){const i=n&&n[t.id]||{},s=t.options&&t.options[t.id]||{},r=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};Ag(i,t.id,s,r,e)}}function Ag(n,e,t,i,s){const r=e||"Top level",o=e?`${e}.`:"";for(const a in n){const l=!e&&ca(n[a]),f=a==="baseUri"&&!e,g=a==="workerUrl"&&e;if(!(a in t)&&!f&&!g){if(a in i)cg.warn(`${r} loader option '${o}${a}' no longer supported, use '${i[a]}'`)();else if(!l){const _=cC(a,s);cg.warn(`${r} loader option '${o}${a}' not recognized. ${_}`)()}}}}function cC(n,e){const t=n.toLowerCase();let i="";for(const s of e)for(const r in s.options){if(n===r)return`Did you mean '${s.id}.${r}'?`;const o=r.toLowerCase();(t.startsWith(o)||o.startsWith(t))&&(i=i||`Did you mean '${s.id}.${r}'?`)}return i}function AC(n,e,t){const s={...n.options||{}};return uC(s,t),s.log===null&&(s.log=new sC),ug(s,p1()),ug(s,e),s}function ug(n,e){for(const t in e)if(t in e){const i=e[t];rg(i)&&rg(n[t])?n[t]={...n[t],...e[t]}:n[t]=e[t]}}function uC(n,e){e&&!("baseUri"in n)&&(n.baseUri=e)}function Sf(n){return n?(Array.isArray(n)&&(n=n[0]),Array.isArray(n==null?void 0:n.extensions)):!1}function If(n){Rt(n,"null loader"),Rt(Sf(n),"invalid loader");let e;return Array.isArray(n)&&(e=n[1],n=n[0],n={...n,options:{...n.options,...e}}),(n!=null&&n.parseTextSync||n!=null&&n.parseText)&&(n.text=!0),n.text||(n.binary=!0),n}const m1=()=>{const n=g1();return n.loaderRegistry=n.loaderRegistry||[],n.loaderRegistry};function hC(n){const e=m1();n=Array.isArray(n)?n:[n];for(const t of n){const i=If(t);e.find(s=>i===s)||e.unshift(i)}}function fC(){return m1()}const dC=/\.([^.]+)$/;async function gC(n,e=[],t,i){if(!_1(n))return null;let s=hg(n,e,{...t,nothrow:!0},i);if(s)return s;if(Ys(n)&&(n=await n.slice(0,10).arrayBuffer(),s=hg(n,e,t,i)),!s&&!(t!=null&&t.nothrow))throw new Error(y1(n));return s}function hg(n,e=[],t,i){if(!_1(n))return null;if(e&&!Array.isArray(e))return If(e);let s=[];e&&(s=s.concat(e)),t!=null&&t.ignoreRegisteredLoaders||s.push(...fC()),mC(s);const r=pC(n,s,t,i);if(!r&&!(t!=null&&t.nothrow))throw new Error(y1(n));return r}function pC(n,e,t,i){const s=Qc(n),r=Cf(n),o=xf(s)||(i==null?void 0:i.url);let a=null,l="";return t!=null&&t.mimeType&&(a=KA(e,t==null?void 0:t.mimeType),l=`match forced by supplied MIME type ${t==null?void 0:t.mimeType}`),a=a||_C(e,o),l=l||(a?`matched url ${o}`:""),a=a||KA(e,r),l=l||(a?`matched MIME type ${r}`:""),a=a||bC(e,n),l=l||(a?`matched initial data ${b1(n)}`:""),t!=null&&t.fallbackMimeType&&(a=a||KA(e,t==null?void 0:t.fallbackMimeType),l=l||(a?`matched fallback MIME type ${r}`:"")),l&&KE.log(1,`selectLoader selected ${a==null?void 0:a.name}: ${l}.`),a}function _1(n){return!(n instanceof Response&&n.status===204)}function y1(n){const e=Qc(n),t=Cf(n);let i="No valid loader found (";i+=e?`${A1(e)}, `:"no url provided, ",i+=`MIME type: ${t?`"${t}"`:"not provided"}, `;const s=n?b1(n):"";return i+=s?` first bytes: "${s}"`:"first bytes: not available",i+=")",i}function mC(n){for(const e of n)If(e)}function _C(n,e){const t=e&&dC.exec(e),i=t&&t[1];return i?yC(n,i):null}function yC(n,e){e=e.toLowerCase();for(const t of n)for(const i of t.extensions)if(i.toLowerCase()===e)return t;return null}function KA(n,e){var t;for(const i of n)if((t=i.mimeTypes)!=null&&t.some(s=>og(e,s))||og(e,`application/x.${i.id}`))return i;return null}function bC(n,e){if(!e)return null;for(const t of n)if(typeof e=="string"){if(vC(e,t))return t}else if(ArrayBuffer.isView(e)){if(fg(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&fg(e,0,t))return t;return null}function vC(n,e){return e.testText?e.testText(n):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>n.startsWith(i))}function fg(n,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(s=>TC(n,e,t,s))}function TC(n,e,t,i){if(i instanceof ArrayBuffer)return vx(i,n,i.byteLength);switch(typeof i){case"function":return i(n);case"string":const s=uh(n,e,i.length);return i===s;default:return!1}}function b1(n,e=5){return typeof n=="string"?n.slice(0,e):ArrayBuffer.isView(n)?uh(n.buffer,n.byteOffset,e):n instanceof ArrayBuffer?uh(n,0,e):""}function uh(n,e,t){if(n.byteLength<e+t)return"";const i=new DataView(n);let s="";for(let r=0;r<t;r++)s+=String.fromCharCode(i.getUint8(e+r));return s}const wC=256*1024;function*EC(n,e){const t=(e==null?void 0:e.chunkSize)||wC;let i=0;const s=new TextEncoder;for(;i<n.length;){const r=Math.min(n.length-i,t),o=n.slice(i,i+r);i+=r,yield s.encode(o)}}const xC=256*1024;function*CC(n,e={}){const{chunkSize:t=xC}=e;let i=0;for(;i<n.byteLength;){const s=Math.min(n.byteLength-i,t),r=new ArrayBuffer(s),o=new Uint8Array(n,i,s);new Uint8Array(r).set(o),i+=s,yield r}}const SC=1024*1024;async function*IC(n,e){const t=(e==null?void 0:e.chunkSize)||SC;let i=0;for(;i<n.size;){const s=i+t,r=await n.slice(i,s).arrayBuffer();i=s,yield r}}function dg(n,e){return Xc?RC(n,e):PC(n)}async function*RC(n,e){const t=n.getReader();let i;try{for(;;){const s=i||t.read();e!=null&&e._streamReadAhead&&(i=t.read());const{done:r,value:o}=await s;if(r)return;yield c1(o)}}catch{t.releaseLock()}}async function*PC(n,e){for await(const t of n)yield c1(t)}function MC(n,e){if(typeof n=="string")return EC(n,e);if(n instanceof ArrayBuffer)return CC(n,e);if(Ys(n))return IC(n,e);if(u1(n))return dg(n,e);if(Qs(n))return dg(n.body,e);throw new Error("makeIterator")}const v1="Cannot convert supplied data type";function BC(n,e,t){if(e.text&&typeof n=="string")return n;if(zx(n)&&(n=n.buffer),n instanceof ArrayBuffer){const i=n;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(n)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(n);let i=n.buffer;const s=n.byteLength||n.length;return(n.byteOffset!==0||s!==i.byteLength)&&(i=i.slice(n.byteOffset,n.byteOffset+s)),i}throw new Error(v1)}async function OC(n,e,t){const i=n instanceof ArrayBuffer||ArrayBuffer.isView(n);if(typeof n=="string"||i)return BC(n,e);if(Ys(n)&&(n=await f1(n)),Qs(n)){const s=n;return await qx(s),e.binary?await s.arrayBuffer():await s.text()}if(u1(n)&&(n=MC(n,t)),Ux(n)||Vx(n))return xx(n);throw new Error(v1)}function T1(n,e){const t=p1(),i=n||t;return typeof i.fetch=="function"?i.fetch:ca(i.fetch)?s=>lg(s,i.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:lg}function DC(n,e,t){if(t)return t;const i={fetch:T1(e,n),...n};if(i.url){const s=xf(i.url);i.baseUrl=s,i.queryString=Qx(i.url),i.filename=A1(s),i.baseUrl=Ef(s)}return Array.isArray(i.loaders)||(i.loaders=null),i}function NC(n,e){if(n&&!Array.isArray(n))return n;let t;if(n&&(t=Array.isArray(n)?n:[n]),e&&e.loaders){const i=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...i]:i}return t&&t.length?t:void 0}async function zl(n,e,t,i){e&&!Array.isArray(e)&&!Sf(e)&&(i=void 0,t=e,e=void 0),n=await n,t=t||{};const s=Qc(n),o=NC(e,i),a=await gC(n,o,t);return a?(t=aC(t,a,o,s),i=DC({url:s,_parse:zl,loaders:o},t,i||null),await FC(a,n,t,i)):null}async function FC(n,e,t,i){if(Ax(n),t=qE(n.options,t),Qs(e)){const r=e,{ok:o,redirected:a,status:l,statusText:f,type:g,url:_}=r,v=Object.fromEntries(r.headers.entries());i.response={headers:v,ok:o,redirected:a,status:l,statusText:f,type:g,url:_}}e=await OC(e,n,t);const s=n;if(s.parseTextSync&&typeof e=="string")return s.parseTextSync(e,t,i);if(px(n,t))return await mx(n,e,t,i,zl);if(s.parseText&&typeof e=="string")return await s.parseText(e,t,i);if(s.parse)return await s.parse(e,t,i);throw Fi(!s.parseSync),new Error(`${n.id} loader - no parser found and worker is disabled`)}function LC(n){switch(n.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function w1(n){let e=1/0,t=1/0,i=1/0,s=-1/0,r=-1/0,o=-1/0;const a=n.POSITION?n.POSITION.value:[],l=a&&a.length;for(let f=0;f<l;f+=3){const g=a[f],_=a[f+1],v=a[f+2];e=g<e?g:e,t=_<t?_:t,i=v<i?v:i,s=g>s?g:s,r=_>r?_:r,o=v>o?v:o}return[[e,t,i],[s,r,o]]}function kC(n,e,t){const i=LC(e.value),s=t||UC(e);return{name:n,type:{type:"fixed-size-list",listSize:e.size,children:[{name:"value",type:i}]},nullable:!1,metadata:s}}function UC(n){const e={};return"byteOffset"in n&&(e.byteOffset=n.byteOffset.toString(10)),"byteStride"in n&&(e.byteStride=n.byteStride.toString(10)),"normalized"in n&&(e.normalized=n.normalized.toString()),e}async function Li(n,e,t,i){let s,r;!Array.isArray(e)&&!Sf(e)?(s=[],r=e):(s=e,r=t);const o=T1(r);let a=n;return typeof n=="string"&&(a=await o(n)),Ys(n)&&(a=await o(n)),Array.isArray(s)?await zl(a,s,r):await zl(a,s,r)}const VC="4.3.2";var J2;const zC=(J2=globalThis.loaders)==null?void 0:J2.parseImageNode,hh=typeof Image<"u",fh=typeof ImageBitmap<"u",HC=!!zC,dh=Xc?!0:HC;function GC(n){switch(n){case"auto":return fh||hh||dh;case"imagebitmap":return fh;case"image":return hh;case"data":return dh;default:throw new Error(`@loaders.gl/images: image ${n} not supported in this environment`)}}function WC(){if(fh)return"imagebitmap";if(hh)return"image";if(dh)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function jC(n){const e=$C(n);if(!e)throw new Error("Not an image");return e}function E1(n){switch(jC(n)){case"data":return n;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=n.width,e.height=n.height,t.drawImage(n,0,0),t.getImageData(0,0,n.width,n.height);default:throw new Error("getImageData")}}function $C(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&n instanceof Image?"image":n&&typeof n=="object"&&n.data&&n.width&&n.height?"data":null}const XC=/^data:image\/svg\+xml/,QC=/\.svg((\?|#).*)?$/;function Rf(n){return n&&(XC.test(n)||QC.test(n))}function YC(n,e){if(Rf(e)){let i=new TextDecoder().decode(n);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(r){throw new Error(r.message)}return`data:image/svg+xml;base64,${btoa(i)}`}return x1(n,e)}function x1(n,e){if(Rf(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(n)])}async function C1(n,e,t){const i=YC(n,t),s=self.URL||self.webkitURL,r=typeof i!="string"&&s.createObjectURL(i);try{return await KC(r||i,e)}finally{r&&s.revokeObjectURL(r)}}async function KC(n,e){const t=new Image;return t.src=n,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((i,s)=>{try{t.onload=()=>i(t),t.onerror=r=>{const o=r instanceof Error?r.message:"error";s(new Error(o))}}catch(r){s(r)}})}const qC={};let gg=!0;async function JC(n,e,t){let i;Rf(t)?i=await C1(n,e,t):i=x1(n,t);const s=e&&e.imagebitmap;return await ZC(i,s)}async function ZC(n,e=null){if((eS(e)||!gg)&&(e=null),e)try{return await createImageBitmap(n,e)}catch(t){console.warn(t),gg=!1}return await createImageBitmap(n)}function eS(n){for(const e in n||qC)return!1;return!0}function tS(n){return!rS(n,"ftyp",4)||(n[8]&96)===0?null:nS(n)}function nS(n){switch(iS(n,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function iS(n,e,t){return String.fromCharCode(...n.slice(e,t))}function sS(n){return[...n].map(e=>e.charCodeAt(0))}function rS(n,e,t=0){const i=sS(e);for(let s=0;s<i.length;++s)if(i[s]!==n[s+t])return!1;return!0}const Ti=!1,Ho=!0;function Pf(n){const e=Aa(n);return aS(e)||AS(e)||lS(e)||cS(e)||oS(e)}function oS(n){const e=new Uint8Array(n instanceof DataView?n.buffer:n),t=tS(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function aS(n){const e=Aa(n);return e.byteLength>=24&&e.getUint32(0,Ti)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Ti),height:e.getUint32(20,Ti)}:null}function lS(n){const e=Aa(n);return e.byteLength>=10&&e.getUint32(0,Ti)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Ho),height:e.getUint16(8,Ho)}:null}function cS(n){const e=Aa(n);return e.byteLength>=14&&e.getUint16(0,Ti)===16973&&e.getUint32(2,Ho)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Ho),height:e.getUint32(22,Ho)}:null}function AS(n){const e=Aa(n);if(!(e.byteLength>=3&&e.getUint16(0,Ti)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:s}=uS();let r=2;for(;r+9<e.byteLength;){const o=e.getUint16(r,Ti);if(s.has(o))return{mimeType:"image/jpeg",height:e.getUint16(r+5,Ti),width:e.getUint16(r+7,Ti)};if(!i.has(o))return null;r+=2,r+=e.getUint16(r,Ti)}return null}function uS(){const n=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)n.add(t);return{tableMarkers:n,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Aa(n){if(n instanceof DataView)return n;if(ArrayBuffer.isView(n))return new DataView(n.buffer);if(n instanceof ArrayBuffer)return new DataView(n);throw new Error("toDataView")}async function hS(n,e){var s;const{mimeType:t}=Pf(n)||{},i=(s=globalThis.loaders)==null?void 0:s.parseImageNode;return Rt(i),await i(n,t)}async function fS(n,e,t){e=e||{};const s=(e.image||{}).type||"auto",{url:r}=t||{},o=dS(s);let a;switch(o){case"imagebitmap":a=await JC(n,e,r);break;case"image":a=await C1(n,e,r);break;case"data":a=await hS(n);break;default:Rt(!1)}return s==="data"&&(a=E1(a)),a}function dS(n){switch(n){case"auto":case"data":return WC();default:return GC(n),n}}const gS=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],pS=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],mS={image:{type:"auto",decode:!0}},S1={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:VC,mimeTypes:pS,extensions:gS,parse:fS,tests:[n=>!!Pf(new DataView(n))],options:mS},qA={};function _S(n){if(qA[n]===void 0){const e=Xc?bS(n):yS(n);qA[n]=e}return qA[n]}function yS(n){var s,r;const e=["image/png","image/jpeg","image/gif"],t=((s=globalThis.loaders)==null?void 0:s.imageFormatsNode)||e;return!!((r=globalThis.loaders)==null?void 0:r.parseImageNode)&&t.includes(n)}function bS(n){switch(n){case"image/avif":case"image/webp":return vS(n);default:return!0}}function vS(n){try{return document.createElement("canvas").toDataURL(n).indexOf(`data:${n}`)===0}catch{return!1}}const ze=new io({id:"deck"});let gh={};function TS(n){gh=n}function yn(n,e,t,i){ze.level>0&&gh[n]&&gh[n].call(null,e,t,i)}function wS(n){const e=n[0],t=n[n.length-1];return e==="{"&&t==="}"||e==="["&&t==="]"}const ES={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:wS,parseTextSync:JSON.parse};function xS(){const n="9.1.4",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==n)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${n}`);return e||(ze.log(1,`deck.gl ${n}`)(),globalThis.deck={...globalThis.deck,VERSION:n,version:n,log:ze,_registerLoggers:TS},hC([ES,[S1,{imagebitmap:{premultiplyAlpha:"none"}}]])),n}const CS=xS();function Mf(n,e){if(!n)throw new Error(e||"shadertools: assertion failed.")}const JA={number:{type:"number",validate(n,e){return Number.isFinite(n)&&typeof e=="object"&&(e.max===void 0||n<=e.max)&&(e.min===void 0||n>=e.min)}},array:{type:"array",validate(n,e){return Array.isArray(n)||ArrayBuffer.isView(n)}}};function SS(n){const e={};for(const[t,i]of Object.entries(n))e[t]=IS(i);return e}function IS(n){let e=pg(n);if(e!=="object")return{value:n,...JA[e],type:e};if(typeof n=="object")return n?n.type!==void 0?{...n,...JA[n.type],type:n.type}:n.value===void 0?{type:"object",value:n}:(e=pg(n.value),{...n,...JA[e],type:e}):{type:"object",value:null};throw new Error("props")}function pg(n){return Array.isArray(n)||ArrayBuffer.isView(n)?"array":typeof n}const RS=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,PS=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,MS={vertex:RS,fragment:PS},mg=/void\s+main\s*\([^)]*\)\s*\{\n?/,_g=/}\n?[^{}]*$/,ZA=[],yl="__LUMA_INJECT_DECLARATIONS__";function BS(n){const e={vertex:{},fragment:{}};for(const t in n){let i=n[t];const s=OS(t);typeof i=="string"&&(i={order:0,injection:i}),e[s][t]=i}return e}function OS(n){const e=n.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function Hl(n,e,t,i=!1){const s=e==="vertex";for(const r in t){const o=t[r];o.sort((l,f)=>l.order-f.order),ZA.length=o.length;for(let l=0,f=o.length;l<f;++l)ZA[l]=o[l].injection;const a=`${ZA.join(`
`)}
`;switch(r){case"vs:#decl":s&&(n=n.replace(yl,a));break;case"vs:#main-start":s&&(n=n.replace(mg,l=>l+a));break;case"vs:#main-end":s&&(n=n.replace(_g,l=>a+l));break;case"fs:#decl":s||(n=n.replace(yl,a));break;case"fs:#main-start":s||(n=n.replace(mg,l=>l+a));break;case"fs:#main-end":s||(n=n.replace(_g,l=>a+l));break;default:n=n.replace(r,l=>l+a)}}return n=n.replace(yl,""),i&&(n=n.replace(/\}\s*$/,r=>r+MS[e])),n}function Gl(n){n.map(e=>I1(e))}function I1(n){if(n.instance)return;Gl(n.dependencies||[]);const{propTypes:e={},deprecations:t=[],inject:i={}}=n,s={normalizedInjections:BS(i),parsedDeprecations:DS(t)};e&&(s.propValidators=SS(e)),n.instance=s;let r={};e&&(r=Object.entries(e).reduce((o,[a,l])=>{const f=l==null?void 0:l.value;return f&&(o[a]=f),o},{})),n.defaultUniforms={...n.defaultUniforms,...r}}function R1(n,e,t){var i;(i=n.deprecations)==null||i.forEach(s=>{var r;(r=s.regex)!=null&&r.test(e)&&(s.deprecated?t.deprecated(s.old,s.new)():t.removed(s.old,s.new)())})}function DS(n){return n.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),n}function Bf(n){Gl(n);const e={},t={};P1({modules:n,level:0,moduleMap:e,moduleDepth:t});const i=Object.keys(t).sort((s,r)=>t[r]-t[s]).map(s=>e[s]);return Gl(i),i}function P1(n){const{modules:e,level:t,moduleMap:i,moduleDepth:s}=n;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const r of e)i[r.name]=r,(s[r.name]===void 0||s[r.name]<t)&&(s[r.name]=t);for(const r of e)r.dependencies&&P1({modules:r.dependencies,level:t+1,moduleMap:i,moduleDepth:s})}function NS(n){switch(n==null?void 0:n.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function FS(n,e){var i;if(Number(((i=n.match(/^#version[ \t]+(\d+)/m))==null?void 0:i[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return n=yg(n,LS),n;case"fragment":return n=yg(n,kS),n;default:throw new Error(e)}}const M1=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],LS=[...M1,[ph("attribute"),"in $1"],[ph("varying"),"out $1"]],kS=[...M1,[ph("varying"),"in $1"]];function yg(n,e){for(const[t,i]of e)n=n.replace(t,i);return n}function ph(n){return new RegExp(`\\b${n}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function B1(n,e){let t="";for(const i in n){const s=n[i];if(t+=`void ${s.signature} {
`,s.header&&(t+=`  ${s.header}`),e[i]){const r=e[i];r.sort((o,a)=>o.order-a.order);for(const o of r)t+=`  ${o.injection}
`}s.footer&&(t+=`  ${s.footer}`),t+=`}
`}return t}function O1(n){const e={vertex:{},fragment:{}};for(const t of n){let i,s;typeof t!="string"?(i=t,s=i.hook):(i={},s=t),s=s.trim();const[r,o]=s.split(":"),a=s.replace(/\(.+/,""),l=Object.assign(i,{signature:o});switch(r){case"vs":e.vertex[a]=l;break;case"fs":e.fragment[a]=l;break;default:throw new Error(r)}}return e}function US(n,e){return{name:VS(n,e),language:"glsl",version:zS(n)}}function VS(n,e="unnamed"){const i=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(n);return i?i[1]:e}function zS(n){let e=100;const t=n.match(/[^\s]+/g);if(t&&t.length>=2&&t[0]==="#version"){const i=parseInt(t[1],10);Number.isFinite(i)&&(e=i)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const D1=`

${yl}
`,HS=`precision highp float;
`;function GS(n){const e=Bf(n.modules||[]);return{source:jS(n.platformInfo,{...n,source:n.source,stage:"vertex",modules:e}),getUniforms:N1(e)}}function WS(n){const{vs:e,fs:t}=n,i=Bf(n.modules||[]);return{vs:bg(n.platformInfo,{...n,source:e,stage:"vertex",modules:i}),fs:bg(n.platformInfo,{...n,source:t,stage:"fragment",modules:i}),getUniforms:N1(i)}}function jS(n,e){var S;const{source:t,stage:i,modules:s,hookFunctions:r=[],inject:o={},log:a}=e;Mf(typeof t=="string","shader source must be a string");const l=t;let f="";const g=O1(r),_={},v={},T={};for(const R in o){const P=typeof o[R]=="string"?{injection:o[R],order:0}:o[R],F=/^(v|f)s:(#)?([\w-]+)$/.exec(R);if(F){const U=F[2],X=F[3];U?X==="decl"?v[R]=[P]:T[R]=[P]:_[R]=[P]}else T[R]=[P]}const C=s;for(const R of C){a&&R1(R,l,a);const P=F1(R,"wgsl");f+=P;const F=((S=R.injections)==null?void 0:S[i])||{};for(const U in F){const X=/^(v|f)s:#([\w-]+)$/.exec(U);if(X){const se=X[2]==="decl"?v:T;se[U]=se[U]||[],se[U].push(F[U])}else _[U]=_[U]||[],_[U].push(F[U])}}return f+=D1,f=Hl(f,i,v),f+=B1(g[i],_),f+=l,f=Hl(f,i,T),f}function bg(n,e){var Se;const{id:t,source:i,stage:s,language:r="glsl",modules:o,defines:a={},hookFunctions:l=[],inject:f={},prologue:g=!0,log:_}=e;Mf(typeof i=="string","shader source must be a string");const v=r==="glsl"?US(i).version:-1,T=n.shaderLanguageVersion,C=v===100?"#version 100":"#version 300 es",R=i.split(`
`).slice(1).join(`
`),P={};o.forEach(me=>{Object.assign(P,me.defines)}),Object.assign(P,a);let F="";switch(r){case"wgsl":break;case"glsl":F=g?`${C}

// ----- PROLOGUE -------------------------
${$S({id:t,source:i,stage:s})}
${`#define SHADER_TYPE_${s.toUpperCase()}`}

${NS(n)}
${s==="fragment"?HS:""}

// ----- APPLICATION DEFINES -------------------------

${XS(P)}

`:`${C}
`;break}const U=O1(l),X={},Z={},se={};for(const me in f){const J=typeof f[me]=="string"?{injection:f[me],order:0}:f[me],q=/^(v|f)s:(#)?([\w-]+)$/.exec(me);if(q){const L=q[2],fe=q[3];L?fe==="decl"?Z[me]=[J]:se[me]=[J]:X[me]=[J]}else se[me]=[J]}for(const me of o){_&&R1(me,R,_);const J=F1(me,s);F+=J;const q=((Se=me.instance)==null?void 0:Se.normalizedInjections[s])||{};for(const L in q){const fe=/^(v|f)s:#([\w-]+)$/.exec(L);if(fe){const Me=fe[2]==="decl"?Z:se;Me[L]=Me[L]||[],Me[L].push(q[L])}else X[L]=X[L]||[],X[L].push(q[L])}}return F+="// ----- MAIN SHADER SOURCE -------------------------",F+=D1,F=Hl(F,s,Z),F+=B1(U[s],X),F+=R,F=Hl(F,s,se),r==="glsl"&&v!==T&&(F=FS(F,s)),F.trim()}function N1(n){return function(t){var s;const i={};for(const r of n){const o=(s=r.getUniforms)==null?void 0:s.call(r,t,i);Object.assign(i,o)}return i}}function $S(n){const{id:e,source:t,stage:i}=n;return e&&t.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${i}`:""}function XS(n={}){let e="";for(const t in n){const i=n[t];(i||Number.isFinite(i))&&(e+=`#define ${t.toUpperCase()} ${n[t]}
`)}return e}function F1(n,e){let t;switch(e){case"vertex":t=n.vs||"";break;case"fragment":t=n.fs||"";break;case"wgsl":t=n.source||"";break;default:Mf(!1)}if(!n.name)throw new Error("Shader module must have a name");const i=n.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let s=`// ----- MODULE ${n.name} ---------------

`;return e!=="wgsl"&&(s+=`#define MODULE_${i}
`),s+=`${t}
`,s}const QS=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,YS=/^\s*\#\s*endif\s*$/;function KS(n,e){var o;const t=n.split(`
`),i=[];let s=!0,r=null;for(const a of t){const l=a.match(QS),f=a.match(YS);l?(r=l[1],s=!!((o=e==null?void 0:e.defines)!=null&&o[r])):f?s=!0:s&&i.push(a)}return i.join(`
`)}const Os=class Os{constructor(){x(this,"_hookFunctions",[]);x(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return Os.defaultShaderAssembler=Os.defaultShaderAssembler||new Os,Os.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const t=this._getModuleList(e.modules),i=this._hookFunctions,{source:s,getUniforms:r}=GS({...e,source:e.source,modules:t,hookFunctions:i});return{source:e.platformInfo.shaderLanguage==="wgsl"?KS(s):s,getUniforms:r,modules:t}}assembleGLSLShaderPair(e){const t=this._getModuleList(e.modules),i=this._hookFunctions;return{...WS({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:i}),modules:t}}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),i={};let s=0;for(let r=0,o=this._defaultModules.length;r<o;++r){const a=this._defaultModules[r],l=a.name;t[s++]=a,i[l]=!0}for(let r=0,o=e.length;r<o;++r){const a=e[r],l=a.name;i[l]||(t[s++]=a,i[l]=!0)}return t.length=s,Gl(t),t}};x(Os,"defaultShaderAssembler");let Wl=Os;const qS=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,JS=`#version 300 es
${qS}`;function L1(n){const{input:e,inputChannels:t,output:i}=n||{};if(!e)return JS;if(!t)throw new Error("inputChannels");const s=ZS(t),r=eI(e,t);return`#version 300 es
in ${s} ${e};
out vec4 ${i};
void main() {
  ${i} = ${r};
}`}function ZS(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${n}`)}}function eI(n,e){switch(e){case 1:return`vec4(${n}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${n}, 0.0, 1.0)`;case 3:return`vec4(${n}, 1.0)`;case 4:return n;default:throw new Error(`invalid channels: ${e}`)}}class tI{constructor(){x(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new so({id:e})),this.stats.get(e)}}const k1=new tI,ye=new io({id:"luma.gl"}),eu={};function Yc(n="id"){eu[n]=eu[n]||1;const e=eu[n]++;return`${n}-${e}`}var ch;let Ct=(ch=class{constructor(e,t,i){x(this,"id");x(this,"props");x(this,"userData",{});x(this,"_device");x(this,"destroyed",!1);x(this,"allocatedBytes",0);x(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=nI(t,i);const s=this.props.id!=="undefined"?this.props.id:Yc(this[Symbol.toStringTag]);this.props.id=s,this.id=s,this.userData=this.props.userData||{},this.addStats()}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){const i=this._device.statsManager.getStats("Resource Counts");i.get("GPU Memory").addCount(e),i.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}},x(ch,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),ch);function nI(n,e){const t={...e};for(const i in n)n[i]!==void 0&&(t[i]=n[i]);return t}const an=class an extends Ct{constructor(t,i){const s={...i};(i.usage||0)&an.INDEX&&!i.indexType&&(i.data instanceof Uint32Array?s.indexType="uint32":i.data instanceof Uint16Array&&(s.indexType="uint16")),delete s.data;super(t,s,an.defaultProps);x(this,"usage");x(this,"indexType");x(this,"updateTimestamp");x(this,"debugData",new ArrayBuffer(0));this.usage=s.usage||0,this.indexType=s.indexType,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}clone(t){return this.device.createBuffer({...this.props,...t})}readSyncWebGL(t,i){throw new Error("not implemented")}_setDebugData(t,i,s){const r=ArrayBuffer.isView(t)?t.buffer:t,o=Math.min(t?t.byteLength:s,an.DEBUG_DATA_MAX_LENGTH);r===null?this.debugData=new ArrayBuffer(o):i===0&&s===r.byteLength?this.debugData=r.slice(0,o):this.debugData=r.slice(i,i+o)}};x(an,"defaultProps",{...Ct.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),x(an,"MAP_READ",1),x(an,"MAP_WRITE",2),x(an,"COPY_SRC",4),x(an,"COPY_DST",8),x(an,"INDEX",16),x(an,"VERTEX",32),x(an,"UNIFORM",64),x(an,"STORAGE",128),x(an,"INDIRECT",256),x(an,"QUERY_RESOLVE",512),x(an,"DEBUG_DATA_MAX_LENGTH",32);let Ft=an;function U1(n){const e=vg[n],t=iI(e),i=n.includes("norm"),s=!i&&!n.startsWith("float"),r=n.startsWith("s");return{dataType:vg[n],byteLength:t,integer:s,signed:r,normalized:i}}function iI(n){return sI[n]}const vg={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},sI={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},pn="texture-compression-bc",xt="texture-compression-astc",yi="texture-compression-etc2",rI="texture-compression-etc1-webgl",Da="texture-compression-pvrtc-webgl",tu="texture-compression-atc-webgl",Na="float32-renderable-webgl",nu="float16-renderable-webgl",oI="rgb9e5ufloat-renderable-webgl",iu="snorm8-renderable-webgl",vo="norm16-renderable-webgl",su="snorm16-renderable-webgl",Fa="float32-filterable",Tg="float16-filterable-webgl";function V1(n){const e=aI[n];if(!e)throw new Error(`Unsupported texture format ${n}`);return e}const aI={r8unorm:{},r8snorm:{render:iu},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:iu},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:nu,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:vo},"r16snorm-webgl":{f:su},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:iu},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:nu,filter:Tg},"rg16unorm-webgl":{render:vo},"rg16snorm-webgl":{render:su},r32uint:{},r32sint:{},r32float:{render:Na,filter:Fa},rgb9e5ufloat:{channels:"rgb",packed:!0,render:oI},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:Na},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:vo},"rgb16snorm-webgl":{f:vo},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:Fa},rgba16uint:{},rgba16sint:{},rgba16float:{render:nu,filter:Tg},"rgba16unorm-webgl":{render:vo},"rgba16snorm-webgl":{render:su},"rgb32float-webgl":{render:Na,filter:Fa},rgba32uint:{},rgba32sint:{},rgba32float:{render:Na,filter:Fa},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:pn},"bc1-rgb-unorm-srgb-webgl":{f:pn},"bc1-rgba-unorm":{f:pn},"bc1-rgba-unorm-srgb":{f:pn},"bc2-rgba-unorm":{f:pn},"bc2-rgba-unorm-srgb":{f:pn},"bc3-rgba-unorm":{f:pn},"bc3-rgba-unorm-srgb":{f:pn},"bc4-r-unorm":{f:pn},"bc4-r-snorm":{f:pn},"bc5-rg-unorm":{f:pn},"bc5-rg-snorm":{f:pn},"bc6h-rgb-ufloat":{f:pn},"bc6h-rgb-float":{f:pn},"bc7-rgba-unorm":{f:pn},"bc7-rgba-unorm-srgb":{f:pn},"etc2-rgb8unorm":{f:yi},"etc2-rgb8unorm-srgb":{f:yi},"etc2-rgb8a1unorm":{f:yi},"etc2-rgb8a1unorm-srgb":{f:yi},"etc2-rgba8unorm":{f:yi},"etc2-rgba8unorm-srgb":{f:yi},"eac-r11unorm":{f:yi},"eac-r11snorm":{f:yi},"eac-rg11unorm":{f:yi},"eac-rg11snorm":{f:yi},"astc-4x4-unorm":{f:xt},"astc-4x4-unorm-srgb":{f:xt},"astc-5x4-unorm":{f:xt},"astc-5x4-unorm-srgb":{f:xt},"astc-5x5-unorm":{f:xt},"astc-5x5-unorm-srgb":{f:xt},"astc-6x5-unorm":{f:xt},"astc-6x5-unorm-srgb":{f:xt},"astc-6x6-unorm":{f:xt},"astc-6x6-unorm-srgb":{f:xt},"astc-8x5-unorm":{f:xt},"astc-8x5-unorm-srgb":{f:xt},"astc-8x6-unorm":{f:xt},"astc-8x6-unorm-srgb":{f:xt},"astc-8x8-unorm":{f:xt},"astc-8x8-unorm-srgb":{f:xt},"astc-10x5-unorm":{f:xt},"astc-10x5-unorm-srgb":{f:xt},"astc-10x6-unorm":{f:xt},"astc-10x6-unorm-srgb":{f:xt},"astc-10x8-unorm":{f:xt},"astc-10x8-unorm-srgb":{f:xt},"astc-10x10-unorm":{f:xt},"astc-10x10-unorm-srgb":{f:xt},"astc-12x10-unorm":{f:xt},"astc-12x10-unorm-srgb":{f:xt},"astc-12x12-unorm":{f:xt},"astc-12x12-unorm-srgb":{f:xt},"pvrtc-rgb4unorm-webgl":{f:Da},"pvrtc-rgba4unorm-webgl":{f:Da},"pvrtc-rbg2unorm-webgl":{f:Da},"pvrtc-rgba2unorm-webgl":{f:Da},"etc1-rbg-unorm-webgl":{f:rI},"atc-rgb-unorm-webgl":{f:tu},"atc-rgba-unorm-webgl":{f:tu},"atc-rgbai-unorm-webgl":{f:tu}},lI=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],cI=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function z1(n){return lI.some(e=>n.startsWith(e))}function Of(n){let e=AI(n);if(z1(n)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const i=uI(n);i&&(e.blockWidth=i.blockWidth,e.blockHeight=i.blockHeight)}const t=cI.exec(n);if(t){const[,i,s,r,o,a]=t,l=`${r}${s}`,f=U1(l),g=f.byteLength*8,_=i.length,v=[g,_>=2?g:0,_>=3?g:0,_>=4?g:0];e={format:n,attachment:e.attachment,dataType:f.dataType,components:_,channels:i,integer:f.integer,signed:f.signed,normalized:f.normalized,bitsPerChannel:v,bytesPerPixel:f.byteLength*i.length,packed:e.packed,srgb:e.srgb},a==="-webgl"&&(e.webgl=!0),o==="-srgb"&&(e.srgb=!0)}return n.endsWith("-webgl")&&(e.webgl=!0),n.endsWith("-srgb")&&(e.srgb=!0),e}function AI(n){var r;const e=V1(n),t=e.bytesPerPixel||1,i=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:n,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||((r=e.channels)==null?void 0:r.length)||1,bytesPerPixel:t,bitsPerChannel:i,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function uI(n){const t=/.*-(\d+)x(\d+)-.*/.exec(n);if(t){const[,i,s]=t;return{blockWidth:Number(i),blockHeight:Number(s)}}return null}function hI(n){const e=V1(n),t={format:n,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},i=Of(n),s=n.startsWith("depth")||n.startsWith("stencil"),r=i==null?void 0:i.signed,o=i==null?void 0:i.integer,a=i==null?void 0:i.webgl;return t.render&&(t.render=!r),t.filter&&(t.filter=!s&&!r&&!o&&!a),t}class fI{}class dI{constructor(e=[],t){x(this,"features");x(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){var t;return!((t=this.disabledFeatures)!=null&&t[e])&&this.features.has(e)}}const Bc=class Bc{constructor(e){x(this,"id");x(this,"props");x(this,"userData",{});x(this,"statsManager",k1);x(this,"timestamp",0);x(this,"_reused",!1);x(this,"_lumaData",{});this.props={...Bc.defaultProps,...e},this.id=this.props.id||Yc(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}getTextureFormatCapabilities(e){const t=hI(e),i=o=>(typeof o=="string"?this.features.has(o):o)??!0,s=i(t.create),r={format:e,create:s,render:s&&i(t.render),filter:s&&i(t.filter),blend:s&&i(t.blend),store:s&&i(t.store)};return this._getDeviceSpecificTextureFormatCapabilities(r)}isTextureFormatSupported(e,t){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return z1(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(e={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};return(e.usage||0)&Ft.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array?t.indexType="uint16":ye.warn("indices buffer content must be of integer type")()),t}};x(Bc,"defaultProps",{id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>ye.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:ye.get("debug")||void 0,debugShaders:ye.get("debug-shaders")||void 0,debugFramebuffers:!!ye.get("debug-framebuffers"),debugWebGL:!!ye.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0});let ls=Bc;const gI=Xs()&&typeof document<"u",pI=()=>gI&&document.readyState==="complete",mI="set luma.log.level=1 (or higher) to trace rendering",wg="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",ts=class ts{constructor(){x(this,"stats",k1);x(this,"log",ye);x(this,"VERSION","9.1.4");x(this,"spector");x(this,"preregisteredAdapters",new Map);if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw ye.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),ye.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");ye.error("This version of luma.gl has already been initialized")()}ye.log(1,`${this.VERSION} - ${mI}`)(),globalThis.luma=this}registerAdapters(e){for(const t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(e=[]){const t=this.getAdapterMap(e);return Array.from(t).map(([,i])=>i).filter(i=>{var s;return(s=i.isSupported)==null?void 0:s.call(i)}).map(i=>i.type)}getBestAvailableAdapter(e=[]){var i,s,r,o;const t=this.getAdapterMap(e);return(s=(i=t.get("webgpu"))==null?void 0:i.isSupported)!=null&&s.call(i)?"webgpu":(o=(r=t.get("webgl"))==null?void 0:r.isSupported)!=null&&o.call(r)?"webgl":null}setDefaultDeviceProps(e){Object.assign(ts.defaultProps,e)}async createDevice(e={}){var a;e={...ts.defaultProps,...e},e.waitForPageLoad&&await ts.pageLoaded;const t=this.getAdapterMap(e.adapters);let i=e.type||"";i==="best-available"&&(i=this.getBestAvailableAdapter(e.adapters)||i);const r=(this.getAdapterMap(e.adapters)||t).get(i),o=await((a=r==null?void 0:r.create)==null?void 0:a.call(r,e));if(o)return o;throw new Error(wg)}async attachDevice(e){var o;const t=this.getAdapterMap(e.adapters);let i="";e.handle instanceof WebGL2RenderingContext&&(i="webgl"),e.createCanvasContext&&await ts.pageLoaded,e.handle===null&&(i="unknown");const s=t.get(i),r=await((o=s==null?void 0:s.attach)==null?void 0:o.call(s,null));if(r)return r;throw new Error(wg)}enforceWebGL2(e=!0,t=[]){var r;const s=this.getAdapterMap(t).get("webgl");s||ye.warn("enforceWebGL2: webgl adapter not found")(),(r=s==null?void 0:s.enforceWebGL2)==null||r.call(s,e)}getAdapterMap(e=[]){const t=new Map(this.preregisteredAdapters);for(const i of e)t.set(i.type,i);return t}registerDevices(e){ye.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const t of e){const i=t.adapter;i&&this.preregisteredAdapters.set(i.type,i)}}};x(ts,"defaultProps",{...ls.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0}),x(ts,"pageLoaded",_I().then(()=>{ye.probe(2,"DOM is loaded")()}));let mh=ts;const _h=new mh;function _I(){return pI()||typeof window>"u"?Promise.resolve():new Promise(n=>{window.addEventListener("load",()=>n())})}class yI{}const Oc=class Oc{constructor(e){x(this,"id");x(this,"props");x(this,"canvas");x(this,"htmlCanvas");x(this,"offscreenCanvas");x(this,"type");x(this,"width",1);x(this,"height",1);x(this,"resizeObserver");x(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...Oc.defaultProps,...e},e=this.props,!Xs()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=vI(e.canvas):this.canvas=e.canvas;else{const t=TI(e),i=bI((e==null?void 0:e.container)||null);i.insertBefore(t,i.firstChild),this.canvas=t,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(t=>{for(const i of t)i.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),t=this.canvas;return t.parentElement?[t.clientWidth*e,t.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,t]=this.getPixelSize();return e/t}cssToDeviceRatio(){var e;try{const[t]=this.getDrawingBufferSize(),i=this._canvasSizeInfo.clientWidth||((e=this.htmlCanvas)==null?void 0:e.clientWidth);return i?t/i:1}catch{return 1}}cssToDevicePixels(e,t=!0){const i=this.cssToDeviceRatio(),[s,r]=this.getDrawingBufferSize();return wI(e,i,s,r,t)}setDevicePixelRatio(e,t={}){if(!this.htmlCanvas)return;let i="width"in t?t.width:this.htmlCanvas.clientWidth,s="height"in t?t.height:this.htmlCanvas.clientHeight;(!i||!s)&&(ye.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=this.htmlCanvas.width||1,s=this.htmlCanvas.height||1);const r=this._canvasSizeInfo;if(r.clientWidth!==i||r.clientHeight!==s||r.devicePixelRatio!==e){let o=e;const a=Math.floor(i*o),l=Math.floor(s*o);if(this.htmlCanvas.width=a,this.htmlCanvas.height=l,this.device.gl){const[g,_]=this.getDrawingBufferSize();(g!==a||_!==l)&&(o=Math.min(g/i,_/s),this.htmlCanvas.width=Math.floor(i*o),this.htmlCanvas.height=Math.floor(s*o),ye.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=i,this._canvasSizeInfo.clientHeight=s,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){const e=this.device.gl;return e?[e.drawingBufferWidth,e.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(e){var t;((t=this.htmlCanvas)==null?void 0:t.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}};x(Oc,"defaultProps",{canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"});let yh=Oc;function bI(n){if(typeof n=="string"){const e=document.getElementById(n);if(!e)throw new Error(`${n} is not an HTML element`);return e}else if(n)return n;return document.body}function vI(n){const e=document.getElementById(n);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function TI(n){const{width:e,height:t}=n,i=document.createElement("canvas");return i.id=Yc("lumagl-auto-created-canvas"),i.width=e||1,i.height=t||1,i.style.width=Number.isFinite(e)?`${e}px`:"100%",i.style.height=Number.isFinite(t)?`${t}px`:"100%",i}function wI(n,e,t,i,s){const r=n,o=Eg(r[0],e,t);let a=xg(r[1],e,i,s),l=Eg(r[0]+1,e,t);const f=l===t-1?l:l-1;l=xg(r[1]+1,e,i,s);let g;return s?(l=l===0?l:l+1,g=a,a=l):g=l===i-1?l:l-1,{x:o,y:a,width:Math.max(f-o+1,1),height:Math.max(g-a+1,1)}}function Eg(n,e,t){return Math.min(Math.round(n*e),t-1)}function xg(n,e,t,i){return i?Math.max(0,t-1-Math.round(n*e)):Math.min(Math.round(n*e),t-1)}const ln=class ln extends Ct{constructor(t,i){i=ln.normalizeProps(t,i);super(t,i,ln.defaultProps);x(this,"dimension");x(this,"format");x(this,"width");x(this,"height");x(this,"depth");x(this,"mipLevels");x(this,"updateTimestamp");if(this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const s=ln.getTextureDataSize(this.props.data);this.width=(s==null?void 0:s.width)||1,this.height=(s==null?void 0:s.height)||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?ln.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}clone(t){return this.device.createTexture({...this.props,...t})}static isExternalImage(t){return typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement||typeof VideoFrame<"u"&&t instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas}static getExternalImageSize(t){if(typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas)return{width:t.width,height:t.height};if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)return{width:t.naturalWidth,height:t.naturalHeight};if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)return{width:t.videoWidth,height:t.videoHeight};if(typeof VideoFrame<"u"&&t instanceof VideoFrame)return{width:t.displayWidth,height:t.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(t){const i=t==null?void 0:t.data;return ArrayBuffer.isView(i)}static getTextureDataSize(t){if(!t||ArrayBuffer.isView(t))return null;if(Array.isArray(t))return ln.getTextureDataSize(t[0]);if(ln.isExternalImage(t))return ln.getExternalImageSize(t);if(t&&typeof t=="object"&&t.constructor===Object){const s=Object.values(t)[0];return{width:s.width,height:s.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(t,i){let s;return ArrayBuffer.isView(t)?s=[{data:t,width:i.width,height:i.height}]:Array.isArray(t)?s=t:s=[t],s}static getMipLevelCount(t,i){return Math.floor(Math.log2(Math.max(t,i)))+1}static getCubeFaceDepth(t){switch(t){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(t)}}static normalizeProps(t,i){var l,f;const s={...i},r=((f=(l=t==null?void 0:t.props)==null?void 0:l._resourceDefaults)==null?void 0:f.texture)||{};Object.assign(s,r);const{width:o,height:a}=s;return typeof o=="number"&&(s.width=Math.max(1,Math.ceil(o))),typeof a=="number"&&(s.height=Math.max(1,Math.ceil(a))),s}};x(ln,"COPY_SRC",1),x(ln,"COPY_DST",2),x(ln,"TEXTURE",4),x(ln,"STORAGE",8),x(ln,"RENDER_ATTACHMENT",16),x(ln,"CubeFaces",["+X","-X","+Y","-Y","+Z","-Z"]),x(ln,"defaultProps",{...Ct.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0}),x(ln,"defaultCopyExternalImageOptions",{image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1});let kt=ln;const Dc=class Dc extends Ct{get[Symbol.toStringTag](){return"TextureView"}constructor(e,t){super(e,t,Dc.defaultProps)}};x(Dc,"defaultProps",{...Ct.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let jl=Dc;function EI(n,e,t){let i="";const s=e.split(/\r?\n/),r=n.slice().sort((o,a)=>o.lineNum-a.lineNum);switch((t==null?void 0:t.showSourceCode)||"no"){case"all":let o=0;for(let a=1;a<=s.length;a++)for(i+=H1(s[a-1],a,t);r.length>o&&r[o].lineNum===a;){const l=r[o++];i+=Cg(l,s,l.lineNum,{...t,inlineSource:!1})}return i;case"issues":case"no":for(const a of n)i+=Cg(a,s,a.lineNum,{inlineSource:(t==null?void 0:t.showSourceCode)!=="no"});return i}}function Cg(n,e,t,i){if(i!=null&&i.inlineSource){const r=xI(e,t),o=n.linePos>0?`${" ".repeat(n.linePos+5)}^^^
`:"";return`
${r}${o}${n.type.toUpperCase()}: ${n.message}

`}const s=n.type==="error"?"red":"#8B4000";return i!=null&&i.html?`<div class='luma-compiler-log-error' style="color:${s};"><b> ${n.type.toUpperCase()}: ${n.message}</b></div>`:`${n.type.toUpperCase()}: ${n.message}`}function xI(n,e,t){let i="";for(let s=e-2;s<=e;s++){const r=n[s-1];r!==void 0&&(i+=H1(r,e,t))}return i}function H1(n,e,t){const i=t!=null&&t.html?SI(n):n;return`${CI(String(e),4)}: ${i}${t!=null&&t.html?"<br/>":`
`}`}function CI(n,e){let t="";for(let i=n.length;i<e;++i)t+=" ";return t+n}function SI(n){return n.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}const Nc=class Nc extends Ct{constructor(t,i){i={...i,debugShaders:i.debugShaders||t.props.debugShaders||"errors"};super(t,{id:II(i),...i},Nc.defaultProps);x(this,"stage");x(this,"source");x(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const t=this.props.debugShaders;switch(t){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const i=await this.getCompilationInfo();t==="warnings"&&(i==null?void 0:i.length)===0||this._displayShaderLog(i)}_displayShaderLog(t){var f;if(typeof document>"u"||!(document!=null&&document.createElement))return;const i=G1(this.source),s=`${this.stage} ${i}`;let r=EI(t,this.source,{showSourceCode:"all",html:!0});const o=this.getTranslatedSource();o&&(r+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${o}</pre></code>`);const a=document.createElement("Button");a.innerHTML=`
<h1>Shader Compilation Error in ${s}</h1><br /><br />
<code style="user-select:text;"><pre>
${r}
</pre></code>`,a.style.top="10px",a.style.left="10px",a.style.position="absolute",a.style.zIndex="9999",a.style.width="100%",a.style.textAlign="left",document.body.appendChild(a),(f=document.getElementsByClassName("luma-compiler-log-error")[0])==null||f.scrollIntoView(),a.onclick=()=>{const g=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(g)}}};x(Nc,"defaultProps",{...Ct.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0});let $l=Nc;function II(n){return G1(n.source)||n.id||Yc(`unnamed ${n.stage}-shader`)}function G1(n,e="unnamed"){const i=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(n);return i?i[1]:e}const Yo=class Yo extends Ct{get[Symbol.toStringTag](){return"Sampler"}constructor(e,t){t=Yo.normalizeProps(e,t),super(e,t,Yo.defaultProps)}static normalizeProps(e,t){var r,o;const i=((o=(r=e==null?void 0:e.props)==null?void 0:r._resourceDefaults)==null?void 0:o.sampler)||{};return{...t,...i}}};x(Yo,"defaultProps",{...Ct.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let Xl=Yo;const Fc=class Fc extends Ct{constructor(t,i={}){super(t,i,Fc.defaultProps);x(this,"width");x(this,"height");this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}clone(t){const i=this.colorAttachments.map(r=>r.texture.clone(t)),s=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(t);return this.device.createFramebuffer({...this.props,colorAttachments:i,depthStencilAttachment:s})}resize(t){let i=!t;if(t){const[s,r]=Array.isArray(t)?t:[t.width,t.height];i=i||r!==this.height||s!==this.width,this.width=s,this.height=r}i&&(ye.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((i,s)=>{if(typeof i=="string"){const r=this.createColorTexture(i,s);return this.attachResource(r),r.view}return i instanceof kt?i.view:i});const t=this.props.depthStencilAttachment;if(t)if(typeof t=="string"){const i=this.createDepthStencilTexture(t);this.attachResource(i),this.depthStencilAttachment=i.view}else t instanceof kt?this.depthStencilAttachment=t.view:this.depthStencilAttachment=t}createColorTexture(t,i){return this.device.createTexture({id:`${this.id}-color-attachment-${i}`,usage:kt.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(t){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:kt.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(t,i){for(let s=0;s<this.colorAttachments.length;++s)if(this.colorAttachments[s]){const r=this.colorAttachments[s].texture.clone({width:t,height:i});this.destroyAttachedResource(this.colorAttachments[s]),this.colorAttachments[s]=r.view,this.attachResource(r.view)}if(this.depthStencilAttachment){const s=this.depthStencilAttachment.texture.clone({width:t,height:i});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=s.view,this.attachResource(s)}this.updateAttachments()}};x(Fc,"defaultProps",{...Ct.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let Ql=Fc;const Lc=class Lc extends Ct{constructor(t,i){super(t,i,Lc.defaultProps);x(this,"shaderLayout");x(this,"bufferLayout");x(this,"linkStatus","pending");x(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(t){throw new Error("Use uniform blocks")}};x(Lc,"defaultProps",{...Ct.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let jr=Lc;const ti=class ti extends Ct{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,t){t=ti.normalizeProps(e,t),super(e,t,ti.defaultProps)}static normalizeProps(e,t){var r;return{...(r=e.props._resourceDefaults)==null?void 0:r.renderPass,...t}}};x(ti,"defaultClearColor",[0,0,0,1]),x(ti,"defaultClearDepth",1),x(ti,"defaultClearStencil",0),x(ti,"defaultProps",{...Ct.defaultProps,framebuffer:null,parameters:void 0,clearColor:ti.defaultClearColor,clearColors:void 0,clearDepth:ti.defaultClearDepth,clearStencil:ti.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let bh=ti;const kc=class kc extends Ct{constructor(t,i){super(t,i,kc.defaultProps);x(this,"hash","");x(this,"shaderLayout");this.shaderLayout=i.shaderLayout}get[Symbol.toStringTag](){return"ComputePipeline"}};x(kc,"defaultProps",{...Ct.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let Yl=kc;const Uc=class Uc extends Ct{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,t){super(e,t,Uc.defaultProps)}};x(Uc,"defaultProps",{...Ct.defaultProps,measureExecutionTime:void 0});let vh=Uc;const Vc=class Vc extends Ct{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,t){super(e,t,Vc.defaultProps)}};x(Vc,"defaultProps",{...Ct.defaultProps});let Th=Vc;function RI(n){const[e,t]=MI[n],i=e==="i32"||e==="u32",s=e!=="u32",r=BI[e]*t,o=PI(e,t);return{dataType:e,components:t,defaultVertexFormat:o,byteLength:r,integer:i,signed:s}}function PI(n,e){let t;switch(n){case"f32":t="float32";break;case"i32":t="sint32";break;case"u32":t="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?t:`${t}x${e}`}const MI={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},BI={f32:4,f16:2,i32:4,u32:4};function W1(n){let e;n.endsWith("-webgl")&&(n.replace("-webgl",""),e=!0);const[t,i]=n.split("x"),s=t,r=i?parseInt(i):1,o=U1(s),a={type:s,components:r,byteLength:o.byteLength*r,integer:o.integer,signed:o.signed,normalized:o.normalized};return e&&(a.webglOnly=!0),a}function j1(n,e){const t={};for(const i of n.attributes){const s=DI(n,e,i.name);s&&(t[i.name]=s)}return t}function OI(n,e,t=16){const i=j1(n,e),s=new Array(t).fill(null);for(const r of Object.values(i))s[r.location]=r;return s}function DI(n,e,t){const i=NI(n,t),s=FI(e,t);if(!i)return null;const r=RI(i.type),o=(s==null?void 0:s.vertexFormat)||r.defaultVertexFormat,a=W1(o);return{attributeName:(s==null?void 0:s.attributeName)||i.name,bufferName:(s==null?void 0:s.bufferName)||i.name,location:i.location,shaderType:i.type,shaderDataType:r.dataType,shaderComponents:r.components,vertexFormat:o,bufferDataType:a.type,bufferComponents:a.components,normalized:a.normalized,integer:r.integer,stepMode:(s==null?void 0:s.stepMode)||i.stepMode||"vertex",byteOffset:(s==null?void 0:s.byteOffset)||0,byteStride:(s==null?void 0:s.byteStride)||0}}function NI(n,e){const t=n.attributes.find(i=>i.name===e);return t||ye.warn(`shader layout attribute "${e}" not present in shader`),t||null}function FI(n,e){LI(n);let t=kI(n,e);return t||(t=UI(n,e),t)?t:(ye.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function LI(n){for(const e of n)(e.attributes&&e.format||!e.attributes&&!e.format)&&ye.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function kI(n,e){for(const t of n)if(t.format&&t.name===e)return{attributeName:t.name,bufferName:e,stepMode:t.stepMode,vertexFormat:t.format,byteOffset:0,byteStride:t.byteStride||0};return null}function UI(n,e){var t;for(const i of n){let s=i.byteStride;if(typeof i.byteStride!="number")for(const o of i.attributes||[]){const a=W1(o.format);s+=a.byteLength}const r=(t=i.attributes)==null?void 0:t.find(o=>o.attribute===e);if(r)return{attributeName:r.attribute,bufferName:i.name,stepMode:i.stepMode,vertexFormat:r.format,byteOffset:r.byteOffset,byteStride:s}}return null}const zc=class zc extends Ct{constructor(t,i){super(t,i,zc.defaultProps);x(this,"maxVertexAttributes");x(this,"attributeInfos");x(this,"indexBuffer",null);x(this,"attributes");this.maxVertexAttributes=t.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:s,bufferLayout:r}=i.renderPipeline||{};if(!s||!r)throw new Error("VertexArray");this.attributeInfos=OI(s,r,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(t,i){this.device.reportError(new Error("constant attributes not supported"))}};x(zc,"defaultProps",{...Ct.defaultProps,renderPipeline:null});let wh=zc;const Hc=class Hc extends Ct{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,t){super(e,t,Hc.defaultProps)}};x(Hc,"defaultProps",{...Ct.defaultProps,layout:void 0,buffers:{}});let Eh=Hc;const Gc=class Gc extends Ct{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,t){super(e,t,Gc.defaultProps)}};x(Gc,"defaultProps",{...Ct.defaultProps,type:void 0,count:void 0});let xh=Gc;const VI={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function zI(n){return VI[n]}function HI(n,e){switch(e){case 1:return n;case 2:return n+n%2;default:return n+(4-n%4)%4}}let La;function $1(n){return(!La||La.byteLength<n)&&(La=new ArrayBuffer(n)),La}function GI(n,e){const t=$1(n.BYTES_PER_ELEMENT*e);return new n(t,0,e)}function WI(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function Kl(n){return Array.isArray(n)?n.length===0||typeof n[0]=="number":WI(n)}const Sg=1024;class jI{constructor(e){x(this,"layout",{});x(this,"byteLength");let t=0;for(const[s,r]of Object.entries(e)){const o=zI(r),{type:a,components:l}=o;t=HI(t,l);const f=t;t+=l,this.layout[s]={type:a,size:l,offset:f}}t+=(4-t%4)%4;const i=t*4;this.byteLength=Math.max(i,Sg)}getData(e){const t=Math.max(this.byteLength,Sg),i=$1(t),s={i32:new Int32Array(i),u32:new Uint32Array(i),f32:new Float32Array(i),f16:new Uint16Array(i)};for(const[r,o]of Object.entries(e)){const a=this.layout[r];if(!a){ye.warn(`Supplied uniform value ${r} not present in uniform block layout`)();continue}const{type:l,size:f,offset:g}=a,_=s[l];if(f===1){if(typeof o!="number"&&typeof o!="boolean"){ye.warn(`Supplied value for single component uniform ${r} is not a number: ${o}`)();continue}_[g]=Number(o)}else{if(!Kl(o)){ye.warn(`Supplied value for multi component / array uniform ${r} is not a numeric array: ${o}`)();continue}_.set(o,g)}}return new Uint8Array(i)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function $I(n,e,t=16){if(n!==e)return!1;const i=n,s=e;if(!Kl(i))return!1;if(Kl(s)&&i.length===s.length){for(let r=0;r<i.length;++r)if(s[r]!==i[r])return!1}return!0}function XI(n){return Kl(n)?n.slice():n}class QI{constructor(e){x(this,"name");x(this,"uniforms",{});x(this,"modifiedUniforms",{});x(this,"modified",!0);x(this,"bindingLayout",{});x(this,"needsRedraw","initialized");var t;if(this.name=(e==null?void 0:e.name)||"unnamed",e!=null&&e.name&&(e!=null&&e.shaderLayout)){const i=(t=e==null?void 0:e.shaderLayout.bindings)==null?void 0:t.find(r=>r.type==="uniform"&&r.name===(e==null?void 0:e.name));if(!i)throw new Error(e==null?void 0:e.name);const s=i;for(const r of s.uniforms||[])this.bindingLayout[r.name]=r}}setUniforms(e){for(const[t,i]of Object.entries(e))this._setUniform(t,i),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${i}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){$I(this.uniforms[e],t)||(this.uniforms[e]=XI(t),this.modifiedUniforms[e]=!0,this.modified=!0)}}class YI{constructor(e){x(this,"uniformBlocks",new Map);x(this,"uniformBufferLayouts",new Map);x(this,"uniformBuffers",new Map);for(const[t,i]of Object.entries(e)){const s=t,r=new jI(i.uniformTypes||{});this.uniformBufferLayouts.set(s,r);const o=new QI({name:t});o.setUniforms(i.defaultUniforms||{}),this.uniformBlocks.set(s,o)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){var t;for(const[i,s]of Object.entries(e))(t=this.uniformBlocks.get(i))==null||t.setUniforms(s);this.updateUniformBuffers()}getUniformBufferByteLength(e){var t;return((t=this.uniformBufferLayouts.get(e))==null?void 0:t.byteLength)||0}getUniformBufferData(e){var i,s;const t=((i=this.uniformBlocks.get(e))==null?void 0:i.getAllUniforms())||{};return(s=this.uniformBufferLayouts.get(e))==null?void 0:s.getData(t)}createUniformBuffer(e,t,i){i&&this.setUniforms(i);const s=this.getUniformBufferByteLength(t),r=e.createBuffer({usage:Ft.UNIFORM|Ft.COPY_DST,byteLength:s}),o=this.getUniformBufferData(t);return r.write(o),r}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const i=this.getUniformBufferByteLength(t),s=e.createBuffer({usage:Ft.UNIFORM|Ft.COPY_DST,byteLength:i});this.uniformBuffers.set(t,s)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const i=this.updateUniformBuffer(t);e||(e=i)}return e&&ye.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){var r;const t=this.uniformBlocks.get(e);let i=this.uniformBuffers.get(e),s=!1;if(i&&(t!=null&&t.needsRedraw)){s||(s=t.needsRedraw);const o=this.getUniformBufferData(e);i=this.uniformBuffers.get(e),i==null||i.write(o);const a=(r=this.uniformBlocks.get(e))==null?void 0:r.getAllUniforms();ye.log(4,`Writing to uniform buffer ${String(e)}`,o,a)()}return s}}function X1(n){const e=ArrayBuffer.isView(n)?n.constructor:n;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function Q1(n){switch(n){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(n)}}function KI(n,e,t){if(!e||e>4)throw new Error(`size ${e}`);const i=e;let s=X1(n);if(s==="uint8"&&t&&i===1)return"unorm8-webgl";if(s==="uint8"&&t&&i===3)return"unorm8x3-webgl";if(s==="uint8"||s==="sint8"){if(i===1||i===3)throw new Error(`size: ${e}`);return t&&(s=s.replace("int","norm")),`${s}x${i}`}if(s==="uint16"||s==="sint16"){if(i===1||i===3)throw new Error(`size: ${e}`);return t&&(s=s.replace("int","norm")),`${s}x${i}`}return i===1?s:`${s}x${i}`}class ru{constructor(e){x(this,"bufferLayouts");this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(t=>t.name===e)||null}getAttributeNamesForBuffer(e){var t;return e.attributes?(t=e.attributes)==null?void 0:t.map(i=>i.attribute):[e.name]}mergeBufferLayouts(e,t){const i=[...e];for(const s of t){const r=i.findIndex(o=>o.name===s.name);r<0?i.push(s):i[r]=s}return i}}let Ai=class{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}};class Ig{constructor(e,t,i){this.name=e,this.type=t,this.attributes=i,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}let is=class extends Ai{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}},Ls=class extends Ai{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}},us=class extends Ai{constructor(e,t,i,s){super(e,i),this.format=t,this.access=s}get isTemplate(){return!0}};var Ji,Sr,Oo,te,j;(n=>{n[n.Uniform=0]="Uniform",n[n.Storage=1]="Storage",n[n.Texture=2]="Texture",n[n.Sampler=3]="Sampler",n[n.StorageTexture=4]="StorageTexture"})(Ji||(Ji={}));let ka=class{constructor(e,t,i,s,r,o,a){this.name=e,this.type=t,this.group=i,this.binding=s,this.attributes=r,this.resourceType=o,this.access=a}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}};class qI{constructor(e,t){this.name=e,this.type=t}}let JI=class{constructor(e,t,i,s){this.name=e,this.type=t,this.locationType=i,this.location=s,this.interpolation=null}},Rg=class{constructor(e,t,i,s){this.name=e,this.type=t,this.locationType=i,this.location=s}},ZI=class{constructor(e,t,i,s){this.name=e,this.type=t,this.attributes=i,this.id=s}},eR=class{constructor(e,t,i){this.name=e,this.type=t,this.attributes=i}},tR=class{constructor(e,t=null,i){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=i}},nR=class{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}},iR=class{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}},Ii=class Y1{constructor(){this.id=Y1._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}search(e){}searchBlock(e,t){if(e){t(ql.instance);for(const i of e)i instanceof Array?this.searchBlock(i,t):i.search(t);t(Jl.instance)}}};Ii._id=0;let ql=class extends Ii{};ql.instance=new ql;let Jl=class extends Ii{};Jl.instance=new Jl;class Lt extends Ii{constructor(){super()}}let Zl=class extends Lt{constructor(e,t,i,s,r,o){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=i,this.body=s,this.startLine=r,this.endLine=o}get astNodeType(){return"function"}search(e){this.searchBlock(this.body,e)}},sR=class extends Lt{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}},K1=class extends Lt{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}},Ch=class extends Lt{constructor(e){super(),this.body=e}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}};class q1 extends Lt{constructor(e,t,i,s){super(),this.init=e,this.condition=t,this.increment=i,this.body=s}get astNodeType(){return"for"}search(e){var t,i,s;(t=this.init)===null||t===void 0||t.search(e),(i=this.condition)===null||i===void 0||i.search(e),(s=this.increment)===null||s===void 0||s.search(e),this.searchBlock(this.body,e)}}let ns=class extends Lt{constructor(e,t,i,s,r){super(),this.attributes=null,this.name=e,this.type=t,this.storage=i,this.access=s,this.value=r}get astNodeType(){return"var"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}},Df=class extends Lt{constructor(e,t,i){super(),this.attributes=null,this.name=e,this.type=t,this.value=i}get astNodeType(){return"override"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}},ec=class extends Lt{constructor(e,t,i,s,r){super(),this.attributes=null,this.name=e,this.type=t,this.storage=i,this.access=s,this.value=r}get astNodeType(){return"let"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}},Sh=class extends Lt{constructor(e,t,i,s,r){super(),this.attributes=null,this.name=e,this.type=t,this.storage=i,this.access=s,this.value=r}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}};(n=>{n.increment="++",n.decrement="--"})(Sr||(Sr={})),(n=>{n.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for IncrementOperator");return n[t]}})(Sr||(Sr={}));let J1=class extends Lt{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}};(n=>{n.assign="=",n.addAssign="+=",n.subtractAssin="-=",n.multiplyAssign="*=",n.divideAssign="/=",n.moduloAssign="%=",n.andAssign="&=",n.orAssign="|=",n.xorAssign="^=",n.shiftLeftAssign="<<=",n.shiftRightAssign=">>="})(Oo||(Oo={})),(n=>{n.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for AssignOperator");return t}})(Oo||(Oo={}));let Z1=class extends Lt{constructor(e,t,i){super(),this.operator=e,this.variable=t,this.value=i}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}},Nf=class extends Lt{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}search(e){for(const t of this.args)t.search(e);e(this)}},ey=class extends Lt{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}},ty=class extends Lt{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}},ny=class extends Lt{constructor(e,t,i,s){super(),this.condition=e,this.body=t,this.elseif=i,this.else=s}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}};class iy extends Lt{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}let rR=class extends Lt{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}},oR=class extends Lt{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}},sy=class extends Lt{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}};class Ff extends Lt{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class aR extends Lt{constructor(){super()}get astNodeType(){return"discard"}}class ry extends Lt{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}let oy=class extends Lt{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}};class be extends Lt{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if(t.name==="f32")return t;for(let i=1;i<e.length;++i){const s=be._priority.get(t.name);be._priority.get(e[i].name)<s&&(t=e[i])}return t.name==="x32"?be.i32:t}}be.x32=new be("x32"),be.f32=new be("f32"),be.i32=new be("i32"),be.u32=new be("u32"),be.f16=new be("f16"),be.bool=new be("bool"),be._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class Zi extends be{constructor(e,t,i,s){super(e),this.members=t,this.startLine=i,this.endLine=s}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}}let de=class extends be{constructor(e,t,i){super(e),this.format=t,this.access=i}get astNodeType(){return"template"}};de.vec2f=new de("vec2",be.f32,null),de.vec3f=new de("vec3",be.f32,null),de.vec4f=new de("vec4",be.f32,null),de.vec2i=new de("vec2",be.i32,null),de.vec3i=new de("vec3",be.i32,null),de.vec4i=new de("vec4",be.i32,null),de.vec2u=new de("vec2",be.u32,null),de.vec3u=new de("vec3",be.u32,null),de.vec4u=new de("vec4",be.u32,null),de.vec2h=new de("vec2",be.f16,null),de.vec3h=new de("vec3",be.f16,null),de.vec4h=new de("vec4",be.f16,null),de.vec2b=new de("vec2",be.bool,null),de.vec3b=new de("vec3",be.bool,null),de.vec4b=new de("vec4",be.bool,null),de.mat2x2f=new de("mat2x2",be.f32,null),de.mat2x3f=new de("mat2x3",be.f32,null),de.mat2x4f=new de("mat2x4",be.f32,null),de.mat3x2f=new de("mat3x2",be.f32,null),de.mat3x3f=new de("mat3x3",be.f32,null),de.mat3x4f=new de("mat3x4",be.f32,null),de.mat4x2f=new de("mat4x2",be.f32,null),de.mat4x3f=new de("mat4x3",be.f32,null),de.mat4x4f=new de("mat4x4",be.f32,null),de.mat2x2h=new de("mat2x2",be.f16,null),de.mat2x3h=new de("mat2x3",be.f16,null),de.mat2x4h=new de("mat2x4",be.f16,null),de.mat3x2h=new de("mat3x2",be.f16,null),de.mat3x3h=new de("mat3x3",be.f16,null),de.mat3x4h=new de("mat3x4",be.f16,null),de.mat4x2h=new de("mat4x2",be.f16,null),de.mat4x3h=new de("mat4x3",be.f16,null),de.mat4x4h=new de("mat4x4",be.f16,null);class lR extends be{constructor(e,t,i,s){super(e),this.storage=t,this.type=i,this.access=s}get astNodeType(){return"pointer"}}class ay extends be{constructor(e,t,i,s){super(e),this.attributes=t,this.format=i,this.count=s}get astNodeType(){return"array"}get isArray(){return!0}}class Do extends be{constructor(e,t,i){super(e),this.format=t,this.access=i}get astNodeType(){return"sampler"}}class di extends Ii{constructor(){super(),this.postfix=null}}class Hs extends di{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class ks extends di{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}}class ro extends di{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return ro.builtinFunctionNames.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(const t of this.args)t.search(e);e(this)}}ro.builtinFunctionNames=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class cs extends di{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}}class ly extends di{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){const i=e.evalExpression(this.initializer,e.context);return i!==null&&this.postfix?i.getDataValue(e,this.postfix,e.context):i}return null}search(e){this.initializer.search(e)}}class zt extends di{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return t!==void 0&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof ne}get isVector(){return this.value instanceof k||this.value instanceof gt}get scalarValue(){return this.value instanceof ne?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof k||this.value instanceof gt?this.value.value:(console.error("Value is not a vector or matrix."),[])}}class cy extends di{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class bl extends di{constructor(e){super(),this.contents=e}get astNodeType(){return"groupExpr"}constEvaluate(e,t){return this.contents[0].constEvaluate(e,t)}search(e){this.searchBlock(this.contents,e)}}class $r extends di{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class Ay extends di{constructor(){super()}}class Nn extends Ay{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class ei extends Ay{constructor(e,t,i){super(),this.operator=e,this.left=t,this.right=i}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:e.name==="f32"||t.name==="f32"?be.f32:e.name==="u32"||t.name==="u32"?be.u32:be.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class uy extends Ii{constructor(e){super(),this.body=e}}class vl extends di{constructor(){super()}get astNodeType(){return"default"}}class hy extends uy{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class fy extends uy{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class cR extends Ii{constructor(e,t,i){super(),this.name=e,this.type=t,this.attributes=i}get astNodeType(){return"argument"}}class AR extends Ii{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class uR extends Ii{constructor(e,t,i){super(),this.name=e,this.type=t,this.attributes=i}get astNodeType(){return"member"}}class hR extends Ii{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}class Gs{constructor(e){this.typeInfo=e}setDataValue(e,t,i,s){console.error("SetDataValue: Not implemented",t,i)}getDataValue(e,t,i){return console.error("GetDataValue: Not implemented",t),null}toString(){return`<${this.typeInfo.name}>`}}class Ih extends Gs{constructor(){super(new Ai("void",null))}toString(){return"void"}}Ih.void=new Ih;class ne extends Gs{constructor(e,t){super(t),this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?e=Math.floor(e):this.typeInfo.name==="bool"&&(e=e?1:0),this.value=e}setDataValue(e,t,i,s){i?console.error("SetDataValue: Scalar data does not support postfix",i):t instanceof ne?(t.value,this.typeInfo.name==="i32"||this.typeInfo.name==="u32"||this.typeInfo.name,this.value=t.value):console.error("SetDataValue: Invalid value",t)}getDataValue(e,t,i){return t?(console.error("GetDataValue: Scalar data does not support postfix",t),null):this}toString(){return`${this.value}`}}function dy(n,e,t){const i=e.length;return i===2?t==="f32"?new k(e,n.getTypeInfo("vec2f")):t==="i32"?new k(e,n.getTypeInfo("vec2i")):t==="u32"?new k(e,n.getTypeInfo("vec2u")):t==="f16"?new k(e,n.getTypeInfo("vec2h")):(console.error(`GetDataValue: Unknown format ${t}`),null):i===3?t==="f32"?new k(e,n.getTypeInfo("vec3f")):t==="i32"?new k(e,n.getTypeInfo("vec3i")):t==="u32"?new k(e,n.getTypeInfo("vec3u")):t==="f16"?new k(e,n.getTypeInfo("vec3h")):(console.error(`GetDataValue: Unknown format ${t}`),null):i===4?t==="f32"?new k(e,n.getTypeInfo("vec4f")):t==="i32"?new k(e,n.getTypeInfo("vec4i")):t==="u32"?new k(e,n.getTypeInfo("vec4u")):t==="f16"?new k(e,n.getTypeInfo("vec4h")):(console.error(`GetDataValue: Unknown format ${t}`),null):(console.error(`GetDataValue: Invalid vector size ${e.length}`),null)}class k extends Gs{constructor(e,t){super(t),Array.isArray(e)?this.value=e:this.value=Array.from(e)}setDataValue(e,t,i,s){i instanceof Hs?console.error("TODO: Set vector postfix"):t instanceof k?this.value=t.value:console.error("SetDataValue: Invalid value",t)}getDataValue(e,t,i){let s=e.getTypeInfo("f32");if(this.typeInfo instanceof us)s=this.typeInfo.format;else{const r=this.typeInfo.name;r==="vec2f"||r==="vec3f"||r==="vec4f"?s=e.getTypeInfo("f32"):r==="vec2i"||r==="vec3i"||r==="vec4i"?s=e.getTypeInfo("i32"):r==="vec2u"||r==="vec3u"||r==="vec4u"?s=e.getTypeInfo("u32"):r==="vec2h"||r==="vec3h"||r==="vec4h"?s=e.getTypeInfo("f16"):console.error(`GetDataValue: Unknown type ${r}`)}if(t instanceof $r){const r=t.index;let o=-1;if(r instanceof zt){if(!(r.value instanceof ne))return console.error(`GetValueData: Invalid array index ${r.value}`),null;o=r.value.value}else{const a=e.evalExpression(r,i);if(!(a instanceof ne))return console.error("GetDataValue: Unknown index type",r),null;o=a.value}return o<0||o>=this.value.length?(console.error("GetDataValue: Index out of range",o),null):new ne(this.value[o],s)}if(t instanceof Hs){const r=t.value,o=[];for(const a of r)a==="x"||a==="r"?o.push(this.value[0]):a==="y"||a==="g"?o.push(this.value[1]):a==="z"||a==="b"?o.push(this.value[2]):a==="w"||a==="a"?o.push(this.value[3]):console.error(`GetDataValue: Unknown member ${a}`);return o.length===1?new ne(o[0],s):dy(e,o,s.name)}return this}toString(){let e=`${this.value[0]}`;for(let t=1;t<this.value.length;++t)e+=`, ${this.value[t]}`;return e}}class gt extends Gs{constructor(e,t){super(t),this.value=e}setDataValue(e,t,i,s){i instanceof Hs?console.error("TODO: Set matrix postfix"):t instanceof gt?this.value=t.value:console.error("SetDataValue: Invalid value",t)}getDataValue(e,t,i){const s=this.typeInfo.name;let r=e.getTypeInfo("f32");if(this.typeInfo instanceof us)r=this.typeInfo.format;else if(s.endsWith("f"))r=e.getTypeInfo("f32");else if(s.endsWith("i"))r=e.getTypeInfo("i32");else if(s.endsWith("u"))r=e.getTypeInfo("u32");else{if(!s.endsWith("h"))return console.error(`GetDataValue: Unknown type ${s}`),null;r=e.getTypeInfo("f16")}if(t instanceof $r){const o=t.index;let a,l=-1;if(o instanceof zt){if(!(o.value instanceof ne))return console.error(`GetDataValue: Invalid array index ${o.value}`),null;l=o.value.value}else{const g=e.evalExpression(o,i);if(!(g instanceof ne))return console.error("GetDataValue: Unknown index type",o),null;l=g.value}if(l<0||l>=this.value.length)return console.error("GetDataValue: Index out of range",l),null;if(s==="mat2x2"||s==="mat2x2f"||s==="mat2x2h")a=this.value.slice(2*l,2*l+2);else if(s==="mat2x3"||s==="mat2x3f"||s==="mat2x3h")a=this.value.slice(3*l,3*l+3);else if(s==="mat2x4"||s==="mat2x4f"||s==="mat2x4h")a=this.value.slice(4*l,4*l+4);else if(s==="mat3x2"||s==="mat3x2f"||s==="mat3x2h")a=this.value.slice(2*l,2*l+2);else if(s==="mat3x3"||s==="mat3x3f"||s==="mat3x3h")a=this.value.slice(3*l,3*l+3);else if(s==="mat3x4"||s==="mat3x4f"||s==="mat3x4h")a=this.value.slice(4*l,4*l+4);else if(s==="mat4x2"||s==="mat4x2f"||s==="mat4x2h")a=this.value.slice(2*l,2*l+2);else if(s==="mat4x3"||s==="mat4x3f"||s==="mat4x3h")a=this.value.slice(3*l,3*l+3);else{if(s!=="mat4x4"&&s!=="mat4x4f"&&s!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${s}`),null;a=this.value.slice(4*l,4*l+4)}const f=dy(e,a,r.name);if(t.postfix)return f.getDataValue(e,t.postfix,i)}return this}toString(){let e=`${this.value[0]}`;for(let t=1;t<this.value.length;++t)e+=`, ${this.value[t]}`;return e}}class Ht extends Gs{constructor(e,t,i=0,s){super(t),this.textureSize=[0,0,0],this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=i,s!==void 0&&(this.textureSize=s)}setDataValue(e,t,i,s){if(t===null)return void console.log("setDataValue: NULL data.");let r=this.offset,o=this.typeInfo;for(;i;){if(i instanceof $r)if(o instanceof Ls){const a=i.index;if(a instanceof zt){if(!(a.value instanceof ne))return void console.error(`SetDataValue: Invalid index type ${a.value}`);r+=a.value.value*o.stride}else{const l=e.evalExpression(a,s);if(!(l instanceof ne))return void console.error("SetDataValue: Unknown index type",a);r+=l.value*o.stride}o=o.format}else console.error(`SetDataValue: Type ${e.getTypeName(o)} is not an array`);else{if(!(i instanceof Hs))return void console.error("SetDataValue: Unknown postfix type",i);{const a=i.value;if(o instanceof is){let l=!1;for(const f of o.members)if(f.name===a){r+=f.offset,o=f.type,l=!0;break}if(!l)return void console.error(`SetDataValue: Member ${a} not found`)}else if(o instanceof Ai){const l=e.getTypeName(o);let f=0;if(a==="x"||a==="r")f=0;else if(a==="y"||a==="g")f=1;else if(a==="z"||a==="b")f=2;else{if(a!=="w"&&a!=="a")return void console.error(`SetDataValue: Unknown member ${a}`);f=3}if(!(t instanceof ne))return void console.error("SetDataValue: Invalid value",t);const g=t.value;return l==="vec2f"?void(new Float32Array(this.buffer,r,2)[f]=g):l==="vec3f"?void(new Float32Array(this.buffer,r,3)[f]=g):l==="vec4f"?void(new Float32Array(this.buffer,r,4)[f]=g):l==="vec2i"?void(new Int32Array(this.buffer,r,2)[f]=g):l==="vec3i"?void(new Int32Array(this.buffer,r,3)[f]=g):l==="vec4i"?void(new Int32Array(this.buffer,r,4)[f]=g):l==="vec2u"?void(new Uint32Array(this.buffer,r,2)[f]=g):l==="vec3u"?void(new Uint32Array(this.buffer,r,3)[f]=g):l==="vec4u"?void(new Uint32Array(this.buffer,r,4)[f]=g):void console.error(`SetDataValue: Type ${l} is not a struct`)}}}i=i.postfix}this.setData(e,t,o,r,s)}setData(e,t,i,s,r){const o=e.getTypeName(i);if(o!=="f32"&&o!=="f16")if(o!=="i32"&&o!=="atomic<i32>"&&o!=="x32")if(o!=="u32"&&o!=="atomic<u32>")if(o!=="bool")if(o!=="vec2f"&&o!=="vec2h")if(o!=="vec3f"&&o!=="vec3h")if(o!=="vec4f"&&o!=="vec4h")if(o!=="vec2i")if(o!=="vec3i")if(o!=="vec4i")if(o!=="vec2u")if(o!=="vec3u")if(o!=="vec4u")if(o!=="vec2b")if(o!=="vec3b")if(o!=="vec4b")if(o!=="mat2x2f"&&o!=="mat2x2h")if(o!=="mat2x3f"&&o!=="mat2x3h")if(o!=="mat2x4f"&&o!=="mat2x4h")if(o!=="mat3x2f"&&o!=="mat3x2h")if(o!=="mat3x3f"&&o!=="mat3x3h")if(o!=="mat3x4f"&&o!=="mat3x4h")if(o!=="mat4x2f"&&o!=="mat4x2h")if(o!=="mat4x3f"&&o!=="mat4x3h")if(o!=="mat4x4f"&&o!=="mat4x4h")if(t instanceof Ht){if(i===t.typeInfo)return void new Uint8Array(this.buffer,s,t.buffer.byteLength).set(new Uint8Array(t.buffer));console.error("SetDataValue: Type mismatch",o,e.getTypeName(t.typeInfo))}else console.error(`SetData: Unknown type ${o}`);else{const a=new Float32Array(this.buffer,s,16);t instanceof gt?(a[0]=t.value[0],a[1]=t.value[1],a[2]=t.value[2],a[3]=t.value[3],a[4]=t.value[4],a[5]=t.value[5],a[6]=t.value[6],a[7]=t.value[7],a[8]=t.value[8],a[9]=t.value[9],a[10]=t.value[10],a[11]=t.value[11],a[12]=t.value[12],a[13]=t.value[13],a[14]=t.value[14],a[15]=t.value[15]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15])}else{const a=new Float32Array(this.buffer,s,12);t instanceof gt?(a[0]=t.value[0],a[1]=t.value[1],a[2]=t.value[2],a[3]=t.value[3],a[4]=t.value[4],a[5]=t.value[5],a[6]=t.value[6],a[7]=t.value[7],a[8]=t.value[8],a[9]=t.value[9],a[10]=t.value[10],a[11]=t.value[11]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11])}else{const a=new Float32Array(this.buffer,s,8);t instanceof gt?(a[0]=t.value[0],a[1]=t.value[1],a[2]=t.value[2],a[3]=t.value[3],a[4]=t.value[4],a[5]=t.value[5],a[6]=t.value[6],a[7]=t.value[7]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7])}else{const a=new Float32Array(this.buffer,s,12);t instanceof gt?(a[0]=t.value[0],a[1]=t.value[1],a[2]=t.value[2],a[3]=t.value[3],a[4]=t.value[4],a[5]=t.value[5],a[6]=t.value[6],a[7]=t.value[7],a[8]=t.value[8],a[9]=t.value[9],a[10]=t.value[10],a[11]=t.value[11]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11])}else{const a=new Float32Array(this.buffer,s,9);t instanceof gt?(a[0]=t.value[0],a[1]=t.value[1],a[2]=t.value[2],a[3]=t.value[3],a[4]=t.value[4],a[5]=t.value[5],a[6]=t.value[6],a[7]=t.value[7],a[8]=t.value[8]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8])}else{const a=new Float32Array(this.buffer,s,6);t instanceof gt?(a[0]=t.value[0],a[1]=t.value[1],a[2]=t.value[2],a[3]=t.value[3],a[4]=t.value[4],a[5]=t.value[5]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5])}else{const a=new Float32Array(this.buffer,s,8);t instanceof gt?(a[0]=t.value[0],a[1]=t.value[1],a[2]=t.value[2],a[3]=t.value[3],a[4]=t.value[4],a[5]=t.value[5],a[6]=t.value[6],a[7]=t.value[7]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7])}else{const a=new Float32Array(this.buffer,s,6);t instanceof gt?(a[0]=t.value[0],a[1]=t.value[1],a[2]=t.value[2],a[3]=t.value[3],a[4]=t.value[4],a[5]=t.value[5]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5])}else{const a=new Float32Array(this.buffer,s,4);t instanceof gt?(a[0]=t.value[0],a[1]=t.value[1],a[2]=t.value[2],a[3]=t.value[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3])}else{const a=new Uint32Array(this.buffer,s,4);t instanceof k?(a[0]=t.value[0],a[1]=t.value[1],a[2]=t.value[2],a[3]=t.value[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3])}else{const a=new Uint32Array(this.buffer,s,3);t instanceof k?(a[0]=t.value[0],a[1]=t.value[1],a[2]=t.value[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2])}else{const a=new Uint32Array(this.buffer,s,2);t instanceof k?(a[0]=t.value[0],a[1]=t.value[1]):(a[0]=t[0],a[1]=t[1])}else{const a=new Uint32Array(this.buffer,s,4);t instanceof k?(a[0]=t.value[0],a[1]=t.value[1],a[2]=t.value[2],a[3]=t.value[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3])}else{const a=new Uint32Array(this.buffer,s,3);t instanceof k?(a[0]=t.value[0],a[1]=t.value[1],a[2]=t.value[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2])}else{const a=new Uint32Array(this.buffer,s,2);t instanceof k?(a[0]=t.value[0],a[1]=t.value[1]):(a[0]=t[0],a[1]=t[1])}else{const a=new Int32Array(this.buffer,s,4);t instanceof k?(a[0]=t.value[0],a[1]=t.value[1],a[2]=t.value[2],a[3]=t.value[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3])}else{const a=new Int32Array(this.buffer,s,3);t instanceof k?(a[0]=t.value[0],a[1]=t.value[1],a[2]=t.value[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2])}else{const a=new Int32Array(this.buffer,s,2);t instanceof k?(a[0]=t.value[0],a[1]=t.value[1]):(a[0]=t[0],a[1]=t[1])}else{const a=new Float32Array(this.buffer,s,4);t instanceof k?(a[0]=t.value[0],a[1]=t.value[1],a[2]=t.value[2],a[3]=t.value[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3])}else{const a=new Float32Array(this.buffer,s,3);t instanceof k?(a[0]=t.value[0],a[1]=t.value[1],a[2]=t.value[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2])}else{const a=new Float32Array(this.buffer,s,2);t instanceof k?(a[0]=t.value[0],a[1]=t.value[1]):(a[0]=t[0],a[1]=t[1])}else t instanceof ne&&(new Int32Array(this.buffer,s,1)[0]=t.value);else t instanceof ne&&(new Uint32Array(this.buffer,s,1)[0]=t.value);else t instanceof ne&&(new Int32Array(this.buffer,s,1)[0]=t.value);else t instanceof ne&&(new Float32Array(this.buffer,s,1)[0]=t.value)}getDataValue(e,t,i){let s=this.offset,r=this.typeInfo;for(;t;){if(t instanceof $r){const a=t.index,l=e.evalExpression(a,i);let f=0;if(l instanceof ne?f=l.value:console.error("GetDataValue: Invalid index type",a),r instanceof Ls)s+=f*r.stride,r=r.format;else{const g=e.getTypeName(r);g==="mat4x4"||g==="mat4x4f"||g==="mat4x4h"?(s+=16*f,r=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${e.getTypeName(r)} is not an array`)}}else{if(!(t instanceof Hs))return console.error("GetDataValue: Unknown postfix type",t),null;{const a=t.value;if(r instanceof is){let l=!1;for(const f of r.members)if(f.name===a){s+=f.offset,r=f.type,l=!0;break}if(!l)return console.error(`GetDataValue: Member ${a} not found`),null}else if(r instanceof Ai){const l=e.getTypeName(r);if(l==="vec2f"||l==="vec3f"||l==="vec4f"||l==="vec2i"||l==="vec3i"||l==="vec4i"||l==="vec2u"||l==="vec3u"||l==="vec4u"||l==="vec2b"||l==="vec3b"||l==="vec4b"||l==="vec2h"||l==="vec3h"||l==="vec4h"||l==="vec2"||l==="vec3"||l==="vec4"){if(a.length>0&&a.length<5){let f="f32",g="f";const _=[];for(let v=0;v<a.length;++v){const T=a[v].toLocaleLowerCase();let C=0;if(T==="x"||T==="r")C=0;else if(T==="y"||T==="g")C=1;else if(T==="z"||T==="b")C=2;else{if(T!=="w"&&T!=="a")return console.error(`Unknown member ${a}`),null;C=3}if(l==="vec2f")_.push(new Float32Array(this.buffer,s,2)[C]);else if(l==="vec3f"){if(s+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const S=new Float32Array(this.buffer,s,3);_.push(S[C])}else if(l==="vec4f")_.push(new Float32Array(this.buffer,s,4)[C]);else if(l==="vec2i")f="i32",g="i",_.push(new Int32Array(this.buffer,s,2)[C]);else if(l==="vec3i")f="i32",g="i",_.push(new Int32Array(this.buffer,s,3)[C]);else if(l==="vec4i")f="i32",g="i",_.push(new Int32Array(this.buffer,s,4)[C]);else if(l==="vec2u"){f="u32",g="u";const S=new Uint32Array(this.buffer,s,2);_.push(S[C])}else l==="vec3u"?(f="u32",g="u",_.push(new Uint32Array(this.buffer,s,3)[C])):l==="vec4u"&&(f="u32",g="u",_.push(new Uint32Array(this.buffer,s,4)[C]))}return _.length===1?new ne(_[0],e.getTypeInfo(f)):(_.length===2?r=e.getTypeInfo(`vec2${g}`):_.length===3?r=e.getTypeInfo(`vec3${g}`):_.length===4?r=e.getTypeInfo(`vec4${g}`):console.error(`GetDataValue: Invalid vector length ${_.length}`),new k(_,r))}return console.error(`GetDataValue: Unknown member ${a}`),null}return console.error(`GetDataValue: Type ${l} is not a struct`),null}}}t=t.postfix}const o=e.getTypeName(r);return o==="f32"?new ne(new Float32Array(this.buffer,s,1)[0],r):o==="i32"?new ne(new Int32Array(this.buffer,s,1)[0],r):o==="u32"?new ne(new Uint32Array(this.buffer,s,1)[0],r):o==="vec2f"?new k(new Float32Array(this.buffer,s,2),r):o==="vec3f"?new k(new Float32Array(this.buffer,s,3),r):o==="vec4f"?new k(new Float32Array(this.buffer,s,4),r):o==="vec2i"?new k(new Int32Array(this.buffer,s,2),r):o==="vec3i"?new k(new Int32Array(this.buffer,s,3),r):o==="vec4i"?new k(new Int32Array(this.buffer,s,4),r):o==="vec2u"?new k(new Uint32Array(this.buffer,s,2),r):o==="vec3u"?new k(new Uint32Array(this.buffer,s,3),r):o==="vec4u"?new k(new Uint32Array(this.buffer,s,4),r):r instanceof us&&r.name==="atomic"?r.format.name==="u32"?new ne(new Uint32Array(this.buffer,s,1)[0],r.format):r.format.name==="i32"?new ne(new Int32Array(this.buffer,s,1)[0],r.format):(console.error(`GetDataValue: Invalid atomic format ${r.format.name}`),null):new Ht(this.buffer,r,s)}toString(){let e="";if(this.typeInfo instanceof Ls)if(this.typeInfo.format.name==="f32"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let i=1;i<t.length;++i)e+=`, ${t[i]}`}else if(this.typeInfo.format.name==="i32"){const t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let i=1;i<t.length;++i)e+=`, ${t[i]}`}else if(this.typeInfo.format.name==="u32"){const t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let i=1;i<t.length;++i)e+=`, ${t[i]}`}else if(this.typeInfo.format.name==="vec2f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let i=1;i<t.length/2;++i)e+=`, [${t[2*i]}, ${t[2*i+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let i=4;i<t.length;i+=4)e+=`, [${t[i]}, ${t[i+1]}, ${t[i+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let i=4;i<t.length;i+=4)e+=`, [${t[i]}, ${t[i+1]}, ${t[i+2]}, ${t[i+3]}]`}else e="[...]";else this.typeInfo instanceof is?e+="{...}":e="[...]";return e}}(n=>{n[n.token=0]="token",n[n.keyword=1]="keyword",n[n.reserved=2]="reserved"})(j||(j={}));class ${constructor(e,t,i){this.name=e,this.type=t,this.rule=i}toString(){return this.name}}class D{}te=D,D.none=new $("",j.reserved,""),D.eof=new $("EOF",j.token,""),D.reserved={asm:new $("asm",j.reserved,"asm"),bf16:new $("bf16",j.reserved,"bf16"),do:new $("do",j.reserved,"do"),enum:new $("enum",j.reserved,"enum"),f16:new $("f16",j.reserved,"f16"),f64:new $("f64",j.reserved,"f64"),handle:new $("handle",j.reserved,"handle"),i8:new $("i8",j.reserved,"i8"),i16:new $("i16",j.reserved,"i16"),i64:new $("i64",j.reserved,"i64"),mat:new $("mat",j.reserved,"mat"),premerge:new $("premerge",j.reserved,"premerge"),regardless:new $("regardless",j.reserved,"regardless"),typedef:new $("typedef",j.reserved,"typedef"),u8:new $("u8",j.reserved,"u8"),u16:new $("u16",j.reserved,"u16"),u64:new $("u64",j.reserved,"u64"),unless:new $("unless",j.reserved,"unless"),using:new $("using",j.reserved,"using"),vec:new $("vec",j.reserved,"vec"),void:new $("void",j.reserved,"void")},D.keywords={array:new $("array",j.keyword,"array"),atomic:new $("atomic",j.keyword,"atomic"),bool:new $("bool",j.keyword,"bool"),f32:new $("f32",j.keyword,"f32"),i32:new $("i32",j.keyword,"i32"),mat2x2:new $("mat2x2",j.keyword,"mat2x2"),mat2x3:new $("mat2x3",j.keyword,"mat2x3"),mat2x4:new $("mat2x4",j.keyword,"mat2x4"),mat3x2:new $("mat3x2",j.keyword,"mat3x2"),mat3x3:new $("mat3x3",j.keyword,"mat3x3"),mat3x4:new $("mat3x4",j.keyword,"mat3x4"),mat4x2:new $("mat4x2",j.keyword,"mat4x2"),mat4x3:new $("mat4x3",j.keyword,"mat4x3"),mat4x4:new $("mat4x4",j.keyword,"mat4x4"),ptr:new $("ptr",j.keyword,"ptr"),sampler:new $("sampler",j.keyword,"sampler"),sampler_comparison:new $("sampler_comparison",j.keyword,"sampler_comparison"),struct:new $("struct",j.keyword,"struct"),texture_1d:new $("texture_1d",j.keyword,"texture_1d"),texture_2d:new $("texture_2d",j.keyword,"texture_2d"),texture_2d_array:new $("texture_2d_array",j.keyword,"texture_2d_array"),texture_3d:new $("texture_3d",j.keyword,"texture_3d"),texture_cube:new $("texture_cube",j.keyword,"texture_cube"),texture_cube_array:new $("texture_cube_array",j.keyword,"texture_cube_array"),texture_multisampled_2d:new $("texture_multisampled_2d",j.keyword,"texture_multisampled_2d"),texture_storage_1d:new $("texture_storage_1d",j.keyword,"texture_storage_1d"),texture_storage_2d:new $("texture_storage_2d",j.keyword,"texture_storage_2d"),texture_storage_2d_array:new $("texture_storage_2d_array",j.keyword,"texture_storage_2d_array"),texture_storage_3d:new $("texture_storage_3d",j.keyword,"texture_storage_3d"),texture_depth_2d:new $("texture_depth_2d",j.keyword,"texture_depth_2d"),texture_depth_2d_array:new $("texture_depth_2d_array",j.keyword,"texture_depth_2d_array"),texture_depth_cube:new $("texture_depth_cube",j.keyword,"texture_depth_cube"),texture_depth_cube_array:new $("texture_depth_cube_array",j.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new $("texture_depth_multisampled_2d",j.keyword,"texture_depth_multisampled_2d"),texture_external:new $("texture_external",j.keyword,"texture_external"),u32:new $("u32",j.keyword,"u32"),vec2:new $("vec2",j.keyword,"vec2"),vec3:new $("vec3",j.keyword,"vec3"),vec4:new $("vec4",j.keyword,"vec4"),bitcast:new $("bitcast",j.keyword,"bitcast"),block:new $("block",j.keyword,"block"),break:new $("break",j.keyword,"break"),case:new $("case",j.keyword,"case"),continue:new $("continue",j.keyword,"continue"),continuing:new $("continuing",j.keyword,"continuing"),default:new $("default",j.keyword,"default"),diagnostic:new $("diagnostic",j.keyword,"diagnostic"),discard:new $("discard",j.keyword,"discard"),else:new $("else",j.keyword,"else"),enable:new $("enable",j.keyword,"enable"),fallthrough:new $("fallthrough",j.keyword,"fallthrough"),false:new $("false",j.keyword,"false"),fn:new $("fn",j.keyword,"fn"),for:new $("for",j.keyword,"for"),function:new $("function",j.keyword,"function"),if:new $("if",j.keyword,"if"),let:new $("let",j.keyword,"let"),const:new $("const",j.keyword,"const"),loop:new $("loop",j.keyword,"loop"),while:new $("while",j.keyword,"while"),private:new $("private",j.keyword,"private"),read:new $("read",j.keyword,"read"),read_write:new $("read_write",j.keyword,"read_write"),return:new $("return",j.keyword,"return"),requires:new $("requires",j.keyword,"requires"),storage:new $("storage",j.keyword,"storage"),switch:new $("switch",j.keyword,"switch"),true:new $("true",j.keyword,"true"),alias:new $("alias",j.keyword,"alias"),type:new $("type",j.keyword,"type"),uniform:new $("uniform",j.keyword,"uniform"),var:new $("var",j.keyword,"var"),override:new $("override",j.keyword,"override"),workgroup:new $("workgroup",j.keyword,"workgroup"),write:new $("write",j.keyword,"write"),r8unorm:new $("r8unorm",j.keyword,"r8unorm"),r8snorm:new $("r8snorm",j.keyword,"r8snorm"),r8uint:new $("r8uint",j.keyword,"r8uint"),r8sint:new $("r8sint",j.keyword,"r8sint"),r16uint:new $("r16uint",j.keyword,"r16uint"),r16sint:new $("r16sint",j.keyword,"r16sint"),r16float:new $("r16float",j.keyword,"r16float"),rg8unorm:new $("rg8unorm",j.keyword,"rg8unorm"),rg8snorm:new $("rg8snorm",j.keyword,"rg8snorm"),rg8uint:new $("rg8uint",j.keyword,"rg8uint"),rg8sint:new $("rg8sint",j.keyword,"rg8sint"),r32uint:new $("r32uint",j.keyword,"r32uint"),r32sint:new $("r32sint",j.keyword,"r32sint"),r32float:new $("r32float",j.keyword,"r32float"),rg16uint:new $("rg16uint",j.keyword,"rg16uint"),rg16sint:new $("rg16sint",j.keyword,"rg16sint"),rg16float:new $("rg16float",j.keyword,"rg16float"),rgba8unorm:new $("rgba8unorm",j.keyword,"rgba8unorm"),rgba8unorm_srgb:new $("rgba8unorm_srgb",j.keyword,"rgba8unorm_srgb"),rgba8snorm:new $("rgba8snorm",j.keyword,"rgba8snorm"),rgba8uint:new $("rgba8uint",j.keyword,"rgba8uint"),rgba8sint:new $("rgba8sint",j.keyword,"rgba8sint"),bgra8unorm:new $("bgra8unorm",j.keyword,"bgra8unorm"),bgra8unorm_srgb:new $("bgra8unorm_srgb",j.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new $("rgb10a2unorm",j.keyword,"rgb10a2unorm"),rg11b10float:new $("rg11b10float",j.keyword,"rg11b10float"),rg32uint:new $("rg32uint",j.keyword,"rg32uint"),rg32sint:new $("rg32sint",j.keyword,"rg32sint"),rg32float:new $("rg32float",j.keyword,"rg32float"),rgba16uint:new $("rgba16uint",j.keyword,"rgba16uint"),rgba16sint:new $("rgba16sint",j.keyword,"rgba16sint"),rgba16float:new $("rgba16float",j.keyword,"rgba16float"),rgba32uint:new $("rgba32uint",j.keyword,"rgba32uint"),rgba32sint:new $("rgba32sint",j.keyword,"rgba32sint"),rgba32float:new $("rgba32float",j.keyword,"rgba32float"),static_assert:new $("static_assert",j.keyword,"static_assert")},D.tokens={decimal_float_literal:new $("decimal_float_literal",j.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new $("hex_float_literal",j.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new $("int_literal",j.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new $("uint_literal",j.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new $("name",j.token,/[_a-zA-Z][0-9a-zA-Z_]*/),ident:new $("ident",j.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new $("and",j.token,"&"),and_and:new $("and_and",j.token,"&&"),arrow:new $("arrow ",j.token,"->"),attr:new $("attr",j.token,"@"),forward_slash:new $("forward_slash",j.token,"/"),bang:new $("bang",j.token,"!"),bracket_left:new $("bracket_left",j.token,"["),bracket_right:new $("bracket_right",j.token,"]"),brace_left:new $("brace_left",j.token,"{"),brace_right:new $("brace_right",j.token,"}"),colon:new $("colon",j.token,":"),comma:new $("comma",j.token,","),equal:new $("equal",j.token,"="),equal_equal:new $("equal_equal",j.token,"=="),not_equal:new $("not_equal",j.token,"!="),greater_than:new $("greater_than",j.token,">"),greater_than_equal:new $("greater_than_equal",j.token,">="),shift_right:new $("shift_right",j.token,">>"),less_than:new $("less_than",j.token,"<"),less_than_equal:new $("less_than_equal",j.token,"<="),shift_left:new $("shift_left",j.token,"<<"),modulo:new $("modulo",j.token,"%"),minus:new $("minus",j.token,"-"),minus_minus:new $("minus_minus",j.token,"--"),period:new $("period",j.token,"."),plus:new $("plus",j.token,"+"),plus_plus:new $("plus_plus",j.token,"++"),or:new $("or",j.token,"|"),or_or:new $("or_or",j.token,"||"),paren_left:new $("paren_left",j.token,"("),paren_right:new $("paren_right",j.token,")"),semicolon:new $("semicolon",j.token,";"),star:new $("star",j.token,"*"),tilde:new $("tilde",j.token,"~"),underscore:new $("underscore",j.token,"_"),xor:new $("xor",j.token,"^"),plus_equal:new $("plus_equal",j.token,"+="),minus_equal:new $("minus_equal",j.token,"-="),times_equal:new $("times_equal",j.token,"*="),division_equal:new $("division_equal",j.token,"/="),modulo_equal:new $("modulo_equal",j.token,"%="),and_equal:new $("and_equal",j.token,"&="),or_equal:new $("or_equal",j.token,"|="),xor_equal:new $("xor_equal",j.token,"^="),shift_right_equal:new $("shift_right_equal",j.token,">>="),shift_left_equal:new $("shift_left_equal",j.token,"<<=")},D.simpleTokens={"@":te.tokens.attr,"{":te.tokens.brace_left,"}":te.tokens.brace_right,":":te.tokens.colon,",":te.tokens.comma,"(":te.tokens.paren_left,")":te.tokens.paren_right,";":te.tokens.semicolon},D.literalTokens={"&":te.tokens.and,"&&":te.tokens.and_and,"->":te.tokens.arrow,"/":te.tokens.forward_slash,"!":te.tokens.bang,"[":te.tokens.bracket_left,"]":te.tokens.bracket_right,"=":te.tokens.equal,"==":te.tokens.equal_equal,"!=":te.tokens.not_equal,">":te.tokens.greater_than,">=":te.tokens.greater_than_equal,">>":te.tokens.shift_right,"<":te.tokens.less_than,"<=":te.tokens.less_than_equal,"<<":te.tokens.shift_left,"%":te.tokens.modulo,"-":te.tokens.minus,"--":te.tokens.minus_minus,".":te.tokens.period,"+":te.tokens.plus,"++":te.tokens.plus_plus,"|":te.tokens.or,"||":te.tokens.or_or,"*":te.tokens.star,"~":te.tokens.tilde,_:te.tokens.underscore,"^":te.tokens.xor,"+=":te.tokens.plus_equal,"-=":te.tokens.minus_equal,"*=":te.tokens.times_equal,"/=":te.tokens.division_equal,"%=":te.tokens.modulo_equal,"&=":te.tokens.and_equal,"|=":te.tokens.or_equal,"^=":te.tokens.xor_equal,">>=":te.tokens.shift_right_equal,"<<=":te.tokens.shift_left_equal},D.regexTokens={decimal_float_literal:te.tokens.decimal_float_literal,hex_float_literal:te.tokens.hex_float_literal,int_literal:te.tokens.int_literal,uint_literal:te.tokens.uint_literal,ident:te.tokens.ident},D.storage_class=[te.keywords.function,te.keywords.private,te.keywords.workgroup,te.keywords.uniform,te.keywords.storage],D.access_mode=[te.keywords.read,te.keywords.write,te.keywords.read_write],D.sampler_type=[te.keywords.sampler,te.keywords.sampler_comparison],D.sampled_texture_type=[te.keywords.texture_1d,te.keywords.texture_2d,te.keywords.texture_2d_array,te.keywords.texture_3d,te.keywords.texture_cube,te.keywords.texture_cube_array],D.multisampled_texture_type=[te.keywords.texture_multisampled_2d],D.storage_texture_type=[te.keywords.texture_storage_1d,te.keywords.texture_storage_2d,te.keywords.texture_storage_2d_array,te.keywords.texture_storage_3d],D.depth_texture_type=[te.keywords.texture_depth_2d,te.keywords.texture_depth_2d_array,te.keywords.texture_depth_cube,te.keywords.texture_depth_cube_array,te.keywords.texture_depth_multisampled_2d],D.texture_external_type=[te.keywords.texture_external],D.any_texture_type=[...te.sampled_texture_type,...te.multisampled_texture_type,...te.storage_texture_type,...te.depth_texture_type,...te.texture_external_type],D.texel_format=[te.keywords.r8unorm,te.keywords.r8snorm,te.keywords.r8uint,te.keywords.r8sint,te.keywords.r16uint,te.keywords.r16sint,te.keywords.r16float,te.keywords.rg8unorm,te.keywords.rg8snorm,te.keywords.rg8uint,te.keywords.rg8sint,te.keywords.r32uint,te.keywords.r32sint,te.keywords.r32float,te.keywords.rg16uint,te.keywords.rg16sint,te.keywords.rg16float,te.keywords.rgba8unorm,te.keywords.rgba8unorm_srgb,te.keywords.rgba8snorm,te.keywords.rgba8uint,te.keywords.rgba8sint,te.keywords.bgra8unorm,te.keywords.bgra8unorm_srgb,te.keywords.rgb10a2unorm,te.keywords.rg11b10float,te.keywords.rg32uint,te.keywords.rg32sint,te.keywords.rg32float,te.keywords.rgba16uint,te.keywords.rgba16sint,te.keywords.rgba16float,te.keywords.rgba32uint,te.keywords.rgba32sint,te.keywords.rgba32float],D.const_literal=[te.tokens.int_literal,te.tokens.uint_literal,te.tokens.decimal_float_literal,te.tokens.hex_float_literal,te.keywords.true,te.keywords.false],D.literal_or_ident=[te.tokens.ident,te.tokens.int_literal,te.tokens.uint_literal,te.tokens.decimal_float_literal,te.tokens.hex_float_literal,te.tokens.name],D.element_count_expression=[te.tokens.int_literal,te.tokens.uint_literal,te.tokens.ident],D.template_types=[te.keywords.vec2,te.keywords.vec3,te.keywords.vec4,te.keywords.mat2x2,te.keywords.mat2x3,te.keywords.mat2x4,te.keywords.mat3x2,te.keywords.mat3x3,te.keywords.mat3x4,te.keywords.mat4x2,te.keywords.mat4x3,te.keywords.mat4x4,te.keywords.atomic,te.keywords.bitcast,...te.any_texture_type],D.attribute_name=[te.tokens.ident,te.keywords.block,te.keywords.diagnostic],D.assignment_operators=[te.tokens.equal,te.tokens.plus_equal,te.tokens.minus_equal,te.tokens.times_equal,te.tokens.division_equal,te.tokens.modulo_equal,te.tokens.and_equal,te.tokens.or_equal,te.tokens.xor_equal,te.tokens.shift_right_equal,te.tokens.shift_left_equal],D.increment_operators=[te.tokens.plus_plus,te.tokens.minus_minus];class Pg{constructor(e,t,i){this.type=e,this.lexeme=t,this.line=i}toString(){return this.lexeme}isTemplateType(){return D.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==D.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class fR{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new Pg(D.eof,"",this._line)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let o=1;for(;o>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),o--,o==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),o++)}return!0}}const t=D.simpleTokens[e];if(t)return this._addToken(t),!0;let i=D.none;const s=this._isAlpha(e),r=e==="_";if(this._isAlphaNumeric(e)){let o=this._peekAhead();for(;this._isAlphaNumeric(o);)e+=this._advance(),o=this._peekAhead()}if(s){const o=D.keywords[e];if(o)return this._addToken(o),!0}if(s||r)return this._addToken(D.tokens.ident),!0;for(;;){let o=this._findType(e);const a=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(a=="=")return this._current++,e+=a,this._addToken(D.tokens.minus_equal),!0;if(a=="-")return this._current++,e+=a,this._addToken(D.tokens.minus_minus),!0;const l=this._tokens.length-1;if((D.literal_or_ident.indexOf(this._tokens[l].type)!=-1||this._tokens[l].type==D.tokens.paren_right)&&a!=">")return this._addToken(o),!0}if(e==">"&&(a==">"||a=="=")){let l=!1,f=this._tokens.length-1;for(let g=0;g<5&&f>=0&&D.assignment_operators.indexOf(this._tokens[f].type)===-1;++g,--f)if(this._tokens[f].type===D.tokens.less_than){f>0&&this._tokens[f-1].isArrayOrTemplateType()&&(l=!0);break}if(l)return this._addToken(o),!0}if(o===D.none){let l=e,f=0;const g=2;for(let _=0;_<g;++_)if(l+=this._peekAhead(_),o=this._findType(l),o!==D.none){f=_;break}if(o===D.none)return i!==D.none&&(this._current--,this._addToken(i),!0);e=l,this._current+=f+1}if(i=o,this._isAtEnd())break;e+=this._advance()}return i!==D.none&&(this._addToken(i),!0)}_findType(e){for(const i in D.regexTokens){const s=D.regexTokens[i];if(this._match(e,s.rule))return s}return D.literalTokens[e]||D.none}_match(e,t){const i=t.exec(e);return i&&i.index==0&&i[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}_isAlphaNumeric(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e=="_"||e>="0"&&e<="9"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new Pg(e,t,this._line))}}class dR{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class Ua{constructor(e,t){this.align=e,this.size=t}}class Ei{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new nR,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const t of e)t instanceof Zl&&this._functions.set(t.name,new dR(t));for(const t of e)if(t instanceof Zi){const i=this.getTypeInfo(t,null);i instanceof is&&this.structs.push(i)}for(const t of e)if(t instanceof Ff)this.aliases.push(this._getAliasInfo(t));else if(t instanceof Df){const i=t,s=this._getAttributeNum(i.attributes,"id",0),r=i.type!=null?this.getTypeInfo(i.type,i.attributes):null;this.overrides.push(new ZI(i.name,r,i.attributes,s))}else if(this._isUniformVar(t)){const i=t,s=this._getAttributeNum(i.attributes,"group",0),r=this._getAttributeNum(i.attributes,"binding",0),o=this.getTypeInfo(i.type,i.attributes),a=new ka(i.name,o,s,r,i.attributes,Ji.Uniform,i.access);this.uniforms.push(a)}else if(this._isStorageVar(t)){const i=t,s=this._getAttributeNum(i.attributes,"group",0),r=this._getAttributeNum(i.attributes,"binding",0),o=this.getTypeInfo(i.type,i.attributes),a=this._isStorageTexture(o),l=new ka(i.name,o,s,r,i.attributes,a?Ji.StorageTexture:Ji.Storage,i.access);this.storage.push(l)}else if(this._isTextureVar(t)){const i=t,s=this._getAttributeNum(i.attributes,"group",0),r=this._getAttributeNum(i.attributes,"binding",0),o=this.getTypeInfo(i.type,i.attributes),a=this._isStorageTexture(o),l=new ka(i.name,o,s,r,i.attributes,a?Ji.StorageTexture:Ji.Texture,i.access);a?this.storage.push(l):this.textures.push(l)}else if(this._isSamplerVar(t)){const i=t,s=this._getAttributeNum(i.attributes,"group",0),r=this._getAttributeNum(i.attributes,"binding",0),o=this.getTypeInfo(i.type,i.attributes),a=new ka(i.name,o,s,r,i.attributes,Ji.Sampler,i.access);this.samplers.push(a)}else if(t instanceof Zl){const i=this._getAttribute(t,"vertex"),s=this._getAttribute(t,"fragment"),r=this._getAttribute(t,"compute"),o=i||s||r,a=new tR(t.name,o==null?void 0:o.name,t.attributes);a.attributes=t.attributes,a.startLine=t.startLine,a.endLine=t.endLine,this.functions.push(a),this._functions.get(t.name).info=a,o&&(this._functions.get(t.name).inUse=!0,a.inUse=!0,a.resources=this._findResources(t,!!o),a.inputs=this._getInputs(t.args),a.outputs=this._getOutputs(t.returnType),this.entry[o.name].push(a)),a.arguments=t.args.map(l=>new eR(l.name,this.getTypeInfo(l.type,l.attributes),l.attributes)),a.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null}for(const t of this._functions.values())t.info&&(t.info.inUse=t.inUse,this._addCalls(t.node,t.info.calls));for(const t of this._functions.values())t.node.search(i=>{var s;if(i.astNodeType==="varExpr"){const r=i;for(const o of this.overrides)r.name==o.name&&((s=t.info)===null||s===void 0||s.overrides.push(o))}});for(const t of this.uniforms)this._markStructsInUse(t.type);for(const t of this.storage)this._markStructsInUse(t.type)}getStructInfo(e){for(const t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(const t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var i;for(const s of e.calls){const r=(i=this._functions.get(s.name))===null||i===void 0?void 0:i.info;r&&t.add(r)}}findResource(e,t){for(const i of this.uniforms)if(i.group==e&&i.binding==t)return i;for(const i of this.storage)if(i.group==e&&i.binding==t)return i;for(const i of this.textures)if(i.group==e&&i.binding==t)return i;for(const i of this.samplers)if(i.group==e&&i.binding==t)return i;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const i=[],s=this,r=[];return e.search(o=>{if(o instanceof ql)r.push({});else if(o instanceof Jl)r.pop();else if(o instanceof ns){const a=o;t&&a.type!==null&&this._markStructsFromAST(a.type),r.length>0&&(r[r.length-1][a.name]=a)}else if(o instanceof ks){const a=o;t&&a.type!==null&&this._markStructsFromAST(a.type)}else if(o instanceof ec){const a=o;t&&a.type!==null&&this._markStructsFromAST(a.type),r.length>0&&(r[r.length-1][a.name]=a)}else if(o instanceof cs){const a=o;if(r.length>0&&r[r.length-1][a.name])return;const l=s._findResource(a.name);l&&i.push(l)}else if(o instanceof ro){const a=o,l=s._functions.get(a.name);l&&(t&&(l.inUse=!0),e.calls.add(l.node),l.resources===null&&(l.resources=s._findResources(l.node,t)),i.push(...l.resources))}else if(o instanceof Nf){const a=o,l=s._functions.get(a.name);l&&(t&&(l.inUse=!0),e.calls.add(l.node),l.resources===null&&(l.resources=s._findResources(l.node,t)),i.push(...l.resources))}}),[...new Map(i.map(o=>[o.name,o])).values()]}getBindGroups(){const e=[];function t(i,s){i>=e.length&&(e.length=i+1),e[i]===void 0&&(e[i]=[]),s>=e[i].length&&(e[i].length=s+1)}for(const i of this.uniforms)t(i.group,i.binding),e[i.group][i.binding]=i;for(const i of this.storage)t(i.group,i.binding),e[i.group][i.binding]=i;for(const i of this.textures)t(i.group,i.binding),e[i.group][i.binding]=i;for(const i of this.samplers)t(i.group,i.binding),e[i.group][i.binding]=i;return e}_getOutputs(e,t=void 0){if(t===void 0&&(t=[]),e instanceof Zi)this._getStructOutputs(e,t);else{const i=this._getOutputInfo(e);i!==null&&t.push(i)}return t}_getStructOutputs(e,t){for(const i of e.members)if(i.type instanceof Zi)this._getStructOutputs(i.type,t);else{const s=this._getAttribute(i,"location")||this._getAttribute(i,"builtin");if(s!==null){const r=this.getTypeInfo(i.type,i.type.attributes),o=this._parseInt(s.value),a=new Rg(i.name,r,s.name,o);t.push(a)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const i=this.getTypeInfo(e,e.attributes),s=this._parseInt(t.value);return new Rg("",i,t.name,s)}return null}_getInputs(e,t=void 0){t===void 0&&(t=[]);for(const i of e)if(i.type instanceof Zi)this._getStructInputs(i.type,t);else{const s=this._getInputInfo(i);s!==null&&t.push(s)}return t}_getStructInputs(e,t){for(const i of e.members)if(i.type instanceof Zi)this._getStructInputs(i.type,t);else{const s=this._getInputInfo(i);s!==null&&t.push(s)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const i=this._getAttribute(e,"interpolation"),s=this.getTypeInfo(e.type,e.attributes),r=this._parseInt(t.value),o=new JI(e.name,s,t.name,r);return i!==null&&(o.interpolation=this._parseString(i.value)),o}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new qI(e.name,this.getTypeInfo(e.type,null))}getTypeInfo(e,t=null){if(this._types.has(e))return this._types.get(e);if(e instanceof ay){const s=e,r=s.format?this.getTypeInfo(s.format,s.attributes):null,o=new Ls(s.name,t);return o.format=r,o.count=s.count,this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof Zi){const s=e,r=new is(s.name,t);r.startLine=s.startLine,r.endLine=s.endLine;for(const o of s.members){const a=this.getTypeInfo(o.type,o.attributes);r.members.push(new Ig(o.name,a,o.attributes))}return this._types.set(e,r),this._updateTypeInfo(r),r}if(e instanceof Do){const s=e,r=s.format instanceof be,o=s.format?r?this.getTypeInfo(s.format,null):new Ai(s.format,null):null,a=new us(s.name,o,t,s.access);return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof de){const s=e,r=s.format?this.getTypeInfo(s.format,null):null,o=new us(s.name,r,t,s.access);return this._types.set(e,o),this._updateTypeInfo(o),o}const i=new Ai(e.name,t);return this._types.set(e,i),this._updateTypeInfo(i),i}_updateTypeInfo(e){var t,i,s;const r=this._getTypeSize(e);if(e.size=(t=r==null?void 0:r.size)!==null&&t!==void 0?t:0,e instanceof Ls&&e.format){const o=this._getTypeSize(e.format);e.stride=Math.max((i=o==null?void 0:o.size)!==null&&i!==void 0?i:0,(s=o==null?void 0:o.align)!==null&&s!==void 0?s:0),this._updateTypeInfo(e.format)}e instanceof is&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let i=0,s=0,r=0,o=0;for(let a=0,l=e.members.length;a<l;++a){const f=e.members[a],g=this._getTypeSize(f);if(!g)continue;(t=this._getAlias(f.type.name))!==null&&t!==void 0||f.type;const _=g.align,v=g.size;i=this._roundUp(_,i+s),s=v,r=i,o=Math.max(o,_),f.offset=i,f.size=v,this._updateTypeInfo(f.type)}e.size=this._roundUp(o,r+s),e.align=o}_getTypeSize(e){var t,i;if(e==null)return null;const s=this._getAttributeNum(e.attributes,"size",0),r=this._getAttributeNum(e.attributes,"align",0);if(e instanceof Ig&&(e=e.type),e instanceof Ai){const o=this._getAlias(e.name);o!==null&&(e=o)}{const o=Ei._typeInfo[e.name];if(o!==void 0){const a=((t=e.format)===null||t===void 0?void 0:t.name)==="f16"?2:1;return new Ua(Math.max(r,o.align/a),Math.max(s,o.size/a))}}{const o=Ei._typeInfo[e.name.substring(0,e.name.length-1)];if(o){const a=e.name[e.name.length-1]==="h"?2:1;return new Ua(Math.max(r,o.align/a),Math.max(s,o.size/a))}}if(e instanceof Ls){let o=e,a=8,l=8;const f=this._getTypeSize(o.format);return f!==null&&(l=f.size,a=f.align),l=o.count*this._getAttributeNum((i=e==null?void 0:e.attributes)!==null&&i!==void 0?i:null,"stride",this._roundUp(a,l)),s&&(l=s),new Ua(Math.max(r,a),Math.max(s,l))}if(e instanceof is){let o=0,a=0,l=0,f=0,g=0;for(const _ of e.members){const v=this._getTypeSize(_.type);v!==null&&(o=Math.max(v.align,o),l=this._roundUp(v.align,l+f),f=v.size,g=l)}return a=this._roundUp(o,g+f),new Ua(Math.max(r,o),Math.max(s,a))}return null}_isUniformVar(e){return e instanceof ns&&e.storage=="uniform"}_isStorageVar(e){return e instanceof ns&&e.storage=="storage"}_isTextureVar(e){return e instanceof ns&&e.type!==null&&Ei._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof ns&&e.type!==null&&Ei._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,t){const i=e;if(!i||!i.attributes)return null;const s=i.attributes;for(let r of s)if(r.name==t)return r;return null}_getAttributeNum(e,t,i){if(e===null)return i;for(let s of e)if(s.name==t){let r=s!==null&&s.value!==null?s.value:i;return r instanceof Array&&(r=r[0]),typeof r=="number"?r:typeof r=="string"?parseInt(r):i}return i}_roundUp(e,t){return Math.ceil(t/e)*e}}Ei._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},Ei._textureTypes=D.any_texture_type.map(n=>n.name),Ei._samplerTypes=D.sampler_type.map(n=>n.name);class Lf{constructor(e,t,i){this.name=e,this.value=t,this.node=i}clone(){return new Lf(this.name,this.value,this.node)}}class kf{constructor(e){this.name=e.name,this.node=e}clone(){return new kf(this.node)}}class Uf{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?(t=this.variables.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?(t=this.functions.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,i){this.variables.set(e,new Lf(e,t,i??null))}setVariable(e,t,i){const s=this.getVariable(e);s!==null?s.value=t:this.createVariable(e,t,i)}getVariableValue(e){var t;const i=this.getVariable(e);return(t=i==null?void 0:i.value)!==null&&t!==void 0?t:null}clone(){return new Uf(this)}}class gR{evalExpression(e,t){return null}getTypeName(e){return""}getTypeInfo(e){return null}getVariableName(e,t){return""}}class pR{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){const i=this.exec.evalExpression(e.args[0],t);let s=!0;if(i instanceof k)return i.value.forEach(r=>{r||(s=!1)}),new ne(s?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof k){const s=i.value.some(r=>r);return new ne(s?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){const i=this.exec.evalExpression(e.args[2],t);if(!(i instanceof ne))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return i.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let i=e.args[0];i instanceof Nn&&(i=i.right);const s=this.exec.evalExpression(i,t);if(s instanceof Ht&&s.typeInfo.size===0){const r=s.typeInfo,o=s.buffer.byteLength/r.stride;return new ne(o,this.getTypeInfo("u32"))}return new ne(s.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof k)return new k(i.value.map(r=>Math.abs(r)),i.typeInfo);const s=i;return new ne(Math.abs(s.value),s.typeInfo)}Acos(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof k)return new k(i.value.map(r=>Math.acos(r)),i.typeInfo);const s=i;return new ne(Math.acos(s.value),i.typeInfo)}Acosh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof k)return new k(i.value.map(r=>Math.acosh(r)),i.typeInfo);const s=i;return new ne(Math.acosh(s.value),i.typeInfo)}Asin(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof k)return new k(i.value.map(r=>Math.asin(r)),i.typeInfo);const s=i;return new ne(Math.asin(s.value),i.typeInfo)}Asinh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof k)return new k(i.value.map(r=>Math.asinh(r)),i.typeInfo);const s=i;return new ne(Math.asinh(s.value),i.typeInfo)}Atan(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof k)return new k(i.value.map(r=>Math.atan(r)),i.typeInfo);const s=i;return new ne(Math.atan(s.value),i.typeInfo)}Atanh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof k)return new k(i.value.map(r=>Math.atanh(r)),i.typeInfo);const s=i;return new ne(Math.atanh(s.value),i.typeInfo)}Atan2(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof k&&s instanceof k)return new k(i.value.map((a,l)=>Math.atan2(a,s.value[l])),i.typeInfo);const r=i,o=s;return new ne(Math.atan2(r.value,o.value),i.typeInfo)}Ceil(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof k)return new k(i.value.map(r=>Math.ceil(r)),i.typeInfo);const s=i;return new ne(Math.ceil(s.value),i.typeInfo)}_clamp(e,t,i){return Math.min(Math.max(e,t),i)}Clamp(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(i instanceof k&&s instanceof k&&r instanceof k)return new k(i.value.map((f,g)=>this._clamp(f,s.value[g],r.value[g])),i.typeInfo);const o=i,a=s,l=r;return new ne(this._clamp(o.value,a.value,l.value),i.typeInfo)}Cos(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof k)return new k(i.value.map(r=>Math.cos(r)),i.typeInfo);const s=i;return new ne(Math.cos(s.value),i.typeInfo)}Cosh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof k)return new k(i.value.map(r=>Math.cosh(r)),i.typeInfo);const s=i;return new ne(Math.cos(s.value),i.typeInfo)}CountLeadingZeros(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof k)return new k(i.value.map(r=>Math.clz32(r)),i.typeInfo);const s=i;return new ne(Math.clz32(s.value),i.typeInfo)}_countOneBits(e){let t=0;for(;e!==0;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof k)return new k(i.value.map(r=>this._countOneBits(r)),i.typeInfo);const s=i;return new ne(this._countOneBits(s.value),i.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof k)return new k(i.value.map(r=>this._countTrailingZeros(r)),i.typeInfo);const s=i;return new ne(this._countTrailingZeros(s.value),i.typeInfo)}Cross(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof k&&s instanceof k){if(i.value.length!==3||s.value.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const r=i.value,o=s.value;return new k([r[1]*o[2]-o[1]*r[2],r[2]*o[0]-o[2]*r[0],r[0]*o[1]-o[0]*r[1]],i.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,t){const i=this.exec.evalExpression(e.args[0],t),s=180/Math.PI;return i instanceof k?new k(i.value.map(r=>r*s),i.typeInfo):new ne(i.value*s,i.typeInfo)}Determinant(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof gt){const s=i.value,r=this.exec.getTypeName(i.typeInfo),o=r.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(r==="mat2x2"||r==="mat2x2f"||r==="mat2x2h")return new ne(s[0]*s[3]-s[1]*s[2],o);if(r==="mat2x3"||r==="mat2x3f"||r==="mat2x3h")return new ne(s[0]*(s[4]*s[8]-s[5]*s[7])-s[1]*(s[3]*s[8]-s[5]*s[6])+s[2]*(s[3]*s[7]-s[4]*s[6]),o);if(r==="mat2x4"||r==="mat2x4f"||r==="mat2x4h")console.error(`TODO: Determinant for ${r}`);else if(r==="mat3x2"||r==="mat3x2f"||r==="mat3x2h")console.error(`TODO: Determinant for ${r}`);else{if(r==="mat3x3"||r==="mat3x3f"||r==="mat3x3h")return new ne(s[0]*(s[4]*s[8]-s[5]*s[7])-s[1]*(s[3]*s[8]-s[5]*s[6])+s[2]*(s[3]*s[7]-s[4]*s[6]),o);r==="mat3x4"||r==="mat3x4f"||r==="mat3x4h"||r==="mat4x2"||r==="mat4x2f"||r==="mat4x2h"||r==="mat4x3"||r==="mat4x3f"||r==="mat4x3h"?console.error(`TODO: Determinant for ${r}`):r!=="mat4x4"&&r!=="mat4x4f"&&r!=="mat4x4h"||console.error(`TODO: Determinant for ${r}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof k&&s instanceof k){let a=0;for(let l=0;l<i.value.length;++l)a+=(i.value[l]-s.value[l])*(i.value[l]-s.value[l]);return new ne(Math.sqrt(a),this.getTypeInfo("f32"))}const r=i,o=s;return new ne(Math.abs(r.value-o.value),i.typeInfo)}_dot(e,t){let i=0;for(let s=0;s<e.length;++s)i+=t[s]*e[s];return i}Dot(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);return i instanceof k&&s instanceof k?new ne(this._dot(i.value,s.value),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,t){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,t){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof k)return new k(i.value.map(r=>Math.exp(r)),i.typeInfo);const s=i;return new ne(Math.exp(s.value),i.typeInfo)}Exp2(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof k)return new k(i.value.map(r=>Math.pow(2,r)),i.typeInfo);const s=i;return new ne(Math.pow(2,s.value),i.typeInfo)}ExtractBits(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(r.typeInfo.name!=="u32"&&r.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const o=s.value,a=r.value;if(i instanceof k)return new k(i.value.map(f=>f>>o&(1<<a)-1),i.typeInfo);if(i.typeInfo.name!=="i32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const l=i.value;return new ne(l>>o&(1<<a)-1,this.getTypeInfo("i32"))}FaceForward(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(i instanceof k&&s instanceof k&&r instanceof k){const o=this._dot(s.value,r.value);return new k(o<0?i.value:i.value.map(a=>-a),i.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof k)return new k(i.value.map(r=>this._firstLeadingBit(r)),i.typeInfo);const s=i;return new ne(this._firstLeadingBit(s.value),i.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof k)return new k(i.value.map(r=>this._firstTrailingBit(r)),i.typeInfo);const s=i;return new ne(this._firstTrailingBit(s.value),i.typeInfo)}Floor(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof k)return new k(i.value.map(r=>Math.floor(r)),i.typeInfo);const s=i;return new ne(Math.floor(s.value),i.typeInfo)}Fma(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(i instanceof k&&s instanceof k&&r instanceof k)return i.value.length!==s.value.length||i.value.length!==r.value.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new k(i.value.map((f,g)=>f*s.value[g]+r.value[g]),i.typeInfo);const o=i,a=s,l=r;return new ne(o.value*a.value+l.value,o.typeInfo)}Fract(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof k)return new k(i.value.map(r=>r-Math.floor(r)),i.typeInfo);const s=i;return new ne(s.value-Math.floor(s.value),i.typeInfo)}Frexp(e,t){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t),o=this.exec.evalExpression(e.args[3],t);if(r.typeInfo.name!=="u32"&&r.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const a=r.value,l=(1<<o.value)-1<<a,f=~l;if(i instanceof k&&s instanceof k)return new k(i.value.map((v,T)=>v&f|s.value[T]<<a&l),i.typeInfo);const g=i.value,_=s.value;return new ne(g&f|_<<a&l,i.typeInfo)}InverseSqrt(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof k)return new k(i.value.map(r=>1/Math.sqrt(r)),i.typeInfo);const s=i;return new ne(1/Math.sqrt(s.value),i.typeInfo)}Ldexp(e,t){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof k){let r=0;return i.value.forEach(o=>{r+=o*o}),new ne(Math.sqrt(r),this.getTypeInfo("f32"))}const s=i;return new ne(Math.abs(s.value),i.typeInfo)}Log(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof k)return new k(i.value.map(r=>Math.log(r)),i.typeInfo);const s=i;return new ne(Math.log(s.value),i.typeInfo)}Log2(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof k)return new k(i.value.map(r=>Math.log2(r)),i.typeInfo);const s=i;return new ne(Math.log2(s.value),i.typeInfo)}Max(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof k&&s instanceof k)return new k(i.value.map((a,l)=>Math.max(a,s.value[l])),i.typeInfo);const r=i,o=s;return new ne(Math.max(r.value,o.value),i.typeInfo)}Min(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof k&&s instanceof k)return new k(i.value.map((a,l)=>Math.min(a,s.value[l])),i.typeInfo);const r=i,o=s;return new ne(Math.min(r.value,o.value),i.typeInfo)}Mix(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(i instanceof k&&s instanceof k&&r instanceof k)return new k(i.value.map((l,f)=>i.value[f]*(1-r.value[f])+s.value[f]*r.value[f]),i.typeInfo);const o=s,a=r;return new ne(i.value*(1-a.value)+o.value*a.value,i.typeInfo)}Modf(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof k&&s instanceof k)return new k(i.value.map((o,a)=>o%s.value[a]),i.typeInfo);const r=s;return new ne(i.value%r.value,i.typeInfo)}Normalize(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof k){const s=this.Length(e,t).value;return new k(i.value.map(r=>r/s),i.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof k&&s instanceof k)return new k(i.value.map((a,l)=>Math.pow(a,s.value[l])),i.typeInfo);const r=i,o=s;return new ne(Math.pow(r.value,o.value),i.typeInfo)}QuantizeToF16(e,t){const i=this.exec.evalExpression(e.args[0],t);return i instanceof k?new k(i.value.map(s=>s),i.typeInfo):new ne(i.value,i.typeInfo)}Radians(e,t){const i=this.exec.evalExpression(e.args[0],t);return i instanceof k?new k(i.value.map(s=>s*Math.PI/180),i.typeInfo):new ne(i.value*Math.PI/180,i.typeInfo)}Reflect(e,t){let i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof k&&s instanceof k){const r=this._dot(i.value,s.value);return new k(i.value.map((o,a)=>o-2*r*s.value[a]),i.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,t){let i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(i instanceof k&&s instanceof k&&r instanceof ne){const o=this._dot(s.value,i.value);return new k(i.value.map((a,l)=>{const f=1-r.value*r.value*(1-o*o);if(f<0)return 0;const g=Math.sqrt(f);return r.value*a-(r.value*o+g)*s.value[l]}),i.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,t){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof k)return new k(i.value.map(r=>Math.round(r)),i.typeInfo);const s=i;return new ne(Math.round(s.value),i.typeInfo)}Saturate(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof k)return new k(i.value.map(r=>Math.min(Math.max(r,0),1)),i.typeInfo);const s=i;return new ne(Math.min(Math.max(s.value,0),1),i.typeInfo)}Sign(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof k)return new k(i.value.map(r=>Math.sign(r)),i.typeInfo);const s=i;return new ne(Math.sign(s.value),i.typeInfo)}Sin(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof k)return new k(i.value.map(r=>Math.sin(r)),i.typeInfo);const s=i;return new ne(Math.sin(s.value),i.typeInfo)}Sinh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof k)return new k(i.value.map(r=>Math.sinh(r)),i.typeInfo);const s=i;return new ne(Math.sinh(s.value),i.typeInfo)}_smoothstep(e,t,i){const s=Math.min(Math.max((i-e)/(t-e),0),1);return s*s*(3-2*s)}SmoothStep(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(r instanceof k&&i instanceof k&&s instanceof k)return new k(r.value.map((f,g)=>this._smoothstep(i.value[g],s.value[g],f)),r.typeInfo);const o=i,a=s,l=r;return new ne(this._smoothstep(o.value,a.value,l.value),r.typeInfo)}Sqrt(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof k)return new k(i.value.map(r=>Math.sqrt(r)),i.typeInfo);const s=i;return new ne(Math.sqrt(s.value),i.typeInfo)}Step(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(s instanceof k&&i instanceof k)return new k(s.value.map((o,a)=>o<i.value[a]?0:1),s.typeInfo);const r=i;return new ne(s.value<r.value?0:1,r.typeInfo)}Tan(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof k)return new k(i.value.map(r=>Math.tan(r)),i.typeInfo);const s=i;return new ne(Math.tan(s.value),i.typeInfo)}Tanh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof k)return new k(i.value.map(r=>Math.tanh(r)),i.typeInfo);const s=i;return new ne(Math.tanh(s.value),i.typeInfo)}_getTransposeType(e){const t=this.exec.getTypeName(e);return t==="mat2x2f"||t==="mat2x2h"?e:t==="mat2x3f"?this.getTypeInfo("mat3x2f"):t==="mat2x3h"?this.getTypeInfo("mat3x2h"):t==="mat2x4f"?this.getTypeInfo("mat4x2f"):t==="mat2x4h"?this.getTypeInfo("mat4x2h"):t==="mat3x2f"?this.getTypeInfo("mat2x3f"):t==="mat3x2h"?this.getTypeInfo("mat2x3h"):t==="mat3x3f"||t==="mat3x3h"?e:t==="mat3x4f"?this.getTypeInfo("mat4x3f"):t==="mat3x4h"?this.getTypeInfo("mat4x3h"):t==="mat4x2f"?this.getTypeInfo("mat2x4f"):t==="mat4x2h"?this.getTypeInfo("mat2x4h"):t==="mat4x3f"?this.getTypeInfo("mat3x4f"):t==="mat4x3h"?this.getTypeInfo("mat3x4h"):(t==="mat4x4f"||t==="mat4x4h"||console.error(`Invalid matrix type ${t}`),e)}Transpose(e,t){const i=this.exec.evalExpression(e.args[0],t);if(!(i instanceof gt))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const s=this._getTransposeType(i.typeInfo);if(i.typeInfo.name==="mat2x2"||i.typeInfo.name==="mat2x2f"||i.typeInfo.name==="mat2x2h"){const r=i.value;return new gt([r[0],r[2],r[1],r[3]],s)}if(i.typeInfo.name==="mat2x3"||i.typeInfo.name==="mat2x3f"||i.typeInfo.name==="mat2x3h"){const r=i.value;return new gt([r[0],r[3],r[6],r[1],r[4],r[7]],s)}if(i.typeInfo.name==="mat2x4"||i.typeInfo.name==="mat2x4f"||i.typeInfo.name==="mat2x4h"){const r=i.value;return new gt([r[0],r[4],r[8],r[12],r[1],r[5],r[9],r[13]],s)}if(i.typeInfo.name==="mat3x2"||i.typeInfo.name==="mat3x2f"||i.typeInfo.name==="mat3x2h"){const r=i.value;return new gt([r[0],r[3],r[1],r[4],r[2],r[5]],s)}if(i.typeInfo.name==="mat3x3"||i.typeInfo.name==="mat3x3f"||i.typeInfo.name==="mat3x3h"){const r=i.value;return new gt([r[0],r[3],r[6],r[1],r[4],r[7],r[2],r[5],r[8]],s)}if(i.typeInfo.name==="mat3x4"||i.typeInfo.name==="mat3x4f"||i.typeInfo.name==="mat3x4h"){const r=i.value;return new gt([r[0],r[4],r[8],r[12],r[1],r[5],r[9],r[13],r[2],r[6],r[10],r[14]],s)}if(i.typeInfo.name==="mat4x2"||i.typeInfo.name==="mat4x2f"||i.typeInfo.name==="mat4x2h"){const r=i.value;return new gt([r[0],r[4],r[1],r[5],r[2],r[6]],s)}if(i.typeInfo.name==="mat4x3"||i.typeInfo.name==="mat4x3f"||i.typeInfo.name==="mat4x3h"){const r=i.value;return new gt([r[0],r[4],r[8],r[1],r[5],r[9],r[2],r[6],r[10]],s)}if(i.typeInfo.name==="mat4x4"||i.typeInfo.name==="mat4x4f"||i.typeInfo.name==="mat4x4h"){const r=i.value;return new gt([r[0],r[4],r[8],r[12],r[1],r[5],r[9],r[13],r[2],r[6],r[10],r[14],r[3],r[7],r[11],r[15]],s)}return console.error(`Invalid matrix type ${i.typeInfo.name}`),null}Trunc(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof k)return new k(i.value.map(r=>Math.trunc(r)),i.typeInfo);const s=i;return new ne(Math.trunc(s.value),i.typeInfo)}Dpdx(e,t){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,t){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,t){return console.error("TODO: dpdxFine"),null}Dpdy(e,t){return console.error("TODO: dpdy"),null}DpdyCoarse(e,t){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,t){return console.error("TODO: dpdyFine"),null}Fwidth(e,t){return console.error("TODO: fwidth"),null}FwidthCoarse(e,t){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,t){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,t){const i=e.args[0];if((e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0)>0)return console.error(`TODO: Mip levels. Line ${e.line}`),null;if(i instanceof cs){const s=i.name,r=t.getVariableValue(s);return r instanceof Ht?new k(r.textureSize,this.getTypeInfo("vec2u")):(console.error(`Texture ${s} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,t){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,t){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,t){const i=e.args[0],s=this.exec.evalExpression(e.args[1],t);if((e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0)>0)return console.error(`TODO: Mip levels. Line ${e.line}`),null;if(!(s instanceof k)||s.value.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(i instanceof cs){const r=i.name,o=t.getVariableValue(r);if(o instanceof Ht){const a=o.textureSize,l=Math.floor(s.value[0]),f=Math.floor(s.value[1]);if(l<0||l>=a[0]||f<0||f>=a[1])return console.error(`Texture ${r} out of bounds. Line ${e.line}`),null;const g=4*(f*a[0]+l),_=new Uint8Array(o.buffer,g,4);return new k([_[0]/255,_[1]/255,_[2]/255,_[3]/255],this.getTypeInfo("vec4f"))}return console.error(`Texture ${r} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,t){return console.error("TODO: textureNumLayers"),null}TextureNumLevels(e,t){return console.error("TODO: textureNumLevels"),null}TextureNumSamples(e,t){return console.error("TODO: textureNumSamples"),null}TextureSample(e,t){return console.error("TODO: textureSample"),null}TextureSampleBias(e,t){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,t){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,t){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,t){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,t){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,t){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,t){const i=e.args[0],s=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t).value;if(r.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(s instanceof k)||s.value.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(i instanceof cs){const o=i.name,a=t.getVariableValue(o);if(a instanceof Ht){const l=a.textureSize,f=Math.floor(s.value[0]),g=Math.floor(s.value[1]);if(f<0||f>=l[0]||g<0||g>=l[1])return console.error(`Texture ${o} out of bounds. Line ${e.line}`),null;const _=4*(g*l[0]+f),v=new Uint8Array(a.buffer,_,4);return v[0]=255*r[0],v[1]=255*r[1],v[2]=255*r[2],v[3]=255*r[3],null}return console.error(`Texture ${o} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,t){let i=e.args[0];i instanceof Nn&&(i=i.right);const s=this.exec.getVariableName(i,t);return t.getVariable(s).value.getDataValue(this.exec,i.postfix,t)}AtomicStore(e,t){let i=e.args[0];i instanceof Nn&&(i=i.right);const s=this.exec.getVariableName(i,t),r=t.getVariable(s);let o=e.args[1];const a=this.exec.evalExpression(o,t),l=r.value.getDataValue(this.exec,i.postfix,t);return l instanceof ne&&a instanceof ne&&(l.value=a.value),r.value instanceof Ht&&r.value.setDataValue(this.exec,l,i.postfix,t),null}AtomicAdd(e,t){let i=e.args[0];i instanceof Nn&&(i=i.right);const s=this.exec.getVariableName(i,t),r=t.getVariable(s);let o=e.args[1];const a=this.exec.evalExpression(o,t),l=r.value.getDataValue(this.exec,i.postfix,t);return l instanceof ne&&a instanceof ne&&(l.value+=a.value),r.value instanceof Ht&&r.value.setDataValue(this.exec,l,i.postfix,t),null}AtomicSub(e,t){let i=e.args[0];i instanceof Nn&&(i=i.right);const s=this.exec.getVariableName(i,t),r=t.getVariable(s);let o=e.args[1];const a=this.exec.evalExpression(o,t),l=r.value.getDataValue(this.exec,i.postfix,t);return l instanceof ne&&a instanceof ne&&(l.value-=a.value),r.value instanceof Ht&&r.value.setDataValue(this.exec,l,i.postfix,t),null}AtomicMax(e,t){let i=e.args[0];i instanceof Nn&&(i=i.right);const s=this.exec.getVariableName(i,t),r=t.getVariable(s);let o=e.args[1];const a=this.exec.evalExpression(o,t),l=r.value.getDataValue(this.exec,i.postfix,t),f=new ne(l.value,l.typeInfo);return l instanceof ne&&a instanceof ne&&(l.value=Math.max(l.value,a.value)),r.value instanceof Ht&&r.value.setDataValue(this.exec,l,i.postfix,t),f}AtomicMin(e,t){let i=e.args[0];i instanceof Nn&&(i=i.right);const s=this.exec.getVariableName(i,t),r=t.getVariable(s);let o=e.args[1];const a=this.exec.evalExpression(o,t),l=r.value.getDataValue(this.exec,i.postfix,t),f=new ne(l.value,l.typeInfo);return l instanceof ne&&a instanceof ne&&(l.value=Math.min(l.value,a.value)),r.value instanceof Ht&&r.value.setDataValue(this.exec,l,i.postfix,t),f}AtomicAnd(e,t){let i=e.args[0];i instanceof Nn&&(i=i.right);const s=this.exec.getVariableName(i,t),r=t.getVariable(s);let o=e.args[1];const a=this.exec.evalExpression(o,t),l=r.value.getDataValue(this.exec,i.postfix,t),f=new ne(l.value,l.typeInfo);return l instanceof ne&&a instanceof ne&&(l.value=l.value&a.value),r.value instanceof Ht&&r.value.setDataValue(this.exec,l,i.postfix,t),f}AtomicOr(e,t){let i=e.args[0];i instanceof Nn&&(i=i.right);const s=this.exec.getVariableName(i,t),r=t.getVariable(s);let o=e.args[1];const a=this.exec.evalExpression(o,t),l=r.value.getDataValue(this.exec,i.postfix,t),f=new ne(l.value,l.typeInfo);return l instanceof ne&&a instanceof ne&&(l.value=l.value|a.value),r.value instanceof Ht&&r.value.setDataValue(this.exec,l,i.postfix,t),f}AtomicXor(e,t){let i=e.args[0];i instanceof Nn&&(i=i.right);const s=this.exec.getVariableName(i,t),r=t.getVariable(s);let o=e.args[1];const a=this.exec.evalExpression(o,t),l=r.value.getDataValue(this.exec,i.postfix,t),f=new ne(l.value,l.typeInfo);return l instanceof ne&&a instanceof ne&&(l.value=l.value^a.value),r.value instanceof Ht&&r.value.setDataValue(this.exec,l,i.postfix,t),f}AtomicExchange(e,t){let i=e.args[0];i instanceof Nn&&(i=i.right);const s=this.exec.getVariableName(i,t),r=t.getVariable(s);let o=e.args[1];const a=this.exec.evalExpression(o,t),l=r.value.getDataValue(this.exec,i.postfix,t),f=new ne(l.value,l.typeInfo);return l instanceof ne&&a instanceof ne&&(l.value=a.value),r.value instanceof Ht&&r.value.setDataValue(this.exec,l,i.postfix,t),f}AtomicCompareExchangeWeak(e,t){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,t){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,t){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,t){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,t){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,t){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,t){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,t){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,t){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,t){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,t){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,t){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,t){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,t){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,t){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,t){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,t){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,t){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,t){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,t){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,t){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,t){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,t){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,t){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,t){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,t){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,t){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,t){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,t){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,t){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,t){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,t){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,t){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,t){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,t){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,t){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,t){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,t){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,t){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,t){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,t){return console.error("TODO: quadSwapY"),null}}function Oe(n){return Array.isArray(n)||(n==null?void 0:n.buffer)instanceof ArrayBuffer}const tc=new Float32Array(1),mR=new Uint32Array(tc.buffer),_R=new Uint32Array(tc.buffer),nc=new Int32Array(1),yR=new Float32Array(nc.buffer),bR=new Uint32Array(nc.buffer),ic=new Uint32Array(1),vR=new Float32Array(ic.buffer),TR=new Int32Array(ic.buffer);function Mg(n,e,t){if(e===t)return n;if(e==="f32"){if(t==="i32"||t==="x32")return tc[0]=n,mR[0];if(t==="u32")return tc[0]=n,_R[0]}else if(e==="i32"||e==="x32"){if(t==="f32")return nc[0]=n,yR[0];if(t==="u32")return nc[0]=n,bR[0]}else if(e==="u32"){if(t==="f32")return ic[0]=n,vR[0];if(t==="i32"||t==="x32")return ic[0]=n,TR[0]}return console.error(`Unsupported cast from ${e} to ${t}`),n}class _n extends gR{constructor(e,t){var i;super(),this.ast=e??[],this.reflection=new Ei,this.reflection.updateAST(this.ast),this.context=(i=t==null?void 0:t.clone())!==null&&i!==void 0?i:new Uf,this.builtins=new pR(this),this.typeInfo={bool:this.getTypeInfo(be.bool),i32:this.getTypeInfo(be.i32),u32:this.getTypeInfo(be.u32),f32:this.getTypeInfo(be.f32),f16:this.getTypeInfo(be.f16),vec2f:this.getTypeInfo(de.vec2f),vec2u:this.getTypeInfo(de.vec2u),vec2i:this.getTypeInfo(de.vec2i),vec2h:this.getTypeInfo(de.vec2h),vec3f:this.getTypeInfo(de.vec3f),vec3u:this.getTypeInfo(de.vec3u),vec3i:this.getTypeInfo(de.vec3i),vec3h:this.getTypeInfo(de.vec3h),vec4f:this.getTypeInfo(de.vec4f),vec4u:this.getTypeInfo(de.vec4u),vec4i:this.getTypeInfo(de.vec4i),vec4h:this.getTypeInfo(de.vec4h),mat2x2f:this.getTypeInfo(de.mat2x2f),mat2x3f:this.getTypeInfo(de.mat2x3f),mat2x4f:this.getTypeInfo(de.mat2x4f),mat3x2f:this.getTypeInfo(de.mat3x2f),mat3x3f:this.getTypeInfo(de.mat3x3f),mat3x4f:this.getTypeInfo(de.mat3x4f),mat4x2f:this.getTypeInfo(de.mat4x2f),mat4x3f:this.getTypeInfo(de.mat4x3f),mat4x4f:this.getTypeInfo(de.mat4x4f)}}getVariableValue(e){var t,i;const s=(i=(t=this.context.getVariable(e))===null||t===void 0?void 0:t.value)!==null&&i!==void 0?i:null;return s===null?null:s instanceof ne||s instanceof k||s instanceof gt?s.value:(console.error(`Unsupported return variable type ${s.typeInfo.name}`),null)}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,i,s){const r=this.context.clone();(s=s??{}).constants&&this._setOverrides(s.constants,r),this._execStatements(this.ast,r);const o=r.getFunction(e);if(!o)return void console.error(`Function ${e} not found`);if(typeof t=="number")t=[t,1,1];else{if(t.length===0)return void console.error("Invalid dispatch count");t.length===1?t=[t[0],1,1]:t.length===2?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}const a=t[0],l=t[1],f=t[2],g=this.getTypeInfo("vec3u");r.setVariable("@num_workgroups",new k(t,g));for(const _ in i)for(const v in i[_]){const T=i[_][v];r.variables.forEach(C=>{const S=C.node;if(S!=null&&S.attributes){let R=null,P=null;for(const F of S.attributes)F.name==="binding"?R=F.value:F.name==="group"&&(P=F.value);v==R&&_==P&&(T.texture!==void 0&&T.size!==void 0?C.value=new Ht(T.texture,this.getTypeInfo(S.type),0,T.size):T.uniform!==void 0?C.value=new Ht(T.uniform,this.getTypeInfo(S.type)):C.value=new Ht(T,this.getTypeInfo(S.type)))}})}for(let _=0;_<f;++_)for(let v=0;v<l;++v)for(let T=0;T<a;++T)r.setVariable("@workgroup_id",new k([T,v,_],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(o,[T,v,_],r)}execStatement(e,t){if(e instanceof iy)return this.evalExpression(e.value,t);if(e instanceof ry){if(e.condition){const i=this.evalExpression(e.condition,t);if(!(i instanceof ne))throw new Error("Invalid break-if condition");if(!i.value)return null}return _n._breakObj}if(e instanceof oy)return _n._continueObj;if(e instanceof ec)this._let(e,t);else if(e instanceof ns)this._var(e,t);else if(e instanceof Sh)this._const(e,t);else if(e instanceof Zl)this._function(e,t);else{if(e instanceof ny)return this._if(e,t);if(e instanceof ty)return this._switch(e,t);if(e instanceof q1)return this._for(e,t);if(e instanceof K1)return this._while(e,t);if(e instanceof ey)return this._loop(e,t);if(e instanceof Ch){const i=t.clone();return i.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,i)}if(e instanceof Z1)this._assign(e,t);else if(e instanceof J1)this._increment(e,t);else{if(e instanceof Zi)return null;if(e instanceof Df){const i=e.name;t.getVariable(i)===null&&t.setVariable(i,new ne(0,this.getTypeInfo("u32")))}else if(e instanceof Nf)this._call(e,t);else{if(e instanceof sy||e instanceof Ff)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,t){for(;e instanceof bl;)e=e.contents[0];return e instanceof ei?this._evalBinaryOp(e,t):e instanceof zt?this._evalLiteral(e,t):e instanceof cs?this._evalVariable(e,t):e instanceof ro?this._evalCall(e,t):e instanceof ks?this._evalCreate(e,t):e instanceof ly?this._evalConst(e,t):e instanceof cy?this._evalBitcast(e,t):e instanceof Nn?this._evalUnaryOp(e,t):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var t;if(e instanceof be){const s=this.reflection.getTypeInfo(e);if(s!==null)return s}const i=(t=this.typeInfo[e])!==null&&t!==void 0?t:null;return i!==null?i:null}getTypeName(e){if(e===null)return console.error("Type is null."),"unknown";let t=e.name;if(e instanceof us||e instanceof de){if(e.format!==null){if(t==="vec2"||t==="vec3"||t==="vec4"||t==="mat2x2"||t==="mat2x3"||t==="mat2x4"||t==="mat3x2"||t==="mat3x3"||t==="mat3x4"||t==="mat4x2"||t==="mat4x3"||t==="mat4x4"){if(e.format.name==="f32")return t+="f",t;if(e.format.name==="i32")return t+="i",t;if(e.format.name==="u32")return t+="u",t;if(e.format.name==="bool")return t+="b",t;if(e.format.name==="f16")return t+="h",t}t+=`<${e.format.name}>`}else if(t==="vec2"||t==="vec3"||t==="vec4")return t}return t}_setOverrides(e,t){for(const i in e){const s=e[i],r=this.reflection.getOverrideInfo(i);r!==null?r.type.name==="u32"||r.type.name==="i32"||r.type.name==="f32"||r.type.name==="f16"?t.setVariable(i,new ne(s,r.type)):r.type.name==="bool"?t.setVariable(i,new ne(s?1:0,r.type)):r.type.name==="vec2"||r.type.name==="vec3"||r.type.name==="vec4"||r.type.name==="vec2f"||r.type.name==="vec3f"||r.type.name==="vec4f"||r.type.name==="vec2i"||r.type.name==="vec3i"||r.type.name==="vec4i"||r.type.name==="vec2u"||r.type.name==="vec3u"||r.type.name==="vec4u"||r.type.name==="vec2h"||r.type.name==="vec3h"||r.type.name==="vec4h"?t.setVariable(i,new k(s,r.type)):console.error(`Invalid constant type for ${i}`):console.error(`Override ${i} does not exist in the shader.`)}}_dispatchWorkgroup(e,t,i){const s=[1,1,1];for(const g of e.node.attributes)if(g.name==="workgroup_size"){if(g.value.length>0){const _=i.getVariableValue(g.value[0]);s[0]=_ instanceof ne?_.value:parseInt(g.value[0])}if(g.value.length>1){const _=i.getVariableValue(g.value[1]);s[1]=_ instanceof ne?_.value:parseInt(g.value[1])}if(g.value.length>2){const _=i.getVariableValue(g.value[2]);s[2]=_ instanceof ne?_.value:parseInt(g.value[2])}}const r=this.getTypeInfo("vec3u"),o=this.getTypeInfo("u32");i.setVariable("@workgroup_size",new k(s,r));const a=s[0],l=s[1],f=s[2];for(let g=0,_=0;g<f;++g)for(let v=0;v<l;++v)for(let T=0;T<a;++T,++_){const C=[T,v,g],S=[T+t[0]*s[0],v+t[1]*s[1],g+t[2]*s[2]];i.setVariable("@local_invocation_id",new k(C,r)),i.setVariable("@global_invocation_id",new k(S,r)),i.setVariable("@local_invocation_index",new ne(_,o)),this._dispatchExec(e,i)}}_dispatchExec(e,t){for(const i of e.node.args)for(const s of i.attributes)if(s.name==="builtin"){const r=`@${s.value}`,o=t.getVariable(r);o!==void 0&&t.variables.set(i.name,o)}this._execStatements(e.node.body,t)}getVariableName(e,t){return e instanceof cs?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,t){for(const i of e){if(i instanceof Array){const r=t.clone(),o=this._execStatements(i,r);if(o)return o;continue}const s=this.execStatement(i,t);if(s)return s}return null}_call(e,t){const i=t.clone();i.currentFunctionName=e.name;const s=t.getFunction(e.name);if(s){for(let r=0;r<s.node.args.length;++r){const o=s.node.args[r],a=this.evalExpression(e.args[r],i);i.setVariable(o.name,a,o)}this._execStatements(s.node.body,i)}else this._callBuiltinFunction(e,i)}_increment(e,t){const i=this.getVariableName(e.variable,t),s=t.getVariable(i);s?e.operator==="++"?s.value instanceof ne?s.value.value++:console.error(`Variable ${i} is not a scalar. Line ${e.line}`):e.operator==="--"?s.value instanceof ne?s.value.value--:console.error(`Variable ${i} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${i} not found. Line ${e.line}`)}_assign(e,t){const i=this.getVariableName(e.variable,t),s=t.getVariable(i);if(s===null)return void console.error(`Variable ${i} not found. Line ${e.line}`);const r=this.evalExpression(e.value,t),o=e.operator;if(o==="=")if(s.value instanceof Ht)s.value.setDataValue(this,r,e.variable.postfix,t);else if(e.variable.postfix){if(!(s.value instanceof k||s.value instanceof gt))return void console.error(`Variable ${s.name} is not a vector or matrix. Line ${e.line}`);if(e.variable.postfix instanceof $r){const a=this.evalExpression(e.variable.postfix.index,t).value;if(s.value instanceof k){if(!(r instanceof ne))return void console.error(`Invalid assignment to ${s.name}. Line ${e.line}`);s.value.value[a]=r.value}else{if(!(s.value instanceof gt))return void console.error(`Invalid assignment to ${s.name}. Line ${e.line}`);{const l=this.evalExpression(e.variable.postfix.index,t).value;if(l<0)return void console.error(`Invalid assignment to ${s.name}. Line ${e.line}`);if(!(r instanceof k))return void console.error(`Invalid assignment to ${s.name}. Line ${e.line}`);{const f=this.getTypeName(s.value.typeInfo);if(f==="mat2x2"||f==="mat2x2f"||f==="mat2x2h"){if(!(l<2&&r.value.length===2))return void console.error(`Invalid assignment to ${s.name}. Line ${e.line}`);s.value.value[2*l]=r.value[0],s.value.value[2*l+1]=r.value[1]}else if(f==="mat2x3"||f==="mat2x3f"||f==="mat2x3h"){if(!(l<2&&r.value.length===3))return void console.error(`Invalid assignment to ${s.name}. Line ${e.line}`);s.value.value[3*l]=r.value[0],s.value.value[3*l+1]=r.value[1],s.value.value[3*l+2]=r.value[2]}else if(f==="mat2x4"||f==="mat2x4f"||f==="mat2x4h"){if(!(l<2&&r.value.length===4))return void console.error(`Invalid assignment to ${s.name}. Line ${e.line}`);s.value.value[4*l]=r.value[0],s.value.value[4*l+1]=r.value[1],s.value.value[4*l+2]=r.value[2],s.value.value[4*l+3]=r.value[3]}else if(f==="mat3x2"||f==="mat3x2f"||f==="mat3x2h"){if(!(l<3&&r.value.length===2))return void console.error(`Invalid assignment to ${s.name}. Line ${e.line}`);s.value.value[2*l]=r.value[0],s.value.value[2*l+1]=r.value[1]}else if(f==="mat3x3"||f==="mat3x3f"||f==="mat3x3h"){if(!(l<3&&r.value.length===3))return void console.error(`Invalid assignment to ${s.name}. Line ${e.line}`);s.value.value[3*l]=r.value[0],s.value.value[3*l+1]=r.value[1],s.value.value[3*l+2]=r.value[2]}else if(f==="mat3x4"||f==="mat3x4f"||f==="mat3x4h"){if(!(l<3&&r.value.length===4))return void console.error(`Invalid assignment to ${s.name}. Line ${e.line}`);s.value.value[4*l]=r.value[0],s.value.value[4*l+1]=r.value[1],s.value.value[4*l+2]=r.value[2],s.value.value[4*l+3]=r.value[3]}else if(f==="mat4x2"||f==="mat4x2f"||f==="mat4x2h"){if(!(l<4&&r.value.length===2))return void console.error(`Invalid assignment to ${s.name}. Line ${e.line}`);s.value.value[2*l]=r.value[0],s.value.value[2*l+1]=r.value[1]}else if(f==="mat4x3"||f==="mat4x3f"||f==="mat4x3h"){if(!(l<4&&r.value.length===3))return void console.error(`Invalid assignment to ${s.name}. Line ${e.line}`);s.value.value[3*l]=r.value[0],s.value.value[3*l+1]=r.value[1],s.value.value[3*l+2]=r.value[2]}else{if(f!=="mat4x4"&&f!=="mat4x4f"&&f!=="mat4x4h")return void console.error(`Invalid assignment to ${s.name}. Line ${e.line}`);if(!(l<4&&r.value.length===4))return void console.error(`Invalid assignment to ${s.name}. Line ${e.line}`);s.value.value[4*l]=r.value[0],s.value.value[4*l+1]=r.value[1],s.value.value[4*l+2]=r.value[2],s.value.value[4*l+3]=r.value[3]}}}}}else if(e.variable.postfix instanceof Hs){const a=e.variable.postfix.value;if(!(s.value instanceof k))return void console.error(`Invalid assignment to ${a}. Variable ${s.name} is not a vector. Line ${e.line}`);if(r instanceof ne){if(a.length>1)return void console.error(`Invalid assignment to ${a} for variable ${s.name}. Line ${e.line}`);if(a==="x")s.value.value[0]=r.value;else if(a==="y"){if(s.value.value.length<2)return void console.error(`Invalid assignment to ${a} for variable ${s.name}. Line ${e.line}`);s.value.value[1]=r.value}else if(a==="z"){if(s.value.value.length<3)return void console.error(`Invalid assignment to ${a} for variable ${s.name}. Line ${e.line}`);s.value.value[2]=r.value}else if(a==="w"){if(s.value.value.length<4)return void console.error(`Invalid assignment to ${a} for variable ${s.name}. Line ${e.line}`);s.value.value[3]=r.value}}else{if(!(r instanceof k))return void console.error(`Invalid assignment to ${s.name}. Line ${e.line}`);if(a.length!==r.value.length)return void console.error(`Invalid assignment to ${a} for variable ${s.name}. Line ${e.line}`);for(let l=0;l<a.length;++l){const f=a[l];if(f==="x"||f==="r")s.value.value[0]=r.value[l];else if(f==="y"||f==="g"){if(r.value.length<2)return void console.error(`Invalid assignment to ${f} for variable ${s.name}. Line ${e.line}`);s.value.value[1]=r.value[l]}else if(f==="z"||f==="b"){if(r.value.length<3)return void console.error(`Invalid assignment to ${f} for variable ${s.name}. Line ${e.line}`);s.value.value[2]=r.value[l]}else{if(f!=="w"&&f!=="a")return void console.error(`Invalid assignment to ${f} for variable ${s.name}. Line ${e.line}`);if(r.value.length<4)return void console.error(`Invalid assignment to ${f} for variable ${s.name}. Line ${e.line}`);s.value.value[3]=r.value[l]}}}}}else s.value=r;else{const a=s.value.getDataValue(this,e.variable.postfix,t);if(a instanceof k&&r instanceof ne){const l=a.value,f=r.value;if(o==="+=")for(let g=0;g<l.length;++g)l[g]+=f;else if(o==="-=")for(let g=0;g<l.length;++g)l[g]-=f;else if(o==="*=")for(let g=0;g<l.length;++g)l[g]*=f;else if(o==="/=")for(let g=0;g<l.length;++g)l[g]/=f;else if(o==="%=")for(let g=0;g<l.length;++g)l[g]%=f;else if(o==="&=")for(let g=0;g<l.length;++g)l[g]&=f;else if(o==="|=")for(let g=0;g<l.length;++g)l[g]|=f;else if(o==="^=")for(let g=0;g<l.length;++g)l[g]^=f;else if(o==="<<=")for(let g=0;g<l.length;++g)l[g]<<=f;else if(o===">>=")for(let g=0;g<l.length;++g)l[g]>>=f;else console.error(`Invalid operator ${o}. Line ${e.line}`)}else if(a instanceof k&&r instanceof k){const l=a.value,f=r.value;if(l.length!==f.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(o==="+=")for(let g=0;g<l.length;++g)l[g]+=f[g];else if(o==="-=")for(let g=0;g<l.length;++g)l[g]-=f[g];else if(o==="*=")for(let g=0;g<l.length;++g)l[g]*=f[g];else if(o==="/=")for(let g=0;g<l.length;++g)l[g]/=f[g];else if(o==="%=")for(let g=0;g<l.length;++g)l[g]%=f[g];else if(o==="&=")for(let g=0;g<l.length;++g)l[g]&=f[g];else if(o==="|=")for(let g=0;g<l.length;++g)l[g]|=f[g];else if(o==="^=")for(let g=0;g<l.length;++g)l[g]^=f[g];else if(o==="<<=")for(let g=0;g<l.length;++g)l[g]<<=f[g];else if(o===">>=")for(let g=0;g<l.length;++g)l[g]>>=f[g];else console.error(`Invalid operator ${o}. Line ${e.line}`)}else{if(!(a instanceof ne&&r instanceof ne))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);o==="+="?a.value+=r.value:o==="-="?a.value-=r.value:o==="*="?a.value*=r.value:o==="/="?a.value/=r.value:o==="%="?a.value%=r.value:o==="&="?a.value&=r.value:o==="|="?a.value|=r.value:o==="^="?a.value^=r.value:o==="<<="?a.value<<=r.value:o===">>="?a.value>>=r.value:console.error(`Invalid operator ${o}. Line ${e.line}`)}s.value instanceof Ht&&s.value.setDataValue(this,a,e.variable.postfix,t)}}_function(e,t){const i=new kf(e);t.functions.set(e.name,i)}_const(e,t){let i=null;e.value!=null&&(i=this.evalExpression(e.value,t)),t.createVariable(e.name,i,e)}_let(e,t){let i=null;e.value!=null&&(i=this.evalExpression(e.value,t)),t.createVariable(e.name,i,e)}_var(e,t){let i=null;if(e.value!==null)i=this.evalExpression(e.value,t);else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);if(e.type.name==="f32"||e.type.name==="i32"||e.type.name==="u32"||e.type.name==="bool"||e.type.name==="f16"||e.type.name==="vec2"||e.type.name==="vec3"||e.type.name==="vec4"||e.type.name==="vec2f"||e.type.name==="vec3f"||e.type.name==="vec4f"||e.type.name==="vec2i"||e.type.name==="vec3i"||e.type.name==="vec4i"||e.type.name==="vec2u"||e.type.name==="vec3u"||e.type.name==="vec4u"||e.type.name==="vec2h"||e.type.name==="vec3h"||e.type.name==="vec4h"||e.type.name==="mat2x2"||e.type.name==="mat2x3"||e.type.name==="mat2x4"||e.type.name==="mat3x2"||e.type.name==="mat3x3"||e.type.name==="mat3x4"||e.type.name==="mat4x2"||e.type.name==="mat4x3"||e.type.name==="mat4x4"||e.type.name==="mat2x2f"||e.type.name==="mat2x3f"||e.type.name==="mat2x4f"||e.type.name==="mat3x2f"||e.type.name==="mat3x3f"||e.type.name==="mat3x4f"||e.type.name==="mat4x2f"||e.type.name==="mat4x3f"||e.type.name==="mat4x4f"||e.type.name==="mat2x2h"||e.type.name==="mat2x3h"||e.type.name==="mat2x4h"||e.type.name==="mat3x2h"||e.type.name==="mat3x3h"||e.type.name==="mat3x4h"||e.type.name==="mat4x2h"||e.type.name==="mat4x3h"||e.type.name==="mat4x4h"){const s=new ks(e.type,[]);i=this._evalCreate(s,t)}if(e.type.name==="array"){const s=new ks(e.type,[]);i=this._evalCreate(s,t)}}t.createVariable(e.name,i,e)}_switch(e,t){t=t.clone();const i=this.evalExpression(e.condition,t);if(!(i instanceof ne))return console.error(`Invalid if condition. Line ${e.line}`),null;let s=null;for(const r of e.cases)if(r instanceof hy)for(const o of r.selectors){if(o instanceof vl){s=r;continue}const a=this.evalExpression(o,t);if(!(a instanceof ne))return console.error(`Invalid case selector. Line ${e.line}`),null;if(a.value===i.value)return this._execStatements(r.body,t)}else r instanceof fy&&(s=r);return s?this._execStatements(s.body,t):null}_if(e,t){t=t.clone();const i=this.evalExpression(e.condition,t);if(!(i instanceof ne))return console.error(`Invalid if condition. Line ${e.line}`),null;if(i.value)return this._execStatements(e.body,t);for(const s of e.elseif){const r=this.evalExpression(s.condition,t);if(!(r instanceof ne))return console.error(`Invalid if condition. Line ${e.line}`),null;if(r.value)return this._execStatements(s.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof ne?e.value:(console.error("Expected scalar value.",e),0)}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){const i=this._execStatements(e.body,t);if(i===_n._breakObj)break;if(i!==null&&i!==_n._continueObj)return i;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){const i=this._execStatements(e.body,t);if(i===_n._breakObj)break;if(i===_n._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===_n._breakObj)break}else if(i!==null)return i}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){const i=this._execStatements(e.body,t);if(i===_n._breakObj)break;if(i!==_n._continueObj&&i!==null)return i}return null}_evalBitcast(e,t){const i=this.evalExpression(e.value,t),s=e.type;if(i instanceof ne){const r=Mg(i.value,i.typeInfo.name,s.name);return new ne(r,this.getTypeInfo(s))}if(i instanceof k){const r=this.getTypeName(i.typeInfo);let o="";if(r.endsWith("f"))o="f32";else if(r.endsWith("i"))o="i32";else if(r.endsWith("u"))o="u32";else if(r.endsWith("b"))o="bool";else{if(!r.endsWith("h"))return console.error(`Unknown vector type ${r}. Line ${e.line}`),null;o="f16"}const a=this.getTypeName(s);let l="";if(a.endsWith("f"))l="f32";else if(a.endsWith("i"))l="i32";else if(a.endsWith("u"))l="u32";else if(a.endsWith("b"))l="bool";else{if(!a.endsWith("h"))return console.error(`Unknown vector type ${l}. Line ${e.line}`),null;l="f16"}const f=function(g,_,v){if(_===v)return g;const T=new Array(g.length);for(let C=0;C<g.length;C++)T[C]=Mg(g[C],_,v);return T}(i.value,o,l);return new k(f,this.getTypeInfo(s))}return console.error(`TODO: bitcast for ${i.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,t){const i=t.getVariableValue(e.name);return e.postfix?i.getDataValue(this,e.postfix,t):i}_evalCreate(e,t){var i;if(e.type===null)return Ih.void;const s=this.getTypeName(e.type);switch(s){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}const r=this.getTypeInfo(e.type);if(r===null)return console.error(`Unknown type ${s}. Line ${e.line}`),null;if(r.size===0)return null;const o=new Ht(new ArrayBuffer(r.size),r,0);if(r instanceof is){if(e.args)for(let a=0;a<e.args.length;++a){const l=r.members[a],f=e.args[a],g=this.evalExpression(f,t);o.setData(this,g,l.type,l.offset,t)}}else if(r instanceof Ls){let a=0;if(e.args)for(let l=0;l<e.args.length;++l){const f=e.args[l],g=this.evalExpression(f,t);r.format===null&&(((i=g.typeInfo)===null||i===void 0?void 0:i.name)==="x32"?r.format=this.getTypeInfo("i32"):r.format=g.typeInfo),o.setData(this,g,r.format,a,t),a+=r.stride}}else console.error(`Unknown type "${s}". Line ${e.line}`);return o}_evalLiteral(e,t){const i=this.getTypeInfo(e.type),s=i.name;return s==="x32"||s==="u32"||s==="f32"||s==="f16"||s==="i32"||s==="bool"?new ne(e.scalarValue,i):s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"?this._callConstructorVec(e,t):s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){const i=t.getVariableValue(e.name);return i===null?i:e!=null&&e.postfix?i.getDataValue(this,e.postfix,t):i}_maxFormatTypeInfo(e){let t=e[0];if(t.name==="f32")return t;for(let i=1;i<e.length;++i){const s=_n._priority.get(t.name);_n._priority.get(e[i].name)<s&&(t=e[i])}return t.name==="x32"?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){const i=this.evalExpression(e.right,t),s=i instanceof ne||i instanceof k?i.value:null;switch(e.operator){case"+":{if(Oe(s)){const a=s.map((l,f)=>+l);return new k(a,i.typeInfo)}const r=s,o=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new ne(+r,o)}case"-":{if(Oe(s)){const a=s.map((l,f)=>-l);return new k(a,i.typeInfo)}const r=s,o=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new ne(-r,o)}case"!":{if(Oe(s)){const a=s.map((l,f)=>l?0:1);return new k(a,i.typeInfo)}const r=s,o=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new ne(r?0:1,o)}case"~":{if(Oe(s)){const a=s.map((l,f)=>~l);return new k(a,i.typeInfo)}const r=s,o=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new ne(~r,o)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,t){const i=this.evalExpression(e.left,t),s=this.evalExpression(e.right,t),r=i instanceof ne||i instanceof k||i instanceof gt?i.value:null,o=s instanceof ne||s instanceof k||s instanceof gt?s.value:null;switch(e.operator){case"+":{if(Oe(r)&&Oe(o)){const g=r,_=o;if(g.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=g.map((T,C)=>T+_[C]);return new k(v,i.typeInfo)}if(Oe(r)){const g=o,_=r.map((v,T)=>v+g);return new k(_,i.typeInfo)}if(Oe(o)){const g=r,_=o.map((v,T)=>g+v);return new k(_,s.typeInfo)}const a=r,l=o,f=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new ne(a+l,f)}case"-":{if(Oe(r)&&Oe(o)){const g=r,_=o;if(g.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=g.map((T,C)=>T-_[C]);return new k(v,i.typeInfo)}if(Oe(r)){const g=o,_=r.map((v,T)=>v-g);return new k(_,i.typeInfo)}if(Oe(o)){const g=r,_=o.map((v,T)=>g-v);return new k(_,s.typeInfo)}const a=r,l=o,f=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new ne(a-l,f)}case"*":{if(Oe(r)&&Oe(o)){const g=r,_=o;if(g.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=g.map((T,C)=>T*_[C]);return new k(v,i.typeInfo)}if(Oe(r)){const g=o,_=r.map((v,T)=>v*g);return new k(_,i.typeInfo)}if(Oe(o)){const g=r,_=o.map((v,T)=>g*v);return new k(_,s.typeInfo)}const a=r,l=o,f=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new ne(a*l,f)}case"%":{if(Oe(r)&&Oe(o)){const g=r,_=o;if(g.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=g.map((T,C)=>T%_[C]);return new k(v,i.typeInfo)}if(Oe(r)){const g=o,_=r.map((v,T)=>v%g);return new k(_,i.typeInfo)}if(Oe(o)){const g=r,_=o.map((v,T)=>g%v);return new k(_,s.typeInfo)}const a=r,l=o,f=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new ne(a%l,f)}case"/":{if(Oe(r)&&Oe(o)){const g=r,_=o;if(g.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=g.map((T,C)=>T/_[C]);return new k(v,i.typeInfo)}if(Oe(r)){const g=o,_=r.map((v,T)=>v/g);return new k(_,i.typeInfo)}if(Oe(o)){const g=r,_=o.map((v,T)=>g/v);return new k(_,s.typeInfo)}const a=r,l=o,f=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new ne(a/l,f)}case"&":{if(Oe(r)&&Oe(o)){const g=r,_=o;if(g.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=g.map((T,C)=>T&_[C]);return new k(v,i.typeInfo)}if(Oe(r)){const g=o,_=r.map((v,T)=>v&g);return new k(_,i.typeInfo)}if(Oe(o)){const g=r,_=o.map((v,T)=>g&v);return new k(_,s.typeInfo)}const a=r,l=o,f=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new ne(a&l,f)}case"|":{if(Oe(r)&&Oe(o)){const g=r,_=o;if(g.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=g.map((T,C)=>T|_[C]);return new k(v,i.typeInfo)}if(Oe(r)){const g=o,_=r.map((v,T)=>v|g);return new k(_,i.typeInfo)}if(Oe(o)){const g=r,_=o.map((v,T)=>g|v);return new k(_,s.typeInfo)}const a=r,l=o,f=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new ne(a|l,f)}case"^":{if(Oe(r)&&Oe(o)){const g=r,_=o;if(g.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=g.map((T,C)=>T^_[C]);return new k(v,i.typeInfo)}if(Oe(r)){const g=o,_=r.map((v,T)=>v^g);return new k(_,i.typeInfo)}if(Oe(o)){const g=r,_=o.map((v,T)=>g^v);return new k(_,s.typeInfo)}const a=r,l=o,f=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new ne(a^l,f)}case"<<":{if(Oe(r)&&Oe(o)){const g=r,_=o;if(g.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=g.map((T,C)=>T<<_[C]);return new k(v,i.typeInfo)}if(Oe(r)){const g=o,_=r.map((v,T)=>v<<g);return new k(_,i.typeInfo)}if(Oe(o)){const g=r,_=o.map((v,T)=>g<<v);return new k(_,s.typeInfo)}const a=r,l=o,f=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new ne(a<<l,f)}case">>":{if(Oe(r)&&Oe(o)){const g=r,_=o;if(g.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=g.map((T,C)=>T>>_[C]);return new k(v,i.typeInfo)}if(Oe(r)){const g=o,_=r.map((v,T)=>v>>g);return new k(_,i.typeInfo)}if(Oe(o)){const g=r,_=o.map((v,T)=>g>>v);return new k(_,s.typeInfo)}const a=r,l=o,f=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new ne(a>>l,f)}case">":if(Oe(r)&&Oe(o)){const a=r,l=o;if(a.length!==l.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const f=a.map((g,_)=>g>l[_]?1:0);return new k(f,i.typeInfo)}if(Oe(r)){const a=o,l=r.map((f,g)=>f>a?1:0);return new k(l,i.typeInfo)}if(Oe(o)){const a=r,l=o.map((f,g)=>a>f?1:0);return new k(l,s.typeInfo)}return new ne(r>o?1:0,this.getTypeInfo("bool"));case"<":if(Oe(r)&&Oe(o)){const a=r,l=o;if(a.length!==l.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const f=a.map((g,_)=>g<l[_]?1:0);return new k(f,i.typeInfo)}if(Oe(r)){const a=o,l=r.map((f,g)=>f<a?1:0);return new k(l,i.typeInfo)}if(Oe(o)){const a=r,l=o.map((f,g)=>a<f?1:0);return new k(l,s.typeInfo)}return new ne(r<o?1:0,this.getTypeInfo("bool"));case"==":if(Oe(r)&&Oe(o)){const a=r,l=o;if(a.length!==l.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const f=a.map((g,_)=>g===l[_]?1:0);return new k(f,i.typeInfo)}if(Oe(r)){const a=o,l=r.map((f,g)=>f==a?1:0);return new k(l,i.typeInfo)}if(Oe(o)){const a=r,l=o.map((f,g)=>a==f?1:0);return new k(l,s.typeInfo)}return new ne(r===o?1:0,this.getTypeInfo("bool"));case"!=":if(Oe(r)&&Oe(o)){const a=r,l=o;if(a.length!==l.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const f=a.map((g,_)=>g!==l[_]?1:0);return new k(f,i.typeInfo)}if(Oe(r)){const a=o,l=r.map((f,g)=>f!==a?1:0);return new k(l,i.typeInfo)}if(Oe(o)){const a=r,l=o.map((f,g)=>a!==f?1:0);return new k(l,s.typeInfo)}return new ne(r!==o?1:0,this.getTypeInfo("bool"));case">=":if(Oe(r)&&Oe(o)){const a=r,l=o;if(a.length!==l.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const f=a.map((g,_)=>g>=l[_]?1:0);return new k(f,i.typeInfo)}if(Oe(r)){const a=o,l=r.map((f,g)=>f>=a?1:0);return new k(l,i.typeInfo)}if(Oe(o)){const a=r,l=o.map((f,g)=>a>=f?1:0);return new k(l,s.typeInfo)}return new ne(r>=o?1:0,this.getTypeInfo("bool"));case"<=":if(Oe(r)&&Oe(o)){const a=r,l=o;if(a.length!==l.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const f=a.map((g,_)=>g<=l[_]?1:0);return new k(f,i.typeInfo)}if(Oe(r)){const a=o,l=r.map((f,g)=>f<=a?1:0);return new k(l,i.typeInfo)}if(Oe(o)){const a=r,l=o.map((f,g)=>a<=f?1:0);return new k(l,s.typeInfo)}return new ne(r<=o?1:0,this.getTypeInfo("bool"));case"&&":if(Oe(r)&&Oe(o)){const a=r,l=o;if(a.length!==l.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const f=a.map((g,_)=>g&&l[_]?1:0);return new k(f,i.typeInfo)}if(Oe(r)){const a=o,l=r.map((f,g)=>f&&a?1:0);return new k(l,i.typeInfo)}if(Oe(o)){const a=r,l=o.map((f,g)=>a&&f?1:0);return new k(l,s.typeInfo)}return new ne(r&&o?1:0,this.getTypeInfo("bool"));case"||":if(Oe(r)&&Oe(o)){const a=r,l=o;if(a.length!==l.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const f=a.map((g,_)=>g||l[_]?1:0);return new k(f,i.typeInfo)}if(Oe(r)){const a=o,l=r.map((f,g)=>f||a?1:0);return new k(l,i.typeInfo)}if(Oe(o)){const a=r,l=o.map((f,g)=>a||f?1:0);return new k(l,s.typeInfo)}return new ne(r||o?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,t){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const i=t.clone();i.currentFunctionName=e.name;const s=t.getFunction(e.name);if(!s)return this._callBuiltinFunction(e,i);for(let r=0;r<s.node.args.length;++r){const o=s.node.args[r],a=this.evalExpression(e.args[r],i);i.createVariable(o.name,a,o)}return this._execStatements(s.node.body,i)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothStep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}const i=t.getFunction(e.name);if(i){const s=t.clone();for(let r=0;r<i.node.args.length;++r){const o=i.node.args[r],a=this.evalExpression(e.args[r],s);s.setVariable(o.name,a,o)}return this._execStatements(i.node.body,s)}return null}_callConstructorValue(e,t){if(!e.args||e.args.length===0)return new ne(0,this.getTypeInfo(e.type));const i=this.evalExpression(e.args[0],t);return i.typeInfo=this.getTypeInfo(e.type),i}_callConstructorVec(e,t){const i=this.getTypeInfo(e.type),s=this.getTypeName(e.type),r={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4}[s];if(r===void 0)return console.error(`Invalid vec constructor ${s}. Line ${e.line}`),null;const o=s.endsWith("i")||s.endsWith("u"),a=[];if(e instanceof zt)if(e.isVector){const l=e.vectorValue;for(const f of l)a.push(f)}else a.push(e.scalarValue);else if(e.args)for(const l of e.args){const f=this.evalExpression(l,t);if(f instanceof k){const g=f.value;for(let _=0;_<g.length;++_){let v=g[_];o&&(v=Math.floor(v)),a.push(v)}}else if(f instanceof ne){let g=f.value;o&&(g=Math.floor(g)),a.push(g)}}if(e.type instanceof de&&e.type.format===null&&(e.type.format=de.f32),a.length===0){const l=new Array(r).fill(0);return new k(l,i)}if(a.length===1)for(;a.length<r;)a.push(a[0]);return a.length<r?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new k(a.length>r?a.slice(0,r):a,i)}_callConstructorMatrix(e,t){const i=this.getTypeInfo(e.type),s=this.getTypeName(e.type),r={mat2x2:4,mat2x2f:4,mat2x2h:4,mat2x3:6,mat2x3f:6,mat2x3h:6,mat2x4:8,mat2x4f:8,mat2x4h:8,mat3x2:6,mat3x2f:6,mat3x2h:6,mat3x3:9,mat3x3f:9,mat3x3h:9,mat3x4:12,mat3x4f:12,mat3x4h:12,mat4x2:8,mat4x2f:8,mat4x2h:8,mat4x3:12,mat4x3f:12,mat4x3h:12,mat4x4:16,mat4x4f:16,mat4x4h:16}[s];if(r===void 0)return console.error(`Invalid matrix constructor ${s}. Line ${e.line}`),null;const o=[];if(e instanceof zt)if(e.isVector){const a=e.vectorValue;for(const l of a)o.push(l)}else o.push(e.scalarValue);else if(e.args)for(const a of e.args){const l=this.evalExpression(a,t);if(l instanceof k){const f=l.value;for(let g=0;g<f.length;++g)o.push(f[g])}else l instanceof ne?o.push(l.value):l instanceof gt&&o.push(...l.value)}if(i instanceof us&&i.format===null&&(i.format=this.getTypeInfo("f32")),o.length===0){const a=new Array(r).fill(0);return new gt(a,i)}return o.length!==r?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new gt(o,i)}}_n._breakObj=new Gs(new Ai("BREAK",null)),_n._continueObj=new Gs(new Ai("CONTINUE",null)),_n._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class wR{constructor(){this._tokens=[],this._current=0,this._currentLine=0,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new iR,this._exec=new _n}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const i=this._global_decl_or_directive();if(!i)break;t.push(i)}if(this._deferArrayCountEval.length>0){for(const i of this._deferArrayCountEval){const s=i.arrayType,r=i.countNode;if(r instanceof cs){const o=r.name,a=this._context.constants.get(o);if(a)try{const l=a.constEvaluate(this._exec);s.count=l}catch{}}}this._deferArrayCountEval.length=0}return t}_initialize(e){if(e)if(typeof e=="string"){const t=new fR(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=t??this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==D.eof}_match(e){if(e instanceof $)return!!this._check(e)&&(this._advance(),!0);for(let t=0,i=e.length;t<i;++t){const s=e[t];if(this._check(s))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const i=t.type;let s=!1;for(const r of e){if(i===r)return!0;r===D.tokens.name&&(s=!0)}if(s){const r=D.tokens.name.rule.exec(t.lexeme);if(r&&r.index==0&&r[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===D.tokens.name){const i=D.tokens.name.rule.exec(t.lexeme);return i&&i.index==0&&i[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=(t=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&t!==void 0?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(D.tokens.semicolon)&&!this._isAtEnd(););if(this._match(D.keywords.alias)){const t=this._type_alias();return this._consume(D.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(D.keywords.diagnostic)){const t=this._diagnostic();return this._consume(D.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(D.keywords.requires)){const t=this._requires_directive();return this._consume(D.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(D.keywords.enable)){const t=this._enable_directive();return this._consume(D.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}const e=this._attribute();if(this._check(D.keywords.var)){const t=this._global_variable_decl();return t!=null&&(t.attributes=e),this._consume(D.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(D.keywords.override)){const t=this._override_variable_decl();return t!=null&&(t.attributes=e),this._consume(D.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(D.keywords.let)){const t=this._global_let_decl();return t!=null&&(t.attributes=e),this._consume(D.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(D.keywords.const)){const t=this._global_const_decl();return t!=null&&(t.attributes=e),this._consume(D.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(D.keywords.struct)){const t=this._struct_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(D.keywords.fn)){const t=this._function_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(D.keywords.fn))return null;const e=this._currentLine,t=this._consume(D.tokens.ident,"Expected function name.").toString();this._consume(D.tokens.paren_left,"Expected '(' for function arguments.");const i=[];if(!this._check(D.tokens.paren_right))do{if(this._check(D.tokens.paren_right))break;const a=this._attribute(),l=this._consume(D.tokens.name,"Expected argument name.").toString();this._consume(D.tokens.colon,"Expected ':' for argument type.");const f=this._attribute(),g=this._type_decl();g!=null&&(g.attributes=f,i.push(this._updateNode(new cR(l,g,a))))}while(this._match(D.tokens.comma));this._consume(D.tokens.paren_right,"Expected ')' after function arguments.");let s=null;if(this._match(D.tokens.arrow)){const a=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=a)}const r=this._compound_statement(),o=this._currentLine;return this._updateNode(new Zl(t,i,s,r,e,o),e)}_compound_statement(){const e=[];for(this._consume(D.tokens.brace_left,"Expected '{' for block.");!this._check(D.tokens.brace_right);){const t=this._statement();t!==null&&e.push(t)}return this._consume(D.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(D.tokens.semicolon)&&!this._isAtEnd(););if(this._check(D.tokens.attr)&&this._attribute(),this._check(D.keywords.if))return this._if_statement();if(this._check(D.keywords.switch))return this._switch_statement();if(this._check(D.keywords.loop))return this._loop_statement();if(this._check(D.keywords.for))return this._for_statement();if(this._check(D.keywords.while))return this._while_statement();if(this._check(D.keywords.continuing))return this._continuing_statement();if(this._check(D.keywords.static_assert))return this._static_assert_statement();if(this._check(D.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(D.keywords.return))e=this._return_statement();else if(this._check([D.keywords.var,D.keywords.let,D.keywords.const]))e=this._variable_statement();else if(this._match(D.keywords.discard))e=this._updateNode(new aR);else if(this._match(D.keywords.break)){const t=this._updateNode(new ry);if(this._currentLoop.length>0){const i=this._currentLoop[this._currentLoop.length-1];t.loopId=i.id}e=t,this._check(D.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression(),t.condition instanceof bl&&t.condition.contents.length===1&&(t.condition=t.condition.contents[0]))}else if(this._match(D.keywords.continue)){const t=this._updateNode(new oy);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);{const i=this._currentLoop[this._currentLoop.length-1];t.loopId=i.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(D.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(D.keywords.static_assert))return null;const e=this._optional_paren_expression();return this._updateNode(new sR(e))}_while_statement(){if(!this._match(D.keywords.while))return null;const e=this._updateNode(new K1(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(D.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){if(!this._match(D.keywords.continuing))return null;const e=this._compound_statement();return this._updateNode(new Ch(e))}_for_statement(){if(!this._match(D.keywords.for))return null;this._consume(D.tokens.paren_left,"Expected '('.");const e=this._updateNode(new q1(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(D.tokens.semicolon)?null:this._for_init(),this._consume(D.tokens.semicolon,"Expected ';'."),e.condition=this._check(D.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(D.tokens.semicolon,"Expected ';'."),e.increment=this._check(D.tokens.paren_right)?null:this._for_increment(),this._consume(D.tokens.paren_right,"Expected ')'."),this._check(D.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(D.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(D.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new ns(e.name,e.type,e.storage,e.access,t))}if(this._match(D.keywords.let)){const e=this._consume(D.tokens.name,"Expected name for let.").toString();let t=null;if(this._match(D.tokens.colon)){const s=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=s)}this._consume(D.tokens.equal,"Expected '=' for let.");const i=this._short_circuit_or_expression();return this._updateNode(new ec(e,t,null,null,i))}if(this._match(D.keywords.const)){const e=this._consume(D.tokens.name,"Expected name for const.").toString();let t=null;if(this._match(D.tokens.colon)){const s=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=s)}this._consume(D.tokens.equal,"Expected '=' for const.");const i=this._short_circuit_or_expression();return t===null&&i instanceof zt&&(t=i.type),this._updateNode(new Sh(e,t,null,null,i))}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(t==null)return null;if(!this._check(D.increment_operators))return this._current=e,null;const i=this._consume(D.increment_operators,"Expected increment operator");return this._updateNode(new J1(i.type===D.tokens.plus_plus?Sr.increment:Sr.decrement,t))}_assignment_statement(){let e=null;if(this._check(D.tokens.brace_right))return null;let t=this._match(D.tokens.underscore);if(t||(e=this._unary_expression()),!t&&e==null)return null;const i=this._consume(D.assignment_operators,"Expected assignment operator."),s=this._short_circuit_or_expression();return this._updateNode(new Z1(Oo.parse(i.lexeme),e,s))}_func_call_statement(){if(!this._check(D.tokens.ident))return null;const e=this._current,t=this._consume(D.tokens.ident,"Expected function name."),i=this._argument_expression_list();return i===null?(this._current=e,null):this._updateNode(new Nf(t.lexeme,i))}_loop_statement(){if(!this._match(D.keywords.loop))return null;this._check(D.tokens.attr)&&this._attribute(),this._consume(D.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new ey([],null));this._currentLoop.push(e);let t=this._statement();for(;t!==null;){if(Array.isArray(t))for(let i of t)e.body.push(i);else e.body.push(t);if(t instanceof Ch){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(D.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(D.keywords.switch))return null;const e=this._updateNode(new ty(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(D.tokens.attr)&&this._attribute(),this._consume(D.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(D.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let t=!1;for(;this._check([D.keywords.default,D.keywords.case]);){if(this._match(D.keywords.case)){const i=this._case_selectors();for(const r of i)if(r instanceof vl){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(D.tokens.colon),this._check(D.tokens.attr)&&this._attribute(),this._consume(D.tokens.brace_left,"Exected '{' for switch case.");const s=this._case_body();this._consume(D.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new hy(i,s)))}if(this._match(D.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(D.tokens.colon),this._check(D.tokens.attr)&&this._attribute(),this._consume(D.tokens.brace_left,"Exected '{' for switch default.");const i=this._case_body();this._consume(D.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new fy(i)))}}return e}_case_selectors(){const e=[];for(this._match(D.keywords.default)?e.push(this._updateNode(new vl)):e.push(this._shift_expression());this._match(D.tokens.comma);)this._match(D.keywords.default)?e.push(this._updateNode(new vl)):e.push(this._shift_expression());return e}_case_body(){if(this._match(D.keywords.fallthrough))return this._consume(D.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const t=this._case_body();return t.length==0?e:[...e,t[0]]}_if_statement(){if(!this._match(D.keywords.if))return null;const e=this._currentLine,t=this._optional_paren_expression();this._check(D.tokens.attr)&&this._attribute();const i=this._compound_statement();let s=[];this._match_elseif()&&(this._check(D.tokens.attr)&&this._attribute(),s=this._elseif_statement(s));let r=null;return this._match(D.keywords.else)&&(this._check(D.tokens.attr)&&this._attribute(),r=this._compound_statement()),this._updateNode(new ny(t,i,s,r),e)}_match_elseif(){return this._tokens[this._current].type===D.keywords.else&&this._tokens[this._current+1].type===D.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const t=this._optional_paren_expression(),i=this._compound_statement();return e.push(this._updateNode(new AR(t,i))),this._match_elseif()&&(this._check(D.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(D.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new iy(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(D.tokens.or_or);)e=this._updateNode(new ei(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(D.tokens.and_and);)e=this._updateNode(new ei(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(D.tokens.or);)e=this._updateNode(new ei(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(D.tokens.xor);)e=this._updateNode(new ei(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(D.tokens.and);)e=this._updateNode(new ei(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([D.tokens.equal_equal,D.tokens.not_equal])?this._updateNode(new ei(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([D.tokens.less_than,D.tokens.greater_than,D.tokens.less_than_equal,D.tokens.greater_than_equal]);)e=this._updateNode(new ei(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([D.tokens.shift_left,D.tokens.shift_right]);)e=this._updateNode(new ei(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([D.tokens.plus,D.tokens.minus]);)e=this._updateNode(new ei(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([D.tokens.star,D.tokens.forward_slash,D.tokens.modulo]);)e=this._updateNode(new ei(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([D.tokens.minus,D.tokens.bang,D.tokens.tilde,D.tokens.star,D.tokens.and])?this._updateNode(new Nn(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(D.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(D.tokens.bracket_right,"Expected ']'.");const t=this._updateNode(new $r(e)),i=this._postfix_expression();return i&&(t.postfix=i),t}if(this._match(D.tokens.period)){const e=this._consume(D.tokens.name,"Expected member name."),t=this._postfix_expression(),i=this._updateNode(new Hs(e.lexeme));return t&&(i.postfix=t),i}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const t=this._getStruct(e);if(t!==null)return t;switch(e){case"bool":return be.bool;case"i32":return be.i32;case"u32":return be.u32;case"f32":return be.f32;case"f16":return be.f16;case"vec2f":return de.vec2f;case"vec3f":return de.vec3f;case"vec4f":return de.vec4f;case"vec2i":return de.vec2i;case"vec3i":return de.vec3i;case"vec4i":return de.vec4i;case"vec2u":return de.vec2u;case"vec3u":return de.vec3u;case"vec4u":return de.vec4u;case"vec2h":return de.vec2h;case"vec3h":return de.vec3h;case"vec4h":return de.vec4h;case"mat2x2f":return de.mat2x2f;case"mat2x3f":return de.mat2x3f;case"mat2x4f":return de.mat2x4f;case"mat3x2f":return de.mat3x2f;case"mat3x3f":return de.mat3x3f;case"mat3x4f":return de.mat3x4f;case"mat4x2f":return de.mat4x2f;case"mat4x3f":return de.mat4x3f;case"mat4x4f":return de.mat4x4f;case"mat2x2h":return de.mat2x2h;case"mat2x3h":return de.mat2x3h;case"mat2x4h":return de.mat2x4h;case"mat3x2h":return de.mat3x2h;case"mat3x3h":return de.mat3x3h;case"mat3x4h":return de.mat3x4h;case"mat4x2h":return de.mat4x2h;case"mat4x3h":return de.mat4x3h;case"mat4x4h":return de.mat4x4h}return null}_validateTypeRange(e,t){if(t.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(t.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(D.tokens.ident)){const i=this._previous().toString();if(this._check(D.tokens.paren_left)){const s=this._argument_expression_list(),r=this._getType(i);return r!==null?this._updateNode(new ks(r,s)):this._updateNode(new ro(i,s))}if(this._context.constants.has(i)){const s=this._context.constants.get(i);return this._updateNode(new ly(i,s.value))}return this._updateNode(new cs(i))}if(this._match(D.tokens.int_literal)){const i=this._previous().toString();let s=i.endsWith("i")||i.endsWith("i")?be.i32:i.endsWith("u")||i.endsWith("U")?be.u32:be.x32;const r=parseInt(i);return this._validateTypeRange(r,s),this._updateNode(new zt(new ne(r,this._exec.getTypeInfo(s)),s))}if(this._match(D.tokens.uint_literal)){const i=parseInt(this._previous().toString());return this._validateTypeRange(i,be.u32),this._updateNode(new zt(new ne(i,this._exec.getTypeInfo(be.u32)),be.u32))}if(this._match([D.tokens.decimal_float_literal,D.tokens.hex_float_literal])){let i=this._previous().toString(),s=i.endsWith("h");s&&(i=i.substring(0,i.length-1));const r=parseFloat(i);this._validateTypeRange(r,s?be.f16:be.f32);const o=s?be.f16:be.f32;return this._updateNode(new zt(new ne(r,this._exec.getTypeInfo(o)),o))}if(this._match([D.keywords.true,D.keywords.false])){let i=this._previous().toString()===D.keywords.true.rule;return this._updateNode(new zt(new ne(i?1:0,this._exec.getTypeInfo(be.bool)),be.bool))}if(this._check(D.tokens.paren_left))return this._paren_expression();if(this._match(D.keywords.bitcast)){this._consume(D.tokens.less_than,"Expected '<'.");const i=this._type_decl();this._consume(D.tokens.greater_than,"Expected '>'.");const s=this._paren_expression();return this._updateNode(new cy(i,s))}const e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new ks(e,t))}_argument_expression_list(){if(!this._match(D.tokens.paren_left))return null;const e=[];do{if(this._check(D.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(D.tokens.comma));return this._consume(D.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(D.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(D.tokens.paren_right),this._updateNode(new bl([e]))}_paren_expression(){this._consume(D.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(D.tokens.paren_right,"Expected ')'."),this._updateNode(new bl([e]))}_struct_decl(){if(!this._match(D.keywords.struct))return null;const e=this._currentLine,t=this._consume(D.tokens.ident,"Expected name for struct.").toString();this._consume(D.tokens.brace_left,"Expected '{' for struct body.");const i=[];for(;!this._check(D.tokens.brace_right);){const o=this._attribute(),a=this._consume(D.tokens.name,"Expected variable name.").toString();this._consume(D.tokens.colon,"Expected ':' for struct member type.");const l=this._attribute(),f=this._type_decl();f!=null&&(f.attributes=l),this._check(D.tokens.brace_right)?this._match(D.tokens.comma):this._consume(D.tokens.comma,"Expected ',' for struct member."),i.push(this._updateNode(new uR(a,f,o)))}this._consume(D.tokens.brace_right,"Expected '}' after struct body.");const s=this._currentLine,r=this._updateNode(new Zi(t,i,e,s),e);return this._context.structs.set(t,r),r}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(D.tokens.equal)){const t=this._const_expression(),i=[be.f32];try{const s=t.constEvaluate(this._exec,i);e.value=new zt(s,i[0]),this._exec.context.setVariable(e.name,s)}catch{e.value=t}}else{const t=new ks(e.type,null),i=this._exec.evalExpression(t,this._exec.context);i!==null&&(e.value=new zt(i,e.type),this._exec.context.setVariable(e.name,i))}if(e.type!==null&&e.value instanceof zt){if(e.value.type.name!=="x32"&&this._exec.getTypeName(e.type)!==this._exec.getTypeName(e.value.type))throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof zt&&(e.type=e.value.type.name==="x32"?be.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(D.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(D.keywords.const))return null;const t=this._consume(D.tokens.name,"Expected variable name");let i=null;if(this._match(D.tokens.colon)){const a=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=a)}let s=null;this._consume(D.tokens.equal,"const declarations require an assignment");const r=this._short_circuit_or_expression();try{let a=[be.f32];const l=r.constEvaluate(this._exec,a);l instanceof ne&&this._validateTypeRange(l.value,a[0]),a[0]instanceof de&&a[0].format===null&&l.typeInfo instanceof us&&l.typeInfo.format!==null&&(l.typeInfo.format.name==="f16"?a[0].format=be.f16:l.typeInfo.format.name==="f32"?a[0].format=be.f32:l.typeInfo.format.name==="i32"?a[0].format=be.i32:l.typeInfo.format.name==="u32"?a[0].format=be.u32:l.typeInfo.format.name==="bool"?a[0].format=be.bool:console.error(`TODO: impelement template format type ${l.typeInfo.format.name}`)),s=this._updateNode(new zt(l,a[0])),this._exec.context.setVariable(t.toString(),l)}catch{s=r}if(i!==null&&s instanceof zt){if(s.type.name!=="x32"&&this._exec.getTypeName(i)!==this._exec.getTypeName(s.type))throw this._error(this._peek(),`Invalid cast from ${s.type.name} to ${i.name}. Line:${this._currentLine}`);s.type=i,s.isScalar&&this._validateTypeRange(s.scalarValue,s.type)}else i===null&&s instanceof zt&&(i=(e=s==null?void 0:s.type)!==null&&e!==void 0?e:be.f32,i===be.x32&&(i=be.i32));const o=this._updateNode(new Sh(t.toString(),i,"","",s));return this._context.constants.set(o.name,o),o}_global_let_decl(){if(!this._match(D.keywords.let))return null;const e=this._consume(D.tokens.name,"Expected variable name");let t=null;if(this._match(D.tokens.colon)){const s=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=s)}let i=null;if(this._match(D.tokens.equal)){i=this._const_expression();const s=[be.f32];try{const r=i.constEvaluate(this._exec,s);r!==null&&(i=new zt(r,s[0]))}catch{}}if(t!==null&&i instanceof zt){if(i.type.name!=="x32"&&this._exec.getTypeName(t)!==this._exec.getTypeName(i.type))throw this._error(this._peek(),`Invalid cast from ${i.type.name} to ${t.name}. Line:${this._currentLine}`);i.type=t}else t===null&&i instanceof zt&&(t=i.type.name==="x32"?be.i32:i.type);return i instanceof zt&&i.isScalar&&this._validateTypeRange(i.scalarValue,t),this._updateNode(new ec(e.toString(),t,"","",i))}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(D.keywords.var))return null;let e="",t="";this._match(D.tokens.less_than)&&(e=this._consume(D.storage_class,"Expected storage_class.").toString(),this._match(D.tokens.comma)&&(t=this._consume(D.access_mode,"Expected access_mode.").toString()),this._consume(D.tokens.greater_than,"Expected '>'."));const i=this._consume(D.tokens.name,"Expected variable name");let s=null;if(this._match(D.tokens.colon)){const r=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=r)}return this._updateNode(new ns(i.toString(),s,e,t,null))}_override_decl(){if(!this._match(D.keywords.override))return null;const e=this._consume(D.tokens.name,"Expected variable name");let t=null;if(this._match(D.tokens.colon)){const i=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=i)}return this._updateNode(new Df(e.toString(),t,null))}_diagnostic(){this._consume(D.tokens.paren_left,"Expected '('");const e=this._consume(D.tokens.ident,"Expected severity control name.");this._consume(D.tokens.comma,"Expected ','");let t=this._consume(D.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(D.tokens.period)&&(t+=`.${this._consume(D.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(D.tokens.paren_right,"Expected ')'"),this._updateNode(new sy(e.toString(),t))}_enable_directive(){const e=this._consume(D.tokens.ident,"identity expected.");return this._updateNode(new rR(e.toString()))}_requires_directive(){const e=[this._consume(D.tokens.ident,"identity expected.").toString()];for(;this._match(D.tokens.comma);){const t=this._consume(D.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new oR(e))}_type_alias(){const e=this._consume(D.tokens.ident,"identity expected.");this._consume(D.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(t===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const i=this._updateNode(new Ff(e.toString(),t));return this._context.aliases.set(i.name,i),i}_type_decl(){if(this._check([D.tokens.ident,...D.texel_format,D.keywords.bool,D.keywords.f32,D.keywords.i32,D.keywords.u32])){const i=this._advance(),s=i.toString();return this._context.structs.has(s)?this._context.structs.get(s):this._context.aliases.has(s)?this._context.aliases.get(s).type:this._updateNode(new be(i.toString()))}let e=this._texture_sampler_types();if(e)return e;if(this._check(D.template_types)){let i=this._advance().toString(),s=null,r=null;return this._match(D.tokens.less_than)&&(s=this._type_decl(),r=null,this._match(D.tokens.comma)&&(r=this._consume(D.access_mode,"Expected access_mode for pointer").toString()),this._consume(D.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new de(i,s,r))}if(this._match(D.keywords.ptr)){let i=this._previous().toString();this._consume(D.tokens.less_than,"Expected '<' for pointer.");const s=this._consume(D.storage_class,"Expected storage_class for pointer");this._consume(D.tokens.comma,"Expected ',' for pointer.");const r=this._type_decl();let o=null;return this._match(D.tokens.comma)&&(o=this._consume(D.access_mode,"Expected access_mode for pointer").toString()),this._consume(D.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new lR(i,s.toString(),r,o))}const t=this._attribute();if(this._match(D.keywords.array)){let i=null,s=-1;const r=this._previous();let o=null;if(this._match(D.tokens.less_than)){i=this._type_decl(),this._context.aliases.has(i.name)&&(i=this._context.aliases.get(i.name).type);let l="";if(this._match(D.tokens.comma)){o=this._shift_expression();try{l=o.constEvaluate(this._exec).toString(),o=null}catch{l="1"}}this._consume(D.tokens.greater_than,"Expected '>' for array."),s=l?parseInt(l):0}const a=this._updateNode(new ay(r.toString(),t,i,s));return o&&this._deferArrayCountEval.push({arrayType:a,countNode:o}),a}return null}_texture_sampler_types(){if(this._match(D.sampler_type))return this._updateNode(new Do(this._previous().toString(),null,null));if(this._match(D.depth_texture_type))return this._updateNode(new Do(this._previous().toString(),null,null));if(this._match(D.sampled_texture_type)||this._match(D.multisampled_texture_type)){const e=this._previous();this._consume(D.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(D.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Do(e.toString(),t,null))}if(this._match(D.storage_texture_type)){const e=this._previous();this._consume(D.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(D.texel_format,"Invalid texel format.").toString();this._consume(D.tokens.comma,"Expected ',' after texel format.");const i=this._consume(D.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(D.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Do(e.toString(),t,i))}return null}_attribute(){let e=[];for(;this._match(D.tokens.attr);){const t=this._consume(D.attribute_name,"Expected attribute name"),i=this._updateNode(new hR(t.toString(),null));if(this._match(D.tokens.paren_left)){if(i.value=this._consume(D.literal_or_ident,"Expected attribute value").toString(),this._check(D.tokens.comma)){this._advance();do{const s=this._consume(D.literal_or_ident,"Expected attribute value").toString();i.value instanceof Array||(i.value=[i.value]),i.value.push(s)}while(this._match(D.tokens.comma))}this._consume(D.tokens.paren_right,"Expected ')'")}e.push(i)}return e.length==0?null:e}}class ER extends Ei{constructor(e){super(),e&&this.update(e)}update(e){const t=new wR().parse(e);this.updateAST(t)}}function xR(n){var r;const e={attributes:[],bindings:[]};let t;try{t=CR(n)}catch(o){return ye.error(o.message)(),e}for(const o of t.uniforms){const a=[];for(const l of((r=o.type)==null?void 0:r.members)||[])a.push({name:l.name,type:Bg(l.type)});e.bindings.push({type:"uniform",name:o.name,group:o.group,location:o.binding,members:a})}for(const o of t.textures)e.bindings.push({type:"texture",name:o.name,group:o.group,location:o.binding});for(const o of t.samplers)e.bindings.push({type:"sampler",name:o.name,group:o.group,location:o.binding});const i=t.entry.vertex[0],s=(i==null?void 0:i.inputs.length)||0;for(let o=0;o<s;o++){const a=i.inputs[o];if(a.locationType==="location"){const l=Bg(a.type);e.attributes.push({name:a.name,location:Number(a.location),type:l})}}return e}function Bg(n){return n.format?`${n.name}<${n.format.name}>`:n.name}function CR(n){try{return new ER(n)}catch(e){if(e instanceof Error)throw e;let t="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(t+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(t+=e.token.line||""),new Error(t,{cause:e})}}const SR=1/Math.PI*180,IR=1/180*Math.PI,RR={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...RR}};const Yt=globalThis.mathgl.config;function gy(n,{precision:e=Yt.precision}={}){return n=BR(n),`${parseFloat(n.toPrecision(e))}`}function hs(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}function PR(n){return No(n)}function MR(n){return cn(n)}function No(n,e){return Vf(n,t=>t*IR,e)}function cn(n,e){return Vf(n,t=>t*SR,e)}function Ut(n,e,t){return Vf(n,i=>Math.max(e,Math.min(t,i)))}function Qn(n,e,t){return hs(n)?n.map((i,s)=>Qn(i,e[s],t)):t*e+(1-t)*n}function Cn(n,e,t){const i=Yt.EPSILON;t&&(Yt.EPSILON=t);try{if(n===e)return!0;if(hs(n)&&hs(e)){if(n.length!==e.length)return!1;for(let s=0;s<n.length;++s)if(!Cn(n[s],e[s]))return!1;return!0}return n&&n.equals?n.equals(e):e&&e.equals?e.equals(n):typeof n=="number"&&typeof e=="number"?Math.abs(n-e)<=Yt.EPSILON*Math.max(1,Math.abs(n),Math.abs(e)):!1}finally{Yt.EPSILON=i}}function BR(n){return Math.round(n/Yt.EPSILON)*Yt.EPSILON}function OR(n){return n.clone?n.clone():new Array(n.length)}function Vf(n,e,t){if(hs(n)){const i=n;t=t||OR(i);for(let s=0;s<t.length&&s<i.length;++s){const r=typeof n=="number"?n:n[s];t[s]=e(r,s,t)}return t}return e(n)}class zf extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,t=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+t];return this.check()}toArray(e=[],t=0){for(let i=0;i<this.ELEMENTS;++i)e[t+i]=this[i];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:hs(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Yt)}formatString(e){let t="";for(let i=0;i<this.ELEMENTS;++i)t+=(i>0?", ":"")+gy(this[i],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!Cn(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,i){if(i===void 0)return this.lerp(this,e,t);for(let s=0;s<this.ELEMENTS;++s){const r=e[s],o=typeof t=="number"?t:t[s];this[s]=r+i*(o-r)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),t[i]);return this.check()}add(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]+=t[i];return this.check()}subtract(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]-=t[i];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(Yt.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),t);return this.check()}get elements(){return this}}function DR(n,e){if(n.length!==e)return!1;for(let t=0;t<n.length;++t)if(!Number.isFinite(n[t]))return!1;return!0}function _t(n){if(!Number.isFinite(n))throw new Error(`Invalid number ${JSON.stringify(n)}`);return n}function Go(n,e,t=""){if(Yt.debug&&!DR(n,e))throw new Error(`math.gl: ${t} some fields set to invalid numbers'`);return n}function ii(n,e){if(!n)throw new Error(`math.gl assertion ${e}`)}class Hf extends zf{get x(){return this[0]}set x(e){this[0]=_t(e)}get y(){return this[1]}set y(e){this[1]=_t(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let i=0;i<this.ELEMENTS;++i){const s=this[i]-e[i];t+=s*s}return _t(t)}dot(e){let t=0;for(let i=0;i<this.ELEMENTS;++i)t+=this[i]*e[i];return _t(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]*=t[i];return this.check()}divide(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]/=t[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return ii(e>=0&&e<this.ELEMENTS,"index is out of range"),_t(this[e])}setComponent(e,t){return ii(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}const Wo=1e-6;let hi=typeof Float32Array<"u"?Float32Array:Array;function NR(){const n=new hi(2);return hi!=Float32Array&&(n[0]=0,n[1]=0),n}function qo(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n}function FR(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n}function LR(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n}function kR(n){const e=n[0],t=n[1];return Math.sqrt(e*e+t*t)}function py(n,e){return n[0]=-e[0],n[1]=-e[1],n}function my(n,e,t,i){const s=e[0],r=e[1];return n[0]=s+i*(t[0]-s),n[1]=r+i*(t[1]-r),n}function UR(n,e,t){const i=e[0],s=e[1];return n[0]=t[0]*i+t[2]*s,n[1]=t[1]*i+t[3]*s,n}function VR(n,e,t){const i=e[0],s=e[1];return n[0]=t[0]*i+t[2]*s+t[4],n[1]=t[1]*i+t[3]*s+t[5],n}function _y(n,e,t){const i=e[0],s=e[1];return n[0]=t[0]*i+t[3]*s+t[6],n[1]=t[1]*i+t[4]*s+t[7],n}function yy(n,e,t){const i=e[0],s=e[1];return n[0]=t[0]*i+t[4]*s+t[12],n[1]=t[1]*i+t[5]*s+t[13],n}const zR=FR;(function(){const n=NR();return function(e,t,i,s,r,o){let a,l;for(t||(t=2),i||(i=0),s?l=Math.min(s*t+i,e.length):l=e.length,a=i;a<l;a+=t)n[0]=e[a],n[1]=e[a+1],r(n,n,o),e[a]=n[0],e[a+1]=n[1];return e}})();function by(n,e,t){const i=e[0],s=e[1],r=t[3]*i+t[7]*s||1;return n[0]=(t[0]*i+t[4]*s)/r,n[1]=(t[1]*i+t[5]*s)/r,n}function vy(n,e,t){const i=e[0],s=e[1],r=e[2],o=t[3]*i+t[7]*s+t[11]*r||1;return n[0]=(t[0]*i+t[4]*s+t[8]*r)/o,n[1]=(t[1]*i+t[5]*s+t[9]*r)/o,n[2]=(t[2]*i+t[6]*s+t[10]*r)/o,n}function HR(n,e,t){const i=e[0],s=e[1];return n[0]=t[0]*i+t[2]*s,n[1]=t[1]*i+t[3]*s,n[2]=e[2],n}function GR(n,e,t){const i=e[0],s=e[1];return n[0]=t[0]*i+t[2]*s,n[1]=t[1]*i+t[3]*s,n[2]=e[2],n[3]=e[3],n}function Ty(n,e,t){const i=e[0],s=e[1],r=e[2];return n[0]=t[0]*i+t[3]*s+t[6]*r,n[1]=t[1]*i+t[4]*s+t[7]*r,n[2]=t[2]*i+t[5]*s+t[8]*r,n[3]=e[3],n}class Gf extends Hf{constructor(e=0,t=0){super(2),hs(e)&&arguments.length===1?this.copy(e):(Yt.debug&&(_t(e),_t(t)),this[0]=e,this[1]=t)}set(e,t){return this[0]=e,this[1]=t,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return Yt.debug&&(_t(e.x),_t(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return yy(this,this,e),this.check()}transformAsVector(e){return by(this,this,e),this.check()}transformByMatrix3(e){return _y(this,this,e),this.check()}transformByMatrix2x3(e){return VR(this,this,e),this.check()}transformByMatrix2(e){return UR(this,this,e),this.check()}}function wy(){const n=new hi(3);return hi!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Wf(n){const e=n[0],t=n[1],i=n[2];return Math.sqrt(e*e+t*t+i*i)}function Og(n,e,t){const i=new hi(3);return i[0]=n,i[1]=e,i[2]=t,i}function WR(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function jR(n){const e=n[0],t=n[1],i=n[2];return e*e+t*t+i*i}function $R(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function XR(n,e){const t=e[0],i=e[1],s=e[2];let r=t*t+i*i+s*s;return r>0&&(r=1/Math.sqrt(r)),n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n}function jf(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function Tl(n,e,t){const i=e[0],s=e[1],r=e[2],o=t[0],a=t[1],l=t[2];return n[0]=s*l-r*a,n[1]=r*o-i*l,n[2]=i*a-s*o,n}function QR(n,e,t,i){const s=e[0],r=e[1],o=e[2];return n[0]=s+i*(t[0]-s),n[1]=r+i*(t[1]-r),n[2]=o+i*(t[2]-o),n}function $f(n,e,t){const i=e[0],s=e[1],r=e[2];let o=t[3]*i+t[7]*s+t[11]*r+t[15];return o=o||1,n[0]=(t[0]*i+t[4]*s+t[8]*r+t[12])/o,n[1]=(t[1]*i+t[5]*s+t[9]*r+t[13])/o,n[2]=(t[2]*i+t[6]*s+t[10]*r+t[14])/o,n}function Ey(n,e,t){const i=e[0],s=e[1],r=e[2];return n[0]=i*t[0]+s*t[3]+r*t[6],n[1]=i*t[1]+s*t[4]+r*t[7],n[2]=i*t[2]+s*t[5]+r*t[8],n}function xy(n,e,t){const i=t[0],s=t[1],r=t[2],o=t[3],a=e[0],l=e[1],f=e[2];let g=s*f-r*l,_=r*a-i*f,v=i*l-s*a,T=s*v-r*_,C=r*g-i*v,S=i*_-s*g;const R=o*2;return g*=R,_*=R,v*=R,T*=2,C*=2,S*=2,n[0]=a+g+T,n[1]=l+_+C,n[2]=f+v+S,n}function YR(n,e,t,i){const s=[],r=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],r[0]=s[0],r[1]=s[1]*Math.cos(i)-s[2]*Math.sin(i),r[2]=s[1]*Math.sin(i)+s[2]*Math.cos(i),n[0]=r[0]+t[0],n[1]=r[1]+t[1],n[2]=r[2]+t[2],n}function KR(n,e,t,i){const s=[],r=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],r[0]=s[2]*Math.sin(i)+s[0]*Math.cos(i),r[1]=s[1],r[2]=s[2]*Math.cos(i)-s[0]*Math.sin(i),n[0]=r[0]+t[0],n[1]=r[1]+t[1],n[2]=r[2]+t[2],n}function qR(n,e,t,i){const s=[],r=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],r[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),r[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),r[2]=s[2],n[0]=r[0]+t[0],n[1]=r[1]+t[1],n[2]=r[2]+t[2],n}function JR(n,e){const t=n[0],i=n[1],s=n[2],r=e[0],o=e[1],a=e[2],l=Math.sqrt((t*t+i*i+s*s)*(r*r+o*o+a*a)),f=l&&jf(n,e)/l;return Math.acos(Math.min(Math.max(f,-1),1))}const Cy=WR,Sy=Wf,ou=jR;(function(){const n=wy();return function(e,t,i,s,r,o){let a,l;for(t||(t=3),i||(i=0),s?l=Math.min(s*t+i,e.length):l=e.length,a=i;a<l;a+=t)n[0]=e[a],n[1]=e[a+1],n[2]=e[a+2],r(n,n,o),e[a]=n[0],e[a+1]=n[1],e[a+2]=n[2];return e}})();const au=[0,0,0];let Va;class ee extends Hf{static get ZERO(){return Va||(Va=new ee(0,0,0),Object.freeze(Va)),Va}constructor(e=0,t=0,i=0){super(-0,-0,-0),arguments.length===1&&hs(e)?this.copy(e):(Yt.debug&&(_t(e),_t(t),_t(i)),this[0]=e,this[1]=t,this[2]=i)}set(e,t,i){return this[0]=e,this[1]=t,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Yt.debug&&(_t(e.x),_t(e.y),_t(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=_t(e)}angle(e){return JR(this,e)}cross(e){return Tl(this,this,e),this.check()}rotateX({radians:e,origin:t=au}){return YR(this,this,t,e),this.check()}rotateY({radians:e,origin:t=au}){return KR(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=au}){return qR(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return $f(this,this,e),this.check()}transformAsVector(e){return vy(this,this,e),this.check()}transformByMatrix3(e){return Ey(this,this,e),this.check()}transformByMatrix2(e){return HR(this,this,e),this.check()}transformByQuaternion(e){return xy(this,this,e),this.check()}}let za;class Xf extends Hf{static get ZERO(){return za||(za=new Xf(0,0,0,0),Object.freeze(za)),za}constructor(e=0,t=0,i=0,s=0){super(-0,-0,-0,-0),hs(e)&&arguments.length===1?this.copy(e):(Yt.debug&&(_t(e),_t(t),_t(i),_t(s)),this[0]=e,this[1]=t,this[2]=i,this[3]=s)}set(e,t,i,s){return this[0]=e,this[1]=t,this[2]=i,this[3]=s,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return Yt.debug&&(_t(e.x),_t(e.y),_t(e.z),_t(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=_t(e)}get w(){return this[3]}set w(e){this[3]=_t(e)}transform(e){return $f(this,this,e),this.check()}transformByMatrix3(e){return Ty(this,this,e),this.check()}transformByMatrix2(e){return GR(this,this,e),this.check()}transformByQuaternion(e){return xy(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class Iy extends zf{toString(){let e="[";if(Yt.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let i=0;i<this.RANK;++i)e+=` ${this[i*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,i){return this[t*this.RANK+e]=_t(i),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const i=e*this.RANK;for(let s=0;s<this.RANK;++s)t[s]=this[i+s];return t}setColumn(e,t){const i=e*this.RANK;for(let s=0;s<this.RANK;++s)this[i+s]=t[s];return this}}function ZR(){const n=new hi(9);return hi!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function eP(n,e){if(n===e){const t=e[1],i=e[2],s=e[5];n[1]=e[3],n[2]=e[6],n[3]=t,n[5]=e[7],n[6]=i,n[7]=s}else n[0]=e[0],n[1]=e[3],n[2]=e[6],n[3]=e[1],n[4]=e[4],n[5]=e[7],n[6]=e[2],n[7]=e[5],n[8]=e[8];return n}function tP(n,e){const t=e[0],i=e[1],s=e[2],r=e[3],o=e[4],a=e[5],l=e[6],f=e[7],g=e[8],_=g*o-a*f,v=-g*r+a*l,T=f*r-o*l;let C=t*_+i*v+s*T;return C?(C=1/C,n[0]=_*C,n[1]=(-g*i+s*f)*C,n[2]=(a*i-s*o)*C,n[3]=v*C,n[4]=(g*t-s*l)*C,n[5]=(-a*t+s*r)*C,n[6]=T*C,n[7]=(-f*t+i*l)*C,n[8]=(o*t-i*r)*C,n):null}function nP(n){const e=n[0],t=n[1],i=n[2],s=n[3],r=n[4],o=n[5],a=n[6],l=n[7],f=n[8];return e*(f*r-o*l)+t*(-f*s+o*a)+i*(l*s-r*a)}function Dg(n,e,t){const i=e[0],s=e[1],r=e[2],o=e[3],a=e[4],l=e[5],f=e[6],g=e[7],_=e[8],v=t[0],T=t[1],C=t[2],S=t[3],R=t[4],P=t[5],F=t[6],U=t[7],X=t[8];return n[0]=v*i+T*o+C*f,n[1]=v*s+T*a+C*g,n[2]=v*r+T*l+C*_,n[3]=S*i+R*o+P*f,n[4]=S*s+R*a+P*g,n[5]=S*r+R*l+P*_,n[6]=F*i+U*o+X*f,n[7]=F*s+U*a+X*g,n[8]=F*r+U*l+X*_,n}function iP(n,e,t){const i=e[0],s=e[1],r=e[2],o=e[3],a=e[4],l=e[5],f=e[6],g=e[7],_=e[8],v=t[0],T=t[1];return n[0]=i,n[1]=s,n[2]=r,n[3]=o,n[4]=a,n[5]=l,n[6]=v*i+T*o+f,n[7]=v*s+T*a+g,n[8]=v*r+T*l+_,n}function sP(n,e,t){const i=e[0],s=e[1],r=e[2],o=e[3],a=e[4],l=e[5],f=e[6],g=e[7],_=e[8],v=Math.sin(t),T=Math.cos(t);return n[0]=T*i+v*o,n[1]=T*s+v*a,n[2]=T*r+v*l,n[3]=T*o-v*i,n[4]=T*a-v*s,n[5]=T*l-v*r,n[6]=f,n[7]=g,n[8]=_,n}function Ng(n,e,t){const i=t[0],s=t[1];return n[0]=i*e[0],n[1]=i*e[1],n[2]=i*e[2],n[3]=s*e[3],n[4]=s*e[4],n[5]=s*e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n}function rP(n,e){const t=e[0],i=e[1],s=e[2],r=e[3],o=t+t,a=i+i,l=s+s,f=t*o,g=i*o,_=i*a,v=s*o,T=s*a,C=s*l,S=r*o,R=r*a,P=r*l;return n[0]=1-_-C,n[3]=g-P,n[6]=v+R,n[1]=g+P,n[4]=1-f-C,n[7]=T-S,n[2]=v-R,n[5]=T+S,n[8]=1-f-_,n}var Rh;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL1ROW0=3]="COL1ROW0",n[n.COL1ROW1=4]="COL1ROW1",n[n.COL1ROW2=5]="COL1ROW2",n[n.COL2ROW0=6]="COL2ROW0",n[n.COL2ROW1=7]="COL2ROW1",n[n.COL2ROW2=8]="COL2ROW2"})(Rh||(Rh={}));const oP=Object.freeze([1,0,0,0,1,0,0,0,1]);class Wt extends Iy{static get IDENTITY(){return lP()}static get ZERO(){return aP()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return Rh}constructor(e,...t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):t.length>0?this.copy([e,...t]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(oP)}fromObject(e){return this.check()}fromQuaternion(e){return rP(this,e),this.check()}set(e,t,i,s,r,o,a,l,f){return this[0]=e,this[1]=t,this[2]=i,this[3]=s,this[4]=r,this[5]=o,this[6]=a,this[7]=l,this[8]=f,this.check()}setRowMajor(e,t,i,s,r,o,a,l,f){return this[0]=e,this[1]=s,this[2]=a,this[3]=t,this[4]=r,this[5]=l,this[6]=i,this[7]=o,this[8]=f,this.check()}determinant(){return nP(this)}transpose(){return eP(this,this),this.check()}invert(){return tP(this,this),this.check()}multiplyLeft(e){return Dg(this,e,this),this.check()}multiplyRight(e){return Dg(this,this,e),this.check()}rotate(e){return sP(this,this,e),this.check()}scale(e){return Array.isArray(e)?Ng(this,this,e):Ng(this,this,[e,e]),this.check()}translate(e){return iP(this,this,e),this.check()}transform(e,t){let i;switch(e.length){case 2:i=_y(t||[-0,-0],e,this);break;case 3:i=Ey(t||[-0,-0,-0],e,this);break;case 4:i=Ty(t||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Go(i,e.length),i}transformVector(e,t){return this.transform(e,t)}transformVector2(e,t){return this.transform(e,t)}transformVector3(e,t){return this.transform(e,t)}}let Ha,Ga=null;function aP(){return Ha||(Ha=new Wt([0,0,0,0,0,0,0,0,0]),Object.freeze(Ha)),Ha}function lP(){return Ga||(Ga=new Wt,Object.freeze(Ga)),Ga}function cP(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function AP(n,e){if(n===e){const t=e[1],i=e[2],s=e[3],r=e[6],o=e[7],a=e[11];n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=t,n[6]=e[9],n[7]=e[13],n[8]=i,n[9]=r,n[11]=e[14],n[12]=s,n[13]=o,n[14]=a}else n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15];return n}function Ph(n,e){const t=e[0],i=e[1],s=e[2],r=e[3],o=e[4],a=e[5],l=e[6],f=e[7],g=e[8],_=e[9],v=e[10],T=e[11],C=e[12],S=e[13],R=e[14],P=e[15],F=t*a-i*o,U=t*l-s*o,X=t*f-r*o,Z=i*l-s*a,se=i*f-r*a,Se=s*f-r*l,me=g*S-_*C,J=g*R-v*C,q=g*P-T*C,L=_*R-v*S,fe=_*P-T*S,we=v*P-T*R;let Me=F*we-U*fe+X*L+Z*q-se*J+Se*me;return Me?(Me=1/Me,n[0]=(a*we-l*fe+f*L)*Me,n[1]=(s*fe-i*we-r*L)*Me,n[2]=(S*Se-R*se+P*Z)*Me,n[3]=(v*se-_*Se-T*Z)*Me,n[4]=(l*q-o*we-f*J)*Me,n[5]=(t*we-s*q+r*J)*Me,n[6]=(R*X-C*Se-P*U)*Me,n[7]=(g*Se-v*X+T*U)*Me,n[8]=(o*fe-a*q+f*me)*Me,n[9]=(i*q-t*fe-r*me)*Me,n[10]=(C*se-S*X+P*F)*Me,n[11]=(_*X-g*se-T*F)*Me,n[12]=(a*J-o*L-l*me)*Me,n[13]=(t*L-i*J+s*me)*Me,n[14]=(S*U-C*Z-R*F)*Me,n[15]=(g*Z-_*U+v*F)*Me,n):null}function uP(n){const e=n[0],t=n[1],i=n[2],s=n[3],r=n[4],o=n[5],a=n[6],l=n[7],f=n[8],g=n[9],_=n[10],v=n[11],T=n[12],C=n[13],S=n[14],R=n[15],P=e*o-t*r,F=e*a-i*r,U=t*a-i*o,X=f*C-g*T,Z=f*S-_*T,se=g*S-_*C,Se=e*se-t*Z+i*X,me=r*se-o*Z+a*X,J=f*U-g*F+_*P,q=T*U-C*F+S*P;return l*Se-s*me+R*J-v*q}function Us(n,e,t){const i=e[0],s=e[1],r=e[2],o=e[3],a=e[4],l=e[5],f=e[6],g=e[7],_=e[8],v=e[9],T=e[10],C=e[11],S=e[12],R=e[13],P=e[14],F=e[15];let U=t[0],X=t[1],Z=t[2],se=t[3];return n[0]=U*i+X*a+Z*_+se*S,n[1]=U*s+X*l+Z*v+se*R,n[2]=U*r+X*f+Z*T+se*P,n[3]=U*o+X*g+Z*C+se*F,U=t[4],X=t[5],Z=t[6],se=t[7],n[4]=U*i+X*a+Z*_+se*S,n[5]=U*s+X*l+Z*v+se*R,n[6]=U*r+X*f+Z*T+se*P,n[7]=U*o+X*g+Z*C+se*F,U=t[8],X=t[9],Z=t[10],se=t[11],n[8]=U*i+X*a+Z*_+se*S,n[9]=U*s+X*l+Z*v+se*R,n[10]=U*r+X*f+Z*T+se*P,n[11]=U*o+X*g+Z*C+se*F,U=t[12],X=t[13],Z=t[14],se=t[15],n[12]=U*i+X*a+Z*_+se*S,n[13]=U*s+X*l+Z*v+se*R,n[14]=U*r+X*f+Z*T+se*P,n[15]=U*o+X*g+Z*C+se*F,n}function sc(n,e,t){const i=t[0],s=t[1],r=t[2];let o,a,l,f,g,_,v,T,C,S,R,P;return e===n?(n[12]=e[0]*i+e[4]*s+e[8]*r+e[12],n[13]=e[1]*i+e[5]*s+e[9]*r+e[13],n[14]=e[2]*i+e[6]*s+e[10]*r+e[14],n[15]=e[3]*i+e[7]*s+e[11]*r+e[15]):(o=e[0],a=e[1],l=e[2],f=e[3],g=e[4],_=e[5],v=e[6],T=e[7],C=e[8],S=e[9],R=e[10],P=e[11],n[0]=o,n[1]=a,n[2]=l,n[3]=f,n[4]=g,n[5]=_,n[6]=v,n[7]=T,n[8]=C,n[9]=S,n[10]=R,n[11]=P,n[12]=o*i+g*s+C*r+e[12],n[13]=a*i+_*s+S*r+e[13],n[14]=l*i+v*s+R*r+e[14],n[15]=f*i+T*s+P*r+e[15]),n}function Qf(n,e,t){const i=t[0],s=t[1],r=t[2];return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n[4]=e[4]*s,n[5]=e[5]*s,n[6]=e[6]*s,n[7]=e[7]*s,n[8]=e[8]*r,n[9]=e[9]*r,n[10]=e[10]*r,n[11]=e[11]*r,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function hP(n,e,t,i){let s=i[0],r=i[1],o=i[2],a=Math.sqrt(s*s+r*r+o*o),l,f,g,_,v,T,C,S,R,P,F,U,X,Z,se,Se,me,J,q,L,fe,we,Me,Fe;return a<Wo?null:(a=1/a,s*=a,r*=a,o*=a,f=Math.sin(t),l=Math.cos(t),g=1-l,_=e[0],v=e[1],T=e[2],C=e[3],S=e[4],R=e[5],P=e[6],F=e[7],U=e[8],X=e[9],Z=e[10],se=e[11],Se=s*s*g+l,me=r*s*g+o*f,J=o*s*g-r*f,q=s*r*g-o*f,L=r*r*g+l,fe=o*r*g+s*f,we=s*o*g+r*f,Me=r*o*g-s*f,Fe=o*o*g+l,n[0]=_*Se+S*me+U*J,n[1]=v*Se+R*me+X*J,n[2]=T*Se+P*me+Z*J,n[3]=C*Se+F*me+se*J,n[4]=_*q+S*L+U*fe,n[5]=v*q+R*L+X*fe,n[6]=T*q+P*L+Z*fe,n[7]=C*q+F*L+se*fe,n[8]=_*we+S*Me+U*Fe,n[9]=v*we+R*Me+X*Fe,n[10]=T*we+P*Me+Z*Fe,n[11]=C*we+F*Me+se*Fe,e!==n&&(n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n)}function Ry(n,e,t){const i=Math.sin(t),s=Math.cos(t),r=e[4],o=e[5],a=e[6],l=e[7],f=e[8],g=e[9],_=e[10],v=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=r*s+f*i,n[5]=o*s+g*i,n[6]=a*s+_*i,n[7]=l*s+v*i,n[8]=f*s-r*i,n[9]=g*s-o*i,n[10]=_*s-a*i,n[11]=v*s-l*i,n}function fP(n,e,t){const i=Math.sin(t),s=Math.cos(t),r=e[0],o=e[1],a=e[2],l=e[3],f=e[8],g=e[9],_=e[10],v=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=r*s-f*i,n[1]=o*s-g*i,n[2]=a*s-_*i,n[3]=l*s-v*i,n[8]=r*i+f*s,n[9]=o*i+g*s,n[10]=a*i+_*s,n[11]=l*i+v*s,n}function Py(n,e,t){const i=Math.sin(t),s=Math.cos(t),r=e[0],o=e[1],a=e[2],l=e[3],f=e[4],g=e[5],_=e[6],v=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=r*s+f*i,n[1]=o*s+g*i,n[2]=a*s+_*i,n[3]=l*s+v*i,n[4]=f*s-r*i,n[5]=g*s-o*i,n[6]=_*s-a*i,n[7]=v*s-l*i,n}function dP(n,e){const t=e[0],i=e[1],s=e[2],r=e[4],o=e[5],a=e[6],l=e[8],f=e[9],g=e[10];return n[0]=Math.sqrt(t*t+i*i+s*s),n[1]=Math.sqrt(r*r+o*o+a*a),n[2]=Math.sqrt(l*l+f*f+g*g),n}function gP(n,e){const t=e[0],i=e[1],s=e[2],r=e[3],o=t+t,a=i+i,l=s+s,f=t*o,g=i*o,_=i*a,v=s*o,T=s*a,C=s*l,S=r*o,R=r*a,P=r*l;return n[0]=1-_-C,n[1]=g+P,n[2]=v-R,n[3]=0,n[4]=g-P,n[5]=1-f-C,n[6]=T+S,n[7]=0,n[8]=v+R,n[9]=T-S,n[10]=1-f-_,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function pP(n,e,t,i,s,r,o){const a=1/(t-e),l=1/(s-i),f=1/(r-o);return n[0]=r*2*a,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=r*2*l,n[6]=0,n[7]=0,n[8]=(t+e)*a,n[9]=(s+i)*l,n[10]=(o+r)*f,n[11]=-1,n[12]=0,n[13]=0,n[14]=o*r*2*f,n[15]=0,n}function mP(n,e,t,i,s){const r=1/Math.tan(e/2);if(n[0]=r/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=r,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,s!=null&&s!==1/0){const o=1/(i-s);n[10]=(s+i)*o,n[14]=2*s*i*o}else n[10]=-1,n[14]=-2*i;return n}const _P=mP;function yP(n,e,t,i,s,r,o){const a=1/(e-t),l=1/(i-s),f=1/(r-o);return n[0]=-2*a,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*l,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*f,n[11]=0,n[12]=(e+t)*a,n[13]=(s+i)*l,n[14]=(o+r)*f,n[15]=1,n}const bP=yP;function vP(n,e,t,i){let s,r,o,a,l,f,g,_,v,T;const C=e[0],S=e[1],R=e[2],P=i[0],F=i[1],U=i[2],X=t[0],Z=t[1],se=t[2];return Math.abs(C-X)<Wo&&Math.abs(S-Z)<Wo&&Math.abs(R-se)<Wo?cP(n):(_=C-X,v=S-Z,T=R-se,s=1/Math.sqrt(_*_+v*v+T*T),_*=s,v*=s,T*=s,r=F*T-U*v,o=U*_-P*T,a=P*v-F*_,s=Math.sqrt(r*r+o*o+a*a),s?(s=1/s,r*=s,o*=s,a*=s):(r=0,o=0,a=0),l=v*a-T*o,f=T*r-_*a,g=_*o-v*r,s=Math.sqrt(l*l+f*f+g*g),s?(s=1/s,l*=s,f*=s,g*=s):(l=0,f=0,g=0),n[0]=r,n[1]=l,n[2]=_,n[3]=0,n[4]=o,n[5]=f,n[6]=v,n[7]=0,n[8]=a,n[9]=g,n[10]=T,n[11]=0,n[12]=-(r*C+o*S+a*R),n[13]=-(l*C+f*S+g*R),n[14]=-(_*C+v*S+T*R),n[15]=1,n)}function TP(){const n=new hi(4);return hi!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function wP(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n}function Yf(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n}function EP(n){const e=n[0],t=n[1],i=n[2],s=n[3];return Math.sqrt(e*e+t*t+i*i+s*s)}function xP(n){const e=n[0],t=n[1],i=n[2],s=n[3];return e*e+t*t+i*i+s*s}function CP(n,e){const t=e[0],i=e[1],s=e[2],r=e[3];let o=t*t+i*i+s*s+r*r;return o>0&&(o=1/Math.sqrt(o)),n[0]=t*o,n[1]=i*o,n[2]=s*o,n[3]=r*o,n}function SP(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]*e[3]}function IP(n,e,t,i){const s=e[0],r=e[1],o=e[2],a=e[3];return n[0]=s+i*(t[0]-s),n[1]=r+i*(t[1]-r),n[2]=o+i*(t[2]-o),n[3]=a+i*(t[3]-a),n}function oo(n,e,t){const i=e[0],s=e[1],r=e[2],o=e[3];return n[0]=t[0]*i+t[4]*s+t[8]*r+t[12]*o,n[1]=t[1]*i+t[5]*s+t[9]*r+t[13]*o,n[2]=t[2]*i+t[6]*s+t[10]*r+t[14]*o,n[3]=t[3]*i+t[7]*s+t[11]*r+t[15]*o,n}function RP(n,e,t){const i=e[0],s=e[1],r=e[2],o=t[0],a=t[1],l=t[2],f=t[3],g=f*i+a*r-l*s,_=f*s+l*i-o*r,v=f*r+o*s-a*i,T=-o*i-a*s-l*r;return n[0]=g*f+T*-o+_*-l-v*-a,n[1]=_*f+T*-a+v*-o-g*-l,n[2]=v*f+T*-l+g*-a-_*-o,n[3]=e[3],n}(function(){const n=TP();return function(e,t,i,s,r,o){let a,l;for(t||(t=4),i||(i=0),s?l=Math.min(s*t+i,e.length):l=e.length,a=i;a<l;a+=t)n[0]=e[a],n[1]=e[a+1],n[2]=e[a+2],n[3]=e[a+3],r(n,n,o),e[a]=n[0],e[a+1]=n[1],e[a+2]=n[2],e[a+3]=n[3];return e}})();var Mh;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL0ROW3=3]="COL0ROW3",n[n.COL1ROW0=4]="COL1ROW0",n[n.COL1ROW1=5]="COL1ROW1",n[n.COL1ROW2=6]="COL1ROW2",n[n.COL1ROW3=7]="COL1ROW3",n[n.COL2ROW0=8]="COL2ROW0",n[n.COL2ROW1=9]="COL2ROW1",n[n.COL2ROW2=10]="COL2ROW2",n[n.COL2ROW3=11]="COL2ROW3",n[n.COL3ROW0=12]="COL3ROW0",n[n.COL3ROW1=13]="COL3ROW1",n[n.COL3ROW2=14]="COL3ROW2",n[n.COL3ROW3=15]="COL3ROW3"})(Mh||(Mh={}));const PP=45*Math.PI/180,MP=1,lu=.1,cu=500,BP=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Ge extends Iy{static get IDENTITY(){return DP()}static get ZERO(){return OP()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Mh}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,i,s,r,o,a,l,f,g,_,v,T,C,S,R){return this[0]=e,this[1]=t,this[2]=i,this[3]=s,this[4]=r,this[5]=o,this[6]=a,this[7]=l,this[8]=f,this[9]=g,this[10]=_,this[11]=v,this[12]=T,this[13]=C,this[14]=S,this[15]=R,this.check()}setRowMajor(e,t,i,s,r,o,a,l,f,g,_,v,T,C,S,R){return this[0]=e,this[1]=r,this[2]=f,this[3]=T,this[4]=t,this[5]=o,this[6]=g,this[7]=C,this[8]=i,this[9]=a,this[10]=_,this[11]=S,this[12]=s,this[13]=l,this[14]=v,this[15]=R,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(BP)}fromObject(e){return this.check()}fromQuaternion(e){return gP(this,e),this.check()}frustum(e){const{left:t,right:i,bottom:s,top:r,near:o=lu,far:a=cu}=e;return a===1/0?NP(this,t,i,s,r,o):pP(this,t,i,s,r,o,a),this.check()}lookAt(e){const{eye:t,center:i=[0,0,0],up:s=[0,1,0]}=e;return vP(this,t,i,s),this.check()}ortho(e){const{left:t,right:i,bottom:s,top:r,near:o=lu,far:a=cu}=e;return bP(this,t,i,s,r,o,a),this.check()}orthographic(e){const{fovy:t=PP,aspect:i=MP,focalDistance:s=1,near:r=lu,far:o=cu}=e;Fg(t);const a=t/2,l=s*Math.tan(a),f=l*i;return this.ortho({left:-f,right:f,bottom:-l,top:l,near:r,far:o})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:i=1,near:s=.1,far:r=500}=e;return Fg(t),_P(this,t,i,s,r),this.check()}determinant(){return uP(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const i=this.getScale(t),s=1/i[0],r=1/i[1],o=1/i[2];return e[0]=this[0]*s,e[1]=this[1]*r,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*s,e[5]=this[5]*r,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*s,e[9]=this[9]*r,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const i=this.getScale(t),s=1/i[0],r=1/i[1],o=1/i[2];return e[0]=this[0]*s,e[1]=this[1]*r,e[2]=this[2]*o,e[3]=this[4]*s,e[4]=this[5]*r,e[5]=this[6]*o,e[6]=this[8]*s,e[7]=this[9]*r,e[8]=this[10]*o,e}transpose(){return AP(this,this),this.check()}invert(){return Ph(this,this),this.check()}multiplyLeft(e){return Us(this,e,this),this.check()}multiplyRight(e){return Us(this,this,e),this.check()}rotateX(e){return Ry(this,this,e),this.check()}rotateY(e){return fP(this,this,e),this.check()}rotateZ(e){return Py(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return hP(this,this,e,t),this.check()}scale(e){return Qf(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return sc(this,this,e),this.check()}transform(e,t){return e.length===4?(t=oo(t||[-0,-0,-0,-0],e,this),Go(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:i}=e;let s;switch(i){case 2:s=yy(t||[-0,-0],e,this);break;case 3:s=$f(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Go(s,e.length),s}transformAsVector(e,t){let i;switch(e.length){case 2:i=by(t||[-0,-0],e,this);break;case 3:i=vy(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Go(i,e.length),i}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,i){return this.identity().translate([e,t,i])}}let Wa,ja;function OP(){return Wa||(Wa=new Ge([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Wa)),Wa}function DP(){return ja||(ja=new Ge,Object.freeze(ja)),ja}function Fg(n){if(n>Math.PI*2)throw Error("expected radians")}function NP(n,e,t,i,s,r){const o=2*r/(t-e),a=2*r/(s-i),l=(t+e)/(t-e),f=(s+i)/(s-i),g=-1,_=-1,v=-2*r;return n[0]=o,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=a,n[6]=0,n[7]=0,n[8]=l,n[9]=f,n[10]=g,n[11]=_,n[12]=0,n[13]=0,n[14]=v,n[15]=0,n}function Lg(){const n=new hi(4);return hi!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function FP(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function My(n,e,t){t=t*.5;const i=Math.sin(t);return n[0]=i*e[0],n[1]=i*e[1],n[2]=i*e[2],n[3]=Math.cos(t),n}function kg(n,e,t){const i=e[0],s=e[1],r=e[2],o=e[3],a=t[0],l=t[1],f=t[2],g=t[3];return n[0]=i*g+o*a+s*f-r*l,n[1]=s*g+o*l+r*a-i*f,n[2]=r*g+o*f+i*l-s*a,n[3]=o*g-i*a-s*l-r*f,n}function LP(n,e,t){t*=.5;const i=e[0],s=e[1],r=e[2],o=e[3],a=Math.sin(t),l=Math.cos(t);return n[0]=i*l+o*a,n[1]=s*l+r*a,n[2]=r*l-s*a,n[3]=o*l-i*a,n}function kP(n,e,t){t*=.5;const i=e[0],s=e[1],r=e[2],o=e[3],a=Math.sin(t),l=Math.cos(t);return n[0]=i*l-r*a,n[1]=s*l+o*a,n[2]=r*l+i*a,n[3]=o*l-s*a,n}function UP(n,e,t){t*=.5;const i=e[0],s=e[1],r=e[2],o=e[3],a=Math.sin(t),l=Math.cos(t);return n[0]=i*l+s*a,n[1]=s*l-i*a,n[2]=r*l+o*a,n[3]=o*l-r*a,n}function VP(n,e){const t=e[0],i=e[1],s=e[2];return n[0]=t,n[1]=i,n[2]=s,n[3]=Math.sqrt(Math.abs(1-t*t-i*i-s*s)),n}function wl(n,e,t,i){const s=e[0],r=e[1],o=e[2],a=e[3];let l=t[0],f=t[1],g=t[2],_=t[3],v,T,C,S,R;return v=s*l+r*f+o*g+a*_,v<0&&(v=-v,l=-l,f=-f,g=-g,_=-_),1-v>Wo?(T=Math.acos(v),R=Math.sin(T),C=Math.sin((1-i)*T)/R,S=Math.sin(i*T)/R):(C=1-i,S=i),n[0]=C*s+S*l,n[1]=C*r+S*f,n[2]=C*o+S*g,n[3]=C*a+S*_,n}function zP(n,e){const t=e[0],i=e[1],s=e[2],r=e[3],o=t*t+i*i+s*s+r*r,a=o?1/o:0;return n[0]=-t*a,n[1]=-i*a,n[2]=-s*a,n[3]=r*a,n}function HP(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n}function By(n,e){const t=e[0]+e[4]+e[8];let i;if(t>0)i=Math.sqrt(t+1),n[3]=.5*i,i=.5/i,n[0]=(e[5]-e[7])*i,n[1]=(e[6]-e[2])*i,n[2]=(e[1]-e[3])*i;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[s*3+s]&&(s=2);const r=(s+1)%3,o=(s+2)%3;i=Math.sqrt(e[s*3+s]-e[r*3+r]-e[o*3+o]+1),n[s]=.5*i,i=.5/i,n[3]=(e[r*3+o]-e[o*3+r])*i,n[r]=(e[r*3+s]+e[s*3+r])*i,n[o]=(e[o*3+s]+e[s*3+o])*i}return n}const GP=wP,WP=Yf,jP=SP,$P=IP,XP=EP,QP=xP,Oy=CP,YP=function(){const n=wy(),e=Og(1,0,0),t=Og(0,1,0);return function(i,s,r){const o=jf(s,r);return o<-.999999?(Tl(n,e,s),Sy(n)<1e-6&&Tl(n,t,s),XR(n,n),My(i,n,Math.PI),i):o>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(Tl(n,s,r),i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=1+o,Oy(i,i))}}();(function(){const n=Lg(),e=Lg();return function(t,i,s,r,o,a){return wl(n,i,o,a),wl(e,s,r,a),wl(t,n,e,2*a*(1-a)),t}})();(function(){const n=ZR();return function(e,t,i,s){return n[0]=i[0],n[3]=i[1],n[6]=i[2],n[1]=s[0],n[4]=s[1],n[7]=s[2],n[2]=-t[0],n[5]=-t[1],n[8]=-t[2],Oy(e,By(e,n))}})();const KP=[0,0,0,1];class Jo extends zf{constructor(e=0,t=0,i=0,s=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,t,i,s)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,t,i,s){return this[0]=e,this[1]=t,this[2]=i,this[3]=s,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return By(this,e),this.check()}fromAxisRotation(e,t){return My(this,e,t),this.check()}identity(){return FP(this),this.check()}setAxisAngle(e,t){return this.fromAxisRotation(e,t)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=_t(e)}get y(){return this[1]}set y(e){this[1]=_t(e)}get z(){return this[2]}set z(e){this[2]=_t(e)}get w(){return this[3]}set w(e){this[3]=_t(e)}len(){return XP(this)}lengthSquared(){return QP(this)}dot(e){return jP(this,e)}rotationTo(e,t){return YP(this,e,t),this.check()}add(e){return GP(this,this,e),this.check()}calculateW(){return VP(this,this),this.check()}conjugate(){return HP(this,this),this.check()}invert(){return zP(this,this),this.check()}lerp(e,t,i){return i===void 0?this.lerp(this,e,t):($P(this,e,t,i),this.check())}multiplyRight(e){return kg(this,this,e),this.check()}multiplyLeft(e){return kg(this,e,this),this.check()}normalize(){const e=this.len(),t=e>0?1/e:0;return this[0]=this[0]*t,this[1]=this[1]*t,this[2]=this[2]*t,this[3]=this[3]*t,e===0&&(this[3]=1),this.check()}rotateX(e){return LP(this,this,e),this.check()}rotateY(e){return kP(this,this,e),this.check()}rotateZ(e){return UP(this,this,e),this.check()}scale(e){return WP(this,this,e),this.check()}slerp(e,t,i){let s,r,o;switch(arguments.length){case 1:({start:s=KP,target:r,ratio:o}=e);break;case 2:s=this,r=e,o=t;break;default:s=e,r=t,o=i}return wl(this,s,r,o),this.check()}transformVector4(e,t=new Xf){return RP(t,e,this),Go(t,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,t){return this.setAxisAngle(e,t)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const Ug=1e-6,qP=6371e3;class kr{constructor({phi:e=0,theta:t=0,radius:i=1,bearing:s,pitch:r,altitude:o,radiusScale:a=qP}={}){this.phi=e,this.theta=t,this.radius=i||o||1,this.radiusScale=a||1,s!==void 0&&(this.bearing=s),r!==void 0&&(this.pitch=r),this.check()}toString(){return this.formatString(Yt)}formatString({printTypes:e=!1}){const t=gy;return`${e?"Spherical":""}[rho:${t(this.radius)},theta:${t(this.theta)},phi:${t(this.phi)}]`}equals(e){return Cn(this.radius,e.radius)&&Cn(this.theta,e.theta)&&Cn(this.phi,e.phi)}exactEquals(e){return this.radius===e.radius&&this.theta===e.theta&&this.phi===e.phi}get bearing(){return 180-cn(this.phi)}set bearing(e){this.phi=Math.PI-No(e)}get pitch(){return cn(this.theta)}set pitch(e){this.theta=No(e)}get longitude(){return cn(this.phi)}get latitude(){return cn(this.theta)}get lng(){return cn(this.phi)}get lat(){return cn(this.theta)}get z(){return(this.radius-1)*this.radiusScale}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this.check()}clone(){return new kr().copy(this)}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this.check()}fromLngLatZ([e,t,i]){return this.radius=1+i/this.radiusScale,this.phi=No(t),this.theta=No(e),this.check()}fromVector3(e){return this.radius=Wf(e),this.radius>0&&(this.theta=Math.atan2(e[0],e[1]),this.phi=Math.acos(Ut(e[2]/this.radius,-1,1))),this.check()}toVector3(){return new ee(0,0,this.radius).rotateX({radians:this.theta}).rotateZ({radians:this.phi})}makeSafe(){return this.phi=Math.max(Ug,Math.min(Math.PI-Ug,this.phi)),this}check(){if(!Number.isFinite(this.phi)||!Number.isFinite(this.theta)||!(this.radius>0))throw new Error("SphericalCoordinates: some fields set to invalid numbers");return this}}const JP=.1,ZP=1e-12,Dy=1e-15,eM=1e-20;function Ny(n,e=[],t=0){const i=Math.fround(n),s=n-i;return e[t]=i,e[t+1]=s,e}function tM(n){return n-Math.fround(n)}function nM(n){const e=new Float32Array(32);for(let t=0;t<4;++t)for(let i=0;i<4;++i){const s=t*4+i;Ny(n[i*4+t],e,s*2)}return e}const iM=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,sM={name:"fp32",vs:iM},rM=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,oM={ONE:1},aM={name:"fp64arithmetic",vs:rM,defaultUniforms:oM,uniformTypes:{ONE:"f32"},fp64ify:Ny,fp64LowPart:tM,fp64ifyMatrix4:nM},lM=[0,1,1,1],cM=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,AM=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,Vg={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:lM},vs:cM,fs:AM,getUniforms:uM};function uM(n={},e){const t={};if(n.highlightedObjectColor!==void 0)if(n.highlightedObjectColor===null)t.isHighlightActive=!1;else{t.isHighlightActive=!0;const i=n.highlightedObjectColor.slice(0,3);t.highlightedObjectColor=i}if(n.highlightColor){const i=Array.from(n.highlightColor,s=>s/255);Number.isFinite(i[3])||(i[3]=1),t.highlightColor=i}return n.isActive!==void 0&&(t.isActive=!!n.isActive,t.isAttribute=!!n.isAttribute),n.useFloatColors!==void 0&&(t.useFloatColors=!!n.useFloatColors),t}const zg=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,hM=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  poightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`,Fy=3,fM=255;var Zo;(function(n){n[n.POINT=0]="POINT",n[n.DIRECTIONAL=1]="DIRECTIONAL"})(Zo||(Zo={}));const Ur={props:{},uniforms:{},name:"lighting",defines:{MAX_LIGHTS:Fy},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientLightColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:Zo.POINT,directionalLightCount:0,pointLightCount:0,ambientLightColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:hM,vs:zg,fs:zg,getUniforms:dM};function dM(n,e={}){if(n=n&&{...n},!n)return{...Ur.defaultUniforms};n.lights&&(n={...n,...pM(n.lights),lights:void 0});const{ambientLight:t,pointLights:i,directionalLights:s}=n||{};if(!(t||i&&i.length>0||s&&s.length>0))return{...Ur.defaultUniforms,enabled:0};const o={...Ur.defaultUniforms,...e,...gM({ambientLight:t,pointLights:i,directionalLights:s})};return n.enabled!==void 0&&(o.enabled=n.enabled?1:0),o}function gM({ambientLight:n,pointLights:e=[],directionalLights:t=[]}){const i={};i.ambientLightColor=Au(n);let s=0;for(const r of e){i.lightType=Zo.POINT;const o=s;i[`lightColor${o}`]=Au(r),i[`lightPosition${o}`]=r.position,i[`lightAttenuation${o}`]=r.attenuation||[1,0,0],s++}for(const r of t){i.lightType=Zo.DIRECTIONAL;const o=s;i[`lightColor${o}`]=Au(r),i[`lightDirection${o}`]=r.direction,s++}return s>Fy&&ye.warn("MAX_LIGHTS exceeded")(),i.directionalLightCount=t.length,i.pointLightCount=e.length,i}function pM(n){var t,i;const e={pointLights:[],directionalLights:[]};for(const s of n||[])switch(s.type){case"ambient":e.ambientLight=s;break;case"directional":(t=e.directionalLights)==null||t.push(s);break;case"point":(i=e.pointLights)==null||i.push(s);break}return e}function Au(n={}){const{color:e=[0,0,0],intensity:t=1}=n;return e.map(i=>i*t/fM)}const Ly=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,ky=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,Kc={props:{},name:"gouraudMaterial",vs:ky.replace("phongMaterial","gouraudMaterial"),fs:Ly.replace("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:1},dependencies:[Ur],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(n){const e={...n};return e.specularColor&&(e.specularColor=e.specularColor.map(t=>t/255)),{...Kc.defaultUniforms,...e}}},mM=`struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> material : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`,Kf={name:"phongMaterial",dependencies:[Ur],source:mM,vs:Ly,fs:ky,defines:{LIGHTING_FRAGMENT:1},uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(n){const e={...n};return e.specularColor&&(e.specularColor=e.specularColor.map(t=>t/255)),{...Kf.defaultUniforms,...e}}},_M=`out vec3 pbr_vPosition;
out vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
out mat3 pbr_vTBN;
# else
out vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = pbrProjection.modelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(pbrProjection.normalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(pbrProjection.modelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else // HAS_TANGENTS != 1
  pbr_vNormal = normalize(vec3(pbrProjection.modelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`,yM=`precision highp float;

uniform pbrMaterialUniforms {
  // Material is unlit
  bool unlit;

  // Base color map
  bool baseColorMapEnabled;
  vec4 baseColorFactor;

  bool normalMapEnabled;  
  float normalScale; // #ifdef HAS_NORMALMAP

  bool emissiveMapEnabled;
  vec3 emissiveFactor; // #ifdef HAS_EMISSIVEMAP

  vec2 metallicRoughnessValues;
  bool metallicRoughnessMapEnabled;

  bool occlusionMapEnabled;
  float occlusionStrength; // #ifdef HAS_OCCLUSIONMAP
  
  bool alphaCutoffEnabled;
  float alphaCutoff; // #ifdef ALPHA_CUTOFF
  
  // IBL
  bool IBLenabled;
  vec2 scaleIBLAmbient; // #ifdef USE_IBL
  
  // debugging flags used for shader output of intermediate PBR variables
  // #ifdef PBR_DEBUG
  vec4 scaleDiffBaseMR;
  vec4 scaleFGDSpec;
  // #endif
} pbrMaterial;

// Samplers
#ifdef HAS_BASECOLORMAP
uniform sampler2D pbr_baseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D pbr_normalSampler;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D pbr_emissiveSampler;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D pbr_metallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D pbr_occlusionSampler;
#endif
#ifdef USE_IBL
uniform samplerCube pbr_diffuseEnvSampler;
uniform samplerCube pbr_specularEnvSampler;
uniform sampler2D pbr_brdfLUT;
#endif

// Inputs from vertex shader

in vec3 pbr_vPosition;
in vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
in mat3 pbr_vTBN;
#else
in vec3 pbr_vNormal;
#endif
#endif

// Encapsulate the various inputs used by the various functions in the shading equation
// We store values in this struct to simplify the integration of alternative implementations
// of the shading terms, outlined in the Readme.MD Appendix.
struct PBRInfo {
  float NdotL;                  // cos angle between normal and light direction
  float NdotV;                  // cos angle between normal and view direction
  float NdotH;                  // cos angle between normal and half vector
  float LdotH;                  // cos angle between light direction and half vector
  float VdotH;                  // cos angle between view direction and half vector
  float perceptualRoughness;    // roughness value, as authored by the model creator (input to shader)
  float metalness;              // metallic value at the surface
  vec3 reflectance0;            // full reflectance color (normal incidence angle)
  vec3 reflectance90;           // reflectance color at grazing angle
  float alphaRoughness;         // roughness mapped to a more linear change in the roughness (proposed by [2])
  vec3 diffuseColor;            // color contribution from diffuse lighting
  vec3 specularColor;           // color contribution from specular lighting
  vec3 n;                       // normal at surface point
  vec3 v;                       // vector from surface point to camera
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else // SRGB_FAST_APPROXIMATION
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif //SRGB_FAST_APPROXIMATION
  return vec4(linOut,srgbIn.w);;
#else //MANUAL_SRGB
  return srgbIn;
#endif //MANUAL_SRGB
}

// Find the normal for this fragment, pulling either from a predefined normal map
// or from the interpolated mesh normal and tangent attributes.
vec3 getNormal()
{
  // Retrieve the tangent space matrix
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else // HAS_TANGENTS
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture(pbr_normalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(pbrMaterial.normalScale, pbrMaterial.normalScale, 1.0)));
#else
  // The tbn matrix is linearly interpolated, so we need to re-normalize
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}

// Calculation of the lighting contribution from an optional Image Based Light source.
// Precomputed Environment Maps are required uniform inputs and are computed as outlined in [1].
// See our README.md on Environment Maps [3] for additional discussion.
#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInfo, vec3 n, vec3 reflection)
{
  float mipCount = 9.0; // resolution of 512x512
  float lod = (pbrInfo.perceptualRoughness * mipCount);
  // retrieve a scale and bias to F0. See [1], Figure 3
  vec3 brdf = SRGBtoLINEAR(texture(pbr_brdfLUT,
    vec2(pbrInfo.NdotV, 1.0 - pbrInfo.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(texture(pbr_diffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInfo.diffuseColor;
  vec3 specular = specularLight * (pbrInfo.specularColor * brdf.x + brdf.y);

  // For presentation, this allows us to disable IBL terms
  diffuse *= pbrMaterial.scaleIBLAmbient.x;
  specular *= pbrMaterial.scaleIBLAmbient.y;

  return diffuse + specular;
}
#endif

// Basic Lambertian diffuse
// Implementation from Lambert's Photometria https://archive.org/details/lambertsphotome00lambgoog
// See also [1], Equation 1
vec3 diffuse(PBRInfo pbrInfo)
{
  return pbrInfo.diffuseColor / M_PI;
}

// The following equation models the Fresnel reflectance term of the spec equation (aka F())
// Implementation of fresnel from [4], Equation 15
vec3 specularReflection(PBRInfo pbrInfo)
{
  return pbrInfo.reflectance0 +
    (pbrInfo.reflectance90 - pbrInfo.reflectance0) *
    pow(clamp(1.0 - pbrInfo.VdotH, 0.0, 1.0), 5.0);
}

// This calculates the specular geometric attenuation (aka G()),
// where rougher material will reflect less light back to the viewer.
// This implementation is based on [1] Equation 4, and we adopt their modifications to
// alphaRoughness as input as originally proposed in [2].
float geometricOcclusion(PBRInfo pbrInfo)
{
  float NdotL = pbrInfo.NdotL;
  float NdotV = pbrInfo.NdotV;
  float r = pbrInfo.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}

// The following equation(s) model the distribution of microfacet normals across
// the area being drawn (aka D())
// Implementation from "Average Irregularity Representation of a Roughened Surface
// for Ray Reflection" by T. S. Trowbridge, and K. P. Reitz
// Follows the distribution function recommended in the SIGGRAPH 2013 course notes
// from EPIC Games [1], Equation 3.
float microfacetDistribution(PBRInfo pbrInfo)
{
  float roughnessSq = pbrInfo.alphaRoughness * pbrInfo.alphaRoughness;
  float f = (pbrInfo.NdotH * roughnessSq - pbrInfo.NdotH) * pbrInfo.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInfo) {
  pbrInfo.NdotL = 1.0;
  pbrInfo.NdotH = 0.0;
  pbrInfo.LdotH = 0.0;
  pbrInfo.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInfo, vec3 lightDirection) {
  vec3 n = pbrInfo.n;
  vec3 v = pbrInfo.v;
  vec3 l = normalize(lightDirection);             // Vector from surface point to light
  vec3 h = normalize(l+v);                        // Half vector between both l and v

  pbrInfo.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInfo, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInfo, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInfo, vec3 lightColor) {
  // Calculate the shading terms for the microfacet specular shading model
  vec3 F = specularReflection(pbrInfo);
  float G = geometricOcclusion(pbrInfo);
  float D = microfacetDistribution(pbrInfo);

  // Calculation of analytical lighting contribution
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInfo);
  vec3 specContrib = F * G * D / (4.0 * pbrInfo.NdotL * pbrInfo.NdotV);
  // Obtain final intensity as reflectance (BRDF) scaled by the energy of the light (cosine law)
  return pbrInfo.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
  // The albedo may be defined from a base texture or a flat color
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture(pbr_baseColorSampler, pbr_vUV)) * pbrMaterial.baseColorFactor;
#else
  vec4 baseColor = pbrMaterial.baseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < pbrMaterial.alphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbrMaterial.unlit){
    color.rgb = baseColor.rgb;
  }
  else{
    // Metallic and Roughness material properties are packed together
    // In glTF, these factors can be specified by fixed scalar values
    // or from a metallic-roughness map
    float perceptualRoughness = pbrMaterial.metallicRoughnessValues.y;
    float metallic = pbrMaterial.metallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP
    // Roughness is stored in the 'g' channel, metallic is stored in the 'b' channel.
    // This layout intentionally reserves the 'r' channel for (optional) occlusion map data
    vec4 mrSample = texture(pbr_metallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);
    // Roughness is authored as perceptual roughness; as is convention,
    // convert to material roughness by squaring the perceptual roughness [2].
    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);

    // Compute reflectance.
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);

    // For typical incident reflectance range (between 4% to 100%) set the grazing
    // reflectance to 100% for typical fresnel effect.
    // For very low reflectance range on highly diffuse objects (below 4%),
    // incrementally reduce grazing reflecance to 0%.
    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();                          // normal at surface point
    vec3 v = normalize(pbrProjection.camera - pbr_vPosition);  // Vector from surface point to camera

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInfo = PBRInfo(
      0.0, // NdotL
      NdotV,
      0.0, // NdotH
      0.0, // LdotH
      0.0, // VdotH
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );


#ifdef USE_LIGHTS
    // Apply ambient light
    PBRInfo_setAmbientLight(pbrInfo);
    color += calculateFinalColor(pbrInfo, lighting.ambientColor);

    // Apply directional light
    for(int i = 0; i < lighting.directionalLightCount; i++) {
      if (i < lighting.directionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInfo, lighting_getDirectionalLight(i).direction);
        color += calculateFinalColor(pbrInfo, lighting_getDirectionalLight(i).color);
      }
    }

    // Apply point light
    for(int i = 0; i < lighting.pointLightCount; i++) {
      if (i < lighting.pointLightCount) {
        PBRInfo_setPointLight(pbrInfo, lighting_getPointLight(i));
        float attenuation = getPointLightAttenuation(lighting_getPointLight(i), distance(lighting_getPointLight(i).position, pbr_vPosition));
        color += calculateFinalColor(pbrInfo, lighting_getPointLight(i).color / attenuation);
      }
    }
#endif

    // Calculate lighting contribution from image based lighting source (IBL)
#ifdef USE_IBL
    if (pbrMaterial.IBLenabled) {
      color += getIBLContribution(pbrInfo, n, reflection);
    }
#endif

 // Apply optional PBR terms for additional (optional) shading
#ifdef HAS_OCCLUSIONMAP
    if (pbrMaterial.occlusionMapEnabled) {
      float ao = texture(pbr_occlusionSampler, pbr_vUV).r;
      color = mix(color, color * ao, pbrMaterial.occlusionStrength);
    }
#endif

#ifdef HAS_EMISSIVEMAP
    if (pbrMaterial.emissiveMapEnabled) {
      vec3 emissive = SRGBtoLINEAR(texture(pbr_emissiveSampler, pbr_vUV)).rgb * pbrMaterial.emissiveFactor;
      color += emissive;
    }
#endif

    // This section uses mix to override final color for reference app visualization
    // of various parameters in the lighting equation.
#ifdef PBR_DEBUG
    // TODO: Figure out how to debug multiple lights

    // color = mix(color, F, pbr_scaleFGDSpec.x);
    // color = mix(color, vec3(G), pbr_scaleFGDSpec.y);
    // color = mix(color, vec3(D), pbr_scaleFGDSpec.z);
    // color = mix(color, specContrib, pbr_scaleFGDSpec.w);

    // color = mix(color, diffuseContrib, pbr_scaleDiffBaseMR.x);
    color = mix(color, baseColor.rgb, pbrMaterial.scaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), pbrMaterial.scaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), pbrMaterial.scaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,Hg=`uniform pbrProjectionUniforms {
  mat4 modelViewProjectionMatrix;
  mat4 modelMatrix;
  mat4 normalMatrix;
  vec3 camera;
} pbrProjection;
`,bM={name:"pbrProjection",vs:Hg,fs:Hg,getUniforms:n=>n,uniformTypes:{modelViewProjectionMatrix:"mat4x4<f32>",modelMatrix:"mat4x4<f32>",normalMatrix:"mat4x4<f32>",camera:"vec3<i32>"}},qf={props:{},uniforms:{},name:"pbrMaterial",dependencies:[Ur,bM],vs:_M,fs:yM,defines:{LIGHTING_FRAGMENT:1},getUniforms:n=>n,uniformTypes:{unlit:"i32",baseColorMapEnabled:"i32",baseColorFactor:"vec4<f32>",normalMapEnabled:"i32",normalScale:"f32",emissiveMapEnabled:"i32",emissiveFactor:"vec3<f32>",metallicRoughnessValues:"vec2<f32>",metallicRoughnessMapEnabled:"i32",occlusionMapEnabled:"i32",occlusionStrength:"f32",alphaCutoffEnabled:"i32",alphaCutoff:"f32",IBLenabled:"i32",scaleIBLAmbient:"vec2<f32>",scaleDiffBaseMR:"vec4<f32>",scaleFGDSpec:"vec4<f32>"}},Gg=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;

 // Constant-Linear-Exponential
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`,vM={lightSources:{}};function uu(n={}){const{color:e=[0,0,0],intensity:t=1}=n;return e.map(i=>i*t/255)}function TM({ambientLight:n,pointLights:e=[],directionalLights:t=[]}){const i={};return n?i["lighting_uAmbientLight.color"]=uu(n):i["lighting_uAmbientLight.color"]=[0,0,0],e.forEach((s,r)=>{i[`lighting_uPointLight[${r}].color`]=uu(s),i[`lighting_uPointLight[${r}].position`]=s.position,i[`lighting_uPointLight[${r}].attenuation`]=s.attenuation||[1,0,0]}),i.lighting_uPointLightCount=e.length,t.forEach((s,r)=>{i[`lighting_uDirectionalLight[${r}].color`]=uu(s),i[`lighting_uDirectionalLight[${r}].direction`]=s.direction}),i.lighting_uDirectionalLightCount=t.length,i}function Uy(n=vM){var e,t;if("lightSources"in n){const{ambientLight:i,pointLights:s,directionalLights:r}=n.lightSources||{};return i||s&&s.length>0||r&&r.length>0?Object.assign({},TM({ambientLight:i,pointLights:s,directionalLights:r}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in n){const i={pointLights:[],directionalLights:[]};for(const s of n.lights||[])switch(s.type){case"ambient":i.ambientLight=s;break;case"directional":(e=i.directionalLights)==null||e.push(s);break;case"point":(t=i.pointLights)==null||t.push(s);break}return Uy({lightSources:i})}return{}}const Vy={name:"lights",vs:Gg,fs:Gg,getUniforms:Uy,defines:{MAX_LIGHTS:3}},zy=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`,wM={};function EM(n){const{ambient:e=.35,diffuse:t=.6,shininess:i=32,specularColor:s=[30,30,30]}=n;return{lighting_uAmbient:e,lighting_uDiffuse:t,lighting_uShininess:i,lighting_uSpecularColor:s.map(r=>r/255)}}function Hy(n=wM){if(!("material"in n))return{};const{material:e}=n;return e?EM(e):{lighting_uEnabled:!1}}const Y$={name:"gouraud-lighting",dependencies:[Vy],vs:zy,defines:{LIGHTING_VERTEX:1},getUniforms:Hy},K$={name:"phong-lighting",dependencies:[Vy],fs:zy,defines:{LIGHTING_FRAGMENT:1},getUniforms:Hy},Wg=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,xM={name:"layer",vs:Wg,fs:Wg,getUniforms:n=>({opacity:Math.pow(n.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},Gy="#define SMOOTH_EDGE_RADIUS 0.5",CM=`
${Gy}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,SM=`
${Gy}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,Wy={name:"geometry",vs:CM,fs:SM},IM=25;var Qt;(function(n){n[n.Start=1]="Start",n[n.Move=2]="Move",n[n.End=4]="End",n[n.Cancel=8]="Cancel"})(Qt||(Qt={}));var Jt;(function(n){n[n.None=0]="None",n[n.Left=1]="Left",n[n.Right=2]="Right",n[n.Up=4]="Up",n[n.Down=8]="Down",n[n.Horizontal=3]="Horizontal",n[n.Vertical=12]="Vertical",n[n.All=15]="All"})(Jt||(Jt={}));var Ze;(function(n){n[n.Possible=1]="Possible",n[n.Began=2]="Began",n[n.Changed=4]="Changed",n[n.Ended=8]="Ended",n[n.Recognized=8]="Recognized",n[n.Cancelled=16]="Cancelled",n[n.Failed=32]="Failed"})(Ze||(Ze={}));const RM="compute",PM="auto",Bh="manipulation",El="none",Oh="pan-x",Dh="pan-y";function MM(n){if(n.includes(El))return El;const e=n.includes(Oh),t=n.includes(Dh);return e&&t?El:e||t?e?Oh:Dh:n.includes(Bh)?Bh:PM}class BM{constructor(e,t){this.actions="",this.manager=e,this.set(t)}set(e){e===RM&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const t of this.manager.recognizers)t.options.enable&&(e=e.concat(t.getTouchAction()));return MM(e.join(" "))}}function rc(n){return n.trim().split(/\s+/g)}function hu(n,e,t){if(n)for(const i of rc(e))n.addEventListener(i,t,!1)}function fu(n,e,t){if(n)for(const i of rc(e))n.removeEventListener(i,t,!1)}function jg(n){return(n.ownerDocument||n).defaultView}function OM(n,e){let t=n;for(;t;){if(t===e)return!0;t=t.parentNode}return!1}function jy(n){const e=n.length;if(e===1)return{x:Math.round(n[0].clientX),y:Math.round(n[0].clientY)};let t=0,i=0,s=0;for(;s<e;)t+=n[s].clientX,i+=n[s].clientY,s++;return{x:Math.round(t/e),y:Math.round(i/e)}}function $g(n){const e=[];let t=0;for(;t<n.pointers.length;)e[t]={clientX:Math.round(n.pointers[t].clientX),clientY:Math.round(n.pointers[t].clientY)},t++;return{timeStamp:Date.now(),pointers:e,center:jy(e),deltaX:n.deltaX,deltaY:n.deltaY}}function $y(n,e){const t=e.x-n.x,i=e.y-n.y;return Math.sqrt(t*t+i*i)}function Xg(n,e){const t=e.clientX-n.clientX,i=e.clientY-n.clientY;return Math.sqrt(t*t+i*i)}function DM(n,e){const t=e.x-n.x,i=e.y-n.y;return Math.atan2(i,t)*180/Math.PI}function Qg(n,e){const t=e.clientX-n.clientX,i=e.clientY-n.clientY;return Math.atan2(i,t)*180/Math.PI}function Xy(n,e){return n===e?Jt.None:Math.abs(n)>=Math.abs(e)?n<0?Jt.Left:Jt.Right:e<0?Jt.Up:Jt.Down}function NM(n,e){const t=e.center;let i=n.offsetDelta,s=n.prevDelta;const r=n.prevInput;return(e.eventType===Qt.Start||(r==null?void 0:r.eventType)===Qt.End)&&(s=n.prevDelta={x:(r==null?void 0:r.deltaX)||0,y:(r==null?void 0:r.deltaY)||0},i=n.offsetDelta={x:t.x,y:t.y}),{deltaX:s.x+(t.x-i.x),deltaY:s.y+(t.y-i.y)}}function Qy(n,e,t){return{x:e/n||0,y:t/n||0}}function FM(n,e){return Xg(e[0],e[1])/Xg(n[0],n[1])}function LM(n,e){return Qg(e[1],e[0])-Qg(n[1],n[0])}function kM(n,e){const t=n.lastInterval||e,i=e.timeStamp-t.timeStamp;let s,r,o,a;if(e.eventType!==Qt.Cancel&&(i>IM||t.velocity===void 0)){const l=e.deltaX-t.deltaX,f=e.deltaY-t.deltaY,g=Qy(i,l,f);r=g.x,o=g.y,s=Math.abs(g.x)>Math.abs(g.y)?g.x:g.y,a=Xy(l,f),n.lastInterval=e}else s=t.velocity,r=t.velocityX,o=t.velocityY,a=t.direction;e.velocity=s,e.velocityX=r,e.velocityY=o,e.direction=a}function UM(n,e){const{session:t}=n,{pointers:i}=e,{length:s}=i;t.firstInput||(t.firstInput=$g(e)),s>1&&!t.firstMultiple?t.firstMultiple=$g(e):s===1&&(t.firstMultiple=!1);const{firstInput:r,firstMultiple:o}=t,a=o?o.center:r.center,l=e.center=jy(i);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-r.timeStamp,e.angle=DM(a,l),e.distance=$y(a,l);const{deltaX:f,deltaY:g}=NM(t,e);e.deltaX=f,e.deltaY=g,e.offsetDirection=Xy(e.deltaX,e.deltaY);const _=Qy(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=_.x,e.overallVelocityY=_.y,e.overallVelocity=Math.abs(_.x)>Math.abs(_.y)?_.x:_.y,e.scale=o?FM(o.pointers,i):1,e.rotation=o?LM(o.pointers,i):0,e.maxPointers=t.prevInput?e.pointers.length>t.prevInput.maxPointers?e.pointers.length:t.prevInput.maxPointers:e.pointers.length;let v=n.element;return OM(e.srcEvent.target,v)&&(v=e.srcEvent.target),e.target=v,kM(t,e),e}function VM(n,e,t){const i=t.pointers.length,s=t.changedPointers.length,r=e&Qt.Start&&i-s===0,o=e&(Qt.End|Qt.Cancel)&&i-s===0;t.isFirst=!!r,t.isFinal=!!o,r&&(n.session={}),t.eventType=e;const a=UM(n,t);n.emit("hammer.input",a),n.recognize(a),n.session.prevInput=a}let zM=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=t=>{this.manager.options.enable&&this.handler(t)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){VM(this.manager,e,t)}init(){hu(this.element,this.evEl,this.domHandler),hu(this.target,this.evTarget,this.domHandler),hu(jg(this.element),this.evWin,this.domHandler)}destroy(){fu(this.element,this.evEl,this.domHandler),fu(this.target,this.evTarget,this.domHandler),fu(jg(this.element),this.evWin,this.domHandler)}};const HM={pointerdown:Qt.Start,pointermove:Qt.Move,pointerup:Qt.End,pointercancel:Qt.Cancel,pointerout:Qt.Cancel},GM="pointerdown",WM="pointermove pointerup pointercancel";class jM extends zM{constructor(e){super(e),this.evEl=GM,this.evWin=WM,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:t}=this;let i=!1;const s=HM[e.type],r=e.pointerType,o=r==="touch";let a=t.findIndex(l=>l.pointerId===e.pointerId);s&Qt.Start&&(e.buttons||o)?a<0&&(t.push(e),a=t.length-1):s&(Qt.End|Qt.Cancel)&&(i=!0),!(a<0)&&(t[a]=e,this.callback(s,{pointers:t,changedPointers:[e],eventType:s,pointerType:r,srcEvent:e}),i&&t.splice(a,1))}}const $M=["","webkit","Moz","MS","ms","o"];function XM(n,e){const t=e[0].toUpperCase()+e.slice(1);for(const i of $M){const s=i?i+t:e;if(s in n)return s}}const QM=1,Yg=2,Kg={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class YM{constructor(e,t){this.options={...Kg,...t,cssProps:{...Kg.cssProps,...t.cssProps},inputTarget:t.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new jM(this),this.touchAction=new BM(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?Yg:QM}recognize(e){const{session:t}=this;if(t.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let i;const{recognizers:s}=this;let{curRecognizer:r}=t;(!r||r&&r.state&Ze.Recognized)&&(r=t.curRecognizer=null);let o=0;for(;o<s.length;)i=s[o],t.stopped!==Yg&&(!r||i===r||i.canRecognizeWith(r))?i.recognize(e):i.reset(),!r&&i.state&(Ze.Began|Ze.Changed|Ze.Ended)&&(r=t.curRecognizer=i),o++}get(e){const{recognizers:t}=this;for(let i=0;i<t.length;i++)if(t[i].options.event===e)return t[i];return null}add(e){if(Array.isArray(e)){for(const i of e)this.add(i);return this}const t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const i of e)this.remove(i);return this}const t=typeof e=="string"?this.get(e):e;if(t){const{recognizers:i}=this,s=i.indexOf(t);s!==-1&&(i.splice(s,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;const{handlers:i}=this;for(const s of rc(e))i[s]=i[s]||[],i[s].push(t)}off(e,t){if(!e)return;const{handlers:i}=this;for(const s of rc(e))t?i[s]&&i[s].splice(i[s].indexOf(t),1):delete i[s]}emit(e,t){const i=this.handlers[e]&&this.handlers[e].slice();if(!i||!i.length)return;const s=t;s.type=e,s.preventDefault=function(){t.srcEvent.preventDefault()};let r=0;for(;r<i.length;)i[r](s),r++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:t}=this;if(t){for(const[i,s]of Object.entries(this.options.cssProps)){const r=XM(t.style,i);e?(this.oldCssProps[r]=t.style[r],t.style[r]=s):t.style[r]=this.oldCssProps[r]||""}e||(this.oldCssProps={})}}}let KM=1;function qM(){return KM++}function qg(n){return n&Ze.Cancelled?"cancel":n&Ze.Ended?"end":n&Ze.Changed?"move":n&Ze.Began?"start":""}class Yy{constructor(e){this.options=e,this.id=qM(),this.state=Ze.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const s of e)this.recognizeWith(s);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{simultaneous:i}=this;return i[t.id]||(i[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const i of e)this.dropRecognizeWith(i);return this}let t;return typeof e=="string"?t=this.manager.get(e):t=e,t&&delete this.simultaneous[t.id],this}requireFailure(e){if(Array.isArray(e)){for(const s of e)this.requireFailure(s);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{requireFail:i}=this;return i.indexOf(t)===-1&&(i.push(t),t.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const i of e)this.dropRequireFailure(i);return this}let t;if(typeof e=="string"?t=this.manager.get(e):t=e,t){const i=this.requireFail.indexOf(t);i>-1&&this.requireFail.splice(i,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:t}=this;t<Ze.Ended&&this.manager.emit(this.options.event+qg(t),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),t>=Ze.Ended&&this.manager.emit(this.options.event+qg(t),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=Ze.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(Ze.Failed|Ze.Possible)))return!1;e++}return!0}recognize(e){const t={...e};if(!this.options.enable){this.reset(),this.state=Ze.Failed;return}this.state&(Ze.Recognized|Ze.Cancelled|Ze.Failed)&&(this.state=Ze.Possible),this.state=this.process(t),this.state&(Ze.Began|Ze.Changed|Ze.Ended|Ze.Cancelled)&&this.tryEmit(t)}getEventNames(){return[this.options.event]}reset(){}}class Ky extends Yy{attrTest(e){const t=this.options.pointers;return t===0||e.pointers.length===t}process(e){const{state:t}=this,{eventType:i}=e,s=t&(Ze.Began|Ze.Changed),r=this.attrTest(e);return s&&(i&Qt.Cancel||!r)?t|Ze.Cancelled:s||r?i&Qt.End?t|Ze.Ended:t&Ze.Began?t|Ze.Changed:Ze.Began:Ze.Failed}}class Jg extends Yy{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[Bh]}process(e){const{options:t}=this,i=e.pointers.length===t.pointers,s=e.distance<t.threshold,r=e.deltaTime<t.time;if(this.reset(),e.eventType&Qt.Start&&this.count===0)return this.failTimeout();if(s&&r&&i){if(e.eventType!==Qt.End)return this.failTimeout();const o=this.pTime?e.timeStamp-this.pTime<t.interval:!0,a=!this.pCenter||$y(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!a||!o?this.count=1:this.count+=1,this._input=e,this.count%t.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=Ze.Recognized,this.tryEmit(this._input)},t.interval),Ze.Began):Ze.Recognized}return Ze.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=Ze.Failed},this.options.interval),Ze.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===Ze.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const JM=["","start","move","end","cancel","up","down","left","right"];class Zg extends Ky{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:Jt.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,t=[];return e&Jt.Horizontal&&t.push(Dh),e&Jt.Vertical&&t.push(Oh),t}getEventNames(){return JM.map(e=>this.options.event+e)}directionTest(e){const{options:t}=this;let i=!0,{distance:s}=e,{direction:r}=e;const o=e.deltaX,a=e.deltaY;return r&t.direction||(t.direction&Jt.Horizontal?(r=o===0?Jt.None:o<0?Jt.Left:Jt.Right,i=o!==this.pX,s=Math.abs(e.deltaX)):(r=a===0?Jt.None:a<0?Jt.Up:Jt.Down,i=a!==this.pY,s=Math.abs(e.deltaY))),e.direction=r,i&&s>t.threshold&&!!(r&t.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&Ze.Began)||!(this.state&Ze.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const t=Jt[e.direction].toLowerCase();t&&(e.additionalEvent=this.options.event+t),super.emit(e)}}const ZM=["","start","move","end","cancel","in","out"];class eB extends Ky{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[El]}getEventNames(){return ZM.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&Ze.Began))}emit(e){if(e.scale!==1){const t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}super.emit(e)}}class qc{constructor(e,t,i){this.element=e,this.callback=t,this.options=i}}const tB=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",nB=tB.indexOf("firefox")!==-1,ep=4.000244140625,iB=40,sB=.25;class rB extends qc{constructor(e,t,i){super(e,t,{enable:!0,...i}),this.handleEvent=s=>{if(!this.options.enable)return;let r=s.deltaY;globalThis.WheelEvent&&(nB&&s.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(r/=globalThis.devicePixelRatio),s.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(r*=iB)),r!==0&&r%ep===0&&(r=Math.floor(r/ep)),s.shiftKey&&r&&(r=r*sB),this.callback({type:"wheel",center:{x:s.clientX,y:s.clientY},delta:-r,srcEvent:s,pointerType:"mouse",target:s.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){e==="wheel"&&(this.options.enable=t)}}const tp=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class oB extends qc{constructor(e,t,i){super(e,t,{enable:!0,...i}),this.handleEvent=r=>{this.handleOverEvent(r),this.handleOutEvent(r),this.handleEnterEvent(r),this.handleLeaveEvent(r),this.handleMoveEvent(r)},this.pressed=!1;const{enable:s}=this.options;this.enableMoveEvent=s,this.enableLeaveEvent=s,this.enableEnterEvent=s,this.enableOutEvent=s,this.enableOverEvent=s,tp.forEach(r=>e.addEventListener(r,this.handleEvent))}destroy(){tp.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const np=["keydown","keyup"];class aB extends qc{constructor(e,t,i){super(e,t,{enable:!0,tabIndex:0,...i}),this.handleEvent=s=>{const r=s.target||s.srcElement;r.tagName==="INPUT"&&r.type==="text"||r.tagName==="TEXTAREA"||(this.enableDownEvent&&s.type==="keydown"&&this.callback({type:"keydown",srcEvent:s,key:s.key,target:s.target}),this.enableUpEvent&&s.type==="keyup"&&this.callback({type:"keyup",srcEvent:s,key:s.key,target:s.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",np.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){np.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e==="keydown"&&(this.enableDownEvent=t),e==="keyup"&&(this.enableUpEvent=t)}}class lB extends qc{constructor(e,t,i){super(e,t,i),this.handleEvent=s=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:s.clientX,y:s.clientY},srcEvent:s,pointerType:"mouse",target:s.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e==="contextmenu"&&(this.options.enable=t)}}const ip=1,Nh=2,sp=4,cB={pointerdown:ip,pointermove:Nh,pointerup:sp,mousedown:ip,mousemove:Nh,mouseup:sp},AB=0,uB=1,hB=2,fB=1,dB=2,gB=4;function pB(n){const e=cB[n.srcEvent.type];if(!e)return null;const{buttons:t,button:i}=n.srcEvent;let s=!1,r=!1,o=!1;return e===Nh?(s=!!(t&fB),r=!!(t&gB),o=!!(t&dB)):(s=i===AB,r=i===uB,o=i===hB),{leftButton:s,middleButton:r,rightButton:o}}function mB(n,e){const t=n.center;if(!t)return null;const i=e.getBoundingClientRect(),s=i.width/e.offsetWidth||1,r=i.height/e.offsetHeight||1,o={x:(t.x-i.left-e.clientLeft)/s,y:(t.y-i.top-e.clientTop)/r};return{center:t,offsetCenter:o}}const _B={srcElement:"root",priority:0};class yB{constructor(e,t){this.handleEvent=i=>{if(this.isEmpty())return;const s=this._normalizeEvent(i);let r=i.srcEvent.target;for(;r&&r!==s.rootElement;){if(this._emit(s,r),s.handled)return;r=r.parentNode}this._emit(s,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,i,s=!1,r=!1){const{handlers:o,handlersByElement:a}=this,l={..._B,...i};let f=a.get(l.srcElement);f||(f=[],a.set(l.srcElement,f));const g={type:e,handler:t,srcElement:l.srcElement,priority:l.priority};s&&(g.once=!0),r&&(g.passive=!0),o.push(g),this._active=this._active||!g.passive;let _=f.length-1;for(;_>=0&&!(f[_].priority>=g.priority);)_--;f.splice(_+1,0,g)}remove(e,t){const{handlers:i,handlersByElement:s}=this;for(let r=i.length-1;r>=0;r--){const o=i[r];if(o.type===e&&o.handler===t){i.splice(r,1);const a=s.get(o.srcElement);a.splice(a.indexOf(o),1),a.length===0&&s.delete(o.srcElement)}}this._active=i.some(r=>!r.passive)}_emit(e,t){const i=this.handlersByElement.get(t);if(i){let s=!1;const r=()=>{e.handled=!0},o=()=>{e.handled=!0,s=!0},a=[];for(let l=0;l<i.length;l++){const{type:f,handler:g,once:_}=i[l];if(g({...e,type:f,stopPropagation:r,stopImmediatePropagation:o}),_&&a.push(i[l]),s)break}for(let l=0;l<a.length;l++){const{type:f,handler:g}=a[l];this.remove(f,g)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...pB(e),...mB(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}function bB(n){if("recognizer"in n)return n;let e;const t=Array.isArray(n)?[...n]:[n];if(typeof t[0]=="function"){const i=t.shift(),s=t.shift()||{};e=new i(s)}else e=t.shift();return{recognizer:e,recognizeWith:typeof t[0]=="string"?[t[0]]:t[0],requireFailure:typeof t[1]=="string"?[t[1]]:t[1]}}class vB{constructor(e=null,t={}){if(this._onBasicInput=i=>{this.manager.emit(i.srcEvent.type,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=e,!!e){this.manager=new YM(e,this.options);for(const i of this.options.recognizers){const{recognizer:s,recognizeWith:r,requireFailure:o}=bB(i);this.manager.add(s),r&&s.recognizeWith(r),o&&s.requireFailure(o)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new rB(e,this._onOtherEvent,{enable:!1}),this.moveInput=new oB(e,this._onOtherEvent,{enable:!1}),this.keyInput=new aB(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new lB(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,i){this._addEventHandler(e,t,i,!1)}once(e,t,i){this._addEventHandler(e,t,i,!0)}watch(e,t,i){this._addEventHandler(e,t,i,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){var r,o,a,l;const{manager:i}=this;if(!i)return;const s=i.get(e);s&&(s.set({enable:t}),i.touchAction.update()),(r=this.wheelInput)==null||r.enableEventType(e,t),(o=this.moveInput)==null||o.enableEventType(e,t),(a=this.keyInput)==null||a.enableEventType(e,t),(l=this.contextmenuInput)==null||l.enableEventType(e,t)}_addEventHandler(e,t,i,s,r){if(typeof e!="string"){i=t;for(const[f,g]of Object.entries(e))this._addEventHandler(f,g,i,s,r);return}const{manager:o,events:a}=this;if(!o)return;let l=a.get(e);if(!l){const f=this._getRecognizerName(e)||e;l=new yB(this,f),a.set(e,l),o&&o.on(e,l.handleEvent)}l.add(e,t,i,s,r),l.isEmpty()||this._toggleRecognizer(l.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const[r,o]of Object.entries(e))this._removeEventHandler(r,o);return}const{events:i}=this,s=i.get(e);if(s&&(s.remove(e,t),s.isEmpty())){const{recognizerName:r}=s;let o=!1;for(const a of i.values())if(a.recognizerName===r&&!a.isEmpty()){o=!0;break}o||this._toggleRecognizer(r,!1)}}_getRecognizerName(e){var t;return(t=this.manager.recognizers.find(i=>i.getEventNames().includes(e)))==null?void 0:t.options.event}}const Ue={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Ue,"IDENTITY",{get:()=>(ze.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const ri={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},kn={common:0,meters:1,pixels:2},Fh={click:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},rp={multipan:[Zg,{threshold:10,direction:Jt.Vertical,pointers:2}],pinch:[eB,{},null,["multipan"]],pan:[Zg,{threshold:1},["pinch"],["multipan"]],dblclick:[Jg,{event:"dblclick",taps:2}],click:[Jg,{event:"click"},null,["dblclick"]]},J$={DRAW:"draw",MASK:"mask",TERRAIN:"terrain"},TB=Object.keys(Ue).map(n=>`const int COORDINATE_SYSTEM_${n} = ${Ue[n]};`).join(""),wB=Object.keys(ri).map(n=>`const int PROJECTION_MODE_${n} = ${ri[n]};`).join(""),EB=Object.keys(kn).map(n=>`const int UNIT_${n.toUpperCase()} = ${kn[n]};`).join(""),xB=`${TB}
${wB}
${EB}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`;function CB(n,e){if(n===e)return!0;if(Array.isArray(n)){const t=n.length;if(!e||e.length!==t)return!1;for(let i=0;i<t;i++)if(n[i]!==e[i])return!1;return!0}return!1}function ua(n){let e={},t;return i=>{for(const s in i)if(!CB(i[s],e[s])){t=n(i),e=i;break}return t}}const op=[0,0,0,0],SB=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],qy=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],IB=[0,0,0],Jy=[0,0,0],RB=ua(BB);function Zy(n,e,t=Jy){t.length<3&&(t=[t[0],t[1],0]);let i=t,s,r=!0;switch(e===Ue.LNGLAT_OFFSETS||e===Ue.METER_OFFSETS?s=t:s=n.isGeospatial?[Math.fround(n.longitude),Math.fround(n.latitude),0]:null,n.projectionMode){case ri.WEB_MERCATOR:(e===Ue.LNGLAT||e===Ue.CARTESIAN)&&(s=[0,0,0],r=!1);break;case ri.WEB_MERCATOR_AUTO_OFFSET:e===Ue.LNGLAT?i=s:e===Ue.CARTESIAN&&(i=[Math.fround(n.center[0]),Math.fround(n.center[1]),0],s=n.unprojectPosition(i),i[0]-=t[0],i[1]-=t[1],i[2]-=t[2]);break;case ri.IDENTITY:i=n.position.map(Math.fround),i[2]=i[2]||0;break;case ri.GLOBE:r=!1,s=null;break;default:r=!1}return{geospatialOrigin:s,shaderCoordinateOrigin:i,offsetMode:r}}function PB(n,e,t){const{viewMatrixUncentered:i,projectionMatrix:s}=n;let{viewMatrix:r,viewProjectionMatrix:o}=n,a=op,l=op,f=n.cameraPosition;const{geospatialOrigin:g,shaderCoordinateOrigin:_,offsetMode:v}=Zy(n,e,t);return v&&(l=n.projectPosition(g||_),f=[f[0]-l[0],f[1]-l[1],f[2]-l[2]],l[3]=1,a=oo([],l,o),r=i||r,o=Us([],s,r),o=Us([],o,SB)),{viewMatrix:r,viewProjectionMatrix:o,projectionCenter:a,originCommon:l,cameraPosCommon:f,shaderCoordinateOrigin:_,geospatialOrigin:g}}function MB({viewport:n,devicePixelRatio:e=1,modelMatrix:t=null,coordinateSystem:i=Ue.DEFAULT,coordinateOrigin:s=Jy,autoWrapLongitude:r=!1}){i===Ue.DEFAULT&&(i=n.isGeospatial?Ue.LNGLAT:Ue.CARTESIAN);const o=RB({viewport:n,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:s});return o.wrapLongitude=r,o.modelMatrix=t||qy,o}function BB({viewport:n,devicePixelRatio:e,coordinateSystem:t,coordinateOrigin:i}){const{projectionCenter:s,viewProjectionMatrix:r,originCommon:o,cameraPosCommon:a,shaderCoordinateOrigin:l,geospatialOrigin:f}=PB(n,t,i),g=n.getDistanceScales(),_=[n.width*e,n.height*e],v=oo([],[0,0,-n.focalDistance,1],n.projectionMatrix)[3]||1,T={coordinateSystem:t,projectionMode:n.projectionMode,coordinateOrigin:l,commonOrigin:o.slice(0,3),center:s,pseudoMeters:!!n._pseudoMeters,viewportSize:_,devicePixelRatio:e,focalDistance:v,commonUnitsPerMeter:g.unitsPerMeter,commonUnitsPerWorldUnit:g.unitsPerMeter,commonUnitsPerWorldUnit2:IB,scale:n.scale,wrapLongitude:!1,viewProjectionMatrix:r,modelMatrix:qy,cameraPosition:a};if(f){const C=n.getDistanceScales(f);switch(t){case Ue.METER_OFFSETS:T.commonUnitsPerWorldUnit=C.unitsPerMeter,T.commonUnitsPerWorldUnit2=C.unitsPerMeter2;break;case Ue.LNGLAT:case Ue.LNGLAT_OFFSETS:n._pseudoMeters||(T.commonUnitsPerMeter=C.unitsPerMeter),T.commonUnitsPerWorldUnit=C.unitsPerDegree,T.commonUnitsPerWorldUnit2=C.unitsPerDegree2;break;case Ue.CARTESIAN:T.commonUnitsPerWorldUnit=[1,1,C.unitsPerMeter[2]],T.commonUnitsPerWorldUnit2=[0,0,C.unitsPerMeter2[2]];break}}return T}const OB={};function DB(n=OB){return"viewport"in n?MB(n):{}}const Jf={name:"project",dependencies:[sM,Wy],vs:xB,getUniforms:DB,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},NB=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,sn={name:"project32",dependencies:[Jf],vs:NB};function FB(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Vr(n,e){const t=oo([],e,n);return Yf(t,t,1/t[3]),t}function ap(n,e){const t=n%e;return t<0?e+t:t}function LB(n,e,t){return t*e+(1-t)*n}function Lh(n,e,t){return n<e?e:n>t?t:n}function kB(n){return Math.log(n)*Math.LOG2E}const Zf=Math.log2||kB;function ki(n,e){if(!n)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const oi=Math.PI,eb=oi/4,Yn=oi/180,kh=180/oi,Xr=512,oc=4003e4,ac=85.051129,UB=1.5;function lp(n){return Math.pow(2,n)}function tb(n){return Zf(n)}function Ci(n){const[e,t]=n;ki(Number.isFinite(e)),ki(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const i=e*Yn,s=t*Yn,r=Xr*(i+oi)/(2*oi),o=Xr*(oi+Math.log(Math.tan(eb+s*.5)))/(2*oi);return[r,o]}function Ui(n){const[e,t]=n,i=e/Xr*(2*oi)-oi,s=2*(Math.atan(Math.exp(t/Xr*(2*oi)-oi))-eb);return[i*kh,s*kh]}function nb(n){const{latitude:e}=n;ki(Number.isFinite(e));const t=Math.cos(e*Yn);return tb(oc*t)-9}function du(n){const e=Math.cos(n*Yn);return Xr/oc/e}function Uh(n){const{latitude:e,longitude:t,highPrecision:i=!1}=n;ki(Number.isFinite(e)&&Number.isFinite(t));const s=Xr,r=Math.cos(e*Yn),o=s/360,a=o/r,l=s/oc/r,f={unitsPerMeter:[l,l,l],metersPerUnit:[1/l,1/l,1/l],unitsPerDegree:[o,a,l],degreesPerUnit:[1/o,1/a,1/l]};if(i){const g=Yn*Math.tan(e*Yn)/r,_=o*g/2,v=s/oc*g,T=v/a*l;f.unitsPerDegree2=[0,_,v],f.unitsPerMeter2=[T,0,T]}return f}function ib(n,e){const[t,i,s]=n,[r,o,a]=e,{unitsPerMeter:l,unitsPerMeter2:f}=Uh({longitude:t,latitude:i,highPrecision:!0}),g=Ci(n);g[0]+=r*(l[0]+f[0]*o),g[1]+=o*(l[1]+f[1]*o);const _=Ui(g),v=(s||0)+(a||0);return Number.isFinite(s)||Number.isFinite(a)?[_[0],_[1],v]:_}function VB(n){const{height:e,pitch:t,bearing:i,altitude:s,scale:r,center:o}=n,a=FB();sc(a,a,[0,0,-s]),Ry(a,a,-t*Yn),Py(a,a,i*Yn);const l=r/e;return Qf(a,a,[l,l,l]),o&&sc(a,a,$R([],o)),a}function zB(n){const{width:e,height:t,altitude:i,pitch:s=0,offset:r,center:o,scale:a,nearZMultiplier:l=1,farZMultiplier:f=1}=n;let{fovy:g=ea(UB)}=n;i!==void 0&&(g=ea(i));const _=g*Yn,v=s*Yn,T=Jc(g);let C=T;o&&(C+=o[2]*a/Math.cos(v)/t);const S=_*(.5+(r?r[1]:0)/t),R=Math.sin(S)*C/Math.sin(Lh(Math.PI/2-v-S,.01,Math.PI-.01)),P=Math.sin(v)*R+C,F=C*10,U=Math.min(P*f,F);return{fov:_,aspect:e/t,focalDistance:T,near:l,far:U}}function ea(n){return 2*Math.atan(.5/n)*kh}function Jc(n){return .5/Math.tan(.5*n*Yn)}function sb(n,e){const[t,i,s=0]=n;return ki(Number.isFinite(t)&&Number.isFinite(i)&&Number.isFinite(s)),Vr(e,[t,i,s,1])}function ha(n,e,t=0){const[i,s,r]=n;if(ki(Number.isFinite(i)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(r))return Vr(e,[i,s,r,1]);const o=Vr(e,[i,s,0,1]),a=Vr(e,[i,s,1,1]),l=o[2],f=a[2],g=l===f?0:((t||0)-l)/(f-l);return my([],o,a,g)}function HB(n){const{width:e,height:t,bounds:i,minExtent:s=0,maxZoom:r=24,offset:o=[0,0]}=n,[[a,l],[f,g]]=i,_=GB(n.padding),v=Ci([a,Lh(g,-85.051129,ac)]),T=Ci([f,Lh(l,-85.051129,ac)]),C=[Math.max(Math.abs(T[0]-v[0]),s),Math.max(Math.abs(T[1]-v[1]),s)],S=[e-_.left-_.right-Math.abs(o[0])*2,t-_.top-_.bottom-Math.abs(o[1])*2];ki(S[0]>0&&S[1]>0);const R=S[0]/C[0],P=S[1]/C[1],F=(_.right-_.left)/2/R,U=(_.top-_.bottom)/2/P,X=[(T[0]+v[0])/2+F,(T[1]+v[1])/2+U],Z=Ui(X),se=Math.min(r,Zf(Math.abs(Math.min(R,P))));return ki(Number.isFinite(se)),{longitude:Z[0],latitude:Z[1],zoom:se}}function GB(n=0){return typeof n=="number"?{top:n,bottom:n,left:n,right:n}:(ki(Number.isFinite(n.top)&&Number.isFinite(n.bottom)&&Number.isFinite(n.left)&&Number.isFinite(n.right)),n)}const cp=Math.PI/180;function WB(n,e=0){const{width:t,height:i,unproject:s}=n,r={targetZ:e},o=s([0,i],r),a=s([t,i],r);let l,f;const g=n.fovy?.5*n.fovy*cp:Math.atan(.5/n.altitude),_=(90-n.pitch)*cp;return g>_-.01?(l=Ap(n,0,e),f=Ap(n,t,e)):(l=s([0,0],r),f=s([t,0],r)),[o,a,f,l]}function Ap(n,e,t){const{pixelUnprojectionMatrix:i}=n,s=Vr(i,[e,0,1,1]),r=Vr(i,[e,n.height,1,1]),a=(t*n.distanceScales.unitsPerMeter[2]-s[2])/(r[2]-s[2]),l=my([],s,r,a),f=Ui(l);return f.push(t),f}const up=512;function jB(n){const{width:e,height:t,pitch:i=0}=n;let{longitude:s,latitude:r,zoom:o,bearing:a=0}=n;(s<-180||s>180)&&(s=ap(s+180,360)-180),(a<-180||a>180)&&(a=ap(a+180,360)-180);const l=Zf(t/up);if(o<=l)o=l,r=0;else{const f=t/2/Math.pow(2,o),g=Ui([0,f])[1];if(r<g)r=g;else{const _=Ui([0,up-f])[1];r>_&&(r=_)}}return{width:e,height:t,longitude:s,latitude:r,zoom:o,pitch:i,bearing:a}}const rb=.01,$B=["longitude","latitude","zoom"],ob={curve:1.414,speed:1.2};function XB(n,e,t,i){const{startZoom:s,startCenterXY:r,uDelta:o,w0:a,u1:l,S:f,rho:g,rho2:_,r0:v}=ab(n,e,i);if(l<rb){const X={};for(const Z of $B){const se=n[Z],Se=e[Z];X[Z]=LB(se,Se,t)}return X}const T=t*f,C=Math.cosh(v)/Math.cosh(v+g*T),S=a*((Math.cosh(v)*Math.tanh(v+g*T)-Math.sinh(v))/_)/l,R=1/C,P=s+tb(R),F=LR([],o,S);qo(F,F,r);const U=Ui(F);return{longitude:U[0],latitude:U[1],zoom:P}}function QB(n,e,t){const i={...ob,...t},{screenSpeed:s,speed:r,maxDuration:o}=i,{S:a,rho:l}=ab(n,e,i),f=1e3*a;let g;return Number.isFinite(s)?g=f/(s/l):g=f/r,Number.isFinite(o)&&g>o?0:g}function ab(n,e,t){t=Object.assign({},ob,t);const i=t.curve,s=n.zoom,r=[n.longitude,n.latitude],o=lp(s),a=e.zoom,l=[e.longitude,e.latitude],f=lp(a-s),g=Ci(r),_=Ci(l),v=zR([],_,g),T=Math.max(n.width,n.height),C=T/f,S=kR(v)*o,R=Math.max(S,rb),P=i*i,F=(C*C-T*T+P*P*R*R)/(2*T*P*R),U=(C*C-T*T-P*P*R*R)/(2*C*P*R),X=Math.log(Math.sqrt(F*F+1)-F),Z=Math.log(Math.sqrt(U*U+1)-U),se=(Z-X)/i;return{startZoom:s,startCenterXY:g,uDelta:v,w0:T,u1:S,S:se,rho:i,rho2:P,r0:X,r1:Z}}const lb=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,YB=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,KB=`
${lb}
${YB}
`,qB=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,JB=`
${lb}
${qB}
`,ZB=ua(sO),eO=ua(rO),tO=[0,0,0,1],nO=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function iO(n,e){const[t,i,s]=n,r=ha([t,i,s],e);return Number.isFinite(s)?r:[r[0],r[1],0]}function sO({viewport:n,center:e}){return new Ge(n.viewProjectionMatrix).invert().transform(e)}function rO({viewport:n,shadowMatrices:e}){const t=[],i=n.pixelUnprojectionMatrix,s=n.isGeospatial?void 0:1,r=[[0,0,s],[n.width,0,s],[0,n.height,s],[n.width,n.height,s],[0,0,-1],[n.width,0,-1],[0,n.height,-1],[n.width,n.height,-1]].map(o=>iO(o,i));for(const o of e){const a=o.clone().translate(new ee(n.center).negate()),l=r.map(g=>a.transform(g)),f=new Ge().ortho({left:Math.min(...l.map(g=>g[0])),right:Math.max(...l.map(g=>g[0])),bottom:Math.min(...l.map(g=>g[1])),top:Math.max(...l.map(g=>g[1])),near:Math.min(...l.map(g=>-g[2])),far:Math.max(...l.map(g=>-g[2]))});t.push(f.multiplyRight(o))}return t}function oO(n){const{shadowEnabled:e=!0,project:t}=n;if(!e||!t||!n.shadowMatrices||!n.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:n.dummyShadowMap,shadow_uShadowMap1:n.dummyShadowMap};const i=Jf.getUniforms(t),s=ZB({viewport:t.viewport,center:i.center}),r=[],o=eO({shadowMatrices:n.shadowMatrices,viewport:t.viewport}).slice();for(let l=0;l<n.shadowMatrices.length;l++){const f=o[l],g=f.clone().translate(new ee(t.viewport.center).negate());i.coordinateSystem===Ue.LNGLAT&&i.projectionMode===ri.WEB_MERCATOR?(o[l]=g,r[l]=s):(o[l]=f.clone().multiplyRight(nO),r[l]=g.transform(s))}const a={drawShadowMap:!!n.drawToShadowMap,useShadowMap:n.shadowMaps?n.shadowMaps.length>0:!1,color:n.shadowColor||tO,lightId:n.shadowLightId||0,lightCount:n.shadowMatrices.length,shadow_uShadowMap0:n.dummyShadowMap,shadow_uShadowMap1:n.dummyShadowMap};for(let l=0;l<o.length;l++)a[`viewProjectionMatrix${l}`]=o[l],a[`projectCenter${l}`]=r[l];for(let l=0;l<2;l++)a[`shadow_uShadowMap${l}`]=n.shadowMaps&&n.shadowMaps[l]||n.dummyShadowMap;return a}const hp={name:"shadow",dependencies:[Jf],vs:KB,fs:JB,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:oO,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},Un={...Vg,defaultUniforms:{...Vg.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},aO=[Wy],lO=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function cO(){const n=Wl.getDefaultShaderAssembler();for(const e of aO)n.addDefaultModule(e);for(const e of lO)n.addShaderHook(e);return n}const AO=[255,255,255],uO=1;let hO=0;class fO{constructor(e={}){this.type="ambient";const{color:t=AO}=e,{intensity:i=uO}=e;this.id=e.id||`ambient-${hO++}`,this.color=t,this.intensity=i}}const dO=[255,255,255],gO=1,pO=[0,0,-1];let mO=0;class fp{constructor(e={}){this.type="directional";const{color:t=dO}=e,{intensity:i=gO}=e,{direction:s=pO}=e,{_shadow:r=!1}=e;this.id=e.id||`directional-${mO++}`,this.color=t,this.intensity=i,this.type="directional",this.direction=new ee(s).normalize().toArray(),this.shadow=r}getProjectedLight(e){return this}}class cb{constructor(e,t={id:"pass"}){const{id:i}=t;this.id=i,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class ed extends cb{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[t,i]=this.device.canvasContext.getDrawingBufferSize(),s=e.clearCanvas??!0,r=e.clearColor??(s?[0,0,0,0]:!1),o=s?1:!1,a=s?0:!1,l=e.colorMask??15,f={viewport:[0,0,t,i]};e.colorMask&&(f.colorMask=l),e.scissorRect&&(f.scissorRect=e.scissorRect);const g=this.device.beginRenderPass({framebuffer:e.target,parameters:f,clearColor:r,clearDepth:o,clearStencil:a});try{return this._drawLayers(g,e)}finally{g.end()}}_drawLayers(e,t){const{target:i,shaderModuleProps:s,viewports:r,views:o,onViewportActive:a,clearStack:l=!0}=t;t.pass=t.pass||"unknown",l&&(this._lastRenderIndex=-1);const f=[];for(const g of r){const _=o&&o[g.id];a==null||a(g);const v=this._getDrawLayerParams(g,t),T=g.subViewports||[g];for(const C of T){const S=this._drawLayersInViewport(e,{target:i,shaderModuleProps:s,viewport:C,view:_,pass:t.pass,layers:t.layers},v);f.push(S)}}return f}_getDrawLayerParams(e,{layers:t,pass:i,isPicking:s=!1,layerFilter:r,cullRect:o,effects:a,shaderModuleProps:l},f=!1){var C;const g=[],_=Ab(this._lastRenderIndex+1),v={layer:t[0],viewport:e,isPicking:s,renderPass:i,cullRect:o},T={};for(let S=0;S<t.length;S++){const R=t[S],P=this._shouldDrawLayer(R,v,r,T),F={shouldDrawLayer:P};P&&!f&&(F.shouldDrawLayer=!0,F.layerRenderIndex=_(R,P),F.shaderModuleProps=this._getShaderModuleProps(R,a,i,l),F.layerParameters={...(C=R.context.deck)==null?void 0:C.props.parameters,...this.getLayerParameters(R,S,e)}),g[S]=F}return g}_drawLayersInViewport(e,{layers:t,shaderModuleProps:i,pass:s,target:r,viewport:o,view:a},l){const f=_O(this.device,{shaderModuleProps:i,target:r,viewport:o});if(a&&a.props.clear){const _=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;this.device.beginRenderPass({framebuffer:r,parameters:{viewport:f,scissorRect:f},clearColor:_.color?[0,0,0,0]:!1,clearDepth:_.depth?1:!1}).end()}const g={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:f});for(let _=0;_<t.length;_++){const v=t[_],T=l[_],{shouldDrawLayer:C}=T;if(C&&v.props.pickable&&g.pickableCount++,v.isComposite&&g.compositeCount++,v.isDrawable&&T.shouldDrawLayer){const{layerRenderIndex:S,shaderModuleProps:R,layerParameters:P}=T;g.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,S),R.project&&(R.project.viewport=o),v.context.renderPass=e;try{v._drawLayer({renderPass:e,shaderModuleProps:R,uniforms:{layerIndex:S},parameters:P})}catch(F){v.raiseError(F,`drawing ${v} to ${s}`)}}}return g}shouldDrawLayer(e){return!0}getShaderModuleProps(e,t,i){return null}getLayerParameters(e,t,i){return e.props.parameters}_shouldDrawLayer(e,t,i,s){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let o=e.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(t))return!1;t.layer=o,o=o.parent}if(i){const a=t.layer.id;if(a in s||(s[a]=i(t)),!s[a])return!1}return e.activateViewport(t.viewport),!0}_getShaderModuleProps(e,t,i,s){var l,f;const r=this.device.canvasContext.cssToDeviceRatio(),o=((l=e.internalState)==null?void 0:l.propsInTransition)||e.props,a={layer:o,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:r,modelMatrix:o.modelMatrix,coordinateSystem:o.coordinateSystem,coordinateOrigin:o.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(t)for(const g of t)dp(a,(f=g.getShaderModuleProps)==null?void 0:f.call(g,e,a));return dp(a,this.getShaderModuleProps(e,t,a),s)}}function Ab(n=0,e={}){const t={},i=(s,r)=>{const o=s.props._offset,a=s.id,l=s.parent&&s.parent.id;let f;if(l&&!(l in e)&&i(s.parent,!1),l in t){const g=t[l]=t[l]||Ab(e[l],e);f=g(s,r),t[a]=g}else Number.isFinite(o)?(f=o+(e[l]||0),t[a]=null):f=n;return r&&f>=n&&(n=f+1),e[a]=f,f};return i}function _O(n,{shaderModuleProps:e,target:t,viewport:i}){var l;const s=((l=e==null?void 0:e.project)==null?void 0:l.devicePixelRatio)??n.canvasContext.cssToDeviceRatio(),[,r]=n.canvasContext.getDrawingBufferSize(),o=t?t.height:r,a=i;return[a.x*s,o-(a.y+a.height)*s,a.width*s,a.height*s]}function dp(n,...e){for(const t of e)if(t)for(const i in t)n[i]?Object.assign(n[i],t[i]):n[i]=t[i];return n}class yO extends ed{constructor(e,t){super(e,t);const i=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),s=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[i],depthStencilAttachment:s})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const t=this.fbo,i=this.device.canvasContext.cssToDeviceRatio(),s=e.viewports[0],r=s.width*i,o=s.height*i,a=[1,1,1,1];(r!==t.width||o!==t.height)&&t.resize({width:r,height:o}),super.render({...e,clearColor:a,target:t,pass:"shadow"})}getLayerParameters(e,t,i){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,t,i){return{shadow:{project:i.project,drawToShadowMap:!0}}}}const bO={color:[255,255,255],intensity:1},gp=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],vO=[0,0,0,200/255];class ub{constructor(e={}){this.id="lighting-effect",this.shadowColor=vO,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:t,deck:i}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),i._addDefaultShaderModule(hp),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const t in e){const i=e[t];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:t,viewports:i,onViewportActive:s,views:r}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let o=0;o<this.shadowPasses.length;o++)this.shadowPasses[o].render({layers:e,layerFilter:t,viewports:i,onViewportActive:s,views:r,shaderModuleProps:{shadow:{shadowLightId:o,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,t){const i=this.shadow?{project:t.project,shadowMaps:this.shadowPasses.map(o=>o.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},s={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(o=>o.getProjectedLight({layer:e})),pointLights:this.pointLights.map(o=>o.getProjectedLight({layer:e}))},r=e.props.material;return{shadow:i,lighting:s,phongMaterial:r,gouraudMaterial:r}}cleanup(e){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(hp))}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const i=new Ge().lookAt({eye:new ee(t.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const i=new yO(e);this.shadowPasses[t]=i}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:i}=this;!e&&t.length===0&&i.length===0&&(this.ambientLight=new fO(bO),this.directionalLights.push(new fp(gp[0]),new fp(gp[1])))}}class TO{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:i=1,type:s,padding:r=0,copy:o=!1,initialize:a=!1,maxCount:l}){const f=s||e&&e.constructor||Float32Array,g=t*i+r;if(ArrayBuffer.isView(e)){if(g<=e.length)return e;if(g*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new f(e.buffer,0,g)}let _=1/0;l&&(_=l*i+r);const v=this._allocate(f,g,a,_);return e&&o?v.set(e):a||v.fill(0,0,4),this._release(e),v}release(e){this._release(e)}_allocate(e,t,i,s){let r=Math.max(Math.ceil(t*this.opts.overAlloc),1);r>s&&(r=s);const o=this._pool,a=e.BYTES_PER_ELEMENT*r,l=o.findIndex(f=>f.byteLength>=a);if(l>=0){const f=new e(o.splice(l,1)[0],0,r);return i&&f.fill(0),f}return new e(r)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:i}=e,{byteLength:s}=i,r=t.findIndex(o=>o.byteLength>=s);r<0?t.push(i):(r>0||t.length<this.opts.poolSize)&&t.splice(r,0,i),t.length>this.opts.poolSize&&t.shift()}}const Qr=new TO;function Fo(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function lc(n,e){const t=n%e;return t<0?e+t:t}function wO(n){return[n[12],n[13],n[14]]}function EO(n){return{left:Ar(n[3]+n[0],n[7]+n[4],n[11]+n[8],n[15]+n[12]),right:Ar(n[3]-n[0],n[7]-n[4],n[11]-n[8],n[15]-n[12]),bottom:Ar(n[3]+n[1],n[7]+n[5],n[11]+n[9],n[15]+n[13]),top:Ar(n[3]-n[1],n[7]-n[5],n[11]-n[9],n[15]-n[13]),near:Ar(n[3]+n[2],n[7]+n[6],n[11]+n[10],n[15]+n[14]),far:Ar(n[3]-n[2],n[7]-n[6],n[11]-n[10],n[15]-n[14])}}const pp=new ee;function Ar(n,e,t,i){pp.set(n,e,t);const s=pp.len();return{distance:i/s,normal:new ee(-n/s,-e/s,-t/s)}}function xO(n){return n-Math.fround(n)}let To;function gu(n,e){const{size:t=1,startIndex:i=0}=e,s=e.endIndex!==void 0?e.endIndex:n.length,r=(s-i)/t;To=Qr.allocate(To,r,{type:Float32Array,size:t*2});let o=i,a=0;for(;o<s;){for(let l=0;l<t;l++){const f=n[o++];To[a+l]=f,To[a+l+t]=xO(f)}a+=t*2}return To.subarray(0,r*t*2)}function CO(n){let e=null,t=!1;for(const i of n)i&&(e?(t||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],t=!0),e[0][0]=Math.min(e[0][0],i[0][0]),e[0][1]=Math.min(e[0][1],i[0][1]),e[1][0]=Math.max(e[1][0],i[1][0]),e[1][1]=Math.max(e[1][1],i[1][1])):e=i);return e}const SO=Math.PI/180,IO=Fo(),mp=[0,0,0],RO={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function PO({width:n,height:e,orthographic:t,fovyRadians:i,focalDistance:s,padding:r,near:o,far:a}){const l=n/e,f=t?new Ge().orthographic({fovy:i,aspect:l,focalDistance:s,near:o,far:a}):new Ge().perspective({fovy:i,aspect:l,near:o,far:a});if(r){const{left:g=0,right:_=0,top:v=0,bottom:T=0}=r,C=Ut((g+n-_)/2,0,n)-n/2,S=Ut((v+e-T)/2,0,e)-e/2;f[8]-=C*2/n,f[9]+=S*2/e}return f}class Kn{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||RO,this.focalDistance=e.focalDistance||1,this.position=e.position||mp,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?ri.WEB_MERCATOR:ri.WEB_MERCATOR_AUTO_OFFSET:ri.IDENTITY}equals(e){return e instanceof Kn?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Cn(e.projectionMatrix,this.projectionMatrix)&&Cn(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:t=!0}={}){const i=this.projectPosition(e),s=sb(i,this.pixelProjectionMatrix),[r,o]=s,a=t?o:this.height-o;return e.length===2?[r,a]:[r,a,s[2]]}unproject(e,{topLeft:t=!0,targetZ:i}={}){const[s,r,o]=e,a=t?r:this.height-r,l=i&&i*this.distanceScales.unitsPerMeter[2],f=ha([s,a,o],this.pixelUnprojectionMatrix,l),[g,_,v]=this.unprojectPosition(f);return Number.isFinite(o)?[g,_,v]:Number.isFinite(i)?[g,_,i]:[g,_]}projectPosition(e){const[t,i]=this.projectFlat(e),s=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,i,s]}unprojectPosition(e){const[t,i]=this.unprojectFlat(e),s=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,i,s]}projectFlat(e){if(this.isGeospatial){const t=Ci(e);return t[1]=Ut(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?Ui(e):e}getBounds(e={}){const t={targetZ:e.z||0},i=this.unproject([0,0],t),s=this.unproject([this.width,0],t),r=this.unproject([0,this.height],t),o=this.unproject([this.width,this.height],t);return[Math.min(i[0],s[0],r[0],o[0]),Math.min(i[1],s[1],r[1],o[1]),Math.max(i[0],s[0],r[0],o[0]),Math.max(i[1],s[1],r[1],o[1])]}getDistanceScales(e){return e&&this.isGeospatial?Uh({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:i=1,height:s=1}){return e<this.x+this.width&&this.x<e+i&&t<this.y+this.height&&this.y<t+s}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,EO(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=nb({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||Uh({latitude:i,longitude:t}));const s=Math.pow(2,this.zoom);this.scale=s;const{position:r,modelMatrix:o}=e;let a=mp;if(r&&(a=o?new Ge(o).transformAsVector(r,[]):r),this.isGeospatial){const l=this.projectPosition([t,i,0]);this.center=new ee(a).scale(this.distanceScales.unitsPerMeter).add(l)}else this.center=this.projectPosition(a)}_initMatrices(e){const{viewMatrix:t=IO,projectionMatrix:i=null,orthographic:s=!1,fovyRadians:r,fovy:o=75,near:a=.1,far:l=1e3,padding:f=null,focalDistance:g=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new Ge().multiplyRight(t).translate(new ee(this.center).negate()),this.projectionMatrix=i||PO({width:this.width,height:this.height,orthographic:s,fovyRadians:r||o*SO,focalDistance:g,padding:f,near:a,far:l});const _=Fo();Us(_,_,this.projectionMatrix),Us(_,_,this.viewMatrix),this.viewProjectionMatrix=_,this.viewMatrixInverse=Ph([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=wO(this.viewMatrixInverse);const v=Fo(),T=Fo();Qf(v,v,[this.width/2,-this.height/2,1]),sc(v,v,[1,-1,0]),Us(T,v,this.viewProjectionMatrix),this.pixelProjectionMatrix=T,this.pixelUnprojectionMatrix=Ph(Fo(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||ze.warn("Pixel project matrix not invertible")()}}Kn.displayName="Viewport";class fi extends Kn{constructor(e={}){const{latitude:t=0,longitude:i=0,zoom:s=0,pitch:r=0,bearing:o=0,nearZMultiplier:a=.1,farZMultiplier:l=1.01,nearZ:f,farZ:g,orthographic:_=!1,projectionMatrix:v,repeat:T=!1,worldOffset:C=0,position:S,padding:R,legacyMeterSizes:P=!1}=e;let{width:F,height:U,altitude:X=1.5}=e;const Z=Math.pow(2,s);F=F||1,U=U||1;let se,Se=null;if(v)X=v[5]/2,se=ea(X);else{e.fovy?(se=e.fovy,X=Jc(se)):se=ea(X);let J;if(R){const{top:q=0,bottom:L=0}=R;J=[0,Ut((q+U-L)/2,0,U)-U/2]}Se=zB({width:F,height:U,scale:Z,center:S&&[0,0,S[2]*du(t)],offset:J,pitch:r,fovy:se,nearZMultiplier:a,farZMultiplier:l}),Number.isFinite(f)&&(Se.near=f),Number.isFinite(g)&&(Se.far=g)}let me=VB({height:U,pitch:r,bearing:o,scale:Z,altitude:X});C&&(me=new Ge().translate([512*C,0,0]).multiplyLeft(me)),super({...e,width:F,height:U,viewMatrix:me,longitude:i,latitude:t,zoom:s,...Se,fovy:se,focalDistance:X}),this.latitude=t,this.longitude=i,this.zoom=s,this.pitch=r,this.bearing=o,this.altitude=X,this.fovy=se,this.orthographic=_,this._subViewports=T?[]:null,this._pseudoMeters=P,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let s=t;s<=i;s++){const r=s?new fi({...this,worldOffset:s}):this;this._subViewports.push(r)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,i]=this.projectFlat(e),s=(e[2]||0)*du(e[1]);return[t,i,s]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,i]=this.unprojectFlat(e),s=(e[2]||0)/du(i);return[t,i,s]}addMetersToLngLat(e,t){return ib(e,t)}panByPosition(e,t){const i=ha(t,this.pixelUnprojectionMatrix),s=this.projectFlat(e),r=qo([],s,py([],i)),o=qo([],this.center,r),[a,l]=this.unprojectFlat(o);return{longitude:a,latitude:l}}getBounds(e={}){const t=WB(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){const{width:i,height:s}=this,{longitude:r,latitude:o,zoom:a}=HB({width:i,height:s,bounds:e,...t});return new fi({width:i,height:s,longitude:r,latitude:o,zoom:a})}}fi.displayName="WebMercatorViewport";const _p=[0,0,0];function pu(n,e,t=!1){const i=e.projectPosition(n);if(t&&e instanceof fi){const[s,r,o=0]=n,a=e.getDistanceScales([s,r]);i[2]=o*a.unitsPerMeter[2]}return i}function MO(n){const{viewport:e,modelMatrix:t,coordinateOrigin:i}=n;let{coordinateSystem:s,fromCoordinateSystem:r,fromCoordinateOrigin:o}=n;return s===Ue.DEFAULT&&(s=e.isGeospatial?Ue.LNGLAT:Ue.CARTESIAN),r===void 0&&(r=s),o===void 0&&(o=i),{viewport:e,coordinateSystem:s,coordinateOrigin:i,modelMatrix:t,fromCoordinateSystem:r,fromCoordinateOrigin:o}}function hb(n,{viewport:e,modelMatrix:t,coordinateSystem:i,coordinateOrigin:s,offsetMode:r}){let[o,a,l=0]=n;switch(t&&([o,a,l]=oo([],[o,a,l,1],t)),i){case Ue.LNGLAT:return pu([o,a,l],e,r);case Ue.LNGLAT_OFFSETS:return pu([o+s[0],a+s[1],l+(s[2]||0)],e,r);case Ue.METER_OFFSETS:return pu(ib(s,[o,a,l]),e,r);case Ue.CARTESIAN:default:return e.isGeospatial?[o+s[0],a+s[1],l+s[2]]:e.projectPosition([o,a,l])}}function fb(n,e){const{viewport:t,coordinateSystem:i,coordinateOrigin:s,modelMatrix:r,fromCoordinateSystem:o,fromCoordinateOrigin:a}=MO(e),{autoOffset:l=!0}=e,{geospatialOrigin:f=_p,shaderCoordinateOrigin:g=_p,offsetMode:_=!1}=l?Zy(t,i,s):{},v=hb(n,{viewport:t,modelMatrix:r,coordinateSystem:o,coordinateOrigin:a,offsetMode:_});if(_){const T=t.projectPosition(f||g);Cy(v,v,T)}return v}const BO=[255,255,255],OO=1,DO=[1,0,0],NO=[0,0,1];let FO=0;class Z${constructor(e={}){this.type="point";const{color:t=BO}=e,{intensity:i=OO}=e,{position:s=NO}=e;this.id=e.id||`point-${FO++}`,this.color=t,this.intensity=i,this.type="point",this.position=s,this.attenuation=LO(e),this.projectedLight={...this}}getProjectedLight({layer:e}){const{projectedLight:t}=this,i=e.context.viewport,{coordinateSystem:s,coordinateOrigin:r}=e.props,o=fb(this.position,{viewport:i,coordinateSystem:s,coordinateOrigin:r,fromCoordinateSystem:i.isGeospatial?Ue.LNGLAT:Ue.CARTESIAN,fromCoordinateOrigin:[0,0,0]});return t.color=this.color,t.intensity=this.intensity,t.position=o,t}}function LO(n){return n.attenuation?n.attenuation:DO}let kO=1,UO=1;class db{constructor(){x(this,"time",0);x(this,"channels",new Map);x(this,"animations",new Map);x(this,"playing",!1);x(this,"lastEngineTime",-1)}addChannel(e){const{delay:t=0,duration:i=Number.POSITIVE_INFINITY,rate:s=1,repeat:r=1}=e,o=kO++,a={time:0,delay:t,duration:i,rate:s,repeat:r};return this._setChannelTime(a,this.time),this.channels.set(o,a),o}removeChannel(e){this.channels.delete(e);for(const[t,i]of this.animations)i.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return t===void 0?!1:this.time>=t.delay+t.duration*t.repeat}getTime(e){if(e===void 0)return this.time;const t=this.channels.get(e);return t===void 0?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const s of t)this._setChannelTime(s,this.time);const i=this.animations.values();for(const s of i){const{animation:r,channel:o}=s;r.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const i=UO++;return this.animations.set(i,{animation:e,channel:t}),e.setTime(this.getTime(t)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const i=t-e.delay,s=e.duration*e.repeat;i>=s?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}function VO(n){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(n):setTimeout(n,1e3/60)}function zO(n){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(n):clearTimeout(n)}let HO=0;const GO={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:n=>console.error(n),stats:_h.stats.get(`animation-loop-${HO++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class WO{constructor(e){x(this,"device",null);x(this,"canvas",null);x(this,"props");x(this,"animationProps",null);x(this,"timeline",null);x(this,"stats");x(this,"cpuTime");x(this,"gpuTime");x(this,"frameRate");x(this,"display");x(this,"needsRedraw","initialized");x(this,"_initialized",!1);x(this,"_running",!1);x(this,"_animationFrameId",null);x(this,"_nextFramePromise",null);x(this,"_resolveNextFrame",null);x(this,"_cpuStartTime",0);x(this,"_error",null);if(this.props={...GO,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:t=!0}=this.props;this.stats=e.stats||new so({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:t}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){var i,s;if(this.props.onError(e),this._error=Error(),((s=(i=this.device)==null?void 0:i.canvasContext)==null?void 0:s.canvas)instanceof HTMLCanvasElement){const r=document.createElement("h1");r.innerHTML=e.message,r.style.position="absolute",r.style.top="20%",r.style.left="10px",r.style.color="black",r.style.backgroundColor="red",document.body.appendChild(r)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=VO(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(zO(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){var t;if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),(t=this.device)==null||t.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var t,i;const e=(i=(t=this.device)==null?void 0:t.canvasContext)==null?void 0:i.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const i=this.props.onAddHTML(t);i&&(t.innerHTML=i)}}_getSizeAndAspect(){var r,o,a,l;if(!this.device)return{width:1,height:1,aspect:1};const[e,t]=((o=(r=this.device)==null?void 0:r.canvasContext)==null?void 0:o.getPixelSize())||[1,1];let i=1;const s=(l=(a=this.device)==null?void 0:a.canvasContext)==null?void 0:l.canvas;return s&&s.clientHeight?i=s.clientWidth/s.clientHeight:e>0&&t>0&&(i=e/t),{width:e,height:t,aspect:i}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,t;this.props.autoResizeDrawingBuffer&&((t=(e=this.device)==null?void 0:e.canvasContext)==null||t.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const mu={};function Ks(n="id"){mu[n]=mu[n]||1;const e=mu[n]++;return`${n}-${e}`}class yp{constructor(e){x(this,"id");x(this,"userData",{});x(this,"topology");x(this,"bufferLayout",[]);x(this,"vertexCount");x(this,"indices");x(this,"attributes");if(this.id=e.id||Ks("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&Ft.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){var e;(e=this.indices)==null||e.destroy();for(const t of Object.values(this.attributes))t.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function jO(n,e){if(e instanceof yp)return e;const t=$O(n,e),{attributes:i,bufferLayout:s}=XO(n,e);return new yp({topology:e.topology||"triangle-list",bufferLayout:s,vertexCount:e.vertexCount,indices:t,attributes:i})}function $O(n,e){if(!e.indices)return;const t=e.indices.value;return n.createBuffer({usage:Ft.INDEX,data:t})}function XO(n,e){const t=[],i={};for(const[r,o]of Object.entries(e.attributes)){let a=r;switch(r){case"POSITION":a="positions";break;case"NORMAL":a="normals";break;case"TEXCOORD_0":a="texCoords";break;case"COLOR_0":a="colors";break}if(o){i[a]=n.createBuffer({data:o.value,id:`${r}-buffer`});const{value:l,size:f,normalized:g}=o;t.push({name:a,format:KI(l,f,g)})}}const s=e._calculateVertexCount(e.attributes,e.indices);return{attributes:i,bufferLayout:t,vertexCount:s}}const Wc=class Wc{constructor(e){x(this,"device");x(this,"destroyPolicy");x(this,"_hashCounter",0);x(this,"_hashes",{});x(this,"_renderPipelineCache",{});x(this,"_computePipelineCache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new Wc(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const t={...jr.defaultProps,...e},i=this._hashRenderPipeline(t);if(!this._renderPipelineCache[i]){const s=this.device.createRenderPipeline({...t,id:t.id?`${t.id}-cached`:void 0});s.hash=i,this._renderPipelineCache[i]={pipeline:s,useCount:0}}return this._renderPipelineCache[i].useCount++,this._renderPipelineCache[i].pipeline}createComputePipeline(e){const t={...Yl.defaultProps,...e},i=this._hashComputePipeline(t);if(!this._computePipelineCache[i]){const s=this.device.createComputePipeline({...t,id:t.id?`${t.id}-cached`:void 0});s.hash=i,this._computePipelineCache[i]={pipeline:s,useCount:0}}return this._computePipelineCache[i].useCount++,this._computePipelineCache[i].pipeline}release(e){const t=e.hash,i=e instanceof Yl?this._computePipelineCache:this._renderPipelineCache;i[t].useCount--,i[t].useCount===0&&this.destroyPolicy==="unused"&&(i[t].pipeline.destroy(),delete i[t])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const t=e.vs?this._getHash(e.vs.source):0,i=e.fs?this._getHash(e.fs.source):0,s="-",r=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${t}/${i}V${s}BL${r}`;default:const o=this._getHash(JSON.stringify(e.parameters));return`${t}/${i}V${s}T${e.topology}P${o}BL${r}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};x(Wc,"defaultProps",{...jr.defaultProps});let Vh=Wc;const jc=class jc{constructor(e){x(this,"device");x(this,"destroyPolicy");x(this,"_cache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultShaderFactory(e){var t;return(t=e._lumaData).defaultShaderFactory||(t.defaultShaderFactory=new jc(e)),e._lumaData.defaultShaderFactory}createShader(e){const t=this._hashShader(e);let i=this._cache[t];if(!i){const s=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=i={shader:s,useCount:0}}return i.useCount++,i.shader}release(e){const t=this._hashShader(e),i=this._cache[t];i&&(i.useCount--,i.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[t],i.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};x(jc,"defaultProps",{...$l.defaultProps});let zh=jc;function QO(n,e){var s;const t={},i="Values";if(n.attributes.length===0&&!((s=n.varyings)!=null&&s.length))return{"No attributes or varyings":{[i]:"N/A"}};for(const r of n.attributes)if(r){const o=`${r.location} ${r.name}: ${r.type}`;t[`in ${o}`]={[i]:r.stepMode||"vertex"}}for(const r of n.varyings||[]){const o=`${r.location} ${r.name}`;t[`out ${o}`]={[i]:JSON.stringify(r)}}return t}let nn=null,xs=null;function YO(n,{id:e,minimap:t,opaque:i,top:s="0",left:r="0",rgbaScale:o=1}){nn||(nn=document.createElement("canvas"),nn.id=e,nn.title=e,nn.style.zIndex="100",nn.style.position="absolute",nn.style.top=s,nn.style.left=r,nn.style.border="blue 5px solid",nn.style.transform="scaleY(-1)",document.body.appendChild(nn),xs=nn.getContext("2d")),(nn.width!==n.width||nn.height!==n.height)&&(nn.width=n.width/2,nn.height=n.height/2,nn.style.width="400px",nn.style.height="400px");const a=n.device.readPixelsToArrayWebGL(n),l=xs==null?void 0:xs.createImageData(n.width,n.height);if(l){for(let g=0;g<a.length;g+=4)l.data[0+g+0]=a[g+0]*o,l.data[0+g+1]=a[g+1]*o,l.data[0+g+2]=a[g+2]*o,l.data[0+g+3]=i?255:a[g+3]*o;xs==null||xs.putImageData(l,0,0)}}function Hh(n,e,t){if(n===e)return!0;if(!t||!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(!Hh(n[i],e[i],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const i=Object.keys(n),s=Object.keys(e);if(i.length!==s.length)return!1;for(const r of i)if(!e.hasOwnProperty(r)||!Hh(n[r],e[r],t-1))return!1;return!0}return!1}function KO(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function qO(n){return Array.isArray(n)?n.length===0||typeof n[0]=="number":!1}function gb(n){return KO(n)||qO(n)}function JO(n){return gb(n)||typeof n=="number"||typeof n=="boolean"}function pb(n){const e={bindings:{},uniforms:{}};return Object.keys(n).forEach(t=>{const i=n[t];JO(i)?e.uniforms[t]=i:e.bindings[t]=i}),e}class ZO{constructor(e,t){x(this,"options",{disableWarnings:!1});x(this,"modules");x(this,"moduleUniforms");x(this,"moduleBindings");Object.assign(this.options,t);const i=Bf(Object.values(e).filter(s=>s.dependencies));for(const s of i)e[s.name]=s;ye.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[s,r]of Object.entries(e))this._addModule(r),r.name&&s!==r.name&&!this.options.disableWarnings&&ye.warn(`Module name: ${s} vs ${r.name}`)()}destroy(){}setProps(e){var t;for(const i of Object.keys(e)){const s=i,r=e[s]||{},o=this.modules[s];if(!o){this.options.disableWarnings||ye.warn(`Module ${i} not found`)();continue}const a=this.moduleUniforms[s],l=this.moduleBindings[s],f=((t=o.getUniforms)==null?void 0:t.call(o,r,a))||r,{uniforms:g,bindings:_}=pb(f);this.moduleUniforms[s]={...a,...g},this.moduleBindings[s]={...l,..._}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){var t;const e={};for(const[i,s]of Object.entries(this.moduleUniforms))for(const[r,o]of Object.entries(s))e[`${i}.${r}`]={type:(t=this.modules[i].uniformTypes)==null?void 0:t[r],value:String(o)};return e}_addModule(e){const t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}let e4="";async function t4(n,e){const t=new Image;return t.crossOrigin="anonymous",t.src=n.startsWith("http")?n:e4+n,await t.decode(),e?await createImageBitmap(t,e):await createImageBitmap(t)}class _u{constructor(e,t){x(this,"device");x(this,"id");x(this,"texture");x(this,"sampler");x(this,"view");x(this,"ready");x(this,"isReady",!1);x(this,"destroyed",!1);x(this,"resolveReady",()=>{});x(this,"rejectReady",()=>{});this.device=e,this.id=t.id||Ks("async-texture"),typeof(t==null?void 0:t.data)=="string"&&t.dimension==="2d"&&(t={...t,data:t4(t.data)}),this.ready=new Promise((i,s)=>{this.resolveReady=()=>{this.isReady=!0,i()},this.rejectReady=s}),this.initAsync(t)}get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}async initAsync(e){let t,i;const s=e.data,r=await mb(s).then(t,i);if(this.destroyed)return;const o={...e,data:r};this.texture=this.device.createTexture(o),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}}async function mb(n){if(n=await n,Array.isArray(n))return await Promise.all(n.map(mb));if(n&&typeof n=="object"&&n.constructor===Object){const e=n,t=await Promise.all(Object.values(e)),i=Object.keys(e),s={};for(let r=0;r<i.length;r++)s[i[r]]=t[r];return s}return n}const Cs=2,n4=1e4,$c=class $c{constructor(e,t){x(this,"device");x(this,"id");x(this,"source");x(this,"vs");x(this,"fs");x(this,"pipelineFactory");x(this,"shaderFactory");x(this,"userData",{});x(this,"parameters");x(this,"topology");x(this,"bufferLayout");x(this,"isInstanced");x(this,"instanceCount",0);x(this,"vertexCount");x(this,"indexBuffer",null);x(this,"bufferAttributes",{});x(this,"constantAttributes",{});x(this,"bindings",{});x(this,"uniforms",{});x(this,"vertexArray");x(this,"transformFeedback",null);x(this,"pipeline");x(this,"shaderInputs");x(this,"_uniformStore");x(this,"_attributeInfos",{});x(this,"_gpuGeometry",null);x(this,"_getModuleUniforms");x(this,"props");x(this,"_pipelineNeedsUpdate","newly created");x(this,"_needsRedraw","initializing");x(this,"_destroyed",!1);x(this,"_lastDrawTimestamp",-1);x(this,"_lastLogTime",0);x(this,"_logOpen",!1);x(this,"_drawCount",0);var l,f,g,_;this.props={...$c.defaultProps,...t},t=this.props,this.id=t.id||Ks("model"),this.device=e,Object.assign(this.userData,t.userData);const i=Object.fromEntries(((l=this.props.modules)==null?void 0:l.map(v=>[v.name,v]))||[]),s=t.shaderInputs||new ZO(i,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(s);const r=s4(e),o=(((f=this.props.modules)==null?void 0:f.length)>0?this.props.modules:(g=this.shaderInputs)==null?void 0:g.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){(_=this.props).shaderLayout||(_.shaderLayout=xR(this.props.source));const{source:v,getUniforms:T}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:r,...this.props,modules:o});this.source=v,this._getModuleUniforms=T}else{const{vs:v,fs:T,getUniforms:C}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:r,...this.props,modules:o});this.vs=v,this.fs=T,this._getModuleUniforms=C}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||Vh.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||zh.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.uniforms&&this.setUniformsWebGL(t.uniforms),t.moduleSettings&&this.updateModuleSettingsWebGL(t.moduleSettings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const t=this._areBindingsLoading();if(t)return ye.info(Cs,`>>> DRAWING ABORTED ${this.id}: ${t} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let i;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const s=this._getBindings();this.pipeline.setBindings(s,{disableWarnings:this.props.disableWarnings}),Gh(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:r}=this.vertexArray,o=r?r.byteLength/(r.indexType==="uint32"?4:2):void 0;i=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:o,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),i?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",i}setGeometry(e){var i;(i=this._gpuGeometry)==null||i.destroy();const t=e&&jO(this.device,e);if(t){this.setTopology(t.topology||"triangle-list");const s=new ru(this.bufferLayout);this.bufferLayout=s.mergeBufferLayouts(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t)}this._gpuGeometry=t}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const t=new ru(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){Hh(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new YI(this.shaderInputs.modules);for(const[t,i]of Object.entries(this.shaderInputs.modules))if(i4(i)){const s=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[`${t}Uniforms`]=s}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){const i=(t==null?void 0:t.disableWarnings)??this.props.disableWarnings;e.indices&&ye.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();const s=new ru(this.bufferLayout);for(const[r,o]of Object.entries(e)){const a=s.getBufferLayout(r);if(!a){i||ye.warn(`Model(${this.id}): Missing layout for buffer "${r}".`)();continue}const l=s.getAttributeNamesForBuffer(a);let f=!1;for(const g of l){const _=this._attributeInfos[g];_&&(this.vertexArray.setBuffer(_.location,o),f=!0)}!f&&!i&&ye.warn(`Model(${this.id}): Ignoring buffer "${o.id}" for unknown attribute "${r}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[i,s]of Object.entries(e)){const r=this._attributeInfos[i];r?this.vertexArray.setConstantWebGL(r.location,s):((t==null?void 0:t.disableWarnings)??this.props.disableWarnings)||ye.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${i}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){Gh(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){const{bindings:t,uniforms:i}=pb(this._getModuleUniforms(e));Object.assign(this.bindings,t),Object.assign(this.uniforms,i),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof _u&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[t,i]of Object.entries(this.bindings))i instanceof _u?i.isReady&&(e[t]=i.texture):e[t]=i;return e}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof jl?e=Math.max(e,t.texture.updateTimestamp):t instanceof Ft||t instanceof kt?e=Math.max(e,t.updateTimestamp):t instanceof _u?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof Xl||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t={...e.attributes};for(const[i]of Object.entries(t))!this.pipeline.shaderLayout.attributes.find(s=>s.name===i)&&i!=="positions"&&delete t[i];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(ye.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const i=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let s=null;this.source?s=i:this.fs&&(s=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:i,fs:s}),this._attributeInfos=j1(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_logDrawCallStart(){const e=ye.level>3?0:n4;ye.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,ye.group(Cs,`>>> DRAWING MODEL ${this.id}`,{collapsed:ye.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=QO(this.pipeline.shaderLayout,this.id);ye.table(Cs,e)();const t=this.shaderInputs.getDebugTable();for(const[s,r]of Object.entries(this.uniforms))t[s]={value:r};ye.table(Cs,t)();const i=this._getAttributeDebugTable();ye.table(Cs,this._attributeInfos)(),ye.table(Cs,i)(),ye.groupEnd(Cs)(),this._logOpen=!1}}_logFramebuffer(e){const t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;const i=e.props.framebuffer;i&&YO(i,{id:i.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,i]of Object.entries(this._attributeInfos)){const s=this.vertexArray.attributes[i.location];e[i.location]={name:t,type:i.shaderType,values:s?this._getBufferOrConstantValues(s,i.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,i=t.indexType==="uint32"?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:i.toString()}}return e}_getBufferOrConstantValues(e,t){const i=Q1(t);return(e instanceof Ft?new i(e.debugData):e).toString()}};x($c,"defaultProps",{...jr.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Wl.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let Nt=$c;function i4(n){return!!(n.uniformTypes&&!Gh(n.uniformTypes))}function s4(n){return{type:n.type,shaderLanguage:n.info.shadingLanguage,shaderLanguageVersion:n.info.shadingLanguageVersion,gpu:n.info.gpu,features:n.features}}function Gh(n){for(const e in n)return!1;return!0}const Ko=class Ko{constructor(e,t=Ko.defaultProps){x(this,"device");x(this,"model");x(this,"transformFeedback");if(!Ko.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new Nt(this.device,{id:t.id||"buffer-transform-model",fs:t.fs||L1(),topology:t.topology||"point-list",varyings:t.outputs||t.varyings,...t}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var t;return((t=e==null?void 0:e.info)==null?void 0:t.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e!=null&&e.inputBuffers&&this.model.setAttributes(e.inputBuffers),e!=null&&e.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const t=this.getBuffer(e);if(!t)throw new Error("BufferTransform#getBuffer");if(t instanceof Ft)return t.readAsync();const{buffer:i,byteOffset:s=0,byteLength:r=i.byteLength}=t;return i.readAsync(s,r)}};x(Ko,"defaultProps",{...Nt.defaultProps,outputs:void 0,feedbackBuffers:void 0});let Yr=Ko;const r4="transform_output";class bp{constructor(e,t){x(this,"device");x(this,"model");x(this,"sampler");x(this,"currentIndex",0);x(this,"samplerTextureMap",null);x(this,"bindings",[]);x(this,"resources",{});this.device=e,this.sampler=e.createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",minFilter:"nearest",magFilter:"nearest",mipmapFilter:"nearest"}),this.model=new Nt(this.device,{id:t.id||"texture-transform-model",fs:t.fs||L1({input:t.targetTextureVarying,inputChannels:t.targetTextureChannels,output:r4}),vertexCount:t.vertexCount,...t}),this._initialize(t),Object.seal(this)}destroy(){var e;this.model.destroy();for(const t of this.bindings)(e=t.framebuffer)==null||e.destroy()}delete(){this.destroy()}run(e){const{framebuffer:t}=this.bindings[this.currentIndex],i=this.device.beginRenderPass({framebuffer:t,...e});this.model.draw(i),i.end()}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}_initialize(e){this._updateBindings(e)}_updateBindings(e){this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e)}_updateBinding(e,{sourceBuffers:t,sourceTextures:i,targetTexture:s}){if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,i),Object.assign(e.sourceBuffers,t),s){e.targetTexture=s;const{width:r,height:o}=s;e.framebuffer&&e.framebuffer.destroy(),e.framebuffer=this.device.createFramebuffer({id:"transform-framebuffer",width:r,height:o,colorAttachments:[s]}),e.framebuffer.resize({width:r,height:o})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:t}=this.bindings[e];for(const i in t)t[i].sampler=this.sampler}}class un{constructor(e){x(this,"id");x(this,"topology");x(this,"vertexCount");x(this,"indices");x(this,"attributes");x(this,"userData",{});const{attributes:t={},indices:i=null,vertexCount:s=null}=e;this.id=e.id||Ks("geometry"),this.topology=e.topology,i&&(this.indices=ArrayBuffer.isView(i)?{value:i,size:1}:i),this.attributes={};for(const[r,o]of Object.entries(t)){const a=ArrayBuffer.isView(o)?{value:o}:o;if(!ArrayBuffer.isView(a.value))throw new Error(`${this._print(r)}: must be typed array or object with value as typed array`);if((r==="POSITION"||r==="positions")&&!a.size&&(a.size=3),r==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=a}else this.attributes[r]=a}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=s||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let i=1/0;for(const s of Object.values(e)){const{value:r,size:o,constant:a}=s;!a&&r&&o!==void 0&&o>=1&&(i=Math.min(i,r.length/o))}return i}}const o4=`struct VertexInputs {
  @location(0) clipSpacePosition: vec2<f32>,
  @location(1) texCoord: vec2<f32>,
  @location(2) coordinate: vec2<f32>  
}

struct FragmentInputs {
  @builtin(position) Position : vec4<f32>,
  @location(0) position : vec2<f32>,
  @location(1) coordinate : vec2<f32>,
  @location(2) uv : vec2<f32>
};

@vertex
fn vertexMain(inputs: VertexInputs) -> FragmentInputs {
  var outputs: FragmentInputs;
  outputs.Position = vec4(inputs.clipSpacePosition, 0., 1.);
  outputs.position = inputs.clipSpacePosition;
  outputs.coordinate = inputs.coordinate;
  outputs.uv = inputs.texCoord;
  return outputs;
}
`,a4=`#version 300 es
in vec2 clipSpacePositions;
in vec2 texCoords;
in vec2 coordinates;

out vec2 position;
out vec2 coordinate;
out vec2 uv;

void main(void) {
  gl_Position = vec4(clipSpacePositions, 0., 1.);
  position = clipSpacePositions;
  coordinate = coordinates;
  uv = texCoords;
}
`,vp=[-1,-1,1,-1,-1,1,1,1];class l4 extends Nt{constructor(e,t){const i=vp.map(s=>s===-1?0:s);t.source&&(t={...t,source:`${o4}
${t.source}`}),super(e,{id:t.id||Ks("clip-space"),...t,vs:a4,vertexCount:4,geometry:new un({topology:"triangle-strip",vertexCount:4,attributes:{clipSpacePositions:{size:2,value:new Float32Array(vp)},texCoords:{size:2,value:new Float32Array(i)},coordinates:{size:2,value:new Float32Array(i)}}})})}}class cc{constructor(e={}){x(this,"id");x(this,"matrix",new Ge);x(this,"display",!0);x(this,"position",new ee);x(this,"rotation",new ee);x(this,"scale",new ee(1,1,1));x(this,"userData",{});x(this,"props",{});const{id:t}=e;this.id=t||Ks(this.constructor.name),this._setScenegraphNodeProps(e)}getBounds(){return null}destroy(){}delete(){this.destroy()}setProps(e){return this._setScenegraphNodeProps(e),this}toString(){return`{type: ScenegraphNode, id: ${this.id})}`}setPosition(e){return this.position=e,this}setRotation(e){return this.rotation=e,this}setScale(e){return this.scale=e,this}setMatrix(e,t=!0){t?this.matrix.copy(e):this.matrix=e}setMatrixComponents(e){const{position:t,rotation:i,scale:s,update:r=!0}=e;return t&&this.setPosition(t),i&&this.setRotation(i),s&&this.setScale(s),r&&this.updateMatrix(),this}updateMatrix(){const e=this.position,t=this.rotation,i=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(t),this.matrix.scale(i),this}update(e={}){const{position:t,rotation:i,scale:s}=e;return t&&this.setPosition(t),i&&this.setRotation(i),s&&this.setScale(s),this.updateMatrix(),this}getCoordinateUniforms(e,t){t=t||this.matrix;const i=new Ge(e).multiplyRight(t),s=i.invert(),r=s.transpose();return{viewMatrix:e,modelMatrix:t,objectMatrix:t,worldMatrix:i,worldInverseMatrix:s,worldInverseTransposeMatrix:r}}_setScenegraphNodeProps(e){"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}}class zr extends cc{constructor(t={}){t=Array.isArray(t)?{children:t}:t;const{children:i=[]}=t;ye.assert(i.every(s=>s instanceof cc),"every child must an instance of ScenegraphNode");super(t);x(this,"children");this.children=i}getBounds(){const t=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((i,{worldMatrix:s})=>{const r=i.getBounds();if(!r)return;const[o,a]=r,l=new ee(o).add(a).divide([2,2,2]);s.transformAsPoint(l,l);const f=new ee(a).subtract(o).divide([2,2,2]);s.transformAsVector(f,f);for(let g=0;g<8;g++){const _=new ee(g&1?-1:1,g&2?-1:1,g&4?-1:1).multiply(f).add(l);for(let v=0;v<3;v++)t[0][v]=Math.min(t[0][v],_[v]),t[1][v]=Math.max(t[1][v],_[v])}}),Number.isFinite(t[0][0])?t:null}destroy(){this.children.forEach(t=>t.destroy()),this.removeAll(),super.destroy()}add(...t){for(const i of t)Array.isArray(i)?this.add(...i):this.children.push(i);return this}remove(t){const i=this.children,s=i.indexOf(t);return s>-1&&i.splice(s,1),this}removeAll(){return this.children=[],this}traverse(t,{worldMatrix:i=new Ge}={}){const s=new Ge(i).multiplyRight(this.matrix);for(const r of this.children)r instanceof zr?r.traverse(t,{worldMatrix:s}):t(r,{worldMatrix:s})}}class Wh extends cc{constructor(t){super(t);x(this,"model");x(this,"bounds",null);x(this,"managedResources");this.model=t.model,this.managedResources=t.managedResources||[],this.bounds=t.bounds||null,this.setProps(t)}destroy(){this.model&&(this.model.destroy(),this.model=null),this.managedResources.forEach(t=>t.destroy()),this.managedResources=[]}getBounds(){return this.bounds}draw(t){return this.model.draw(t)}}class _b extends un{constructor(e={}){const{id:t=Ks("cube-geometry"),indices:i=!0}=e;super(i?{...e,id:t,topology:"triangle-list",indices:{size:1,value:c4},attributes:{...p4,...e.attributes}}:{...e,id:t,topology:"triangle-list",indices:void 0,attributes:{...m4,...e.attributes}})}}const c4=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),A4=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),u4=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),h4=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),f4=new Float32Array([1,-1,1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,-1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,1,1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,-1,1,1,1,-1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1]),d4=new Float32Array([1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,1,0,0]),g4=new Float32Array([1,0,1,1,0,0,1,1,0,0,0,1,1,0,0,1,1,0,1,1,0,0,0,1,1,1,1,1,1,0,1,1,1,0,0,1,1,1,0,1,1,1,1,1,1,0,0,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1,0,1,0,1,1,1,1,1,0,1,0,0,1,1,0,1,1,1,0,1,0,1,0,0,0,1,0,0,1,1,0,1,0,1,1,1,1,1,0,1,1,1,0,0,1,1,0,0,1,1,1,0,1,1,1,1,1,1,1,0,0,1,0,0,0,1,0,1,0,1,1,1,0,1,1,0,0,1,0,1,0,1]),p4={POSITION:{size:3,value:A4},NORMAL:{size:3,value:u4},TEXCOORD_0:{size:2,value:h4}},m4={POSITION:{size:3,value:f4},TEXCOORD_0:{size:2,value:d4},COLOR_0:{size:3,value:g4}},_4=`uniform screenUniforms {
  vec2 texSize;
} screen;
`,y4={name:"screen",fs:_4,uniformTypes:{texSize:"vec2<f32>"}};class b4 extends cb{constructor(e,t){super(e,t);const{module:i,fs:s,id:r}=t,o={depthWriteEnabled:!1,depthCompare:"always"};this.model=new l4(e,{id:r,fs:s,modules:[i,y4],parameters:o})}render(e){this._renderPass(this.device,e)}delete(){this.model.destroy(),this.model=null}_renderPass(e,t){const{clearCanvas:i,inputBuffer:s,outputBuffer:r}=t,o=[s.width,s.height],a={texSrc:s.colorAttachments[0],texSize:o};this.model.shaderInputs.setProps({screen:a,...t.moduleProps});const l=this.device.beginRenderPass({framebuffer:r,parameters:{viewport:[0,0,...o]},clearColor:i?[0,0,0,0]:!1,clearDepth:1});this.model.draw(l),l.end()}}class eX{constructor(e,t){this.id=`${e.name}-pass`,this.props=t,I1(e),this.module=e}setup({device:e}){this.passes=v4(e,this.module,this.id)}setProps(e){this.props=e}preRender(){}postRender(e){const t=this.passes,{target:i}=e;let s=e.inputBuffer,r=e.swapBuffer;for(let o=0;o<t.length;o++){const a=o===t.length-1,l=i!==void 0&&a;l&&(r=i);const f=!l||!!e.clearCanvas,g={},_=this.module.passes[o].uniforms;g[this.module.name]={...this.props,..._},t[o].render({clearCanvas:f,inputBuffer:s,outputBuffer:r,moduleProps:g});const v=r;r=s,s=v}return s}cleanup(){if(this.passes){for(const e of this.passes)e.delete();this.passes=void 0}}}function v4(n,e,t){return e.passes.map((i,s)=>{const r=E4(e,i),o=`${t}-${s}`;return new b4(n,{id:o,module:e,fs:r})})}const yb=`#version 300 es
uniform sampler2D texSrc;

in vec2 position;
in vec2 coordinate;
in vec2 uv;

out vec4 fragColor;
`,T4=n=>`${yb}
void main() {
  fragColor = texture(texSrc, coordinate);
  fragColor = ${n}(fragColor, screen.texSize, coordinate);
}
`,w4=n=>`${yb}
void main() {
  fragColor = ${n}(texSrc, screen.texSize, coordinate);
}
`;function E4(n,e){if(e.filter){const t=typeof e.filter=="string"?e.filter:`${n.name}_filterColor_ext`;return T4(t)}if(e.sampler){const t=typeof e.sampler=="string"?e.sampler:`${n.name}_sampleColor`;return w4(t)}return""}const x4={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class bb extends ed{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:i,viewports:s,onViewportActive:r,pickingFBO:o,deviceRect:{x:a,y:l,width:f,height:g},cullRect:_,effects:v,pass:T="picking",pickZ:C,shaderModuleProps:S}){this.pickZ=C;const R=this._resetColorEncoder(C),P=[a,l,f,g],F=super.render({target:o,layers:e,layerFilter:t,views:i,viewports:s,onViewportActive:r,cullRect:_,effects:v==null?void 0:v.filter(X=>X.useInPicking),pass:T,isPicking:!0,shaderModuleProps:S,clearColor:[0,0,0,0],colorMask:15,scissorRect:P});return this._colorEncoderState=null,{decodePickingColor:R&&S4.bind(null,R),stats:F}}shouldDrawLayer(e){const{pickable:t,operation:i}=e.props;return t&&i.includes("draw")||i.includes("terrain")||i.includes("mask")}getShaderModuleProps(e,t,i){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,t,i){const s={...e.props.parameters},{pickable:r,operation:o}=e.props;return!this._colorEncoderState||o.includes("terrain")?s.blend=!1:r&&o.includes("draw")&&(Object.assign(s,x4),s.blend=!0,s.blendColor=C4(this._colorEncoderState,e,i)),s}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function C4(n,e,t){const{byLayer:i,byAlpha:s}=n;let r,o=i.get(e);return o?(o.viewports.push(t),r=o.a):(r=i.size+1,r<=255?(o={a:r,layer:e,viewports:[t]},i.set(e,o),s[r]=o):(ze.warn("Too many pickable layers, only picking the first 255")(),r=0)),[0,0,0,r/255]}function S4(n,e){const t=n.byAlpha[e[3]];return t&&{pickedLayer:t.layer,pickedViewports:t.viewports,pickedObjectIndex:t.layer.decodePickingColor(e)}}const xr={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Ac=Symbol.for("component"),As=Symbol.for("propTypes"),yu=Symbol.for("deprecatedProps"),Hr=Symbol.for("asyncPropDefaults"),Ws=Symbol.for("asyncPropOriginal"),ss=Symbol.for("asyncPropResolved");function Zc(n,e=()=>!0){return Array.isArray(n)?vb(n,e,[]):e(n)?[n]:[]}function vb(n,e,t){let i=-1;for(;++i<n.length;){const s=n[i];Array.isArray(s)?vb(s,e,t):e(s)&&t.push(s)}return t}function I4({target:n,source:e,start:t=0,count:i=1}){const s=e.length,r=i*s;let o=0;for(let a=t;o<s;o++)n[a++]=e[o];for(;o<r;)o<r-o?(n.copyWithin(t+o,t,t+o),o*=2):(n.copyWithin(t+o,t,t+r-o),o=r);return n}class R4{constructor(e,t,i){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=i,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const i=++this._loadCount;let s=e;typeof e=="string"&&(s=Li(e)),s instanceof Promise?(this.isLoaded=!1,this._loader=s.then(r=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=r)}).catch(r=>{this._loadCount===i&&(this.isLoaded=!0,this._error=r||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const r of this._subscribers)r.onChange(this.getData())}}class P4{constructor(e){var t;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(t=e.device)==null?void 0:t.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:t,forceUpdate:i=!1,persistent:s=!0}){let r=this._resources[e];r?r.setData(t,i):(r=new R4(e,t,this._context),this._resources[e]=r),r.persistent=s}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const t=this._consumers[e];if(t){for(const i in t){const s=t[i],r=this._resources[s.resourceId];r&&r.unsubscribe(s)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:i,requestId:s="default"}){const{_resources:r,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),r[e]||this.add({resourceId:e,data:null,persistent:!1}));const a=r[e];if(this._track(i,s,a,t),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,i,s){const r=this._consumers,o=r[e]=r[e]||{};let a=o[t];const l=a&&a.resourceId&&this._resources[a.resourceId];l&&(l.unsubscribe(a),this.prune()),i&&(a?(a.onChange=s,a.resourceId=i.id):a={onChange:s,resourceId:i.id},o[t]=a,i.subscribe(a))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}}const M4="layerManager.setLayers",B4="layerManager.activateViewport";class O4{constructor(e,t){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=a=>{yn(B4,this,a),a&&(this.context.viewport=a)};const{deck:i,stats:s,viewport:r,timeline:o}=t||{};this.layers=[],this.resourceManager=new P4({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:i,shaderAssembler:cO(),defaultShaderModules:[xM],renderPass:void 0,stats:s||new so({id:"deck.gl"}),viewport:r||new Kn({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new db,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const s=i.getNeedsRedraw(e);t=t||s}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(i=>t.id.indexOf(i)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){yn(M4,this,t,e),this._lastRenderedLayers=e;const i=Zc(e,Boolean);for(const s of i)s.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:t}=this.context;t.find(i=>i.name===e.name)||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:t}=this.context,i=t.findIndex(s=>s.name===e.name);i>=0&&(t.splice(i,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,i){i.raiseError(t,`${e} of ${i}`)}_updateLayers(e,t){const i={};for(const o of e)i[o.id]?ze.warn(`Multiple old layers with same id ${o.id}`)():i[o.id]=o;if(this._defaultShaderModulesChanged){for(const o of e)o.setNeedsUpdate(),o.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const s=[];this._updateSublayersRecursively(t,i,s),this._finalizeOldLayers(i);let r=!1;for(const o of s)if(o.hasUniformTransition()){r=`Uniform transition in ${o}`;break}this._needsUpdate=r,this.layers=s}_updateSublayersRecursively(e,t,i){for(const s of e){s.context=this.context;const r=t[s.id];r===null&&ze.warn(`Multiple new layers with same id ${s.id}`)(),t[s.id]=null;let o=null;try{this._debug&&r!==s&&s.validateProps(),r?(this._transferLayerState(r,s),this._updateLayer(s)):this._initializeLayer(s),i.push(s),o=s.isComposite?s.getSubLayers():null}catch(a){this._handleError("matching",a,s)}o&&this._updateSublayersRecursively(o,t,i)}}_finalizeOldLayers(e){for(const t in e){const i=e[t];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=xr.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=xr.MATCHED,t!==e&&(e.lifecycle=xr.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=xr.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=xr.FINALIZED}catch(t){this._handleError("finalization",t,e)}}}function Kt(n,e,t){if(n===e)return!0;if(!t||!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(!Kt(n[i],e[i],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const i=Object.keys(n),s=Object.keys(e);if(i.length!==s.length)return!1;for(const r of i)if(!e.hasOwnProperty(r)||!Kt(n[r],e[r],t-1))return!1;return!0}return!1}class D4{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t=typeof e=="string"?this.getView(e):e,i=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,t){const i=this.getViewports(),s={x:e[0],y:e[1]};for(let r=i.length-1;r>=0;--r){const o=i[r];if(o.containsPixel(s)){const a=e.slice();return a[0]-=o.x,a[1]-=o.y,o.unproject(a,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=Zc(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Kt(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):ze.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){const i=t.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:r=>{var o;return(o=this.getView(e.id))==null?void 0:o.makeViewport({viewState:r,width:this.width,height:this.height})}})}_updateController(e,t,i,s){const r=e.controller;if(r&&i){const o={...t,...r,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return(!s||s.constructor!==r.type)&&(s=this._createController(e,o)),s&&s.setProps(o),s}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let s=e.length;s--;){const r=e[s],o=this.getViewState(r),a=r.makeViewport({viewState:o,width:this.width,height:this.height});let l=t[r.id];const f=!!r.controller;f&&!l&&(i=!0),(i||!f)&&l&&(l.finalize(),l=null),this.controllers[r.id]=this._updateController(r,o,a,l),a&&this._viewports.unshift(a)}for(const s in t){const r=t[s];r&&!this.controllers[s]&&r.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length?!0:e.some((i,s)=>!e[s].equals(t[s]))}}const N4=/([0-9]+\.?[0-9]*)(%|px)/;function $i(n){switch(typeof n){case"number":return{position:n,relative:!1};case"string":const e=N4.exec(n);if(e&&e.length>=3){const t=e[2]==="%",i=parseFloat(e[1]);return{position:t?i/100:i,relative:t}}default:throw new Error(`Could not parse position string ${n}`)}}function Xi(n,e){return n.relative?Math.round(n.position*e):n.position}class Si{constructor(e){const{id:t,x:i=0,y:s=0,width:r="100%",height:o="100%",padding:a=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=$i(i),this._y=$i(s),this._width=$i(r),this._height=$i(o),this._padding=a&&{left:$i(a.left||0),right:$i(a.right||0),top:$i(a.top||0),bottom:$i(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&Kt(this.props,e.props,2)}makeViewport({width:e,height:t,viewState:i}){i=this.filterViewState(i);const s=this.getDimensions({width:e,height:t});if(!s.height||!s.width)return null;const r=this.getViewportType(i);return new r({...i,...this.props,...s})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const i in this.props.viewState)i!=="id"&&(t[i]=this.props.viewState[i]);return t}return e}getDimensions({width:e,height:t}){const i={x:Xi(this._x,e),y:Xi(this._y,t),width:Xi(this._width,e),height:Xi(this._height,t)};return this._padding&&(i.padding={left:Xi(this._padding.left,e),top:Xi(this._padding.top,t),right:Xi(this._padding.right,e),bottom:Xi(this._padding.bottom,t)}),i}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class eA{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var t,i;this.cancel(),this.settings=e,this._inProgress=!0,(i=(t=this.settings).onStart)==null||i.call(t,this)}end(){var e,t;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(t=(e=this.settings).onEnd)==null||t.call(e,this))}cancel(){var e,t;this._inProgress&&((t=(e=this.settings).onInterrupt)==null||t.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,t;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:i,settings:s}=this;this._handle=i.addChannel({delay:i.getTime(),duration:s.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(t=(e=this.settings).onUpdate)==null||t.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const Tp=()=>{},jh={BREAK:1,SNAP_TO_END:2,IGNORE:3},F4=n=>n,L4=jh.BREAK;class k4{constructor(e){this._onTransitionUpdate=t=>{const{time:i,settings:{interpolator:s,startProps:r,endProps:o,duration:a,easing:l}}=t,f=l(i/a),g=s.interpolateProps(r,o,f);this.propsInTransition=this.getControllerState({...this.props,...g}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new eA(e.timeline),this.onViewStateChange=e.onViewStateChange||Tp,this.onStateChange=e.onStateChange||Tp}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let s=i;if(this.transition.inProgress){const{interruption:r,endProps:o}=this.transition.settings;s={...i,...r===jh.SNAP_TO_END?o:this.propsInTransition||i}}this._triggerTransition(s,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:i}=e;return(t>0||t==="auto")&&!!i}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===jh.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){const i=this.getControllerState(e),s=this.getControllerState(t).shortestPathFrom(i),r=t.transitionInterpolator,o=r.getDuration?r.getDuration(e,t):t.transitionDuration;if(o===0)return;const a=r.initializeProps(e,s);this.propsInTransition={};const l={duration:o,easing:t.transitionEasing||F4,interpolator:r,interruption:t.transitionInterruption||L4,startProps:a.start,endProps:a.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(l),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(t)}}}function An(n,e){if(!n)throw new Error(e||"deck.gl: assertion failed.")}class Tb{constructor(e){const{compare:t,extract:i,required:s}=e;this._propsToCompare=t,this._propsToExtract=i||t,this._requiredProps=s}arePropsEqual(e,t){for(const i of this._propsToCompare)if(!(i in e)||!(i in t)||!Cn(e[i],t[i]))return!1;return!0}initializeProps(e,t){const i={},s={};for(const r of this._propsToExtract)(r in e||r in t)&&(i[r]=e[r],s[r]=t[r]);return this._checkRequiredProps(i),this._checkRequiredProps(s),{start:i,end:s}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const i=e[t];An(Number.isFinite(i)||Array.isArray(i),`${t} is required for transition`)})}}const U4=["longitude","latitude","zoom","bearing","pitch"],V4=["longitude","latitude","zoom"];class qs extends Tb{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:U4,required:V4},super(i.transitionProps),this.opts=i}initializeProps(e,t){const i=super.initializeProps(e,t),{makeViewport:s,around:r}=this.opts;if(s&&r){const o=s(e),a=s(t),l=o.unproject(r);i.start.around=r,Object.assign(i.end,{around:a.project(l),aroundPosition:l,width:t.width,height:t.height})}return i}interpolateProps(e,t,i){const s={};for(const r of this._propsToExtract)s[r]=Qn(e[r]||0,t[r]||0,i);if(t.aroundPosition&&this.opts.makeViewport){const r=this.opts.makeViewport({...t,...s});Object.assign(s,r.panByPosition(t.aroundPosition,Qn(e.around,t.around,i)))}return s}}const Qi={transitionDuration:0},z4=300,$a=n=>1-(1-n)*(1-n),ur={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},Ss={};class fa{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new k4({...e,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const t in this._events)this._events[t]&&((e=this.eventManager)==null||e.off(t,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return t?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return t?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return t?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:i}=this.props,{offsetCenter:s}=e;return[s.x-t,s.y-i]}isPointInBounds(e,t){const{width:i,height:s}=this.props;if(t&&t.handled)return!1;const r=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=s;return r&&t&&t.stopPropagation(),r}isFunctionKeyPressed(e){const{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:t===!0?z4:0;const{scrollZoom:i=!0,dragPan:s=!0,dragRotate:r=!0,doubleClickZoom:o=!0,touchZoom:a=!0,touchRotate:l=!1,keyboard:f=!0}=e,g=!!this.onViewStateChange;this.toggleEvents(ur.WHEEL,g&&i),this.toggleEvents(ur.PAN,g),this.toggleEvents(ur.PINCH,g&&(a||l)),this.toggleEvents(ur.MULTI_PAN,g&&l),this.toggleEvents(ur.DOUBLE_CLICK,g&&o),this.toggleEvents(ur.KEYBOARD,g&&f),this.scrollZoom=i,this.dragPan=s,this.dragRotate=r,this.doubleClickZoom=o,this.touchZoom=a,this.touchRotate=l,this.keyboard=f}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(i=>{this._events[i]!==t&&(this._events[i]=t,t?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e,t=null,i={}){const s={...e.getViewportProps(),...t},r=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),r){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:s,interactionState:this._interactionState,oldViewState:o,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const s=this.controllerState[i?"panStart":"rotateStart"]({pos:t});return this._panMove=i,this.updateViewport(s,Qi,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),i=this.controllerState.pan({pos:t});return this.updateViewport(i,Qi,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const i=this.getCenter(e),s=[i[0]+e.velocityX*t/2,i[1]+e.velocityY*t/2],r=this.controllerState.pan({pos:s}).panEnd();this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:$a},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),i=this.controllerState.rotate({pos:t});return this.updateViewport(i,Qi,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const i=this.getCenter(e),s=[i[0]+e.velocityX*t/2,i[1]+e.velocityY*t/2],r=this.controllerState.rotate({pos:s}).rotateEnd();this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:$a},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:i=.01,smooth:s=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:r}=e;let o=2/(1+Math.exp(-Math.abs(r*i)));r<0&&o!==0&&(o=1/o);const a=this.controllerState.zoom({pos:t,scale:o});return this.updateViewport(a,{...this._getTransitionProps({around:t}),transitionDuration:s?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const i=this.controllerState.rotateStart({pos:t});return this.updateViewport(i,Qi,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const i=this.controllerState.rotate({pos:t});return this.updateViewport(i,Qi,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const i=this.getCenter(e),s=[i[0],i[1]+=e.velocityY*t/2],r=this.controllerState.rotate({pos:s});this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:$a},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const i=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return Ss._startPinchRotation=e.rotation,Ss._lastPinchEvent=e,this.updateViewport(i,Qi,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:i}=e,s=this.getCenter(e);t=t.zoom({pos:s,scale:i})}if(this.touchRotate){const{rotation:i}=e;t=t.rotate({deltaAngleX:Ss._startPinchRotation-i})}return this.updateViewport(t,Qi,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Ss._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:i}=Ss;if(this.touchZoom&&t&&i&&e.scale!==i.scale){const s=this.getCenter(e);let r=this.controllerState.rotateEnd();const o=Math.log2(e.scale),a=(o-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),l=Math.pow(2,o+a*t/2);r=r.zoom({pos:s,scale:l}).zoomEnd(),this.updateViewport(r,{...this._getTransitionProps({around:s}),transitionDuration:t,transitionEasing:$a},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const s=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Ss._startPinchRotation=null,Ss._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const i=this.isFunctionKeyPressed(e),s=this.controllerState.zoom({pos:t,scale:i?.5:2});return this.updateViewport(s,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:s,rotateSpeedX:r,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let l;const f={};switch(e.srcEvent.code){case"Minus":l=t?a.zoomOut(i).zoomOut(i):a.zoomOut(i),f.isZooming=!0;break;case"Equal":l=t?a.zoomIn(i).zoomIn(i):a.zoomIn(i),f.isZooming=!0;break;case"ArrowLeft":t?(l=a.rotateLeft(r),f.isRotating=!0):(l=a.moveLeft(s),f.isPanning=!0);break;case"ArrowRight":t?(l=a.rotateRight(r),f.isRotating=!0):(l=a.moveRight(s),f.isPanning=!0);break;case"ArrowUp":t?(l=a.rotateUp(o),f.isRotating=!0):(l=a.moveUp(s),f.isPanning=!0);break;case"ArrowDown":t?(l=a.rotateDown(o),f.isRotating=!0):(l=a.moveDown(s),f.isPanning=!0);break;default:return!1}return this.updateViewport(l,this._getTransitionProps(),f),!0}_getTransitionProps(e){const{transition:t}=this;return!t||!t.transitionInterpolator?Qi:e?{...t,transitionInterpolator:new qs({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t}}class td{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}const wp=5,H4=1.2;class wb extends td{constructor(e){const{width:t,height:i,latitude:s,longitude:r,zoom:o,bearing:a=0,pitch:l=0,altitude:f=1.5,position:g=[0,0,0],maxZoom:_=20,minZoom:v=0,maxPitch:T=60,minPitch:C=0,startPanLngLat:S,startZoomLngLat:R,startRotatePos:P,startBearing:F,startPitch:U,startZoom:X,normalize:Z=!0}=e;An(Number.isFinite(r)),An(Number.isFinite(s)),An(Number.isFinite(o)),super({width:t,height:i,latitude:s,longitude:r,zoom:o,bearing:a,pitch:l,altitude:f,maxZoom:_,minZoom:v,maxPitch:T,minPitch:C,normalize:Z,position:g},{startPanLngLat:S,startZoomLngLat:R,startRotatePos:P,startBearing:F,startPitch:U,startZoom:X}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const i=this.getState().startPanLngLat||this._unproject(t);if(!i)return this;const r=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(r)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:i=0}){const{startRotatePos:s,startBearing:r,startPitch:o}=this.getState();if(!s||r===void 0||o===void 0)return this;let a;return e?a=this._getNewRotation(e,s,o,r):a={bearing:r+t,pitch:o+i},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:i}){let{startZoom:s,startZoomLngLat:r}=this.getState();if(r||(s=this.getViewportProps().zoom,r=this._unproject(t)||this._unproject(e)),!r)return this;const{maxZoom:o,minZoom:a}=this.getViewportProps();let l=s+Math.log2(i);l=Ut(l,a,o);const f=this.makeViewport({...this.getViewportProps(),zoom:l});return this._getUpdatedState({zoom:l,...f.panByPosition(r,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),i={...this.getViewportProps()},{bearing:s,longitude:r}=i;return Math.abs(s-t.bearing)>180&&(i.bearing=s<0?s+360:s-360),Math.abs(r-t.longitude)>180&&(i.longitude=r<0?r+360:r-360),i}applyConstraints(e){const{maxZoom:t,minZoom:i,zoom:s}=e;e.zoom=Ut(s,i,t);const{maxPitch:r,minPitch:o,pitch:a}=e;e.pitch=Ut(a,o,r);const{normalize:l=!0}=e;return l&&Object.assign(e,jB(e)),e}_zoomFromCenter(e){const{width:t,height:i}=this.getViewportProps();return this.zoom({pos:[t/2,i/2],scale:e})}_panFromCenter(e){const{width:t,height:i}=this.getViewportProps();return this.pan({startPos:[t/2,i/2],pos:[t/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,i,s){const r=e[0]-t[0],o=e[1]-t[1],a=e[1],l=t[1],{width:f,height:g}=this.getViewportProps(),_=r/f;let v=0;o>0?Math.abs(g-l)>wp&&(v=o/(l-g)*H4):o<0&&l>wp&&(v=1-a/l),v=Ut(v,-1,1);const{minPitch:T,maxPitch:C}=this.getViewportProps(),S=s+180*_;let R=i;return v>0?R=i+v*(C-i):v<0&&(R=i-v*(T-i)),{pitch:R,bearing:S}}}class G4 extends fa{constructor(){super(...arguments),this.ControllerState=wb,this.transition={transitionDuration:300,transitionInterpolator:new qs({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class Eb extends Si{constructor(e={}){super(e)}getViewportType(){return fi}get ControllerType(){return G4}}Eb.displayName="MapView";const W4=new ub;function j4(n,e){const t=n.order??1/0,i=e.order??1/0;return t-i}class $4{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(i=>i.id===e.id)){const i=t.findIndex(s=>j4(s,e)>0);i<0?t.push(e):t.splice(i,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Kt(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const s of this.effects)t[s.id]=s;const i=[];for(const s of e){const r=t[s.id];let o=s;r&&r!==s?r.setProps?(r.setProps(s.props),o=r):r.cleanup(this._context):r||s.setup(this._context),i.push(o),delete t[s.id]}for(const s in t)t[s].cleanup(this._context);this.effects=i,this._resolvedEffects=i.concat(this._defaultEffects),e.some(s=>s instanceof ub)||this._resolvedEffects.push(W4),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class X4 extends ed{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const Q4="deckRenderer.renderLayers";class Y4{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new X4(e),this.pickLayersPass=new bb(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};i.effects&&this._preRender(i.effects,i);const s=this.lastPostProcessEffect?this.renderBuffers[0]:i.target;this.lastPostProcessEffect&&(i.clearColor=[0,0,0,0],i.clearCanvas=!0);const r=t.render({...i,target:s});i.effects&&this._postRender(i.effects,i),this.renderCount++,yn(Q4,this,r,e)}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const i of e)t.preRenderStats[i.id]=i.preRender(t),i.postRender&&(this.lastPostProcessEffect=i.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(i=>{const s=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${i}`,colorAttachments:[s]}))});for(const i of e)i.resize(t)}_postRender(e,t){const{renderBuffers:i}=this,s={...t,inputBuffer:i[0],swapBuffer:i[1]};for(const r of e)if(r.postRender){s.target=r.id===this.lastPostProcessEffect?t.target:void 0;const o=r.postRender(s);s.inputBuffer=o,s.swapBuffer=o===i[0]?i[1]:i[0]}}}const K4={pickedColor:null,pickedObjectIndex:-1};function q4({pickedColors:n,decodePickingColor:e,deviceX:t,deviceY:i,deviceRadius:s,deviceRect:r}){const{x:o,y:a,width:l,height:f}=r;let g=s*s,_=-1,v=0;for(let T=0;T<f;T++){const C=T+a-i,S=C*C;if(S>g)v+=4*l;else for(let R=0;R<l;R++){if(n[v+3]-1>=0){const F=R+o-t,U=F*F+S;U<=g&&(g=U,_=v)}v+=4}}if(_>=0){const T=n.slice(_,_+4),C=e(T);if(C){const S=Math.floor(_/4/l),R=_/4-S*l;return{...C,pickedColor:T,pickedX:o+R,pickedY:a+S}}ze.error("Picked non-existent layer. Is picking buffer corrupt?")()}return K4}function J4({pickedColors:n,decodePickingColor:e}){const t=new Map;if(n){for(let i=0;i<n.length;i+=4)if(n[i+3]-1>=0){const r=n.slice(i,i+4),o=r.join(",");if(!t.has(o)){const a=e(r);a?t.set(o,{...a,color:r}):ze.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(t.values())}function xb({pickInfo:n,viewports:e,pixelRatio:t,x:i,y:s,z:r}){let o=e[0];e.length>1&&(o=eD((n==null?void 0:n.pickedViewports)||e,{x:i,y:s}));let a;if(o){const l=[i-o.x,s-o.y];r!==void 0&&(l[2]=r),a=o.unproject(l)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:i,y:s,pixel:[i,s],coordinate:a,devicePixel:n&&"pickedX"in n?[n.pickedX,n.pickedY]:void 0,pixelRatio:t}}function Z4(n){const{pickInfo:e,lastPickedInfo:t,mode:i,layers:s}=n,{pickedColor:r,pickedLayer:o,pickedObjectIndex:a}=e,l=o?[o]:[];if(i==="hover"){const _=t.index,v=t.layerId,T=o?o.props.id:null;if(T!==v||a!==_){if(T!==v){const C=s.find(S=>S.props.id===v);C&&l.unshift(C)}t.layerId=T,t.index=a,t.info=null}}const f=xb(n),g=new Map;return g.set(null,f),l.forEach(_=>{let v={...f};_===o&&(v.color=r,v.index=a,v.picked=!0),v=Cb({layer:_,info:v,mode:i});const T=v.layer;_===o&&i==="hover"&&(t.info=v),g.set(T.id,v),i==="hover"&&T.updateAutoHighlight(v)}),g}function Cb({layer:n,info:e,mode:t}){for(;n&&e;){const i=e.layer||null;e.sourceLayer=i,e.layer=n,e=n.getPickingInfo({info:e,mode:t,sourceLayer:i}),n=n.parent}return e}function eD(n,e){for(let t=n.length-1;t>=0;t--){const i=n[t];if(i.containsPixel(e))return i}return n[0]}class tD{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new bb(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:i,viewports:s},r=this.lastPickedInfo.info){const o=r&&r.layer&&r.layer.id,a=r&&r.viewport&&r.viewport.id,l=o?i.find(v=>v.id===o):null,f=a&&s.find(v=>v.id===a)||s[0],g=f&&f.unproject([e-f.x,t-f.y]);return{...r,...{x:e,y:t,viewport:f,coordinate:g,layer:l}}}_resizeBuffer(){var t,i;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const s=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=s}const{canvas:e}=this.device.getDefaultCanvasContext();(t=this.pickingFBO)==null||t.resize({width:e.width,height:e.height}),(i=this.depthFBO)==null||i.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const t=e.filter(i=>this.pickLayersPass.shouldDrawLayer(i)&&!i.isComposite);return t.length?t:null}_pickClosestObject({layers:e,views:t,viewports:i,x:s,y:r,radius:o=0,depth:a=1,mode:l="query",unproject3D:f,onViewportActive:g,effects:_}){const v=this.device.canvasContext.cssToDeviceRatio(),T=this._getPickable(e);if(!T||i.length===0)return{result:[],emptyInfo:xb({viewports:i,x:s,y:r,pixelRatio:v})};this._resizeBuffer();const C=this.device.canvasContext.cssToDevicePixels([s,r],!0),S=[C.x+Math.floor(C.width/2),C.y+Math.floor(C.height/2)],R=Math.round(o*v),{width:P,height:F}=this.pickingFBO,U=this._getPickingRect({deviceX:S[0],deviceY:S[1],deviceRadius:R,deviceWidth:P,deviceHeight:F}),X={x:s-o,y:r-o,width:o*2+1,height:o*2+1};let Z;const se=[],Se=new Set;for(let me=0;me<a;me++){let J;if(U){const L=this._drawAndSample({layers:T,views:t,viewports:i,onViewportActive:g,deviceRect:U,cullRect:X,effects:_,pass:`picking:${l}`});J=q4({...L,deviceX:S[0],deviceY:S[1],deviceRadius:R,deviceRect:U})}else J={pickedColor:null,pickedObjectIndex:-1};let q;if(J.pickedLayer&&f&&this.depthFBO){const{pickedColors:L}=this._drawAndSample({layers:[J.pickedLayer],views:t,viewports:i,onViewportActive:g,deviceRect:{x:J.pickedX,y:J.pickedY,width:1,height:1},cullRect:X,effects:_,pass:`picking:${l}:z`},!0);L[3]&&(q=L[0])}J.pickedLayer&&me+1<a&&(Se.add(J.pickedLayer),J.pickedLayer.disablePickingIndex(J.pickedObjectIndex)),Z=Z4({pickInfo:J,lastPickedInfo:this.lastPickedInfo,mode:l,layers:T,viewports:i,x:s,y:r,z:q,pixelRatio:v});for(const L of Z.values())L.layer&&se.push(L);if(!J.pickedColor)break}for(const me of Se)me.restorePickingColors();return{result:se,emptyInfo:Z.get(null)}}_pickVisibleObjects({layers:e,views:t,viewports:i,x:s,y:r,width:o=1,height:a=1,mode:l="query",maxObjects:f=null,onViewportActive:g,effects:_}){const v=this._getPickable(e);if(!v||i.length===0)return[];this._resizeBuffer();const T=this.device.canvasContext.cssToDeviceRatio(),C=this.device.canvasContext.cssToDevicePixels([s,r],!0),S=C.x,R=C.y+C.height,P=this.device.canvasContext.cssToDevicePixels([s+o,r+a],!0),F=P.x+P.width,U=P.y,X={x:S,y:U,width:F-S,height:R-U},Z=this._drawAndSample({layers:v,views:t,viewports:i,onViewportActive:g,deviceRect:X,cullRect:{x:s,y:r,width:o,height:a},effects:_,pass:`picking:${l}`}),se=J4(Z),Se=new Map,me=[],J=Number.isFinite(f);for(let q=0;q<se.length&&!(J&&me.length>=f);q++){const L=se[q];let fe={color:L.pickedColor,layer:null,index:L.pickedObjectIndex,picked:!0,x:s,y:r,pixelRatio:T};fe=Cb({layer:L.pickedLayer,info:fe,mode:l});const we=fe.layer.id;Se.has(we)||Se.set(we,new Set);const Me=Se.get(we),Fe=fe.object??fe.index;Me.has(Fe)||(Me.add(Fe),me.push(fe))}return me}_drawAndSample({layers:e,views:t,viewports:i,onViewportActive:s,deviceRect:r,cullRect:o,effects:a,pass:l},f=!1){const g=f?this.depthFBO:this.pickingFBO,_={layers:e,layerFilter:this.layerFilter,views:t,viewports:i,onViewportActive:s,pickingFBO:g,deviceRect:r,cullRect:o,effects:a,pass:l,pickZ:f,preRenderStats:{},isPicking:!0};for(const F of a)F.useInPicking&&(_.preRenderStats[F.id]=F.preRender(_));const{decodePickingColor:v}=this.pickLayersPass.render(_),{x:T,y:C,width:S,height:R}=r,P=new(f?Float32Array:Uint8Array)(S*R*4);return this.device.readPixelsToArrayWebGL(g,{sourceX:T,sourceY:C,sourceWidth:S,sourceHeight:R,target:P}),{pickedColors:P,decodePickingColor:v}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:i,deviceWidth:s,deviceHeight:r}){const o=Math.max(0,e-i),a=Math.max(0,t-i),l=Math.min(s,e+i+1)-o,f=Math.min(r,t+i+1)-a;return l<=0||f<=0?null:{x:o,y:a,width:l,height:f}}}const nD={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},iD="top-left",Ep="__root";class sD{constructor({deck:e,parentElement:t}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=t}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!Kt(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(t=>t.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const t={};for(const i of this.resolvedWidgets)t[i.id]=i;this.resolvedWidgets.length=0;for(const i of this.defaultWidgets)t[i.id]=null,this.resolvedWidgets.push(i);for(let i of e){const s=t[i.id];s?s.viewId!==i.viewId||s.placement!==i.placement?(this._remove(s),this._add(i)):i!==s&&(s.setProps(i.props),i=s):this._add(i),t[i.id]=null,this.resolvedWidgets.push(i)}for(const i in t){const s=t[i];s&&this._remove(s)}this.widgets=e}_add(e){const{viewId:t=null,placement:i=iD}=e,s=e.onAdd({deck:this.deck,viewId:t});s&&this._getContainer(t,i).append(s),e._element=s}_remove(e){var t;(t=e.onRemove)==null||t.call(e),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,t){var o;const i=e||Ep;let s=this.containers[i];s||(s=document.createElement("div"),s.style.pointerEvents="none",s.style.position="absolute",s.style.overflow="hidden",(o=this.parentElement)==null||o.append(s),this.containers[i]=s);let r=s.querySelector(`.${t}`);return r||(r=document.createElement("div"),r.className=t,r.style.position="absolute",r.style.zIndex="2",Object.assign(r.style,nD[t]),s.append(r)),r}_updateContainers(){const e=this.deck.width,t=this.deck.height;for(const i in this.containers){const s=this.lastViewports[i]||null,r=i===Ep||s,o=this.containers[i];r?(o.style.display="block",o.style.left=`${s?s.x:0}px`,o.style.top=`${s?s.y:0}px`,o.style.width=`${s?s.width:e}px`,o.style.height=`${s?s.height:t}px`):o.style.display="none"}}onRedraw({viewports:e,layers:t}){var s,r;const i=e.reduce((o,a)=>(o[a.id]=a,o),{});for(const o of this.getWidgets()){const{viewId:a}=o;if(a){const l=i[a];l&&(o.onViewportChange&&o.onViewportChange(l),(s=o.onRedraw)==null||s.call(o,{viewports:[l],layers:t}))}else{if(o.onViewportChange)for(const l of e)o.onViewportChange(l);(r=o.onRedraw)==null||r.call(o,{viewports:e,layers:t})}}this.lastViewports=i,this._updateContainers()}onHover(e,t){var i,s;for(const r of this.getWidgets()){const{viewId:o}=r;(!o||o===((i=e.viewport)==null?void 0:i.id))&&((s=r.onHover)==null||s.call(r,e,t))}}onEvent(e,t){var s,r;const i=Fh[t.type];if(i)for(const o of this.getWidgets()){const{viewId:a}=o;(!a||a===((s=e.viewport)==null?void 0:s.id))&&((r=o[i])==null||r.call(o,e,t))}}}const rD={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class oD{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const t=document.createElement("div");return t.className="deck-tooltip",Object.assign(t.style,rD),this.deck=e,this.element=t,t}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var t;this.isVisible&&e.id===((t=this.lastViewport)==null?void 0:t.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:t}=this,i=t&&t.props.getTooltip;if(!i)return;const s=i(e);this.lastViewport=e.viewport,this.setTooltip(s,e.x,e.y)}setTooltip(e,t,i){const s=this.element;if(s){if(typeof e=="string")s.innerText=e;else if(e)e.text&&(s.innerText=e.text),e.html&&(s.innerHTML=e.html),e.className&&(s.className=e.className);else{this.isVisible=!1,s.style.display="none";return}this.isVisible=!0,s.style.display="block",s.style.transform=`translate(${t}px, ${i}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(s.style,e.style)}}}var Ir;(function(n){n[n.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",n[n.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",n[n.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",n[n.POINTS=0]="POINTS",n[n.LINES=1]="LINES",n[n.LINE_LOOP=2]="LINE_LOOP",n[n.LINE_STRIP=3]="LINE_STRIP",n[n.TRIANGLES=4]="TRIANGLES",n[n.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",n[n.TRIANGLE_FAN=6]="TRIANGLE_FAN",n[n.ZERO=0]="ZERO",n[n.ONE=1]="ONE",n[n.SRC_COLOR=768]="SRC_COLOR",n[n.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",n[n.SRC_ALPHA=770]="SRC_ALPHA",n[n.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",n[n.DST_ALPHA=772]="DST_ALPHA",n[n.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",n[n.DST_COLOR=774]="DST_COLOR",n[n.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",n[n.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",n[n.CONSTANT_COLOR=32769]="CONSTANT_COLOR",n[n.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",n[n.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",n[n.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",n[n.FUNC_ADD=32774]="FUNC_ADD",n[n.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",n[n.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",n[n.BLEND_EQUATION=32777]="BLEND_EQUATION",n[n.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",n[n.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",n[n.BLEND_DST_RGB=32968]="BLEND_DST_RGB",n[n.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",n[n.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",n[n.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",n[n.BLEND_COLOR=32773]="BLEND_COLOR",n[n.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",n[n.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",n[n.LINE_WIDTH=2849]="LINE_WIDTH",n[n.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",n[n.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",n[n.CULL_FACE_MODE=2885]="CULL_FACE_MODE",n[n.FRONT_FACE=2886]="FRONT_FACE",n[n.DEPTH_RANGE=2928]="DEPTH_RANGE",n[n.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",n[n.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",n[n.DEPTH_FUNC=2932]="DEPTH_FUNC",n[n.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",n[n.STENCIL_FUNC=2962]="STENCIL_FUNC",n[n.STENCIL_FAIL=2964]="STENCIL_FAIL",n[n.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",n[n.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",n[n.STENCIL_REF=2967]="STENCIL_REF",n[n.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",n[n.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",n[n.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",n[n.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",n[n.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",n[n.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",n[n.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",n[n.VIEWPORT=2978]="VIEWPORT",n[n.SCISSOR_BOX=3088]="SCISSOR_BOX",n[n.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",n[n.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",n[n.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",n[n.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",n[n.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",n[n.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",n[n.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",n[n.RED_BITS=3410]="RED_BITS",n[n.GREEN_BITS=3411]="GREEN_BITS",n[n.BLUE_BITS=3412]="BLUE_BITS",n[n.ALPHA_BITS=3413]="ALPHA_BITS",n[n.DEPTH_BITS=3414]="DEPTH_BITS",n[n.STENCIL_BITS=3415]="STENCIL_BITS",n[n.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",n[n.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",n[n.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",n[n.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",n[n.SAMPLES=32937]="SAMPLES",n[n.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",n[n.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",n[n.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",n[n.VENDOR=7936]="VENDOR",n[n.RENDERER=7937]="RENDERER",n[n.VERSION=7938]="VERSION",n[n.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",n[n.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",n[n.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",n[n.STATIC_DRAW=35044]="STATIC_DRAW",n[n.STREAM_DRAW=35040]="STREAM_DRAW",n[n.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",n[n.ARRAY_BUFFER=34962]="ARRAY_BUFFER",n[n.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",n[n.BUFFER_SIZE=34660]="BUFFER_SIZE",n[n.BUFFER_USAGE=34661]="BUFFER_USAGE",n[n.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",n[n.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",n[n.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",n[n.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",n[n.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",n[n.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",n[n.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",n[n.CULL_FACE=2884]="CULL_FACE",n[n.FRONT=1028]="FRONT",n[n.BACK=1029]="BACK",n[n.FRONT_AND_BACK=1032]="FRONT_AND_BACK",n[n.BLEND=3042]="BLEND",n[n.DEPTH_TEST=2929]="DEPTH_TEST",n[n.DITHER=3024]="DITHER",n[n.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",n[n.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",n[n.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",n[n.SCISSOR_TEST=3089]="SCISSOR_TEST",n[n.STENCIL_TEST=2960]="STENCIL_TEST",n[n.NO_ERROR=0]="NO_ERROR",n[n.INVALID_ENUM=1280]="INVALID_ENUM",n[n.INVALID_VALUE=1281]="INVALID_VALUE",n[n.INVALID_OPERATION=1282]="INVALID_OPERATION",n[n.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",n[n.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",n[n.CW=2304]="CW",n[n.CCW=2305]="CCW",n[n.DONT_CARE=4352]="DONT_CARE",n[n.FASTEST=4353]="FASTEST",n[n.NICEST=4354]="NICEST",n[n.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",n[n.BYTE=5120]="BYTE",n[n.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",n[n.SHORT=5122]="SHORT",n[n.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",n[n.INT=5124]="INT",n[n.UNSIGNED_INT=5125]="UNSIGNED_INT",n[n.FLOAT=5126]="FLOAT",n[n.DOUBLE=5130]="DOUBLE",n[n.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",n[n.ALPHA=6406]="ALPHA",n[n.RGB=6407]="RGB",n[n.RGBA=6408]="RGBA",n[n.LUMINANCE=6409]="LUMINANCE",n[n.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",n[n.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",n[n.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",n[n.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",n[n.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",n[n.VERTEX_SHADER=35633]="VERTEX_SHADER",n[n.COMPILE_STATUS=35713]="COMPILE_STATUS",n[n.DELETE_STATUS=35712]="DELETE_STATUS",n[n.LINK_STATUS=35714]="LINK_STATUS",n[n.VALIDATE_STATUS=35715]="VALIDATE_STATUS",n[n.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",n[n.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",n[n.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",n[n.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",n[n.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",n[n.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",n[n.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",n[n.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",n[n.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",n[n.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",n[n.SHADER_TYPE=35663]="SHADER_TYPE",n[n.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",n[n.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",n[n.NEVER=512]="NEVER",n[n.LESS=513]="LESS",n[n.EQUAL=514]="EQUAL",n[n.LEQUAL=515]="LEQUAL",n[n.GREATER=516]="GREATER",n[n.NOTEQUAL=517]="NOTEQUAL",n[n.GEQUAL=518]="GEQUAL",n[n.ALWAYS=519]="ALWAYS",n[n.KEEP=7680]="KEEP",n[n.REPLACE=7681]="REPLACE",n[n.INCR=7682]="INCR",n[n.DECR=7683]="DECR",n[n.INVERT=5386]="INVERT",n[n.INCR_WRAP=34055]="INCR_WRAP",n[n.DECR_WRAP=34056]="DECR_WRAP",n[n.NEAREST=9728]="NEAREST",n[n.LINEAR=9729]="LINEAR",n[n.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",n[n.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",n[n.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",n[n.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",n[n.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",n[n.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",n[n.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",n[n.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",n[n.TEXTURE_2D=3553]="TEXTURE_2D",n[n.TEXTURE=5890]="TEXTURE",n[n.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",n[n.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",n[n.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",n[n.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",n[n.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",n[n.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",n[n.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",n[n.TEXTURE0=33984]="TEXTURE0",n[n.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",n[n.REPEAT=10497]="REPEAT",n[n.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",n[n.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",n[n.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",n[n.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",n[n.FLOAT_VEC2=35664]="FLOAT_VEC2",n[n.FLOAT_VEC3=35665]="FLOAT_VEC3",n[n.FLOAT_VEC4=35666]="FLOAT_VEC4",n[n.INT_VEC2=35667]="INT_VEC2",n[n.INT_VEC3=35668]="INT_VEC3",n[n.INT_VEC4=35669]="INT_VEC4",n[n.BOOL=35670]="BOOL",n[n.BOOL_VEC2=35671]="BOOL_VEC2",n[n.BOOL_VEC3=35672]="BOOL_VEC3",n[n.BOOL_VEC4=35673]="BOOL_VEC4",n[n.FLOAT_MAT2=35674]="FLOAT_MAT2",n[n.FLOAT_MAT3=35675]="FLOAT_MAT3",n[n.FLOAT_MAT4=35676]="FLOAT_MAT4",n[n.SAMPLER_2D=35678]="SAMPLER_2D",n[n.SAMPLER_CUBE=35680]="SAMPLER_CUBE",n[n.LOW_FLOAT=36336]="LOW_FLOAT",n[n.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",n[n.HIGH_FLOAT=36338]="HIGH_FLOAT",n[n.LOW_INT=36339]="LOW_INT",n[n.MEDIUM_INT=36340]="MEDIUM_INT",n[n.HIGH_INT=36341]="HIGH_INT",n[n.FRAMEBUFFER=36160]="FRAMEBUFFER",n[n.RENDERBUFFER=36161]="RENDERBUFFER",n[n.RGBA4=32854]="RGBA4",n[n.RGB5_A1=32855]="RGB5_A1",n[n.RGB565=36194]="RGB565",n[n.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",n[n.STENCIL_INDEX=6401]="STENCIL_INDEX",n[n.STENCIL_INDEX8=36168]="STENCIL_INDEX8",n[n.DEPTH_STENCIL=34041]="DEPTH_STENCIL",n[n.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",n[n.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",n[n.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",n[n.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",n[n.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",n[n.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",n[n.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",n[n.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",n[n.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",n[n.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",n[n.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",n[n.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",n[n.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",n[n.NONE=0]="NONE",n[n.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",n[n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",n[n.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",n[n.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",n[n.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",n[n.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",n[n.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",n[n.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",n[n.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",n[n.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",n[n.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",n[n.READ_BUFFER=3074]="READ_BUFFER",n[n.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",n[n.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",n[n.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",n[n.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",n[n.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",n[n.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",n[n.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",n[n.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",n[n.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",n[n.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",n[n.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",n[n.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",n[n.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",n[n.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",n[n.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",n[n.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",n[n.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",n[n.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",n[n.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",n[n.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",n[n.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",n[n.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",n[n.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",n[n.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",n[n.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",n[n.RED=6403]="RED",n[n.RGB8=32849]="RGB8",n[n.RGBA8=32856]="RGBA8",n[n.RGB10_A2=32857]="RGB10_A2",n[n.TEXTURE_3D=32879]="TEXTURE_3D",n[n.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",n[n.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",n[n.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",n[n.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",n[n.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",n[n.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",n[n.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",n[n.SRGB=35904]="SRGB",n[n.SRGB8=35905]="SRGB8",n[n.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",n[n.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",n[n.RGBA32F=34836]="RGBA32F",n[n.RGB32F=34837]="RGB32F",n[n.RGBA16F=34842]="RGBA16F",n[n.RGB16F=34843]="RGB16F",n[n.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",n[n.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",n[n.R11F_G11F_B10F=35898]="R11F_G11F_B10F",n[n.RGB9_E5=35901]="RGB9_E5",n[n.RGBA32UI=36208]="RGBA32UI",n[n.RGB32UI=36209]="RGB32UI",n[n.RGBA16UI=36214]="RGBA16UI",n[n.RGB16UI=36215]="RGB16UI",n[n.RGBA8UI=36220]="RGBA8UI",n[n.RGB8UI=36221]="RGB8UI",n[n.RGBA32I=36226]="RGBA32I",n[n.RGB32I=36227]="RGB32I",n[n.RGBA16I=36232]="RGBA16I",n[n.RGB16I=36233]="RGB16I",n[n.RGBA8I=36238]="RGBA8I",n[n.RGB8I=36239]="RGB8I",n[n.RED_INTEGER=36244]="RED_INTEGER",n[n.RGB_INTEGER=36248]="RGB_INTEGER",n[n.RGBA_INTEGER=36249]="RGBA_INTEGER",n[n.R8=33321]="R8",n[n.RG8=33323]="RG8",n[n.R16F=33325]="R16F",n[n.R32F=33326]="R32F",n[n.RG16F=33327]="RG16F",n[n.RG32F=33328]="RG32F",n[n.R8I=33329]="R8I",n[n.R8UI=33330]="R8UI",n[n.R16I=33331]="R16I",n[n.R16UI=33332]="R16UI",n[n.R32I=33333]="R32I",n[n.R32UI=33334]="R32UI",n[n.RG8I=33335]="RG8I",n[n.RG8UI=33336]="RG8UI",n[n.RG16I=33337]="RG16I",n[n.RG16UI=33338]="RG16UI",n[n.RG32I=33339]="RG32I",n[n.RG32UI=33340]="RG32UI",n[n.R8_SNORM=36756]="R8_SNORM",n[n.RG8_SNORM=36757]="RG8_SNORM",n[n.RGB8_SNORM=36758]="RGB8_SNORM",n[n.RGBA8_SNORM=36759]="RGBA8_SNORM",n[n.RGB10_A2UI=36975]="RGB10_A2UI",n[n.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",n[n.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",n[n.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",n[n.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",n[n.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",n[n.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",n[n.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",n[n.HALF_FLOAT=5131]="HALF_FLOAT",n[n.RG=33319]="RG",n[n.RG_INTEGER=33320]="RG_INTEGER",n[n.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",n[n.CURRENT_QUERY=34917]="CURRENT_QUERY",n[n.QUERY_RESULT=34918]="QUERY_RESULT",n[n.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",n[n.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",n[n.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",n[n.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",n[n.DRAW_BUFFER0=34853]="DRAW_BUFFER0",n[n.DRAW_BUFFER1=34854]="DRAW_BUFFER1",n[n.DRAW_BUFFER2=34855]="DRAW_BUFFER2",n[n.DRAW_BUFFER3=34856]="DRAW_BUFFER3",n[n.DRAW_BUFFER4=34857]="DRAW_BUFFER4",n[n.DRAW_BUFFER5=34858]="DRAW_BUFFER5",n[n.DRAW_BUFFER6=34859]="DRAW_BUFFER6",n[n.DRAW_BUFFER7=34860]="DRAW_BUFFER7",n[n.DRAW_BUFFER8=34861]="DRAW_BUFFER8",n[n.DRAW_BUFFER9=34862]="DRAW_BUFFER9",n[n.DRAW_BUFFER10=34863]="DRAW_BUFFER10",n[n.DRAW_BUFFER11=34864]="DRAW_BUFFER11",n[n.DRAW_BUFFER12=34865]="DRAW_BUFFER12",n[n.DRAW_BUFFER13=34866]="DRAW_BUFFER13",n[n.DRAW_BUFFER14=34867]="DRAW_BUFFER14",n[n.DRAW_BUFFER15=34868]="DRAW_BUFFER15",n[n.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",n[n.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",n[n.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",n[n.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",n[n.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",n[n.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",n[n.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",n[n.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",n[n.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",n[n.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",n[n.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",n[n.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",n[n.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",n[n.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",n[n.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",n[n.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",n[n.SAMPLER_3D=35679]="SAMPLER_3D",n[n.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",n[n.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",n[n.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",n[n.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",n[n.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",n[n.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",n[n.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",n[n.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",n[n.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",n[n.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",n[n.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",n[n.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",n[n.MAX_SAMPLES=36183]="MAX_SAMPLES",n[n.SAMPLER_BINDING=35097]="SAMPLER_BINDING",n[n.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",n[n.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",n[n.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",n[n.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",n[n.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",n[n.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",n[n.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",n[n.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",n[n.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",n[n.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",n[n.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",n[n.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",n[n.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",n[n.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",n[n.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",n[n.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",n[n.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",n[n.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",n[n.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",n[n.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",n[n.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",n[n.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",n[n.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",n[n.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",n[n.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",n[n.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",n[n.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",n[n.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",n[n.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",n[n.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",n[n.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",n[n.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",n[n.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",n[n.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",n[n.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",n[n.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",n[n.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",n[n.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",n[n.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",n[n.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",n[n.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",n[n.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",n[n.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",n[n.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",n[n.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",n[n.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",n[n.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",n[n.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",n[n.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",n[n.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",n[n.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",n[n.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",n[n.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",n[n.UNIFORM_TYPE=35383]="UNIFORM_TYPE",n[n.UNIFORM_SIZE=35384]="UNIFORM_SIZE",n[n.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",n[n.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",n[n.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",n[n.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",n[n.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",n[n.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",n[n.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",n[n.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",n[n.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",n[n.OBJECT_TYPE=37138]="OBJECT_TYPE",n[n.SYNC_CONDITION=37139]="SYNC_CONDITION",n[n.SYNC_STATUS=37140]="SYNC_STATUS",n[n.SYNC_FLAGS=37141]="SYNC_FLAGS",n[n.SYNC_FENCE=37142]="SYNC_FENCE",n[n.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",n[n.UNSIGNALED=37144]="UNSIGNALED",n[n.SIGNALED=37145]="SIGNALED",n[n.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",n[n.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",n[n.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",n[n.WAIT_FAILED=37149]="WAIT_FAILED",n[n.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",n[n.COLOR=6144]="COLOR",n[n.DEPTH=6145]="DEPTH",n[n.STENCIL=6146]="STENCIL",n[n.MIN=32775]="MIN",n[n.MAX=32776]="MAX",n[n.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",n[n.STREAM_READ=35041]="STREAM_READ",n[n.STREAM_COPY=35042]="STREAM_COPY",n[n.STATIC_READ=35045]="STATIC_READ",n[n.STATIC_COPY=35046]="STATIC_COPY",n[n.DYNAMIC_READ=35049]="DYNAMIC_READ",n[n.DYNAMIC_COPY=35050]="DYNAMIC_COPY",n[n.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",n[n.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",n[n.INVALID_INDEX=4294967295]="INVALID_INDEX",n[n.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",n[n.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",n[n.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",n[n.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",n[n.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",n[n.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",n[n.R16_EXT=33322]="R16_EXT",n[n.RG16_EXT=33324]="RG16_EXT",n[n.RGB16_EXT=32852]="RGB16_EXT",n[n.RGBA16_EXT=32859]="RGBA16_EXT",n[n.R16_SNORM_EXT=36760]="R16_SNORM_EXT",n[n.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",n[n.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",n[n.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",n[n.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",n[n.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",n[n.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",n[n.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",n[n.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",n[n.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",n[n.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",n[n.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",n[n.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",n[n.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",n[n.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",n[n.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",n[n.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",n[n.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",n[n.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",n[n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",n[n.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",n[n.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",n[n.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",n[n.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",n[n.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",n[n.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",n[n.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",n[n.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",n[n.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",n[n.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",n[n.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",n[n.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",n[n.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",n[n.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",n[n.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",n[n.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",n[n.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",n[n.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",n[n.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",n[n.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",n[n.LINE_WEBGL=6913]="LINE_WEBGL",n[n.FILL_WEBGL=6914]="FILL_WEBGL",n[n.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",n[n.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",n[n.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",n[n.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",n[n.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",n[n.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",n[n.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",n[n.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",n[n.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",n[n.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",n[n.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",n[n.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",n[n.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",n[n.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",n[n.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",n[n.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",n[n.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",n[n.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",n[n.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",n[n.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",n[n.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",n[n.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",n[n.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",n[n.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(Ir||(Ir={}));const nd={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},$t=(n,e,t)=>e?n.enable(t):n.disable(t),xp=(n,e,t)=>n.hint(t,e),Bn=(n,e,t)=>n.pixelStorei(t,e),Cp=(n,e,t)=>{const i=t===36006?36009:36008;return n.bindFramebuffer(i,e)},wo=(n,e,t)=>{const s={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[t];n.bindBuffer(s,e)};function bu(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}const aD={3042:$t,32773:(n,e)=>n.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(n,e)=>n.clearColor(...e),3107:(n,e)=>n.colorMask(...e),2884:$t,2885:(n,e)=>n.cullFace(e),2929:$t,2931:(n,e)=>n.clearDepth(e),2932:(n,e)=>n.depthFunc(e),2928:(n,e)=>n.depthRange(...e),2930:(n,e)=>n.depthMask(e),3024:$t,35723:xp,35725:(n,e)=>n.useProgram(e),36007:(n,e)=>n.bindRenderbuffer(36161,e),36389:(n,e)=>{var t;return(t=n.bindTransformFeedback)==null?void 0:t.call(n,36386,e)},34229:(n,e)=>n.bindVertexArray(e),36006:Cp,36010:Cp,34964:wo,36662:wo,36663:wo,35053:wo,35055:wo,2886:(n,e)=>n.frontFace(e),33170:xp,2849:(n,e)=>n.lineWidth(e),32823:$t,32824:"polygonOffset",10752:"polygonOffset",35977:$t,32926:$t,32928:$t,32938:"sampleCoverage",32939:"sampleCoverage",3089:$t,3088:(n,e)=>n.scissor(...e),2960:$t,2961:(n,e)=>n.clearStencil(e),2968:(n,e)=>n.stencilMaskSeparate(1028,e),36005:(n,e)=>n.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(n,e)=>n.viewport(...e),34383:$t,10754:$t,12288:$t,12289:$t,12290:$t,12291:$t,12292:$t,12293:$t,12294:$t,12295:$t,3333:Bn,3317:Bn,37440:Bn,37441:Bn,37443:Bn,3330:Bn,3332:Bn,3331:Bn,3314:Bn,32878:Bn,3316:Bn,3315:Bn,32877:Bn,framebuffer:(n,e)=>{const t=e&&"handle"in e?e.handle:e;return n.bindFramebuffer(36160,t)},blend:(n,e)=>e?n.enable(3042):n.disable(3042),blendColor:(n,e)=>n.blendColor(...e),blendEquation:(n,e)=>{const t=typeof e=="number"?[e,e]:e;n.blendEquationSeparate(...t)},blendFunc:(n,e)=>{const t=(e==null?void 0:e.length)===2?[...e,...e]:e;n.blendFuncSeparate(...t)},clearColor:(n,e)=>n.clearColor(...e),clearDepth:(n,e)=>n.clearDepth(e),clearStencil:(n,e)=>n.clearStencil(e),colorMask:(n,e)=>n.colorMask(...e),cull:(n,e)=>e?n.enable(2884):n.disable(2884),cullFace:(n,e)=>n.cullFace(e),depthTest:(n,e)=>e?n.enable(2929):n.disable(2929),depthFunc:(n,e)=>n.depthFunc(e),depthMask:(n,e)=>n.depthMask(e),depthRange:(n,e)=>n.depthRange(...e),dither:(n,e)=>e?n.enable(3024):n.disable(3024),derivativeHint:(n,e)=>{n.hint(35723,e)},frontFace:(n,e)=>n.frontFace(e),mipmapHint:(n,e)=>n.hint(33170,e),lineWidth:(n,e)=>n.lineWidth(e),polygonOffsetFill:(n,e)=>e?n.enable(32823):n.disable(32823),polygonOffset:(n,e)=>n.polygonOffset(...e),sampleCoverage:(n,e)=>n.sampleCoverage(e[0],e[1]||!1),scissorTest:(n,e)=>e?n.enable(3089):n.disable(3089),scissor:(n,e)=>n.scissor(...e),stencilTest:(n,e)=>e?n.enable(2960):n.disable(2960),stencilMask:(n,e)=>{e=bu(e)?e:[e,e];const[t,i]=e;n.stencilMaskSeparate(1028,t),n.stencilMaskSeparate(1029,i)},stencilFunc:(n,e)=>{e=bu(e)&&e.length===3?[...e,...e]:e;const[t,i,s,r,o,a]=e;n.stencilFuncSeparate(1028,t,i,s),n.stencilFuncSeparate(1029,r,o,a)},stencilOp:(n,e)=>{e=bu(e)&&e.length===3?[...e,...e]:e;const[t,i,s,r,o,a]=e;n.stencilOpSeparate(1028,t,i,s),n.stencilOpSeparate(1029,r,o,a)},viewport:(n,e)=>n.viewport(...e)};function Vt(n,e,t){return e[n]!==void 0?e[n]:t[n]}const lD={blendEquation:(n,e,t)=>n.blendEquationSeparate(Vt(32777,e,t),Vt(34877,e,t)),blendFunc:(n,e,t)=>n.blendFuncSeparate(Vt(32969,e,t),Vt(32968,e,t),Vt(32971,e,t),Vt(32970,e,t)),polygonOffset:(n,e,t)=>n.polygonOffset(Vt(32824,e,t),Vt(10752,e,t)),sampleCoverage:(n,e,t)=>n.sampleCoverage(Vt(32938,e,t),Vt(32939,e,t)),stencilFuncFront:(n,e,t)=>n.stencilFuncSeparate(1028,Vt(2962,e,t),Vt(2967,e,t),Vt(2963,e,t)),stencilFuncBack:(n,e,t)=>n.stencilFuncSeparate(1029,Vt(34816,e,t),Vt(36003,e,t),Vt(36004,e,t)),stencilOpFront:(n,e,t)=>n.stencilOpSeparate(1028,Vt(2964,e,t),Vt(2965,e,t),Vt(2966,e,t)),stencilOpBack:(n,e,t)=>n.stencilOpSeparate(1029,Vt(34817,e,t),Vt(34818,e,t),Vt(34819,e,t))},Sp={enable:(n,e)=>n({[e]:!0}),disable:(n,e)=>n({[e]:!1}),pixelStorei:(n,e,t)=>n({[e]:t}),hint:(n,e,t)=>n({[e]:t}),useProgram:(n,e)=>n({35725:e}),bindRenderbuffer:(n,e,t)=>n({36007:t}),bindTransformFeedback:(n,e,t)=>n({36389:t}),bindVertexArray:(n,e)=>n({34229:e}),bindFramebuffer:(n,e,t)=>{switch(e){case 36160:return n({36006:t,36010:t});case 36009:return n({36006:t});case 36008:return n({36010:t});default:return null}},bindBuffer:(n,e,t)=>{const i={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return i?n({[i]:t}):{valueChanged:!0}},blendColor:(n,e,t,i,s)=>n({32773:new Float32Array([e,t,i,s])}),blendEquation:(n,e)=>n({32777:e,34877:e}),blendEquationSeparate:(n,e,t)=>n({32777:e,34877:t}),blendFunc:(n,e,t)=>n({32969:e,32968:t,32971:e,32970:t}),blendFuncSeparate:(n,e,t,i,s)=>n({32969:e,32968:t,32971:i,32970:s}),clearColor:(n,e,t,i,s)=>n({3106:new Float32Array([e,t,i,s])}),clearDepth:(n,e)=>n({2931:e}),clearStencil:(n,e)=>n({2961:e}),colorMask:(n,e,t,i,s)=>n({3107:[e,t,i,s]}),cullFace:(n,e)=>n({2885:e}),depthFunc:(n,e)=>n({2932:e}),depthRange:(n,e,t)=>n({2928:new Float32Array([e,t])}),depthMask:(n,e)=>n({2930:e}),frontFace:(n,e)=>n({2886:e}),lineWidth:(n,e)=>n({2849:e}),polygonOffset:(n,e,t)=>n({32824:e,10752:t}),sampleCoverage:(n,e,t)=>n({32938:e,32939:t}),scissor:(n,e,t,i,s)=>n({3088:new Int32Array([e,t,i,s])}),stencilMask:(n,e)=>n({2968:e,36005:e}),stencilMaskSeparate:(n,e,t)=>n({[e===1028?2968:36005]:t}),stencilFunc:(n,e,t,i)=>n({2962:e,2967:t,2963:i,34816:e,36003:t,36004:i}),stencilFuncSeparate:(n,e,t,i,s)=>n({[e===1028?2962:34816]:t,[e===1028?2967:36003]:i,[e===1028?2963:36004]:s}),stencilOp:(n,e,t,i)=>n({2964:e,2965:t,2966:i,34817:e,34818:t,34819:i}),stencilOpSeparate:(n,e,t,i,s)=>n({[e===1028?2964:34817]:t,[e===1028?2965:34818]:i,[e===1028?2966:34819]:s}),viewport:(n,e,t,i,s)=>n({2978:[e,t,i,s]})},bi=(n,e)=>n.isEnabled(e),Ip={3042:bi,2884:bi,2929:bi,3024:bi,32823:bi,32926:bi,32928:bi,3089:bi,2960:bi,35977:bi},cD=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function ao(n,e){if(uD(e))return;const t={};for(const s in e){const r=Number(s),o=aD[s];o&&(typeof o=="string"?t[o]=!0:o(n,e[s],r))}const i=n.state&&n.state.cache;if(i)for(const s in t){const r=lD[s];r(n,e,i)}}function Sb(n,e=nd){if(typeof e=="number"){const s=e,r=Ip[s];return r?r(n,s):n.getParameter(s)}const t=Array.isArray(e)?e:Object.keys(e),i={};for(const s of t){const r=Ip[s];i[s]=r?r(n,Number(s)):n.getParameter(Number(s))}return i}function AD(n){ao(n,nd)}function uD(n){for(const e in n)return!1;return!0}function hD(n,e){if(n===e)return!0;const t=Array.isArray(n)||ArrayBuffer.isView(n),i=Array.isArray(e)||ArrayBuffer.isView(e);if(t&&i&&n.length===e.length){for(let s=0;s<n.length;++s)if(n[s]!==e[s])return!1;return!0}return!1}class Vs{constructor(e,t){x(this,"gl");x(this,"program",null);x(this,"stateStack",[]);x(this,"enable",!0);x(this,"cache",null);x(this,"log");x(this,"initialized",!1);this.gl=e,this.log=(t==null?void 0:t.log)||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}static get(e){return e.state}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];ao(this.gl,e),this.stateStack.pop()}trackState(e,t){if(this.cache=t.copyState?Sb(e):Object.assign({},nd),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,dD(e);for(const i in Sp){const s=Sp[i];fD(e,i,s)}Rp(e,"getParameter"),Rp(e,"isEnabled")}_updateCache(e){let t=!1,i;const s=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const r in e){const o=e[r],a=this.cache[r];hD(o,a)||(t=!0,i=a,s&&!(r in s)&&(s[r]=a),this.cache[r]=o)}return{valueChanged:t,oldValue:i}}}function Rp(n,e){const t=n[e].bind(n);n[e]=function(s){if(s===void 0||cD.has(s))return t(s);const r=Vs.get(n);return s in r.cache||(r.cache[s]=t(s)),r.enable?r.cache[s]:t(s)},Object.defineProperty(n[e],"name",{value:`${e}-from-cache`,configurable:!1})}function fD(n,e,t){if(!n[e])return;const i=n[e].bind(n);n[e]=function(...r){const o=Vs.get(n),{valueChanged:a,oldValue:l}=t(o._updateCache,...r);return a&&i(...r),l},Object.defineProperty(n[e],"name",{value:`${e}-to-cache`,configurable:!1})}function dD(n){const e=n.useProgram.bind(n);n.useProgram=function(i){const s=Vs.get(n);s.program!==i&&(e(i),s.program=i)}}function gD(n,e,t){let i="";const s={preserveDrawingBuffer:!0,...t};let r=null;if(r||(r=n.getContext("webgl2",s)),s.failIfMajorPerformanceCaveat&&(i||(i="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow.")),!r&&!t.failIfMajorPerformanceCaveat&&(s.failIfMajorPerformanceCaveat=!1,r=n.getContext("webgl2",s),r.luma||(r.luma={}),r.luma.softwareRenderer=!0),r||(r=n.getContext("webgl",{}),r&&(r=null,i||(i="Your browser only supports WebGL1"))),!r)throw i||(i="Your browser does not support WebGL"),new Error(`Failed to create WebGL context: ${i}`);const{onContextLost:o,onContextRestored:a}=e;return n.addEventListener("webglcontextlost",l=>o(l),!1),n.addEventListener("webglcontextrestored",l=>a(l),!1),r.luma||(r.luma={}),r}function Kr(n,e,t){return t[e]===void 0&&(t[e]=n.getExtension(e)||null),t[e]}function pD(n,e){const t=n.getParameter(7936),i=n.getParameter(7937);Kr(n,"WEBGL_debug_renderer_info",e);const s=e.WEBGL_debug_renderer_info,r=n.getParameter(s?s.UNMASKED_VENDOR_WEBGL:7936),o=n.getParameter(s?s.UNMASKED_RENDERER_WEBGL:7937),a=r||t,l=o||i,f=n.getParameter(7938),g=Ib(a,l),_=mD(a,l),v=_D(a,l);return{type:"webgl",gpu:g,gpuType:v,gpuBackend:_,vendor:a,renderer:l,version:f,shadingLanguage:"glsl",shadingLanguageVersion:300}}function Ib(n,e){return/NVIDIA/i.exec(n)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(n)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(n)||/Apple/i.exec(e)?"apple":/AMD/i.exec(n)||/AMD/i.exec(e)||/ATI/i.exec(n)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(n)||/SwiftShader/i.exec(e)?"software":"unknown"}function mD(n,e){return/Metal/i.exec(n)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(n)||/ANGLE/i.exec(e)?"opengl":"unknown"}function _D(n,e){if(/SwiftShader/i.exec(n)||/SwiftShader/i.exec(e))return"cpu";switch(Ib(n,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function Rb(n){switch(n){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(n))}const Lo="WEBGL_compressed_texture_s3tc",ko="WEBGL_compressed_texture_s3tc_srgb",Rr="EXT_texture_compression_rgtc",Pr="EXT_texture_compression_bptc",yD="WEBGL_compressed_texture_etc",bD="WEBGL_compressed_texture_astc",vD="WEBGL_compressed_texture_etc1",TD="WEBGL_compressed_texture_pvrtc",wD="WEBGL_compressed_texture_atc",Pp="EXT_texture_norm16",Mp="EXT_render_snorm",ED="EXT_color_buffer_float",id={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[Mp],"norm16-renderable-webgl":[Pp],"snorm16-renderable-webgl":[Pp,Mp],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Lo,ko,Rr,Pr],"texture-compression-bc5-webgl":[Rr],"texture-compression-bc7-webgl":[Pr],"texture-compression-etc2":[yD],"texture-compression-astc":[bD],"texture-compression-etc1-webgl":[vD],"texture-compression-pvrtc-webgl":[TD],"texture-compression-atc-webgl":[wD]};function xD(n){return n in id}function CD(n,e,t){return(id[e]||[]).every(s=>Kr(n,s,t))}const sd={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:ED,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Lo},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:ko},"bc1-rgba-unorm":{gl:33777,x:Lo},"bc1-rgba-unorm-srgb":{gl:35916,x:ko},"bc2-rgba-unorm":{gl:33778,x:Lo},"bc2-rgba-unorm-srgb":{gl:35918,x:ko},"bc3-rgba-unorm":{gl:33779,x:Lo},"bc3-rgba-unorm-srgb":{gl:35919,x:ko},"bc4-r-unorm":{gl:36283,x:Rr},"bc4-r-snorm":{gl:36284,x:Rr},"bc5-rg-unorm":{gl:36285,x:Rr},"bc5-rg-snorm":{gl:36286,x:Rr},"bc6h-rgb-ufloat":{gl:36495,x:Pr},"bc6h-rgb-float":{gl:36494,x:Pr},"bc7-rgba-unorm":{gl:36492,x:Pr},"bc7-rgba-unorm-srgb":{gl:36493,x:Pr},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function SD(n,e,t){let i=e.create;const s=sd[e.format];return(s==null?void 0:s.gl)===void 0&&(i=!1),s!=null&&s.x&&(i=i&&!!Kr(n,s.x,t)),{format:e.format,create:i&&e.create,render:i&&e.render,filter:i&&e.filter,blend:i&&e.blend,store:i&&e.store}}function Pb(n){var s;const e=sd[n],t=PD(n),i=Of(n);return{internalFormat:t,format:(e==null?void 0:e.dataFormat)||RD(i.channels,i.integer,i.normalized,t),type:i.dataType?Rb(i.dataType):((s=e==null?void 0:e.types)==null?void 0:s[0])||5121,compressed:i.compressed||!1}}function ID(n){switch(Of(n).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${n}`)}}function RD(n,e,t,i){if(i===6408||i===6407)return i;switch(n){case"r":return e&&!t?36244:6403;case"rg":return e&&!t?33320:33319;case"rgb":return e&&!t?36248:6407;case"rgba":return e&&!t?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function PD(n){const e=sd[n],t=e==null?void 0:e.gl;if(t===void 0)throw new Error(`Unsupported texture format ${n}`);return t}const Bp={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class MD extends dI{constructor(t,i,s){super([],s);x(this,"gl");x(this,"extensions");x(this,"testedFeatures",new Set);this.gl=t,this.extensions=i,Kr(t,"EXT_color_buffer_float",i)}*[Symbol.iterator](){const t=this.getFeatures();for(const i of t)this.has(i)&&(yield i);return[]}has(t){var i;return(i=this.disabledFeatures)!=null&&i[t]?!1:(this.testedFeatures.has(t)||(this.testedFeatures.add(t),xD(t)&&CD(this.gl,t,this.extensions)&&this.features.add(t),this.getWebGLFeature(t)&&this.features.add(t)),this.features.has(t))}initializeFeatures(){const t=this.getFeatures().filter(i=>i!=="polygon-mode-webgl");for(const i of t)this.has(i)}getFeatures(){return[...Object.keys(Bp),...Object.keys(id)]}getWebGLFeature(t){const i=Bp[t];return typeof i=="string"?!!Kr(this.gl,i,this.extensions):!!i}}class BD extends fI{constructor(t){super();x(this,"gl");x(this,"limits",{});this.gl=t}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(t){return this.limits[t]===void 0&&(this.limits[t]=this.gl.getParameter(t)),this.limits[t]||0}}class jo extends Ql{constructor(t,i){super(t,i);x(this,"device");x(this,"gl");x(this,"handle");x(this,"colorAttachments",[]);x(this,"depthStencilAttachment",null);const s=i.handle===null;this.device=t,this.gl=t.gl,this.handle=this.props.handle||s?this.props.handle:this.gl.createFramebuffer(),s||(t.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const t=this.gl.bindFramebuffer(36160,this.handle);for(let i=0;i<this.colorAttachments.length;++i){const s=this.colorAttachments[i];if(s){const r=36064+i;this._attachTextureView(r,s)}}if(this.depthStencilAttachment){const i=ID(this.depthStencilAttachment.props.format);this._attachTextureView(i,this.depthStencilAttachment)}if(this.device.props.debug){const i=this.gl.checkFramebufferStatus(36160);if(i!==36053)throw new Error(`Framebuffer ${DD(i)}`)}this.gl.bindFramebuffer(36160,t)}_attachTextureView(t,i){const{gl:s}=this.device,{texture:r}=i,o=i.props.baseMipLevel,a=i.props.baseArrayLayer;switch(s.bindTexture(r.glTarget,r.handle),r.glTarget){case 35866:case 32879:s.framebufferTextureLayer(36160,t,r.handle,o,a);break;case 34067:const l=OD(a);s.framebufferTexture2D(36160,t,l,r.handle,o);break;case 3553:s.framebufferTexture2D(36160,t,3553,r.handle,o);break;default:throw new Error("Illegal texture type")}s.bindTexture(r.glTarget,null)}}function OD(n){return n<34069?n+34069:n}function DD(n){switch(n){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${n}`}}class ND extends yh{constructor(t,i){super(i);x(this,"device");x(this,"format","rgba8unorm");x(this,"depthStencilFormat","depth24plus");x(this,"presentationSize");x(this,"_framebuffer",null);this.device=t,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}get[Symbol.toStringTag](){return"WebGLCanvasContext"}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new jo(this.device,{handle:null}),this._framebuffer}update(){const t=this.getPixelSize();(t[0]!==this.presentationSize[0]||t[1]!==this.presentationSize[1])&&(this.presentationSize=t,this.resize())}resize(t){if(this.device.gl&&this.canvas){const i=this.getDevicePixelRatio(t==null?void 0:t.useDevicePixels);this.setDevicePixelRatio(i,t);return}}commit(){}}async function Mb(n,e){const t=document.getElementsByTagName("head")[0];if(!t)throw new Error("loadScript");const i=document.createElement("script");return i.setAttribute("type","text/javascript"),i.setAttribute("src",n),new Promise((s,r)=>{i.onload=s,i.onerror=o=>r(new Error(`Unable to load script '${n}': ${o}`)),t.appendChild(i)})}const FD=1;let It=null,Op=!1;const rd={debugSpectorJS:ye.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function LD(n){if(!globalThis.SPECTOR)try{await Mb(n.debugSpectorJSUrl||rd.debugSpectorJSUrl)}catch(e){ye.warn(String(e))}}function kD(n){var e;if(n={...rd,...n},!n.debugSpectorJS)return null;if(!It&&globalThis.SPECTOR&&!((e=globalThis.luma)!=null&&e.spector)){ye.probe(FD,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:t}=globalThis.SPECTOR;It=new t,globalThis.luma&&(globalThis.luma.spector=It)}if(!It)return null;if(Op||(Op=!0,It.spyCanvases(),It==null||It.onCaptureStarted.add(t=>ye.info("Spector capture started:",t)()),It==null||It.onCapture.add(t=>{ye.info("Spector capture complete:",t)(),It==null||It.getResultUI(),It==null||It.resultView.display(),It==null||It.resultView.addCapture(t)})),n.gl){const t=n.gl,i=t.device;It==null||It.startCapture(n.gl,500),t.device=i,new Promise(s=>setTimeout(s,2e3)).then(s=>{ye.info("Spector capture stopped after 2 seconds")(),It==null||It.stopCapture()})}return It}const UD="https://unpkg.com/webgl-debug@2.0.1/index.js";function Bb(n){return n.luma=n.luma||{},n.luma}async function VD(){Xs()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await Mb(UD))}function zD(n,e={}){return e.debugWebGL||e.traceWebGL?GD(n,e):HD(n)}function HD(n){const e=Bb(n);return e.realContext?e.realContext:n}function GD(n,e){if(!globalThis.WebGLDebugUtils)return ye.warn("webgl-debug not loaded")(),n;const t=Bb(n);if(t.debugContext)return t.debugContext;globalThis.WebGLDebugUtils.init({...Ir,...n});const i=globalThis.WebGLDebugUtils.makeDebugContext(n,WD.bind(null,e),jD.bind(null,e));for(const o in Ir)!(o in i)&&typeof Ir[o]=="number"&&(i[o]=Ir[o]);class s{}Object.setPrototypeOf(i,Object.getPrototypeOf(n)),Object.setPrototypeOf(s,i);const r=Object.create(s);return t.realContext=n,t.debugContext=r,r.debug=!0,r}function Dp(n,e){e=Array.from(e).map(i=>i===void 0?"undefined":i);let t=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,e);return t=`${t.slice(0,100)}${t.length>100?"...":""}`,`gl.${n}(${t})`}function WD(n,e,t,i){i=Array.from(i).map(a=>a===void 0?"undefined":a);const s=globalThis.WebGLDebugUtils.glEnumToString(e),r=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,i),o=`${s} in gl.${t}(${r})`;ye.error(o)();debugger}function jD(n,e,t){let i="";ye.level>=1&&(i=Dp(e,t),n.traceWebGL&&ye.log(1,i)());for(const s of t)if(s===void 0){i=i||Dp(e,t);debugger}}const vu={};function $D(n="id"){vu[n]=vu[n]||1;const e=vu[n]++;return`${n}-${e}`}class $o extends Ft{constructor(t,i={}){super(t,i);x(this,"device");x(this,"gl");x(this,"handle");x(this,"glTarget");x(this,"glUsage");x(this,"glIndexType",5123);x(this,"byteLength");x(this,"bytesUsed");this.device=t,this.gl=this.device.gl;const s=typeof i=="object"?i.handle:void 0;this.handle=s||this.gl.createBuffer(),t.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=XD(this.props.usage),this.glUsage=QD(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,i.data?this._initWithData(i.data,i.byteOffset,i.byteLength):this._initWithByteLength(i.byteLength||0)}_initWithData(t,i=0,s=t.byteLength+i){const r=this.glTarget;this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,s,this.glUsage),this.gl.bufferSubData(r,i,t),this.gl.bindBuffer(r,null),this.bytesUsed=s,this.byteLength=s,this._setDebugData(t,i,s),this.trackAllocatedMemory(s)}_initWithByteLength(t){let i=t;t===0&&(i=new Float32Array(0));const s=this.glTarget;return this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,i,this.glUsage),this.gl.bindBuffer(s,null),this.bytesUsed=t,this.byteLength=t,this._setDebugData(null,0,t),this.trackAllocatedMemory(t),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(t,i=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,i,t),this.gl.bindBuffer(36663,null),this._setDebugData(t,i,t.byteLength)}async readAsync(t=0,i){return this.readSyncWebGL(t,i)}readSyncWebGL(t=0,i){i=i??this.byteLength-t;const s=new Uint8Array(i),r=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,s,r,i),this.gl.bindBuffer(36662,null),this._setDebugData(s,t,i),s}}function XD(n){return n&Ft.INDEX?34963:n&Ft.VERTEX?34962:n&Ft.UNIFORM?35345:34962}function QD(n){return n&Ft.INDEX||n&Ft.VERTEX?35044:n&Ft.UNIFORM?35048:35044}function YD(n){const e=n.split(/\r?\n/),t=[];for(const i of e){if(i.length<=1)continue;const s=i.split(":");if(s.length===2){const[_,v]=s;t.push({message:v.trim(),type:Np(_),lineNum:0,linePos:0});continue}const[r,o,a,...l]=s;let f=parseInt(a,10);isNaN(f)&&(f=0);let g=parseInt(o,10);isNaN(g)&&(g=0),t.push({message:l.join(":").trim(),type:Np(r),lineNum:f,linePos:g})}return t}function Np(n){const e=["warning","error","info"],t=n.toLowerCase();return e.includes(t)?t:"info"}class KD extends $l{constructor(t,i){super(t,i);x(this,"device");x(this,"handle");switch(this.device=t,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const t=this.device.gl.getShaderInfoLog(this.handle);return t?YD(t):[]}getTranslatedSource(){const i=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return(i==null?void 0:i.getTranslatedShaderSource(this.handle))||null}async _compile(t){t=t.startsWith("#version ")?t:`#version 300 es
${t}`;const{gl:i}=this.device;if(i.shaderSource(this.handle,t),i.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}ye.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),ye.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const t=async r=>await new Promise(o=>setTimeout(o,r));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:s}=this.device;for(;;){if(s.getShaderParameter(this.handle,37297))return;await t(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function qD(n,e,t,i){if(tN(e))return i(n);const s=n;s.pushState();try{return JD(n,e),ao(s.gl,t),i(n)}finally{s.popState()}}function JD(n,e){const t=n,{gl:i}=t;if(e.cullMode)switch(e.cullMode){case"none":i.disable(2884);break;case"front":i.enable(2884),i.cullFace(1028);break;case"back":i.enable(2884),i.cullFace(1029);break}if(e.frontFace&&i.frontFace(zs("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&n.features.has("depth-clip-control")&&i.enable(34383),e.depthBias!==void 0&&(i.enable(32823),i.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&n.features.has("provoking-vertex-webgl")){const r=t.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,o=zs("provokingVertex",e.provokingVertex,{first:36429,last:36430});r==null||r.provokingVertexWEBGL(o)}if((e.polygonMode||e.polygonOffsetLine)&&n.features.has("polygon-mode-webgl")){if(e.polygonMode){const r=t.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,o=zs("polygonMode",e.polygonMode,{fill:6914,line:6913});r==null||r.polygonModeWEBGL(1028,o),r==null||r.polygonModeWEBGL(1029,o)}e.polygonOffsetLine&&i.enable(10754)}if(n.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&i.enable(12288),e.clipDistance1&&i.enable(12289),e.clipDistance2&&i.enable(12290),e.clipDistance3&&i.enable(12291),e.clipDistance4&&i.enable(12292),e.clipDistance5&&i.enable(12293),e.clipDistance6&&i.enable(12294),e.clipDistance7&&i.enable(12295)),e.depthWriteEnabled!==void 0&&i.depthMask(eN("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?i.enable(2929):i.disable(2929),i.depthFunc($h("depthCompare",e.depthCompare))),e.stencilWriteMask){const s=e.stencilWriteMask;i.stencilMaskSeparate(1028,s),i.stencilMaskSeparate(1029,s)}if(e.stencilReadMask&&ye.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const s=e.stencilReadMask||4294967295,r=$h("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?i.enable(2960):i.disable(2960),i.stencilFuncSeparate(1028,r,0,s),i.stencilFuncSeparate(1029,r,0,s)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const s=Tu("stencilPassOperation",e.stencilPassOperation),r=Tu("stencilFailOperation",e.stencilFailOperation),o=Tu("stencilDepthFailOperation",e.stencilDepthFailOperation);i.stencilOpSeparate(1028,r,o,s),i.stencilOpSeparate(1029,r,o,s)}switch(e.blend){case!0:i.enable(3042);break;case!1:i.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const s=Fp("blendColorOperation",e.blendColorOperation||"add"),r=Fp("blendAlphaOperation",e.blendAlphaOperation||"add");i.blendEquationSeparate(s,r);const o=Xa("blendColorSrcFactor",e.blendColorSrcFactor||"one"),a=Xa("blendColorDstFactor",e.blendColorDstFactor||"zero"),l=Xa("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),f=Xa("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");i.blendFuncSeparate(o,a,l,f)}}function $h(n,e){return zs(n,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function Tu(n,e){return zs(n,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function Fp(n,e){return zs(n,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function Xa(n,e){return zs(n,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function ZD(n,e){return`Illegal parameter ${e} for ${n}`}function zs(n,e,t){if(!(e in t))throw new Error(ZD(n,e));return t[e]}function eN(n,e){return e}function tN(n){let e=!0;for(const t in n){e=!1;break}return e}function Ob(n){const e={};return n.addressModeU&&(e[10242]=wu(n.addressModeU)),n.addressModeV&&(e[10243]=wu(n.addressModeV)),n.addressModeW&&(e[32882]=wu(n.addressModeW)),n.magFilter&&(e[10240]=Xh(n.magFilter)),(n.minFilter||n.mipmapFilter)&&(e[10241]=nN(n.minFilter||"linear",n.mipmapFilter)),n.lodMinClamp!==void 0&&(e[33082]=n.lodMinClamp),n.lodMaxClamp!==void 0&&(e[33083]=n.lodMaxClamp),n.type==="comparison-sampler"&&(e[34892]=34894),n.compare&&(e[34893]=$h("compare",n.compare)),n.maxAnisotropy&&(e[34046]=n.maxAnisotropy),e}function wu(n){switch(n){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function Xh(n){switch(n){case"nearest":return 9728;case"linear":return 9729}}function nN(n,e="none"){if(!e)return Xh(n);switch(e){case"none":return Xh(n);case"nearest":return n==="nearest"?9984:9986;case"linear":return n==="nearest"?9985:9987}}class Qh extends Xl{constructor(t,i){super(t,i);x(this,"device");x(this,"handle");x(this,"parameters");this.device=t,this.parameters=Ob(i),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(t){for(const[i,s]of Object.entries(t)){const r=Number(i);switch(r){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,r,s);break;default:this.device.gl.samplerParameteri(this.handle,r,s);break}}}}class Mr extends jl{constructor(t,i){super(t,{...kt.defaultProps,...i});x(this,"device");x(this,"gl");x(this,"handle");x(this,"texture");this.device=t,this.gl=this.device.gl,this.handle=null,this.texture=i.texture}}const iN="Failed to deduce GL constant from typed array";function sN(n){switch(ArrayBuffer.isView(n)?n.constructor:n){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(iN)}}function rN(n,e){const{clamped:t=!0}=e||{};switch(n){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return t?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function Db(n){switch(n){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function oN(n){switch(n){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function uc(n,e,t){if(aN(e))return t(n);const{nocatch:i=!0}=e,s=Vs.get(n);s.push(),ao(n,e);let r;if(i)r=t(n),s.pop();else try{r=t(n)}finally{s.pop()}return r}function aN(n){for(const e in n)return!1;return!0}function lN(n,e,t){const{dimension:i,width:s,height:r,depth:o=0}=t,{glInternalFormat:a}=t,l=t.glTarget;switch(i){case"2d-array":case"3d":n.texStorage3D(l,e,a,s,r,o);break;default:n.texStorage2D(l,e,a,s,r)}}function Lp(n,e,t,i){const{width:s,height:r}=i,{dimension:o,depth:a=0,mipLevel:l=0}=i,{x:f=0,y:g=0,z:_=0}=i,{glFormat:v,glType:T}=i,C=Nb(i.glTarget,o,a),S=i.flipY?{37440:!0}:{};uc(n,S,()=>{switch(o){case"2d-array":case"3d":n.bindTexture(C,e),n.texSubImage3D(C,l,f,g,_,s,r,a,v,T,t),n.bindTexture(C,null);break;case"2d":case"cube":n.bindTexture(C,e),n.texSubImage2D(C,l,f,g,s,r,v,T,t),n.bindTexture(C,null);break;default:throw new Error(o)}})}function kp(n,e,t){const{dimension:i,width:s,height:r,depth:o=0,mipLevel:a=0,byteOffset:l=0}=t,{x:f=0,y:g=0,z:_=0}=t,{glFormat:v,glType:T,compressed:C}=t,S=Nb(t.glTarget,i,o);switch(i){case"2d-array":case"3d":C?n.compressedTexSubImage3D(S,a,f,g,_,s,r,o,v,e,l):n.texSubImage3D(S,a,f,g,_,s,r,o,v,T,e,l);break;case"2d":case"cube":C?n.compressedTexSubImage2D(S,a,f,g,s,r,v,e,l):n.texSubImage2D(S,a,f,g,s,r,v,T,e,l);break;default:throw new Error(i)}}function cN(n){switch(n){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(n)}function Nb(n,e,t){return e==="cube"?34069+t:n}function AN(n,e){var P;const{sourceX:t=0,sourceY:i=0,sourceAttachment:s=0}=e||{};let{target:r=null,sourceWidth:o,sourceHeight:a,sourceDepth:l,sourceFormat:f,sourceType:g}=e||{};const{framebuffer:_,deleteFramebuffer:v}=Fb(n),{gl:T,handle:C}=_;o||(o=_.width),a||(a=_.height);const S=(P=_.colorAttachments[s])==null?void 0:P.texture;if(!S)throw new Error(`Invalid framebuffer attachment ${s}`);l=(S==null?void 0:S.depth)||1,f||(f=(S==null?void 0:S.glFormat)||6408),g||(g=(S==null?void 0:S.glType)||5121),r=fN(r,g,f,o,a),g=g||sN(r);const R=T.bindFramebuffer(36160,C);return T.readBuffer(36064+s),T.readPixels(t,i,o,a,f,g,r),T.readBuffer(36064),T.bindFramebuffer(36160,R||null),v&&_.destroy(),r}function uN(n,e){const{target:t,sourceX:i=0,sourceY:s=0,sourceFormat:r=6408,targetByteOffset:o=0}=e||{};let{sourceWidth:a,sourceHeight:l,sourceType:f}=e||{};const{framebuffer:g,deleteFramebuffer:_}=Fb(n);a=a||g.width,l=l||g.height;const v=g;f=f||5121;let T=t;if(!T){const S=Db(r),R=oN(f),P=o+a*l*S*R;T=v.device.createBuffer({byteLength:P})}const C=n.device.createCommandEncoder();return C.copyTextureToBuffer({sourceTexture:n,width:a,height:l,origin:[i,s],destinationBuffer:T,byteOffset:o}),C.destroy(),_&&g.destroy(),T}function Fb(n){return n instanceof Ql?{framebuffer:n,deleteFramebuffer:!1}:{framebuffer:hN(n),deleteFramebuffer:!0}}function hN(n,e){const{device:t,width:i,height:s,id:r}=n;return t.createFramebuffer({...e,id:`framebuffer-for-${r}`,width:i,height:s,colorAttachments:[n]})}function fN(n,e,t,i,s,r){if(n)return n;e||(e=5121);const o=rN(e,{clamped:!1}),a=Db(t);return new o(i*s*a)}class Xo extends kt{constructor(t,i){super(t,i);x(this,"device");x(this,"gl");x(this,"handle");x(this,"sampler");x(this,"view");x(this,"mipmaps");x(this,"compressed");x(this,"glTarget");x(this,"glFormat");x(this,"glType");x(this,"glInternalFormat");x(this,"textureUnit",0);const s={...this.props};s.data=i.data,this.device=t,this.gl=this.device.gl,this.glTarget=cN(this.props.dimension);const r=Pb(this.props.format);this.glInternalFormat=r.internalFormat,this.glFormat=r.format,this.glType=r.type,this.compressed=r.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(s),Object.seal(this)}_initialize(t){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:t.data});let{width:i,height:s}=t;if(!i||!s){const r=kt.getTextureDataSize(t.data);i=(r==null?void 0:r.width)||1,s=(r==null?void 0:r.height)||1}if(this.width=i,this.height=s,this.depth=t.depth,this.setSampler(t.sampler),this.view=new Mr(this.device,{...this.props,texture:this}),this.bind(),lN(this.gl,this.mipLevels,this),t.data)switch(t.dimension){case"1d":this.setTexture1DData(t.data);break;case"2d":this.setTexture2DData(t.data);break;case"3d":this.setTexture3DData(t.data);break;case"cube":this.setTextureCubeData(t.data);break;case"2d-array":this.setTextureArrayData(t.data);break;case"cube-array":this.setTextureCubeArrayData(t.data);break;default:throw new Error(t.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(t){return new Mr(this.device,{...t,texture:this})}setSampler(t={}){let i;t instanceof Qh?(this.sampler=t,i=t.props):(this.sampler=new Qh(this.device,t),i=t);const s=Ob(i);this._setSamplerParameters(s)}generateMipmap(t){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(ye.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!(t!=null&&t.force))))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(s){ye.warn(`Error generating mipmap for ${this}: ${s.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(t){const i=kt.getExternalImageSize(t.image),s={...kt.defaultCopyExternalImageOptions,...i,...t},{image:r,depth:o,mipLevel:a,x:l,y:f,z:g,flipY:_}=s;let{width:v,height:T}=s;const{dimension:C,glTarget:S,glFormat:R,glInternalFormat:P,glType:F}=this;if(v=Math.min(v,this.width-l),T=Math.min(T,this.height-f),t.sourceX||t.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return Lp(this.device.gl,this.handle,r,{dimension:C,mipLevel:a,x:l,y:f,z:g,width:v,height:T,depth:o,glFormat:R,glType:F,glTarget:S,flipY:_}),{width:s.width,height:s.height}}setTexture1DData(t){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(t,i=0){this.bind();const s=kt.normalizeTextureData(t,this);s.length>1&&this.props.mipmaps!==!1&&ye.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let r=0;r<s.length;r++){const o=s[r];this._setMipLevel(i,r,o)}this.unbind()}setTexture3DData(t){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(t)&&(this.bind(),kp(this.device.gl,t,this),this.unbind())}setTextureCubeData(t,i=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(const s of kt.CubeFaces)this.setTextureCubeFaceData(t[s],s)}setTextureArrayData(t){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(t){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(t,i,s=0){Array.isArray(t)&&t.length>1&&this.props.mipmaps!==!1&&ye.warn(`${this.id} has mipmap and multiple LODs.`)();const r=kt.CubeFaces.indexOf(i);this.setTexture2DData(t,r)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(t){const{face:i,width:s,height:r,pixels:o,data:a,format:l=6408,type:f=5121}=t,{gl:g}=this,_=o||a;this.bind(),_ instanceof Promise?_.then(v=>this.setImageDataForFace(Object.assign({},t,{face:i,data:v,pixels:v}))):this.width||this.height?g.texImage2D(i,0,l,s,r,0,l,f,_):g.texImage2D(i,0,l,l,f,_)}_getImageDataMap(t){for(let i=0;i<kt.CubeFaces.length;++i){const s=kt.CubeFaces[i];t[s]&&(t[34069+i]=t[s],delete t[s])}return t}_setSamplerParameters(t){ye.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(t))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[i,s]of Object.entries(t)){const r=Number(i),o=s;switch(r){case 33082:case 33083:this.gl.texParameterf(this.glTarget,r,o);break;case 10241:this.gl.texParameteri(this.glTarget,r,o);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,r,o);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,r,o);break;default:this.gl.texParameteri(this.glTarget,r,o);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(t,i,s,r=this.glTarget){if(kt.isExternalImage(s)){Lp(this.device.gl,this.handle,s,{...this,depth:t,mipLevel:i,glTarget:r,flipY:this.props.flipY});return}if(kt.isTextureLevelData(s)){kp(this.device.gl,s.data,{...this,depth:t,mipLevel:i,glTarget:r});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(t){const{gl:i}=this;return t!==void 0&&(this.textureUnit=t,i.activeTexture(33984+t)),i.bindTexture(this.glTarget,this.handle),t}unbind(t){const{gl:i}=this;return t!==void 0&&(this.textureUnit=t,i.activeTexture(33984+t)),i.bindTexture(this.glTarget,null),t}}const dN=[1,2,4,8];class gN extends bh{constructor(t,i){var o;super(t,i);x(this,"device");x(this,"glParameters");this.device=t;let s;if(!((o=i==null?void 0:i.parameters)!=null&&o.viewport))if(i!=null&&i.framebuffer){const{width:a,height:l}=i.framebuffer;s=[0,0,a,l]}else{const[a,l]=t.getCanvasContext().getDrawingBufferSize();s=[0,0,a,l]}this.device.pushState(),this.setParameters({viewport:s,...this.props.parameters});const r=this.props.framebuffer;if(r!=null&&r.handle)if(this.props.framebuffer){const a=this.props.framebuffer.colorAttachments.map((l,f)=>36064+f);this.device.gl.drawBuffers(a)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}setParameters(t={}){const i={...this.glParameters};i.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(i.depthMask=!this.props.depthReadOnly),i.stencilMask=this.props.stencilReadOnly?0:1,i[35977]=this.props.discard,t.viewport&&(t.viewport.length>=6?(i.viewport=t.viewport.slice(0,4),i.depthRange=[t.viewport[4],t.viewport[5]]):i.viewport=t.viewport),t.scissorRect&&(i.scissorTest=!0,i.scissor=t.scissorRect),t.blendConstant&&(i.blendColor=t.blendConstant),t.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),t[2967]=t.stencilReference),t.colorMask&&(i.colorMask=dN.map(s=>!!(s&t.colorMask))),this.glParameters=i,ao(this.device.gl,i)}beginOcclusionQuery(t){const i=this.props.occlusionQuerySet;i==null||i.beginOcclusionQuery()}endOcclusionQuery(){const t=this.props.occlusionQuerySet;t==null||t.endOcclusionQuery()}clear(){const t={...this.glParameters};let i=0;this.props.clearColors&&this.props.clearColors.forEach((s,r)=>{s&&this.clearColorBuffer(r,s)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(i|=16384,t.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(i|=256,t.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(i|=1024,t.clearStencil=this.props.clearStencil),i!==0&&uc(this.device.gl,t,()=>{this.device.gl.clear(i)})}clearColorBuffer(t=0,i=[0,0,0,0]){uc(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(i.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,t,i);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,t,i);break;case Float32Array:this.device.gl.clearBufferfv(6144,t,i);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function pN(n){return mN.includes(n)}const mN=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],Lb={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function kb(n){const e=Lb[n];if(!e)throw new Error("uniform");const[t,i,,s]=e;return{format:s,components:i,glType:t}}function _N(n){const e=Lb[n];if(!e)throw new Error("attribute");const[,t,,i,s]=e;return{attributeType:i,vertexFormat:s,components:t}}function yN(n,e){const t={attributes:[],bindings:[]};t.attributes=bN(n,e);const i=wN(n,e);for(const a of i){const l=a.uniforms.map(f=>({name:f.name,format:f.format,byteOffset:f.byteOffset,byteStride:f.byteStride,arrayLength:f.arrayLength}));t.bindings.push({type:"uniform",name:a.name,group:0,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:l})}const s=TN(n,e);let r=0;for(const a of s)if(pN(a.type)){const{viewDimension:l,sampleType:f}=xN(a.type);t.bindings.push({type:"texture",name:a.name,group:0,location:r,viewDimension:l,sampleType:f}),a.textureUnit=r,r+=1}s.length&&(t.uniforms=s);const o=vN(n,e);return o!=null&&o.length&&(t.varyings=o),t}function bN(n,e){const t=[],i=n.getProgramParameter(e,35721);for(let s=0;s<i;s++){const r=n.getActiveAttrib(e,s);if(!r)throw new Error("activeInfo");const{name:o,type:a}=r,l=n.getAttribLocation(e,o);if(l>=0){const{attributeType:f}=_N(a),g=/instance/i.test(o)?"instance":"vertex";t.push({name:o,location:l,stepMode:g,type:f})}}return t.sort((s,r)=>s.location-r.location),t}function vN(n,e){const t=[],i=n.getProgramParameter(e,35971);for(let s=0;s<i;s++){const r=n.getTransformFeedbackVarying(e,s);if(!r)throw new Error("activeInfo");const{name:o,type:a,size:l}=r,{glType:f,components:g}=kb(a),_={location:s,name:o,type:f,size:l*g};t.push(_)}return t.sort((s,r)=>s.location-r.location),t}function TN(n,e){const t=[],i=n.getProgramParameter(e,35718);for(let s=0;s<i;s++){const r=n.getActiveUniform(e,s);if(!r)throw new Error("activeInfo");const{name:o,size:a,type:l}=r,{name:f,isArray:g}=CN(o);let _=n.getUniformLocation(e,f);const v={location:_,name:f,size:a,type:l,isArray:g};if(t.push(v),v.size>1)for(let T=0;T<v.size;T++){const C=`${f}[${T}]`;_=n.getUniformLocation(e,C);const S={...v,name:C,location:_};t.push(S)}}return t}function wN(n,e){const t=(r,o)=>n.getActiveUniformBlockParameter(e,r,o),i=[],s=n.getProgramParameter(e,35382);for(let r=0;r<s;r++){const o={name:n.getActiveUniformBlockName(e,r)||"",location:t(r,35391),byteLength:t(r,35392),vertex:t(r,35396),fragment:t(r,35398),uniformCount:t(r,35394),uniforms:[]},a=t(r,35395)||[],l=n.getActiveUniforms(e,a,35383),f=n.getActiveUniforms(e,a,35384),g=n.getActiveUniforms(e,a,35387),_=n.getActiveUniforms(e,a,35388);for(let v=0;v<o.uniformCount;++v){const T=n.getActiveUniform(e,a[v]);if(!T)throw new Error("activeInfo");o.uniforms.push({name:T.name,format:kb(l[v]).format,type:l[v],arrayLength:f[v],byteOffset:g[v],byteStride:_[v]})}i.push(o)}return i.sort((r,o)=>r.location-o.location),i}const EN={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function xN(n){const e=EN[n];if(!e)throw new Error("sampler");const[t,i]=e;return{viewDimension:t,sampleType:i}}function CN(n){if(n[n.length-1]!=="]")return{name:n,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(n);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${n}`);return{name:t[1],length:t[2]?1:0,isArray:!!t[2]}}function SN(n,e,t,i){const s=n;let r=i;r===!0&&(r=1),r===!1&&(r=0);const o=typeof r=="number"?[r]:r;switch(t){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof i!="number")throw new Error("samplers must be set to integers");return n.uniform1i(e,i);case 5126:return n.uniform1fv(e,o);case 35664:return n.uniform2fv(e,o);case 35665:return n.uniform3fv(e,o);case 35666:return n.uniform4fv(e,o);case 5124:return n.uniform1iv(e,o);case 35667:return n.uniform2iv(e,o);case 35668:return n.uniform3iv(e,o);case 35669:return n.uniform4iv(e,o);case 35670:return n.uniform1iv(e,o);case 35671:return n.uniform2iv(e,o);case 35672:return n.uniform3iv(e,o);case 35673:return n.uniform4iv(e,o);case 5125:return s.uniform1uiv(e,o,1);case 36294:return s.uniform2uiv(e,o,2);case 36295:return s.uniform3uiv(e,o,3);case 36296:return s.uniform4uiv(e,o,4);case 35674:return n.uniformMatrix2fv(e,!1,o);case 35675:return n.uniformMatrix3fv(e,!1,o);case 35676:return n.uniformMatrix4fv(e,!1,o);case 35685:return s.uniformMatrix2x3fv(e,!1,o);case 35686:return s.uniformMatrix2x4fv(e,!1,o);case 35687:return s.uniformMatrix3x2fv(e,!1,o);case 35688:return s.uniformMatrix3x4fv(e,!1,o);case 35689:return s.uniformMatrix4x2fv(e,!1,o);case 35690:return s.uniformMatrix4x3fv(e,!1,o)}throw new Error("Illegal uniform")}function IN(n){return gb(n)!==null||typeof n=="number"||typeof n=="boolean"}function RN(n){const e={bindings:{},uniforms:{}};return Object.keys(n).forEach(t=>{const i=n[t];IN(i)?e.uniforms[t]=i:e.bindings[t]=i}),e}function PN(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(n)}}function MN(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(n)}}const Up=4;class BN extends jr{constructor(t,i){super(t,i);x(this,"device");x(this,"handle");x(this,"vs");x(this,"fs");x(this,"introspectedLayout");x(this,"uniforms",{});x(this,"bindings",{});x(this,"varyings",null);x(this,"_uniformCount",0);x(this,"_uniformSetters",{});this.device=t,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=i.vs,this.fs=i.fs;const{varyings:s,bufferMode:r=35981}=i;s&&s.length>0&&(this.varyings=s,this.device.gl.transformFeedbackVaryings(this.handle,s,r)),this._linkShaders(),ye.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=yN(this.device.gl,this.handle),ye.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=ON(this.introspectedLayout,i.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(t,i){for(const[s,r]of Object.entries(t)){const o=this.shaderLayout.bindings.find(a=>a.name===s)||this.shaderLayout.bindings.find(a=>a.name===`${s}Uniforms`);if(!o){const a=this.shaderLayout.bindings.map(l=>`"${l.name}"`).join(", ");i!=null&&i.disableWarnings||ye.warn(`No binding "${s}" in render pipeline "${this.id}", expected one of ${a}`,r)();continue}switch(r||ye.warn(`Unsetting binding "${s}" in render pipeline "${this.id}"`)(),o.type){case"uniform":if(!(r instanceof $o)&&!(r.buffer instanceof $o))throw new Error("buffer value");break;case"texture":if(!(r instanceof Mr||r instanceof Xo||r instanceof jo))throw new Error("texture value");break;case"sampler":ye.warn(`Ignoring sampler ${s}`)();break;default:throw new Error(o.type)}this.bindings[s]=r}}draw(t){var R;const{renderPass:i,parameters:s=this.props.parameters,topology:r=this.props.topology,vertexArray:o,vertexCount:a,instanceCount:l,isInstanced:f=!1,firstVertex:g=0,transformFeedback:_}=t,v=PN(r),T=!!o.indexBuffer,C=(R=o.indexBuffer)==null?void 0:R.glIndexType;if(this.linkStatus!=="success")return ye.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return ye.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),o.bindBeforeRender(i),_&&_.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const S=i;return qD(this.device,s,S.glParameters,()=>{T&&f?this.device.gl.drawElementsInstanced(v,a||0,C,g,l||0):T?this.device.gl.drawElements(v,a||0,C,g):f?this.device.gl.drawArraysInstanced(v,g,a||0,l||0):this.device.gl.drawArrays(v,g,a||0),_&&_.end()}),o.unbindAfterRender(i),!0}setUniformsWebGL(t){const{bindings:i}=RN(t);Object.keys(i).forEach(s=>{ye.warn(`Unsupported value "${JSON.stringify(i[s])}" used in setUniforms() for key ${s}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,t)}async _linkShaders(){const{gl:t}=this.device;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),ye.time(Up,`linkProgram for ${this.id}`)(),t.linkProgram(this.handle),ye.timeEnd(Up,`linkProgram for ${this.id}`)(),ye.level,!this.device.features.has("compilation-status-async-webgl")){const s=this._getLinkStatus();this._reportLinkStatus(s);return}ye.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),ye.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const i=this._getLinkStatus();this._reportLinkStatus(i)}async _reportLinkStatus(t){var i;switch(t){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch((i=this.fs)==null?void 0:i.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const s=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${t}: ${s}`)}}_getLinkStatus(){const{gl:t}=this.device;return t.getProgramParameter(this.handle,35714)?(t.validateProgram(this.handle),t.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const t=async r=>await new Promise(o=>setTimeout(o,r));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:s}=this.device;for(;;){if(s.getProgramParameter(this.handle,37297))return;await t(10)}}_areTexturesRenderable(){let t=!0;for(const i of this.shaderLayout.bindings)!this.bindings[i.name]&&!this.bindings[i.name.replace(/Uniforms$/,"")]&&(ye.warn(`Binding ${i.name} not found in ${this.id}`)(),t=!1);return t}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:t}=this.device;t.useProgram(this.handle);let i=0,s=0;for(const r of this.shaderLayout.bindings){const o=this.bindings[r.name]||this.bindings[r.name.replace(/Uniforms$/,"")];if(!o)throw new Error(`No value for binding ${r.name} in ${this.id}`);switch(r.type){case"uniform":const{name:a}=r,l=t.getUniformBlockIndex(this.handle,a);if(l===4294967295)throw new Error(`Invalid uniform block name ${a}`);t.uniformBlockBinding(this.handle,s,l),o instanceof $o?t.bindBufferBase(35345,s,o.handle):t.bindBufferRange(35345,s,o.buffer.handle,o.offset||0,o.size||o.buffer.byteLength-o.offset),s+=1;break;case"texture":if(!(o instanceof Mr||o instanceof Xo||o instanceof jo))throw new Error("texture");let f;if(o instanceof Mr)f=o.texture;else if(o instanceof Xo)f=o;else if(o instanceof jo&&o.colorAttachments[0]instanceof Mr)ye.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),f=o.colorAttachments[0].texture;else throw new Error("No texture");t.activeTexture(33984+i),t.bindTexture(f.glTarget,f.handle),i+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${r.type}' not supported in WebGL`)}}}_applyUniforms(){for(const t of this.shaderLayout.uniforms||[]){const{name:i,location:s,type:r,textureUnit:o}=t,a=this.uniforms[i]??o;a!==void 0&&SN(this.device.gl,s,r,a)}}}function ON(n,e){const t={...n,attributes:n.attributes.map(i=>({...i}))};for(const i of(e==null?void 0:e.attributes)||[]){const s=t.attributes.find(r=>r.name===i.name);s?(s.type=i.type||s.type,s.stepMode=i.stepMode||s.stepMode):ye.warn(`shader layout attribute ${i.name} not present in shader`)}return t}class DN extends Th{constructor(t){super(t,{});x(this,"device");x(this,"commands",[]);this.device=t}submitCommands(t=this.commands){for(const i of t)switch(i.name){case"copy-buffer-to-buffer":NN(this.device,i.options);break;case"copy-buffer-to-texture":FN(this.device,i.options);break;case"copy-texture-to-buffer":LN(this.device,i.options);break;case"copy-texture-to-texture":kN(this.device,i.options);break;default:throw new Error(i.name)}}}function NN(n,e){const t=e.sourceBuffer,i=e.destinationBuffer;n.gl.bindBuffer(36662,t.handle),n.gl.bindBuffer(36663,i.handle),n.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),n.gl.bindBuffer(36662,null),n.gl.bindBuffer(36663,null)}function FN(n,e){throw new Error("Not implemented")}function LN(n,e){const{sourceTexture:t,mipLevel:i=0,aspect:s="all",width:r=e.sourceTexture.width,height:o=e.sourceTexture.height,depthOrArrayLayers:a=0,origin:l=[0,0],destinationBuffer:f,byteOffset:g=0,bytesPerRow:_,rowsPerImage:v}=e;if(s!=="all")throw new Error("aspect not supported in WebGL");if(i!==0||a!==0||_||v)throw new Error("not implemented");const{framebuffer:T,destroyFramebuffer:C}=Ub(t);let S;try{const R=f,P=r||T.width,F=o||T.height,U=Pb(T.colorAttachments[0].texture.props.format),X=U.format,Z=U.type;n.gl.bindBuffer(35051,R.handle),S=n.gl.bindFramebuffer(36160,T.handle),n.gl.readPixels(l[0],l[1],P,F,X,Z,g)}finally{n.gl.bindBuffer(35051,null),S!==void 0&&n.gl.bindFramebuffer(36160,S),C&&T.destroy()}}function kN(n,e){const{sourceTexture:t,destinationMipLevel:i=0,origin:s=[0,0],destinationOrigin:r=[0,0],destinationTexture:o}=e;let{width:a=e.destinationTexture.width,height:l=e.destinationTexture.height}=e;const{framebuffer:f,destroyFramebuffer:g}=Ub(t),[_,v]=s,[T,C,S]=r,R=n.gl.bindFramebuffer(36160,f.handle);let P=null,F;if(o instanceof Xo)P=o,a=Number.isFinite(a)?a:P.width,l=Number.isFinite(l)?l:P.height,P.bind(0),F=P.glTarget;else throw new Error("invalid destination");switch(F){case 3553:case 34067:n.gl.copyTexSubImage2D(F,i,T,C,_,v,a,l);break;case 35866:case 32879:n.gl.copyTexSubImage3D(F,i,T,C,S,_,v,a,l);break}P&&P.unbind(),n.gl.bindFramebuffer(36160,R),g&&f.destroy()}function Ub(n){if(n instanceof kt){const{width:e,height:t,id:i}=n;return{framebuffer:n.device.createFramebuffer({id:`framebuffer-for-${i}`,width:e,height:t,colorAttachments:[n]}),destroyFramebuffer:!0}}return{framebuffer:n,destroyFramebuffer:!1}}class UN extends vh{constructor(t,i){super(t,i);x(this,"device");x(this,"commandBuffer");this.device=t,this.commandBuffer=new DN(t)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(t){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:t})}copyBufferToTexture(t){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:t})}copyTextureToBuffer(t){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:t})}copyTextureToTexture(t){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:t})}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}resolveQuerySet(t,i,s){}}function VN(n){const{target:e,source:t,start:i=0,count:s=1}=n,r=t.length,o=s*r;let a=0;for(let l=i;a<r;a++)e[l++]=t[a];for(;a<o;)a<o-a?(e.copyWithin(i+a,i,i+a),a*=2):(e.copyWithin(i+a,i,i+o-a),a=o);return n.target}class od extends wh{constructor(t,i){super(t,i);x(this,"device");x(this,"handle");x(this,"buffer",null);x(this,"bufferValue",null);this.device=t,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(t){return LE()==="Chrome"}destroy(){var t;super.destroy(),this.buffer&&((t=this.buffer)==null||t.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(t){const i=t;if(i&&i.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,i?i.handle:null),this.indexBuffer=i,this.device.gl.bindVertexArray(null)}setBuffer(t,i){const s=i;if(s.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:r,type:o,stride:a,offset:l,normalized:f,integer:g,divisor:_}=this._getAccessor(t);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,s.handle),g?this.device.gl.vertexAttribIPointer(t,r,o,a,l):this.device.gl.vertexAttribPointer(t,r,o,f,a,l),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(t),this.device.gl.vertexAttribDivisor(t,_||0),this.attributes[t]=s,this.device.gl.bindVertexArray(null)}setConstantWebGL(t,i){this._enable(t,!1),this.attributes[t]=i}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let t=0;t<this.maxVertexAttributes;++t){const i=this.attributes[t];ArrayBuffer.isView(i)&&this.device.setConstantAttributeWebGL(t,i)}}_getAccessor(t){const i=this.attributeInfos[t];if(!i)throw new Error(`Unknown attribute location ${t}`);const s=Rb(i.bufferDataType);return{size:i.bufferComponents,type:s,stride:i.byteStride,offset:i.byteOffset,normalized:i.normalized,integer:i.integer,divisor:i.stepMode==="instance"?1:0}}_enable(t,i=!0){const r=od.isConstantAttributeZeroSupported(this.device)||t!==0;(i||r)&&(t=Number(t),this.device.gl.bindVertexArray(this.handle),i?this.device.gl.enableVertexAttribArray(t):this.device.gl.disableVertexAttribArray(t),this.device.gl.bindVertexArray(null))}getConstantBuffer(t,i){const s=zN(i),r=s.byteLength*t,o=s.length*t;if(this.buffer&&r!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${r} !== ${this.buffer.byteLength}.`);let a=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:r}),a=a||!HN(s,this.bufferValue),a){const l=GI(i.constructor,o);VN({target:l,source:s,start:0,count:o}),this.buffer.write(l),this.bufferValue=i}return this.buffer}}function zN(n){return Array.isArray(n)?new Float32Array(n):n}function HN(n,e){if(!n||!e||n.length!==e.length||n.constructor!==e.constructor)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}class GN extends Eh{constructor(t,i){super(t,i);x(this,"device");x(this,"gl");x(this,"handle");x(this,"layout");x(this,"buffers",{});x(this,"unusedBuffers",{});x(this,"bindOnUse",!0);x(this,"_bound",!1);this.device=t,this.gl=t.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,i.buffers&&this.setBuffers(i.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(t="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(MN(t))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(t){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const i in t)this.setBuffer(i,t[i])})}setBuffer(t,i){const s=this._getVaryingIndex(t),{buffer:r,byteLength:o,byteOffset:a}=this._getBufferRange(i);if(s<0){this.unusedBuffers[t]=r,ye.warn(`${this.id} unusedBuffers varying buffer ${t}`)();return}this.buffers[s]={buffer:r,byteLength:o,byteOffset:a},this.bindOnUse||this._bindBuffer(s,r,a,o)}getBuffer(t){if(Vp(t))return this.buffers[t]||null;const i=this._getVaryingIndex(t);return i>=0?this.buffers[i]:null}bind(t=this.handle){if(typeof t!="function")return this.gl.bindTransformFeedback(36386,t),this;let i;return this._bound?i=t():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,i=t(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),i}unbind(){this.bind(null)}_getBufferRange(t){if(t instanceof $o)return{buffer:t,byteOffset:0,byteLength:t.byteLength};const{buffer:i,byteOffset:s=0,byteLength:r=t.buffer.byteLength}=t;return{buffer:i,byteOffset:s,byteLength:r}}_getVaryingIndex(t){if(Vp(t))return Number(t);for(const i of this.layout.varyings)if(t===i.name)return i.location;return-1}_bindBuffers(){for(const t in this.buffers){const{buffer:i,byteLength:s,byteOffset:r}=this._getBufferRange(this.buffers[t]);this._bindBuffer(Number(t),i,r,s)}}_unbindBuffers(){for(const t in this.buffers)this.gl.bindBufferBase(35982,Number(t),null)}_bindBuffer(t,i,s=0,r){const o=i&&i.handle;!o||r===void 0?this.gl.bindBufferBase(35982,t,o):this.gl.bindBufferRange(35982,t,o,s,r)}}function Vp(n){return typeof n=="number"?Number.isInteger(n):/^\d+$/.test(n)}class WN extends xh{constructor(t,i){super(t,i);x(this,"device");x(this,"handle");x(this,"target",null);x(this,"_queryPending",!1);x(this,"_pollingPromise",null);if(this.device=t,i.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(t){return this._begin(t!=null&&t.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(t){this._queryPending||(this.target=t,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const t=this.device.gl.getQueryParameter(this.handle,34919);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(t=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let i=0;return this._pollingPromise=new Promise((s,r)=>{const o=()=>{this.isResultAvailable()?(s(this.getResult()),this._pollingPromise=null):i++>t?(r("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}}class rs extends ls{constructor(t){var _,v;super({...t,id:t.id||$D("webgl-device")});x(this,"type","webgl");x(this,"handle");x(this,"features");x(this,"limits");x(this,"info");x(this,"canvasContext");x(this,"lost");x(this,"_resolveContextLost");x(this,"gl");x(this,"debug",!1);x(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});x(this,"_extensions",{});x(this,"_polyfilled",!1);x(this,"spectorJS");x(this,"renderPass",null);x(this,"_constants");const i=ls._getCanvasContextProps(t);if(!i)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let s=(v=(_=i.canvas)==null?void 0:_.gl)==null?void 0:v.device;if(s)throw new Error(`WebGL context already attached to device ${s.id}`);this.canvasContext=new ND(this,i),this.lost=new Promise(T=>{this._resolveContextLost=T});const r={...t.webgl};i.alphaMode==="premultiplied"&&(r.premultipliedAlpha=!0),t.powerPreference!==void 0&&(r.powerPreference=t.powerPreference);const a=this.props._handle||gD(this.canvasContext.canvas,{onContextLost:T=>{var C;return(C=this._resolveContextLost)==null?void 0:C.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})},onContextRestored:T=>console.log("WebGL context restored")},r);if(!a)throw new Error("WebGL context creation failed");if(s=a.device,s){if(t._reuseDevices)return ye.log(1,`Not creating a new Device, instead returning a reference to Device ${s.id} already attached to WebGL context`,s)(),s._reused=!0,s;throw new Error(`WebGL context already attached to device ${s.id}`)}this.handle=a,this.gl=a,this.spectorJS=kD({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=pD(this.gl,this._extensions),this.limits=new BD(this.gl),this.features=new MD(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),i.autoResize!==!1&&this.canvasContext.resize(),new Vs(this.gl,{log:(...T)=>ye.log(1,...T)()}).trackState(this.gl,{copyState:!1});const f=t.debugWebGL||t.debug,g=t.debugWebGL;f&&(this.gl=zD(this.gl,{debugWebGL:f,traceWebGL:g}),ye.warn("WebGL debug mode activated. Performance reduced.")(),t.debugWebGL&&(ye.level=Math.max(ye.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(t){throw new Error("WebGL only supports a single canvas")}createBuffer(t){const i=this._normalizeBufferProps(t);return new $o(this,i)}createTexture(t){return new Xo(this,t)}createExternalTexture(t){throw new Error("createExternalTexture() not implemented")}createSampler(t){return new Qh(this,t)}createShader(t){return new KD(this,t)}createFramebuffer(t){return new jo(this,t)}createVertexArray(t){return new od(this,t)}createTransformFeedback(t){return new GN(this,t)}createQuerySet(t){return new WN(this,t)}createRenderPipeline(t){return new BN(this,t)}beginRenderPass(t){return new gN(this,t)}createComputePipeline(t){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(t){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(t={}){return new UN(this,t)}submit(){var t;(t=this.renderPass)==null||t.end(),this.renderPass=null}readPixelsToArrayWebGL(t,i){return AN(t,i)}readPixelsToBufferWebGL(t,i){return uN(t,i)}setParametersWebGL(t){ao(this.gl,t)}getParametersWebGL(t){return Sb(this.gl,t)}withParametersWebGL(t,i){return uc(this.gl,t,i)}resetWebGL(){ye.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),AD(this.gl)}_getDeviceSpecificTextureFormatCapabilities(t){return SD(this.gl,t,this._extensions)}loseDevice(){var r;let t=!1;const s=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return s&&(t=!0,s.loseContext()),(r=this._resolveContextLost)==null||r.call(this,{reason:"destroyed",message:"Application triggered context loss"}),t}pushState(){Vs.get(this.gl).push()}popState(){Vs.get(this.gl).pop()}setSpectorMetadata(t,i){t.__SPECTOR_Metadata=i}getGLKey(t,i){const s=Number(t);for(const r in this.gl)if(this.gl[r]===s)return`GL.${r}`;return i!=null&&i.emptyIfUnknown?"":String(t)}getGLKeys(t){const i={emptyIfUnknown:!0};return Object.entries(t).reduce((s,[r,o])=>(s[`${r}:${this.getGLKey(r,i)}`]=`${o}:${this.getGLKey(o,i)}`,s),{})}setConstantAttributeWebGL(t,i){const s=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(s).fill(null);const r=this._constants[t];switch(r&&QN(r,i)&&ye.info(1,`setConstantAttributeWebGL(${t}) could have been skipped, value unchanged`)(),this._constants[t]=i,i.constructor){case Float32Array:jN(this,t,i);break;case Int32Array:$N(this,t,i);break;case Uint32Array:XN(this,t,i);break;default:throw new Error("constant")}}getExtension(t){return Kr(this.gl,t,this._extensions),this._extensions}}function jN(n,e,t){switch(t.length){case 1:n.gl.vertexAttrib1fv(e,t);break;case 2:n.gl.vertexAttrib2fv(e,t);break;case 3:n.gl.vertexAttrib3fv(e,t);break;case 4:n.gl.vertexAttrib4fv(e,t);break}}function $N(n,e,t){n.gl.vertexAttribI4iv(e,t)}function XN(n,e,t){n.gl.vertexAttribI4uiv(e,t)}function QN(n,e){if(!n||!e||n.length!==e.length||n.constructor!==e.constructor)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}const YN={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},KN=n=>({drawBuffersWEBGL(e){return n.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),qN=n=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return n.createVertexArray()},deleteVertexArrayOES(e){return n.deleteVertexArray(e)},isVertexArrayOES(e){return n.isVertexArray(e)},bindVertexArrayOES(e){return n.bindVertexArray(e)}}),JN=n=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return n.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return n.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return n.vertexAttribDivisor(...e)}});function ZN(n=!0){const e=HTMLCanvasElement.prototype;if(!n&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(t,i){if(t==="webgl"||t==="experimental-webgl"){const s=this.originalGetContext("webgl2",i);return s instanceof HTMLElement&&e6(s),s}return this.originalGetContext(t,i)}}function e6(n){n.getExtension("EXT_color_buffer_float");const e={...YN,WEBGL_disjoint_timer_query:n.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:KN(n),OES_vertex_array_object:qN(n),ANGLE_instanced_arrays:JN(n)},t=n.getExtension;n.getExtension=function(s){const r=t.call(n,s);return r||(s in e?e[s]:null)};const i=n.getSupportedExtensions;n.getSupportedExtensions=function(){const s=i.apply(n)||[];return s==null?void 0:s.concat(Object.keys(e))}}const Qa=1;class t6 extends yI{constructor(){super();x(this,"type","webgl");ls.defaultProps={...ls.defaultProps,...rd},rs.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(t){ZN(t)}async attach(t){if(t instanceof rs)return t;if((t==null?void 0:t.device)instanceof ls)return t.device;if(!n6(t))throw new Error("Invalid WebGL2RenderingContext");return new rs({_handle:t,createCanvasContext:{canvas:t.canvas,autoResize:!1}})}async create(t={}){ye.groupCollapsed(Qa,"WebGLDevice created")();const i=[];(t.debugWebGL||t.debug)&&i.push(VD()),t.debugSpectorJS&&i.push(LD(t));const s=await Promise.allSettled(i);for(const a of s)a.status==="rejected"&&ye.error(`Failed to initialize debug libraries ${a.reason}`)();const r=new rs(t),o=`${r._reused?"Reusing":"Created"} device with WebGL2 ${r.debug?"debug ":""}context: ${r.info.vendor}, ${r.info.renderer} for canvas: ${r.canvasContext.id}`;return ye.probe(Qa,o)(),ye.table(Qa,r.info)(),ye.groupEnd(Qa)(),r}}function n6(n){return typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext?!0:!!(n&&Number.isFinite(n._version))}const zp=new t6;function Yi(){}const i6=({isDragging:n})=>n?"grabbing":"grab",Vb={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{type:"webgl"},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Yi,onWebGLInitialized:Yi,onResize:Yi,onViewStateChange:Yi,onInteractionStateChange:Yi,onBeforeRender:Yi,onAfterRender:Yi,onLoad:Yi,onError:n=>ze.error(n.message,n.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:i6,getTooltip:null,debug:!1,drawPickingColors:!1};class ad{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new so({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=i=>{const{_pickRequest:s}=this;if(i.type==="pointerleave")s.x=-1,s.y=-1,s.radius=0;else{if(i.leftButton||i.rightButton)return;{const r=i.offsetCenter;if(!r)return;s.x=r.x,s.y=r.y,s.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:s.x,y:s.y}),s.event=i},this._onEvent=i=>{const s=Fh[i.type],r=i.offsetCenter;if(!s||!r||!this.layerManager)return;const o=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:r.x,y:r.y,layers:o,viewports:this.getViewports(r)},this._lastPointerDownInfo),{layer:l}=a,f=l&&(l[s]||l.props[s]),g=this.props[s];let _=!1;f&&(_=f.call(l,a,i)),_||(g==null||g(a,i),this.widgetManager.onEvent(a,i))},this._onPointerDown=i=>{const s=i.offsetCenter,r=this._pick("pickObject","pickObject Time",{x:s.x,y:s.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=r.result[0]||r.emptyInfo},this.props={...Vb,...e},e=this.props,e.viewState&&e.initialViewState&&ze.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let t=this.device;!t&&e.gl&&(e.gl instanceof WebGLRenderingContext&&ze.error("WebGL1 context not supported.")(),t=zp.attach(e.gl)),t||(t=_h.createDevice({type:"best-available",_reuseDevices:!0,adapters:[zp],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&Qr.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,t,i,s,r,o,a,l,f,g;(e=this.animationLoop)==null||e.stop(),(t=this.animationLoop)==null||t.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(i=this.layerManager)==null||i.finalize(),this.layerManager=null,(s=this.viewManager)==null||s.finalize(),this.viewManager=null,(r=this.effectManager)==null||r.finalize(),this.effectManager=null,(o=this.deckRenderer)==null||o.finalize(),this.deckRenderer=null,(a=this.deckPicker)==null||a.finalize(),this.deckPicker=null,(l=this.eventManager)==null||l.destroy(),this.eventManager=null,(f=this.widgetManager)==null||f.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((g=this.canvas.parentElement)==null||g.removeChild(this.canvas),this.canvas=null)}setProps(e){var i;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&ze.removed("onLayerHover","onHover")(),"onLayerClick"in e&&ze.removed("onLayerClick","onClick")(),e.initialViewState&&!Kt(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(i=this.animationLoop)==null||i.setProps(t),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t),this.widgetManager.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(e),s=this.layerManager.needsRedraw(e),r=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return t=t||i||s||r||o,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return this.viewManager!==null}getViews(){return An(this.viewManager),this.viewManager.views}getViewports(e){return An(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(const i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var t;(t=this.layerManager)==null||t.removeDefaultShaderModule(e)}_pick(e,t,i){An(this.deckPicker);const{stats:s}=this;s.get("Pick Count").incrementCount(),s.get(t).timeStart();const r=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return s.get(t).timeEnd(),r}_createCanvas(e){let t=e.canvas;return typeof t=="string"&&(t=document.getElementById(t),An(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){var s;if(!this.canvas)return;const{width:t,height:i}=e;if(t||t===0){const r=Number.isFinite(t)?`${t}px`:t;this.canvas.style.width=r}if(i||i===0){const r=Number.isFinite(i)?`${i}px`:i;this.canvas.style.position=((s=e.style)==null?void 0:s.position)||"absolute",this.canvas.style.height=r}}_updateCanvasSize(){var s,r;const{canvas:e}=this;if(!e)return;const t=e.clientWidth??e.width,i=e.clientHeight??e.height;(t!==this.width||i!==this.height)&&(this.width=t,this.height=i,(s=this.viewManager)==null||s.setProps({width:t,height:i}),(r=this.layerManager)==null||r.activateViewport(this.getViewports()[0]),this.props.onResize({width:t,height:i}))}_createAnimationLoop(e,t){const{gl:i,onError:s,useDevicePixels:r}=t;return new WO({device:e,useDevicePixels:r,autoResizeDrawingBuffer:!i,autoResizeViewport:!1,onInitialize:o=>this._setDevice(o.device),onRender:this._onRenderFrame.bind(this),onError:s})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new Eb({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var t,i,s;const{_pickRequest:e}=this;if(e.event){const{result:r,emptyInfo:o}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=r.length>0;let a=o,l=!1;for(const f of r)a=f,l=((t=f.layer)==null?void 0:t.onHover(f,e.event))||l;l||((s=(i=this.props).onHover)==null||s.call(i,a,e.event),this.widgetManager.onHover(a,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var s,r;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(s=this.device.canvasContext)==null?void 0:s.canvas),this.device instanceof rs&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device instanceof rs&&this.props.onWebGLInitialized(this.device.gl);const t=new db;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new vB(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(rp).map(o=>{var T;const[a,l,f,g]=rp[o],_=(T=this.props.eventRecognizerOptions)==null?void 0:T[o],v={...l,..._,event:o};return{recognizer:new a(v),recognizeWith:f,requestFailure:g}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const o in Fh)this.eventManager.on(o,this._onEvent);this.viewManager=new D4({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new O4(this.device,{deck:this,stats:this.stats,viewport:i,timeline:t}),this.effectManager=new $4({deck:this,device:this.device}),this.deckRenderer=new Y4(this.device),this.deckPicker=new tD(this.device),this.widgetManager=new sD({deck:this,parentElement:(r=this.canvas)==null?void 0:r.parentElement}),this.widgetManager.addDefault(new oD),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){var o;const{device:i,gl:s}=this.layerManager.context;this.props.onBeforeRender({device:i,gl:s});const r={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};(o=this.deckRenderer)==null||o.renderLayers(r),r.pass==="screen"&&this.widgetManager.onRedraw({viewports:r.viewports,layers:r.layers}),this.props.onAfterRender({device:i,gl:s})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),ze.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const i=_h.stats.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}ad.defaultProps=Vb;ad.VERSION=CS;function s6(n){switch(n){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return Q1(n)}}const r6=X1;function Ya(n,e){return{attribute:n,format:e.size>1?`${e.type}x${e.size}`:e.type,byteOffset:e.offset||0}}function Ds(n){return n.stride||n.size*n.bytesPerElement}function o6(n,e){return n.type===e.type&&n.size===e.size&&Ds(n)===Ds(e)&&(n.offset||0)===(e.offset||0)}function Yh(n,e){e.offset&&ze.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const t=Ds(n),i=e.vertexOffset!==void 0?e.vertexOffset:n.vertexOffset||0,s=e.elementOffset||0,r=i*t+s*n.bytesPerElement+(n.offset||0);return{...e,offset:r,stride:t}}function a6(n,e){const t=Yh(n,e);return{high:t,low:{...t,offset:t.offset+n.size*4}}}class l6{constructor(e,t,i){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const s=t.logicalType||t.type,r=s==="float64";let{defaultValue:o}=t;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let a;r?a="float32":!s&&t.isIndexed?a="uint32":a=s||"float32";let l=s6(s||a);this.doublePrecision=r,r&&t.fp64===!1&&(l=Float32Array),this.value=null,this.settings={...t,defaultType:l,defaultValue:o,logicalType:s,type:a,normalized:a.includes("norm"),size:this.size,bytesPerElement:l.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Ds(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Qr.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,t=null){const i={};if(this.state.constant){const s=this.value;if(t){const r=Yh(this.getAccessor(),t),o=r.offset/s.BYTES_PER_ELEMENT,a=r.size||this.size;i[e]=s.subarray(o,o+a)}else i[e]=s}else i[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?i[`${e}64Low`]=i[e]:i[`${e}64Low`]=new Float32Array(this.size)),i}_getBufferLayout(e=this.id,t=null){const i=this.getAccessor(),s=[],r={name:this.id,byteStride:Ds(i),attributes:s};if(this.doublePrecision){const o=a6(i,t||{});s.push(Ya(e,{...i,...o.high}),Ya(`${e}64Low`,{...i,...o.low}))}else if(t){const o=Yh(i,t);s.push(Ya(e,{...i,...o}))}else s.push(Ya(e,i));return r}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:i,size:s}=this,r=i*s;if(t&&r&&t.length>=r){const o=new Array(s).fill(1/0),a=new Array(s).fill(-1/0);for(let l=0;l<r;)for(let f=0;f<s;f++){const g=t[l++];g<o[f]&&(o[f]=g),g>a[f]&&(a[f]=g)}e=[o,a]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let i;ArrayBuffer.isView(e)?i={value:e}:e instanceof Ft?i={buffer:e}:i=e;const s={...this.settings,...i};if(ArrayBuffer.isView(i.value)){if(!i.type)if(this.doublePrecision&&i.value instanceof Float64Array)s.type="float32";else{const o=r6(i.value);s.type=s.normalized?o.replace("int","norm"):o}s.bytesPerElement=i.value.BYTES_PER_ELEMENT,s.stride=Ds(s)}if(t.bounds=null,i.constant){let r=i.value;if(r=this._normalizeValue(r,[],0),this.settings.normalized&&(r=this.normalizeConstant(r)),!(!t.constant||!this._areValuesEqual(r,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=ArrayBuffer.isView(r)?r:new Float32Array(r)}else if(i.buffer){const r=i.buffer;t.externalBuffer=r,t.constant=!1,this.value=i.value||null}else if(i.value){this._checkExternalBuffer(i);let r=i.value;t.externalBuffer=null,t.constant=!1,this.value=r;let{buffer:o}=this;const a=Ds(s),l=(s.vertexOffset||0)*a;if(this.doublePrecision&&r instanceof Float64Array&&(r=gu(r,s)),this.settings.isIndexed){const g=this.settings.defaultType;r.constructor!==g&&(r=new g(r))}const f=r.byteLength+l+a*2;(!o||o.byteLength<f)&&(o=this._createBuffer(f)),o.write(r,l)}return this.setAccessor(s),!0}updateSubBuffer(e={}){this.state.bounds=null;const t=this.value,{startOffset:i=0,endOffset:s}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?gu(t,{size:this.size,startIndex:i,endIndex:s}):t.subarray(i,s),i*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t=!1){const{state:i}=this,s=i.allocatedValue,r=Qr.allocate(s,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=r;const{byteOffset:o}=this;let{buffer:a}=this;return(!a||a.byteLength<r.byteLength+o)&&(a=this._createBuffer(r.byteLength+o),t&&s&&a.write(s instanceof Float64Array?gu(s,this):s,o)),i.allocatedValue=r,i.constant=!1,i.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error(`Attribute ${this.id} value is not TypedArray`);const i=this.settings.defaultType;let s=!1;if(this.doublePrecision&&(s=t.BYTES_PER_ELEMENT<4),s)throw new Error(`Attribute ${this.id} does not support ${t.constructor.name}`);!(t instanceof i)&&this.settings.normalized&&!("normalized"in e)&&ze.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(t=>(t+128)/255*2-1);case"snorm16":return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(t=>t/255);case"unorm16":return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,i){const{defaultValue:s,size:r}=this.settings;if(Number.isFinite(e))return t[i]=e,t;if(!e){let o=r;for(;--o>=0;)t[i+o]=s[o];return t}switch(r){case 4:t[i+3]=Number.isFinite(e[3])?e[3]:s[3];case 3:t[i+2]=Number.isFinite(e[2])?e[2]:s[2];case 2:t[i+1]=Number.isFinite(e[1])?e[1]:s[1];case 1:t[i+0]=Number.isFinite(e[0])?e[0]:s[0];break;default:let o=r;for(;--o>=0;)t[i+o]=Number.isFinite(e[o])?e[o]:s[o]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:i}=this;for(let s=0;s<i;s++)if(e[s]!==t[s])return!1;return!0}_createBuffer(e){var s;this._buffer&&this._buffer.destroy();const{isIndexed:t,type:i}=this.settings;return this._buffer=this.device.createBuffer({...(s=this._buffer)==null?void 0:s.props,id:this.id,usage:t?Ft.INDEX:Ft.VERTEX,indexType:t?i:void 0,byteLength:e}),this._buffer}}const Hp=[],Gp=[];function Ri(n,e=0,t=1/0){let i=Hp;const s={index:-1,data:n,target:[]};return n?typeof n[Symbol.iterator]=="function"?i=n:n.length>0&&(Gp.length=n.length,i=Gp):i=Hp,(e>0||Number.isFinite(t))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,t),s.index=e-1),{iterable:i,objectInfo:s}}function zb(n){return n&&n[Symbol.asyncIterator]}function Hb(n,e){const{size:t,stride:i,offset:s,startIndices:r,nested:o}=e,a=n.BYTES_PER_ELEMENT,l=i?i/a:t,f=s?s/a:0,g=Math.floor((n.length-f)/l);return(_,{index:v,target:T})=>{if(!r){const P=v*l+f;for(let F=0;F<t;F++)T[F]=n[P+F];return T}const C=r[v],S=r[v+1]||g;let R;if(o){R=new Array(S-C);for(let P=C;P<S;P++){const F=P*l+f;T=new Array(t);for(let U=0;U<t;U++)T[U]=n[F+U];R[P-C]=T}}else if(l===t)R=n.subarray(C*t+f,S*t+f);else{R=new n.constructor((S-C)*t);let P=0;for(let F=C;F<S;F++){const U=F*l+f;for(let X=0;X<t;X++)R[P++]=n[U+X]}}return R}}const c6=[],xl=[[0,1/0]];function A6(n,e){if(n===xl||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return n;const t=[],i=n.length;let s=0;for(let r=0;r<i;r++){const o=n[r];o[1]<e[0]?(t.push(o),s=r+1):o[0]>e[1]?t.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return t.splice(s,0,e),t}const u6={interpolation:{duration:0,easing:n=>n},spring:{stiffness:.05,damping:.5}};function Gb(n,e){if(!n)return null;Number.isFinite(n)&&(n={type:"interpolation",duration:n});const t=n.type||"interpolation";return{...u6[t],...e,...n,type:t}}class Wb extends l6{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:xl}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t;(t=this.state).layoutChanged||(t.layoutChanged=!o6(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,i=this.settings.transition,s=Array.isArray(t)?e[t.find(r=>e[r])]:e[t];return Gb(s,i)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:i=0,endRow:s=1/0}=t;this.state.updateRanges=A6(this.state.updateRanges,[i,s])}else this.state.updateRanges=xl}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=c6}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(e,t.updateRanges!==xl),!0):!1}updateBuffer({numInstances:e,data:t,props:i,context:s}){if(!this.needsUpdate())return!1;const{state:{updateRanges:r},settings:{update:o,noAlloc:a}}=this;let l=!0;if(o){for(const[f,g]of r)o.call(s,this,{data:t,startRow:f,endRow:g,props:i,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[f,g]of r){const _=Number.isFinite(f)?this.getVertexOffset(f):0,v=Number.isFinite(g)?this.getVertexOffset(g):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:_,endOffset:v})}this._checkAttributeArray()}else l=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),l}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:i,settings:s}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(s.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),s.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const o=e;An(ArrayBuffer.isView(o.value),`invalid ${s.accessor}`);const a=!!o.size&&o.size!==this.size;return i.binaryAccessor=Hb(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:t,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(const i in e)Object.assign(t,super.getValue(i,e[i]));return t}getBufferLayout(e){this.state.layoutChanged=!1;const t=this.settings.shaderAttributes,i=super._getBufferLayout(),{stepMode:s}=this.settings;if(s==="dynamic"?i.stepMode=e?e.isInstanced?"instance":"vertex":"instance":i.stepMode=s??"vertex",!t)return i;for(const r in t){const o=super._getBufferLayout(r,t[r]);i.attributes.push(...o.attributes)}return i}_autoUpdater(e,{data:t,startRow:i,endRow:s,props:r,numInstances:o}){if(e.constant)return;const{settings:a,state:l,value:f,size:g,startIndices:_}=e,{accessor:v,transform:T}=a,C=l.binaryAccessor||(typeof v=="function"?v:r[v]);An(typeof C=="function",`accessor "${v}" is not a function`);let S=e.getVertexOffset(i);const{iterable:R,objectInfo:P}=Ri(t,i,s);for(const F of R){P.index++;let U=C(F,P);if(T&&(U=T.call(this,U)),_){const X=(P.index<_.length-1?_[P.index+1]:o)-_[P.index];if(U&&Array.isArray(U[0])){let Z=S;for(const se of U)e._normalizeValue(se,f,Z),Z+=g}else U&&U.length>g?f.set(U,S):(e._normalizeValue(U,P.target,0),I4({target:f,source:P.target,start:S,count:X}));S+=X*g}else e._normalizeValue(U,f,S),S+=g}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let i=!0;switch(t){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function Eu(n){const{source:e,target:t,start:i=0,size:s,getData:r}=n,o=n.end||t.length,a=e.length,l=o-i;if(a>l){t.set(e.subarray(0,l),i);return}if(t.set(e,i),!r)return;let f=a;for(;f<l;){const g=r(f,e);for(let _=0;_<s;_++)t[i+f]=g[_]||0,f++}}function h6({source:n,target:e,size:t,getData:i,sourceStartIndices:s,targetStartIndices:r}){if(!s||!r)return Eu({source:n,target:e,size:t,getData:i}),e;let o=0,a=0;const l=i&&((g,_)=>i(g+a,_)),f=Math.min(s.length,r.length);for(let g=1;g<f;g++){const _=s[g]*t,v=r[g]*t;Eu({source:n.subarray(o,_),target:e,start:a,end:v,size:t,getData:l}),o=_,a=v}return a<e.length&&Eu({source:[],target:e,start:a,size:t,getData:l}),e}function f6(n){const{device:e,settings:t,value:i}=n,s=new Wb(e,t);return s.setData({value:i instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:t.normalized}),s}function jb(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${n}"`)}}function $b(n){switch(n){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function Xb(n){n.push(n.shift())}function d6(n,e){const{doublePrecision:t,settings:i,value:s,size:r}=n,o=t&&s instanceof Float64Array?2:1;let a=0;const{shaderAttributes:l}=n.settings;if(l)for(const f of Object.values(l))a=Math.max(a,f.vertexOffset??0);return(i.noAlloc?s.length:(e+a)*r)*o}function Qb({device:n,source:e,target:t}){return(!t||t.byteLength<e.byteLength)&&(t==null||t.destroy(),t=n.createBuffer({byteLength:e.byteLength,usage:e.usage})),t}function Yb({device:n,buffer:e,attribute:t,fromLength:i,toLength:s,fromStartIndices:r,getData:o=a=>a}){const a=t.doublePrecision&&t.value instanceof Float64Array?2:1,l=t.size*a,f=t.byteOffset,g=t.settings.bytesPerElement<4?f/t.settings.bytesPerElement*4:f,_=t.startIndices,v=r&&_,T=t.isConstant;if(!v&&e&&i>=s)return e;const C=t.value instanceof Float64Array?Float32Array:t.value.constructor,S=T?t.value:new C(t.getBuffer().readSyncWebGL(f,s*C.BYTES_PER_ELEMENT).buffer);if(t.settings.normalized&&!T){const U=o;o=(X,Z)=>t.normalizeConstant(U(X,Z))}const R=T?(U,X)=>o(S,X):(U,X)=>o(S.subarray(U+f,U+f+l),X),P=e?new Float32Array(e.readSyncWebGL(g,i*4).buffer):new Float32Array(0),F=new Float32Array(s);return h6({source:P,target:F,sourceStartIndices:r,targetStartIndices:_,size:l,getData:R}),(!e||e.byteLength<F.byteLength+g)&&(e==null||e.destroy(),e=n.createBuffer({byteLength:F.byteLength+g,usage:35050})),e.write(F,g),e}class Kb{constructor({device:e,attribute:t,timeline:i}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new eA(i),this.attribute=t,this.attributeInTransition=f6(t),this.currentStartIndices=t.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,i=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=d6(this.attribute,t),this.transition.start({...e,duration:i})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class g6 extends Kb{constructor({device:e,attribute:t,timeline:i}){super({device:e,attribute:t,timeline:i}),this.type="interpolation",this.transform=y6(e,t)}start(e,t){const i=this.currentLength,s=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:r,attribute:o}=this;Xb(r),r[0]=Yb({device:this.device,buffer:r[0],attribute:o,fromLength:i,toLength:this.currentLength,fromStartIndices:s,getData:e.enter}),r[1]=Qb({device:this.device,source:r[0],target:r[1]}),this.setBuffer(r[1]);const{transform:a}=this,l=a.model;let f=Math.floor(this.currentLength/o.size);qb(o)&&(f/=2),l.setVertexCount(f),o.isConstant?(l.setAttributes({aFrom:r[0]}),l.setConstantAttributes({aTo:o.value})):l.setAttributes({aFrom:r[0],aTo:o.getBuffer()}),a.transformFeedback.setBuffers({vCurrent:r[1]})}onUpdate(){const{duration:e,easing:t}=this.settings,{time:i}=this.transition;let s=i/e;t&&(s=t(s));const{model:r}=this.transform,o={time:s};r.shaderInputs.setProps({interpolation:o}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const p6=`uniform interpolationUniforms {
  float time;
} interpolation;
`,Wp={name:"interpolation",vs:p6,uniformTypes:{time:"f32"}},m6=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,_6=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function qb(n){return n.doublePrecision&&n.value instanceof Float64Array}function y6(n,e){const t=e.size,i=jb(t),s=$b(t),r=e.getBufferLayout();return qb(e)?new Yr(n,{vs:_6,bufferLayout:[{name:"aFrom",byteStride:8*t,attributes:[{attribute:"aFrom",format:s,byteOffset:0},{attribute:"aFrom64Low",format:s,byteOffset:4*t}]},{name:"aTo",byteStride:8*t,attributes:[{attribute:"aTo",format:s,byteOffset:0},{attribute:"aTo64Low",format:s,byteOffset:4*t}]}],modules:[aM,Wp],defines:{ATTRIBUTE_TYPE:i,ATTRIBUTE_SIZE:t},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new Yr(n,{vs:m6,bufferLayout:[{name:"aFrom",format:s},{name:"aTo",format:r.attributes[0].format}],modules:[Wp],defines:{ATTRIBUTE_TYPE:i},varyings:["vCurrent"],disableWarnings:!0})}class b6 extends Kb{constructor({device:e,attribute:t,timeline:i}){super({device:e,attribute:t,timeline:i}),this.type="spring",this.texture=C6(e),this.framebuffer=S6(e,this.texture),this.transform=x6(e,t)}start(e,t){const i=this.currentLength,s=this.currentStartIndices;super.start(e,t);const{buffers:r,attribute:o}=this;for(let l=0;l<2;l++)r[l]=Yb({device:this.device,buffer:r[l],attribute:o,fromLength:i,toLength:this.currentLength,fromStartIndices:s,getData:e.enter});r[2]=Qb({device:this.device,source:r[0],target:r[2]}),this.setBuffer(r[1]);const{model:a}=this.transform;a.setVertexCount(Math.floor(this.currentLength/o.size)),o.isConstant?a.setConstantAttributes({aTo:o.value}):a.setAttributes({aTo:o.getBuffer()})}onUpdate(){const{buffers:e,transform:t,framebuffer:i,transition:s}=this,r=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]});const o={stiffness:r.stiffness,damping:r.damping};t.model.shaderInputs.setProps({spring:o}),t.run({framebuffer:i,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),Xb(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(i)[0]>0||s.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const v6=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,T6={name:"spring",vs:v6,uniformTypes:{damping:"f32",stiffness:"f32"}},w6=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,E6=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function x6(n,e){const t=jb(e.size),i=$b(e.size);return new Yr(n,{vs:w6,fs:E6,bufferLayout:[{name:"aPrev",format:i},{name:"aCur",format:i},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[T6],defines:{ATTRIBUTE_TYPE:t},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function C6(n){return n.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function S6(n,e){return n.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const I6={interpolation:g6,spring:b6};class R6{constructor(e,{id:t,timeline:i}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=t,this.device=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:i}){this.numInstances=i||1;for(const s in e){const r=e[s],o=r.getTransitionSetting(t);o&&this._updateAttribute(s,r,o)}for(const s in this.transitions){const r=e[s];(!r||!r.getTransitionSetting(t))&&this._removeTransition(s)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const i=this.transitions[t];i.inProgress&&(e[t]=i.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,i){const s=this.transitions[e];let r=!s||s.type!==i.type;if(r){s&&this._removeTransition(e);const o=I6[i.type];o?this.transitions[e]=new o({attribute:t,timeline:this.timeline,device:this.device}):(ze.error(`unsupported transition type '${i.type}'`)(),r=!1)}(r||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}const jp="attributeManager.invalidate",P6="attributeManager.updateStart",M6="attributeManager.updateEnd",B6="attribute.updateStart",O6="attribute.allocate",D6="attribute.updateEnd";class tA{constructor(e,{id:t="attribute-manager",stats:i,timeline:s}={}){this.mergeBoundsMemoized=ua(CO),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new R6(e,{id:`${t}-transitions`,timeline:s}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const t of e)this.attributes[t]!==void 0&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const i=this._invalidateTrigger(e,t);yn(jp,this,e,i)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);yn(jp,this,"all")}update({data:e,numInstances:t,startIndices:i=null,transitions:s,props:r={},buffers:o={},context:a={}}){let l=!1;yn(P6,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const f in this.attributes){const g=this.attributes[f],_=g.settings.accessor;g.startIndices=i,g.numInstances=t,r[f]&&ze.removed(`props.${f}`,`data.attributes.${f}`)(),g.setExternalBuffer(o[f])||g.setBinaryValue(typeof _=="string"?o[_]:void 0,e.startIndices)||typeof _=="string"&&!o[_]&&g.setConstantValue(r[_])||g.needsUpdate()&&(l=!0,this._updateAttribute({attribute:g,numInstances:t,data:e,props:r,context:a})),this.needsRedraw=this.needsRedraw||g.needsRedraw()}l&&yn(M6,this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:s})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const t=e.map(i=>{var s;return(s=this.attributes[i])==null?void 0:s.getBounds()});return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:i}=this,s={...i.getAttributes()};for(const r in t){const o=t[r];o.needsRedraw(e)&&!i.hasAttribute(r)&&(s[r]=o)}return s}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(const i in e){const s=e[i],r={...s,id:i,size:s.isIndexed&&1||s.size||1,...t};this.attributes[i]=new Wb(this.device,r)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(s=>{e[s]||(e[s]=[]),e[s].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:i,updateTriggers:s}=this,r=s[e];return r&&r.forEach(o=>{const a=i[o];a&&a.setNeedsUpdate(a.id,t)}),r}_updateAttribute(e){const{attribute:t,numInstances:i}=e;if(yn(B6,t),t.constant){t.setConstantValue(t.value);return}t.allocate(i)&&yn(O6,t,i),t.updateBuffer(e)&&(this.needsRedraw=!0,yn(D6,t,i))}}class N6 extends eA{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:i,duration:s,easing:r}}=this,o=r(e/s);this._value=Qn(t,i,o)}}const $p=1e-5;function Xp(n,e,t,i,s){const r=e-n,a=(t-e)*s,l=-r*i;return a+l+r+e}function F6(n,e,t,i,s){if(Array.isArray(t)){const r=[];for(let o=0;o<t.length;o++)r[o]=Xp(n[o],e[o],t[o],i,s);return r}return Xp(n,e,t,i,s)}function Qp(n,e){if(Array.isArray(n)){let t=0;for(let i=0;i<n.length;i++){const s=n[i]-e[i];t+=s*s}return Math.sqrt(t)}return Math.abs(n-e)}class L6 extends eA{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:i,stiffness:s}=this.settings,{_prevValue:r=e,_currValue:o=e}=this;let a=F6(r,o,t,i,s);const l=Qp(a,t),f=Qp(a,o);l<$p&&f<$p&&(a=t,this.end()),this._prevValue=o,this._currValue=a}}const k6={interpolation:N6,spring:L6};class U6{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,i,s){const{transitions:r}=this;if(r.has(e)){const l=r.get(e),{value:f=l.settings.fromValue}=l;t=f,this.remove(e)}if(s=Gb(s),!s)return;const o=k6[s.type];if(!o){ze.error(`unsupported transition type '${s.type}'`)();return}const a=new o(this.timeline);a.start({...s,fromValue:t,toValue:i}),r.set(e,a)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,i]of this.transitions)i.update(),e[t]=i.value,i.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function V6(n){const e=n[As];for(const t in e){const i=e[t],{validate:s}=i;if(s&&!s(n[t],i))throw new Error(`Invalid prop ${t}: ${n[t]}`)}}function z6(n,e){const t=ld({newProps:n,oldProps:e,propTypes:n[As],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=G6(n,e);let s=!1;return i||(s=W6(n,e)),{dataChanged:i,propsChanged:t,updateTriggersChanged:s,extensionsChanged:j6(n,e),transitionsChanged:H6(n,e)}}function H6(n,e){if(!n.transitions)return!1;const t={},i=n[As];let s=!1;for(const r in n.transitions){const o=i[r],a=o&&o.type;(a==="number"||a==="color"||a==="array")&&Kh(n[r],e[r],o)&&(t[r]=!0,s=!0)}return s?t:!1}function ld({newProps:n,oldProps:e,ignoreProps:t={},propTypes:i={},triggerName:s="props"}){if(e===n)return!1;if(typeof n!="object"||n===null)return`${s} changed shallowly`;if(typeof e!="object"||e===null)return`${s} changed shallowly`;for(const r of Object.keys(n))if(!(r in t)){if(!(r in e))return`${s}.${r} added`;const o=Kh(n[r],e[r],i[r]);if(o)return`${s}.${r} ${o}`}for(const r of Object.keys(e))if(!(r in t)){if(!(r in n))return`${s}.${r} dropped`;if(!Object.hasOwnProperty.call(n,r)){const o=Kh(n[r],e[r],i[r]);if(o)return`${s}.${r} ${o}`}}return!1}function Kh(n,e,t){let i=t&&t.equal;return i&&!i(n,e,t)||!i&&(i=n&&e&&n.equals,i&&!i.call(n,e))?"changed deeply":!i&&e!==n?"changed shallowly":null}function G6(n,e){if(e===null)return"oldProps is null, initial diff";let t=!1;const{dataComparator:i,_dataDiff:s}=n;return i?i(n.data,e.data)||(t="Data comparator detected a change"):n.data!==e.data&&(t="A new data container was supplied"),t&&s&&(t=s(n.data,e.data)||t),t}function W6(n,e){if(e===null)return{all:!0};if("all"in n.updateTriggers&&Yp(n,e,"all"))return{all:!0};const t={};let i=!1;for(const s in n.updateTriggers)s!=="all"&&Yp(n,e,s)&&(t[s]=!0,i=!0);return i?t:!1}function j6(n,e){if(e===null)return!0;const t=e.extensions,{extensions:i}=n;if(i===t)return!1;if(!t||!i||i.length!==t.length)return!0;for(let s=0;s<i.length;s++)if(!i[s].equals(t[s]))return!0;return!1}function Yp(n,e,t){let i=n.updateTriggers[t];i=i??{};let s=e.updateTriggers[t];return s=s??{},ld({oldProps:s,newProps:i,triggerName:t})}const $6="count(): argument not an object",X6="count(): argument not a container";function Q6(n){if(!K6(n))throw new Error($6);if(typeof n.count=="function")return n.count();if(Number.isFinite(n.size))return n.size;if(Number.isFinite(n.length))return n.length;if(Y6(n))return Object.keys(n).length;throw new Error(X6)}function Y6(n){return n!==null&&typeof n=="object"&&n.constructor===Object}function K6(n){return n!==null&&typeof n=="object"}function Kp(n,e){if(!e)return n;const t={...n,...e};if("defines"in e&&(t.defines={...n.defines,...e.defines}),"modules"in e&&(t.modules=(n.modules||[]).concat(e.modules),e.modules.some(i=>i.name==="project64"))){const i=t.modules.findIndex(s=>s.name==="project32");i>=0&&t.modules.splice(i,1)}if("inject"in e)if(!n.inject)t.inject=e.inject;else{const i={...n.inject};for(const s in e.inject)i[s]=(i[s]||"")+e.inject[s];t.inject=i}return t}const q6={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},qh={};function J6(n,e,t,i){if(t instanceof kt)return t;t.constructor&&t.constructor.name!=="Object"&&(t={data:t});let s=null;t.compressed&&(s={minFilter:"linear",mipmapFilter:t.data.length>1?"nearest":"linear"});const r=e.createTexture({...t,sampler:{...q6,...s,...i},mipmaps:!0});return qh[r.id]=n,r}function Z6(n,e){!e||!(e instanceof kt)||qh[e.id]===n&&(e.delete(),delete qh[e.id])}const eF={boolean:{validate(n,e){return!0},equal(n,e,t){return!!n==!!e}},number:{validate(n,e){return Number.isFinite(n)&&(!("max"in e)||n<=e.max)&&(!("min"in e)||n>=e.min)}},color:{validate(n,e){return e.optional&&!n||Jh(n)&&(n.length===3||n.length===4)},equal(n,e,t){return Kt(n,e,1)}},accessor:{validate(n,e){const t=hc(n);return t==="function"||t===hc(e.value)},equal(n,e,t){return typeof e=="function"?!0:Kt(n,e,1)}},array:{validate(n,e){return e.optional&&!n||Jh(n)},equal(n,e,t){const{compare:i}=t,s=Number.isInteger(i)?i:i?1:0;return i?Kt(n,e,s):n===e}},object:{equal(n,e,t){if(t.ignore)return!0;const{compare:i}=t,s=Number.isInteger(i)?i:i?1:0;return i?Kt(n,e,s):n===e}},function:{validate(n,e){return e.optional&&!n||typeof n=="function"},equal(n,e,t){return!t.compare&&t.ignore!==!1||n===e}},data:{transform:(n,e,t)=>{if(!n)return n;const{dataTransform:i}=t.props;return i?i(n):typeof n.shape=="string"&&n.shape.endsWith("-table")&&Array.isArray(n.data)?n.data:n}},image:{transform:(n,e,t)=>{const i=t.context;return!i||!i.device?null:J6(t.id,i.device,n,{...e.parameters,...t.props.textureParameters})},release:(n,e,t)=>{Z6(t.id,n)}}};function tF(n){const e={},t={},i={};for(const[s,r]of Object.entries(n)){const o=r==null?void 0:r.deprecatedFor;if(o)i[s]=Array.isArray(o)?o:[o];else{const a=nF(s,r);e[s]=a,t[s]=a.value}}return{propTypes:e,defaultProps:t,deprecatedProps:i}}function nF(n,e){switch(hc(e)){case"object":return Eo(n,e);case"array":return Eo(n,{type:"array",value:e,compare:!1});case"boolean":return Eo(n,{type:"boolean",value:e});case"number":return Eo(n,{type:"number",value:e});case"function":return Eo(n,{type:"function",value:e,compare:!0});default:return{name:n,type:"unknown",value:e}}}function Eo(n,e){return"type"in e?{name:n,...eF[e.type],...e}:"value"in e?{name:n,type:hc(e.value),...e}:{name:n,type:"object",value:e}}function Jh(n){return Array.isArray(n)||ArrayBuffer.isView(n)}function hc(n){return Jh(n)?"array":n===null?"null":typeof n}function iF(n,e){let t;for(let r=e.length-1;r>=0;r--){const o=e[r];"extensions"in o&&(t=o.extensions)}const i=Zh(n.constructor,t),s=Object.create(i);s[Ac]=n,s[Ws]={},s[ss]={};for(let r=0;r<e.length;++r){const o=e[r];for(const a in o)s[a]=o[a]}return Object.freeze(s),s}const sF="_mergedDefaultProps";function Zh(n,e){if(!(n instanceof nA.constructor))return{};let t=sF;if(e)for(const s of e){const r=s.constructor;r&&(t+=`:${r.extensionName||r.name}`)}const i=Jb(n,t);return i||(n[t]=rF(n,e||[]))}function rF(n,e){if(!n.prototype)return null;const i=Object.getPrototypeOf(n),s=Zh(i),r=Jb(n,"defaultProps")||{},o=tF(r),a=Object.assign(Object.create(null),s,o.defaultProps),l=Object.assign(Object.create(null),s==null?void 0:s[As],o.propTypes),f=Object.assign(Object.create(null),s==null?void 0:s[yu],o.deprecatedProps);for(const g of e){const _=Zh(g.constructor);_&&(Object.assign(a,_),Object.assign(l,_[As]),Object.assign(f,_[yu]))}return oF(a,n),lF(a,l),aF(a,f),a[As]=l,a[yu]=f,e.length===0&&!cd(n,"_propTypes")&&(n._propTypes=l),a}function oF(n,e){const t=AF(e);Object.defineProperties(n,{id:{writable:!0,value:t}})}function aF(n,e){for(const t in e)Object.defineProperty(n,t,{enumerable:!1,set(i){const s=`${this.id}: ${t}`;for(const r of e[t])cd(this,r)||(this[r]=i);ze.deprecated(s,e[t].join("/"))()}})}function lF(n,e){const t={},i={};for(const s in e){const r=e[s],{name:o,value:a}=r;r.async&&(t[o]=a,i[o]=cF(o))}n[Hr]=t,n[Ws]={},Object.defineProperties(n,i)}function cF(n){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||zb(e)?this[Ws][n]=e:this[ss][n]=e},get(){if(this[ss]){if(n in this[ss])return this[ss][n]||this[Hr][n];if(n in this[Ws]){const e=this[Ac]&&this[Ac].internalState;if(e&&e.hasAsyncProp(n))return e.getAsyncProp(n)||this[Hr][n]}}return this[Hr][n]}}}function cd(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Jb(n,e){return cd(n,e)&&n[e]}function AF(n){const e=n.componentName;return e||ze.warn(`${n.name}.componentName not specified`)(),e||n.name}let uF=0;class nA{constructor(...e){this.props=iF(this,e),this.id=this.props.id,this.count=uF++}clone(e){const{props:t}=this,i={};for(const s in t[Hr])s in t[ss]?i[s]=t[ss][s]:s in t[Ws]&&(i[s]=t[Ws][s]);return new this.constructor({...t,...i,...e})}}nA.componentName="Component";nA.defaultProps={};const hF=Object.freeze({});class fF{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||hF}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[Ac]||this.component;const t=e[ss]||{},i=e[Ws]||e,s=e[Hr]||{};for(const r in t){const o=t[r];this._createAsyncPropData(r,s[r]),this._updateAsyncProp(r,o),t[r]=this.getAsyncProp(r)}for(const r in i){const o=i[r];this._createAsyncPropData(r,s[r]),this._updateAsyncProp(r,o)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if(typeof t=="string"&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if(zb(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const i=this.asyncProps[e];return t===i.resolvedValue||t===i.lastValue?!1:(i.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const i=this.asyncProps[e];i&&(t=this._postProcessValue(i,t),i.resolvedValue=t,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,t,i){const s=this.asyncProps[e];s&&i>=s.resolvedLoadCount&&t!==void 0&&(this._freezeAsyncOldProps(),s.resolvedValue=t,s.resolvedLoadCount=i,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const i=this.asyncProps[e];if(i){i.pendingLoadCount++;const s=i.pendingLoadCount;t.then(r=>{this.component&&(r=this._postProcessValue(i,r),this._setAsyncPropValue(e,r,s),this._onResolve(e,r))}).catch(r=>{this._onError(e,r)})}}async _resolveAsyncIterable(e,t){if(e!=="data"){this._setPropValue(e,t);return}const i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;const s=i.pendingLoadCount;let r=[],o=0;for await(const a of t){if(!this.component)return;const{dataTransform:l}=this.component.props;l?r=l(a,r):r=r.concat(a),Object.defineProperty(r,"__diff",{enumerable:!1,value:[{startRow:o,endRow:r.length}]}),o=r.length,this._setAsyncPropValue(e,r,s)}this._onResolve(e,r)}_postProcessValue(e,t){const i=e.type;return i&&this.component&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(t,i,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const s=this.component&&this.component.props[As];this.asyncProps[e]={type:s&&s[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class dF extends fF{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const i=this.layer,s=i==null?void 0:i.props.fetch;return s?s(t,{propName:e,layer:i}):super._fetch(e,t)}_onResolve(e,t){const i=this.layer;if(i){const s=i.props.onDataLoad;e==="data"&&s&&s(t,{propName:e,layer:i})}}_onError(e,t){const i=this.layer;i&&i.raiseError(t,`loading ${e} of ${this.layer}`)}}const gF="layer.changeFlag",pF="layer.initialize",mF="layer.update",_F="layer.finalize",yF="layer.matched",qp=2**24-1,bF=Object.freeze([]),vF=ua(({oldViewport:n,viewport:e})=>n.equals(e));let Jn=new Uint8ClampedArray(0);const TF={data:{type:"data",value:bF,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:n=>n&&n.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(n,{propName:e,layer:t,loaders:i,loadOptions:s,signal:r})=>{const{resourceManager:o}=t.context;s=s||t.getLoadOptions(),i=i||t.props.loaders,r&&(s={...s,fetch:{...s==null?void 0:s.fetch,signal:r}});let a=o.contains(n);return!a&&!s&&(o.add({resourceId:n,data:Li(n,i),persistent:!1}),a=!0),a?o.subscribe({resourceId:n,onChange:l=>{var f;return(f=t.internalState)==null?void 0:f.reloadAsyncProp(e,l)},consumerId:t.id,requestId:e}):Li(n,i,s)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Ue.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:n})=>[0,-n*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class rn extends nA{constructor(){super(...arguments),this.internalState=null,this.lifecycle=xr.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){An(this.internalState);const t=this.internalState.viewport||this.context.viewport,i=hb(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[s,r,o]=sb(i,t.pixelProjectionMatrix);return e.length===2?[s,r]:[s,r,o]}unproject(e){return An(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){An(this.internalState);const i=this.internalState.viewport||this.context.viewport;return fb(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const t of this.getModels())t.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Ue.DEFAULT||e===Ue.LNGLAT||e===Ue.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){An(e instanceof Uint8Array);const[t,i,s]=e;return t+i*256+s*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:Q6(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=Kp(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const t of this.props.extensions)e=Kp(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&t)if(Array.isArray(i))for(const s of i)t.invalidateAll(s);else t.invalidateAll();if(t){const{props:s}=e,r=this.internalState.hasPickingBuffer,o=Number.isInteger(s.highlightedObjectIndex)||s.pickable||s.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(r!==o){this.internalState.hasPickingBuffer=o;const{pickingColors:a,instancePickingColors:l}=t.attributes,f=a||l;f&&(o&&f.constant&&(f.constant=!1,t.invalidate(f.id)),!f.value&&!o&&(f.constant=!0,f.value=[0,0,0]))}}}finalizeState(e){for(const i of this.getModels())i.destroy();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e.renderPass)}getPickingInfo({info:e,mode:t,sourceLayer:i}){const{index:s}=e;return s>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[s]),e}raiseError(e,t){var i,s,r,o;t&&(e=new Error(`${t}: ${e.message}`,{cause:e})),(s=(i=this.props).onError)!=null&&s.call(i,e)||(o=(r=this.context)==null?void 0:r.onError)==null||o.call(r,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,(!t||!vF({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const t=this.getAttributeManager();t&&(e==="all"?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(const i in e)e[i].layoutChanged()&&(t=!0);for(const i of this.getModels())this._setModelAttributes(i,e,t)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,i=this.getNumInstances(),s=this.getStartIndices();e.update({data:t.data,numInstances:i,startIndices:s,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const r=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(r)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),i=Object.create(this.props);for(const s in t)Object.defineProperty(i,s,{value:t[s]});return i}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;const i=Math.floor(Jn.length/4);if(this.internalState.usesPickingColorCache=!0,i<t){t>qp&&ze.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Jn=Qr.allocate(Jn,t,{size:4,copy:!0,maxCount:Math.max(t,qp)});const s=Math.floor(Jn.length/4),r=[0,0,0];for(let o=i;o<s;o++)this.encodePickingColor(o,r),Jn[o*4+0]=r[0],Jn[o*4+1]=r[1],Jn[o*4+2]=r[2],Jn[o*4+3]=0}e.value=Jn.subarray(0,t*4)}_setModelAttributes(e,t,i=!1){var a;if(!Object.keys(t).length)return;if(i){const l=this.getAttributeManager();e.setBufferLayout(l.getBufferLayouts(e)),t=l.getAttributes()}const s=((a=e.userData)==null?void 0:a.excludeAttributes)||{},r={},o={};for(const l in t){if(s[l])continue;const f=t[l].getValue();for(const g in f){const _=f[g];_ instanceof Ft?t[l].settings.isIndexed?e.setIndexBuffer(_):r[g]=_:_&&(o[g]=_)}}e.setAttributes(r),e.setConstantAttributes(o)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t)){this._disablePickingIndex(e);return}const{pickingColors:i,instancePickingColors:s}=this.getAttributeManager().attributes,r=i||s,o=r&&t.attributes&&t.attributes[r.id];if(o&&o.value){const a=o.value,l=this.encodePickingColor(e);for(let f=0;f<t.length;f++){const g=r.getVertexOffset(f);a[g]===l[0]&&a[g+1]===l[1]&&a[g+2]===l[2]&&this._disablePickingIndex(f)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:i}=this.getAttributeManager().attributes,s=t||i;if(!s)return;const r=s.getVertexOffset(e),o=s.getVertexOffset(e+1);s.buffer.write(new Uint8Array(o-r),r)}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,i=e||t;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==Jn.buffer&&(i.value=Jn.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){An(!this.internalState),An(Number.isFinite(this.props.coordinateSystem)),yn(pF,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new dF({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(ze.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new U6(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){yn(yF,this,this===e);const{state:t,internalState:i}=e;this!==e&&(this.internalState=i,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(yn(mF,this,e),!e)return;const t=this.props,i=this.context,s=this.internalState,r=i.viewport,o=this._updateUniformTransition();s.propsInTransition=o,i.viewport=s.viewport||r,this.props=o;try{const a=this._getUpdateParams(),l=this.getModels();if(i.device)this.updateState(a);else try{this.updateState(a)}catch{}for(const g of this.props.extensions)g.updateState.call(this,a,g);this.setNeedsRedraw(),this._updateAttributes();const f=this.getModels()[0]!==l[0];this._postUpdate(a,f)}finally{i.viewport=r,this.props=t,this._clearChangeFlags(),s.needsUpdate=!1,s.resetOldProps()}}_finalize(){yn(_F,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:t=null,uniforms:i={},parameters:s={}}){this._updateAttributeTransition();const r=this.props,o=this.context;this.props=this.internalState.propsInTransition||r;try{t&&this.setShaderModuleProps(t);const{getPolygonOffset:a}=this.props,l=a&&a(i)||[0,0];o.device instanceof rs&&o.device.setParametersWebGL({polygonOffset:l});for(const f of this.getModels())f.setParameters(s);if(o.device instanceof rs)o.device.withParametersWebGL(s,()=>{const f={renderPass:e,shaderModuleProps:t,uniforms:i,parameters:s,context:o};for(const g of this.props.extensions)g.draw.call(this,f,g);this.draw(f)});else{const f={renderPass:e,shaderModuleProps:t,uniforms:i,parameters:s,context:o};for(const g of this.props.extensions)g.draw.call(this,f,g);this.draw(f)}}finally{this.props=r}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const s in e)if(e[s]){let r=!1;switch(s){case"dataChanged":const o=e[s],a=t[s];o&&Array.isArray(a)&&(t.dataChanged=Array.isArray(o)?a.concat(o):o,r=!0);default:t[s]||(t[s]=e[s],r=!0)}r&&yn(gF,this,s,e)}const i=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=i,t.somethingChanged=i||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){var s;const i=z6(e,t);if(i.updateTriggersChanged)for(const r in i.updateTriggersChanged)i.updateTriggersChanged[r]&&this.invalidateAttribute(r);if(i.transitionsChanged)for(const r in i.transitionsChanged)this.internalState.uniformTransitions.add(r,t[r],e[r],(s=e.transitions)==null?void 0:s[r]);return this.setChangeFlags(i)}validateProps(){V6(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&typeof i=="function"&&(t.highlightColor=i(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new tA(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:i,oldProps:s}=e,r=this.state.model;r!=null&&r.isInstanced&&r.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:a,highlightColor:l}=i;if(t||s.autoHighlight!==o||s.highlightedObjectIndex!==a||s.highlightColor!==l){const f={};Array.isArray(l)&&(f.highlightColor=l),(t||s.autoHighlight!==o||a!==s.highlightedObjectIndex)&&(f.highlightedObjectColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setShaderModuleProps({picking:f})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const i=this.getAttributeManager(),s=i?i.getNeedsRedraw(e):!1;if(t=t||s,t)for(const r of this.props.extensions)r.onNeedsRedraw.call(this,r);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}rn.defaultProps=TF;rn.layerName="Layer";const wF="compositeLayer.renderLayers";class gi extends rn{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id&&(e.object=t.__source.object,e.index=t.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||t}getSubLayerRow(e,t,i){return e.__source={parent:this,object:t,index:i},e}getSubLayerAccessor(e){if(typeof e=="function"){const t={index:-1,data:this.props.data,target:[]};return(i,s)=>i&&i.__source?(t.index=i.__source.index,e(i.__source.object,t)):e(i,s)}return e}getSubLayerProps(e={}){var Se;const{opacity:t,pickable:i,visible:s,parameters:r,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:l,highlightColor:f,coordinateSystem:g,coordinateOrigin:_,wrapLongitude:v,positionFormat:T,modelMatrix:C,extensions:S,fetch:R,operation:P,_subLayerProps:F}=this.props,U={id:"",updateTriggers:{},opacity:t,pickable:i,visible:s,parameters:r,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:l,highlightColor:f,coordinateSystem:g,coordinateOrigin:_,wrapLongitude:v,positionFormat:T,modelMatrix:C,extensions:S,fetch:R,operation:P},X=F&&e.id&&F[e.id],Z=X&&X.updateTriggers,se=e.id||"sublayer";if(X){const me=this.props[As],J=e.type?e.type._propTypes:{};for(const q in X){const L=J[q]||me[q];L&&L.type==="accessor"&&(X[q]=this.getSubLayerAccessor(X[q]))}}Object.assign(U,e,X),U.id=`${this.props.id}-${se}`,U.updateTriggers={all:(Se=this.props.updateTriggers)==null?void 0:Se.all,...e.updateTriggers,...Z};for(const me of S){const J=me.getSubLayerProps.call(this,me);J&&Object.assign(U,J,{updateTriggers:Object.assign(U.updateTriggers,J.updateTriggers)})}return U}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let i=this.internalState.subLayers;const s=!i||this.needsUpdate();if(s){const r=this.renderLayers();i=Zc(r,Boolean),this.internalState.subLayers=i}yn(wF,this,s,i);for(const r of i)r.parent=this}}gi.layerName="CompositeLayer";const Ka=Math.PI/180,Jp=180/Math.PI,Cl=6370972,Br=256;function EF(){const n=Br/Cl,e=Math.PI/180*Br;return{unitsPerMeter:[n,n,n],unitsPerMeter2:[0,0,0],metersPerUnit:[1/n,1/n,1/n],unitsPerDegree:[e,e,n],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/n]}}class Ad extends Kn{constructor(e={}){const{longitude:t=0,zoom:i=0,nearZMultiplier:s=.5,farZMultiplier:r=1,resolution:o=10}=e;let{latitude:a=0,height:l,altitude:f=1.5,fovy:g}=e;a=Math.max(Math.min(a,ac),-85.051129),l=l||1,g?f=Jc(g):g=ea(f);const _=1/Math.PI/Math.cos(a*Math.PI/180),v=Math.pow(2,i)*_,T=e.nearZ??s,C=e.farZ??(f+Br*2*v/l)*r,S=new Ge().lookAt({eye:[0,-f,0],up:[0,0,1]});S.rotateX(a*Ka),S.rotateZ(-t*Ka),S.scale(v/l),super({...e,height:l,viewMatrix:S,longitude:t,latitude:a,zoom:i,distanceScales:EF(),fovy:g,focalDistance:f,near:T,far:C}),this.scale=v,this.latitude=a,this.longitude=t,this.resolution=o}get projectionMode(){return ri.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const t={targetZ:e.z||0},i=this.unproject([0,this.height/2],t),s=this.unproject([this.width/2,0],t),r=this.unproject([this.width,this.height/2],t),o=this.unproject([this.width/2,this.height],t);return r[0]<this.longitude&&(r[0]+=360),i[0]>this.longitude&&(i[0]-=360),[Math.min(i[0],r[0],s[0],o[0]),Math.min(i[1],r[1],s[1],o[1]),Math.max(i[0],r[0],s[0],o[0]),Math.max(i[1],r[1],s[1],o[1])]}unproject(e,{topLeft:t=!0,targetZ:i}={}){const[s,r,o]=e,a=t?r:this.height-r,{pixelUnprojectionMatrix:l}=this;let f;if(Number.isFinite(o))f=xu(l,[s,a,o,1]);else{const T=xu(l,[s,a,-1,1]),C=xu(l,[s,a,1,1]),S=((i||0)/Cl+1)*Br,R=ou(Cy([],T,C)),P=ou(T),F=ou(C),X=4*((4*P*F-(R-P-F)**2)/16)/R,Z=Math.sqrt(P-X),se=Math.sqrt(Math.max(0,S*S-X)),Se=(Z-se)/Math.sqrt(R);f=QR([],T,C,Se)}const[g,_,v]=this.unprojectPosition(f);return Number.isFinite(o)?[g,_,v]:Number.isFinite(i)?[g,_,i]:[g,_]}projectPosition(e){const[t,i,s=0]=e,r=t*Ka,o=i*Ka,a=Math.cos(o),l=(s/Cl+1)*Br;return[Math.sin(r)*a*l,-Math.cos(r)*a*l,Math.sin(o)*l]}unprojectPosition(e){const[t,i,s]=e,r=Sy(e),o=Math.asin(s/r),l=Math.atan2(t,-i)*Jp,f=o*Jp,g=(r/Br-1)*Cl;return[l,f,g]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,t){const i=this.unproject(t);return{longitude:e[0]-i[0]+this.longitude,latitude:e[1]-i[1]+this.latitude}}}function xu(n,e){const t=oo([],e,n);return Yf(t,t,1/t[3]),t}const Cu=Math.PI/180;function xF({height:n,focalDistance:e,orbitAxis:t,rotationX:i,rotationOrbit:s,zoom:r}){const o=t==="Z"?[0,0,1]:[0,1,0],a=t==="Z"?[0,-e,0]:[0,0,e],l=new Ge().lookAt({eye:a,up:o});l.rotateX(i*Cu),t==="Z"?l.rotateZ(s*Cu):l.rotateY(s*Cu);const f=Math.pow(2,r)/n;return l.scale(f),l}class CF extends Kn{constructor(e){const{height:t,projectionMatrix:i,fovy:s=50,orbitAxis:r="Z",target:o=[0,0,0],rotationX:a=0,rotationOrbit:l=0,zoom:f=0}=e,g=i?i[5]/2:Jc(s);super({...e,longitude:void 0,viewMatrix:xF({height:t||1,focalDistance:g,orbitAxis:r,rotationX:a,rotationOrbit:l,zoom:f}),fovy:s,focalDistance:g,position:o,zoom:f}),this.projectedCenter=this.project(this.center)}unproject(e,{topLeft:t=!0}={}){const[i,s,r=this.projectedCenter[2]]=e,o=t?s:this.height-s,[a,l,f]=ha([i,o,r],this.pixelUnprojectionMatrix);return[a,l,f]}panByPosition(e,t){const i=this.project(e),s=[this.width/2+i[0]-t[0],this.height/2+i[1]-t[1],this.projectedCenter[2]];return{target:this.unproject(s)}}}const SF=new Ge().lookAt({eye:[0,0,1]});function IF({width:n,height:e,near:t,far:i,padding:s}){let r=-n/2,o=n/2,a=-e/2,l=e/2;if(s){const{left:f=0,right:g=0,top:_=0,bottom:v=0}=s,T=Ut((f+n-g)/2,0,n)-n/2,C=Ut((_+e-v)/2,0,e)-e/2;r-=T,o-=T,a+=C,l+=C}return new Ge().ortho({left:r,right:o,bottom:a,top:l,near:t,far:i})}class RF extends Kn{constructor(e){const{width:t,height:i,near:s=.1,far:r=1e3,zoom:o=0,target:a=[0,0,0],padding:l=null,flipY:f=!0}=e,g=Array.isArray(o)?o[0]:o,_=Array.isArray(o)?o[1]:o,v=Math.min(g,_),T=Math.pow(2,v);let C;if(g!==_){const S=Math.pow(2,g),R=Math.pow(2,_);C={unitsPerMeter:[S/T,R/T,1],metersPerUnit:[T/S,T/R,1]}}super({...e,longitude:void 0,position:a,viewMatrix:SF.clone().scale([T,T*(f?-1:1),T]),projectionMatrix:IF({width:t||1,height:i||1,padding:l,near:s,far:r}),zoom:v,distanceScales:C})}projectFlat([e,t]){const{unitsPerMeter:i}=this.distanceScales;return[e*i[0],t*i[1]]}unprojectFlat([e,t]){const{metersPerUnit:i}=this.distanceScales;return[e*i[0],t*i[1]]}panByPosition(e,t){const i=ha(t,this.pixelUnprojectionMatrix),s=this.projectFlat(e),r=qo([],s,py([],i)),o=qo([],this.center,r);return{target:this.unprojectFlat(o)}}}class PF extends Kn{constructor(e){const{longitude:t,latitude:i,modelMatrix:s,bearing:r=0,pitch:o=0,up:a=[0,0,1]}=e,f=new kr({bearing:r,pitch:o===-90?1e-4:90+o}).toVector3().normalize(),g=s?new Ge(s).transformAsVector(f):f,_=Number.isFinite(i)?nb({latitude:i}):0,v=Math.pow(2,_),T=new Ge().lookAt({eye:[0,0,0],center:g,up:a}).scale(v);super({...e,zoom:_,viewMatrix:T}),this.latitude=i,this.longitude=t}}const Is=20,Zp=500;class ud extends td{constructor(e){const{width:t,height:i,position:s=[0,0,0],bearing:r=0,pitch:o=0,longitude:a=null,latitude:l=null,maxPitch:f=90,minPitch:g=-90,startRotatePos:_,startBearing:v,startPitch:T,startZoomPosition:C,startPanPos:S,startPanPosition:R}=e;super({width:t,height:i,position:s,bearing:r,pitch:o,longitude:a,latitude:l,maxPitch:f,minPitch:g},{startRotatePos:_,startBearing:v,startPitch:T,startZoomPosition:C,startPanPos:S,startPanPosition:R}),this.makeViewport=e.makeViewport}panStart({pos:e}){const{position:t}=this.getViewportProps();return this._getUpdatedState({startPanPos:e,startPanPosition:t})}pan({pos:e}){if(!e)return this;const{startPanPos:t=[0,0],startPanPosition:i=[0,0]}=this.getState(),{width:s,height:r,bearing:o,pitch:a}=this.getViewportProps(),l=Zp*(e[0]-t[0])/s,f=Zp*(e[1]-t[1])/r,g=new kr({bearing:o,pitch:a}),_=new kr({bearing:o,pitch:-90}),v=g.toVector3().normalize(),T=_.toVector3().cross(v).normalize();return this._getUpdatedState({position:new ee(i).add(T.scale(l)).add(v.scale(f))})}panEnd(){return this._getUpdatedState({startPanPos:null,startPanPosition:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:i=0}){const{startRotatePos:s,startBearing:r,startPitch:o}=this.getState(),{width:a,height:l}=this.getViewportProps();if(!s||r===void 0||o===void 0)return this;let f;if(e){const g=(e[0]-s[0])/a,_=(e[1]-s[1])/l;f={bearing:r-g*180,pitch:o-_*90}}else f={bearing:r-t,pitch:o-i};return this._getUpdatedState(f)}rotateEnd(){return this._getUpdatedState({startRotatePos:null,startBearing:null,startPitch:null})}zoomStart(){return this._getUpdatedState({startZoomPosition:this.getViewportProps().position})}zoom({pos:e,scale:t}){const i=this.getViewportProps(),s=this.getState().startZoomPosition||i.position,r=this.makeViewport(i),{projectionMatrix:o,width:a}=r,f=2*Math.atan(1/o[0])*(e[0]/a-.5),g=this.getDirection(!0);return this._move(g.rotateZ({radians:-f}),Math.log2(t)*Is,s)}zoomEnd(){return this._getUpdatedState({startZoomPosition:null})}moveLeft(e=Is){const t=this.getDirection(!0);return this._move(t.rotateZ({radians:Math.PI/2}),e)}moveRight(e=Is){const t=this.getDirection(!0);return this._move(t.rotateZ({radians:-Math.PI/2}),e)}moveUp(e=Is){const t=this.getDirection(!0);return this._move(t,e)}moveDown(e=Is){const t=this.getDirection(!0);return this._move(t.negate(),e)}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}zoomIn(e=Is){return this._move(new ee(0,0,1),e)}zoomOut(e=Is){return this._move(new ee(0,0,-1),e)}shortestPathFrom(e){const t=e.getViewportProps(),i={...this.getViewportProps()},{bearing:s,longitude:r}=i;return Math.abs(s-t.bearing)>180&&(i.bearing=s<0?s+360:s-360),r!==null&&t.longitude!==null&&Math.abs(r-t.longitude)>180&&(i.longitude=r<0?r+360:r-360),i}_move(e,t,i=this.getViewportProps().position){const s=e.scale(t);return this._getUpdatedState({position:new ee(i).add(s)})}getDirection(e=!1){return new kr({bearing:this.getViewportProps().bearing,pitch:e?90:90+this.getViewportProps().pitch}).toVector3().normalize()}_getUpdatedState(e){return new ud({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}applyConstraints(e){const{pitch:t,maxPitch:i,minPitch:s,longitude:r,bearing:o}=e;return e.pitch=Ut(t,s,i),r!==null&&(r<-180||r>180)&&(e.longitude=lc(r+180,360)-180),(o<-180||o>180)&&(e.bearing=lc(o+180,360)-180),e}}class MF extends fa{constructor(){super(...arguments),this.ControllerState=ud,this.transition={transitionDuration:300,transitionInterpolator:new qs(["position","pitch","bearing"])}}}class BF extends Si{constructor(e={}){super(e)}getViewportType(){return PF}get ControllerType(){return MF}}BF.displayName="FirstPersonView";class Zb extends td{constructor(e){const{width:t,height:i,rotationX:s=0,rotationOrbit:r=0,target:o=[0,0,0],zoom:a=0,minRotationX:l=-90,maxRotationX:f=90,minZoom:g=-1/0,maxZoom:_=1/0,startPanPosition:v,startRotatePos:T,startRotationX:C,startRotationOrbit:S,startZoomPosition:R,startZoom:P}=e;super({width:t,height:i,rotationX:s,rotationOrbit:r,target:o,zoom:a,minRotationX:l,maxRotationX:f,minZoom:g,maxZoom:_},{startPanPosition:v,startRotatePos:T,startRotationX:C,startRotationOrbit:S,startZoomPosition:R,startZoom:P}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanPosition:this._unproject(e)})}pan({pos:e,startPosition:t}){const i=this.getState().startPanPosition||t;if(!i)return this;const r=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(r)}panEnd(){return this._getUpdatedState({startPanPosition:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startRotationX:this.getViewportProps().rotationX,startRotationOrbit:this.getViewportProps().rotationOrbit})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:i=0}){const{startRotatePos:s,startRotationX:r,startRotationOrbit:o}=this.getState(),{width:a,height:l}=this.getViewportProps();if(!s||r===void 0||o===void 0)return this;let f;if(e){let g=(e[0]-s[0])/a;const _=(e[1]-s[1])/l;(r<-90||r>90)&&(g*=-1),f={rotationX:r+_*180,rotationOrbit:o+g*180}}else f={rotationX:r+i,rotationOrbit:o+t};return this._getUpdatedState(f)}rotateEnd(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}shortestPathFrom(e){const t=e.getViewportProps(),i={...this.getViewportProps()},{rotationOrbit:s}=i;return Math.abs(s-t.rotationOrbit)>180&&(i.rotationOrbit=s<0?s+360:s-360),i}zoomStart({pos:e}){return this._getUpdatedState({startZoomPosition:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:i}){let{startZoom:s,startZoomPosition:r}=this.getState();if(r||(s=this.getViewportProps().zoom,r=this._unproject(t)||this._unproject(e)),!r)return this;const o=this._calculateNewZoom({scale:i,startZoom:s}),a=this.makeViewport({...this.getViewportProps(),zoom:o});return this._getUpdatedState({zoom:o,...a.panByPosition(r,e)})}zoomEnd(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}zoomIn(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:e})})}zoomOut(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/e})})}moveLeft(e=50){return this._panFromCenter([-e,0])}moveRight(e=50){return this._panFromCenter([e,0])}moveUp(e=50){return this._panFromCenter([0,-e])}moveDown(e=50){return this._panFromCenter([0,e])}rotateLeft(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit-e})}rotateRight(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit+e})}rotateUp(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX-e})}rotateDown(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX+e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_calculateNewZoom({scale:e,startZoom:t}){const{maxZoom:i,minZoom:s}=this.getViewportProps();t===void 0&&(t=this.getViewportProps().zoom);const r=t+Math.log2(e);return Ut(r,s,i)}_panFromCenter(e){const{width:t,height:i,target:s}=this.getViewportProps();return this.pan({startPosition:s,pos:[t/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}applyConstraints(e){const{maxZoom:t,minZoom:i,zoom:s,maxRotationX:r,minRotationX:o,rotationOrbit:a}=e;return e.zoom=Array.isArray(s)?[Ut(s[0],i,t),Ut(s[1],i,t)]:Ut(s,i,t),e.rotationX=Ut(e.rotationX,o,r),(a<-180||a>180)&&(e.rotationOrbit=lc(a+180,360)-180),e}}class OF extends fa{constructor(){super(...arguments),this.ControllerState=Zb,this.transition={transitionDuration:300,transitionInterpolator:new qs({transitionProps:{compare:["target","zoom","rotationX","rotationOrbit"],required:["target","zoom"]}})}}}class DF extends Si{constructor(e={}){super(e),this.props.orbitAxis=e.orbitAxis||"Z"}getViewportType(){return CF}get ControllerType(){return OF}}DF.displayName="OrbitView";class NF extends Zb{constructor(e){super(e),this.zoomAxis=e.zoomAxis||"all"}_calculateNewZoom({scale:e,startZoom:t}){const{maxZoom:i,minZoom:s}=this.getViewportProps();t===void 0&&(t=this.getViewportProps().zoom);let r=Math.log2(e);if(Array.isArray(t)){let[o,a]=t;switch(this.zoomAxis){case"X":o=Ut(o+r,s,i);break;case"Y":a=Ut(a+r,s,i);break;default:let l=Math.min(o+r,a+r);l<s&&(r+=s-l),l=Math.max(o+r,a+r),l>i&&(r+=i-l),o+=r,a+=r}return[o,a]}return Ut(t+r,s,i)}}class FF extends fa{constructor(){super(...arguments),this.ControllerState=NF,this.transition={transitionDuration:300,transitionInterpolator:new qs(["target","zoom"])},this.dragMode="pan"}_onPanRotate(){return!1}}class LF extends Si{constructor(e={}){super(e)}getViewportType(){return RF}get ControllerType(){return FF}}LF.displayName="OrthographicView";class kF extends wb{applyConstraints(e){const{maxZoom:t,minZoom:i,zoom:s}=e;e.zoom=Ut(s,i,t);const{longitude:r,latitude:o}=e;return(r<-180||r>180)&&(e.longitude=lc(r+180,360)-180),e.latitude=Ut(o,-85.051129,ac),e}}class UF extends fa{constructor(){super(...arguments),this.ControllerState=kF,this.transition={transitionDuration:300,transitionInterpolator:new qs(["longitude","latitude","zoom"])},this.dragMode="pan"}setProps(e){super.setProps(e),this.dragRotate=!1,this.touchRotate=!1}}class VF extends Si{constructor(e={}){super(e)}getViewportType(e){return e.zoom>12?fi:Ad}get ControllerType(){return UF}}VF.displayName="GlobeView";class hd{static get componentName(){return Object.prototype.hasOwnProperty.call(this,"extensionName")?this.extensionName:""}constructor(e){e&&(this.opts=e)}equals(e){return this===e?!0:this.constructor===e.constructor&&Kt(this.opts,e.opts,1)}getShaders(e){return null}getSubLayerProps(e){const{defaultProps:t}=e.constructor,i={updateTriggers:{}};for(const s in t)if(s in this.props){const r=t[s],o=this.props[s];i[s]=o,r&&r.type==="accessor"&&(i.updateTriggers[s]=this.props.updateTriggers[s],typeof o=="function"&&(i[s]=this.getSubLayerAccessor(o)))}return i}initializeState(e,t){}updateState(e,t){}onNeedsRedraw(e){}getNeedsPickingBuffer(e){return!1}draw(e,t){}finalizeState(e,t){}}hd.defaultProps={};hd.extensionName="LayerExtension";const Su={bearing:0,pitch:0,position:[0,0,0]},zF={speed:1.2,curve:1.414};class ev extends Tb{constructor(e={}){super({compare:["longitude","latitude","zoom","bearing","pitch","position"],extract:["width","height","longitude","latitude","zoom","bearing","pitch","position"],required:["width","height","latitude","longitude","zoom"]}),this.opts={...zF,...e}}interpolateProps(e,t,i){const s=XB(e,t,i,this.opts);for(const r in Su)s[r]=Qn(e[r]||Su[r],t[r]||Su[r],i);return s}getDuration(e,t){let{transitionDuration:i}=t;return i==="auto"&&(i=QB(e,t,this.opts)),i}}class tv{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:t={}}=e;this.typedArrayManager=Qr,this.attributes={},this._attributeDefs=t,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:t,buffers:i={},getGeometry:s,geometryBuffer:r,positionFormat:o,dataChanged:a,normalize:l=!0}=this.opts;if(this.data=t,this.getGeometry=s,this.positionSize=r&&r.size||(o==="XY"?2:3),this.buffers=i,this.normalize=l,r&&(An(t.startIndices),this.getGeometry=this.getGeometryFromBuffer(r),l||(i.vertexPositions=r)),this.geometryBuffer=i.vertexPositions,Array.isArray(a))for(const f of a)this._rebuildGeometry(f);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:t}){this._rebuildGeometry({startRow:e,endRow:t})}getGeometryFromBuffer(e){const t=e.value||e;return ArrayBuffer.isView(t)?Hb(t,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,t){const{attributes:i,buffers:s,_attributeDefs:r,typedArrayManager:o}=this;for(const a in r)if(a in s)o.release(i[a]),i[a]=null;else{const l=r[a];l.copy=t,i[a]=o.allocate(i[a],e,l)}}_forEachGeometry(e,t,i){const{data:s,getGeometry:r}=this,{iterable:o,objectInfo:a}=Ri(s,t,i);for(const l of o){a.index++;const f=r?r(l,a):null;e(f,a.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:t,vertexStarts:i,instanceCount:s}=this;const{data:r,geometryBuffer:o}=this,{startRow:a=0,endRow:l=1/0}=e||{},f={};if(e||(t=[0],i=[0]),this.normalize||!o)this._forEachGeometry((_,v)=>{const T=_&&this.normalizeGeometry(_);f[v]=T,i[v+1]=i[v]+(T?this.getGeometrySize(T):0)},a,l),s=i[i.length-1];else if(i=r.startIndices,s=i[r.length]||0,ArrayBuffer.isView(o))s=s||o.length/this.positionSize;else if(o instanceof Ft){const _=this.positionSize*4;s=s||o.byteLength/_}else if(o.buffer){const _=o.stride||this.positionSize*4;s=s||o.buffer.byteLength/_}else if(o.value){const _=o.value,v=o.stride/_.BYTES_PER_ELEMENT||this.positionSize;s=s||_.length/v}this._allocate(s,!!e),this.indexStarts=t,this.vertexStarts=i,this.instanceCount=s;const g={};this._forEachGeometry((_,v)=>{const T=f[v]||_;g.vertexStart=i[v],g.indexStart=t[v];const C=v<i.length-1?i[v+1]:s;g.geometrySize=C-i[v],g.geometryIndex=v,this.updateGeometryAttributes(T,g)},a,l),this.vertexCount=t[t.length-1]}}function qr(n,e){e&&Object.entries(e).map(([t,i])=>{t.startsWith("--")?n.style.setProperty(t,i):n.style[t]=i})}function fd(n,e){e&&Object.keys(e).map(t=>{t.startsWith("--")?n.style.removeProperty(t):n.style[t]=""})}const em=`uniform arcUniforms {
  bool greatCircle;
  bool useShortestPath;
  float numSegments;
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  highp int widthUnits;
} arc;
`,HF={name:"arc",vs:em,fs:em,uniformTypes:{greatCircle:"f32",useShortestPath:"f32",numSegments:"f32",widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",widthUnits:"i32"}},GF=`#version 300 es
#define SHADER_NAME arc-layer-vertex-shader
in vec4 instanceSourceColors;
in vec4 instanceTargetColors;
in vec3 instanceSourcePositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions;
in vec3 instanceTargetPositions64Low;
in vec3 instancePickingColors;
in float instanceWidths;
in float instanceHeights;
in float instanceTilts;
out vec4 vColor;
out vec2 uv;
out float isValid;
float paraboloid(float distance, float sourceZ, float targetZ, float ratio) {
float deltaZ = targetZ - sourceZ;
float dh = distance * instanceHeights;
if (dh == 0.0) {
return sourceZ + deltaZ * ratio;
}
float unitZ = deltaZ / dh;
float p2 = unitZ * unitZ + 1.0;
float dir = step(deltaZ, 0.0);
float z0 = mix(sourceZ, targetZ, dir);
float r = mix(ratio, 1.0 - ratio, dir);
return sqrt(r * (p2 - r)) * dh + z0;
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
float getSegmentRatio(float index) {
return smoothstep(0.0, 1.0, index / (arc.numSegments - 1.0));
}
vec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {
float distance = length(source.xy - target.xy);
float z = paraboloid(distance, source.z, target.z, segmentRatio);
float tiltAngle = radians(instanceTilts);
vec2 tiltDirection = normalize(target.xy - source.xy);
vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);
return vec3(
mix(source.xy, target.xy, segmentRatio) + tilt,
z * cos(tiltAngle)
);
}
float getAngularDist (vec2 source, vec2 target) {
vec2 sourceRadians = radians(source);
vec2 targetRadians = radians(target);
vec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);
vec2 shd_sq = sin_half_delta * sin_half_delta;
float a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;
return 2.0 * asin(sqrt(a));
}
vec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {
vec2 lngLat;
if(abs(angularDist - PI) < 0.001) {
lngLat = (1.0 - t) * source.xy + t * target.xy;
} else {
float a = sin((1.0 - t) * angularDist);
float b = sin(t * angularDist);
vec3 p = source3D.yxz * a + target3D.yxz * b;
lngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));
}
float z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);
return vec3(lngLat, z);
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
float segmentIndex = float(gl_VertexID / 2);
float segmentSide = mod(float(gl_VertexID), 2.) == 0. ? -1. : 1.;
float segmentRatio = getSegmentRatio(segmentIndex);
float prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));
float nextSegmentRatio = getSegmentRatio(min(arc.numSegments - 1.0, segmentIndex + 1.0));
float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
isValid = 1.0;
uv = vec2(segmentRatio, segmentSide);
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
vec4 curr;
vec4 next;
vec3 source;
vec3 target;
if ((arc.greatCircle || project.projectionMode == PROJECTION_MODE_GLOBE) && project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
source = project_globe_(vec3(instanceSourcePositions.xy, 0.0));
target = project_globe_(vec3(instanceTargetPositions.xy, 0.0));
float angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);
vec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);
vec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);
vec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);
if (abs(currPos.x - prevPos.x) > 180.0) {
indexDir = -1.0;
isValid = 0.0;
} else if (abs(currPos.x - nextPos.x) > 180.0) {
indexDir = 1.0;
isValid = 0.0;
}
nextPos = indexDir < 0.0 ? prevPos : nextPos;
nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
if (isValid == 0.0) {
nextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;
float t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);
currPos = mix(currPos, nextPos, t);
segmentRatio = mix(segmentRatio, nextSegmentRatio, t);
}
vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);
vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);
curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);
next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));
} else {
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
if (arc.useShortestPath) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng > 180.) target_world.x -= 360.;
if (deltaLng < -180.) source_world.x -= 360.;
}
source = project_position(source_world, instanceSourcePositions64Low);
target = project_position(target_world, instanceTargetPositions64Low);
float antiMeridianX = 0.0;
if (arc.useShortestPath) {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
antiMeridianX = -(project.coordinateOrigin.x + 180.) / 360. * TILE_SIZE;
}
float thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);
if (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {
isValid = 0.0;
indexDir = sign(segmentRatio - thresholdRatio);
segmentRatio = thresholdRatio;
}
}
nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
vec3 currPos = interpolateFlat(source, target, segmentRatio);
vec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);
if (arc.useShortestPath) {
if (nextPos.x < antiMeridianX) {
currPos.x += TILE_SIZE;
nextPos.x += TILE_SIZE;
}
}
curr = project_common_position_to_clipspace(vec4(currPos, 1.0));
next = project_common_position_to_clipspace(vec4(nextPos, 1.0));
geometry.position = vec4(currPos, 1.0);
}
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * arc.widthScale, arc.widthUnits),
arc.widthMinPixels, arc.widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset((next.xy - curr.xy) * indexDir, segmentSide, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(curr, geometry);
gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);
vColor = vec4(color.rgb, color.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,WF=`#version 300 es
#define SHADER_NAME arc-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
in float isValid;
out vec4 fragColor;
void main(void) {
if (isValid == 0.0) {
discard;
}
fragColor = vColor;
geometry.uv = uv;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,fc=[0,0,0,255],jF={getSourcePosition:{type:"accessor",value:n=>n.sourcePosition},getTargetPosition:{type:"accessor",value:n=>n.targetPosition},getSourceColor:{type:"accessor",value:fc},getTargetColor:{type:"accessor",value:fc},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,numSegments:{type:"number",value:50,min:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class dd extends rn{getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:GF,fs:WF,modules:[sn,Un,HF]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getSourceColor",defaultValue:fc},instanceTargetColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getTargetColor",defaultValue:fc},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}updateState(e){var t;super.updateState(e),e.changeFlags.extensionsChanged&&((t=this.state.model)==null||t.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{widthUnits:t,widthScale:i,widthMinPixels:s,widthMaxPixels:r,greatCircle:o,wrapLongitude:a,numSegments:l}=this.props,f={numSegments:l,widthUnits:kn[t],widthScale:i,widthMinPixels:s,widthMaxPixels:r,greatCircle:o,useShortestPath:a},g=this.state.model;g.shaderInputs.setProps({arc:f}),g.setVertexCount(l*2),g.draw(this.context.renderPass)}_getModel(){return new Nt(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-strip",isInstanced:!0})}}dd.layerName="ArcLayer";dd.defaultProps=jF;const $F=new Uint32Array([0,2,1,0,3,2]),XF=new Float32Array([0,1,0,0,1,0,1,1]);function QF(n,e){if(!e)return YF(n);const t=Math.max(Math.abs(n[0][0]-n[3][0]),Math.abs(n[1][0]-n[2][0])),i=Math.max(Math.abs(n[1][1]-n[0][1]),Math.abs(n[2][1]-n[3][1])),s=Math.ceil(t/e)+1,r=Math.ceil(i/e)+1,o=(s-1)*(r-1)*6,a=new Uint32Array(o),l=new Float32Array(s*r*2),f=new Float64Array(s*r*3);let g=0,_=0;for(let v=0;v<s;v++){const T=v/(s-1);for(let C=0;C<r;C++){const S=C/(r-1),R=KF(n,T,S);f[g*3+0]=R[0],f[g*3+1]=R[1],f[g*3+2]=R[2]||0,l[g*2+0]=T,l[g*2+1]=1-S,v>0&&C>0&&(a[_++]=g-r,a[_++]=g-r-1,a[_++]=g-1,a[_++]=g-r,a[_++]=g-1,a[_++]=g),g++}}return{vertexCount:o,positions:f,indices:a,texCoords:l}}function YF(n){const e=new Float64Array(12);for(let t=0;t<n.length;t++)e[t*3+0]=n[t][0],e[t*3+1]=n[t][1],e[t*3+2]=n[t][2]||0;return{vertexCount:6,positions:e,indices:$F,texCoords:XF}}function KF(n,e,t){return Qn(Qn(n[0],n[1],t),Qn(n[3],n[2],t),e)}const tm=`uniform bitmapUniforms {
  vec4 bounds;
  float coordinateConversion;
  float desaturate;
  vec3 tintColor;
  vec4 transparentColor;
} bitmap;
`,qF={name:"bitmap",vs:tm,fs:tm,uniformTypes:{bounds:"vec4<f32>",coordinateConversion:"f32",desaturate:"f32",tintColor:"vec3<f32>",transparentColor:"vec4<f32>"}},JF=`#version 300 es
#define SHADER_NAME bitmap-layer-vertex-shader

in vec2 texCoords;
in vec3 positions;
in vec3 positions64Low;

out vec2 vTexCoord;
out vec2 vTexPos;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (bitmap.coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy + project.commonOrigin.xy;
  } else if (bitmap.coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`,ZF=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`,eL=`#version 300 es
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

in vec2 vTexCoord;
in vec2 vTexPos;

out vec4 fragColor;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), bitmap.desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * bitmap.tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  if (bitmap.transparentColor.a == 0.0) {
    return vec4(color, alpha);
  }
  float blendedAlpha = alpha + bitmap.transparentColor.a * (1.0 - alpha);
  float highLightRatio = alpha / blendedAlpha;
  vec3 blendedRGB = mix(bitmap.transparentColor.rgb, color, highLightRatio);
  return vec4(blendedRGB, blendedAlpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bitmap.bounds[0]) / (bitmap.bounds[2] - bitmap.bounds[0]),
    (pos.y - bitmap.bounds[3]) / (bitmap.bounds[1] - bitmap.bounds[3])
  );
}

${ZF}

void main(void) {
  vec2 uv = vTexCoord;
  if (bitmap.coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (bitmap.coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture(bitmapTexture, uv);

  fragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * layer.opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(fragColor, geometry);

  if (bool(picking.isActive) && !bool(picking.isAttribute)) {
    // Since instance information is not used, we can use picking color for pixel index
    fragColor.rgb = packUVsIntoRGB(uv);
  }
}
`,tL={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:Ue.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0,value:null}};class nv extends rn{getShaders(){return super.getShaders({vs:JF,fs:eL,modules:[sn,Un,qF]})}initializeState(){const e=this.getAttributeManager();e.remove(["instancePickingColors"]);const t=!0;e.add({indices:{size:1,isIndexed:!0,update:i=>i.value=this.state.mesh.indices,noAlloc:t},positions:{size:3,type:"float64",fp64:this.use64bitPositions(),update:i=>i.value=this.state.mesh.positions,noAlloc:t},texCoords:{size:2,update:i=>i.value=this.state.mesh.texCoords,noAlloc:t}})}updateState({props:e,oldProps:t,changeFlags:i}){var r;const s=this.getAttributeManager();if(i.extensionsChanged&&((r=this.state.model)==null||r.destroy(),this.state.model=this._getModel(),s.invalidateAll()),e.bounds!==t.bounds){const o=this.state.mesh,a=this._createMesh();this.state.model.setVertexCount(a.vertexCount);for(const l in a)o&&o[l]!==a[l]&&s.invalidate(l);this.setState({mesh:a,...this._getCoordinateUniforms()})}else e._imageCoordinateSystem!==t._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(e){const{image:t}=this.props,i=e.info;if(!i.color||!t)return i.bitmap=null,i;const{width:s,height:r}=t;i.index=0;const o=nL(i.color);return i.bitmap={size:{width:s,height:r},uv:o,pixel:[Math.floor(o[0]*s),Math.floor(o[1]*r)]},i}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(e){super._updateAutoHighlight({...e,color:this.encodePickingColor(0)})}_createMesh(){const{bounds:e}=this.props;let t=e;return nm(e)&&(t=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]]),QF(t,this.context.viewport.resolution)}_getModel(){return new Nt(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-list",isInstanced:!1})}draw(e){const{shaderModuleProps:t}=e,{model:i,coordinateConversion:s,bounds:r,disablePicking:o}=this.state,{image:a,desaturate:l,transparentColor:f,tintColor:g}=this.props;if(!(t.picking.isActive&&o)&&a&&i){const _={bitmapTexture:a,bounds:r,coordinateConversion:s,desaturate:l,tintColor:g.slice(0,3).map(v=>v/255),transparentColor:f.map(v=>v/255)};i.shaderInputs.setProps({bitmap:_}),i.draw(this.context.renderPass)}}_getCoordinateUniforms(){const{LNGLAT:e,CARTESIAN:t,DEFAULT:i}=Ue;let{_imageCoordinateSystem:s}=this.props;if(s!==i){const{bounds:r}=this.props;if(!nm(r))throw new Error("_imageCoordinateSystem only supports rectangular bounds");const o=this.context.viewport.resolution?e:t;if(s=s===e?e:t,s===e&&o===t)return{coordinateConversion:-1,bounds:r};if(s===t&&o===e){const a=Ci([r[0],r[1]]),l=Ci([r[2],r[3]]);return{coordinateConversion:1,bounds:[a[0],a[1],l[0],l[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}nv.layerName="BitmapLayer";nv.defaultProps=tL;function nL(n){const[e,t,i]=n,s=(i&240)/256,r=(i&15)/16;return[(e+r)/256,(t+s)/256]}function nm(n){return Number.isFinite(n[0])}const im=`uniform iconUniforms {
  float sizeScale;
  vec2 iconsTextureDim;
  float sizeMinPixels;
  float sizeMaxPixels;
  bool billboard;
  highp int sizeUnits;
  float alphaCutoff;
} icon;
`,iL={name:"icon",vs:im,fs:im,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}},sL=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),
icon.sizeMinPixels, icon.sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (icon.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / icon.iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,rL=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * layer.opacity * vColor.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,oL=1024,aL=4,sm=()=>{},rm={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},lL={x:0,y:0,width:0,height:0};function cL(n){return Math.pow(2,Math.ceil(Math.log2(n)))}function AL(n,e,t,i){const s=Math.min(t/e.width,i/e.height),r=Math.floor(e.width*s),o=Math.floor(e.height*s);return s===1?{image:e,width:r,height:o}:(n.canvas.height=o,n.canvas.width=r,n.clearRect(0,0,r,o),n.drawImage(e,0,0,e.width,e.height,0,0,r,o),{image:n.canvas,width:r,height:o})}function ta(n){return n&&(n.id||n.url)}function uL(n,e,t,i){const{width:s,height:r,device:o}=n,a=o.createTexture({format:"rgba8unorm",width:e,height:t,sampler:i,mipmaps:!0}),l=o.createCommandEncoder();return l.copyTextureToTexture({sourceTexture:n,destinationTexture:a,width:s,height:r}),l.finish(),n.destroy(),a}function om(n,e,t){for(let i=0;i<e.length;i++){const{icon:s,xOffset:r}=e[i],o=ta(s);n[o]={...s,x:r,y:t}}}function hL({icons:n,buffer:e,mapping:t={},xOffset:i=0,yOffset:s=0,rowHeight:r=0,canvasWidth:o}){let a=[];for(let l=0;l<n.length;l++){const f=n[l],g=ta(f);if(!t[g]){const{height:_,width:v}=f;i+v+e>o&&(om(t,a,s),i=0,s=r+s+e,r=0,a=[]),a.push({icon:f,xOffset:i}),i=i+v+e,r=Math.max(r,_)}}return a.length>0&&om(t,a,s),{mapping:t,rowHeight:r,xOffset:i,yOffset:s,canvasWidth:o,canvasHeight:cL(r+s+e)}}function fL(n,e,t){if(!n||!e)return null;t=t||{};const i={},{iterable:s,objectInfo:r}=Ri(n);for(const o of s){r.index++;const a=e(o,r),l=ta(a);if(!a)throw new Error("Icon is missing.");if(!a.url)throw new Error("Icon url is missing.");!i[l]&&(!t[l]||a.url!==t[l].url)&&(i[l]={...a,source:o,sourceIndex:r.index})}return i}class dL{constructor(e,{onUpdate:t=sm,onError:i=sm}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=aL,this._canvasWidth=oL,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=t,this.onError=i}finalize(){var e;(e=this._texture)==null||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const t=this._autoPacking?ta(e):e;return this._mapping[t]||lL}setProps({loadOptions:e,autoPacking:t,iconAtlas:i,iconMapping:s,textureParameters:r}){var o;e&&(this._loadOptions=e),t!==void 0&&(this._autoPacking=t),s&&(this._mapping=s),i&&((o=this._texture)==null||o.delete(),this._texture=null,this._externalTexture=i),r&&(this._samplerParameters=r)}get isLoaded(){return this._pendingCount===0}packIcons(e,t){if(!this._autoPacking||typeof document>"u")return;const i=Object.values(fL(e,t,this._mapping)||{});if(i.length>0){const{mapping:s,xOffset:r,yOffset:o,rowHeight:a,canvasHeight:l}=hL({icons:i,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=a,this._mapping=s,this._xOffset=r,this._yOffset=o,this._canvasHeight=l,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||rm,mipmaps:!0})),this._texture.height!==this._canvasHeight&&(this._texture=uL(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||rm)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(i)}}_loadIcons(e){const t=this._canvas.getContext("2d",{willReadFrequently:!0});for(const i of e)this._pendingCount++,Li(i.url,this._loadOptions).then(s=>{var C;const r=ta(i),o=this._mapping[r],{x:a,y:l,width:f,height:g}=o,{image:_,width:v,height:T}=AL(t,s,f,g);(C=this._texture)==null||C.copyExternalImage({image:_,x:a+(f-v)/2,y:l+(g-T)/2,width:v,height:T}),o.width=v,o.height=T,this._texture.generateMipmap(),this.onUpdate()}).catch(s=>{this.onError({url:i.url,source:i.source,sourceIndex:i.sourceIndex,loadOptions:this._loadOptions,error:s})}).finally(()=>{this._pendingCount--})}}const iv=[0,0,0,255],gL={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:n=>n.position},getIcon:{type:"accessor",value:n=>n.icon},getColor:{type:"accessor",value:iv},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class iA extends rn{getShaders(){return super.getShaders({vs:sL,fs:rL,modules:[sn,Un,iL]})}initializeState(){this.state={iconManager:new dL(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:iv},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){var T;super.updateState(e);const{props:t,oldProps:i,changeFlags:s}=e,r=this.getAttributeManager(),{iconAtlas:o,iconMapping:a,data:l,getIcon:f,textureParameters:g}=t,{iconManager:_}=this.state;if(typeof o=="string")return;const v=o||this.internalState.isAsyncPropLoading("iconAtlas");_.setProps({loadOptions:t.loadOptions,autoPacking:!v,iconAtlas:o,iconMapping:v?a:null,textureParameters:g}),v?i.iconMapping!==t.iconMapping&&r.invalidate("getIcon"):(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getIcon))&&_.packIcons(l,f),s.extensionsChanged&&((T=this.state.model)==null||T.destroy(),this.state.model=this._getModel(),r.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:t,sizeMinPixels:i,sizeMaxPixels:s,sizeUnits:r,billboard:o,alphaCutoff:a}=this.props,{iconManager:l}=this.state,f=l.getTexture();if(f){const g=this.state.model,_={iconsTexture:f,iconsTextureDim:[f.width,f.height],sizeUnits:kn[r],sizeScale:t,sizeMinPixels:i,sizeMaxPixels:s,billboard:o,alphaCutoff:a};g.shaderInputs.setProps({icon:_}),g.draw(this.context.renderPass)}}_getModel(){const e=[-1,-1,1,-1,-1,1,1,1];return new Nt(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new un({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var i;const t=(i=this.getCurrentLayer())==null?void 0:i.props.onIconError;t?t(e):ze.error(e.error.message)()}getInstanceOffset(e){const{width:t,height:i,anchorX:s=t/2,anchorY:r=i/2}=this.state.iconManager.getIconMapping(e);return[t/2-s,i/2-r]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:t,y:i,width:s,height:r}=this.state.iconManager.getIconMapping(e);return[t,i,s,r]}}iA.defaultProps=gL;iA.layerName="IconLayer";const am=`uniform lineUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float useShortestPath;
  highp int widthUnits;
} line;
`,pL={name:"line",vs:am,fs:am,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",useShortestPath:"f32",widthUnits:"i32"}},mL=`#version 300 es
#define SHADER_NAME line-layer-vertex-shader
in vec3 positions;
in vec3 instanceSourcePositions;
in vec3 instanceTargetPositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in float instanceWidths;
out vec4 vColor;
out vec2 uv;
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
vec3 splitLine(vec3 a, vec3 b, float x) {
float t = (x - a.x) / (b.x - a.x);
return vec3(x, mix(a.yz, b.yz, t));
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
vec3 source_world_64low = instanceSourcePositions64Low;
vec3 target_world_64low = instanceTargetPositions64Low;
if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng * line.useShortestPath > 180.) {
source_world.x += 360. * line.useShortestPath;
source_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
source_world_64low = vec3(0.0);
} else if (deltaLng * line.useShortestPath < -180.) {
target_world.x += 360. * line.useShortestPath;
target_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
target_world_64low = vec3(0.0);
} else if (line.useShortestPath < 0.) {
gl_Position = vec4(0.);
return;
}
}
vec4 source_commonspace;
vec4 target_commonspace;
vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
float segmentIndex = positions.x;
vec4 p = mix(source, target, segmentIndex);
geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
uv = positions.xy;
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
line.widthMinPixels, line.widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(p, geometry);
gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,_L=`#version 300 es
#define SHADER_NAME line-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,yL=[0,0,0,255],bL={getSourcePosition:{type:"accessor",value:n=>n.sourcePosition},getTargetPosition:{type:"accessor",value:n=>n.targetPosition},getColor:{type:"accessor",value:yL},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class sv extends rn{getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:mL,fs:_L,modules:[sn,Un,pL]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(e){var t;super.updateState(e),e.changeFlags.extensionsChanged&&((t=this.state.model)==null||t.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{widthUnits:t,widthScale:i,widthMinPixels:s,widthMaxPixels:r,wrapLongitude:o}=this.props,a=this.state.model,l={widthUnits:kn[t],widthScale:i,widthMinPixels:s,widthMaxPixels:r,useShortestPath:o?1:0};a.shaderInputs.setProps({line:l}),a.draw(this.context.renderPass),o&&(a.shaderInputs.setProps({line:{...l,useShortestPath:-1}}),a.draw(this.context.renderPass))}_getModel(){const e=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new Nt(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new un({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}sv.layerName="LineLayer";sv.defaultProps=bL;const lm=`uniform pointCloudUniforms {
  float radiusPixels;
  highp int sizeUnits;
} pointCloud;
`,vL={name:"pointCloud",vs:lm,fs:lm,uniformTypes:{radiusPixels:"f32",sizeUnits:"i32"}},TL=`#version 300 es
#define SHADER_NAME point-cloud-layer-vertex-shader
in vec3 positions;
in vec3 instanceNormals;
in vec4 instanceColors;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec3 instancePickingColors;
out vec4 vColor;
out vec2 unitPosition;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.normal = project_normal(instanceNormals);
unitPosition = positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
vec3 offset = vec3(positions.xy * project_size_to_pixel(pointCloud.radiusPixels, pointCloud.sizeUnits), 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,wL=`#version 300 es
#define SHADER_NAME point-cloud-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 unitPosition;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition.xy;
float distToCenter = length(unitPosition);
if (distToCenter > 1.0) {
discard;
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,rv=[0,0,0,255],ov=[0,0,1],EL={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:n=>n.position},getNormal:{type:"accessor",value:ov},getColor:{type:"accessor",value:rv},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function xL(n){const{header:e,attributes:t}=n;if(!(!e||!t)&&(n.length=e.vertexCount,t.POSITION&&(t.instancePositions=t.POSITION),t.NORMAL&&(t.instanceNormals=t.NORMAL),t.COLOR_0)){const{size:i,value:s}=t.COLOR_0;t.instanceColors={size:i,type:"unorm8",value:s}}}class gd extends rn{getShaders(){return super.getShaders({vs:TL,fs:wL,modules:[sn,Kc,Un,vL]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:ov},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:rv}})}updateState(e){var s;const{changeFlags:t,props:i}=e;super.updateState(e),t.extensionsChanged&&((s=this.state.model)==null||s.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll()),t.dataChanged&&xL(i.data)}draw({uniforms:e}){const{pointSize:t,sizeUnits:i}=this.props,s=this.state.model,r={sizeUnits:kn[i],radiusPixels:t};s.shaderInputs.setProps({pointCloud:r}),s.draw(this.context.renderPass)}_getModel(){const e=[];for(let t=0;t<3;t++){const i=t/3*Math.PI*2;e.push(Math.cos(i)*2,Math.sin(i)*2,0)}return new Nt(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new un({topology:"triangle-list",attributes:{positions:new Float32Array(e)}}),isInstanced:!0})}}gd.layerName="PointCloudLayer";gd.defaultProps=EL;const cm=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  bool filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,CL={name:"scatterplot",vs:cm,fs:cm,uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},SL=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,IL=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled == false) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Am=[0,0,0,255],RL={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:n=>n.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:Am},getLineColor:{type:"accessor",value:Am},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class pd extends rn{getShaders(){return super.getShaders({vs:SL,fs:IL,modules:[sn,Un,CL]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var t;super.updateState(e),e.changeFlags.extensionsChanged&&((t=this.state.model)==null||t.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:t,radiusScale:i,radiusMinPixels:s,radiusMaxPixels:r,stroked:o,filled:a,billboard:l,antialiasing:f,lineWidthUnits:g,lineWidthScale:_,lineWidthMinPixels:v,lineWidthMaxPixels:T}=this.props,C={stroked:o,filled:a,billboard:l,antialiasing:f,radiusUnits:kn[t],radiusScale:i,radiusMinPixels:s,radiusMaxPixels:r,lineWidthUnits:kn[g],lineWidthScale:_,lineWidthMinPixels:v,lineWidthMaxPixels:T},S=this.state.model;S.shaderInputs.setProps({scatterplot:C}),S.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new Nt(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new un({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}pd.defaultProps=RL;pd.layerName="ScatterplotLayer";const md={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function _d(n,e,t={}){return PL(n,t)!==e?(BL(n,t),!0):!1}function PL(n,e={}){return Math.sign(ML(n,e))}const um={x:0,y:1,z:2};function ML(n,e={}){const{start:t=0,end:i=n.length,plane:s="xy"}=e,r=e.size||2;let o=0;const a=um[s[0]],l=um[s[1]];for(let f=t,g=i-r;f<i;f+=r)o+=(n[f+a]-n[g+a])*(n[f+l]+n[g+l]),g=f;return o/2}function BL(n,e){const{start:t=0,end:i=n.length,size:s=2}=e,r=(i-t)/s,o=Math.floor(r/2);for(let a=0;a<o;++a){const l=t+a*s,f=t+(r-1-a)*s;for(let g=0;g<s;++g){const _=n[l+g];n[l+g]=n[f+g],n[f+g]=_}}}function ai(n,e){const t=e.length,i=n.length;if(i>0){let s=!0;for(let r=0;r<t;r++)if(n[i-t+r]!==e[r]){s=!1;break}if(s)return!1}for(let s=0;s<t;s++)n[i+s]=e[s];return!0}function ef(n,e){const t=e.length;for(let i=0;i<t;i++)n[i]=e[i]}function na(n,e,t,i,s=[]){const r=i+e*t;for(let o=0;o<t;o++)s[o]=n[r+o];return s}function tf(n,e,t,i,s=[]){let r,o;if(t&8)r=(i[3]-n[1])/(e[1]-n[1]),o=3;else if(t&4)r=(i[1]-n[1])/(e[1]-n[1]),o=1;else if(t&2)r=(i[2]-n[0])/(e[0]-n[0]),o=2;else if(t&1)r=(i[0]-n[0])/(e[0]-n[0]),o=0;else return null;for(let a=0;a<n.length;a++)s[a]=(o&1)===a?i[o]:r*(e[a]-n[a])+n[a];return s}function Sl(n,e){let t=0;return n[0]<e[0]?t|=1:n[0]>e[2]&&(t|=2),n[1]<e[1]?t|=4:n[1]>e[3]&&(t|=8),t}function av(n,e){const{size:t=2,broken:i=!1,gridResolution:s=10,gridOffset:r=[0,0],startIndex:o=0,endIndex:a=n.length}=e||{},l=(a-o)/t;let f=[];const g=[f],_=na(n,0,t,o);let v,T;const C=cv(_,s,r,[]),S=[];ai(f,_);for(let R=1;R<l;R++){for(v=na(n,R,t,o,v),T=Sl(v,C);T;){tf(_,v,T,C,S);const P=Sl(S,C);P&&(tf(_,S,P,C,S),T=P),ai(f,S),ef(_,S),DL(C,s,T),i&&f.length>t&&(f=[],g.push(f),ai(f,_)),T=Sl(v,C)}ai(f,v),ef(_,v)}return i?g:g[0]}const hm=0,OL=1;function lv(n,e=null,t){if(!n.length)return[];const{size:i=2,gridResolution:s=10,gridOffset:r=[0,0],edgeTypes:o=!1}=t||{},a=[],l=[{pos:n,types:o?new Array(n.length/i).fill(OL):null,holes:e||[]}],f=[[],[]];let g=[];for(;l.length;){const{pos:_,types:v,holes:T}=l.shift();NL(_,i,T[0]||_.length,f),g=cv(f[0],s,r,g);const C=Sl(f[1],g);if(C){let S=fm(_,v,i,0,T[0]||_.length,g,C);const R={pos:S[0].pos,types:S[0].types,holes:[]},P={pos:S[1].pos,types:S[1].types,holes:[]};l.push(R,P);for(let F=0;F<T.length;F++)S=fm(_,v,i,T[F],T[F+1]||_.length,g,C),S[0]&&(R.holes.push(R.pos.length),R.pos=qa(R.pos,S[0].pos),o&&(R.types=qa(R.types,S[0].types))),S[1]&&(P.holes.push(P.pos.length),P.pos=qa(P.pos,S[1].pos),o&&(P.types=qa(P.types,S[1].types)))}else{const S={positions:_};o&&(S.edgeTypes=v),T.length&&(S.holeIndices=T),a.push(S)}}return a}function fm(n,e,t,i,s,r,o){const a=(s-i)/t,l=[],f=[],g=[],_=[],v=[];let T,C,S;const R=na(n,a-1,t,i);let P=Math.sign(o&8?R[1]-r[3]:R[0]-r[2]),F=e&&e[a-1],U=0,X=0;for(let Z=0;Z<a;Z++)T=na(n,Z,t,i,T),C=Math.sign(o&8?T[1]-r[3]:T[0]-r[2]),S=e&&e[i/t+Z],C&&P&&P!==C&&(tf(R,T,o,r,v),ai(l,v)&&g.push(F),ai(f,v)&&_.push(F)),C<=0?(ai(l,T)&&g.push(S),U-=C):g.length&&(g[g.length-1]=hm),C>=0?(ai(f,T)&&_.push(S),X+=C):_.length&&(_[_.length-1]=hm),ef(R,T),P=C,F=S;return[U?{pos:l,types:e&&g}:null,X?{pos:f,types:e&&_}:null]}function cv(n,e,t,i){const s=Math.floor((n[0]-t[0])/e)*e+t[0],r=Math.floor((n[1]-t[1])/e)*e+t[1];return i[0]=s,i[1]=r,i[2]=s+e,i[3]=r+e,i}function DL(n,e,t){t&8?(n[1]+=e,n[3]+=e):t&4?(n[1]-=e,n[3]-=e):t&2?(n[0]+=e,n[2]+=e):t&1&&(n[0]-=e,n[2]-=e)}function NL(n,e,t,i){let s=1/0,r=-1/0,o=1/0,a=-1/0;for(let l=0;l<t;l+=e){const f=n[l],g=n[l+1];s=f<s?f:s,r=f>r?f:r,o=g<o?g:o,a=g>a?g:a}return i[0][0]=s,i[0][1]=o,i[1][0]=r,i[1][1]=a,i}function qa(n,e){for(let t=0;t<e.length;t++)n.push(e[t]);return n}const FL=85.051129;function LL(n,e){const{size:t=2,startIndex:i=0,endIndex:s=n.length,normalize:r=!0}=e||{},o=n.slice(i,s);Av(o,t,0,s-i);const a=av(o,{size:t,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(r)for(const l of a)uv(l,t);return a}function kL(n,e=null,t){const{size:i=2,normalize:s=!0,edgeTypes:r=!1}=t||{};e=e||[];const o=[],a=[];let l=0,f=0;for(let _=0;_<=e.length;_++){const v=e[_]||n.length,T=f,C=UL(n,i,l,v);for(let S=C;S<v;S++)o[f++]=n[S];for(let S=l;S<C;S++)o[f++]=n[S];Av(o,i,T,f),VL(o,i,T,f,t==null?void 0:t.maxLatitude),l=v,a[_]=f}a.pop();const g=lv(o,a,{size:i,gridResolution:360,gridOffset:[-180,-180],edgeTypes:r});if(s)for(const _ of g)uv(_.positions,i);return g}function UL(n,e,t,i){let s=-1,r=-1;for(let o=t+1;o<i;o+=e){const a=Math.abs(n[o]);a>s&&(s=a,r=o-1)}return r}function VL(n,e,t,i,s=FL){const r=n[t],o=n[i-e];if(Math.abs(r-o)>180){const a=na(n,0,e,t);a[0]+=Math.round((o-r)/360)*360,ai(n,a),a[1]=Math.sign(a[1])*s,ai(n,a),a[0]=r,ai(n,a)}}function Av(n,e,t,i){let s=n[0],r;for(let o=t;o<i;o+=e){r=n[o];const a=r-s;(a>180||a<-180)&&(r-=Math.round(a/360)*360),n[o]=s=r}}function uv(n,e){let t;const i=n.length/e;for(let r=0;r<i&&(t=n[r*e],(t+180)%360===0);r++);const s=-Math.round(t/360)*360;if(s!==0)for(let r=0;r<i;r++)n[r*e]+=s}class zL extends un{constructor(e){const{indices:t,attributes:i}=HL(e);super({...e,indices:t,attributes:i})}}function HL(n){const{radius:e,height:t=1,nradial:i=10}=n;let{vertices:s}=n;s&&(ze.assert(s.length>=i),s=s.flatMap(T=>[T[0],T[1]]),_d(s,md.COUNTER_CLOCKWISE));const r=t>0,o=i+1,a=r?o*3+1:i,l=Math.PI*2/i,f=new Uint16Array(r?i*3*2:0),g=new Float32Array(a*3),_=new Float32Array(a*3);let v=0;if(r){for(let T=0;T<o;T++){const C=T*l,S=T%i,R=Math.sin(C),P=Math.cos(C);for(let F=0;F<2;F++)g[v+0]=s?s[S*2]:P*e,g[v+1]=s?s[S*2+1]:R*e,g[v+2]=(1/2-F)*t,_[v+0]=s?s[S*2]:P,_[v+1]=s?s[S*2+1]:R,v+=3}g[v+0]=g[v-3],g[v+1]=g[v-2],g[v+2]=g[v-1],v+=3}for(let T=r?0:1;T<o;T++){const C=Math.floor(T/2)*Math.sign(.5-T%2),S=C*l,R=(C+i)%i,P=Math.sin(S),F=Math.cos(S);g[v+0]=s?s[R*2]:F*e,g[v+1]=s?s[R*2+1]:P*e,g[v+2]=t/2,_[v+2]=1,v+=3}if(r){let T=0;for(let C=0;C<i;C++)f[T++]=C*2+0,f[T++]=C*2+2,f[T++]=C*2+0,f[T++]=C*2+1,f[T++]=C*2+1,f[T++]=C*2+3}return{indices:f,attributes:{POSITION:{size:3,value:g},NORMAL:{size:3,value:_}}}}const dm=`uniform columnUniforms {
  float radius;
  float angle;
  vec2 offset;
  bool extruded;
  bool stroked;
  bool isStroke;
  float coverage;
  float elevationScale;
  float edgeDistance;
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  highp int radiusUnits;
  highp int widthUnits;
} column;
`,WL={name:"column",vs:dm,fs:dm,uniformTypes:{radius:"f32",angle:"f32",offset:"vec2<f32>",extruded:"f32",stroked:"f32",isStroke:"f32",coverage:"f32",elevationScale:"f32",edgeDistance:"f32",widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",radiusUnits:"i32",widthUnits:"i32"}},jL=`#version 300 es
#define SHADER_NAME column-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec3 instancePositions;
in float instanceElevations;
in vec3 instancePositions64Low;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in float instanceStrokeWidths;
in vec3 instancePickingColors;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec3 cameraPosition;
out vec4 position_commonspace;
#endif
void main(void) {
geometry.worldPosition = instancePositions;
vec4 color = column.isStroke ? instanceLineColors : instanceFillColors;
mat2 rotationMatrix = mat2(cos(column.angle), sin(column.angle), -sin(column.angle), cos(column.angle));
float elevation = 0.0;
float strokeOffsetRatio = 1.0;
if (column.extruded) {
elevation = instanceElevations * (positions.z + 1.0) / 2.0 * column.elevationScale;
} else if (column.stroked) {
float widthPixels = clamp(
project_size_to_pixel(instanceStrokeWidths * column.widthScale, column.widthUnits),
column.widthMinPixels, column.widthMaxPixels) / 2.0;
float halfOffset = project_pixel_size(widthPixels) / project_size(column.edgeDistance * column.coverage * column.radius);
if (column.isStroke) {
strokeOffsetRatio -= sign(positions.z) * halfOffset;
} else {
strokeOffsetRatio -= halfOffset;
}
}
float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
float dotRadius = column.radius * column.coverage * shouldRender;
geometry.pickingColor = instancePickingColors;
vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);
vec3 centroidPosition64Low = instancePositions64Low;
vec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + column.offset) * dotRadius;
if (column.radiusUnits == UNIT_METERS) {
offset = project_size(offset);
}
vec3 pos = vec3(offset, 0.);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (column.extruded && !column.isStroke) {
#ifdef FLAT_SHADING
cameraPosition = project.cameraPosition;
position_commonspace = geometry.position;
vColor = vec4(color.rgb, color.a * layer.opacity);
#else
vec3 lightColor = lighting_getLightColor(color.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, color.a * layer.opacity);
#endif
} else {
vColor = vec4(color.rgb, color.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,$L=`#version 300 es
#define SHADER_NAME column-layer-fragment-shader
precision highp float;
out vec4 fragColor;
in vec4 vColor;
#ifdef FLAT_SHADING
in vec3 cameraPosition;
in vec4 position_commonspace;
#endif
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
#ifdef FLAT_SHADING
if (column.extruded && !column.isStroke && !bool(picking.isActive)) {
vec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
fragColor.rgb = lighting_getLightColor(vColor.rgb, cameraPosition, position_commonspace.xyz, normal);
}
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,dc=[0,0,0,255],XL={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,flatShading:!1,getPosition:{type:"accessor",value:n=>n.position},getFillColor:{type:"accessor",value:dc},getLineColor:{type:"accessor",value:dc},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class lo extends rn{getShaders(){const e={},{flatShading:t}=this.props;return t&&(e.FLAT_SHADING=1),super.getShaders({vs:jL,fs:$L,defines:e,modules:[sn,t?Kf:Kc,Un,WL]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getFillColor",defaultValue:dc},instanceLineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getLineColor",defaultValue:dc},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState(e){var a;super.updateState(e);const{props:t,oldProps:i,changeFlags:s}=e,r=s.extensionsChanged||t.flatShading!==i.flatShading;r&&((a=this.state.models)==null||a.forEach(l=>l.destroy()),this.setState(this._getModels()),this.getAttributeManager().invalidateAll());const o=this.getNumInstances();this.state.fillModel.setInstanceCount(o),this.state.wireframeModel.setInstanceCount(o),(r||t.diskResolution!==i.diskResolution||t.vertices!==i.vertices||(t.extruded||t.stroked)!==(i.extruded||i.stroked))&&this._updateGeometry(t)}getGeometry(e,t,i){const s=new zL({radius:1,height:i?2:0,vertices:t,nradial:e});let r=0;if(t)for(let o=0;o<e;o++){const a=t[o],l=Math.sqrt(a[0]*a[0]+a[1]*a[1]);r+=l/e}else r=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*r}),s}_getModels(){const e=this.getShaders(),t=this.getAttributeManager().getBufferLayouts(),i=new Nt(this.context.device,{...e,id:`${this.props.id}-fill`,bufferLayout:t,isInstanced:!0}),s=new Nt(this.context.device,{...e,id:`${this.props.id}-wireframe`,bufferLayout:t,isInstanced:!0});return{fillModel:i,wireframeModel:s,models:[s,i]}}_updateGeometry({diskResolution:e,vertices:t,extruded:i,stroked:s}){const r=this.getGeometry(e,t,i||s);this.setState({fillVertexCount:r.attributes.POSITION.value.length/3});const o=this.state.fillModel,a=this.state.wireframeModel;o.setGeometry(r),o.setTopology("triangle-strip"),o.setIndexBuffer(null),a.setGeometry(r),a.setTopology("line-list")}draw({uniforms:e}){const{lineWidthUnits:t,lineWidthScale:i,lineWidthMinPixels:s,lineWidthMaxPixels:r,radiusUnits:o,elevationScale:a,extruded:l,filled:f,stroked:g,wireframe:_,offset:v,coverage:T,radius:C,angle:S}=this.props,R=this.state.fillModel,P=this.state.wireframeModel,{fillVertexCount:F,edgeDistance:U}=this.state,X={radius:C,angle:S/180*Math.PI,offset:v,extruded:l,stroked:g,coverage:T,elevationScale:a,edgeDistance:U,radiusUnits:kn[o],widthUnits:kn[t],widthScale:i,widthMinPixels:s,widthMaxPixels:r};l&&_&&(P.shaderInputs.setProps({column:{...X,isStroke:!0}}),P.draw(this.context.renderPass)),f&&(R.setVertexCount(F),R.shaderInputs.setProps({column:{...X,isStroke:!1}}),R.draw(this.context.renderPass)),!l&&g&&(R.setVertexCount(F*2/3),R.shaderInputs.setProps({column:{...X,isStroke:!0}}),R.draw(this.context.renderPass))}}lo.layerName="ColumnLayer";lo.defaultProps=XL;const QL={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",value:[1,1]}};let hv=class extends lo{_updateGeometry(){const e=new _b;this.state.fillModel.setGeometry(e)}draw({uniforms:e}){const{elevationScale:t,extruded:i,offset:s,coverage:r,cellSize:o,angle:a,radiusUnits:l}=this.props,f=this.state.fillModel,g={radius:o/2,radiusUnits:kn[l],angle:a,offset:s,extruded:i,stroked:!1,coverage:r,elevationScale:t,edgeDistance:1,isStroke:!1,widthUnits:0,widthScale:0,widthMinPixels:0,widthMaxPixels:0};f.shaderInputs.setProps({column:g}),f.draw(this.context.renderPass)}};hv.layerName="GridCellLayer";hv.defaultProps=QL;function YL(n,e,t,i){let s;if(Array.isArray(n[0])){const r=n.length*e;s=new Array(r);for(let o=0;o<n.length;o++)for(let a=0;a<e;a++)s[o*e+a]=n[o][a]||0}else s=n;return t?av(s,{size:e,gridResolution:t}):i?LL(s,{size:e}):s}const KL=1,qL=2,Iu=4;class JL extends tv{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?YL(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(gm(e)){let i=0;for(const s of e)i+=this.getGeometrySize(s);return i}const t=this.getPathLength(e);return t<2?0:this.isClosed(e)?t<3?0:t+2:t}updateGeometryAttributes(e,t){if(t.geometrySize!==0)if(e&&gm(e))for(const i of e){const s=this.getGeometrySize(i);t.geometrySize=s,this.updateGeometryAttributes(i,t),t.vertexStart+=s}else this._updateSegmentTypes(e,t),this._updatePositions(e,t)}_updateSegmentTypes(e,t){const i=this.attributes.segmentTypes,s=e?this.isClosed(e):!1,{vertexStart:r,geometrySize:o}=t;i.fill(0,r,r+o),s?(i[r]=Iu,i[r+o-2]=Iu):(i[r]+=KL,i[r+o-2]+=qL),i[r+o-1]=Iu}_updatePositions(e,t){const{positions:i}=this.attributes;if(!i||!e)return;const{vertexStart:s,geometrySize:r}=t,o=new Array(3);for(let a=s,l=0;l<r;a++,l++)this.getPointOnPath(e,l,o),i[a*3]=o[0],i[a*3+1]=o[1],i[a*3+2]=o[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,t,i=[]){const{positionSize:s}=this;t*s>=e.length&&(t+=1-e.length/s);const r=t*s;return i[0]=e[r],i[1]=e[r+1],i[2]=s===3&&e[r+2]||0,i}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:t}=this,i=e.length-t;return e[0]===e[i]&&e[1]===e[i+1]&&(t===2||e[2]===e[i+2])}}function gm(n){return Array.isArray(n[0])}const pm=`uniform pathUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float jointType;
  float capType;
  float miterLimit;
  bool billboard;
  highp int widthUnits;
} path;
`,ZL={name:"path",vs:pm,fs:pm,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}},ek=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = path.capType;
} else {
vJointType = path.jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),
path.widthMinPixels, path.widthMaxPixels) / 2.0);
vec3 width;
if (path.billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,tk=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,fv=[0,0,0,255],nk={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:n=>n.path},getColor:{type:"accessor",value:fv},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},Ru={enter:(n,e)=>e.length?e.subarray(e.length-n.length):n};class co extends rn{getShaders(){return super.getShaders({vs:ek,fs:tk,modules:[sn,Un,ZL]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:Ru,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:Ru,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:Ru,defaultValue:fv},instancePickingColors:{size:4,type:"uint8",accessor:(i,{index:s,target:r})=>this.encodePickingColor(i&&i.__source?i.__source.index:s,r)}}),this.setState({pathTesselator:new JL({fp64:this.use64bitPositions()})})}updateState(e){var o;super.updateState(e);const{props:t,changeFlags:i}=e,s=this.getAttributeManager();if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPath)){const{pathTesselator:a}=this.state,l=t.data.attributes||{};a.updateGeometry({data:t.data,geometryBuffer:l.getPath,buffers:l,normalize:!t._pathType,loop:t._pathType==="loop",getGeometry:t.getPath,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:i.dataChanged}),this.setState({numInstances:a.instanceCount,startIndices:a.vertexStarts}),i.dataChanged||s.invalidateAll()}i.extensionsChanged&&((o=this.state.model)==null||o.destroy(),this.state.model=this._getModel(),s.invalidateAll())}getPickingInfo(e){const t=super.getPickingInfo(e),{index:i}=t,s=this.props.data;return s[0]&&s[0].__source&&(t.object=s.find(r=>r.__source.index===i)),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let i=0;i<t.length;i++)t[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:t,capRounded:i,billboard:s,miterLimit:r,widthUnits:o,widthScale:a,widthMinPixels:l,widthMaxPixels:f}=this.props,g=this.state.model,_={jointType:Number(t),capType:Number(i),billboard:s,widthUnits:kn[o],widthScale:a,miterLimit:r,widthMinPixels:l,widthMaxPixels:f};g.shaderInputs.setProps({path:_}),g.draw(this.context.renderPass)}_getModel(){const e=[0,1,2,1,4,2,1,3,4,3,5,4],t=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Nt(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new un({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(t),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateSegmentTypes(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("segmentTypes")}}co.defaultProps=nk;co.layerName="PathLayer";var Ja={exports:{}},mm;function ik(){if(mm)return Ja.exports;mm=1,Ja.exports=n,Ja.exports.default=n;function n(z,Q,W){W=W||2;var Ae=Q&&Q.length,le=Ae?Q[0]*W:z.length,he=e(z,0,le,W,!0),ge=[];if(!he||he.next===he.prev)return ge;var Ce,We,Le,Mt,wt,ht,Zt;if(Ae&&(he=l(z,Q,he,W)),z.length>80*W){Ce=Le=z[0],We=Mt=z[1];for(var Et=W;Et<le;Et+=W)wt=z[Et],ht=z[Et+1],wt<Ce&&(Ce=wt),ht<We&&(We=ht),wt>Le&&(Le=wt),ht>Mt&&(Mt=ht);Zt=Math.max(Le-Ce,Mt-We),Zt=Zt!==0?32767/Zt:0}return i(he,ge,W,Ce,We,Zt,0),ge}function e(z,Q,W,Ae,le){var he,ge;if(le===Fe(z,Q,W,Ae)>0)for(he=Q;he<W;he+=Ae)ge=fe(he,z[he],z[he+1],ge);else for(he=W-Ae;he>=Q;he-=Ae)ge=fe(he,z[he],z[he+1],ge);return ge&&X(ge,ge.next)&&(we(ge),ge=ge.next),ge}function t(z,Q){if(!z)return z;Q||(Q=z);var W=z,Ae;do if(Ae=!1,!W.steiner&&(X(W,W.next)||U(W.prev,W,W.next)===0)){if(we(W),W=Q=W.prev,W===W.next)break;Ae=!0}else W=W.next;while(Ae||W!==Q);return Q}function i(z,Q,W,Ae,le,he,ge){if(z){!ge&&he&&T(z,Ae,le,he);for(var Ce=z,We,Le;z.prev!==z.next;){if(We=z.prev,Le=z.next,he?r(z,Ae,le,he):s(z)){Q.push(We.i/W|0),Q.push(z.i/W|0),Q.push(Le.i/W|0),we(z),z=Le.next,Ce=Le.next;continue}if(z=Le,z===Ce){ge?ge===1?(z=o(t(z),Q,W),i(z,Q,W,Ae,le,he,2)):ge===2&&a(z,Q,W,Ae,le,he):i(t(z),Q,W,Ae,le,he,1);break}}}}function s(z){var Q=z.prev,W=z,Ae=z.next;if(U(Q,W,Ae)>=0)return!1;for(var le=Q.x,he=W.x,ge=Ae.x,Ce=Q.y,We=W.y,Le=Ae.y,Mt=le<he?le<ge?le:ge:he<ge?he:ge,wt=Ce<We?Ce<Le?Ce:Le:We<Le?We:Le,ht=le>he?le>ge?le:ge:he>ge?he:ge,Zt=Ce>We?Ce>Le?Ce:Le:We>Le?We:Le,Et=Ae.next;Et!==Q;){if(Et.x>=Mt&&Et.x<=ht&&Et.y>=wt&&Et.y<=Zt&&P(le,Ce,he,We,ge,Le,Et.x,Et.y)&&U(Et.prev,Et,Et.next)>=0)return!1;Et=Et.next}return!0}function r(z,Q,W,Ae){var le=z.prev,he=z,ge=z.next;if(U(le,he,ge)>=0)return!1;for(var Ce=le.x,We=he.x,Le=ge.x,Mt=le.y,wt=he.y,ht=ge.y,Zt=Ce<We?Ce<Le?Ce:Le:We<Le?We:Le,Et=Mt<wt?Mt<ht?Mt:ht:wt<ht?wt:ht,gs=Ce>We?Ce>Le?Ce:Le:We>Le?We:Le,ps=Mt>wt?Mt>ht?Mt:ht:wt>ht?wt:ht,va=S(Zt,Et,Q,W,Ae),Ta=S(gs,ps,Q,W,Ae),ft=z.prevZ,dt=z.nextZ;ft&&ft.z>=va&&dt&&dt.z<=Ta;){if(ft.x>=Zt&&ft.x<=gs&&ft.y>=Et&&ft.y<=ps&&ft!==le&&ft!==ge&&P(Ce,Mt,We,wt,Le,ht,ft.x,ft.y)&&U(ft.prev,ft,ft.next)>=0||(ft=ft.prevZ,dt.x>=Zt&&dt.x<=gs&&dt.y>=Et&&dt.y<=ps&&dt!==le&&dt!==ge&&P(Ce,Mt,We,wt,Le,ht,dt.x,dt.y)&&U(dt.prev,dt,dt.next)>=0))return!1;dt=dt.nextZ}for(;ft&&ft.z>=va;){if(ft.x>=Zt&&ft.x<=gs&&ft.y>=Et&&ft.y<=ps&&ft!==le&&ft!==ge&&P(Ce,Mt,We,wt,Le,ht,ft.x,ft.y)&&U(ft.prev,ft,ft.next)>=0)return!1;ft=ft.prevZ}for(;dt&&dt.z<=Ta;){if(dt.x>=Zt&&dt.x<=gs&&dt.y>=Et&&dt.y<=ps&&dt!==le&&dt!==ge&&P(Ce,Mt,We,wt,Le,ht,dt.x,dt.y)&&U(dt.prev,dt,dt.next)>=0)return!1;dt=dt.nextZ}return!0}function o(z,Q,W){var Ae=z;do{var le=Ae.prev,he=Ae.next.next;!X(le,he)&&Z(le,Ae,Ae.next,he)&&J(le,he)&&J(he,le)&&(Q.push(le.i/W|0),Q.push(Ae.i/W|0),Q.push(he.i/W|0),we(Ae),we(Ae.next),Ae=z=he),Ae=Ae.next}while(Ae!==z);return t(Ae)}function a(z,Q,W,Ae,le,he){var ge=z;do{for(var Ce=ge.next.next;Ce!==ge.prev;){if(ge.i!==Ce.i&&F(ge,Ce)){var We=L(ge,Ce);ge=t(ge,ge.next),We=t(We,We.next),i(ge,Q,W,Ae,le,he,0),i(We,Q,W,Ae,le,he,0);return}Ce=Ce.next}ge=ge.next}while(ge!==z)}function l(z,Q,W,Ae){var le=[],he,ge,Ce,We,Le;for(he=0,ge=Q.length;he<ge;he++)Ce=Q[he]*Ae,We=he<ge-1?Q[he+1]*Ae:z.length,Le=e(z,Ce,We,Ae,!1),Le===Le.next&&(Le.steiner=!0),le.push(R(Le));for(le.sort(f),he=0;he<le.length;he++)W=g(le[he],W);return W}function f(z,Q){return z.x-Q.x}function g(z,Q){var W=_(z,Q);if(!W)return Q;var Ae=L(W,z);return t(Ae,Ae.next),t(W,W.next)}function _(z,Q){var W=Q,Ae=z.x,le=z.y,he=-1/0,ge;do{if(le<=W.y&&le>=W.next.y&&W.next.y!==W.y){var Ce=W.x+(le-W.y)*(W.next.x-W.x)/(W.next.y-W.y);if(Ce<=Ae&&Ce>he&&(he=Ce,ge=W.x<W.next.x?W:W.next,Ce===Ae))return ge}W=W.next}while(W!==Q);if(!ge)return null;var We=ge,Le=ge.x,Mt=ge.y,wt=1/0,ht;W=ge;do Ae>=W.x&&W.x>=Le&&Ae!==W.x&&P(le<Mt?Ae:he,le,Le,Mt,le<Mt?he:Ae,le,W.x,W.y)&&(ht=Math.abs(le-W.y)/(Ae-W.x),J(W,z)&&(ht<wt||ht===wt&&(W.x>ge.x||W.x===ge.x&&v(ge,W)))&&(ge=W,wt=ht)),W=W.next;while(W!==We);return ge}function v(z,Q){return U(z.prev,z,Q.prev)<0&&U(Q.next,z,z.next)<0}function T(z,Q,W,Ae){var le=z;do le.z===0&&(le.z=S(le.x,le.y,Q,W,Ae)),le.prevZ=le.prev,le.nextZ=le.next,le=le.next;while(le!==z);le.prevZ.nextZ=null,le.prevZ=null,C(le)}function C(z){var Q,W,Ae,le,he,ge,Ce,We,Le=1;do{for(W=z,z=null,he=null,ge=0;W;){for(ge++,Ae=W,Ce=0,Q=0;Q<Le&&(Ce++,Ae=Ae.nextZ,!!Ae);Q++);for(We=Le;Ce>0||We>0&&Ae;)Ce!==0&&(We===0||!Ae||W.z<=Ae.z)?(le=W,W=W.nextZ,Ce--):(le=Ae,Ae=Ae.nextZ,We--),he?he.nextZ=le:z=le,le.prevZ=he,he=le;W=Ae}he.nextZ=null,Le*=2}while(ge>1);return z}function S(z,Q,W,Ae,le){return z=(z-W)*le|0,Q=(Q-Ae)*le|0,z=(z|z<<8)&16711935,z=(z|z<<4)&252645135,z=(z|z<<2)&858993459,z=(z|z<<1)&1431655765,Q=(Q|Q<<8)&16711935,Q=(Q|Q<<4)&252645135,Q=(Q|Q<<2)&858993459,Q=(Q|Q<<1)&1431655765,z|Q<<1}function R(z){var Q=z,W=z;do(Q.x<W.x||Q.x===W.x&&Q.y<W.y)&&(W=Q),Q=Q.next;while(Q!==z);return W}function P(z,Q,W,Ae,le,he,ge,Ce){return(le-ge)*(Q-Ce)>=(z-ge)*(he-Ce)&&(z-ge)*(Ae-Ce)>=(W-ge)*(Q-Ce)&&(W-ge)*(he-Ce)>=(le-ge)*(Ae-Ce)}function F(z,Q){return z.next.i!==Q.i&&z.prev.i!==Q.i&&!me(z,Q)&&(J(z,Q)&&J(Q,z)&&q(z,Q)&&(U(z.prev,z,Q.prev)||U(z,Q.prev,Q))||X(z,Q)&&U(z.prev,z,z.next)>0&&U(Q.prev,Q,Q.next)>0)}function U(z,Q,W){return(Q.y-z.y)*(W.x-Q.x)-(Q.x-z.x)*(W.y-Q.y)}function X(z,Q){return z.x===Q.x&&z.y===Q.y}function Z(z,Q,W,Ae){var le=Se(U(z,Q,W)),he=Se(U(z,Q,Ae)),ge=Se(U(W,Ae,z)),Ce=Se(U(W,Ae,Q));return!!(le!==he&&ge!==Ce||le===0&&se(z,W,Q)||he===0&&se(z,Ae,Q)||ge===0&&se(W,z,Ae)||Ce===0&&se(W,Q,Ae))}function se(z,Q,W){return Q.x<=Math.max(z.x,W.x)&&Q.x>=Math.min(z.x,W.x)&&Q.y<=Math.max(z.y,W.y)&&Q.y>=Math.min(z.y,W.y)}function Se(z){return z>0?1:z<0?-1:0}function me(z,Q){var W=z;do{if(W.i!==z.i&&W.next.i!==z.i&&W.i!==Q.i&&W.next.i!==Q.i&&Z(W,W.next,z,Q))return!0;W=W.next}while(W!==z);return!1}function J(z,Q){return U(z.prev,z,z.next)<0?U(z,Q,z.next)>=0&&U(z,z.prev,Q)>=0:U(z,Q,z.prev)<0||U(z,z.next,Q)<0}function q(z,Q){var W=z,Ae=!1,le=(z.x+Q.x)/2,he=(z.y+Q.y)/2;do W.y>he!=W.next.y>he&&W.next.y!==W.y&&le<(W.next.x-W.x)*(he-W.y)/(W.next.y-W.y)+W.x&&(Ae=!Ae),W=W.next;while(W!==z);return Ae}function L(z,Q){var W=new Me(z.i,z.x,z.y),Ae=new Me(Q.i,Q.x,Q.y),le=z.next,he=Q.prev;return z.next=Q,Q.prev=z,W.next=le,le.prev=W,Ae.next=W,W.prev=Ae,he.next=Ae,Ae.prev=he,Ae}function fe(z,Q,W,Ae){var le=new Me(z,Q,W);return Ae?(le.next=Ae.next,le.prev=Ae,Ae.next.prev=le,Ae.next=le):(le.prev=le,le.next=le),le}function we(z){z.next.prev=z.prev,z.prev.next=z.next,z.prevZ&&(z.prevZ.nextZ=z.nextZ),z.nextZ&&(z.nextZ.prevZ=z.prevZ)}function Me(z,Q,W){this.i=z,this.x=Q,this.y=W,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}n.deviation=function(z,Q,W,Ae){var le=Q&&Q.length,he=le?Q[0]*W:z.length,ge=Math.abs(Fe(z,0,he,W));if(le)for(var Ce=0,We=Q.length;Ce<We;Ce++){var Le=Q[Ce]*W,Mt=Ce<We-1?Q[Ce+1]*W:z.length;ge-=Math.abs(Fe(z,Le,Mt,W))}var wt=0;for(Ce=0;Ce<Ae.length;Ce+=3){var ht=Ae[Ce]*W,Zt=Ae[Ce+1]*W,Et=Ae[Ce+2]*W;wt+=Math.abs((z[ht]-z[Et])*(z[Zt+1]-z[ht+1])-(z[ht]-z[Zt])*(z[Et+1]-z[ht+1]))}return ge===0&&wt===0?0:Math.abs((wt-ge)/ge)};function Fe(z,Q,W,Ae){for(var le=0,he=Q,ge=W-Ae;he<W;he+=Ae)le+=(z[ge]-z[he])*(z[he+1]+z[ge+1]),ge=he;return le}return n.flatten=function(z){for(var Q=z[0][0].length,W={vertices:[],holes:[],dimensions:Q},Ae=0,le=0;le<z.length;le++){for(var he=0;he<z[le].length;he++)for(var ge=0;ge<Q;ge++)W.vertices.push(z[le][he][ge]);le>0&&(Ae+=z[le-1].length,W.holes.push(Ae))}return W},Ja.exports}var sk=ik();const rk=Z2(sk),Za=md.CLOCKWISE,_m=md.COUNTER_CLOCKWISE,os={};function ok(n){if(n=n&&n.positions||n,!Array.isArray(n)&&!ArrayBuffer.isView(n))throw new Error("invalid polygon")}function Uo(n){return"positions"in n?n.positions:n}function Il(n){return"holeIndices"in n?n.holeIndices:null}function ak(n){return Array.isArray(n[0])}function lk(n){return n.length>=1&&n[0].length>=2&&Number.isFinite(n[0][0])}function ck(n){const e=n[0],t=n[n.length-1];return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Ak(n,e,t,i){for(let s=0;s<e;s++)if(n[t+s]!==n[i-e+s])return!1;return!0}function ym(n,e,t,i,s){let r=e;const o=t.length;for(let a=0;a<o;a++)for(let l=0;l<i;l++)n[r++]=t[a][l]||0;if(!ck(t))for(let a=0;a<i;a++)n[r++]=t[0][a]||0;return os.start=e,os.end=r,os.size=i,_d(n,s,os),r}function bm(n,e,t,i,s=0,r,o){r=r||t.length;const a=r-s;if(a<=0)return e;let l=e;for(let f=0;f<a;f++)n[l++]=t[s+f];if(!Ak(t,i,s,r))for(let f=0;f<i;f++)n[l++]=t[s+f];return os.start=e,os.end=l,os.size=i,_d(n,o,os),l}function dv(n,e){ok(n);const t=[],i=[];if("positions"in n){const{positions:s,holeIndices:r}=n;if(r){let o=0;for(let a=0;a<=r.length;a++)o=bm(t,o,s,e,r[a-1],r[a],a===0?Za:_m),i.push(o);return i.pop(),{positions:t,holeIndices:i}}n=s}if(!ak(n))return bm(t,0,n,e,0,t.length,Za),t;if(!lk(n)){let s=0;for(const[r,o]of n.entries())s=ym(t,s,o,e,r===0?Za:_m),i.push(s);return i.pop(),{positions:t,holeIndices:i}}return ym(t,0,n,e,Za),t}function Pu(n,e,t){const i=n.length/3;let s=0;for(let r=0;r<i;r++){const o=(r+1)%i;s+=n[r*3+e]*n[o*3+t],s-=n[o*3+e]*n[r*3+t]}return Math.abs(s/2)}function vm(n,e,t,i){const s=n.length/3;for(let r=0;r<s;r++){const o=r*3,a=n[o+0],l=n[o+1],f=n[o+2];n[o+e]=a,n[o+t]=l,n[o+i]=f}}function uk(n,e,t,i){let s=Il(n);s&&(s=s.map(a=>a/e));let r=Uo(n);const o=i&&e===3;if(t){const a=r.length;r=r.slice();const l=[];for(let f=0;f<a;f+=e){l[0]=r[f],l[1]=r[f+1],o&&(l[2]=r[f+2]);const g=t(l);r[f]=g[0],r[f+1]=g[1],o&&(r[f+2]=g[2])}}if(o){const a=Pu(r,0,1),l=Pu(r,0,2),f=Pu(r,1,2);if(!a&&!l&&!f)return[];a>l&&a>f||(l>f?(t||(r=r.slice()),vm(r,0,2,1)):(t||(r=r.slice()),vm(r,2,0,1)))}return rk(r,s,e)}class hk extends tv{constructor(e){const{fp64:t,IndexType:i=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:t?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:i,size:1}}})}get(e){const{attributes:t}=this;return e==="indices"?t.indices&&t.indices.subarray(0,this.vertexCount):t[e]}updateGeometry(e){super.updateGeometry(e);const t=this.buffers.indices;if(t)this.vertexCount=(t.value||t).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const t=dv(e,this.positionSize);return this.opts.resolution?lv(Uo(t),Il(t),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?kL(Uo(t),Il(t),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):t}return e}getGeometrySize(e){if(Tm(e)){let t=0;for(const i of e)t+=this.getGeometrySize(i);return t}return Uo(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,t){if(e&&Tm(e))for(const i of e){const s=this.getGeometrySize(i);t.geometrySize=s,this.updateGeometryAttributes(i,t),t.vertexStart+=s,t.indexStart=this.indexStarts[t.geometryIndex+1]}else{const i=e;this._updateIndices(i,t),this._updatePositions(i,t),this._updateVertexValid(i,t)}}_updateIndices(e,{geometryIndex:t,vertexStart:i,indexStart:s}){const{attributes:r,indexStarts:o,typedArrayManager:a}=this;let l=r.indices;if(!l||!e)return;let f=s;const g=uk(e,this.positionSize,this.opts.preproject,this.opts.full3d);l=a.allocate(l,s+g.length,{copy:!0});for(let _=0;_<g.length;_++)l[f++]=g[_]+i;o[t+1]=s+g.length,r.indices=l}_updatePositions(e,{vertexStart:t,geometrySize:i}){const{attributes:{positions:s},positionSize:r}=this;if(!s||!e)return;const o=Uo(e);for(let a=t,l=0;l<i;a++,l++){const f=o[l*r],g=o[l*r+1],_=r>2?o[l*r+2]:0;s[a*3]=f,s[a*3+1]=g,s[a*3+2]=_}}_updateVertexValid(e,{vertexStart:t,geometrySize:i}){const{positionSize:s}=this,r=this.attributes.vertexValid,o=e&&Il(e);if(e&&e.edgeTypes?r.set(e.edgeTypes,t):r.fill(1,t,t+i),o)for(let a=0;a<o.length;a++)r[t+o[a]/s-1]=0;r[t+i-1]=0}}function Tm(n){return Array.isArray(n)&&n.length>0&&!Number.isFinite(n[0])}const wm=`uniform solidPolygonUniforms {
  bool extruded;
  bool isWireframe;
  float elevationScale;
} solidPolygon;
`,fk={name:"solidPolygon",vs:wm,fs:wm,uniformTypes:{extruded:"f32",isWireframe:"f32",elevationScale:"f32"}},gv=`in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project.commonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = solidPolygon.isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (solidPolygon.extruded) {
pos.z += props.elevations * solidPolygon.elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (solidPolygon.extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * layer.opacity);
} else {
vColor = vec4(colors.rgb, colors.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,dk=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${gv}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,gk=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${gv}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`,pk=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,gc=[0,0,0,255],mk={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:n=>n.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:gc},getLineColor:{type:"accessor",value:gc},material:!0},el={enter:(n,e)=>e.length?e.subarray(e.length-n.length):n};class da extends rn{getShaders(e){return super.getShaders({vs:e==="top"?dk:gk,fs:pk,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[sn,Kc,Un,fk]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:t}=this.props;const{_full3d:i}=this.props;e.isGeospatial&&t===Ue.DEFAULT&&(t=Ue.LNGLAT);let s;t===Ue.LNGLAT&&(i?s=e.projectPosition.bind(e):s=e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new hk({preproject:s,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const r=this.getAttributeManager(),o=!0;r.remove(["instancePickingColors"]),r.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:o},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:el,accessor:"getPolygon",update:this.calculatePositions,noAlloc:o,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:o},elevations:{size:1,stepMode:"dynamic",transition:el,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:el,accessor:"getFillColor",defaultValue:gc},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:el,accessor:"getLineColor",defaultValue:gc},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(a,{index:l,target:f})=>this.encodePickingColor(a&&a.__source?a.__source.index:l,f)}})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:i}=t,s=this.props.data;return s[0]&&s[0].__source&&(t.object=s.find(r=>r.__source.index===i)),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let i=0;i<t.length;i++)t[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:t,filled:i,wireframe:s,elevationScale:r}=this.props,{topModel:o,sideModel:a,wireframeModel:l,polygonTesselator:f}=this.state,g={extruded:!!t,elevationScale:r,isWireframe:!1};l&&s&&(l.setInstanceCount(f.instanceCount-1),l.shaderInputs.setProps({solidPolygon:{...g,isWireframe:!0}}),l.draw(this.context.renderPass)),a&&i&&(a.setInstanceCount(f.instanceCount-1),a.shaderInputs.setProps({solidPolygon:g}),a.draw(this.context.renderPass)),o&&i&&(o.setVertexCount(f.vertexCount),o.shaderInputs.setProps({solidPolygon:g}),o.draw(this.context.renderPass))}updateState(e){var a;super.updateState(e),this.updateGeometry(e);const{props:t,oldProps:i,changeFlags:s}=e,r=this.getAttributeManager();(s.extensionsChanged||t.filled!==i.filled||t.extruded!==i.extruded)&&((a=this.state.models)==null||a.forEach(l=>l.destroy()),this.setState(this._getModels()),r.invalidateAll())}updateGeometry({props:e,oldProps:t,changeFlags:i}){if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPolygon)){const{polygonTesselator:r}=this.state,o=e.data.attributes||{};r.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:o.getPolygon,buffers:o,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:i.dataChanged,full3d:e._full3d}),this.setState({numInstances:r.instanceCount,startIndices:r.vertexStarts}),i.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:t,extruded:i}=this.props;let s,r,o;if(t){const a=this.getShaders("top");a.defines.NON_INSTANCED_MODEL=1;const l=this.getAttributeManager().getBufferLayouts({isInstanced:!1});s=new Nt(this.context.device,{...a,id:`${e}-top`,topology:"triangle-list",bufferLayout:l,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(i){const a=this.getAttributeManager().getBufferLayouts({isInstanced:!0});r=new Nt(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:a,geometry:new un({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),o=new Nt(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:a,geometry:new un({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[r,o,s].filter(Boolean),topModel:s,sideModel:r,wireframeModel:o}}calculateIndices(e){const{polygonTesselator:t}=this.state;e.startIndices=t.indexStarts,e.value=t.get("indices")}calculatePositions(e){const{polygonTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}da.defaultProps=mk;da.layerName="SolidPolygonLayer";function pv({data:n,getIndex:e,dataRange:t,replace:i}){const{startRow:s=0,endRow:r=1/0}=t,o=n.length;let a=o,l=o;for(let v=0;v<o;v++){const T=e(n[v]);if(a>v&&T>=s&&(a=v),T>=r){l=v;break}}let f=a;const _=l-a!==i.length?n.slice(l):void 0;for(let v=0;v<i.length;v++)n[f++]=i[v];if(_){for(let v=0;v<_.length;v++)n[f++]=_[v];n.length=f}return{startRow:a,endRow:a+i.length}}const mv=[0,0,0,255],_k=[0,0,0,255],yk={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:n=>n.polygon},getFillColor:{type:"accessor",value:_k},getLineColor:{type:"accessor",value:mv},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class Ao extends gi{initializeState(){this.state={paths:[],pathsDiff:null},this.props.getLineDashArray&&ze.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:e}){const t=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getPolygon);if(t&&Array.isArray(e.dataChanged)){const i=this.state.paths.slice(),s=e.dataChanged.map(r=>pv({data:i,getIndex:o=>o.__source.index,dataRange:r,replace:this._getPaths(r)}));this.setState({paths:i,pathsDiff:s})}else t&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e={}){const{data:t,getPolygon:i,positionFormat:s,_normalize:r}=this.props,o=[],a=s==="XY"?2:3,{startRow:l,endRow:f}=e,{iterable:g,objectInfo:_}=Ri(t,l,f);for(const v of g){_.index++;let T=i(v,_);r&&(T=dv(T,a));const{holeIndices:C}=T,S=T.positions||T;if(C)for(let R=0;R<=C.length;R++){const P=S.slice(C[R-1]||0,C[R]||S.length);o.push(this.getSubLayerRow({path:P},v,_.index))}else o.push(this.getSubLayerRow({path:S},v,_.index))}return o}renderLayers(){const{data:e,_dataDiff:t,stroked:i,filled:s,extruded:r,wireframe:o,_normalize:a,_windingOrder:l,elevationScale:f,transitions:g,positionFormat:_}=this.props,{lineWidthUnits:v,lineWidthScale:T,lineWidthMinPixels:C,lineWidthMaxPixels:S,lineJointRounded:R,lineMiterLimit:P,lineDashJustified:F}=this.props,{getFillColor:U,getLineColor:X,getLineWidth:Z,getLineDashArray:se,getElevation:Se,getPolygon:me,updateTriggers:J,material:q}=this.props,{paths:L,pathsDiff:fe}=this.state,we=this.getSubLayerClass("fill",da),Me=this.getSubLayerClass("stroke",co),Fe=this.shouldRenderSubLayer("fill",L)&&new we({_dataDiff:t,extruded:r,elevationScale:f,filled:s,wireframe:o,_normalize:a,_windingOrder:l,getElevation:Se,getFillColor:U,getLineColor:r&&o?X:mv,material:q,transitions:g},this.getSubLayerProps({id:"fill",updateTriggers:J&&{getPolygon:J.getPolygon,getElevation:J.getElevation,getFillColor:J.getFillColor,lineColors:r&&o,getLineColor:J.getLineColor}}),{data:e,positionFormat:_,getPolygon:me}),z=!r&&i&&this.shouldRenderSubLayer("stroke",L)&&new Me({_dataDiff:fe&&(()=>fe),widthUnits:v,widthScale:T,widthMinPixels:C,widthMaxPixels:S,jointRounded:R,miterLimit:P,dashJustified:F,_pathType:"loop",transitions:g&&{getWidth:g.getLineWidth,getColor:g.getLineColor,getPath:g.getPolygon},getColor:this.getSubLayerAccessor(X),getWidth:this.getSubLayerAccessor(Z),getDashArray:this.getSubLayerAccessor(se)},this.getSubLayerProps({id:"stroke",updateTriggers:J&&{getWidth:J.getLineWidth,getColor:J.getLineColor,getDashArray:J.getLineDashArray}}),{data:L,positionFormat:_,getPath:Q=>Q.path});return[!r&&Fe,z,r&&Fe]}}Ao.layerName="PolygonLayer";Ao.defaultProps=yk;function bk(n,e){if(!n)return null;const t="startIndices"in n?n.startIndices[e]:e,i=n.featureIds.value[t];return t!==-1?vk(n,i,t):null}function vk(n,e,t){const i={properties:{...n.properties[e]}};for(const s in n.numericProps)i.properties[s]=n.numericProps[s].value[t];return i}function Tk(n,e){const t={points:null,lines:null,polygons:null};for(const i in t){const s=n[i].globalFeatureIds.value;t[i]=new Uint8ClampedArray(s.length*4);const r=[];for(let o=0;o<s.length;o++)e(s[o],r),t[i][o*4+0]=r[0],t[i][o*4+1]=r[1],t[i][o*4+2]=r[2],t[i][o*4+3]=255}return t}const Em=`uniform sdfUniforms {
  float gamma;
  bool enabled;
  float buffer;
  float outlineBuffer;
  vec4 outlineColor;
} sdf;
`,wk={name:"sdf",vs:Em,fs:Em,uniformTypes:{gamma:"f32",enabled:"f32",buffer:"f32",outlineBuffer:"f32",outlineColor:"vec4<f32>"}},Ek=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf.enabled) {
float distance = alpha;
alpha = smoothstep(sdf.buffer - sdf.gamma, sdf.buffer + sdf.gamma, distance);
if (sdf.outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(sdf.outlineBuffer - sdf.gamma, sdf.outlineBuffer + sdf.gamma, distance);
color = mix(sdf.outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * layer.opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Mu=192/256,xm=[],xk={getIconOffsets:{type:"accessor",value:n=>n.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class yd extends iA{getShaders(){const e=super.getShaders();return{...e,modules:[...e.modules,wk],fs:Ek}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(t,{index:i,target:s})=>this.encodePickingColor(i,s)}})}updateState(e){super.updateState(e);const{props:t,oldProps:i}=e;let{outlineColor:s}=t;s!==i.outlineColor&&(s=s.map(r=>r/255),s[3]=Number.isFinite(s[3])?s[3]:1,this.setState({outlineColor:s})),!t.sdf&&t.outlineWidth&&ze.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){const{sdf:t,smoothing:i,outlineWidth:s}=this.props,{outlineColor:r}=this.state,o=s?Math.max(i,Mu*(1-s)):-1,a=this.state.model,l={buffer:Mu,outlineBuffer:o,gamma:i,enabled:!!t,outlineColor:r};if(a.shaderInputs.setProps({sdf:l}),super.draw(e),t&&s){const{iconManager:f}=this.state;f.getTexture()&&(a.shaderInputs.setProps({sdf:{...l,outlineBuffer:Mu}}),a.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(t=>super.getInstanceOffset(t)):xm}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(t=>super.getInstanceIconFrame(t)):xm}}yd.defaultProps=xk;yd.layerName="MultiIconLayer";const pc=1e20;class Ck{constructor({fontSize:e=24,buffer:t=3,radius:i=8,cutoff:s=.25,fontFamily:r="sans-serif",fontWeight:o="normal",fontStyle:a="normal"}={}){this.buffer=t,this.cutoff=s,this.radius=i;const l=this.size=e+t*4,f=this._createCanvas(l),g=this.ctx=f.getContext("2d",{willReadFrequently:!0});g.font=`${a} ${o} ${e}px ${r}`,g.textBaseline="alphabetic",g.textAlign="left",g.fillStyle="black",this.gridOuter=new Float64Array(l*l),this.gridInner=new Float64Array(l*l),this.f=new Float64Array(l),this.z=new Float64Array(l+1),this.v=new Uint16Array(l)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:i,actualBoundingBoxDescent:s,actualBoundingBoxLeft:r,actualBoundingBoxRight:o}=this.ctx.measureText(e),a=Math.ceil(i),l=0,f=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-r))),g=Math.min(this.size-this.buffer,a+Math.ceil(s)),_=f+2*this.buffer,v=g+2*this.buffer,T=Math.max(_*v,0),C=new Uint8ClampedArray(T),S={data:C,width:_,height:v,glyphWidth:f,glyphHeight:g,glyphTop:a,glyphLeft:l,glyphAdvance:t};if(f===0||g===0)return S;const{ctx:R,buffer:P,gridInner:F,gridOuter:U}=this;R.clearRect(P,P,f,g),R.fillText(e,P,P+a);const X=R.getImageData(P,P,f,g);U.fill(pc,0,T),F.fill(0,0,T);for(let Z=0;Z<g;Z++)for(let se=0;se<f;se++){const Se=X.data[4*(Z*f+se)+3]/255;if(Se===0)continue;const me=(Z+P)*_+se+P;if(Se===1)U[me]=0,F[me]=pc;else{const J=.5-Se;U[me]=J>0?J*J:0,F[me]=J<0?J*J:0}}Cm(U,0,0,_,v,_,this.f,this.v,this.z),Cm(F,P,P,f,g,_,this.f,this.v,this.z);for(let Z=0;Z<T;Z++){const se=Math.sqrt(U[Z])-Math.sqrt(F[Z]);C[Z]=Math.round(255-255*(se/this.radius+this.cutoff))}return S}}function Cm(n,e,t,i,s,r,o,a,l){for(let f=e;f<e+i;f++)Sm(n,t*r+f,r,s,o,a,l);for(let f=t;f<t+s;f++)Sm(n,f*r+e,1,i,o,a,l)}function Sm(n,e,t,i,s,r,o){r[0]=0,o[0]=-1e20,o[1]=pc,s[0]=n[e];for(let a=1,l=0,f=0;a<i;a++){s[a]=n[e+a*t];const g=a*a;do{const _=r[l];f=(s[a]-s[_]+g-_*_)/(a-_)/2}while(f<=o[l]&&--l>-1);l++,r[l]=a,o[l]=f,o[l+1]=pc}for(let a=0,l=0;a<i;a++){for(;o[l+1]<a;)l++;const f=r[l],g=a-f;n[e+a*t]=s[f]+g*g}}const Sk=32,Ik=[];function Rk(n){return Math.pow(2,Math.ceil(Math.log2(n)))}function Pk({characterSet:n,getFontWidth:e,fontHeight:t,buffer:i,maxCanvasWidth:s,mapping:r={},xOffset:o=0,yOffset:a=0}){let l=0,f=o;const g=t+i*2;for(const _ of n)if(!r[_]){const v=e(_);f+v+i*2>s&&(f=0,l++),r[_]={x:f+i,y:a+l*g+i,width:v,height:g,layoutWidth:v,layoutHeight:t},f+=v+i*2}return{mapping:r,xOffset:f,yOffset:a+l*g,canvasHeight:Rk(a+(l+1)*g)}}function _v(n,e,t,i){var r;let s=0;for(let o=e;o<t;o++){const a=n[o];s+=((r=i[a])==null?void 0:r.layoutWidth)||0}return s}function yv(n,e,t,i,s,r){let o=e,a=0;for(let l=e;l<t;l++){const f=_v(n,l,l+1,s);a+f>i&&(o<l&&r.push(l),o=l,a=0),a+=f}return a}function Mk(n,e,t,i,s,r){let o=e,a=e,l=e,f=0;for(let g=e;g<t;g++)if((n[g]===" "||n[g+1]===" "||g+1===t)&&(l=g+1),l>a){let _=_v(n,a,l,s);f+_>i&&(o<a&&(r.push(a),o=a,f=0),_>i&&(_=yv(n,a,l,i,s,r),o=r[r.length-1])),a=l,f+=_}return f}function Bk(n,e,t,i,s=0,r){r===void 0&&(r=n.length);const o=[];return e==="break-all"?yv(n,s,r,t,i,o):Mk(n,s,r,t,i,o),o}function Ok(n,e,t,i,s,r){let o=0,a=0;for(let l=e;l<t;l++){const f=n[l],g=i[f];g?(a||(a=g.layoutHeight),s[l]=o+g.layoutWidth/2,o+=g.layoutWidth):(ze.warn(`Missing character: ${f} (${f.codePointAt(0)})`)(),s[l]=o,o+=Sk)}r[0]=o,r[1]=a}function Dk(n,e,t,i,s){var R;const r=Array.from(n),o=r.length,a=new Array(o),l=new Array(o),f=new Array(o),g=(t==="break-word"||t==="break-all")&&isFinite(i)&&i>0,_=[0,0],v=[0,0];let T=0,C=0,S=0;for(let P=0;P<=o;P++){const F=r[P];if((F===`
`||P===o)&&(S=P),S>C){const U=g?Bk(r,t,i,s,C,S):Ik;for(let X=0;X<=U.length;X++){const Z=X===0?C:U[X-1],se=X<U.length?U[X]:S;Ok(r,Z,se,s,a,v);for(let Se=Z;Se<se;Se++){const me=r[Se],J=((R=s[me])==null?void 0:R.layoutOffsetY)||0;l[Se]=T+v[1]/2+J,f[Se]=v[0]}T=T+v[1]*e,_[0]=Math.max(_[0],v[0])}C=S}F===`
`&&(a[C]=0,l[C]=0,f[C]=0,C++)}return _[1]=T,{x:a,y:l,rowWidth:f,size:_}}function Nk({value:n,length:e,stride:t,offset:i,startIndices:s,characterSet:r}){const o=n.BYTES_PER_ELEMENT,a=t?t/o:1,l=i?i/o:0,f=s[e]||Math.ceil((n.length-l)/a),g=r&&new Set,_=new Array(e);let v=n;if(a>1||l>0){const T=n.constructor;v=new T(f);for(let C=0;C<f;C++)v[C]=n[C*a+l]}for(let T=0;T<e;T++){const C=s[T],S=s[T+1]||f,R=v.subarray(C,S);_[T]=String.fromCodePoint.apply(null,R),g&&R.forEach(g.add,g)}if(g)for(const T of g)r.add(String.fromCodePoint(T));return{texts:_,characterCount:f}}class bv{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){const t=this._cache[e];return t&&(this._deleteOrder(e),this._appendOrder(e)),t}set(e,t){this._cache[e]?(this.delete(e),this._cache[e]=t,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=t,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const t=this._order.indexOf(e);t>=0&&this._order.splice(t,1)}_appendOrder(e){this._order.push(e)}}function Fk(){const n=[];for(let e=32;e<128;e++)n.push(String.fromCharCode(e));return n}const Gr={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:Fk(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},Im=1024,Rm=.9,Pm=1.2,vv=3;let mc=new bv(vv);function Lk(n,e){let t;typeof e=="string"?t=new Set(Array.from(e)):t=new Set(e);const i=mc.get(n);if(!i)return t;for(const s in i.mapping)t.has(s)&&t.delete(s);return t}function kk(n,e){for(let t=0;t<n.length;t++)e.data[4*t+3]=n[t]}function Mm(n,e,t,i){n.font=`${i} ${t}px ${e}`,n.fillStyle="#000",n.textBaseline="alphabetic",n.textAlign="left"}function Uk(n){ze.assert(Number.isFinite(n)&&n>=vv,"Invalid cache limit"),mc=new bv(n)}class Vk{constructor(){this.props={...Gr}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:t}=this.props;return(e*Pm+t*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const t=Lk(this._key,this.props.characterSet),i=mc.get(this._key);if(i&&t.size===0){this._atlas!==i&&(this._atlas=i);return}const s=this._generateFontAtlas(t,i);this._atlas=s,mc.set(this._key,s)}_generateFontAtlas(e,t){const{fontFamily:i,fontWeight:s,fontSize:r,buffer:o,sdf:a,radius:l,cutoff:f}=this.props;let g=t&&t.data;g||(g=document.createElement("canvas"),g.width=Im);const _=g.getContext("2d",{willReadFrequently:!0});Mm(_,i,r,s);const{mapping:v,canvasHeight:T,xOffset:C,yOffset:S}=Pk({getFontWidth:R=>_.measureText(R).width,fontHeight:r*Pm,buffer:o,characterSet:e,maxCanvasWidth:Im,...t&&{mapping:t.mapping,xOffset:t.xOffset,yOffset:t.yOffset}});if(g.height!==T){const R=_.getImageData(0,0,g.width,g.height);g.height=T,_.putImageData(R,0,0)}if(Mm(_,i,r,s),a){const R=new Ck({fontSize:r,buffer:o,radius:l,cutoff:f,fontFamily:i,fontWeight:`${s}`});for(const P of e){const{data:F,width:U,height:X,glyphTop:Z}=R.draw(P);v[P].width=U,v[P].layoutOffsetY=r*Rm-Z;const se=_.createImageData(U,X);kk(F,se),_.putImageData(se,v[P].x,v[P].y)}}else for(const R of e)_.fillText(R,v[R].x,v[R].y+o+r*Rm);return{xOffset:C,yOffset:S,mapping:v,data:g,width:g.width,height:g.height}}_getKey(){const{fontFamily:e,fontWeight:t,fontSize:i,buffer:s,sdf:r,radius:o,cutoff:a}=this.props;return r?`${e} ${t} ${i} ${s} ${o} ${a}`:`${e} ${t} ${i} ${s}`}}const Bm=`uniform textBackgroundUniforms {
  bool billboard;
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  vec4 padding;
  highp int sizeUnits;
  bool stroked;
} textBackground;
`,zk={name:"textBackground",vs:Bm,fs:Bm,uniformTypes:{billboard:"f32",sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",padding:"vec4<f32>",sizeUnits:"i32",stroked:"f32"}},Hk=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * textBackground.sizeScale, textBackground.sizeUnits),
textBackground.sizeMinPixels, textBackground.sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + textBackground.padding.xy + textBackground.padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-textBackground.padding.xy, textBackground.padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (textBackground.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,Gk=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec2 pixelPosition = uv * dimensions;
if (textBackground.stroked) {
float distToEdge = min(
min(pixelPosition.x, dimensions.x - pixelPosition.x),
min(pixelPosition.y, dimensions.y - pixelPosition.y)
);
float isBorder = smoothedge(distToEdge, vLineWidth);
fragColor = mix(vFillColor, vLineColor, isBorder);
} else {
fragColor = vFillColor;
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Wk={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:n=>n.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class bd extends rn{getShaders(){return super.getShaders({vs:Hk,fs:Gk,modules:[sn,Un,zk]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var i;super.updateState(e);const{changeFlags:t}=e;t.extensionsChanged&&((i=this.state.model)==null||i.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{billboard:t,sizeScale:i,sizeUnits:s,sizeMinPixels:r,sizeMaxPixels:o,getLineWidth:a}=this.props;let{padding:l}=this.props;l.length<4&&(l=[l[0],l[1],l[0],l[1]]);const f=this.state.model,g={billboard:t,stroked:!!a,padding:l,sizeUnits:kn[s],sizeScale:i,sizeMinPixels:r,sizeMaxPixels:o};f.shaderInputs.setProps({textBackground:g}),f.draw(this.context.renderPass)}_getModel(){const e=[0,0,1,0,0,1,1,1];return new Nt(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new un({topology:"triangle-strip",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}}bd.defaultProps=Wk;bd.layerName="TextBackgroundLayer";const Om={start:1,middle:0,end:-1},Dm={top:1,center:0,bottom:-1},Bu=[0,0,0,255],jk=1,$k={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:Bu},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Gr.characterSet},fontFamily:Gr.fontFamily,fontWeight:Gr.fontWeight,lineHeight:jk,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:Bu},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:n=>n.text},getPosition:{type:"accessor",value:n=>n.position},getColor:{type:"accessor",value:Bu},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class vd extends gi{constructor(){super(...arguments),this.getBoundingRect=(e,t)=>{let{size:[i,s]}=this.transformParagraph(e,t);const{fontSize:r}=this.state.fontAtlasManager.props;i/=r,s/=r;const{getTextAnchor:o,getAlignmentBaseline:a}=this.props,l=Om[typeof o=="function"?o(e,t):o],f=Dm[typeof a=="function"?a(e,t):a];return[(l-1)*i/2,(f-1)*s/2,i,s]},this.getIconOffsets=(e,t)=>{const{getTextAnchor:i,getAlignmentBaseline:s}=this.props,{x:r,y:o,rowWidth:a,size:[l,f]}=this.transformParagraph(e,t),g=Om[typeof i=="function"?i(e,t):i],_=Dm[typeof s=="function"?s(e,t):s],v=r.length,T=new Array(v*2);let C=0;for(let S=0;S<v;S++){const R=(1-g)*(l-a[S])/2;T[C++]=(g-1)*l/2+R+r[S],T[C++]=(_-1)*f/2+o[S]}return T}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new Vk},this.props.maxWidth>0&&ze.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:t,oldProps:i,changeFlags:s}=e;(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||t.lineHeight!==i.lineHeight||t.wordBreak!==i.wordBreak||t.maxWidth!==i.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:t,fontWeight:i}=this.props,{fontAtlasManager:s,characterSet:r}=this.state,o={...e,characterSet:r,fontFamily:t,fontWeight:i};if(!s.mapping)return s.setProps(o),!0;for(const a in o)if(o[a]!==s.props[a])return s.setProps(o),!0;return!1}_updateText(){var l;const{data:e,characterSet:t}=this.props,i=(l=e.attributes)==null?void 0:l.getText;let{getText:s}=this.props,r=e.startIndices,o;const a=t==="auto"&&new Set;if(i&&r){const{texts:f,characterCount:g}=Nk({...ArrayBuffer.isView(i)?{value:i}:i,length:e.length,startIndices:r,characterSet:a});o=g,s=(_,{index:v})=>f[v]}else{const{iterable:f,objectInfo:g}=Ri(e);r=[0],o=0;for(const _ of f){g.index++;const v=Array.from(s(_,g)||"");a&&v.forEach(a.add,a),o+=v.length,r.push(o)}}this.setState({getText:s,startIndices:r,numInstances:o,characterSet:a||t})}transformParagraph(e,t){const{fontAtlasManager:i}=this.state,s=i.mapping,r=this.state.getText,{wordBreak:o,lineHeight:a,maxWidth:l}=this.props,f=r(e,t)||"";return Dk(f,a,o,l*i.props.fontSize,s)}renderLayers(){const{startIndices:e,numInstances:t,getText:i,fontAtlasManager:{scale:s,atlas:r,mapping:o},styleVersion:a}=this.state,{data:l,_dataDiff:f,getPosition:g,getColor:_,getSize:v,getAngle:T,getPixelOffset:C,getBackgroundColor:S,getBorderColor:R,getBorderWidth:P,backgroundPadding:F,background:U,billboard:X,fontSettings:Z,outlineWidth:se,outlineColor:Se,sizeScale:me,sizeUnits:J,sizeMinPixels:q,sizeMaxPixels:L,transitions:fe,updateTriggers:we}=this.props,Me=this.getSubLayerClass("characters",yd),Fe=this.getSubLayerClass("background",bd);return[U&&new Fe({getFillColor:S,getLineColor:R,getLineWidth:P,padding:F,getPosition:g,getSize:v,getAngle:T,getPixelOffset:C,billboard:X,sizeScale:me,sizeUnits:J,sizeMinPixels:q,sizeMaxPixels:L,transitions:fe&&{getPosition:fe.getPosition,getAngle:fe.getAngle,getSize:fe.getSize,getFillColor:fe.getBackgroundColor,getLineColor:fe.getBorderColor,getLineWidth:fe.getBorderWidth,getPixelOffset:fe.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:we.getPosition,getAngle:we.getAngle,getSize:we.getSize,getFillColor:we.getBackgroundColor,getLineColor:we.getBorderColor,getLineWidth:we.getBorderWidth,getPixelOffset:we.getPixelOffset,getBoundingRect:{getText:we.getText,getTextAnchor:we.getTextAnchor,getAlignmentBaseline:we.getAlignmentBaseline,styleVersion:a}}}),{data:l.attributes&&l.attributes.background?{length:l.length,attributes:l.attributes.background}:l,_dataDiff:f,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new Me({sdf:Z.sdf,smoothing:Number.isFinite(Z.smoothing)?Z.smoothing:Gr.smoothing,outlineWidth:se/(Z.radius||Gr.radius),outlineColor:Se,iconAtlas:r,iconMapping:o,getPosition:g,getColor:_,getSize:v,getAngle:T,getPixelOffset:C,billboard:X,sizeScale:me*s,sizeUnits:J,sizeMinPixels:q*s,sizeMaxPixels:L*s,transitions:fe&&{getPosition:fe.getPosition,getAngle:fe.getAngle,getColor:fe.getColor,getSize:fe.getSize,getPixelOffset:fe.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:we.getText,getPosition:we.getPosition,getAngle:we.getAngle,getColor:we.getColor,getSize:we.getSize,getPixelOffset:we.getPixelOffset,getIconOffsets:{getTextAnchor:we.getTextAnchor,getAlignmentBaseline:we.getAlignmentBaseline,styleVersion:a}}}),{data:l,_dataDiff:f,startIndices:e,numInstances:t,getIconOffsets:this.getIconOffsets,getIcon:i})]}static set fontAtlasCacheLimit(e){Uk(e)}}vd.defaultProps=$k;vd.layerName="TextLayer";const Rl={circle:{type:pd,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:iA,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:vd,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},Pl={type:co,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},nf={type:da,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function xo({type:n,props:e}){const t={};for(const i in e)t[i]=n.defaultProps[e[i]];return t}function Ou(n,e){const{transitions:t,updateTriggers:i}=n.props,s={updateTriggers:{},transitions:t&&{getPosition:t.geometry}};for(const r in e){const o=e[r];let a=n.props[r];r.startsWith("get")&&(a=n.getSubLayerAccessor(a),s.updateTriggers[o]=i[r],t&&(s.transitions[o]=t[r])),s[o]=a}return s}function Xk(n){if(Array.isArray(n))return n;switch(ze.assert(n.type,"GeoJSON does not have type"),n.type){case"Feature":return[n];case"FeatureCollection":return ze.assert(Array.isArray(n.features),"GeoJSON does not have features array"),n.features;default:return[{geometry:n}]}}function Nm(n,e,t={}){const i={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:s=0,endRow:r=n.length}=t;for(let o=s;o<r;o++){const a=n[o],{geometry:l}=a;if(l)if(l.type==="GeometryCollection"){ze.assert(Array.isArray(l.geometries),"GeoJSON does not have geometries array");const{geometries:f}=l;for(let g=0;g<f.length;g++){const _=f[g];Fm(_,i,e,a,o)}}else Fm(l,i,e,a,o)}return i}function Fm(n,e,t,i,s){const{type:r,coordinates:o}=n,{pointFeatures:a,lineFeatures:l,polygonFeatures:f,polygonOutlineFeatures:g}=e;if(!Yk(r,o)){ze.warn(`${r} coordinates are malformed`)();return}switch(r){case"Point":a.push(t({geometry:n},i,s));break;case"MultiPoint":o.forEach(_=>{a.push(t({geometry:{type:"Point",coordinates:_}},i,s))});break;case"LineString":l.push(t({geometry:n},i,s));break;case"MultiLineString":o.forEach(_=>{l.push(t({geometry:{type:"LineString",coordinates:_}},i,s))});break;case"Polygon":f.push(t({geometry:n},i,s)),o.forEach(_=>{g.push(t({geometry:{type:"LineString",coordinates:_}},i,s))});break;case"MultiPolygon":o.forEach(_=>{f.push(t({geometry:{type:"Polygon",coordinates:_}},i,s)),_.forEach(v=>{g.push(t({geometry:{type:"LineString",coordinates:v}},i,s))})});break}}const Qk={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function Yk(n,e){let t=Qk[n];for(ze.assert(t,`Unknown GeoJSON type ${n}`);e&&--t>0;)e=e[0];return e&&Number.isFinite(e[0])}function Tv(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function tl(n){return n.geometry.coordinates}function Kk(n,e){const t=Tv(),{pointFeatures:i,lineFeatures:s,polygonFeatures:r,polygonOutlineFeatures:o}=n;return t.points.data=i,t.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),t.points.getPosition=tl,t.lines.data=s,t.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),t.lines.getPath=tl,t.polygons.data=r,t.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),t.polygons.getPolygon=tl,t.polygonsOutline.data=o,t.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),t.polygonsOutline.getPath=tl,t}function qk(n,e){const t=Tv(),{points:i,lines:s,polygons:r}=n,o=Tk(n,e);return t.points.data={length:i.positions.value.length/i.positions.size,attributes:{...i.attributes,getPosition:i.positions,instancePickingColors:{size:4,value:o.points}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},t.lines.data={length:s.pathIndices.value.length-1,startIndices:s.pathIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:4,value:o.lines}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},t.lines._pathType="open",t.polygons.data={length:r.polygonIndices.value.length-1,startIndices:r.polygonIndices.value,attributes:{...r.attributes,getPolygon:r.positions,pickingColors:{size:4,value:o.polygons}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},t.polygons._normalize=!1,r.triangles&&(t.polygons.data.attributes.indices=r.triangles.value),t.polygonsOutline.data={length:r.primitivePolygonIndices.value.length-1,startIndices:r.primitivePolygonIndices.value,attributes:{...r.attributes,getPath:r.positions,instancePickingColors:{size:4,value:o.polygons}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},t.polygonsOutline._pathType="open",t}const Jk=["points","linestrings","polygons"],Zk={...xo(Rl.circle),...xo(Rl.icon),...xo(Rl.text),...xo(Pl),...xo(nf),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:n=>n.properties.icon},getText:{type:"accessor",value:n=>n.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class ga extends gi{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:t}){if(!t.dataChanged)return;const{data:i}=this.props,s=i&&"points"in i&&"polygons"in i&&"lines"in i;this.setState({binary:s}),s?this._updateStateBinary({props:e,changeFlags:t}):this._updateStateJSON({props:e,changeFlags:t})}_updateStateBinary({props:e,changeFlags:t}){const i=qk(e.data,this.encodePickingColor);this.setState({layerProps:i})}_updateStateJSON({props:e,changeFlags:t}){const i=Xk(e.data),s=this.getSubLayerRow.bind(this);let r={};const o={};if(Array.isArray(t.dataChanged)){const l=this.state.features;for(const f in l)r[f]=l[f].slice(),o[f]=[];for(const f of t.dataChanged){const g=Nm(i,s,f);for(const _ in l)o[_].push(pv({data:r[_],getIndex:v=>v.__source.index,dataRange:f,replace:g[_]}))}}else r=Nm(i,s);const a=Kk(r,o);this.setState({features:r,featuresDiff:o,layerProps:a})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:i,sourceLayer:s}=t;return t.featureType=Jk.find(r=>s.id.startsWith(`${this.id}-${r}-`)),i>=0&&s.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(t.index=this.props.data.points.globalFeatureIds.value[i]),t}_updateAutoHighlight(e){const t=`${this.id}-points-`,i=e.featureType==="points";for(const s of this.getSubLayers())s.id.startsWith(t)===i&&s.updateAutoHighlight(e)}_renderPolygonLayer(){var o;const{extruded:e,wireframe:t}=this.props,{layerProps:i}=this.state,s="polygons-fill",r=this.shouldRenderSubLayer(s,(o=i.polygons)==null?void 0:o.data)&&this.getSubLayerClass(s,nf.type);if(r){const a=Ou(this,nf.props),l=e&&t;return l||delete a.getLineColor,a.updateTriggers.lineColors=l,new r(a,this.getSubLayerProps({id:s,updateTriggers:a.updateTriggers}),i.polygons)}return null}_renderLineLayers(){var l,f;const{extruded:e,stroked:t}=this.props,{layerProps:i}=this.state,s="polygons-stroke",r="linestrings",o=!e&&t&&this.shouldRenderSubLayer(s,(l=i.polygonsOutline)==null?void 0:l.data)&&this.getSubLayerClass(s,Pl.type),a=this.shouldRenderSubLayer(r,(f=i.lines)==null?void 0:f.data)&&this.getSubLayerClass(r,Pl.type);if(o||a){const g=Ou(this,Pl.props);return[o&&new o(g,this.getSubLayerProps({id:s,updateTriggers:g.updateTriggers}),i.polygonsOutline),a&&new a(g,this.getSubLayerProps({id:r,updateTriggers:g.updateTriggers}),i.lines)]}return null}_renderPointLayers(){var a;const{pointType:e}=this.props,{layerProps:t,binary:i}=this.state;let{highlightedObjectIndex:s}=this.props;!i&&Number.isFinite(s)&&(s=t.points.data.findIndex(l=>l.__source.index===s));const r=new Set(e.split("+")),o=[];for(const l of r){const f=`points-${l}`,g=Rl[l],_=g&&this.shouldRenderSubLayer(f,(a=t.points)==null?void 0:a.data)&&this.getSubLayerClass(f,g.type);if(_){const v=Ou(this,g.props);let T=t.points;if(l==="text"&&i){const{instancePickingColors:C,...S}=T.data.attributes;T={...T,data:{...T.data,attributes:S}}}o.push(new _(v,this.getSubLayerProps({id:f,updateTriggers:v.updateTriggers,highlightedObjectIndex:s}),T))}}return o}renderLayers(){const{extruded:e}=this.props,t=this._renderPolygonLayer(),i=this._renderLineLayers(),s=this._renderPointLayers();return[!e&&t,i,s,e&&t]}getSubLayerAccessor(e){const{binary:t}=this.state;return!t||typeof e!="function"?super.getSubLayerAccessor(e):(i,s)=>{const{data:r,index:o}=s,a=bk(r,o);return e(a,s)}}}ga.layerName="GeoJsonLayer";ga.defaultProps=Zk;function eU({pointCount:n,getBinId:e}){const t=new Map;for(let i=0;i<n;i++){const s=e(i);if(s===null)continue;let r=t.get(String(s));r?r.points.push(i):(r={id:s,index:t.size,points:[i]},t.set(String(s),r))}return Array.from(t.values())}function tU({bins:n,dimensions:e,target:t}){const i=n.length*e;(!t||t.length<i)&&(t=new Float32Array(i));for(let s=0;s<n.length;s++){const{id:r}=n[s];Array.isArray(r)?t.set(r,s*e):t[s]=r}return t}const nU=n=>n.length,wv=(n,e)=>{let t=0;for(const i of n)t+=e(i);return t},iU=(n,e)=>n.length===0?NaN:wv(n,e)/n.length,sU=(n,e)=>{let t=1/0;for(const i of n){const s=e(i);s<t&&(t=s)}return t},rU=(n,e)=>{let t=-1/0;for(const i of n){const s=e(i);s>t&&(t=s)}return t},oU={COUNT:nU,SUM:wv,MEAN:iU,MIN:sU,MAX:rU};function aU({bins:n,getValue:e,operation:t,target:i}){(!i||i.length<n.length)&&(i=new Float32Array(n.length));let s=1/0,r=-1/0;for(let o=0;o<n.length;o++){const{points:a}=n[o];i[o]=t(a,e),i[o]<s&&(s=i[o]),i[o]>r&&(r=i[o])}return{value:i,domain:[s,r]}}function Lm(n,e,t){const i={};for(const r of n.sources||[]){const o=e[r];if(o)i[r]=lU(o);else throw new Error(`Cannot find attribute ${r}`)}const s={};return r=>{for(const o in i)s[o]=i[o](r);return n.getValue(s,r,t)}}function lU(n){const e=n.value,{offset:t=0,stride:i,size:s}=n.getAccessor(),r=e.BYTES_PER_ELEMENT,o=t/r,a=i?i/r:s;if(s===1)return n.isConstant?()=>e[0]:f=>{const g=o+a*f;return e[g]};let l;return n.isConstant?(l=Array.from(e),()=>l):(l=new Array(s),f=>{const g=o+a*f;for(let _=0;_<s;_++)l[_]=e[g+_];return l})}class pa{constructor(e){this.bins=[],this.binIds=null,this.results=[],this.dimensions=e.dimensions,this.channelCount=e.getValue.length,this.props={...e,binOptions:{},pointCount:0,operations:[],customOperations:[],attributes:{}},this.needsUpdate=!0,this.setProps(e)}destroy(){}get binCount(){return this.bins.length}setProps(e){const t=this.props;if(e.binOptions&&(Kt(e.binOptions,t.binOptions,2)||this.setNeedsUpdate()),e.operations)for(let i=0;i<this.channelCount;i++)e.operations[i]!==t.operations[i]&&this.setNeedsUpdate(i);if(e.customOperations)for(let i=0;i<this.channelCount;i++)!!e.customOperations[i]!=!!t.customOperations[i]&&this.setNeedsUpdate(i);e.pointCount!==void 0&&e.pointCount!==t.pointCount&&this.setNeedsUpdate(),e.attributes&&(e.attributes={...t.attributes,...e.attributes}),Object.assign(this.props,e)}setNeedsUpdate(e){e===void 0?this.needsUpdate=!0:this.needsUpdate!==!0&&(this.needsUpdate=this.needsUpdate||[],this.needsUpdate[e]=!0)}update(){var e,t,i,s;if(this.needsUpdate===!0){this.bins=eU({pointCount:this.props.pointCount,getBinId:Lm(this.props.getBin,this.props.attributes,this.props.binOptions)});const r=tU({bins:this.bins,dimensions:this.dimensions,target:(e=this.binIds)==null?void 0:e.value});this.binIds={value:r,type:"float32",size:this.dimensions}}for(let r=0;r<this.channelCount;r++)if(this.needsUpdate===!0||this.needsUpdate[r]){const o=this.props.customOperations[r]||oU[this.props.operations[r]],{value:a,domain:l}=aU({bins:this.bins,getValue:Lm(this.props.getValue[r],this.props.attributes,void 0),operation:o,target:(t=this.results[r])==null?void 0:t.value});this.results[r]={value:a,domain:l,type:"float32",size:1},(s=(i=this.props).onUpdate)==null||s.call(i,{channel:r})}this.needsUpdate=!1}preDraw(){}getBins(){return this.binIds}getResult(e){return this.results[e]}getResultDomain(e){var t;return((t=this.results[e])==null?void 0:t.domain)??[1/0,-1/0]}getBin(e){const t=this.bins[e];if(!t)return null;const i=new Array(this.channelCount);for(let s=0;s<i.length;s++){const r=this.results[s];i[s]=r==null?void 0:r.value[e]}return{id:t.id,value:i,count:t.points.length,pointIndices:t.points}}}function Ev(n,e,t){return n.createFramebuffer({width:e,height:t,colorAttachments:[n.createTexture({width:e,height:t,format:"rgba32float",mipmaps:!1,sampler:{minFilter:"nearest",magFilter:"nearest"}})]})}const cU=`uniform binSorterUniforms {
  ivec4 binIdRange;
  ivec2 targetSize;
} binSorter;
`,AU={name:"binSorter",vs:cU,uniformTypes:{binIdRange:"vec4<i32>",targetSize:"vec2<i32>"}},xv=[1,2,4,8],uU=3e38,hU={SUM:0,MEAN:0,MIN:0,MAX:0,COUNT:0},Ml=1024;class fU{constructor(e,t){this.binsFBO=null,this.device=e,this.model=gU(e,t)}get texture(){return this.binsFBO?this.binsFBO.colorAttachments[0].texture:null}destroy(){var e,t;this.model.destroy(),(e=this.binsFBO)==null||e.colorAttachments[0].texture.destroy(),(t=this.binsFBO)==null||t.destroy()}getBinValues(e){if(!this.binsFBO)return null;const t=e%Ml,i=Math.floor(e/Ml),s=this.device.readPixelsToArrayWebGL(this.binsFBO,{sourceX:t,sourceY:i,sourceWidth:1,sourceHeight:1}).buffer;return new Float32Array(s)}setDimensions(e,t){var o,a;const i=Ml,s=Math.ceil(e/i);this.binsFBO?this.binsFBO.height<s&&this.binsFBO.resize({width:i,height:s}):this.binsFBO=Ev(this.device,i,s);const r={binIdRange:[t[0][0],t[0][1],((o=t[1])==null?void 0:o[0])||0,((a=t[1])==null?void 0:a[1])||0],targetSize:[this.binsFBO.width,this.binsFBO.height]};this.model.shaderInputs.setProps({binSorter:r})}setModelProps(e){const t=this.model;e.attributes&&t.setAttributes(e.attributes),e.constantAttributes&&t.setConstantAttributes(e.constantAttributes),e.vertexCount!==void 0&&t.setVertexCount(e.vertexCount),e.shaderModuleProps&&t.shaderInputs.setProps(e.shaderModuleProps)}update(e){if(!this.binsFBO)return;const t=dU(e);this._updateBins("SUM",t.SUM+t.MEAN),this._updateBins("MIN",t.MIN),this._updateBins("MAX",t.MAX)}_updateBins(e,t){if(t===0)return;t|=xv[3];const i=this.model,s=this.binsFBO,r=e==="MAX"?-3e38:e==="MIN"?uU:0,o=this.device.beginRenderPass({id:`gpu-aggregation-${e}`,framebuffer:s,parameters:{viewport:[0,0,s.width,s.height],colorMask:t},clearColor:[r,r,r,0],clearDepth:!1,clearStencil:!1});i.setParameters({blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",blendColorOperation:e==="MAX"?"max":e==="MIN"?"min":"add",blendAlphaOperation:"add"}),i.draw(o),o.end()}}function dU(n){const e={...hU};for(let t=0;t<n.length;t++){const i=n[t];i&&(e[i]+=xv[t])}return e}function gU(n,e){let t=e.vs;e.dimensions===2&&(t+=`
void getBin(out int binId) {
  ivec2 binId2;
  getBin(binId2);
  if (binId2.x < binSorter.binIdRange.x || binId2.x >= binSorter.binIdRange.y) {
    binId = -1;
  } else {
    binId = (binId2.y - binSorter.binIdRange.z) * (binSorter.binIdRange.y - binSorter.binIdRange.x) + binId2.x;
  }
}
`);const i=`#version 300 es
#define SHADER_NAME gpu-aggregation-sort-bins-vertex

${t}

out vec3 v_Value;

void main() {
  int binIndex;
  getBin(binIndex);
  binIndex = binIndex - binSorter.binIdRange.x;
  if (binIndex < 0) {
    gl_Position = vec4(0.);
    return;
  }
  int row = binIndex / binSorter.targetSize.x;
  int col = binIndex - row * binSorter.targetSize.x;
  vec2 position = (vec2(col, row) + 0.5) / vec2(binSorter.targetSize) * 2.0 - 1.0;
  gl_Position = vec4(position, 0.0, 1.0);
  gl_PointSize = 1.0;

#if NUM_CHANNELS == 3
  getValue(v_Value);
#elif NUM_CHANNELS == 2
  getValue(v_Value.xy);
#else
  getValue(v_Value.x);
#endif
}
`,s=`#version 300 es
#define SHADER_NAME gpu-aggregation-sort-bins-fragment

precision highp float;

in vec3 v_Value;
out vec4 fragColor;

void main() {
  fragColor.xyz = v_Value;

  #ifdef MODULE_GEOMETRY
  geometry.uv = vec2(0.);
  DECKGL_FILTER_COLOR(fragColor, geometry);
  #endif

  fragColor.w = 1.0;
}
`;return new Nt(n,{bufferLayout:e.bufferLayout,modules:[...e.modules||[],AU],defines:{...e.defines,NON_INSTANCED_MODEL:1,NUM_CHANNELS:e.channelCount},isInstanced:!1,vs:i,fs:s,topology:"point-list",disableWarnings:!0})}const pU=`uniform aggregatorTransformUniforms {
  ivec4 binIdRange;
  bvec3 isCount;
  bvec3 isMean;
  float naN;
} aggregatorTransform;
`,mU={name:"aggregatorTransform",vs:pU,uniformTypes:{binIdRange:"vec4<i32>",isCount:"vec3<f32>",isMean:"vec3<f32>"}};class _U{constructor(e,t){this.binBuffer=null,this.valueBuffer=null,this._domains=null,this.device=e,this.channelCount=t.channelCount,this.transform=yU(e,t),this.domainFBO=Ev(e,2,1)}destroy(){var e,t;this.transform.destroy(),(e=this.binBuffer)==null||e.destroy(),(t=this.valueBuffer)==null||t.destroy(),this.domainFBO.colorAttachments[0].texture.destroy(),this.domainFBO.destroy()}get domains(){if(!this._domains){const e=this.device.readPixelsToArrayWebGL(this.domainFBO).buffer,t=new Float32Array(e);this._domains=[[-t[4],t[0]],[-t[5],t[1]],[-t[6],t[2]]].slice(0,this.channelCount)}return this._domains}setDimensions(e,t){var l,f,g,_;const{model:i,transformFeedback:s}=this.transform;i.setVertexCount(e);const r={binIdRange:[t[0][0],t[0][1],((l=t[1])==null?void 0:l[0])||0,((f=t[1])==null?void 0:f[1])||0]};i.shaderInputs.setProps({aggregatorTransform:r});const o=e*t.length*4;(!this.binBuffer||this.binBuffer.byteLength<o)&&((g=this.binBuffer)==null||g.destroy(),this.binBuffer=this.device.createBuffer({byteLength:o}),s.setBuffer("binIds",this.binBuffer));const a=e*this.channelCount*4;(!this.valueBuffer||this.valueBuffer.byteLength<a)&&((_=this.valueBuffer)==null||_.destroy(),this.valueBuffer=this.device.createBuffer({byteLength:a}),s.setBuffer("values",this.valueBuffer))}update(e,t){if(!e)return;const i=this.transform,s=this.domainFBO,r=[0,1,2].map(l=>t[l]==="COUNT"?1:0),o=[0,1,2].map(l=>t[l]==="MEAN"?1:0),a={isCount:r,isMean:o,bins:e};i.model.shaderInputs.setProps({aggregatorTransform:a}),i.run({id:"gpu-aggregation-domain",framebuffer:s,parameters:{viewport:[0,0,2,1]},clearColor:[-3e38,-3e38,-3e38,0],clearDepth:!1,clearStencil:!1}),this._domains=null}}function yU(n,e){const t=`#version 300 es
#define SHADER_NAME gpu-aggregation-domain-vertex

uniform sampler2D bins;

#if NUM_DIMS == 1
out float binIds;
#else
out vec2 binIds;
#endif

#if NUM_CHANNELS == 1
flat out float values;
#elif NUM_CHANNELS == 2
flat out vec2 values;
#else
flat out vec3 values;
#endif

const float NAN = intBitsToFloat(-1);

void main() {
  int row = gl_VertexID / SAMPLER_WIDTH;
  int col = gl_VertexID - row * SAMPLER_WIDTH;
  vec4 weights = texelFetch(bins, ivec2(col, row), 0);
  vec3 value3 = mix(
    mix(weights.rgb, vec3(weights.a), aggregatorTransform.isCount),
    weights.rgb / max(weights.a, 1.0),
    aggregatorTransform.isMean
  );
  if (weights.a == 0.0) {
    value3 = vec3(NAN);
  }

#if NUM_DIMS == 1
  binIds = float(gl_VertexID + aggregatorTransform.binIdRange.x);
#else
  int y = gl_VertexID / (aggregatorTransform.binIdRange.y - aggregatorTransform.binIdRange.x);
  int x = gl_VertexID - y * (aggregatorTransform.binIdRange.y - aggregatorTransform.binIdRange.x);
  binIds.y = float(y + aggregatorTransform.binIdRange.z);
  binIds.x = float(x + aggregatorTransform.binIdRange.x);
#endif

#if NUM_CHANNELS == 3
  values = value3;
#elif NUM_CHANNELS == 2
  values = value3.xy;
#else
  values = value3.x;
#endif

  gl_Position = vec4(0., 0., 0., 1.);
  // This model renders into a 2x1 texture to obtain min and max simultaneously.
  // See comments in fragment shader
  gl_PointSize = 2.0;
}
`,i=`#version 300 es
#define SHADER_NAME gpu-aggregation-domain-fragment

precision highp float;

#if NUM_CHANNELS == 1
flat in float values;
#elif NUM_CHANNELS == 2
flat in vec2 values;
#else
flat in vec3 values;
#endif

out vec4 fragColor;

void main() {
  vec3 value3;
#if NUM_CHANNELS == 3
  value3 = values;
#elif NUM_CHANNELS == 2
  value3.xy = values;
#else
  value3.x = values;
#endif
  if (isnan(value3.x)) discard;
  // This shader renders into a 2x1 texture with blending=max
  // The left pixel yields the max value of each channel
  // The right pixel yields the min value of each channel
  if (gl_FragCoord.x < 1.0) {
    fragColor = vec4(value3, 1.0);
  } else {
    fragColor = vec4(-value3, 1.0);
  }
}
`;return new Yr(n,{vs:t,fs:i,topology:"point-list",modules:[mU],parameters:{blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one",blendColorOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",blendAlphaOperation:"max"},defines:{NUM_DIMS:e.dimensions,NUM_CHANNELS:e.channelCount,SAMPLER_WIDTH:Ml},varyings:["binIds","values"],disableWarnings:!0})}class li{static isSupported(e){return e.features.has("float32-renderable-webgl")&&e.features.has("texture-blend-float-webgl")}constructor(e,t){this.binCount=0,this.binIds=null,this.results=[],this.device=e,this.dimensions=t.dimensions,this.channelCount=t.channelCount,this.props={...t,pointCount:0,binIdRange:[[0,0]],operations:[],attributes:{},binOptions:{}},this.needsUpdate=new Array(this.channelCount).fill(!0),this.binSorter=new fU(e,t),this.aggregationTransform=new _U(e,t),this.setProps(t)}getBins(){var t;const e=this.aggregationTransform.binBuffer;return e?(((t=this.binIds)==null?void 0:t.buffer)!==e&&(this.binIds={buffer:e,type:"float32",size:this.dimensions}),this.binIds):null}getResult(e){var i;const t=this.aggregationTransform.valueBuffer;return!t||e>=this.channelCount?null:(((i=this.results[e])==null?void 0:i.buffer)!==t&&(this.results[e]={buffer:t,type:"float32",size:1,stride:this.channelCount*4,offset:e*4}),this.results[e])}getResultDomain(e){return this.aggregationTransform.domains[e]}getBin(e){if(e<0||e>=this.binCount)return null;const{binIdRange:t}=this.props;let i;if(this.dimensions===1)i=[e+t[0][0]];else{const[[a,l],[f]]=t,g=l-a;i=[e%g+a,Math.floor(e/g)+f]}const s=this.binSorter.getBinValues(e);if(!s)return null;const r=s[3],o=[];for(let a=0;a<this.channelCount;a++){const l=this.props.operations[a];l==="COUNT"?o[a]=r:r===0?o[a]=NaN:o[a]=l==="MEAN"?s[a]/r:s[a]}return{id:i,value:o,count:r}}destroy(){this.binSorter.destroy(),this.aggregationTransform.destroy()}setProps(e){const t=this.props;if("binIdRange"in e&&!Kt(e.binIdRange,t.binIdRange,2)){const i=e.binIdRange;if(ze.assert(i.length===this.dimensions),this.dimensions===1){const[[s,r]]=i;this.binCount=r-s}else{const[[s,r],[o,a]]=i;this.binCount=(r-s)*(a-o)}this.binSorter.setDimensions(this.binCount,i),this.aggregationTransform.setDimensions(this.binCount,i),this.setNeedsUpdate()}if(e.operations)for(let i=0;i<this.channelCount;i++)e.operations[i]!==t.operations[i]&&this.setNeedsUpdate(i);if(e.pointCount!==void 0&&e.pointCount!==t.pointCount&&(this.binSorter.setModelProps({vertexCount:e.pointCount}),this.setNeedsUpdate()),e.binOptions&&(Kt(e.binOptions,t.binOptions,2)||this.setNeedsUpdate(),this.binSorter.model.shaderInputs.setProps({binOptions:e.binOptions})),e.attributes){const i={},s={};for(const r of Object.values(e.attributes))for(const[o,a]of Object.entries(r.getValue()))ArrayBuffer.isView(a)?s[o]=a:a&&(i[o]=a);this.binSorter.setModelProps({attributes:i,constantAttributes:s})}e.shaderModuleProps&&this.binSorter.setModelProps({shaderModuleProps:e.shaderModuleProps}),Object.assign(this.props,e)}setNeedsUpdate(e){e===void 0?this.needsUpdate.fill(!0):this.needsUpdate[e]=!0}update(){}preDraw(){var i,s;if(!this.needsUpdate.some(Boolean))return;const{operations:e}=this.props,t=this.needsUpdate.map((r,o)=>r?e[o]:null);this.binSorter.update(t),this.aggregationTransform.update(this.binSorter.texture,e);for(let r=0;r<this.channelCount;r++)this.needsUpdate[r]&&(this.needsUpdate[r]=!1,(s=(i=this.props).onUpdate)==null||s.call(i,{channel:r}))}}let ma=class extends gi{get isDrawable(){return!0}initializeState(){this.getAttributeManager().remove(["instancePickingColors"])}updateState(e){var i,s;super.updateState(e);const t=this.getAggregatorType();if(e.changeFlags.extensionsChanged||this.state.aggregatorType!==t){(i=this.state.aggregator)==null||i.destroy();const r=this.createAggregator(t);return r.setProps({attributes:(s=this.getAttributeManager())==null?void 0:s.attributes}),this.setState({aggregator:r,aggregatorType:t}),!0}return!1}finalizeState(e){super.finalizeState(e),this.state.aggregator.destroy()}updateAttributes(e){const{aggregator:t}=this.state;t.setProps({attributes:e});for(const i in e)this.onAttributeChange(i);t.update()}draw({shaderModuleProps:e}){const{aggregator:t}=this.state;t.setProps({shaderModuleProps:e}),t.preDraw()}_getAttributeManager(){return new tA(this.context.device,{id:this.props.id,stats:this.context.stats})}};ma.layerName="AggregationLayer";const sA=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function Cv(n,e=!1,t=Float32Array){let i;if(Number.isFinite(n[0]))i=new t(n);else{i=new t(n.length*4);let s=0;for(let r=0;r<n.length;r++){const o=n[r];i[s++]=o[0],i[s++]=o[1],i[s++]=o[2],i[s++]=Number.isFinite(o[3])?o[3]:255}}if(e)for(let s=0;s<i.length;s++)i[s]/=255;return i}const _c={linear:"linear",quantile:"nearest",quantize:"nearest",ordinal:"nearest"};function Td(n,e){n.setSampler({minFilter:_c[e],magFilter:_c[e]})}function wd(n,e,t="linear"){const i=Cv(e,!1,Uint8Array);return n.createTexture({format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:_c[t],magFilter:_c[t],addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},data:i,width:i.length/4,height:1})}const bU=`#version 300 es
#define SHADER_NAME screen-grid-layer-vertex-shader
#define RANGE_COUNT 6
in vec2 positions;
in vec2 instancePositions;
in float instanceWeights;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
if (isnan(instanceWeights)) {
gl_Position = vec4(0.);
return;
}
vec2 pos = instancePositions * screenGrid.gridSizeClipspace + positions * screenGrid.cellSizeClipspace;
pos.x = pos.x - 1.0;
pos.y = 1.0 - pos.y;
gl_Position = vec4(pos, 0., 1.);
vColor = interp(instanceWeights, screenGrid.colorDomain, colorRange);
vColor.a *= layer.opacity;
picking_setPickingColor(instancePickingColors);
}
`,vU=`#version 300 es
#define SHADER_NAME screen-grid-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,TU=`uniform screenGridUniforms {
  vec2 cellSizeClipspace;
  vec2 gridSizeClipspace;
  vec2 colorDomain;
} screenGrid;
`,wU={name:"screenGrid",vs:TU,uniformTypes:{cellSizeClipspace:"vec2<f32>",gridSizeClipspace:"vec2<f32>",colorDomain:"vec2<f32>"}};class Sv extends rn{getShaders(){return super.getShaders({vs:bU,fs:vU,modules:[Un,wU]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceWeights:{size:1,type:"float32",accessor:"getWeight"}}),this.state.model=this._getModel()}updateState(e){var o;super.updateState(e);const{props:t,oldProps:i,changeFlags:s}=e,r=this.state.model;if(i.colorRange!==t.colorRange){(o=this.state.colorTexture)==null||o.destroy(),this.state.colorTexture=wd(this.context.device,t.colorRange,t.colorScaleType);const a={colorRange:this.state.colorTexture};r.shaderInputs.setProps({screenGrid:a})}else i.colorScaleType!==t.colorScaleType&&Td(this.state.colorTexture,t.colorScaleType);if(i.cellMarginPixels!==t.cellMarginPixels||i.cellSizePixels!==t.cellSizePixels||s.viewportChanged){const{width:a,height:l}=this.context.viewport,{cellSizePixels:f,cellMarginPixels:g}=this.props,_=Math.max(f-g,0),v={gridSizeClipspace:[f/a*2,f/l*2],cellSizeClipspace:[_/a*2,_/l*2]};r.shaderInputs.setProps({screenGrid:v})}}finalizeState(e){var t;super.finalizeState(e),(t=this.state.colorTexture)==null||t.destroy()}draw({uniforms:e}){const t=this.props.colorDomain(),i=this.state.model,s={colorDomain:t};i.shaderInputs.setProps({screenGrid:s}),i.draw(this.context.renderPass)}_getModel(){return new Nt(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new un({topology:"triangle-strip",attributes:{positions:{value:new Float32Array([0,0,1,0,0,1,1,1]),size:2}}}),isInstanced:!0})}}Sv.layerName="ScreenGridCellLayer";const EU=`uniform binOptionsUniforms {
  float cellSizePixels;
} binOptions;
`,xU={name:"binOptions",vs:EU,uniformTypes:{cellSizePixels:"f32"}},CU={cellSizePixels:{type:"number",value:100,min:1},cellMarginPixels:{type:"number",value:2,min:0},colorRange:sA,colorScaleType:"linear",getPosition:{type:"accessor",value:n=>n.position},getWeight:{type:"accessor",value:1},gpuAggregation:!0,aggregation:"SUM"};class Iv extends ma{getAggregatorType(){return this.props.gpuAggregation&&li.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){return e==="cpu"||!li.isSupported(this.context.device)?new pa({dimensions:2,getBin:{sources:["positions"],getValue:({positions:t},i,s)=>{const r=this.context.viewport,o=r.project(t),a=s.cellSizePixels;return o[0]<0||o[0]>=r.width||o[1]<0||o[1]>=r.height?null:[Math.floor(o[0]/a),Math.floor(o[1]/a)]}},getValue:[{sources:["counts"],getValue:({counts:t})=>t}]}):new li(this.context.device,{dimensions:2,channelCount:1,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[sn,xU],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float counts;
  
  void getBin(out ivec2 binId) {
    vec4 pos = project_position_to_clipspace(positions, positions64Low, vec3(0.0));
    vec2 screenCoords = vec2(pos.x / pos.w + 1.0, 1.0 - pos.y / pos.w) / 2.0 * project.viewportSize / project.devicePixelRatio;
    vec2 gridCoords = floor(screenCoords / binOptions.cellSizePixels);
    binId = ivec2(gridCoords);
  }
  void getValue(out float weight) {
    weight = counts;
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},counts:{size:1,accessor:"getWeight"}})}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState(e){const t=super.updateState(e),{props:i,oldProps:s,changeFlags:r}=e,{cellSizePixels:o,aggregation:a}=i;if(t||r.dataChanged||r.updateTriggersChanged||r.viewportChanged||a!==s.aggregation||o!==s.cellSizePixels){const{width:l,height:f}=this.context.viewport,{aggregator:g}=this.state;g instanceof li&&g.setProps({binIdRange:[[0,Math.ceil(l/o)],[0,Math.ceil(f/o)]]}),g.setProps({pointCount:this.getNumInstances(),operations:[a],binOptions:{cellSizePixels:o}})}return r.viewportChanged&&this.state.aggregator.setNeedsUpdate(),t}onAttributeChange(e){const{aggregator:t}=this.state;switch(e){case"positions":t.setNeedsUpdate();break;case"counts":t.setNeedsUpdate(0);break}}renderLayers(){const{aggregator:e}=this.state,t=this.getSubLayerClass("cells",Sv),i=e.getBins(),s=e.getResult(0);return new t(this.props,this.getSubLayerProps({id:"cell-layer"}),{data:{length:e.binCount,attributes:{getBin:i,getWeight:s}},dataComparator:(r,o)=>r.length===o.length,updateTriggers:{getBin:[i],getWeight:[s]},parameters:{depthWriteEnabled:!1,...this.props.parameters},colorDomain:()=>this.props.colorDomain||e.getResultDomain(0),extensions:[]})}getPickingInfo(e){const t=e.info,{index:i}=t;if(i>=0){const s=this.state.aggregator.getBin(i);let r;s&&(r={col:s.id[0],row:s.id[1],value:s.value[0],count:s.count},s.pointIndices&&(r.pointIndices=s.pointIndices,r.points=Array.isArray(this.props.data)?s.pointIndices.map(o=>this.props.data[o]):[])),t.object=r}return t}}Iv.layerName="ScreenGridLayer";Iv.defaultProps=CU;class yc{constructor(e,t){this.props={scaleType:"linear",lowerPercentile:0,upperPercentile:100},this.domain=null,this.cutoff=null,this.input=e,this.inputLength=t,this.attribute=e}getScalePercentile(){if(!this._percentile){const e=km(this.input,this.inputLength);this._percentile=IU(e)}return this._percentile}getScaleOrdinal(){if(!this._ordinal){const e=km(this.input,this.inputLength);this._ordinal=SU(e)}return this._ordinal}getCutoff({scaleType:e,lowerPercentile:t,upperPercentile:i}){if(e==="quantile")return[t,i-1];if(t>0||i<100){const{domain:s}=this.getScalePercentile();let r=s[Math.floor(t)-1]??-1/0,o=s[Math.floor(i)-1]??1/0;if(e==="ordinal"){const{domain:a}=this.getScaleOrdinal();r=a.findIndex(l=>l>=r),o=a.findIndex(l=>l>o)-1,o===-2&&(o=a.length-1)}return[r,o]}return null}update(e){const t=this.props;if(e.scaleType!==t.scaleType)switch(e.scaleType){case"quantile":{const{attribute:i}=this.getScalePercentile();this.attribute=i,this.domain=[0,99];break}case"ordinal":{const{attribute:i,domain:s}=this.getScaleOrdinal();this.attribute=i,this.domain=[0,s.length-1];break}default:this.attribute=this.input,this.domain=null}return(e.scaleType!==t.scaleType||e.lowerPercentile!==t.lowerPercentile||e.upperPercentile!==t.upperPercentile)&&(this.cutoff=this.getCutoff(e)),this.props=e,this}}function SU(n){const e=new Set;for(const s of n)Number.isFinite(s)&&e.add(s);const t=Array.from(e).sort(),i=new Map;for(let s=0;s<t.length;s++)i.set(t[s],s);return{attribute:{value:n.map(s=>Number.isFinite(s)?i.get(s):NaN),type:"float32",size:1},domain:t}}function IU(n,e=100){const t=Array.from(n).filter(Number.isFinite).sort(RU);let i=0;const s=Math.max(1,e),r=new Array(s-1);for(;++i<s;)r[i-1]=PU(t,i/s);return{attribute:{value:n.map(o=>Number.isFinite(o)?MU(r,o):NaN),type:"float32",size:1},domain:r}}function km(n,e){var o;const t=(n.stride??4)/4,i=(n.offset??0)/4;let s=n.value;if(!s){const a=(o=n.buffer)==null?void 0:o.readSyncWebGL(0,t*4*e);a&&(s=new Float32Array(a.buffer),n.value=s)}if(t===1)return s.subarray(0,e);const r=new Float32Array(e);for(let a=0;a<e;a++)r[a]=s[a*t+i];return r}function RU(n,e){return n-e}function PU(n,e){const t=n.length;if(e<=0||t<2)return n[0];if(e>=1)return n[t-1];const i=(t-1)*e,s=Math.floor(i),r=n[s],o=n[s+1];return r+(o-r)*(i-s)}function MU(n,e){let t=0,i=n.length;for(;t<i;){const s=t+i>>>1;n[s]>e?i=s:t=s+1}return t}function Ed({dataBounds:n,getBinId:e,padding:t=0}){const i=[n[0],n[1],[n[0][0],n[1][1]],[n[1][0],n[0][1]]].map(l=>e(l)),s=Math.min(...i.map(l=>l[0]))-t,r=Math.min(...i.map(l=>l[1]))-t,o=Math.max(...i.map(l=>l[0]))+t+1,a=Math.max(...i.map(l=>l[1]))+t+1;return[[s,o],[r,a]]}const Rv=Math.PI/3,rA=2*Math.sin(Rv),oA=1.5,BU=Array.from({length:6},(n,e)=>{const t=e*Rv;return[Math.sin(t),-Math.cos(t)]});function Du([n,e],t){let i=Math.round(e=e/t/oA),s=Math.round(n=n/t/rA-(i&1)/2);const r=e-i;if(Math.abs(r)*3>1){const o=n-s,a=s+(n<s?-1:1)/2,l=i+(e<i?-1:1),f=n-a,g=e-l;o*o+r*r>f*f+g*g&&(s=a+(i&1?1:-1)/2,i=l)}return[s,i]}const OU=`
const vec2 DIST = vec2(${rA}, ${oA});

ivec2 pointToHexbin(vec2 p, float radius) {
  p /= radius * DIST;
  float pj = round(p.y);
  float pjm2 = mod(pj, 2.0);
  p.x -= pjm2 * 0.5;
  float pi = round(p.x);
  vec2 d1 = p - vec2(pi, pj);

  if (abs(d1.y) * 3. > 1.) {
    vec2 v2 = step(0.0, d1) - 0.5;
    v2.y *= 2.0;
    vec2 d2 = d1 - v2;
    if (dot(d1, d1) > dot(d2, d2)) {
      pi += v2.x + pjm2 - 0.5;
      pj += v2.y;
    }
  }
  return ivec2(pi, pj);
}
`;function Um([n,e],t){return[(n+(e&1)/2)*t*rA,e*t*oA]}const DU=`
const vec2 DIST = vec2(${rA}, ${oA});

vec2 hexbinCentroid(vec2 binId, float radius) {
  binId.x += fract(binId.y * 0.5);
  return binId * DIST * radius;
}
`,NU=`#version 300 es
#define SHADER_NAME hexagon-cell-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec2 instancePositions;
in float instanceElevationValues;
in float instanceColorValues;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
${DU}
float interp(float value, vec2 domain, vec2 range) {
float r = min(max((value - domain.x) / (domain.y - domain.x), 0.), 1.);
return mix(range.x, range.y, r);
}
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
geometry.pickingColor = instancePickingColors;
if (isnan(instanceColorValues) ||
instanceColorValues < hexagon.colorDomain.z ||
instanceColorValues > hexagon.colorDomain.w ||
instanceElevationValues < hexagon.elevationDomain.z ||
instanceElevationValues > hexagon.elevationDomain.w
) {
gl_Position = vec4(0.);
return;
}
vec2 commonPosition = hexbinCentroid(instancePositions, column.radius) + (hexagon.originCommon - project.commonOrigin.xy);
commonPosition += positions.xy * column.radius * column.coverage;
geometry.position = vec4(commonPosition, 0.0, 1.0);
geometry.normal = project_normal(normals);
float elevation = 0.0;
if (column.extruded) {
elevation = interp(instanceElevationValues, hexagon.elevationDomain.xy, hexagon.elevationRange);
elevation = project_size(elevation);
geometry.position.z = (positions.z + 1.0) / 2.0 * elevation;
}
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vColor = interp(instanceColorValues, hexagon.colorDomain.xy, colorRange);
vColor.a *= layer.opacity;
if (column.extruded) {
vColor.rgb = lighting_getLightColor(vColor.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,FU=`uniform hexagonUniforms {
  vec4 colorDomain;
  vec4 elevationDomain;
  vec2 elevationRange;
  vec2 originCommon;
} hexagon;
`,LU={name:"hexagon",vs:FU,uniformTypes:{colorDomain:"vec4<f32>",elevationDomain:"vec4<f32>",elevationRange:"vec2<f32>",originCommon:"vec2<f32>"}};class Pv extends lo{getShaders(){const e=super.getShaders();return e.modules.push(LU),{...e,vs:NU}}initializeState(){super.initializeState();const e=this.getAttributeManager();e.remove(["instanceElevations","instanceFillColors","instanceLineColors","instanceStrokeWidths"]),e.addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceColorValues:{size:1,type:"float32",accessor:"getColorValue"},instanceElevationValues:{size:1,type:"float32",accessor:"getElevationValue"}})}updateState(e){var r;super.updateState(e);const{props:t,oldProps:i}=e,s=this.state.fillModel;if(i.colorRange!==t.colorRange){(r=this.state.colorTexture)==null||r.destroy(),this.state.colorTexture=wd(this.context.device,t.colorRange,t.colorScaleType);const o={colorRange:this.state.colorTexture};s.shaderInputs.setProps({hexagon:o})}else i.colorScaleType!==t.colorScaleType&&Td(this.state.colorTexture,t.colorScaleType)}finalizeState(e){var t;super.finalizeState(e),(t=this.state.colorTexture)==null||t.destroy()}draw({uniforms:e}){const{radius:t,hexOriginCommon:i,elevationRange:s,elevationScale:r,extruded:o,coverage:a,colorDomain:l,elevationDomain:f}=this.props,g=this.props.colorCutoff||[-1/0,1/0],_=this.props.elevationCutoff||[-1/0,1/0],v=this.state.fillModel;v.vertexArray.indexBuffer&&v.setIndexBuffer(null),v.setVertexCount(this.state.fillVertexCount);const T={colorDomain:[Math.max(l[0],g[0]),Math.min(l[1],g[1]),Math.max(l[0]-1,g[0]),Math.min(l[1]+1,g[1])],elevationDomain:[Math.max(f[0],_[0]),Math.min(f[1],_[1]),Math.max(f[0]-1,_[0]),Math.min(f[1]+1,_[1])],elevationRange:[s[0]*r,s[1]*r],originCommon:i};v.shaderInputs.setProps({column:{extruded:o,coverage:a,radius:t},hexagon:T}),v.draw(this.context.renderPass)}}Pv.layerName="HexagonCellLayer";const kU=`uniform binOptionsUniforms {
  vec2 hexOriginCommon;
  float radiusCommon;
} binOptions;
`,UU={name:"binOptions",vs:kU,uniformTypes:{hexOriginCommon:"vec2<f32>",radiusCommon:"f32"}};function Vm(){}const VU={gpuAggregation:!0,colorDomain:null,colorRange:sA,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:Vm,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScaleType:"linear",onSetElevationDomain:Vm,radius:{type:"number",min:1,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:n=>n.position},hexagonAggregator:{type:"function",optional:!0,value:null},extruded:!1,material:!0};class Mv extends ma{getAggregatorType(){const{gpuAggregation:e,hexagonAggregator:t,getColorValue:i,getElevationValue:s}=this.props;return e&&(t||i||s)?(ze.warn("Features not supported by GPU aggregation, falling back to CPU")(),"cpu"):e&&li.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){if(e==="cpu"){const{hexagonAggregator:t,radius:i}=this.props;return new pa({dimensions:2,getBin:{sources:["positions"],getValue:({positions:s},r,o)=>{if(t)return t(s,i);const l=this.state.aggregatorViewport.projectPosition(s),{radiusCommon:f,hexOriginCommon:g}=o;return Du([l[0]-g[0],l[1]-g[1]],f)}},getValue:[{sources:["colorWeights"],getValue:({colorWeights:s})=>s},{sources:["elevationWeights"],getValue:({elevationWeights:s})=>s}]})}return new li(this.context.device,{dimensions:2,channelCount:2,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[sn,UU],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float colorWeights;
  in float elevationWeights;
  
  ${OU}

  void getBin(out ivec2 binId) {
    vec3 positionCommon = project_position(positions, positions64Low);
    binId = pointToHexbin(positionCommon.xy, binOptions.radiusCommon);
  }
  void getValue(out vec2 value) {
    value = vec2(colorWeights, elevationWeights);
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},colorWeights:{size:1,accessor:"getColorWeight"},elevationWeights:{size:1,accessor:"getElevationWeight"}})}updateState(e){const t=super.updateState(e),{props:i,oldProps:s,changeFlags:r}=e,{aggregator:o}=this.state;if((r.dataChanged||!this.state.dataAsArray)&&(i.getColorValue||i.getElevationValue)&&(this.state.dataAsArray=Array.from(Ri(i.data).iterable)),t||r.dataChanged||i.radius!==s.radius||i.getColorValue!==s.getColorValue||i.getElevationValue!==s.getElevationValue||i.colorAggregation!==s.colorAggregation||i.elevationAggregation!==s.elevationAggregation){this._updateBinOptions();const{radiusCommon:a,hexOriginCommon:l,binIdRange:f,dataAsArray:g}=this.state;if(o.setProps({binIdRange:f,pointCount:this.getNumInstances(),operations:[i.colorAggregation,i.elevationAggregation],binOptions:{radiusCommon:a,hexOriginCommon:l},onUpdate:this._onAggregationUpdate.bind(this)}),g){const{getColorValue:_,getElevationValue:v}=this.props;o.setProps({customOperations:[_&&(T=>_(T.map(C=>g[C]),{indices:T,data:i.data})),v&&(T=>v(T.map(C=>g[C]),{indices:T,data:i.data}))]})}}return r.updateTriggersChanged&&r.updateTriggersChanged.getColorValue&&o.setNeedsUpdate(0),r.updateTriggersChanged&&r.updateTriggersChanged.getElevationValue&&o.setNeedsUpdate(1),t}_updateBinOptions(){const e=this.getBounds();let t=1,i=[0,0],s=[[0,1],[0,1]],r=this.context.viewport;if(e&&Number.isFinite(e[0][0])){let o=[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2];const{radius:a}=this.props,{unitsPerMeter:l}=r.getDistanceScales(o);t=l[0]*a;const f=Du(r.projectFlat(o),t);o=r.unprojectFlat(Um(f,t));const g=r.constructor;r=r.isGeospatial?new g({longitude:o[0],latitude:o[1],zoom:12}):new Kn({position:[o[0],o[1],0],zoom:12}),i=[Math.fround(r.center[0]),Math.fround(r.center[1])],s=Ed({dataBounds:e,getBinId:_=>{const v=r.projectFlat(_);return v[0]-=i[0],v[1]-=i[1],Du(v,t)},padding:1})}this.setState({radiusCommon:t,hexOriginCommon:i,binIdRange:s,aggregatorViewport:r})}draw(e){e.shaderModuleProps.project&&(e.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(e)}_onAggregationUpdate({channel:e}){const t=this.getCurrentLayer().props,{aggregator:i}=this.state;if(e===0){const s=i.getResult(0);this.setState({colors:new yc(s,i.binCount)}),t.onSetColorDomain(i.getResultDomain(0))}else if(e===1){const s=i.getResult(1);this.setState({elevations:new yc(s,i.binCount)}),t.onSetElevationDomain(i.getResultDomain(1))}}onAttributeChange(e){const{aggregator:t}=this.state;switch(e){case"positions":t.setNeedsUpdate(),this._updateBinOptions();const{radiusCommon:i,hexOriginCommon:s,binIdRange:r}=this.state;t.setProps({binIdRange:r,binOptions:{radiusCommon:i,hexOriginCommon:s}});break;case"colorWeights":t.setNeedsUpdate(0);break;case"elevationWeights":t.setNeedsUpdate(1);break}}renderLayers(){var Se,me;const{aggregator:e,radiusCommon:t,hexOriginCommon:i}=this.state,{elevationScale:s,colorRange:r,elevationRange:o,extruded:a,coverage:l,material:f,transitions:g,colorScaleType:_,lowerPercentile:v,upperPercentile:T,colorDomain:C,elevationScaleType:S,elevationLowerPercentile:R,elevationUpperPercentile:P,elevationDomain:F}=this.props,U=this.getSubLayerClass("cells",Pv),X=e.getBins(),Z=(Se=this.state.colors)==null?void 0:Se.update({scaleType:_,lowerPercentile:v,upperPercentile:T}),se=(me=this.state.elevations)==null?void 0:me.update({scaleType:S,lowerPercentile:R,upperPercentile:P});return!Z||!se?null:new U(this.getSubLayerProps({id:"cells"}),{data:{length:e.binCount,attributes:{getBin:X,getColorValue:Z.attribute,getElevationValue:se.attribute}},dataComparator:(J,q)=>J.length===q.length,updateTriggers:{getBin:[X],getColorValue:[Z.attribute],getElevationValue:[se.attribute]},diskResolution:6,vertices:BU,radius:t,hexOriginCommon:i,elevationScale:s,colorRange:r,colorScaleType:_,elevationRange:o,extruded:a,coverage:l,material:f,colorDomain:Z.domain||C||e.getResultDomain(0),elevationDomain:se.domain||F||e.getResultDomain(1),colorCutoff:Z.cutoff,elevationCutoff:se.cutoff,transitions:g&&{getFillColor:g.getColorValue||g.getColorWeight,getElevation:g.getElevationValue||g.getElevationWeight},extensions:[]})}getPickingInfo(e){const t=e.info,{index:i}=t;if(i>=0){const s=this.state.aggregator.getBin(i);let r;if(s){const o=Um(s.id,this.state.radiusCommon),a=this.context.viewport.unprojectFlat(o);r={col:s.id[0],row:s.id[1],position:a,colorValue:s.value[0],elevationValue:s.value[1],count:s.count},s.pointIndices&&(r.pointIndices=s.pointIndices,r.points=Array.isArray(this.props.data)?s.pointIndices.map(l=>this.props.data[l]):[])}t.object=r}return t}}Mv.layerName="HexagonLayer";Mv.defaultProps=VU;const nt=.5,rt=1/6,re={N:[0,nt],E:[nt,0],S:[0,-.5],W:[-.5,0],NE:[nt,nt],NW:[-.5,nt],SE:[nt,-.5],SW:[-.5,-.5]},hr=[re.W,re.SW,re.S],fr=[re.S,re.SE,re.E],dr=[re.E,re.NE,re.N],gr=[re.NW,re.W,re.N],pr=[[-.5,rt],[-.5,-.16666666666666666],[-.16666666666666666,-.5],[rt,-.5]],mr=[[-.16666666666666666,-.5],[rt,-.5],[nt,-.16666666666666666],[nt,rt]],_r=[[nt,-.16666666666666666],[nt,rt],[rt,nt],[-.16666666666666666,nt]],yr=[[-.5,rt],[-.5,-.16666666666666666],[rt,nt],[-.16666666666666666,nt]],zm=[re.W,re.SW,re.SE,re.E],Hm=[re.S,re.SE,re.NE,re.N],Gm=[re.NW,re.W,re.E,re.NE],Wm=[re.NW,re.SW,re.S,re.N],jm=[[-.5,rt],[-.5,-.16666666666666666],[nt,-.16666666666666666],[nt,rt]],$m=[[-.16666666666666666,-.5],[rt,-.5],[rt,nt],[-.16666666666666666,nt]],zU=[re.NW,re.SW,re.SE,re.NE],Xm=[re.NW,re.SW,re.SE,re.E,re.N],Qm=[re.W,re.SW,re.SE,re.NE,re.N],Ym=[re.NW,re.W,re.S,re.SE,re.NE],Km=[re.NW,re.SW,re.S,re.E,re.NE],qm=[re.NW,re.W,[nt,-.16666666666666666],[nt,rt],re.N],Jm=[[-.16666666666666666,-.5],[rt,-.5],re.E,re.NE,re.N],Zm=[[-.5,rt],[-.5,-.16666666666666666],re.S,re.SE,re.E],e_=[re.W,re.SW,re.S,[rt,nt],[-.16666666666666666,nt]],t_=[re.NW,re.W,[-.16666666666666666,-.5],[rt,-.5],re.N],n_=[[-.5,rt],[-.5,-.16666666666666666],re.E,re.NE,re.N],i_=[re.S,re.SE,re.E,[rt,nt],[-.16666666666666666,nt]],s_=[re.W,re.SW,re.S,[nt,-.16666666666666666],[nt,rt]],r_=[re.W,re.SW,re.SE,re.E,[rt,nt],[-.16666666666666666,nt]],o_=[[-.5,rt],[-.5,-.16666666666666666],re.S,re.SE,re.NE,re.N],a_=[re.NW,re.W,[-.16666666666666666,-.5],[rt,-.5],re.E,re.NE],l_=[re.NW,re.SW,re.S,[nt,-.16666666666666666],[nt,rt],re.N],br=[re.W,re.SW,re.S,re.E,re.NE,re.N],vr=[re.NW,re.W,re.S,re.SE,re.E,re.N],nl=[[-.5,rt],[-.5,-.16666666666666666],[-.16666666666666666,-.5],[rt,-.5],re.E,re.NE,re.N],il=[re.W,re.SW,re.S,[nt,-.16666666666666666],[nt,rt],[rt,nt],[-.16666666666666666,nt]],sl=[re.NW,re.W,[-.16666666666666666,-.5],[rt,-.5],[nt,-.16666666666666666],[nt,rt],re.N],rl=[[-.5,rt],[-.5,-.16666666666666666],re.S,re.SE,re.E,[rt,nt],[-.16666666666666666,nt]],c_=[[-.5,rt],[-.5,-.16666666666666666],[-.16666666666666666,-.5],[rt,-.5],[nt,-.16666666666666666],[nt,rt],[rt,nt],[-.16666666666666666,nt]],HU={0:[],1:[[re.W,re.S]],2:[[re.S,re.E]],3:[[re.W,re.E]],4:[[re.N,re.E]],5:{0:[[re.W,re.S],[re.N,re.E]],1:[[re.W,re.N],[re.S,re.E]]},6:[[re.N,re.S]],7:[[re.W,re.N]],8:[[re.W,re.N]],9:[[re.N,re.S]],10:{0:[[re.W,re.N],[re.S,re.E]],1:[[re.W,re.S],[re.N,re.E]]},11:[[re.N,re.E]],12:[[re.W,re.E]],13:[[re.S,re.E]],14:[[re.W,re.S]],15:[]};function Ie(n){return parseInt(n,4)}const GU={[Ie("0000")]:[],[Ie("2222")]:[],[Ie("2221")]:[hr],[Ie("2212")]:[fr],[Ie("2122")]:[dr],[Ie("1222")]:[gr],[Ie("0001")]:[hr],[Ie("0010")]:[fr],[Ie("0100")]:[dr],[Ie("1000")]:[gr],[Ie("2220")]:[pr],[Ie("2202")]:[mr],[Ie("2022")]:[_r],[Ie("0222")]:[yr],[Ie("0002")]:[pr],[Ie("0020")]:[mr],[Ie("0200")]:[_r],[Ie("2000")]:[yr],[Ie("0011")]:[zm],[Ie("0110")]:[Hm],[Ie("1100")]:[Gm],[Ie("1001")]:[Wm],[Ie("2211")]:[zm],[Ie("2112")]:[Hm],[Ie("1122")]:[Gm],[Ie("1221")]:[Wm],[Ie("2200")]:[jm],[Ie("2002")]:[$m],[Ie("0022")]:[jm],[Ie("0220")]:[$m],[Ie("1111")]:[zU],[Ie("1211")]:[Xm],[Ie("2111")]:[Qm],[Ie("1112")]:[Ym],[Ie("1121")]:[Km],[Ie("1011")]:[Xm],[Ie("0111")]:[Qm],[Ie("1110")]:[Ym],[Ie("1101")]:[Km],[Ie("1200")]:[qm],[Ie("0120")]:[Jm],[Ie("0012")]:[Zm],[Ie("2001")]:[e_],[Ie("1022")]:[qm],[Ie("2102")]:[Jm],[Ie("2210")]:[Zm],[Ie("0221")]:[e_],[Ie("1002")]:[t_],[Ie("2100")]:[n_],[Ie("0210")]:[i_],[Ie("0021")]:[s_],[Ie("1220")]:[t_],[Ie("0122")]:[n_],[Ie("2012")]:[i_],[Ie("2201")]:[s_],[Ie("0211")]:[r_],[Ie("2110")]:[o_],[Ie("1102")]:[a_],[Ie("1021")]:[l_],[Ie("2011")]:[r_],[Ie("0112")]:[o_],[Ie("1120")]:[a_],[Ie("1201")]:[l_],[Ie("2101")]:[br],[Ie("0121")]:[br],[Ie("1012")]:[vr],[Ie("1210")]:[vr],[Ie("0101")]:{0:[hr,dr],1:[br],2:[br]},[Ie("1010")]:{0:[gr,fr],1:[vr],2:[vr]},[Ie("2121")]:{0:[br],1:[br],2:[hr,dr]},[Ie("1212")]:{0:[vr],1:[vr],2:[gr,fr]},[Ie("2120")]:{0:[nl],1:[nl],2:[pr,dr]},[Ie("2021")]:{0:[il],1:[il],2:[hr,_r]},[Ie("1202")]:{0:[sl],1:[sl],2:[gr,mr]},[Ie("0212")]:{0:[rl],1:[rl],2:[fr,yr]},[Ie("0102")]:{0:[pr,dr],1:[nl],2:[nl]},[Ie("0201")]:{0:[hr,_r],1:[il],2:[il]},[Ie("1020")]:{0:[gr,mr],1:[sl],2:[sl]},[Ie("2010")]:{0:[fr,yr],1:[rl],2:[rl]},[Ie("2020")]:{0:[yr,mr],1:[c_],2:[pr,_r]},[Ie("0202")]:{0:[_r,pr],1:[c_],2:[yr,mr]}};function Co(n,e){return Number.isNaN(n)?0:Array.isArray(e)?n<e[0]?0:n<e[1]?1:2:n>=e?1:0}function WU(n){const{x:e,y:t,xRange:i,yRange:s,getValue:r,threshold:o}=n,a=e<i[0],l=e>=i[1]-1,f=t<s[0],g=t>=s[1]-1,_=a||l||f||g;let v=0,T,C,S,R;if(a||g)S=0;else{const U=r(e,t+1);S=Co(U,o),v+=U}if(l||g)R=0;else{const U=r(e+1,t+1);R=Co(U,o),v+=U}if(l||f)C=0;else{const U=r(e+1,t);C=Co(U,o),v+=U}if(a||f)T=0;else{const U=r(e,t);T=Co(U,o),v+=U}let P=-1;Number.isFinite(o)&&(P=S<<3|R<<2|C<<1|T),Array.isArray(o)&&(P=S<<6|R<<4|C<<2|T);let F=0;return _||(F=Co(v/4,o)),{code:P,meanCode:F}}function jU(n){const{x:e,y:t,z:i,code:s,meanCode:r}=n;let o=GU[s];Array.isArray(o)||(o=o[r]);const a=e+1,l=t+1,f=[];return o.forEach(g=>{const _=[];g.forEach(v=>{const T=a+v[0],C=l+v[1];_.push([T,C,i])}),f.push(_)}),f}function $U(n){const{x:e,y:t,z:i,code:s,meanCode:r}=n;let o=HU[s];Array.isArray(o)||(o=o[r]);const a=e+1,l=t+1,f=[];return o.forEach(g=>{g.forEach(_=>{const v=a+_[0],T=l+_[1];f.push([v,T,i])})}),f}function XU({contours:n,getValue:e,xRange:t,yRange:i}){const s=[],r=[];let o=0,a=0;for(let l=0;l<n.length;l++){const f=n[l],g=f.zIndex??l,{threshold:_}=f;for(let v=t[0]-1;v<t[1];v++)for(let T=i[0]-1;T<i[1];T++){const{code:C,meanCode:S}=WU({getValue:e,threshold:_,x:v,y:T,xRange:t,yRange:i}),R={x:v,y:T,z:g,code:C,meanCode:S};if(Array.isArray(_)){const P=jU(R);for(const F of P)r[a++]={vertices:F,contour:f}}else{const P=$U(R);P.length>0&&(s[o++]={vertices:P,contour:f})}}}return{lines:s,polygons:r}}function QU(n){var s,r,o;const{aggregator:e,binIdRange:t,channel:i}=n;if(e instanceof li){const a=(s=e.getResult(i))==null?void 0:s.buffer;if(a){const l=new Float32Array(a.readSyncWebGL().buffer);return YU(l,t)}}if(e instanceof pa){const a=(r=e.getResult(i))==null?void 0:r.value,l=(o=e.getBins())==null?void 0:o.value;if(l&&a)return KU(a,l,e.binCount)}return null}function YU(n,e){const[[t,i],[s,r]]=e,o=i-t,a=r-s;return(l,f)=>(l-=t,f-=s,l<0||l>=o||f<0||f>=a?NaN:n[f*o+l])}function KU(n,e,t){const i={};for(let s=0;s<t;s++){const r=e[s*2],o=e[s*2+1];i[r]=i[r]||{},i[r][o]=n[s]}return(s,r)=>{var o;return((o=i[s])==null?void 0:o[r])??NaN}}const qU=`uniform binOptionsUniforms {
  vec2 cellOriginCommon;
  vec2 cellSizeCommon;
} binOptions;
`,JU={name:"binOptions",vs:qU,uniformTypes:{cellOriginCommon:"vec2<f32>",cellSizeCommon:"vec2<f32>"}},A_=[255,255,255,255],ZU=1,e8={cellSize:{type:"number",min:1,value:1e3},gridOrigin:{type:"array",compare:!0,value:[0,0]},getPosition:{type:"accessor",value:n=>n.position},getWeight:{type:"accessor",value:1},gpuAggregation:!0,aggregation:"SUM",contours:{type:"object",value:[{threshold:1}],optional:!0,compare:3},zOffset:.005};let Bv=class extends ma{getAggregatorType(){return this.props.gpuAggregation&&li.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){return e==="cpu"?new pa({dimensions:2,getBin:{sources:["positions"],getValue:({positions:t},i,s)=>{const o=this.state.aggregatorViewport.projectPosition(t),{cellSizeCommon:a,cellOriginCommon:l}=s;return[Math.floor((o[0]-l[0])/a[0]),Math.floor((o[1]-l[1])/a[1])]}},getValue:[{sources:["counts"],getValue:({counts:t})=>t}],onUpdate:this._onAggregationUpdate.bind(this)}):new li(this.context.device,{dimensions:2,channelCount:1,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[sn,JU],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float counts;

  void getBin(out ivec2 binId) {
    vec3 positionCommon = project_position(positions, positions64Low);
    vec2 gridCoords = floor(positionCommon.xy / binOptions.cellSizeCommon);
    binId = ivec2(gridCoords);
  }
  void getValue(out float value) {
    value = counts;
  }
  `}),onUpdate:this._onAggregationUpdate.bind(this)})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},counts:{size:1,accessor:"getWeight"}})}updateState(e){const t=super.updateState(e),{props:i,oldProps:s,changeFlags:r}=e,{aggregator:o}=this.state;if(t||r.dataChanged||i.cellSize!==s.cellSize||!Kt(i.gridOrigin,s.gridOrigin,1)||i.aggregation!==s.aggregation){this._updateBinOptions();const{cellSizeCommon:a,cellOriginCommon:l,binIdRange:f}=this.state;o.setProps({binIdRange:f,pointCount:this.getNumInstances(),operations:[i.aggregation],binOptions:{cellSizeCommon:a,cellOriginCommon:l}})}return Kt(s.contours,i.contours,2)||this.setState({contourData:null}),t}_updateBinOptions(){const e=this.getBounds(),t=[1,1];let i=[0,0],s=[[0,1],[0,1]],r=this.context.viewport;if(e&&Number.isFinite(e[0][0])){let o=[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2];const{cellSize:a,gridOrigin:l}=this.props,{unitsPerMeter:f}=r.getDistanceScales(o);t[0]=f[0]*a,t[1]=f[1]*a;const g=r.projectFlat(o);i=[Math.floor((g[0]-l[0])/t[0])*t[0]+l[0],Math.floor((g[1]-l[1])/t[1])*t[1]+l[1]],o=r.unprojectFlat(i);const _=r.constructor;r=r.isGeospatial?new _({longitude:o[0],latitude:o[1],zoom:12}):new Kn({position:[o[0],o[1],0],zoom:12}),i=[Math.fround(r.center[0]),Math.fround(r.center[1])],s=Ed({dataBounds:e,getBinId:v=>{const T=r.projectFlat(v);return[Math.floor((T[0]-i[0])/t[0]),Math.floor((T[1]-i[1])/t[1])]}})}this.setState({cellSizeCommon:t,cellOriginCommon:i,binIdRange:s,aggregatorViewport:r})}draw(e){e.shaderModuleProps.project&&(e.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(e)}_onAggregationUpdate(){const{aggregator:e,binIdRange:t}=this.state;this.setState({aggregatedValueReader:QU({aggregator:e,binIdRange:t,channel:0}),contourData:null})}_getContours(){const{aggregatedValueReader:e}=this.state;if(!e)return null;if(!this.state.contourData){const{binIdRange:t}=this.state,{contours:i}=this.props,s=XU({contours:i,getValue:e,xRange:t[0],yRange:t[1]});this.state.contourData=s}return this.state.contourData}onAttributeChange(e){const{aggregator:t}=this.state;switch(e){case"positions":t.setNeedsUpdate(),this._updateBinOptions();const{cellSizeCommon:i,cellOriginCommon:s,binIdRange:r}=this.state;t.setProps({binIdRange:r,binOptions:{cellSizeCommon:i,cellOriginCommon:s}});break;case"counts":t.setNeedsUpdate(0);break}}renderLayers(){const e=this._getContours();if(!e)return null;const{lines:t,polygons:i}=e,{zOffset:s}=this.props,{cellOriginCommon:r,cellSizeCommon:o}=this.state,a=this.getSubLayerClass("lines",co),l=this.getSubLayerClass("bands",da),f=new Ge().translate([r[0],r[1],0]).scale([o[0],o[1],s]),g=t&&t.length>0&&new a(this.getSubLayerProps({id:"lines"}),{data:t,coordinateSystem:Ue.CARTESIAN,modelMatrix:f,getPath:v=>v.vertices,getColor:v=>v.contour.color??A_,getWidth:v=>v.contour.strokeWidth??ZU,widthUnits:"pixels"}),_=i&&i.length>0&&new l(this.getSubLayerProps({id:"bands"}),{data:i,coordinateSystem:Ue.CARTESIAN,modelMatrix:f,getPolygon:v=>v.vertices,getFillColor:v=>v.contour.color??A_});return[g,_]}getPickingInfo(e){const t=e.info,{object:i}=t;return i&&(t.object={contour:i.contour}),t}};Bv.layerName="ContourLayer";Bv.defaultProps=e8;const t8=`#version 300 es
#define SHADER_NAME grid-cell-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec2 instancePositions;
in float instanceElevationValues;
in float instanceColorValues;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
float interp(float value, vec2 domain, vec2 range) {
float r = min(max((value - domain.x) / (domain.y - domain.x), 0.), 1.);
return mix(range.x, range.y, r);
}
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
geometry.pickingColor = instancePickingColors;
if (isnan(instanceColorValues) ||
instanceColorValues < grid.colorDomain.z ||
instanceColorValues > grid.colorDomain.w ||
instanceElevationValues < grid.elevationDomain.z ||
instanceElevationValues > grid.elevationDomain.w
) {
gl_Position = vec4(0.);
return;
}
vec2 commonPosition = (instancePositions + (positions.xy + 1.0) / 2.0 * column.coverage) * grid.sizeCommon + grid.originCommon - project.commonOrigin.xy;
geometry.position = vec4(commonPosition, 0.0, 1.0);
geometry.normal = project_normal(normals);
float elevation = 0.0;
if (column.extruded) {
elevation = interp(instanceElevationValues, grid.elevationDomain.xy, grid.elevationRange);
elevation = project_size(elevation);
geometry.position.z = (positions.z + 1.0) / 2.0 * elevation;
}
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vColor = interp(instanceColorValues, grid.colorDomain.xy, colorRange);
vColor.a *= layer.opacity;
if (column.extruded) {
vColor.rgb = lighting_getLightColor(vColor.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,n8=`uniform gridUniforms {
  vec4 colorDomain;
  vec4 elevationDomain;
  vec2 elevationRange;
  vec2 originCommon;
  vec2 sizeCommon;
} grid;
`,i8={name:"grid",vs:n8,uniformTypes:{colorDomain:"vec4<f32>",elevationDomain:"vec4<f32>",elevationRange:"vec2<f32>",originCommon:"vec2<f32>",sizeCommon:"vec2<f32>"}};class Ov extends lo{getShaders(){const e=super.getShaders();return e.modules.push(i8),{...e,vs:t8}}initializeState(){super.initializeState();const e=this.getAttributeManager();e.remove(["instanceElevations","instanceFillColors","instanceLineColors","instanceStrokeWidths"]),e.addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceColorValues:{size:1,type:"float32",accessor:"getColorValue"},instanceElevationValues:{size:1,type:"float32",accessor:"getElevationValue"}})}updateState(e){var r;super.updateState(e);const{props:t,oldProps:i}=e,s=this.state.fillModel;if(i.colorRange!==t.colorRange){(r=this.state.colorTexture)==null||r.destroy(),this.state.colorTexture=wd(this.context.device,t.colorRange,t.colorScaleType);const o={colorRange:this.state.colorTexture};s.shaderInputs.setProps({grid:o})}else i.colorScaleType!==t.colorScaleType&&Td(this.state.colorTexture,t.colorScaleType)}finalizeState(e){var t;super.finalizeState(e),(t=this.state.colorTexture)==null||t.destroy()}_updateGeometry(){const e=new _b;this.state.fillModel.setGeometry(e)}draw({uniforms:e}){const{cellOriginCommon:t,cellSizeCommon:i,elevationRange:s,elevationScale:r,extruded:o,coverage:a,colorDomain:l,elevationDomain:f}=this.props,g=this.props.colorCutoff||[-1/0,1/0],_=this.props.elevationCutoff||[-1/0,1/0],v=this.state.fillModel,T={colorDomain:[Math.max(l[0],g[0]),Math.min(l[1],g[1]),Math.max(l[0]-1,g[0]),Math.min(l[1]+1,g[1])],elevationDomain:[Math.max(f[0],_[0]),Math.min(f[1],_[1]),Math.max(f[0]-1,_[0]),Math.min(f[1]+1,_[1])],elevationRange:[s[0]*r,s[1]*r],originCommon:t,sizeCommon:i};v.shaderInputs.setProps({column:{extruded:o,coverage:a},grid:T}),v.draw(this.context.renderPass)}}Ov.layerName="GridCellLayer";const s8=`uniform binOptionsUniforms {
  vec2 cellOriginCommon;
  vec2 cellSizeCommon;
} binOptions;
`,r8={name:"binOptions",vs:s8,uniformTypes:{cellOriginCommon:"vec2<f32>",cellSizeCommon:"vec2<f32>"}};function u_(){}const o8={gpuAggregation:!0,colorDomain:null,colorRange:sA,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:u_,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScaleType:"linear",onSetElevationDomain:u_,cellSize:{type:"number",min:0,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:n=>n.position},gridAggregator:{type:"function",optional:!0,value:null},extruded:!1,material:!0};class Dv extends ma{getAggregatorType(){const{gpuAggregation:e,gridAggregator:t,getColorValue:i,getElevationValue:s}=this.props;return e&&(t||i||s)?(ze.warn("Features not supported by GPU aggregation, falling back to CPU")(),"cpu"):e&&li.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){if(e==="cpu"){const{gridAggregator:t,cellSize:i}=this.props;return new pa({dimensions:2,getBin:{sources:["positions"],getValue:({positions:s},r,o)=>{if(t)return t(s,i);const l=this.state.aggregatorViewport.projectPosition(s),{cellSizeCommon:f,cellOriginCommon:g}=o;return[Math.floor((l[0]-g[0])/f[0]),Math.floor((l[1]-g[1])/f[1])]}},getValue:[{sources:["colorWeights"],getValue:({colorWeights:s})=>s},{sources:["elevationWeights"],getValue:({elevationWeights:s})=>s}]})}return new li(this.context.device,{dimensions:2,channelCount:2,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[sn,r8],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float colorWeights;
  in float elevationWeights;

  void getBin(out ivec2 binId) {
    vec3 positionCommon = project_position(positions, positions64Low);
    vec2 gridCoords = floor(positionCommon.xy / binOptions.cellSizeCommon);
    binId = ivec2(gridCoords);
  }
  void getValue(out vec2 value) {
    value = vec2(colorWeights, elevationWeights);
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},colorWeights:{size:1,accessor:"getColorWeight"},elevationWeights:{size:1,accessor:"getElevationWeight"}})}updateState(e){const t=super.updateState(e),{props:i,oldProps:s,changeFlags:r}=e,{aggregator:o}=this.state;if((r.dataChanged||!this.state.dataAsArray)&&(i.getColorValue||i.getElevationValue)&&(this.state.dataAsArray=Array.from(Ri(i.data).iterable)),t||r.dataChanged||i.cellSize!==s.cellSize||i.getColorValue!==s.getColorValue||i.getElevationValue!==s.getElevationValue||i.colorAggregation!==s.colorAggregation||i.elevationAggregation!==s.elevationAggregation){this._updateBinOptions();const{cellSizeCommon:a,cellOriginCommon:l,binIdRange:f,dataAsArray:g}=this.state;if(o.setProps({binIdRange:f,pointCount:this.getNumInstances(),operations:[i.colorAggregation,i.elevationAggregation],binOptions:{cellSizeCommon:a,cellOriginCommon:l},onUpdate:this._onAggregationUpdate.bind(this)}),g){const{getColorValue:_,getElevationValue:v}=this.props;o.setProps({customOperations:[_&&(T=>_(T.map(C=>g[C]),{indices:T,data:i.data})),v&&(T=>v(T.map(C=>g[C]),{indices:T,data:i.data}))]})}}return r.updateTriggersChanged&&r.updateTriggersChanged.getColorValue&&o.setNeedsUpdate(0),r.updateTriggersChanged&&r.updateTriggersChanged.getElevationValue&&o.setNeedsUpdate(1),t}_updateBinOptions(){const e=this.getBounds(),t=[1,1];let i=[0,0],s=[[0,1],[0,1]],r=this.context.viewport;if(e&&Number.isFinite(e[0][0])){let o=[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2];const{cellSize:a}=this.props,{unitsPerMeter:l}=r.getDistanceScales(o);t[0]=l[0]*a,t[1]=l[1]*a;const f=r.projectFlat(o);i=[Math.floor(f[0]/t[0])*t[0],Math.floor(f[1]/t[1])*t[1]],o=r.unprojectFlat(i);const g=r.constructor;r=r.isGeospatial?new g({longitude:o[0],latitude:o[1],zoom:12}):new Kn({position:[o[0],o[1],0],zoom:12}),i=[Math.fround(r.center[0]),Math.fround(r.center[1])],s=Ed({dataBounds:e,getBinId:_=>{const v=r.projectFlat(_);return[Math.floor((v[0]-i[0])/t[0]),Math.floor((v[1]-i[1])/t[1])]}})}this.setState({cellSizeCommon:t,cellOriginCommon:i,binIdRange:s,aggregatorViewport:r})}draw(e){e.shaderModuleProps.project&&(e.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(e)}_onAggregationUpdate({channel:e}){const t=this.getCurrentLayer().props,{aggregator:i}=this.state;if(e===0){const s=i.getResult(0);this.setState({colors:new yc(s,i.binCount)}),t.onSetColorDomain(i.getResultDomain(0))}else if(e===1){const s=i.getResult(1);this.setState({elevations:new yc(s,i.binCount)}),t.onSetElevationDomain(i.getResultDomain(1))}}onAttributeChange(e){const{aggregator:t}=this.state;switch(e){case"positions":t.setNeedsUpdate(),this._updateBinOptions();const{cellSizeCommon:i,cellOriginCommon:s,binIdRange:r}=this.state;t.setProps({binIdRange:r,binOptions:{cellSizeCommon:i,cellOriginCommon:s}});break;case"colorWeights":t.setNeedsUpdate(0);break;case"elevationWeights":t.setNeedsUpdate(1);break}}renderLayers(){var Se,me;const{aggregator:e,cellOriginCommon:t,cellSizeCommon:i}=this.state,{elevationScale:s,colorRange:r,elevationRange:o,extruded:a,coverage:l,material:f,transitions:g,colorScaleType:_,lowerPercentile:v,upperPercentile:T,colorDomain:C,elevationScaleType:S,elevationLowerPercentile:R,elevationUpperPercentile:P,elevationDomain:F}=this.props,U=this.getSubLayerClass("cells",Ov),X=e.getBins(),Z=(Se=this.state.colors)==null?void 0:Se.update({scaleType:_,lowerPercentile:v,upperPercentile:T}),se=(me=this.state.elevations)==null?void 0:me.update({scaleType:S,lowerPercentile:R,upperPercentile:P});return!Z||!se?null:new U(this.getSubLayerProps({id:"cells"}),{data:{length:e.binCount,attributes:{getBin:X,getColorValue:Z.attribute,getElevationValue:se.attribute}},dataComparator:(J,q)=>J.length===q.length,updateTriggers:{getBin:[X],getColorValue:[Z.attribute],getElevationValue:[se.attribute]},cellOriginCommon:t,cellSizeCommon:i,elevationScale:s,colorRange:r,colorScaleType:_,elevationRange:o,extruded:a,coverage:l,material:f,colorDomain:Z.domain||C||e.getResultDomain(0),elevationDomain:se.domain||F||e.getResultDomain(1),colorCutoff:Z.cutoff,elevationCutoff:se.cutoff,transitions:g&&{getFillColor:g.getColorValue||g.getColorWeight,getElevation:g.getElevationValue||g.getElevationWeight},extensions:[]})}getPickingInfo(e){const t=e.info,{index:i}=t;if(i>=0){const s=this.state.aggregator.getBin(i);let r;s&&(r={col:s.id[0],row:s.id[1],colorValue:s.value[0],elevationValue:s.value[1],count:s.count},s.pointIndices&&(r.pointIndices=s.pointIndices,r.points=Array.isArray(this.props.data)?s.pointIndices.map(o=>this.props.data[o]):[])),t.object=r}return t}}Dv.layerName="GridLayer";Dv.defaultProps=o8;function a8(n){const e=n.map(a=>a[0]),t=n.map(a=>a[1]),i=Math.min.apply(null,e),s=Math.max.apply(null,e),r=Math.min.apply(null,t),o=Math.max.apply(null,t);return[i,r,s,o]}function l8(n,e){return e[0]>=n[0]&&e[2]<=n[2]&&e[1]>=n[1]&&e[3]<=n[3]}const h_=new Float32Array(12);function f_(n,e=2){let t=0;for(const i of n)for(let s=0;s<e;s++)h_[t++]=i[s]||0;return h_}function c8(n,e,t){const[i,s,r,o]=n,a=r-i,l=o-s;let f=a,g=l;a/l<e/t?f=e/t*l:g=t/e*a,f<e&&(f=e,g=t);const _=(r+i)/2,v=(o+s)/2;return[_-f/2,v-g/2,_+f/2,v+g/2]}function A8(n,e){const[t,i,s,r]=e;return[(n[0]-t)/(s-t),(n[1]-i)/(r-i)]}const u8=`#version 300 es
#define SHADER_NAME heatp-map-layer-vertex-shader
uniform sampler2D maxTexture;
in vec3 positions;
in vec2 texCoords;
out vec2 vTexCoords;
out float vIntensityMin;
out float vIntensityMax;
void main(void) {
gl_Position = project_position_to_clipspace(positions, vec3(0.0), vec3(0.0));
vTexCoords = texCoords;
vec4 maxTexture = texture(maxTexture, vec2(0.5));
float maxValue = triangle.aggregationMode < 0.5 ? maxTexture.r : maxTexture.g;
float minValue = maxValue * triangle.threshold;
if (triangle.colorDomain[1] > 0.) {
maxValue = triangle.colorDomain[1];
minValue = triangle.colorDomain[0];
}
vIntensityMax = triangle.intensity / maxValue;
vIntensityMin = triangle.intensity / minValue;
}
`,h8=`#version 300 es
#define SHADER_NAME triangle-layer-fragment-shader
precision highp float;
uniform sampler2D weightsTexture;
uniform sampler2D colorTexture;
in vec2 vTexCoords;
in float vIntensityMin;
in float vIntensityMax;
out vec4 fragColor;
vec4 getLinearColor(float value) {
float factor = clamp(value * vIntensityMax, 0., 1.);
vec4 color = texture(colorTexture, vec2(factor, 0.5));
color.a *= min(value * vIntensityMin, 1.0);
return color;
}
void main(void) {
vec4 weights = texture(weightsTexture, vTexCoords);
float weight = weights.r;
if (triangle.aggregationMode > 0.5) {
weight /= max(1.0, weights.a);
}
if (weight <= 0.) {
discard;
}
vec4 linearColor = getLinearColor(weight);
linearColor.a *= layer.opacity;
fragColor = linearColor;
}
`,d_=`uniform triangleUniforms {
  float aggregationMode;
  vec2 colorDomain;
  float intensity;
  float threshold;
} triangle;
`,f8={name:"triangle",vs:d_,fs:d_,uniformTypes:{aggregationMode:"f32",colorDomain:"vec2<f32>",intensity:"f32",threshold:"f32"}};class Nv extends rn{getShaders(){return super.getShaders({vs:u8,fs:h8,modules:[sn,f8]})}initializeState({device:e}){this.setState({model:this._getModel(e)})}_getModel(e){const{vertexCount:t,data:i}=this.props;return new Nt(e,{...this.getShaders(),id:this.props.id,attributes:i.attributes,bufferLayout:[{name:"positions",format:"float32x3"},{name:"texCoords",format:"float32x2"}],topology:"triangle-strip",vertexCount:t})}draw(){const{model:e}=this.state,{aggregationMode:t,colorDomain:i,intensity:s,threshold:r,colorTexture:o,maxTexture:a,weightsTexture:l}=this.props,f={aggregationMode:t,colorDomain:i,intensity:s,threshold:r,colorTexture:o,maxTexture:a,weightsTexture:l};e.shaderInputs.setProps({triangle:f}),e.draw(this.context.renderPass)}}Nv.layerName="TriangleLayer";function d8(n,e){const t={};for(const i in n)e.includes(i)||(t[i]=n[i]);return t}class Fv extends gi{initializeAggregationLayer(e){super.initializeState(this.context),this.setState({ignoreProps:d8(this.constructor._propTypes,e.data.props),dimensions:e})}updateState(e){super.updateState(e);const{changeFlags:t}=e;if(t.extensionsChanged){const i=this.getShaders({});i&&i.defines&&(i.defines.NON_INSTANCED_MODEL=1),this.updateShaders(i)}this._updateAttributes()}updateAttributes(e){this.setState({changedAttributes:e})}getAttributes(){return this.getAttributeManager().getAttributes()}getModuleSettings(){const{viewport:e,mousePosition:t,device:i}=this.context;return Object.assign(Object.create(this.props),{viewport:e,mousePosition:t,picking:{isActive:0},devicePixelRatio:i.canvasContext.cssToDeviceRatio()})}updateShaders(e){}isAggregationDirty(e,t={}){const{props:i,oldProps:s,changeFlags:r}=e,{compareAll:o=!1,dimension:a}=t,{ignoreProps:l}=this.state,{props:f,accessors:g=[]}=a,{updateTriggersChanged:_}=r;if(r.dataChanged)return!0;if(_){if(_.all)return!0;for(const v of g)if(_[v])return!0}if(o)return r.extensionsChanged?!0:ld({oldProps:s,newProps:i,ignoreProps:l,propTypes:this.constructor._propTypes});for(const v of f)if(i[v]!==s[v])return!0;return!1}isAttributeChanged(e){const{changedAttributes:t}=this.state;return e?t&&t[e]!==void 0:!g8(t)}_getAttributeManager(){return new tA(this.context.device,{id:this.props.id,stats:this.context.stats})}}Fv.layerName="AggregationLayer";function g8(n){let e=!0;for(const t in n){e=!1;break}return e}const g_=`#version 300 es
in vec3 positions;
in vec3 positions64Low;
in float weights;
out vec4 weightsTexture;
void main()
{
weightsTexture = vec4(weights * weight.weightsScale, 0., 0., 1.);
float radiusTexels = project_pixel_size(weight.radiusPixels) * weight.textureWidth / (weight.commonBounds.z - weight.commonBounds.x);
gl_PointSize = radiusTexels * 2.;
vec3 commonPosition = project_position(positions, positions64Low);
gl_Position.xy = (commonPosition.xy - weight.commonBounds.xy) / (weight.commonBounds.zw - weight.commonBounds.xy) ;
gl_Position.xy = (gl_Position.xy * 2.) - (1.);
gl_Position.w = 1.0;
}
`,p_=`#version 300 es
in vec4 weightsTexture;
out vec4 fragColor;
float gaussianKDE(float u){
return pow(2.71828, -u*u/0.05555)/(1.77245385*0.166666);
}
void main()
{
float dist = length(gl_PointCoord - vec2(0.5, 0.5));
if (dist > 0.5) {
discard;
}
fragColor = weightsTexture * gaussianKDE(2. * dist);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,p8=`#version 300 es
uniform sampler2D inTexture;
out vec4 outTexture;
void main()
{
int yIndex = gl_VertexID / int(maxWeight.textureSize);
int xIndex = gl_VertexID - (yIndex * int(maxWeight.textureSize));
vec2 uv = (0.5 + vec2(float(xIndex), float(yIndex))) / maxWeight.textureSize;
outTexture = texture(inTexture, uv);
gl_Position = vec4(0.0, 0.0, 0.0, 1.0);
gl_PointSize = 1.0;
}
`,m8=`#version 300 es
in vec4 outTexture;
out vec4 fragColor;
void main() {
fragColor = outTexture;
fragColor.g = outTexture.r / max(1.0, outTexture.a);
}
`,_8=`uniform weightUniforms {
  vec4 commonBounds;
  float radiusPixels;
  float textureWidth;
  float weightsScale;
} weight;
`,y8={name:"weight",vs:_8,uniformTypes:{commonBounds:"vec4<f32>",radiusPixels:"f32",textureWidth:"f32",weightsScale:"f32"}},b8={name:"maxWeight",vs:`uniform maxWeightUniforms {
  float textureSize;
} maxWeight;
`,uniformTypes:{textureSize:"f32"}},v8=2,Nu={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}},m_=[0,0],T8={SUM:0,MEAN:1},w8={getPosition:{type:"accessor",value:n=>n.position},getWeight:{type:"accessor",value:1},intensity:{type:"number",min:0,value:1},radiusPixels:{type:"number",min:1,max:100,value:50},colorRange:sA,threshold:{type:"number",min:0,max:1,value:.05},colorDomain:{type:"array",value:null,optional:!0},aggregation:"SUM",weightsTextureSize:{type:"number",min:128,max:2048,value:2048},debounceTimeout:{type:"number",min:0,max:1e3,value:500}},E8=["float32-renderable-webgl","texture-blend-float-webgl"],x8={data:{props:["radiusPixels"]}};class Lv extends Fv{getShaders(e){let t=[sn];return e.modules&&(t=[...t,...e.modules]),super.getShaders({...e,modules:t})}initializeState(){super.initializeAggregationLayer(x8),this.setState({colorDomain:m_}),this._setupTextureParams(),this._setupAttributes(),this._setupResources()}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState(e){super.updateState(e),this._updateHeatmapState(e)}_updateHeatmapState(e){const{props:t,oldProps:i}=e,s=this._getChangeFlags(e);(s.dataChanged||s.viewportChanged)&&(s.boundsChanged=this._updateBounds(s.dataChanged),this._updateTextureRenderingBounds()),s.dataChanged||s.boundsChanged?(clearTimeout(this.state.updateTimer),this.setState({isWeightMapDirty:!0})):s.viewportZoomChanged&&this._debouncedUpdateWeightmap(),t.colorRange!==i.colorRange&&this._updateColorTexture(e),this.state.isWeightMapDirty&&this._updateWeightmap(),this.setState({zoom:e.context.viewport.zoom})}renderLayers(){const{weightsTexture:e,triPositionBuffer:t,triTexCoordBuffer:i,maxWeightsTexture:s,colorTexture:r,colorDomain:o}=this.state,{updateTriggers:a,intensity:l,threshold:f,aggregation:g}=this.props,_=this.getSubLayerClass("triangle",Nv);return new _(this.getSubLayerProps({id:"triangle-layer",updateTriggers:a}),{coordinateSystem:Ue.DEFAULT,data:{attributes:{positions:t,texCoords:i}},vertexCount:4,maxTexture:s,colorTexture:r,aggregationMode:T8[g]||0,weightsTexture:e,intensity:l,threshold:f,colorDomain:o})}finalizeState(e){super.finalizeState(e);const{weightsTransform:t,weightsTexture:i,maxWeightTransform:s,maxWeightsTexture:r,triPositionBuffer:o,triTexCoordBuffer:a,colorTexture:l,updateTimer:f}=this.state;t==null||t.destroy(),i==null||i.destroy(),s==null||s.destroy(),r==null||r.destroy(),o==null||o.destroy(),a==null||a.destroy(),l==null||l.destroy(),f&&clearTimeout(f)}_getAttributeManager(){return new tA(this.context.device,{id:this.props.id,stats:this.context.stats})}_getChangeFlags(e){const t={},{dimensions:i}=this.state;t.dataChanged=this.isAttributeChanged()&&"attribute changed"||this.isAggregationDirty(e,{compareAll:!0,dimension:i.data})&&"aggregation is dirty",t.viewportChanged=e.changeFlags.viewportChanged;const{zoom:s}=this.state;return(!e.context.viewport||e.context.viewport.zoom!==s)&&(t.viewportZoomChanged=!0),t}_createTextures(){const{textureSize:e,format:t}=this.state;this.setState({weightsTexture:this.context.device.createTexture({...Nu,width:e,height:e,format:t}),maxWeightsTexture:this.context.device.createTexture({...Nu,width:1,height:1,format:t})})}_setupAttributes(){this.getAttributeManager().add({positions:{size:3,type:"float64",accessor:"getPosition"},weights:{size:1,accessor:"getWeight"}}),this.setState({positionAttributeName:"positions"})}_setupTextureParams(){const{device:e}=this.context,{weightsTextureSize:t}=this.props,i=Math.min(t,e.limits.maxTextureDimension2D),s=E8.every(a=>e.features.has(a)),r=s?"rgba32float":"rgba8unorm",o=s?1:1/255;this.setState({textureSize:i,format:r,weightsScale:o}),s||ze.warn(`HeatmapLayer: ${this.id} rendering to float texture not supported, falling back to low precision format`)()}_createWeightsTransform(e){let{weightsTransform:t}=this.state;const{weightsTexture:i}=this.state,s=this.getAttributeManager();t==null||t.destroy(),t=new bp(this.context.device,{id:`${this.id}-weights-transform`,bufferLayout:s.getBufferLayouts(),vertexCount:1,targetTexture:i,parameters:{depthWriteEnabled:!1,blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"},topology:"point-list",...e,modules:[...e.modules,y8]}),this.setState({weightsTransform:t})}_setupResources(){this._createTextures();const{device:e}=this.context,{textureSize:t,weightsTexture:i,maxWeightsTexture:s}=this.state,r=this.getShaders({vs:g_,fs:p_});this._createWeightsTransform(r);const o=this.getShaders({vs:p8,fs:m8,modules:[b8]}),a=new bp(e,{id:`${this.id}-max-weights-transform`,targetTexture:s,...o,vertexCount:t*t,topology:"point-list",parameters:{depthWriteEnabled:!1,blendColorOperation:"max",blendAlphaOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}}),l={inTexture:i,textureSize:t};a.model.shaderInputs.setProps({maxWeight:l}),this.setState({weightsTexture:i,maxWeightsTexture:s,maxWeightTransform:a,zoom:null,triPositionBuffer:e.createBuffer({byteLength:48}),triTexCoordBuffer:e.createBuffer({byteLength:48})})}updateShaders(e){this._createWeightsTransform({vs:g_,fs:p_,...e})}_updateMaxWeightValue(){const{maxWeightTransform:e}=this.state;e.run({parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]})}_updateBounds(e=!1){const{viewport:t}=this.context,i=[t.unproject([0,0]),t.unproject([t.width,0]),t.unproject([0,t.height]),t.unproject([t.width,t.height])].map(a=>a.map(Math.fround)),s=a8(i),r={visibleWorldBounds:s,viewportCorners:i};let o=!1;if(e||!this.state.worldBounds||!l8(this.state.worldBounds,s)){const a=this._worldToCommonBounds(s),l=this._commonToWorldBounds(a);this.props.coordinateSystem===Ue.LNGLAT&&(l[1]=Math.max(l[1],-85.051129),l[3]=Math.min(l[3],85.051129),l[0]=Math.max(l[0],-360),l[2]=Math.min(l[2],360));const f=this._worldToCommonBounds(l);r.worldBounds=l,r.normalizedCommonBounds=f,o=!0}return this.setState(r),o}_updateTextureRenderingBounds(){const{triPositionBuffer:e,triTexCoordBuffer:t,normalizedCommonBounds:i,viewportCorners:s}=this.state,{viewport:r}=this.context;e.write(f_(s,3));const o=s.map(a=>A8(r.projectPosition(a),i));t.write(f_(o,2))}_updateColorTexture(e){const{colorRange:t}=e.props;let{colorTexture:i}=this.state;const s=Cv(t,!1,Uint8Array);i&&(i==null?void 0:i.width)===t.length?i.setTexture2DData({data:s}):(i==null||i.destroy(),i=this.context.device.createTexture({...Nu,data:s,width:t.length,height:1})),this.setState({colorTexture:i})}_updateWeightmap(){const{radiusPixels:e,colorDomain:t,aggregation:i}=this.props,{worldBounds:s,textureSize:r,weightsScale:o,weightsTexture:a}=this.state,l=this.state.weightsTransform;this.state.isWeightMapDirty=!1;const f=this._worldToCommonBounds(s,{useLayerCoordinateSystem:!0});if(t&&i==="SUM"){const{viewport:U}=this.context,X=U.distanceScales.metersPerUnit[2]*(f[2]-f[0])/r;this.state.colorDomain=t.map(Z=>Z*X*o)}else this.state.colorDomain=t||m_;const _=this.getAttributeManager().getAttributes(),v=this.getModuleSettings();this._setModelAttributes(l.model,_),l.model.setVertexCount(this.getNumInstances());const T={radiusPixels:e,commonBounds:f,textureWidth:r,weightsScale:o,weightsTexture:a},{viewport:C,devicePixelRatio:S,coordinateSystem:R,coordinateOrigin:P}=v,{modelMatrix:F}=this.props;l.model.shaderInputs.setProps({project:{viewport:C,devicePixelRatio:S,modelMatrix:F,coordinateSystem:R,coordinateOrigin:P},weight:T}),l.run({parameters:{viewport:[0,0,r,r]},clearColor:[0,0,0,0]}),this._updateMaxWeightValue()}_debouncedUpdateWeightmap(e=!1){let{updateTimer:t}=this.state;const{debounceTimeout:i}=this.props;e?(t=null,this._updateBounds(!0),this._updateTextureRenderingBounds(),this.setState({isWeightMapDirty:!0})):(this.setState({isWeightMapDirty:!1}),clearTimeout(t),t=setTimeout(this._debouncedUpdateWeightmap.bind(this,!0),i)),this.setState({updateTimer:t})}_worldToCommonBounds(e,t={}){const{useLayerCoordinateSystem:i=!1}=t,[s,r,o,a]=e,{viewport:l}=this.context,{textureSize:f}=this.state,{coordinateSystem:g}=this.props,_=i&&(g===Ue.LNGLAT_OFFSETS||g===Ue.METER_OFFSETS),v=_?l.projectPosition(this.props.coordinateOrigin):[0,0],T=f*v8/l.scale;let C,S;return i&&!_?(C=this.projectPosition([s,r,0]),S=this.projectPosition([o,a,0])):(C=l.projectPosition([s,r,0]),S=l.projectPosition([o,a,0])),c8([C[0]-v[0],C[1]-v[1],S[0]-v[0],S[1]-v[1]],T,T)}_commonToWorldBounds(e){const[t,i,s,r]=e,{viewport:o}=this.context,a=o.unprojectPosition([t,i]),l=o.unprojectPosition([s,r]);return a.slice(0,2).concat(l.slice(0,2))}}Lv.layerName="HeatmapLayer";Lv.defaultProps=w8;const C8={getHeight:{type:"accessor",value:0},greatCircle:!0};class kv extends dd{}kv.layerName="GreatCircleLayer";kv.defaultProps=C8;const S8={...Ao.defaultProps};class uo extends gi{indexToBounds(){return null}renderLayers(){const{elevationScale:e,extruded:t,wireframe:i,filled:s,stroked:r,lineWidthUnits:o,lineWidthScale:a,lineWidthMinPixels:l,lineWidthMaxPixels:f,lineJointRounded:g,lineMiterLimit:_,lineDashJustified:v,getElevation:T,getFillColor:C,getLineColor:S,getLineWidth:R}=this.props,{updateTriggers:P,material:F,transitions:U}=this.props,X=this.getSubLayerClass("cell",Ao),{updateTriggers:Z,...se}=this.indexToBounds()||{};return new X({filled:s,wireframe:i,extruded:t,elevationScale:e,stroked:r,lineWidthUnits:o,lineWidthScale:a,lineWidthMinPixels:l,lineWidthMaxPixels:f,lineJointRounded:g,lineMiterLimit:_,lineDashJustified:v,material:F,transitions:U,getElevation:T,getFillColor:C,getLineColor:S,getLineWidth:R},this.getSubLayerProps({id:"cell",updateTriggers:P&&{...Z,getElevation:P.getElevation,getFillColor:P.getFillColor,getLineColor:P.getLineColor,getLineWidth:P.getLineWidth}}),se)}}uo.layerName="GeoCellLayer";uo.defaultProps=S8;function I8(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Bl={exports:{}},R8=Bl.exports,__;function P8(){return __||(__=1,function(n){/**
 * @license long.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
 * Released under the Apache License, Version 2.0
 * see: https://github.com/dcodeIO/long.js for details
 */(function(e,t){typeof I8=="function"&&n&&n.exports?n.exports=t():(e.dcodeIO=e.dcodeIO||{}).Long=t()})(R8,function(){function e(q,L,fe){this.low=q|0,this.high=L|0,this.unsigned=!!fe}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1});function t(q){return(q&&q.__isLong__)===!0}e.isLong=t;var i={},s={};function r(q,L){var fe,we,Me;return L?(q>>>=0,(Me=0<=q&&q<256)&&(we=s[q],we)?we:(fe=a(q,(q|0)<0?-1:0,!0),Me&&(s[q]=fe),fe)):(q|=0,(Me=-128<=q&&q<128)&&(we=i[q],we)?we:(fe=a(q,q<0?-1:0,!1),Me&&(i[q]=fe),fe))}e.fromInt=r;function o(q,L){if(isNaN(q)||!isFinite(q))return L?F:P;if(L){if(q<0)return F;if(q>=C)return Se}else{if(q<=-9223372036854776e3)return me;if(q+1>=S)return se}return q<0?o(-q,L).neg():a(q%T|0,q/T|0,L)}e.fromNumber=o;function a(q,L,fe){return new e(q,L,fe)}e.fromBits=a;var l=Math.pow;function f(q,L,fe){if(q.length===0)throw Error("empty string");if(q==="NaN"||q==="Infinity"||q==="+Infinity"||q==="-Infinity")return P;if(typeof L=="number"?(fe=L,L=!1):L=!!L,fe=fe||10,fe<2||36<fe)throw RangeError("radix");var we;if((we=q.indexOf("-"))>0)throw Error("interior hyphen");if(we===0)return f(q.substring(1),L,fe).neg();for(var Me=o(l(fe,8)),Fe=P,z=0;z<q.length;z+=8){var Q=Math.min(8,q.length-z),W=parseInt(q.substring(z,z+Q),fe);if(Q<8){var Ae=o(l(fe,Q));Fe=Fe.mul(Ae).add(o(W))}else Fe=Fe.mul(Me),Fe=Fe.add(o(W))}return Fe.unsigned=L,Fe}e.fromString=f;function g(q){return q instanceof e?q:typeof q=="number"?o(q):typeof q=="string"?f(q):a(q.low,q.high,q.unsigned)}e.fromValue=g;var _=65536,v=1<<24,T=_*_,C=T*T,S=C/2,R=r(v),P=r(0);e.ZERO=P;var F=r(0,!0);e.UZERO=F;var U=r(1);e.ONE=U;var X=r(1,!0);e.UONE=X;var Z=r(-1);e.NEG_ONE=Z;var se=a(-1,2147483647,!1);e.MAX_VALUE=se;var Se=a(-1,-1,!0);e.MAX_UNSIGNED_VALUE=Se;var me=a(0,-2147483648,!1);e.MIN_VALUE=me;var J=e.prototype;return J.toInt=function(){return this.unsigned?this.low>>>0:this.low},J.toNumber=function(){return this.unsigned?(this.high>>>0)*T+(this.low>>>0):this.high*T+(this.low>>>0)},J.toString=function(L){if(L=L||10,L<2||36<L)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(me)){var fe=o(L),we=this.div(fe),Me=we.mul(fe).sub(this);return we.toString(L)+Me.toInt().toString(L)}else return"-"+this.neg().toString(L);for(var Fe=o(l(L,6),this.unsigned),z=this,Q="";;){var W=z.div(Fe),Ae=z.sub(W.mul(Fe)).toInt()>>>0,le=Ae.toString(L);if(z=W,z.isZero())return le+Q;for(;le.length<6;)le="0"+le;Q=""+le+Q}},J.getHighBits=function(){return this.high},J.getHighBitsUnsigned=function(){return this.high>>>0},J.getLowBits=function(){return this.low},J.getLowBitsUnsigned=function(){return this.low>>>0},J.getNumBitsAbs=function(){if(this.isNegative())return this.eq(me)?64:this.neg().getNumBitsAbs();for(var L=this.high!=0?this.high:this.low,fe=31;fe>0&&(L&1<<fe)==0;fe--);return this.high!=0?fe+33:fe+1},J.isZero=function(){return this.high===0&&this.low===0},J.isNegative=function(){return!this.unsigned&&this.high<0},J.isPositive=function(){return this.unsigned||this.high>=0},J.isOdd=function(){return(this.low&1)===1},J.isEven=function(){return(this.low&1)===0},J.equals=function(L){return t(L)||(L=g(L)),this.unsigned!==L.unsigned&&this.high>>>31===1&&L.high>>>31===1?!1:this.high===L.high&&this.low===L.low},J.eq=J.equals,J.notEquals=function(L){return!this.eq(L)},J.neq=J.notEquals,J.lessThan=function(L){return this.comp(L)<0},J.lt=J.lessThan,J.lessThanOrEqual=function(L){return this.comp(L)<=0},J.lte=J.lessThanOrEqual,J.greaterThan=function(L){return this.comp(L)>0},J.gt=J.greaterThan,J.greaterThanOrEqual=function(L){return this.comp(L)>=0},J.gte=J.greaterThanOrEqual,J.compare=function(L){if(t(L)||(L=g(L)),this.eq(L))return 0;var fe=this.isNegative(),we=L.isNegative();return fe&&!we?-1:!fe&&we?1:this.unsigned?L.high>>>0>this.high>>>0||L.high===this.high&&L.low>>>0>this.low>>>0?-1:1:this.sub(L).isNegative()?-1:1},J.comp=J.compare,J.negate=function(){return!this.unsigned&&this.eq(me)?me:this.not().add(U)},J.neg=J.negate,J.add=function(L){t(L)||(L=g(L));var fe=this.high>>>16,we=this.high&65535,Me=this.low>>>16,Fe=this.low&65535,z=L.high>>>16,Q=L.high&65535,W=L.low>>>16,Ae=L.low&65535,le=0,he=0,ge=0,Ce=0;return Ce+=Fe+Ae,ge+=Ce>>>16,Ce&=65535,ge+=Me+W,he+=ge>>>16,ge&=65535,he+=we+Q,le+=he>>>16,he&=65535,le+=fe+z,le&=65535,a(ge<<16|Ce,le<<16|he,this.unsigned)},J.subtract=function(L){return t(L)||(L=g(L)),this.add(L.neg())},J.sub=J.subtract,J.multiply=function(L){if(this.isZero()||(t(L)||(L=g(L)),L.isZero()))return P;if(this.eq(me))return L.isOdd()?me:P;if(L.eq(me))return this.isOdd()?me:P;if(this.isNegative())return L.isNegative()?this.neg().mul(L.neg()):this.neg().mul(L).neg();if(L.isNegative())return this.mul(L.neg()).neg();if(this.lt(R)&&L.lt(R))return o(this.toNumber()*L.toNumber(),this.unsigned);var fe=this.high>>>16,we=this.high&65535,Me=this.low>>>16,Fe=this.low&65535,z=L.high>>>16,Q=L.high&65535,W=L.low>>>16,Ae=L.low&65535,le=0,he=0,ge=0,Ce=0;return Ce+=Fe*Ae,ge+=Ce>>>16,Ce&=65535,ge+=Me*Ae,he+=ge>>>16,ge&=65535,ge+=Fe*W,he+=ge>>>16,ge&=65535,he+=we*Ae,le+=he>>>16,he&=65535,he+=Me*W,le+=he>>>16,he&=65535,he+=Fe*Q,le+=he>>>16,he&=65535,le+=fe*Ae+we*W+Me*Q+Fe*z,le&=65535,a(ge<<16|Ce,le<<16|he,this.unsigned)},J.mul=J.multiply,J.divide=function(L){if(t(L)||(L=g(L)),L.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?F:P;var fe,we,Me;if(this.unsigned){if(L.unsigned||(L=L.toUnsigned()),L.gt(this))return F;if(L.gt(this.shru(1)))return X;Me=F}else{if(this.eq(me)){if(L.eq(U)||L.eq(Z))return me;if(L.eq(me))return U;var Fe=this.shr(1);return fe=Fe.div(L).shl(1),fe.eq(P)?L.isNegative()?U:Z:(we=this.sub(L.mul(fe)),Me=fe.add(we.div(L)),Me)}else if(L.eq(me))return this.unsigned?F:P;if(this.isNegative())return L.isNegative()?this.neg().div(L.neg()):this.neg().div(L).neg();if(L.isNegative())return this.div(L.neg()).neg();Me=P}for(we=this;we.gte(L);){fe=Math.max(1,Math.floor(we.toNumber()/L.toNumber()));for(var z=Math.ceil(Math.log(fe)/Math.LN2),Q=z<=48?1:l(2,z-48),W=o(fe),Ae=W.mul(L);Ae.isNegative()||Ae.gt(we);)fe-=Q,W=o(fe,this.unsigned),Ae=W.mul(L);W.isZero()&&(W=U),Me=Me.add(W),we=we.sub(Ae)}return Me},J.div=J.divide,J.modulo=function(L){return t(L)||(L=g(L)),this.sub(this.div(L).mul(L))},J.mod=J.modulo,J.not=function(){return a(~this.low,~this.high,this.unsigned)},J.and=function(L){return t(L)||(L=g(L)),a(this.low&L.low,this.high&L.high,this.unsigned)},J.or=function(L){return t(L)||(L=g(L)),a(this.low|L.low,this.high|L.high,this.unsigned)},J.xor=function(L){return t(L)||(L=g(L)),a(this.low^L.low,this.high^L.high,this.unsigned)},J.shiftLeft=function(L){return t(L)&&(L=L.toInt()),(L&=63)===0?this:L<32?a(this.low<<L,this.high<<L|this.low>>>32-L,this.unsigned):a(0,this.low<<L-32,this.unsigned)},J.shl=J.shiftLeft,J.shiftRight=function(L){return t(L)&&(L=L.toInt()),(L&=63)===0?this:L<32?a(this.low>>>L|this.high<<32-L,this.high>>L,this.unsigned):a(this.high>>L-32,this.high>=0?0:-1,this.unsigned)},J.shr=J.shiftRight,J.shiftRightUnsigned=function(L){if(t(L)&&(L=L.toInt()),L&=63,L===0)return this;var fe=this.high;if(L<32){var we=this.low;return a(we>>>L|fe<<32-L,fe>>>L,this.unsigned)}else return L===32?a(fe,0,this.unsigned):a(fe>>>L-32,0,this.unsigned)},J.shru=J.shiftRightUnsigned,J.toSigned=function(){return this.unsigned?a(this.low,this.high,!1):this},J.toUnsigned=function(){return this.unsigned?this:a(this.low,this.high,!0)},J.toBytes=function(q){return q?this.toBytesLE():this.toBytesBE()},J.toBytesLE=function(){var q=this.high,L=this.low;return[L&255,L>>>8&255,L>>>16&255,L>>>24&255,q&255,q>>>8&255,q>>>16&255,q>>>24&255]},J.toBytesBE=function(){var q=this.high,L=this.low;return[q>>>24&255,q>>>16&255,q>>>8&255,q&255,L>>>24&255,L>>>16&255,L>>>8&255,L&255]},e})}(Bl)),Bl.exports}var M8=P8();const Ol=Z2(M8),B8=3,O8=30,D8=2*O8+1,y_=180/Math.PI;function N8(n,e,t){const i=1<<e;return[(n[0]+t[0])/i,(n[1]+t[1])/i]}function b_(n){return n>=.5?1/3*(4*n*n-1):1/3*(1-4*(1-n)*(1-n))}function F8(n){return[b_(n[0]),b_(n[1])]}function L8(n,[e,t]){switch(n){case 0:return[1,e,t];case 1:return[-e,1,t];case 2:return[-e,-t,1];case 3:return[-1,-t,-e];case 4:return[t,-1,-e];case 5:return[t,e,-1];default:throw new Error("Invalid face")}}function k8([n,e,t]){const i=Math.atan2(t,Math.sqrt(n*n+e*e));return[Math.atan2(e,n)*y_,i*y_]}function U8(n){let e=Ol.fromString(n,!0,10).toString(2);for(;e.length<B8+D8;)e="0"+e;const t=e.lastIndexOf("1"),i=e.substring(0,3),s=e.substring(3,t),r=s.length/2,o=Ol.fromString(i,!0,2).toString(10);let a=Ol.fromString(s,!0,2).toString(4);for(;a.length<r;)a="0"+a;return`${o}/${a}`}function V8(n,e,t,i){if(i===0){t===1&&(e[0]=n-1-e[0],e[1]=n-1-e[1]);const s=e[0];e[0]=e[1],e[1]=s}}function z8(n){const e=n.split("/"),t=parseInt(e[0],10),i=e[1],s=i.length,r=[0,0];let o;for(let a=s-1;a>=0;a--){o=s-a;const l=i[a];let f=0,g=0;l==="1"?g=1:l==="2"?(f=1,g=1):l==="3"&&(f=1);const _=Math.pow(2,o-1);V8(_,r,f,g),r[0]+=_*f,r[1]+=_*g}if(t%2===1){const a=r[0];r[0]=r[1],r[1]=a}return{face:t,ij:r,level:o}}function H8(n){const e=n.padEnd(16,"0");return Ol.fromString(e,16)}const G8=100;function W8({face:n,ij:e,level:t}){const i=[[0,0],[0,1],[1,1],[1,0],[0,0]],s=Math.max(1,Math.ceil(G8*Math.pow(2,-t))),r=new Float64Array(4*s*2+2);let o=0,a=0;for(let l=0;l<4;l++){const f=i[l].slice(0),g=i[l+1],_=(g[0]-f[0])/s,v=(g[1]-f[1])/s;for(let T=0;T<s;T++){f[0]+=_,f[1]+=v;const C=N8(e,t,f),S=F8(C),R=L8(n,S),P=k8(R);Math.abs(P[1])>89.999&&(P[0]=a);const F=P[0]-a;P[0]+=F>180?-360:F<-180?360:0,r[o++]=P[0],r[o++]=P[1],a=P[0]}}return r[o++]=r[0],r[o++]=r[1],r}function j8(n){if(typeof n=="string"){if(n.indexOf("/")>0)return n;n=H8(n)}return U8(n.toString())}function $8(n){const e=j8(n),t=z8(e);return W8(t)}const X8={getS2Token:{type:"accessor",value:n=>n.token}};class Uv extends uo{indexToBounds(){const{data:e,getS2Token:t}=this.props;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(i,s)=>$8(t(i,s))}}}Uv.layerName="S2Layer";Uv.defaultProps=X8;const Fu=512;function Q8(n,e){let t=0,i=0,s=1<<n.length;const r=s/Fu;for(let o=0;o<n.length;o++){s>>=1;const a=parseInt(n[o]);a%2&&(t|=s),a>1&&(i|=s)}return[[t/r,Fu-i/r],[(t+e)/r,Fu-(i+e)/r]]}function Y8(n,e=1){const[t,i]=Q8(n,e),[s,r]=Ui(t),[o,a]=Ui(i);return[o,r,o,a,s,a,s,r,o,r]}const K8={getQuadkey:{type:"accessor",value:n=>n.quadkey}};class Vv extends uo{indexToBounds(){const{data:e,extruded:t,getQuadkey:i}=this.props,s=t?.99:1;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(r,o)=>Y8(i(r,o),s),updateTriggers:{getPolygon:s}}}}Vv.layerName="QuadkeyLayer";Vv.defaultProps=K8;class q8{constructor(e){this.index=e,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(e){this._bbox||(this._bbox=e,"west"in e?this.boundingBox=[[e.west,e.south],[e.east,e.north]]:this.boundingBox=[[e.left,e.top],[e.right,e.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return!!this._loader&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const e=this.content?this.content.byteLength:0;return Number.isFinite(e)||console.error("byteLength not defined in tile data"),e}async _loadData({getData:e,requestScheduler:t,onLoad:i,onError:s}){const{index:r,id:o,bbox:a,userData:l,zoom:f}=this,g=this._loaderId;this._abortController=new AbortController;const{signal:_}=this._abortController,v=await t.scheduleRequest(this,S=>S.isSelected?1:-1);if(!v){this._isCancelled=!0;return}if(this._isCancelled){v.done();return}let T=null,C;try{T=await e({index:r,id:o,bbox:a,userData:l,zoom:f,signal:_})}catch(S){C=S||!0}finally{v.done()}if(g===this._loaderId){if(this._loader=void 0,this.content=T,this._isCancelled&&!T){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,C?s(C,this):i(this)}}loadData(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){var e;this.isLoaded||(this._isCancelled=!0,(e=this._abortController)==null||e.abort())}}const bn={OUTSIDE:-1,INTERSECTING:0,INSIDE:1},v_=new ee,J8=new ee;class xd{constructor(e=[0,0,0],t=[0,0,0],i){i=i||v_.copy(e).add(t).scale(.5),this.center=new ee(i),this.halfDiagonal=new ee(t).subtract(this.center),this.minimum=new ee(e),this.maximum=new ee(t)}clone(){return new xd(this.minimum,this.maximum,this.center)}equals(e){return this===e||!!e&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){const{halfDiagonal:t}=this,i=J8.from(e.normal),s=t.x*Math.abs(i.x)+t.y*Math.abs(i.y)+t.z*Math.abs(i.z),r=this.center.dot(i)+e.distance;return r-s>0?bn.INSIDE:r+s<0?bn.OUTSIDE:bn.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=v_.from(e).subtract(this.center),{halfDiagonal:i}=this;let s=0,r;return r=Math.abs(t.x)-i.x,r>0&&(s+=r*r),r=Math.abs(t.y)-i.y,r>0&&(s+=r*r),r=Math.abs(t.z)-i.z,r>0&&(s+=r*r),s}}const So=new ee,T_=new ee;class _a{constructor(e=[0,0,0],t=0){this.radius=-0,this.center=new ee,this.fromCenterRadius(e,t)}fromCenterRadius(e,t){return this.center.from(e),this.radius=t,this}fromCornerPoints(e,t){return t=So.from(t),this.center=new ee().from(e).add(t).scale(.5),this.radius=this.center.distance(t),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new _a(this.center,this.radius)}union(e){const t=this.center,i=this.radius,s=e.center,r=e.radius,o=So.copy(s).subtract(t),a=o.magnitude();if(i>=a+r)return this.clone();if(r>=a+i)return e.clone();const l=(i+a+r)*.5;return T_.copy(o).scale((-i+l)/a).add(t),this.center.copy(T_),this.radius=l,this}expand(e){const i=So.from(e).subtract(this.center).magnitude();return i>this.radius&&(this.radius=i),this}transform(e){this.center.transform(e);const t=dP(So,e);return this.radius=Math.max(t[0],Math.max(t[1],t[2]))*this.radius,this}distanceSquaredTo(e){const t=this.distanceTo(e);return t*t}distanceTo(e){const i=So.from(e).subtract(this.center);return Math.max(0,i.len()-this.radius)}intersectPlane(e){const t=this.center,i=this.radius,r=e.normal.dot(t)+e.distance;return r<-i?bn.OUTSIDE:r<i?bn.INTERSECTING:bn.INSIDE}}const Z8=new ee,e5=new ee,ol=new ee,al=new ee,ll=new ee,t5=new ee,n5=new ee,Oi={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class ya{constructor(e=[0,0,0],t=[0,0,0,0,0,0,0,0,0]){this.center=new ee().from(e),this.halfAxes=new Wt(t)}get halfSize(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2);return[new ee(e).len(),new ee(t).len(),new ee(i).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2),s=new ee(e).normalize(),r=new ee(t).normalize(),o=new ee(i).normalize();return new Jo().fromMatrix3(new Wt([...s,...r,...o]))}fromCenterHalfSizeQuaternion(e,t,i){const s=new Jo(i),r=new Wt().fromQuaternion(s);return r[0]=r[0]*t[0],r[1]=r[1]*t[0],r[2]=r[2]*t[0],r[3]=r[3]*t[1],r[4]=r[4]*t[1],r[5]=r[5]*t[1],r[6]=r[6]*t[2],r[7]=r[7]*t[2],r[8]=r[8]*t[2],this.center=new ee().from(e),this.halfAxes=r,this}clone(){return new ya(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new _a){const t=this.halfAxes,i=t.getColumn(0,ol),s=t.getColumn(1,al),r=t.getColumn(2,ll),o=Z8.copy(i).add(s).add(r);return e.center.copy(this.center),e.radius=o.magnitude(),e}intersectPlane(e){const t=this.center,i=e.normal,s=this.halfAxes,r=i.x,o=i.y,a=i.z,l=Math.abs(r*s[Oi.COLUMN0ROW0]+o*s[Oi.COLUMN0ROW1]+a*s[Oi.COLUMN0ROW2])+Math.abs(r*s[Oi.COLUMN1ROW0]+o*s[Oi.COLUMN1ROW1]+a*s[Oi.COLUMN1ROW2])+Math.abs(r*s[Oi.COLUMN2ROW0]+o*s[Oi.COLUMN2ROW1]+a*s[Oi.COLUMN2ROW2]),f=i.dot(t)+e.distance;return f<=-l?bn.OUTSIDE:f>=l?bn.INSIDE:bn.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=e5.from(e).subtract(this.center),i=this.halfAxes,s=i.getColumn(0,ol),r=i.getColumn(1,al),o=i.getColumn(2,ll),a=s.magnitude(),l=r.magnitude(),f=o.magnitude();s.normalize(),r.normalize(),o.normalize();let g=0,_;return _=Math.abs(t.dot(s))-a,_>0&&(g+=_*_),_=Math.abs(t.dot(r))-l,_>0&&(g+=_*_),_=Math.abs(t.dot(o))-f,_>0&&(g+=_*_),g}computePlaneDistances(e,t,i=[-0,-0]){let s=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;const o=this.center,a=this.halfAxes,l=a.getColumn(0,ol),f=a.getColumn(1,al),g=a.getColumn(2,ll),_=t5.copy(l).add(f).add(g).add(o),v=n5.copy(_).subtract(e);let T=t.dot(v);return s=Math.min(T,s),r=Math.max(T,r),_.copy(o).add(l).add(f).subtract(g),v.copy(_).subtract(e),T=t.dot(v),s=Math.min(T,s),r=Math.max(T,r),_.copy(o).add(l).subtract(f).add(g),v.copy(_).subtract(e),T=t.dot(v),s=Math.min(T,s),r=Math.max(T,r),_.copy(o).add(l).subtract(f).subtract(g),v.copy(_).subtract(e),T=t.dot(v),s=Math.min(T,s),r=Math.max(T,r),o.copy(_).subtract(l).add(f).add(g),v.copy(_).subtract(e),T=t.dot(v),s=Math.min(T,s),r=Math.max(T,r),o.copy(_).subtract(l).add(f).subtract(g),v.copy(_).subtract(e),T=t.dot(v),s=Math.min(T,s),r=Math.max(T,r),o.copy(_).subtract(l).subtract(f).add(g),v.copy(_).subtract(e),T=t.dot(v),s=Math.min(T,s),r=Math.max(T,r),o.copy(_).subtract(l).subtract(f).subtract(g),v.copy(_).subtract(e),T=t.dot(v),s=Math.min(T,s),r=Math.max(T,r),i[0]=s,i[1]=r,i}transform(e){this.center.transformAsPoint(e);const t=this.halfAxes.getColumn(0,ol);t.transformAsPoint(e);const i=this.halfAxes.getColumn(1,al);i.transformAsPoint(e);const s=this.halfAxes.getColumn(2,ll);return s.transformAsPoint(e),this.halfAxes=new Wt([...t,...i,...s]),this}getTransform(){throw new Error("not implemented")}}const w_=new ee,E_=new ee;class ni{constructor(e=[0,0,1],t=0){this.normal=new ee,this.distance=-0,this.fromNormalDistance(e,t)}fromNormalDistance(e,t){return ii(Number.isFinite(t)),this.normal.from(e).normalize(),this.distance=t,this}fromPointNormal(e,t){e=w_.from(e),this.normal.from(t).normalize();const i=-this.normal.dot(e);return this.distance=i,this}fromCoefficients(e,t,i,s){return this.normal.set(e,t,i),ii(Cn(this.normal.len(),1)),this.distance=s,this}clone(){return new ni(this.normal,this.distance)}equals(e){return Cn(this.distance,e.distance)&&Cn(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const t=E_.copy(this.normal).transformAsVector(e).normalize(),i=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(i,t)}projectPointOntoPlane(e,t=[0,0,0]){const i=w_.from(e),s=this.getPointDistance(i),r=E_.copy(this.normal).scale(s);return i.subtract(r).to(t)}}const x_=[new ee([1,0,0]),new ee([0,1,0]),new ee([0,0,1])],C_=new ee,i5=new ee;class Fn{constructor(e=[]){this.planes=e}fromBoundingSphere(e){this.planes.length=2*x_.length;const t=e.center,i=e.radius;let s=0;for(const r of x_){let o=this.planes[s],a=this.planes[s+1];o||(o=this.planes[s]=new ni),a||(a=this.planes[s+1]=new ni);const l=C_.copy(r).scale(-i).add(t);o.fromPointNormal(l,r);const f=C_.copy(r).scale(i).add(t),g=i5.copy(r).negate();a.fromPointNormal(f,g),s+=2}return this}computeVisibility(e){let t=bn.INSIDE;for(const i of this.planes)switch(e.intersectPlane(i)){case bn.OUTSIDE:return bn.OUTSIDE;case bn.INTERSECTING:t=bn.INTERSECTING;break}return t}computeVisibilityWithPlaneMask(e,t){if(ii(Number.isFinite(t),"parentPlaneMask is required."),t===Fn.MASK_OUTSIDE||t===Fn.MASK_INSIDE)return t;let i=Fn.MASK_INSIDE;const s=this.planes;for(let r=0;r<this.planes.length;++r){const o=r<31?1<<r:0;if(r<31&&(t&o)===0)continue;const a=s[r],l=e.intersectPlane(a);if(l===bn.OUTSIDE)return Fn.MASK_OUTSIDE;l===bn.INTERSECTING&&(i|=o)}return i}}Fn.MASK_OUTSIDE=4294967295;Fn.MASK_INSIDE=0;Fn.MASK_INDETERMINATE=2147483647;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;new ee;const vi=new Wt,s5=new Wt,r5=new Wt,cl=new Wt,S_=new Wt;function o5(n,e={}){const t=eM,i=10;let s=0,r=0;const o=s5,a=r5;o.identity(),a.copy(n);const l=t*a5(a);for(;r<i&&l5(a)>l;)c5(a,cl),S_.copy(cl).transpose(),a.multiplyRight(cl),a.multiplyLeft(S_),o.multiplyRight(cl),++s>2&&(++r,s=0);return e.unitary=o.toTarget(e.unitary),e.diagonal=a.toTarget(e.diagonal),e}function a5(n){let e=0;for(let t=0;t<9;++t){const i=n[t];e+=i*i}return Math.sqrt(e)}const sf=[1,0,0],rf=[2,2,1];function l5(n){let e=0;for(let t=0;t<3;++t){const i=n[vi.getElementIndex(rf[t],sf[t])];e+=2*i*i}return Math.sqrt(e)}function c5(n,e){const t=Dy;let i=0,s=1;for(let f=0;f<3;++f){const g=Math.abs(n[vi.getElementIndex(rf[f],sf[f])]);g>i&&(s=f,i=g)}const r=sf[s],o=rf[s];let a=1,l=0;if(Math.abs(n[vi.getElementIndex(o,r)])>t){const f=n[vi.getElementIndex(o,o)],g=n[vi.getElementIndex(r,r)],_=n[vi.getElementIndex(o,r)],v=(f-g)/2/_;let T;v<0?T=-1/(-v+Math.sqrt(1+v*v)):T=1/(v+Math.sqrt(1+v*v)),a=1/Math.sqrt(1+T*T),l=T*a}return Wt.IDENTITY.to(e),e[vi.getElementIndex(r,r)]=e[vi.getElementIndex(o,o)]=a,e[vi.getElementIndex(o,r)]=l,e[vi.getElementIndex(r,o)]=-l,e}const Ki=new ee,A5=new ee,u5=new ee,h5=new ee,f5=new ee,d5=new Wt,g5={diagonal:new Wt,unitary:new Wt};function zv(n,e=new ya){if(!n||n.length===0)return e.halfAxes=new Wt([0,0,0,0,0,0,0,0,0]),e.center=new ee,e;const t=n.length,i=new ee(0,0,0);for(const J of n)i.add(J);const s=1/t;i.multiplyByScalar(s);let r=0,o=0,a=0,l=0,f=0,g=0;for(const J of n){const q=Ki.copy(J).subtract(i);r+=q.x*q.x,o+=q.x*q.y,a+=q.x*q.z,l+=q.y*q.y,f+=q.y*q.z,g+=q.z*q.z}r*=s,o*=s,a*=s,l*=s,f*=s,g*=s;const _=d5;_[0]=r,_[1]=o,_[2]=a,_[3]=o,_[4]=l,_[5]=f,_[6]=a,_[7]=f,_[8]=g;const{unitary:v}=o5(_,g5),T=e.halfAxes.copy(v);let C=T.getColumn(0,u5),S=T.getColumn(1,h5),R=T.getColumn(2,f5),P=-Number.MAX_VALUE,F=-Number.MAX_VALUE,U=-Number.MAX_VALUE,X=Number.MAX_VALUE,Z=Number.MAX_VALUE,se=Number.MAX_VALUE;for(const J of n)Ki.copy(J),P=Math.max(Ki.dot(C),P),F=Math.max(Ki.dot(S),F),U=Math.max(Ki.dot(R),U),X=Math.min(Ki.dot(C),X),Z=Math.min(Ki.dot(S),Z),se=Math.min(Ki.dot(R),se);C=C.multiplyByScalar(.5*(X+P)),S=S.multiplyByScalar(.5*(Z+F)),R=R.multiplyByScalar(.5*(se+U)),e.center.copy(C).add(S).add(R);const Se=A5.set(P-X,F-Z,U-se).multiplyByScalar(.5),me=new Wt([Se[0],0,0,0,Se[1],0,0,0,Se[2]]);return e.halfAxes.multiplyRight(me),e}const Or=512,p5=3,Hv=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],Gv=Hv.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),m5=Gv.concat([[.25,.5],[.75,.5]]);class Dr{constructor(e,t,i){this.x=e,this.y=t,this.z=i}get children(){if(!this._children){const e=this.x*2,t=this.y*2,i=this.z+1;this._children=[new Dr(e,t,i),new Dr(e,t+1,i),new Dr(e+1,t,i),new Dr(e+1,t+1,i)]}return this._children}update(e){const{viewport:t,cullingVolume:i,elevationBounds:s,minZ:r,maxZ:o,bounds:a,offset:l,project:f}=e,g=this.getBoundingVolume(s,l,f);if(a&&!this.insideBounds(a)||i.computeVisibility(g)<0)return!1;if(!this.childVisible){let{z:v}=this;if(v<o&&v>=r){const T=g.distanceTo(t.cameraPosition)*t.scale/t.height;v+=Math.floor(Math.log2(T))}if(v>=o)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const v of this.children)v.update(e);return!0}getSelected(e=[]){if(this.selected&&e.push(this),this._children)for(const t of this._children)t.getSelected(e);return e}insideBounds([e,t,i,s]){const r=Math.pow(2,this.z),o=Or/r;return this.x*o<i&&this.y*o<s&&(this.x+1)*o>e&&(this.y+1)*o>t}getBoundingVolume(e,t,i){if(i){const l=this.z<1?m5:this.z<2?Gv:Hv,f=[];for(const g of l){const _=af(this.x+g[0],this.y+g[1],this.z);_[2]=e[0],f.push(i(_)),e[0]!==e[1]&&(_[2]=e[1],f.push(i(_)))}return zv(f)}const s=Math.pow(2,this.z),r=Or/s,o=this.x*r+t*Or,a=Or-(this.y+1)*r;return new xd([o,a,e[0]],[o+r,a+r,e[1]])}}function _5(n,e,t,i){const s=n instanceof Ad&&n.resolution?n.projectPosition:null,r=Object.values(n.getFrustumPlanes()).map(({normal:T,distance:C})=>new ni(T.clone().negate(),C)),o=new Fn(r),a=n.distanceScales.unitsPerMeter[2],l=t&&t[0]*a||0,f=t&&t[1]*a||0,g=n instanceof fi&&n.pitch<=60?e:0;if(i){const[T,C,S,R]=i,P=Ci([T,R]),F=Ci([S,C]);i=[P[0],Or-P[1],F[0],Or-F[1]]}const _=new Dr(0,0,0),v={viewport:n,project:s,cullingVolume:o,elevationBounds:[l,f],minZ:g,maxZ:e,bounds:i,offset:0};if(_.update(v),n instanceof fi&&n.subViewports&&n.subViewports.length>1){for(v.offset=-1;_.update(v)&&!(--v.offset<-3););for(v.offset=1;_.update(v)&&!(++v.offset>p5););}return _.getSelected()}const Vi=512,y5=[-1/0,-1/0,1/0,1/0],bc={type:"object",value:null,validate:(n,e)=>e.optional&&n===null||typeof n=="string"||Array.isArray(n)&&n.every(t=>typeof t=="string"),equal:(n,e)=>{if(n===e)return!0;if(!Array.isArray(n)||!Array.isArray(e))return!1;const t=n.length;if(t!==e.length)return!1;for(let i=0;i<t;i++)if(n[i]!==e[i])return!1;return!0}};function Wv(n,e){const t=[e.transformAsPoint([n[0],n[1]]),e.transformAsPoint([n[2],n[1]]),e.transformAsPoint([n[0],n[3]]),e.transformAsPoint([n[2],n[3]])];return[Math.min(...t.map(s=>s[0])),Math.min(...t.map(s=>s[1])),Math.max(...t.map(s=>s[0])),Math.max(...t.map(s=>s[1]))]}function b5(n){return Math.abs(n.split("").reduce((e,t)=>(e<<5)-e+t.charCodeAt(0)|0,0))}function vc(n,e){if(!n||!n.length)return null;const{index:t,id:i}=e;if(Array.isArray(n)){const r=b5(i)%n.length;n=n[r]}let s=n;for(const r of Object.keys(t)){const o=new RegExp(`{${r}}`,"g");s=s.replace(o,String(t[r]))}return Number.isInteger(t.y)&&Number.isInteger(t.z)&&(s=s.replace(/\{-y\}/g,String(Math.pow(2,t.z)-t.y-1))),s}function v5(n,e,t){let i;return i=n.getBounds(),n.isGeospatial?[Math.max(i[0],t[0]),Math.max(i[1],t[1]),Math.min(i[2],t[2]),Math.min(i[3],t[3])]:[Math.max(Math.min(i[0],t[2]),t[0]),Math.max(Math.min(i[1],t[3]),t[1]),Math.min(Math.max(i[2],t[0]),t[2]),Math.min(Math.max(i[3],t[1]),t[3])]}function T5({viewport:n,z:e,cullRect:t}){return(n.subViewports||[n]).map(s=>of(s,e||0,t))}function of(n,e,t){if(!Array.isArray(e)){const r=t.x-n.x,o=t.y-n.y,{width:a,height:l}=t,f={targetZ:e},g=n.unproject([r,o],f),_=n.unproject([r+a,o],f),v=n.unproject([r,o+l],f),T=n.unproject([r+a,o+l],f);return[Math.min(g[0],_[0],v[0],T[0]),Math.min(g[1],_[1],v[1],T[1]),Math.max(g[0],_[0],v[0],T[0]),Math.max(g[1],_[1],v[1],T[1])]}const i=of(n,e[0],t),s=of(n,e[1],t);return[Math.min(i[0],s[0]),Math.min(i[1],s[1]),Math.max(i[2],s[2]),Math.max(i[3],s[3])]}function w5(n,e,t){return t?Wv(n,t).map(s=>s*e/Vi):n.map(i=>i*e/Vi)}function Cd(n,e){return Math.pow(2,n)*Vi/e}function af(n,e,t){const i=Cd(t,Vi),s=n/i*360-180,r=Math.PI-2*Math.PI*e/i,o=180/Math.PI*Math.atan(.5*(Math.exp(r)-Math.exp(-r)));return[s,o]}function I_(n,e,t,i){const s=Cd(t,i);return[n/s*Vi,e/s*Vi]}function E5(n,e,t,i,s=Vi){if(n.isGeospatial){const[f,g]=af(e,t,i),[_,v]=af(e+1,t+1,i);return{west:f,north:g,east:_,south:v}}const[r,o]=I_(e,t,i,s),[a,l]=I_(e+1,t+1,i,s);return{left:r,top:o,right:a,bottom:l}}function x5(n,e,t,i,s){const r=v5(n,null,i),o=Cd(e,t),[a,l,f,g]=w5(r,o,s),_=[];for(let v=Math.floor(a);v<f;v++)for(let T=Math.floor(l);T<g;T++)_.push({x:v,y:T,z:e});return _}function C5({viewport:n,maxZoom:e,minZoom:t,zRange:i,extent:s,tileSize:r=Vi,modelMatrix:o,modelMatrixInverse:a,zoomOffset:l=0}){let f=n.isGeospatial?Math.round(n.zoom+Math.log2(Vi/r))+l:Math.ceil(n.zoom)+l;if(typeof t=="number"&&Number.isFinite(t)&&f<t){if(!s)return[];f=t}typeof e=="number"&&Number.isFinite(e)&&f>e&&(f=e);let g=s;return o&&a&&s&&!n.isGeospatial&&(g=Wv(s,o)),n.isGeospatial?_5(n,f,i,s):x5(n,f,r,g||y5,a)}function S5(n){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(n)}function I5(n){return Number.isFinite(n.west)&&Number.isFinite(n.north)&&Number.isFinite(n.east)&&Number.isFinite(n.south)}function R5(n){let e={},t;return i=>{for(const s in i)if(!P5(i[s],e[s])){t=n(i),e=i;break}return t}}function P5(n,e){if(n===e)return!0;if(Array.isArray(n)){const t=n.length;if(!e||e.length!==t)return!1;for(let i=0;i<t;i++)if(n[i]!==e[i])return!1;return!0}return!1}const R_=1,aA=2,M5="never",B5="no-overlap",Sd="best-available",O5=5,D5={[Sd]:L5,[B5]:k5,[M5]:()=>{}},N5={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}};class F5{constructor(e){this._getCullBounds=R5(T5),this.opts={...N5,...e},this.setOptions(this.opts),this.onTileLoad=t=>{var i,s;(s=(i=this.opts).onTileLoad)==null||s.call(i,t),this.opts.maxCacheByteSize!==null&&(this._cacheByteSize+=t.byteLength,this._resizeCache())},this._requestScheduler=new l1({throttleRequests:this.opts.maxRequests>0||this.opts.debounceTime>0,maxRequests:this.opts.maxRequests,debounceTime:this.opts.debounceTime}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._zRange=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new Ge,this._modelMatrixInverse=new Ge}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(e=>e.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(e=>e.needsReload)}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(const e of this._cache.values())e.isLoading&&e.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const e of this._cache.keys()){const t=this._cache.get(e);!this._selectedTiles||!this._selectedTiles.includes(t)?this._cache.delete(e):t.setNeedsReload()}}update(e,{zRange:t,modelMatrix:i}={zRange:null,modelMatrix:null}){const s=i?new Ge(i):new Ge,r=!s.equals(this._modelMatrix);if(!this._viewport||!e.equals(this._viewport)||!Cn(this._zRange,t)||r){r&&(this._modelMatrixInverse=s.clone().invert(),this._modelMatrix=s),this._viewport=e,this._zRange=t;const a=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:t,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=a.map(l=>this._getTile(l,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(a=>this._getTile(a.index,!0)));const o=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),o&&this._frameNumber++,this._frameNumber}isTileVisible(e,t){if(!e.isVisible)return!1;if(t&&this._viewport){const i=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:t}),{bbox:s}=e;for(const[r,o,a,l]of i){let f;if("west"in s)f=s.west<a&&s.east>r&&s.south<l&&s.north>o;else{const g=Math.min(s.top,s.bottom),_=Math.max(s.top,s.bottom);f=s.left<a&&s.right>r&&g<l&&_>o}if(f)return!0}return!1}return!0}getTileIndices({viewport:e,maxZoom:t,minZoom:i,zRange:s,modelMatrix:r,modelMatrixInverse:o}){const{tileSize:a,extent:l,zoomOffset:f}=this.opts;return C5({viewport:e,maxZoom:t,minZoom:i,zRange:s,tileSize:a,extent:l,modelMatrix:r,modelMatrixInverse:o,zoomOffset:f})}getTileId(e){return`${e.x}-${e.y}-${e.z}`}getTileZoom(e){return e.z}getTileMetadata(e){const{tileSize:t}=this.opts;return{bbox:E5(this._viewport,e.x,e.y,e.z,t)}}getParentIndex(e){const t=Math.floor(e.x/2),i=Math.floor(e.y/2),s=e.z-1;return{x:t,y:i,z:s}}updateTileStates(){const e=this.opts.refinementStrategy||Sd,t=new Array(this._cache.size);let i=0;for(const s of this._cache.values())t[i++]=s.isVisible,s.isSelected=!1,s.isVisible=!1;for(const s of this._selectedTiles)s.isSelected=!0,s.isVisible=!0;(typeof e=="function"?e:D5[e])(Array.from(this._cache.values())),i=0;for(const s of this._cache.values())if(t[i++]!==s.isVisible)return!0;return!1}_pruneRequests(){const{maxRequests:e=0}=this.opts,t=[];let i=0;for(const s of this._cache.values())s.isLoading&&(i++,!s.isSelected&&!s.isVisible&&t.push(s));for(;e>0&&i>e&&t.length>0;)t.shift().abort(),i--}_rebuildTree(){const{_cache:e}=this;for(const t of e.values())t.parent=null,t.children&&(t.children.length=0);for(const t of e.values()){const i=this._getNearestAncestor(t);t.parent=i,i!=null&&i.children&&i.children.push(t)}}_resizeCache(){var o,a;const{_cache:e,opts:t}=this,i=t.maxCacheSize??(t.maxCacheByteSize!==null?1/0:O5*this.selectedTiles.length),s=t.maxCacheByteSize??1/0;if(e.size>i||this._cacheByteSize>s){for(const[l,f]of e)if(!f.isVisible&&!f.isSelected&&(this._cacheByteSize-=t.maxCacheByteSize!==null?f.byteLength:0,e.delete(l),(a=(o=this.opts).onTileUnload)==null||a.call(o,f)),e.size<=i&&this._cacheByteSize<=s)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((l,f)=>l.zoom-f.zoom),this._dirty=!1)}_getTile(e,t){const i=this.getTileId(e);let s=this._cache.get(i),r=!1;return!s&&t?(s=new q8(e),Object.assign(s,this.getTileMetadata(s.index)),Object.assign(s,{id:i,zoom:this.getTileZoom(s.index)}),r=!0,this._cache.set(i,s),this._dirty=!0):s&&s.needsReload&&(r=!0),s&&r&&s.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),s}_getNearestAncestor(e){const{_minZoom:t=0}=this;let i=e.index;for(;this.getTileZoom(i)>t;){i=this.getParentIndex(i);const s=this._getTile(i);if(s)return s}return null}}function L5(n){for(const e of n)e.state=0;for(const e of n)e.isSelected&&!jv(e)&&Id(e);for(const e of n)e.isVisible=!!(e.state&aA)}function k5(n){for(const t of n)t.state=0;for(const t of n)t.isSelected&&jv(t);const e=Array.from(n).sort((t,i)=>t.zoom-i.zoom);for(const t of e)if(t.isVisible=!!(t.state&aA),t.children&&(t.isVisible||t.state&R_))for(const i of t.children)i.state=R_;else t.isSelected&&Id(t)}function jv(n){let e=n;for(;e;){if(e.isLoaded||e.content)return e.state|=aA,!0;e=e.parent}return!1}function Id(n){for(const e of n.children)e.isLoaded||e.content?e.state|=aA:Id(e)}const U5={TilesetClass:F5,data:{type:"data",value:[]},dataComparator:bc.equal,renderSubLayers:{type:"function",value:n=>new ga(n)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:n=>{}},onTileUnload:{type:"function",value:n=>{}},onTileError:{type:"function",value:n=>console.error(n)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:Sd,zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0};class ba extends gi{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){var e,t;(t=(e=this.state)==null?void 0:e.tileset)==null||t.finalize()}get isLoaded(){var e,t,i;return!!((i=(t=(e=this.state)==null?void 0:e.tileset)==null?void 0:t.selectedTiles)!=null&&i.every(s=>s.isLoaded&&s.layers&&s.layers.every(r=>r.isLoaded)))}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({changeFlags:e}){let{tileset:t}=this.state;const i=e.propsOrDataChanged||e.updateTriggersChanged,s=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getTileData);t?i&&(t.setOptions(this._getTilesetOptions()),s?t.reloadAll():t.tiles.forEach(r=>{r.layers=null})):(t=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:t})),this._updateTileset()}_getTilesetOptions(){const{tileSize:e,maxCacheSize:t,maxCacheByteSize:i,refinementStrategy:s,extent:r,maxZoom:o,minZoom:a,maxRequests:l,debounceTime:f,zoomOffset:g}=this.props;return{maxCacheSize:t,maxCacheByteSize:i,maxZoom:o,minZoom:a,tileSize:e,refinementStrategy:s,extent:r,maxRequests:l,debounceTime:f,zoomOffset:g,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const e=this.state.tileset,{zRange:t,modelMatrix:i}=this.props,s=e.update(this.context.viewport,{zRange:t,modelMatrix:i}),{isLoaded:r}=e,o=this.state.isLoaded!==r,a=this.state.frameNumber!==s;r&&(o||a)&&this._onViewportLoad(),a&&this.setState({frameNumber:s}),this.state.isLoaded=r}_onViewportLoad(){const{tileset:e}=this.state,{onViewportLoad:t}=this.props;t&&t(e.selectedTiles)}_onTileLoad(e){this.props.onTileLoad(e),e.layers=null,this.setNeedsUpdate()}_onTileError(e,t){this.props.onTileError(e),t.layers=null,this.setNeedsUpdate()}_onTileUnload(e){this.props.onTileUnload(e)}getTileData(e){const{data:t,getTileData:i,fetch:s}=this.props,{signal:r}=e;return e.url=typeof t=="string"||Array.isArray(t)?vc(t,e):null,i?i(e):s&&e.url?s(e.url,{propName:"data",layer:this,signal:r}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getSubLayerPropsByTile(e){return null}getPickingInfo(e){const t=e.sourceLayer,i=t.props.tile,s=e.info;return s.picked&&(s.tile=i),s.sourceTile=i,s.sourceTileSubLayer=t,s}_updateAutoHighlight(e){e.sourceTileSubLayer.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map(e=>{const t=this.getSubLayerPropsByTile(e);if(!(!e.isLoaded&&!e.content))if(e.layers)t&&e.layers[0]&&Object.keys(t).some(i=>e.layers[0].props[i]!==t[i])&&(e.layers=e.layers.map(i=>i.clone(t)));else{const i=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:e.id,updateTriggers:this.props.updateTriggers}),data:e.content,_offset:0,tile:e});e.layers=Zc(i,Boolean).map(s=>s.clone({tile:e,...t}))}return e.layers})}filterSubLayer({layer:e,cullRect:t}){const{tile:i}=e.props;return this.state.tileset.isTileVisible(i,t)}}ba.defaultProps=U5;ba.layerName="TileLayer";const P_=`uniform tripsUniforms {
  bool fadeTrail;
  float trailLength;
  float currentTime;
} trips;
`,V5={name:"trips",vs:P_,fs:P_,uniformTypes:{fadeTrail:"f32",trailLength:"f32",currentTime:"f32"}},z5={fadeTrail:!0,trailLength:{type:"number",value:120,min:0},currentTime:{type:"number",value:0,min:0},getTimestamps:{type:"accessor",value:n=>n.timestamps}};class $v extends co{getShaders(){const e=super.getShaders();return e.inject={"vs:#decl":`in float instanceTimestamps;
in float instanceNextTimestamps;
out float vTime;
`,"vs:#main-end":`vTime = instanceTimestamps + (instanceNextTimestamps - instanceTimestamps) * vPathPosition.y / vPathLength;
`,"fs:#decl":`in float vTime;
`,"fs:#main-start":`if(vTime > trips.currentTime || (trips.fadeTrail && (vTime < trips.currentTime - trips.trailLength))) {
  discard;
}
`,"fs:DECKGL_FILTER_COLOR":`if(trips.fadeTrail) {
  color.a *= 1.0 - (trips.currentTime - vTime) / trips.trailLength;
}
`},e.modules=[...e.modules,V5],e}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({timestamps:{size:1,accessor:"getTimestamps",shaderAttributes:{instanceTimestamps:{vertexOffset:0},instanceNextTimestamps:{vertexOffset:1}}}})}draw(e){const{fadeTrail:t,trailLength:i,currentTime:s}=this.props,r={fadeTrail:t,trailLength:i,currentTime:s};this.state.model.shaderInputs.setProps({trips:r}),super.draw(e)}}$v.layerName="TripsLayer";$v.defaultProps=z5;var pt=function(n){n=n||{};var e=typeof n<"u"?n:{},t={},i;for(i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);var s="";function r(ae){return e.locateFile?e.locateFile(ae,s):s+ae}var o;typeof document<"u"&&document.currentScript&&(s=document.currentScript.src),s.indexOf("blob:")!==0?s=s.substr(0,s.lastIndexOf("/")+1):s="",o=function(pe,Be,He){var u=new XMLHttpRequest;u.open("GET",pe,!0),u.responseType="arraybuffer",u.onload=function(){if(u.status==200||u.status==0&&u.response){Be(u.response);return}var at=vA(pe);if(at){Be(at.buffer);return}He()},u.onerror=He,u.send(null)};var a=e.print||console.log.bind(console),l=e.printErr||console.warn.bind(console);for(i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);t=null,e.arguments&&e.arguments;var f=0,g=function(ae){f=ae},_=function(){return f},v=8;function T(ae,pe,Be,He){switch(Be=Be||"i8",Be.charAt(Be.length-1)==="*"&&(Be="i32"),Be){case"i1":fe[ae>>0]=pe;break;case"i8":fe[ae>>0]=pe;break;case"i16":Me[ae>>1]=pe;break;case"i32":Fe[ae>>2]=pe;break;case"i64":bA=[pe>>>0,(Zs=pe,+va(Zs)>=1?Zs>0?(dt(+ft(Zs/4294967296),4294967295)|0)>>>0:~~+Ta((Zs-+(~~Zs>>>0))/4294967296)>>>0:0)],Fe[ae>>2]=bA[0],Fe[ae+4>>2]=bA[1];break;case"float":z[ae>>2]=pe;break;case"double":Q[ae>>3]=pe;break;default:er("invalid type for setValue: "+Be)}}function C(ae,pe,Be){switch(pe=pe||"i8",pe.charAt(pe.length-1)==="*"&&(pe="i32"),pe){case"i1":return fe[ae>>0];case"i8":return fe[ae>>0];case"i16":return Me[ae>>1];case"i32":return Fe[ae>>2];case"i64":return Fe[ae>>2];case"float":return z[ae>>2];case"double":return Q[ae>>3];default:er("invalid type for getValue: "+pe)}return null}var S=!1;function R(ae,pe){ae||er("Assertion failed: "+pe)}function P(ae){var pe=e["_"+ae];return R(pe,"Cannot call unknown function "+ae+", make sure it is exported"),pe}function F(ae,pe,Be,He,u){var B={string:function(et){var Vn=0;if(et!=null&&et!==0){var Ea=(et.length<<2)+1;Vn=i0(Ea),me(et,Vn,Ea)}return Vn},array:function(et){var Vn=i0(et.length);return J(et,Vn),Vn}};function at(et){return pe==="string"?se(et):pe==="boolean"?!!et:et}var bt=P(ae),en=[],it=0;if(He)for(var lt=0;lt<He.length;lt++){var zi=B[Be[lt]];zi?(it===0&&(it=zw()),en[lt]=zi(He[lt])):en[lt]=He[lt]}var vt=bt.apply(null,en);return vt=at(vt),it!==0&&Vw(it),vt}function U(ae,pe,Be,He){Be=Be||[];var u=Be.every(function(at){return at==="number"}),B=pe!=="string";return B&&u&&!He?P(ae):function(){return F(ae,pe,Be,arguments)}}var X=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function Z(ae,pe,Be){for(var He=pe+Be,u=pe;ae[u]&&!(u>=He);)++u;if(u-pe>16&&ae.subarray&&X)return X.decode(ae.subarray(pe,u));for(var B="";pe<u;){var at=ae[pe++];if(!(at&128)){B+=String.fromCharCode(at);continue}var bt=ae[pe++]&63;if((at&224)==192){B+=String.fromCharCode((at&31)<<6|bt);continue}var en=ae[pe++]&63;if((at&240)==224?at=(at&15)<<12|bt<<6|en:at=(at&7)<<18|bt<<12|en<<6|ae[pe++]&63,at<65536)B+=String.fromCharCode(at);else{var it=at-65536;B+=String.fromCharCode(55296|it>>10,56320|it&1023)}}return B}function se(ae,pe){return ae?Z(we,ae,pe):""}function Se(ae,pe,Be,He){if(!(He>0))return 0;for(var u=Be,B=Be+He-1,at=0;at<ae.length;++at){var bt=ae.charCodeAt(at);if(bt>=55296&&bt<=57343){var en=ae.charCodeAt(++at);bt=65536+((bt&1023)<<10)|en&1023}if(bt<=127){if(Be>=B)break;pe[Be++]=bt}else if(bt<=2047){if(Be+1>=B)break;pe[Be++]=192|bt>>6,pe[Be++]=128|bt&63}else if(bt<=65535){if(Be+2>=B)break;pe[Be++]=224|bt>>12,pe[Be++]=128|bt>>6&63,pe[Be++]=128|bt&63}else{if(Be+3>=B)break;pe[Be++]=240|bt>>18,pe[Be++]=128|bt>>12&63,pe[Be++]=128|bt>>6&63,pe[Be++]=128|bt&63}}return pe[Be]=0,Be-u}function me(ae,pe,Be){return Se(ae,we,pe,Be)}typeof TextDecoder<"u"&&new TextDecoder("utf-16le");function J(ae,pe){fe.set(ae,pe)}function q(ae,pe){return ae%pe>0&&(ae+=pe-ae%pe),ae}var L,fe,we,Me,Fe,z,Q;function W(ae){L=ae,e.HEAP8=fe=new Int8Array(ae),e.HEAP16=Me=new Int16Array(ae),e.HEAP32=Fe=new Int32Array(ae),e.HEAPU8=we=new Uint8Array(ae),e.HEAPU16=new Uint16Array(ae),e.HEAPU32=new Uint32Array(ae),e.HEAPF32=z=new Float32Array(ae),e.HEAPF64=Q=new Float64Array(ae)}var Ae=5267040,le=24128,he=e.TOTAL_MEMORY||33554432;e.buffer?L=e.buffer:L=new ArrayBuffer(he),he=L.byteLength,W(L),Fe[le>>2]=Ae;function ge(ae){for(;ae.length>0;){var pe=ae.shift();if(typeof pe=="function"){pe();continue}var Be=pe.func;typeof Be=="number"?pe.arg===void 0?e.dynCall_v(Be):e.dynCall_vi(Be,pe.arg):Be(pe.arg===void 0?null:pe.arg)}}var Ce=[],We=[],Le=[],Mt=[];function wt(){if(e.preRun)for(typeof e.preRun=="function"&&(e.preRun=[e.preRun]);e.preRun.length;)gs(e.preRun.shift());ge(Ce)}function ht(){ge(We)}function Zt(){ge(Le)}function Et(){if(e.postRun)for(typeof e.postRun=="function"&&(e.postRun=[e.postRun]);e.postRun.length;)ps(e.postRun.shift());ge(Mt)}function gs(ae){Ce.unshift(ae)}function ps(ae){Mt.unshift(ae)}var va=Math.abs,Ta=Math.ceil,ft=Math.floor,dt=Math.min,ms=0,fo=null;function Cw(ae){ms++,e.monitorRunDependencies&&e.monitorRunDependencies(ms)}function Sw(ae){if(ms--,e.monitorRunDependencies&&e.monitorRunDependencies(ms),ms==0&&fo){var pe=fo;fo=null,pe()}}e.preloadedImages={},e.preloadedAudios={};var Pi=null,yA="data:application/octet-stream;base64,";function t0(ae){return String.prototype.startsWith?ae.startsWith(yA):ae.indexOf(yA)===0}var Zs,bA;Pi="data:application/octet-stream;base64,AAAAAAAAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAAAQAAAAQAAAADAAAABgAAAAUAAAACAAAAAAAAAAIAAAADAAAAAQAAAAQAAAAGAAAAAAAAAAUAAAADAAAABgAAAAQAAAAFAAAAAAAAAAEAAAACAAAABAAAAAUAAAAGAAAAAAAAAAIAAAADAAAAAQAAAAUAAAACAAAAAAAAAAEAAAADAAAABgAAAAQAAAAGAAAAAAAAAAUAAAACAAAAAQAAAAQAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAAAAAAEAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAYAAAAAAAAABQAAAAAAAAAAAAAABAAAAAUAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAYAAAAAAAAABgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAIAAAAAAAAAAAAAAAYAAAAAAAAAAwAAAAIAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAFAAAABAAAAAAAAAABAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAYAAAAAAAAABAAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAgAAAAQAAAADAAAACAAAAAEAAAAHAAAABgAAAAkAAAAAAAAAAwAAAAIAAAACAAAABgAAAAoAAAALAAAAAAAAAAEAAAAFAAAAAwAAAA0AAAABAAAABwAAAAQAAAAMAAAAAAAAAAQAAAB/AAAADwAAAAgAAAADAAAAAAAAAAwAAAAFAAAAAgAAABIAAAAKAAAACAAAAAAAAAAQAAAABgAAAA4AAAALAAAAEQAAAAEAAAAJAAAAAgAAAAcAAAAVAAAACQAAABMAAAADAAAADQAAAAEAAAAIAAAABQAAABYAAAAQAAAABAAAAAAAAAAPAAAACQAAABMAAAAOAAAAFAAAAAEAAAAHAAAABgAAAAoAAAALAAAAGAAAABcAAAAFAAAAAgAAABIAAAALAAAAEQAAABcAAAAZAAAAAgAAAAYAAAAKAAAADAAAABwAAAANAAAAGgAAAAQAAAAPAAAAAwAAAA0AAAAaAAAAFQAAAB0AAAADAAAADAAAAAcAAAAOAAAAfwAAABEAAAAbAAAACQAAABQAAAAGAAAADwAAABYAAAAcAAAAHwAAAAQAAAAIAAAADAAAABAAAAASAAAAIQAAAB4AAAAIAAAABQAAABYAAAARAAAACwAAAA4AAAAGAAAAIwAAABkAAAAbAAAAEgAAABgAAAAeAAAAIAAAAAUAAAAKAAAAEAAAABMAAAAiAAAAFAAAACQAAAAHAAAAFQAAAAkAAAAUAAAADgAAABMAAAAJAAAAKAAAABsAAAAkAAAAFQAAACYAAAATAAAAIgAAAA0AAAAdAAAABwAAABYAAAAQAAAAKQAAACEAAAAPAAAACAAAAB8AAAAXAAAAGAAAAAsAAAAKAAAAJwAAACUAAAAZAAAAGAAAAH8AAAAgAAAAJQAAAAoAAAAXAAAAEgAAABkAAAAXAAAAEQAAAAsAAAAtAAAAJwAAACMAAAAaAAAAKgAAAB0AAAArAAAADAAAABwAAAANAAAAGwAAACgAAAAjAAAALgAAAA4AAAAUAAAAEQAAABwAAAAfAAAAKgAAACwAAAAMAAAADwAAABoAAAAdAAAAKwAAACYAAAAvAAAADQAAABoAAAAVAAAAHgAAACAAAAAwAAAAMgAAABAAAAASAAAAIQAAAB8AAAApAAAALAAAADUAAAAPAAAAFgAAABwAAAAgAAAAHgAAABgAAAASAAAANAAAADIAAAAlAAAAIQAAAB4AAAAxAAAAMAAAABYAAAAQAAAAKQAAACIAAAATAAAAJgAAABUAAAA2AAAAJAAAADMAAAAjAAAALgAAAC0AAAA4AAAAEQAAABsAAAAZAAAAJAAAABQAAAAiAAAAEwAAADcAAAAoAAAANgAAACUAAAAnAAAANAAAADkAAAAYAAAAFwAAACAAAAAmAAAAfwAAACIAAAAzAAAAHQAAAC8AAAAVAAAAJwAAACUAAAAZAAAAFwAAADsAAAA5AAAALQAAACgAAAAbAAAAJAAAABQAAAA8AAAALgAAADcAAAApAAAAMQAAADUAAAA9AAAAFgAAACEAAAAfAAAAKgAAADoAAAArAAAAPgAAABwAAAAsAAAAGgAAACsAAAA+AAAALwAAAEAAAAAaAAAAKgAAAB0AAAAsAAAANQAAADoAAABBAAAAHAAAAB8AAAAqAAAALQAAACcAAAAjAAAAGQAAAD8AAAA7AAAAOAAAAC4AAAA8AAAAOAAAAEQAAAAbAAAAKAAAACMAAAAvAAAAJgAAACsAAAAdAAAARQAAADMAAABAAAAAMAAAADEAAAAeAAAAIQAAAEMAAABCAAAAMgAAADEAAAB/AAAAPQAAAEIAAAAhAAAAMAAAACkAAAAyAAAAMAAAACAAAAAeAAAARgAAAEMAAAA0AAAAMwAAAEUAAAA2AAAARwAAACYAAAAvAAAAIgAAADQAAAA5AAAARgAAAEoAAAAgAAAAJQAAADIAAAA1AAAAPQAAAEEAAABLAAAAHwAAACkAAAAsAAAANgAAAEcAAAA3AAAASQAAACIAAAAzAAAAJAAAADcAAAAoAAAANgAAACQAAABIAAAAPAAAAEkAAAA4AAAARAAAAD8AAABNAAAAIwAAAC4AAAAtAAAAOQAAADsAAABKAAAATgAAACUAAAAnAAAANAAAADoAAAB/AAAAPgAAAEwAAAAsAAAAQQAAACoAAAA7AAAAPwAAAE4AAABPAAAAJwAAAC0AAAA5AAAAPAAAAEgAAABEAAAAUAAAACgAAAA3AAAALgAAAD0AAAA1AAAAMQAAACkAAABRAAAASwAAAEIAAAA+AAAAKwAAADoAAAAqAAAAUgAAAEAAAABMAAAAPwAAAH8AAAA4AAAALQAAAE8AAAA7AAAATQAAAEAAAAAvAAAAPgAAACsAAABUAAAARQAAAFIAAABBAAAAOgAAADUAAAAsAAAAVgAAAEwAAABLAAAAQgAAAEMAAABRAAAAVQAAADEAAAAwAAAAPQAAAEMAAABCAAAAMgAAADAAAABXAAAAVQAAAEYAAABEAAAAOAAAADwAAAAuAAAAWgAAAE0AAABQAAAARQAAADMAAABAAAAALwAAAFkAAABHAAAAVAAAAEYAAABDAAAANAAAADIAAABTAAAAVwAAAEoAAABHAAAAWQAAAEkAAABbAAAAMwAAAEUAAAA2AAAASAAAAH8AAABJAAAANwAAAFAAAAA8AAAAWAAAAEkAAABbAAAASAAAAFgAAAA2AAAARwAAADcAAABKAAAATgAAAFMAAABcAAAANAAAADkAAABGAAAASwAAAEEAAAA9AAAANQAAAF4AAABWAAAAUQAAAEwAAABWAAAAUgAAAGAAAAA6AAAAQQAAAD4AAABNAAAAPwAAAEQAAAA4AAAAXQAAAE8AAABaAAAATgAAAEoAAAA7AAAAOQAAAF8AAABcAAAATwAAAE8AAABOAAAAPwAAADsAAABdAAAAXwAAAE0AAABQAAAARAAAAEgAAAA8AAAAYwAAAFoAAABYAAAAUQAAAFUAAABeAAAAZQAAAD0AAABCAAAASwAAAFIAAABgAAAAVAAAAGIAAAA+AAAATAAAAEAAAABTAAAAfwAAAEoAAABGAAAAZAAAAFcAAABcAAAAVAAAAEUAAABSAAAAQAAAAGEAAABZAAAAYgAAAFUAAABXAAAAZQAAAGYAAABCAAAAQwAAAFEAAABWAAAATAAAAEsAAABBAAAAaAAAAGAAAABeAAAAVwAAAFMAAABmAAAAZAAAAEMAAABGAAAAVQAAAFgAAABIAAAAWwAAAEkAAABjAAAAUAAAAGkAAABZAAAAYQAAAFsAAABnAAAARQAAAFQAAABHAAAAWgAAAE0AAABQAAAARAAAAGoAAABdAAAAYwAAAFsAAABJAAAAWQAAAEcAAABpAAAAWAAAAGcAAABcAAAAUwAAAE4AAABKAAAAbAAAAGQAAABfAAAAXQAAAE8AAABaAAAATQAAAG0AAABfAAAAagAAAF4AAABWAAAAUQAAAEsAAABrAAAAaAAAAGUAAABfAAAAXAAAAE8AAABOAAAAbQAAAGwAAABdAAAAYAAAAGgAAABiAAAAbgAAAEwAAABWAAAAUgAAAGEAAAB/AAAAYgAAAFQAAABnAAAAWQAAAG8AAABiAAAAbgAAAGEAAABvAAAAUgAAAGAAAABUAAAAYwAAAFAAAABpAAAAWAAAAGoAAABaAAAAcQAAAGQAAABmAAAAUwAAAFcAAABsAAAAcgAAAFwAAABlAAAAZgAAAGsAAABwAAAAUQAAAFUAAABeAAAAZgAAAGUAAABXAAAAVQAAAHIAAABwAAAAZAAAAGcAAABbAAAAYQAAAFkAAAB0AAAAaQAAAG8AAABoAAAAawAAAG4AAABzAAAAVgAAAF4AAABgAAAAaQAAAFgAAABnAAAAWwAAAHEAAABjAAAAdAAAAGoAAABdAAAAYwAAAFoAAAB1AAAAbQAAAHEAAABrAAAAfwAAAGUAAABeAAAAcwAAAGgAAABwAAAAbAAAAGQAAABfAAAAXAAAAHYAAAByAAAAbQAAAG0AAABsAAAAXQAAAF8AAAB1AAAAdgAAAGoAAABuAAAAYgAAAGgAAABgAAAAdwAAAG8AAABzAAAAbwAAAGEAAABuAAAAYgAAAHQAAABnAAAAdwAAAHAAAABrAAAAZgAAAGUAAAB4AAAAcwAAAHIAAABxAAAAYwAAAHQAAABpAAAAdQAAAGoAAAB5AAAAcgAAAHAAAABkAAAAZgAAAHYAAAB4AAAAbAAAAHMAAABuAAAAawAAAGgAAAB4AAAAdwAAAHAAAAB0AAAAZwAAAHcAAABvAAAAcQAAAGkAAAB5AAAAdQAAAH8AAABtAAAAdgAAAHEAAAB5AAAAagAAAHYAAAB4AAAAbAAAAHIAAAB1AAAAeQAAAG0AAAB3AAAAbwAAAHMAAABuAAAAeQAAAHQAAAB4AAAAeAAAAHMAAAByAAAAcAAAAHkAAAB3AAAAdgAAAHkAAAB0AAAAeAAAAHcAAAB1AAAAcQAAAHYAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAACAAAABQAAAAEAAAAAAAAA/////wEAAAAAAAAAAwAAAAQAAAACAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAUAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABAAAAAUAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAUAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAD//////////wEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAAAAAAAAAAABAAAAAgAAAAYAAAAEAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAAAAAAAAAAAAQAAAAEAAAAFAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAAAAAAAAAAABAAAAAwAAAAcAAAAGAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADgAAAAIAAAAAAAAAAAAAAAEAAAAAAAAACQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAAAAAAAAAAAAAEAAAAEAAAACAAAAAoAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAAAAAAAAAAAAQAAAAsAAAAPAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAIAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAAAAAAAAAAAAQAAAAwAAAAQAAAADAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAAAAAAAAAAABAAAACgAAABMAAAAIAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAAAAAAAAAAAAAEAAAANAAAAEQAAAA0AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAACAAAAAAAAAAAAAAABAAAADgAAABIAAAAPAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAADwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABIAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAAAAAAAAQAAAP//////////EwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAASAAAAAAAAABgAAAAAAAAAIQAAAAAAAAAeAAAAAAAAACAAAAADAAAAMQAAAAEAAAAwAAAAAwAAADIAAAADAAAACAAAAAAAAAAFAAAABQAAAAoAAAAFAAAAFgAAAAAAAAAQAAAAAAAAABIAAAAAAAAAKQAAAAEAAAAhAAAAAAAAAB4AAAAAAAAABAAAAAAAAAAAAAAABQAAAAIAAAAFAAAADwAAAAEAAAAIAAAAAAAAAAUAAAAFAAAAHwAAAAEAAAAWAAAAAAAAABAAAAAAAAAAAgAAAAAAAAAGAAAAAAAAAA4AAAAAAAAACgAAAAAAAAALAAAAAAAAABEAAAADAAAAGAAAAAEAAAAXAAAAAwAAABkAAAADAAAAAAAAAAAAAAABAAAABQAAAAkAAAAFAAAABQAAAAAAAAACAAAAAAAAAAYAAAAAAAAAEgAAAAEAAAAKAAAAAAAAAAsAAAAAAAAABAAAAAEAAAADAAAABQAAAAcAAAAFAAAACAAAAAEAAAAAAAAAAAAAAAEAAAAFAAAAEAAAAAEAAAAFAAAAAAAAAAIAAAAAAAAABwAAAAAAAAAVAAAAAAAAACYAAAAAAAAACQAAAAAAAAATAAAAAAAAACIAAAADAAAADgAAAAEAAAAUAAAAAwAAACQAAAADAAAAAwAAAAAAAAANAAAABQAAAB0AAAAFAAAAAQAAAAAAAAAHAAAAAAAAABUAAAAAAAAABgAAAAEAAAAJAAAAAAAAABMAAAAAAAAABAAAAAIAAAAMAAAABQAAABoAAAAFAAAAAAAAAAEAAAADAAAAAAAAAA0AAAAFAAAAAgAAAAEAAAABAAAAAAAAAAcAAAAAAAAAGgAAAAAAAAAqAAAAAAAAADoAAAAAAAAAHQAAAAAAAAArAAAAAAAAAD4AAAADAAAAJgAAAAEAAAAvAAAAAwAAAEAAAAADAAAADAAAAAAAAAAcAAAABQAAACwAAAAFAAAADQAAAAAAAAAaAAAAAAAAACoAAAAAAAAAFQAAAAEAAAAdAAAAAAAAACsAAAAAAAAABAAAAAMAAAAPAAAABQAAAB8AAAAFAAAAAwAAAAEAAAAMAAAAAAAAABwAAAAFAAAABwAAAAEAAAANAAAAAAAAABoAAAAAAAAAHwAAAAAAAAApAAAAAAAAADEAAAAAAAAALAAAAAAAAAA1AAAAAAAAAD0AAAADAAAAOgAAAAEAAABBAAAAAwAAAEsAAAADAAAADwAAAAAAAAAWAAAABQAAACEAAAAFAAAAHAAAAAAAAAAfAAAAAAAAACkAAAAAAAAAKgAAAAEAAAAsAAAAAAAAADUAAAAAAAAABAAAAAQAAAAIAAAABQAAABAAAAAFAAAADAAAAAEAAAAPAAAAAAAAABYAAAAFAAAAGgAAAAEAAAAcAAAAAAAAAB8AAAAAAAAAMgAAAAAAAAAwAAAAAAAAADEAAAADAAAAIAAAAAAAAAAeAAAAAwAAACEAAAADAAAAGAAAAAMAAAASAAAAAwAAABAAAAADAAAARgAAAAAAAABDAAAAAAAAAEIAAAADAAAANAAAAAMAAAAyAAAAAAAAADAAAAAAAAAAJQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAUwAAAAAAAABXAAAAAwAAAFUAAAADAAAASgAAAAMAAABGAAAAAAAAAEMAAAAAAAAAOQAAAAEAAAA0AAAAAwAAADIAAAAAAAAAGQAAAAAAAAAXAAAAAAAAABgAAAADAAAAEQAAAAAAAAALAAAAAwAAAAoAAAADAAAADgAAAAMAAAAGAAAAAwAAAAIAAAADAAAALQAAAAAAAAAnAAAAAAAAACUAAAADAAAAIwAAAAMAAAAZAAAAAAAAABcAAAAAAAAAGwAAAAMAAAARAAAAAAAAAAsAAAADAAAAPwAAAAAAAAA7AAAAAwAAADkAAAADAAAAOAAAAAMAAAAtAAAAAAAAACcAAAAAAAAALgAAAAMAAAAjAAAAAwAAABkAAAAAAAAAJAAAAAAAAAAUAAAAAAAAAA4AAAADAAAAIgAAAAAAAAATAAAAAwAAAAkAAAADAAAAJgAAAAMAAAAVAAAAAwAAAAcAAAADAAAANwAAAAAAAAAoAAAAAAAAABsAAAADAAAANgAAAAMAAAAkAAAAAAAAABQAAAAAAAAAMwAAAAMAAAAiAAAAAAAAABMAAAADAAAASAAAAAAAAAA8AAAAAwAAAC4AAAADAAAASQAAAAMAAAA3AAAAAAAAACgAAAAAAAAARwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAQAAAAAAAAAAvAAAAAAAAACYAAAADAAAAPgAAAAAAAAArAAAAAwAAAB0AAAADAAAAOgAAAAMAAAAqAAAAAwAAABoAAAADAAAAVAAAAAAAAABFAAAAAAAAADMAAAADAAAAUgAAAAMAAABAAAAAAAAAAC8AAAAAAAAATAAAAAMAAAA+AAAAAAAAACsAAAADAAAAYQAAAAAAAABZAAAAAwAAAEcAAAADAAAAYgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAYAAAAAMAAABSAAAAAwAAAEAAAAAAAAAASwAAAAAAAABBAAAAAAAAADoAAAADAAAAPQAAAAAAAAA1AAAAAwAAACwAAAADAAAAMQAAAAMAAAApAAAAAwAAAB8AAAADAAAAXgAAAAAAAABWAAAAAAAAAEwAAAADAAAAUQAAAAMAAABLAAAAAAAAAEEAAAAAAAAAQgAAAAMAAAA9AAAAAAAAADUAAAADAAAAawAAAAAAAABoAAAAAwAAAGAAAAADAAAAZQAAAAMAAABeAAAAAAAAAFYAAAAAAAAAVQAAAAMAAABRAAAAAwAAAEsAAAAAAAAAOQAAAAAAAAA7AAAAAAAAAD8AAAADAAAASgAAAAAAAABOAAAAAwAAAE8AAAADAAAAUwAAAAMAAABcAAAAAwAAAF8AAAADAAAAJQAAAAAAAAAnAAAAAwAAAC0AAAADAAAANAAAAAAAAAA5AAAAAAAAADsAAAAAAAAARgAAAAMAAABKAAAAAAAAAE4AAAADAAAAGAAAAAAAAAAXAAAAAwAAABkAAAADAAAAIAAAAAMAAAAlAAAAAAAAACcAAAADAAAAMgAAAAMAAAA0AAAAAAAAADkAAAAAAAAALgAAAAAAAAA8AAAAAAAAAEgAAAADAAAAOAAAAAAAAABEAAAAAwAAAFAAAAADAAAAPwAAAAMAAABNAAAAAwAAAFoAAAADAAAAGwAAAAAAAAAoAAAAAwAAADcAAAADAAAAIwAAAAAAAAAuAAAAAAAAADwAAAAAAAAALQAAAAMAAAA4AAAAAAAAAEQAAAADAAAADgAAAAAAAAAUAAAAAwAAACQAAAADAAAAEQAAAAMAAAAbAAAAAAAAACgAAAADAAAAGQAAAAMAAAAjAAAAAAAAAC4AAAAAAAAARwAAAAAAAABZAAAAAAAAAGEAAAADAAAASQAAAAAAAABbAAAAAwAAAGcAAAADAAAASAAAAAMAAABYAAAAAwAAAGkAAAADAAAAMwAAAAAAAABFAAAAAwAAAFQAAAADAAAANgAAAAAAAABHAAAAAAAAAFkAAAAAAAAANwAAAAMAAABJAAAAAAAAAFsAAAADAAAAJgAAAAAAAAAvAAAAAwAAAEAAAAADAAAAIgAAAAMAAAAzAAAAAAAAAEUAAAADAAAAJAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAYAAAAAAAAABoAAAAAAAAAGsAAAADAAAAYgAAAAAAAABuAAAAAwAAAHMAAAADAAAAYQAAAAMAAABvAAAAAwAAAHcAAAADAAAATAAAAAAAAABWAAAAAwAAAF4AAAADAAAAUgAAAAAAAABgAAAAAAAAAGgAAAAAAAAAVAAAAAMAAABiAAAAAAAAAG4AAAADAAAAOgAAAAAAAABBAAAAAwAAAEsAAAADAAAAPgAAAAMAAABMAAAAAAAAAFYAAAADAAAAQAAAAAMAAABSAAAAAAAAAGAAAAAAAAAAVQAAAAAAAABXAAAAAAAAAFMAAAADAAAAZQAAAAAAAABmAAAAAwAAAGQAAAADAAAAawAAAAMAAABwAAAAAwAAAHIAAAADAAAAQgAAAAAAAABDAAAAAwAAAEYAAAADAAAAUQAAAAAAAABVAAAAAAAAAFcAAAAAAAAAXgAAAAMAAABlAAAAAAAAAGYAAAADAAAAMQAAAAAAAAAwAAAAAwAAADIAAAADAAAAPQAAAAMAAABCAAAAAAAAAEMAAAADAAAASwAAAAMAAABRAAAAAAAAAFUAAAAAAAAAXwAAAAAAAABcAAAAAAAAAFMAAAAAAAAATwAAAAAAAABOAAAAAAAAAEoAAAADAAAAPwAAAAEAAAA7AAAAAwAAADkAAAADAAAAbQAAAAAAAABsAAAAAAAAAGQAAAAFAAAAXQAAAAEAAABfAAAAAAAAAFwAAAAAAAAATQAAAAEAAABPAAAAAAAAAE4AAAAAAAAAdQAAAAQAAAB2AAAABQAAAHIAAAAFAAAAagAAAAEAAABtAAAAAAAAAGwAAAAAAAAAWgAAAAEAAABdAAAAAQAAAF8AAAAAAAAAWgAAAAAAAABNAAAAAAAAAD8AAAAAAAAAUAAAAAAAAABEAAAAAAAAADgAAAADAAAASAAAAAEAAAA8AAAAAwAAAC4AAAADAAAAagAAAAAAAABdAAAAAAAAAE8AAAAFAAAAYwAAAAEAAABaAAAAAAAAAE0AAAAAAAAAWAAAAAEAAABQAAAAAAAAAEQAAAAAAAAAdQAAAAMAAABtAAAABQAAAF8AAAAFAAAAcQAAAAEAAABqAAAAAAAAAF0AAAAAAAAAaQAAAAEAAABjAAAAAQAAAFoAAAAAAAAAaQAAAAAAAABYAAAAAAAAAEgAAAAAAAAAZwAAAAAAAABbAAAAAAAAAEkAAAADAAAAYQAAAAEAAABZAAAAAwAAAEcAAAADAAAAcQAAAAAAAABjAAAAAAAAAFAAAAAFAAAAdAAAAAEAAABpAAAAAAAAAFgAAAAAAAAAbwAAAAEAAABnAAAAAAAAAFsAAAAAAAAAdQAAAAIAAABqAAAABQAAAFoAAAAFAAAAeQAAAAEAAABxAAAAAAAAAGMAAAAAAAAAdwAAAAEAAAB0AAAAAQAAAGkAAAAAAAAAdwAAAAAAAABvAAAAAAAAAGEAAAAAAAAAcwAAAAAAAABuAAAAAAAAAGIAAAADAAAAawAAAAEAAABoAAAAAwAAAGAAAAADAAAAeQAAAAAAAAB0AAAAAAAAAGcAAAAFAAAAeAAAAAEAAAB3AAAAAAAAAG8AAAAAAAAAcAAAAAEAAABzAAAAAAAAAG4AAAAAAAAAdQAAAAEAAABxAAAABQAAAGkAAAAFAAAAdgAAAAEAAAB5AAAAAAAAAHQAAAAAAAAAcgAAAAEAAAB4AAAAAQAAAHcAAAAAAAAAcgAAAAAAAABwAAAAAAAAAGsAAAAAAAAAZAAAAAAAAABmAAAAAAAAAGUAAAADAAAAUwAAAAEAAABXAAAAAwAAAFUAAAADAAAAdgAAAAAAAAB4AAAAAAAAAHMAAAAFAAAAbAAAAAEAAAByAAAAAAAAAHAAAAAAAAAAXAAAAAEAAABkAAAAAAAAAGYAAAAAAAAAdQAAAAAAAAB5AAAABQAAAHcAAAAFAAAAbQAAAAEAAAB2AAAAAAAAAHgAAAAAAAAAXwAAAAEAAABsAAAAAQAAAHIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAGAAAAAgAAAAUAAAABAAAABAAAAAAAAAAAAAAABQAAAAMAAAABAAAABgAAAAQAAAACAAAAAAAAAH6iBfbytuk/Gq6akm/58z/Xrm0Liez0P5doSdOpSwRAWs602ULg8D/dT7Rcbo/1v1N1RQHFNOM/g9Snx7HW3L8HWsP8Q3jfP6VwOLosutk/9rjk1YQcxj+gnmKMsNn6P/HDeuPFY+M/YHwDjqKhB0Ci19/fCVrbP4UxKkDWOP6/pvljWa09tL9wi7wrQXjnv/Z6yLImkM2/3yTlOzY14D+m+WNZrT20PzwKVQnrQwNA9nrIsiaQzT/g40rFrRQFwPa45NWEHMa/kbslHEZq97/xw3rjxWPjv4cLC2SMBci/otff3wla27+rKF5oIAv0P1N1RQHFNOO/iDJPGyWHBUAHWsP8Q3jfvwQf/by16gXAfqIF9vK26b8XrO0Vh0r+v9eubQuJ7PS/BxLrA0ZZ479azrTZQuDwv1MK1EuItPw/yscgV9Z6FkAwHBR2WjQMQJNRzXsQ5vY/GlUHVJYKF0DONuFv2lMNQNCGZ28QJfk/0WUwoIL36D8ggDOMQuATQNqMOeAy/wZAWFYOYM+M2z/LWC4uH3oSQDE+LyTsMgRAkJzhRGWFGEDd4soovCQQQKqk0DJMEP8/rGmNdwOLBUAW2X/9xCbjP4hu3dcqJhNAzuYItRvdB0CgzW3zJW/sPxotm/Y2TxRAQAk9XmdDDEC1Kx9MKgT3P1M+NctcghZAFVqcLlb0C0Bgzd3sB2b2P77mZDPUWhZAFROHJpUGCEDAfma5CxXtPz1DWq/zYxRAmhYY5824F0DOuQKWSbAOQNCMqrvu3fs/L6DR22K2wT9nAAxPBU8RQGiN6mW43AFAZhu25b633D8c1YgmzowSQNM25BRKWARArGS08/lNxD+LFssHwmMRQLC5aNcxBgJABL9HT0WRF0CjCmJmOGEOQHsuaVzMP/s/TWJCaGGwBUCeu1PAPLzjP9nqN9DZOBNAKE4JcydbCkCGtbd1qjPzP8dgm9U8jhVAtPeKTkVwDkCeCLss5l37P401XMPLmBdAFd29VMVQDUBg0yA55h75Pz6odcYLCRdApBM4rBrkAkDyAVWgQxbRP4XDMnK20hFAymLlF7EmzD8GUgo9XBHlP3lbK7T9COc/k+OhPthhy7+YGEpnrOvCPzBFhLs15u4/epbqB6H4uz9IuuLF5svev6lzLKY31es/CaQ0envF5z8ZY0xlUADXv7zaz7HYEuI/CfbK1sn16T8uAQfWwxLWPzKn/YuFN94/5KdbC1AFu793fyCSnlfvPzK2y4doAMY/NRg5t1/X6b/shq4QJaHDP5yNIAKPOeI/vpn7BSE30r/X4YQrO6nrv78Ziv/Thto/DqJ1Y6+y5z9l51NaxFrlv8QlA65HOLS/86dxiEc96z+Hj0+LFjneP6LzBZ8LTc2/DaJ1Y6+y579l51NaxFrlP8QlA65HOLQ/8qdxiEc967+Jj0+LFjnev6LzBZ8LTc0/1qdbC1AFuz93fyCSnlfvvzK2y4doAMa/NRg5t1/X6T/vhq4QJaHDv5yNIAKPOeK/wJn7BSE30j/W4YQrO6nrP78Ziv/Thtq/CaQ0envF578XY0xlUADXP7zaz7HYEuK/CvbK1sn16b8rAQfWwxLWvzKn/YuFN96/zWLlF7EmzL8GUgo9XBHlv3lbK7T9COe/kOOhPthhyz+cGEpnrOvCvzBFhLs15u6/c5bqB6H4u79IuuLF5sveP6lzLKY31eu/AQAAAP////8HAAAA/////zEAAAD/////VwEAAP////9hCQAA/////6dBAAD/////kcsBAP/////3kAwA/////8H2VwAAAAAAAAAAAAAAAAACAAAA/////w4AAAD/////YgAAAP////+uAgAA/////8ISAAD/////ToMAAP////8ilwMA/////+4hGQD/////gu2vAAAAAAAAAAAAAAAAAAAAAAACAAAA//////////8BAAAAAwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////AgAAAP//////////AQAAAAAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD/////////////////////AQAAAP///////////////wIAAAD///////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP///////////////////////////////wIAAAD///////////////8BAAAA/////////////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAABAAAA//////////8CAAAA//////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAAAQAAAP//////////AgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAACAAAAAAAAAAIAAAABAAAAAQAAAAIAAAACAAAAAAAAAAUAAAAFAAAAAAAAAAIAAAACAAAAAwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAEAAAACAAAAAgAAAAIAAAAAAAAABQAAAAYAAAAAAAAAAgAAAAIAAAADAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAAAAAACAAAAAQAAAAMAAAACAAAAAgAAAAAAAAAFAAAABwAAAAAAAAACAAAAAgAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAACAAAAAAAAAAIAAAABAAAABAAAAAIAAAACAAAAAAAAAAUAAAAIAAAAAAAAAAIAAAACAAAAAwAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAIAAAAAAAAAAgAAAAEAAAAAAAAAAgAAAAIAAAAAAAAABQAAAAkAAAAAAAAAAgAAAAIAAAADAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAIAAAAAAAAAAwAAAA4AAAACAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAgAAAAMAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAgAAAAAAAAADAAAACgAAAAIAAAAAAAAAAgAAAAMAAAABAAAAAAAAAAIAAAACAAAAAwAAAAcAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAACAAAAAAAAAAMAAAALAAAAAgAAAAAAAAACAAAAAwAAAAIAAAAAAAAAAgAAAAIAAAADAAAACAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAIAAAAAAAAAAwAAAAwAAAACAAAAAAAAAAIAAAADAAAAAwAAAAAAAAACAAAAAgAAAAMAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAACAAAAAgAAAAAAAAADAAAADQAAAAIAAAAAAAAAAgAAAAMAAAAEAAAAAAAAAAIAAAACAAAAAwAAAAoAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAACAAAAAAAAAAMAAAAGAAAAAgAAAAAAAAACAAAAAwAAAA8AAAAAAAAAAgAAAAIAAAADAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAIAAAAAAAAAAwAAAAcAAAACAAAAAAAAAAIAAAADAAAAEAAAAAAAAAACAAAAAgAAAAMAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAgAAAAAAAAADAAAACAAAAAIAAAAAAAAAAgAAAAMAAAARAAAAAAAAAAIAAAACAAAAAwAAAA0AAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAACAAAAAAAAAAMAAAAJAAAAAgAAAAAAAAACAAAAAwAAABIAAAAAAAAAAgAAAAIAAAADAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAgAAAAIAAAAAAAAAAwAAAAUAAAACAAAAAAAAAAIAAAADAAAAEwAAAAAAAAACAAAAAgAAAAMAAAAPAAAAAAAAAAAAAAAAAAAAAAAAABAAAAACAAAAAAAAAAIAAAABAAAAEwAAAAIAAAACAAAAAAAAAAUAAAAKAAAAAAAAAAIAAAACAAAAAwAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAIAAAAAAAAAAgAAAAEAAAAPAAAAAgAAAAIAAAAAAAAABQAAAAsAAAAAAAAAAgAAAAIAAAADAAAAEQAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAgAAAAAAAAACAAAAAQAAABAAAAACAAAAAgAAAAAAAAAFAAAADAAAAAAAAAACAAAAAgAAAAMAAAASAAAAAAAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAIAAAABAAAAEQAAAAIAAAACAAAAAAAAAAUAAAANAAAAAAAAAAIAAAACAAAAAwAAABMAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAIAAAAAAAAAAgAAAAEAAAASAAAAAgAAAAIAAAAAAAAABQAAAA4AAAAAAAAAAgAAAAIAAAADAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAAAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAOgehWlKfUEEz1zLi+JsiQa2og3wcMfVAWCbHorc0yEDi+Yn/Y6mbQJ11/mfsnG9At6bnG4UQQkBvMCQWKqUUQJVmwwswmOc/3hVgVBL3uj//qqOEOdGOPw/WDN4gnGE/H3ANkCUgND+AA8btKgAHPwTXBqJVSdo+XfRQAqsKrj4fc+zLYbSPQklEmCZHv2FCUP+uDso1NEKYtPhwphUHQptxnyFXYdpB7CddZAMmrkGAt1AxSTqBQUibBVdTsFNBSuX3MV+AJkFocv82SLf5QAqmgj7AY81A23VDSEnLoEDGEJVSeDFzQDYrqvBk70VA8U157pcRGUBWfEF+ZKbsP7KBdLHZTpFAqKYk69AqekDbeGY41MdjQD8AZzHK501A1vcrrjubNkD5LnquvBYhQCbiRRD71QlAqt72EbOH8z8Eu+jL1YbdP4uaox/xUcY/abedg1XfsD+BsUdzJ4KZP5wE9YFySIM/rW1kAKMpbT+rZFthVRhWPy4PKlXIs0A/qMZLlwDnMEHByqEF0I0ZQQYSFD8lUQNBPpY+dFs07UAH8BZImBPWQN9RY0I0sMBA2T7kLfc6qUByFYvfhBKTQMq+0Mis1XxA0XQbeQXMZUBJJ5aEGXpQQP7/SY0a6ThAaMD92b/UIkAs8s8yqXoMQNIegOvCk/U/aOi7NZJP4D8AAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAD/////AAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAA/////wAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAP////8AAAAABQAAAAAAAAAAAAAAAAAAAAAAAAD/////BQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAABAAAAAAAAAAUAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAEAAQAAAQEAAAAAAAEAAAABAAAAAQABAAAAAAAAAAAAAAAAAAAAAAcAAAAHAAAAAQAAAAIAAAAEAAAAAwAAAAAAAAAAAAAABwAAAAMAAAABAAAAAgAAAAUAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAGAAAAAgAAAAMAAAAFAAAABAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAwAAAAEAAAAFAAAABAAAAAAAAAAAAAAABwAAAAUAAAADAAAABAAAAAEAAAAAAAAAAgAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAAGFsZ29zLmMAaDNOZWlnaGJvclJvdGF0aW9ucwBjb29yZGlqay5jAF91cEFwN0NoZWNrZWQAX3VwQXA3ckNoZWNrZWQAZGlyZWN0ZWRFZGdlLmMAZGlyZWN0ZWRFZGdlVG9Cb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbdG1wRmlqay5mYWNlXVtmaWprLmZhY2VdID09IEtJAGZhY2VpamsuYwBfZmFjZUlqa1BlbnRUb0NlbGxCb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbY2VudGVySUpLLmZhY2VdW2ZhY2UyXSA9PSBLSQBfZmFjZUlqa1RvQ2VsbEJvdW5kYXJ5AGgzSW5kZXguYwBjb21wYWN0Q2VsbHMAbGF0TG5nVG9DZWxsAGNlbGxUb0NoaWxkUG9zAHZhbGlkYXRlQ2hpbGRQb3MAbGF0TG5nLmMAY2VsbEFyZWFSYWRzMgBwb2x5Z29uLT5uZXh0ID09IE5VTEwAbGlua2VkR2VvLmMAYWRkTmV3TGlua2VkUG9seWdvbgBuZXh0ICE9IE5VTEwAbG9vcCAhPSBOVUxMAGFkZE5ld0xpbmtlZExvb3AAcG9seWdvbi0+Zmlyc3QgPT0gTlVMTABhZGRMaW5rZWRMb29wAGNvb3JkICE9IE5VTEwAYWRkTGlua2VkQ29vcmQAbG9vcC0+Zmlyc3QgPT0gTlVMTABpbm5lckxvb3BzICE9IE5VTEwAbm9ybWFsaXplTXVsdGlQb2x5Z29uAGJib3hlcyAhPSBOVUxMAGNhbmRpZGF0ZXMgIT0gTlVMTABmaW5kUG9seWdvbkZvckhvbGUAY2FuZGlkYXRlQkJveGVzICE9IE5VTEwAcmV2RGlyICE9IElOVkFMSURfRElHSVQAbG9jYWxpai5jAGNlbGxUb0xvY2FsSWprAGJhc2VDZWxsICE9IG9yaWdpbkJhc2VDZWxsACEob3JpZ2luT25QZW50ICYmIGluZGV4T25QZW50KQBiYXNlQ2VsbCA9PSBvcmlnaW5CYXNlQ2VsbABiYXNlQ2VsbCAhPSBJTlZBTElEX0JBU0VfQ0VMTABsb2NhbElqa1RvQ2VsbAAhX2lzQmFzZUNlbGxQZW50YWdvbihiYXNlQ2VsbCkAYmFzZUNlbGxSb3RhdGlvbnMgPj0gMABncmlkUGF0aENlbGxzADAAdmVydGV4LmMAY2VsbFRvVmVydGV4AGdyYXBoLT5idWNrZXRzICE9IE5VTEwAdmVydGV4R3JhcGguYwBpbml0VmVydGV4R3JhcGgAbm9kZSAhPSBOVUxMAGFkZFZlcnRleE5vZGU=";var Iw=24144;function Rw(ae,pe,Be,He){er("Assertion failed: "+se(ae)+", at: "+[pe?se(pe):"unknown filename",Be,He?se(He):"unknown function"])}function n0(){return fe.length}function Pw(ae,pe,Be){we.set(we.subarray(pe,pe+Be),ae)}function Mw(ae){return e.___errno_location&&(Fe[e.___errno_location()>>2]=ae),ae}function Bw(ae){er("OOM")}function Ow(ae){try{var pe=new ArrayBuffer(ae);return pe.byteLength!=ae?void 0:(new Int8Array(pe).set(fe),Uw(pe),W(pe),1)}catch{}}function Dw(ae){var pe=n0(),Be=16777216,He=2147483648-Be;if(ae>He)return!1;for(var u=16777216,B=Math.max(pe,u);B<ae;)B<=536870912?B=q(2*B,Be):B=Math.min(q((3*B+2147483648)/4,Be),He);var at=Ow(B);return!!at}var Nw=typeof atob=="function"?atob:function(ae){var pe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Be="",He,u,B,at,bt,en,it,lt=0;ae=ae.replace(/[^A-Za-z0-9\+\/\=]/g,"");do at=pe.indexOf(ae.charAt(lt++)),bt=pe.indexOf(ae.charAt(lt++)),en=pe.indexOf(ae.charAt(lt++)),it=pe.indexOf(ae.charAt(lt++)),He=at<<2|bt>>4,u=(bt&15)<<4|en>>2,B=(en&3)<<6|it,Be=Be+String.fromCharCode(He),en!==64&&(Be=Be+String.fromCharCode(u)),it!==64&&(Be=Be+String.fromCharCode(B));while(lt<ae.length);return Be};function Fw(ae){try{for(var pe=Nw(ae),Be=new Uint8Array(pe.length),He=0;He<pe.length;++He)Be[He]=pe.charCodeAt(He);return Be}catch{throw new Error("Converting base64 string to bytes failed.")}}function vA(ae){if(t0(ae))return Fw(ae.slice(yA.length))}var Lw={Math,Int8Array,Int32Array,Uint8Array,Float32Array,Float64Array},kw={b:g,c:_,d:Rw,e:Mw,f:n0,g:Pw,h:Dw,i:Bw,o:Iw,p:le},ve=function(ae,pe,Be){"almost asm";var He=new ae.Int8Array(Be),u=new ae.Int32Array(Be);new ae.Uint8Array(Be),new ae.Float32Array(Be);var B=new ae.Float64Array(Be),at=pe.o|0,bt=pe.p|0,en=ae.Math.floor,it=ae.Math.abs,lt=ae.Math.sqrt,zi=ae.Math.pow,vt=ae.Math.cos,et=ae.Math.sin,Vn=ae.Math.tan,Ea=ae.Math.acos,Hw=ae.Math.asin,EA=ae.Math.atan,zn=ae.Math.atan2,tr=ae.Math.ceil,pi=ae.Math.imul,xA=ae.Math.min,Gw=ae.Math.max,_s=ae.Math.clz32,tt=pe.b,N=pe.c,ke=pe.d,a0=pe.e,Ww=pe.f,jw=pe.g,$w=pe.h,Xw=pe.i,M=24160;function Qw(A){return He=new Int8Array(A),u=new Int32Array(A),B=new Float64Array(A),Be=A,!0}function Yw(A){A=A|0;var c=0;return c=M,M=M+A|0,M=M+15&-16,c|0}function Kw(){return M|0}function qw(A){A=A|0,M=A}function Jw(A,c){A=A|0,M=A}function Zw(A,c){A=A|0,c=c|0;var h=0,d=0,p=0;return(A|0)<0?(c=2,c|0):(A|0)>13780509?(c=VA(15,c)|0,c|0):(h=((A|0)<0)<<31>>31,p=gn(A|0,h|0,3,0)|0,d=N()|0,h=st(A|0,h|0,1,0)|0,h=gn(p|0,d|0,h|0,N()|0)|0,h=st(h|0,N()|0,1,0)|0,A=N()|0,u[c>>2]=h,u[c+4>>2]=A,c=0,c|0)}function l0(A,c,h,d){return A=A|0,c=c|0,h=h|0,d=d|0,c0(A,c,h,d,0)|0}function c0(A,c,h,d,p){A=A|0,c=c|0,h=h|0,d=d|0,p=p|0;var m=0,y=0,b=0,w=0,E=0;if(w=M,M=M+16|0,y=w,!(A0(A,c,h,d,p)|0))return d=0,M=w,d|0;do if((h|0)>=0){if((h|0)>13780509){if(m=VA(15,y)|0,m|0)break;b=y,y=u[b>>2]|0,b=u[b+4>>2]|0}else m=((h|0)<0)<<31>>31,E=gn(h|0,m|0,3,0)|0,b=N()|0,m=st(h|0,m|0,1,0)|0,m=gn(E|0,b|0,m|0,N()|0)|0,m=st(m|0,N()|0,1,0)|0,b=N()|0,u[y>>2]=m,u[y+4>>2]=b,y=m;if(Es(d|0,0,y<<3|0)|0,p|0){Es(p|0,0,y<<2|0)|0,m=Mi(A,c,h,d,p,y,b,0)|0;break}m=_i(y,4)|0,m?(E=Mi(A,c,h,d,m,y,b,0)|0,je(m),m=E):m=13}else m=2;while(!1);return E=m,M=w,E|0}function A0(A,c,h,d,p){A=A|0,c=c|0,h=h|0,d=d|0,p=p|0;var m=0,y=0,b=0,w=0,E=0,I=0,O=0,H=0,G=0,V=0,K=0;if(K=M,M=M+16|0,G=K,V=K+8|0,H=G,u[H>>2]=A,u[H+4>>2]=c,(h|0)<0)return V=2,M=K,V|0;if(m=d,u[m>>2]=A,u[m+4>>2]=c,m=(p|0)!=0,m&&(u[p>>2]=0),Ot(A,c)|0)return V=9,M=K,V|0;u[V>>2]=0;e:do if((h|0)>=1)if(m)for(I=1,E=0,O=0,H=1,m=A;;){if(!(E|O)){if(m=tn(m,c,4,V,G)|0,m|0)break e;if(c=G,m=u[c>>2]|0,c=u[c+4>>2]|0,Ot(m,c)|0){m=9;break e}}if(m=tn(m,c,u[22384+(O<<2)>>2]|0,V,G)|0,m|0)break e;if(c=G,m=u[c>>2]|0,c=u[c+4>>2]|0,A=d+(I<<3)|0,u[A>>2]=m,u[A+4>>2]=c,u[p+(I<<2)>>2]=H,A=E+1|0,y=(A|0)==(H|0),b=O+1|0,w=(b|0)==6,Ot(m,c)|0){m=9;break e}if(H=H+(w&y&1)|0,(H|0)>(h|0)){m=0;break}else I=I+1|0,E=y?0:A,O=y?w?0:b:O}else for(I=1,E=0,O=0,H=1,m=A;;){if(!(E|O)){if(m=tn(m,c,4,V,G)|0,m|0)break e;if(c=G,m=u[c>>2]|0,c=u[c+4>>2]|0,Ot(m,c)|0){m=9;break e}}if(m=tn(m,c,u[22384+(O<<2)>>2]|0,V,G)|0,m|0)break e;if(c=G,m=u[c>>2]|0,c=u[c+4>>2]|0,A=d+(I<<3)|0,u[A>>2]=m,u[A+4>>2]=c,A=E+1|0,y=(A|0)==(H|0),b=O+1|0,w=(b|0)==6,Ot(m,c)|0){m=9;break e}if(H=H+(w&y&1)|0,(H|0)>(h|0)){m=0;break}else I=I+1|0,E=y?0:A,O=y?w?0:b:O}else m=0;while(!1);return V=m,M=K,V|0}function Mi(A,c,h,d,p,m,y,b){A=A|0,c=c|0,h=h|0,d=d|0,p=p|0,m=m|0,y=y|0,b=b|0;var w=0,E=0,I=0,O=0,H=0,G=0,V=0,K=0,ue=0,ce=0;if(K=M,M=M+16|0,G=K+8|0,V=K,w=rr(A|0,c|0,m|0,y|0)|0,I=N()|0,O=d+(w<<3)|0,ue=O,ce=u[ue>>2]|0,ue=u[ue+4>>2]|0,E=(ce|0)==(A|0)&(ue|0)==(c|0),!((ce|0)==0&(ue|0)==0|E))do w=st(w|0,I|0,1,0)|0,w=Pa(w|0,N()|0,m|0,y|0)|0,I=N()|0,O=d+(w<<3)|0,ce=O,ue=u[ce>>2]|0,ce=u[ce+4>>2]|0,E=(ue|0)==(A|0)&(ce|0)==(c|0);while(!((ue|0)==0&(ce|0)==0|E));if(w=p+(w<<2)|0,E&&(u[w>>2]|0)<=(b|0)||(ce=O,u[ce>>2]=A,u[ce+4>>2]=c,u[w>>2]=b,(b|0)>=(h|0)))return ce=0,M=K,ce|0;switch(E=b+1|0,u[G>>2]=0,w=tn(A,c,2,G,V)|0,w|0){case 9:{H=9;break}case 0:{w=V,w=Mi(u[w>>2]|0,u[w+4>>2]|0,h,d,p,m,y,E)|0,w||(H=9);break}}e:do if((H|0)==9){switch(u[G>>2]=0,w=tn(A,c,3,G,V)|0,w|0){case 9:break;case 0:{if(w=V,w=Mi(u[w>>2]|0,u[w+4>>2]|0,h,d,p,m,y,E)|0,w|0)break e;break}default:break e}switch(u[G>>2]=0,w=tn(A,c,1,G,V)|0,w|0){case 9:break;case 0:{if(w=V,w=Mi(u[w>>2]|0,u[w+4>>2]|0,h,d,p,m,y,E)|0,w|0)break e;break}default:break e}switch(u[G>>2]=0,w=tn(A,c,5,G,V)|0,w|0){case 9:break;case 0:{if(w=V,w=Mi(u[w>>2]|0,u[w+4>>2]|0,h,d,p,m,y,E)|0,w|0)break e;break}default:break e}switch(u[G>>2]=0,w=tn(A,c,4,G,V)|0,w|0){case 9:break;case 0:{if(w=V,w=Mi(u[w>>2]|0,u[w+4>>2]|0,h,d,p,m,y,E)|0,w|0)break e;break}default:break e}switch(u[G>>2]=0,w=tn(A,c,6,G,V)|0,w|0){case 9:break;case 0:{if(w=V,w=Mi(u[w>>2]|0,u[w+4>>2]|0,h,d,p,m,y,E)|0,w|0)break e;break}default:break e}return ce=0,M=K,ce|0}while(!1);return ce=w,M=K,ce|0}function tn(A,c,h,d,p){A=A|0,c=c|0,h=h|0,d=d|0,p=p|0;var m=0,y=0,b=0,w=0,E=0,I=0,O=0,H=0,G=0,V=0;if(h>>>0>6)return p=1,p|0;if(O=(u[d>>2]|0)%6|0,u[d>>2]=O,(O|0)>0){m=0;do h=vs(h)|0,m=m+1|0;while((m|0)<(u[d>>2]|0))}if(O=_e(A|0,c|0,45)|0,N()|0,I=O&127,I>>>0>121)return p=5,p|0;w=Sn(A,c)|0,m=_e(A|0,c|0,52)|0,N()|0,m=m&15;e:do if(!m)E=8;else{for(;;){if(y=(15-m|0)*3|0,b=_e(A|0,c|0,y|0)|0,N()|0,b=b&7,(b|0)==7){c=5;break}if(V=(Hn(m)|0)==0,m=m+-1|0,H=xe(7,0,y|0)|0,c=c&~(N()|0),G=xe(u[(V?432:16)+(b*28|0)+(h<<2)>>2]|0,0,y|0)|0,y=N()|0,h=u[(V?640:224)+(b*28|0)+(h<<2)>>2]|0,A=G|A&~H,c=y|c,!h){h=0;break e}if(!m){E=8;break e}}return c|0}while(!1);(E|0)==8&&(V=u[848+(I*28|0)+(h<<2)>>2]|0,G=xe(V|0,0,45)|0,A=G|A,c=N()|0|c&-1040385,h=u[4272+(I*28|0)+(h<<2)>>2]|0,(V&127|0)==127&&(V=xe(u[848+(I*28|0)+20>>2]|0,0,45)|0,c=N()|0|c&-1040385,h=u[4272+(I*28|0)+20>>2]|0,A=Ts(V|A,c)|0,c=N()|0,u[d>>2]=(u[d>>2]|0)+1)),b=_e(A|0,c|0,45)|0,N()|0,b=b&127;e:do if(Bt(b)|0){t:do if((Sn(A,c)|0)==1){if((I|0)!=(b|0))if(f0(b,u[7696+(I*28|0)>>2]|0)|0){A=LA(A,c)|0,y=1,c=N()|0;break}else ke(23313,22416,436,22424);switch(w|0){case 3:{A=Ts(A,c)|0,c=N()|0,u[d>>2]=(u[d>>2]|0)+1,y=0;break t}case 5:{A=LA(A,c)|0,c=N()|0,u[d>>2]=(u[d>>2]|0)+5,y=0;break t}case 0:return V=9,V|0;default:return V=1,V|0}}else y=0;while(!1);if((h|0)>0){m=0;do A=FA(A,c)|0,c=N()|0,m=m+1|0;while((m|0)!=(h|0))}if((I|0)!=(b|0)){if(!(SA(b)|0)){if((y|0)!=0|(Sn(A,c)|0)!=5)break;u[d>>2]=(u[d>>2]|0)+1;break}switch(O&127){case 8:case 118:break e}(Sn(A,c)|0)!=3&&(u[d>>2]=(u[d>>2]|0)+1)}}else if((h|0)>0){m=0;do A=Ts(A,c)|0,c=N()|0,m=m+1|0;while((m|0)!=(h|0))}while(!1);return u[d>>2]=((u[d>>2]|0)+h|0)%6|0,V=p,u[V>>2]=A,u[V+4>>2]=c,V=0,V|0}function CA(A,c,h,d){A=A|0,c=c|0,h=h|0,d=d|0;var p=0,m=0,y=0,b=0,w=0,E=0;for(b=M,M=M+16|0,m=b,y=b+8|0,p=(Ot(A,c)|0)==0,p=p?1:2;;){if(u[y>>2]=0,E=(tn(A,c,p,y,m)|0)==0,w=m,E&((u[w>>2]|0)==(h|0)?(u[w+4>>2]|0)==(d|0):0)){A=4;break}if(p=p+1|0,p>>>0>=7){p=7,A=4;break}}return(A|0)==4?(M=b,p|0):0}function e3(A,c,h,d){A=A|0,c=c|0,h=h|0,d=d|0;var p=0,m=0,y=0,b=0,w=0,E=0,I=0,O=0,H=0,G=0,V=0;if(V=M,M=M+16|0,H=V,G=V+8|0,O=H,u[O>>2]=A,u[O+4>>2]=c,!h)return G=d,u[G>>2]=A,u[G+4>>2]=c,G=0,M=V,G|0;u[G>>2]=0;e:do if(Ot(A,c)|0)A=9;else{if(m=(h|0)>0,m){p=0,O=A;do{if(A=tn(O,c,4,G,H)|0,A|0)break e;if(c=H,O=u[c>>2]|0,c=u[c+4>>2]|0,p=p+1|0,Ot(O,c)|0){A=9;break e}}while((p|0)<(h|0));if(I=d,u[I>>2]=O,u[I+4>>2]=c,I=h+-1|0,m){E=0,A=1;do{if(p=22384+(E<<2)|0,(E|0)==5)for(y=u[p>>2]|0,m=0,p=A;;){if(A=H,A=tn(u[A>>2]|0,u[A+4>>2]|0,y,G,H)|0,A|0)break e;if((m|0)!=(I|0))if(w=H,b=u[w>>2]|0,w=u[w+4>>2]|0,A=d+(p<<3)|0,u[A>>2]=b,u[A+4>>2]=w,!(Ot(b,w)|0))A=p+1|0;else{A=9;break e}else A=p;if(m=m+1|0,(m|0)>=(h|0))break;p=A}else for(y=H,w=u[p>>2]|0,b=0,p=A,m=u[y>>2]|0,y=u[y+4>>2]|0;;){if(A=tn(m,y,w,G,H)|0,A|0)break e;if(y=H,m=u[y>>2]|0,y=u[y+4>>2]|0,A=d+(p<<3)|0,u[A>>2]=m,u[A+4>>2]=y,A=p+1|0,Ot(m,y)|0){A=9;break e}if(b=b+1|0,(b|0)>=(h|0))break;p=A}E=E+1|0}while(E>>>0<6);A=H,y=O,p=u[A>>2]|0,m=c,A=u[A+4>>2]|0}else y=O,p=O,m=c,A=c}else y=d,u[y>>2]=A,u[y+4>>2]=c,y=A,p=A,m=c,A=c;A=(y|0)==(p|0)&(m|0)==(A|0)?0:9}while(!1);return G=A,M=V,G|0}function t3(A,c,h,d){A=A|0,c=c|0,h=h|0,d=d|0;var p=0,m=0,y=0,b=0,w=0,E=0;if(b=M,M=M+48|0,p=b+16|0,m=b+8|0,y=b,h|0)return y=15,M=b,y|0;if(E=A,w=u[E+4>>2]|0,h=m,u[h>>2]=u[E>>2],u[h+4>>2]=w,F0(m,p),c=p0(p,c,y)|0,!c){if(h=u[m>>2]|0,m=u[A+8>>2]|0,(m|0)>0){p=u[A+12>>2]|0,c=0;do h=(u[p+(c<<3)>>2]|0)+h|0,c=c+1|0;while((c|0)<(m|0))}c=y,p=u[c>>2]|0,c=u[c+4>>2]|0,m=((h|0)<0)<<31>>31,(c|0)<(m|0)|(c|0)==(m|0)&p>>>0<h>>>0?(c=y,u[c>>2]=h,u[c+4>>2]=m,c=m):h=p,w=st(h|0,c|0,12,0)|0,E=N()|0,c=y,u[c>>2]=w,u[c+4>>2]=E,c=d,u[c>>2]=w,u[c+4>>2]=E,c=0}return E=c,M=b,E|0}function u0(A,c,h,d,p,m,y){A=A|0,c=c|0,h=h|0,d=d|0,p=p|0,m=m|0,y=y|0;var b=0,w=0,E=0,I=0,O=0,H=0,G=0,V=0,K=0,ue=0,ce=0,ie=0,oe=0,Y=0,Re=0,De=0,Ee=0,Pe=0,mt=0,ot=0,ct=0,Ke=0,Ye=0,qe=0,Tt=0,$e=0,St=0,xn=0,X0=0;if(Tt=M,M=M+64|0,ct=Tt+48|0,Ke=Tt+32|0,Ye=Tt+24|0,Re=Tt+8|0,De=Tt,w=u[A>>2]|0,(w|0)<=0)return qe=0,M=Tt,qe|0;for(Ee=A+4|0,Pe=ct+8|0,mt=Ke+8|0,ot=Re+8|0,b=0,oe=0;;){E=u[Ee>>2]|0,ie=E+(oe<<4)|0,u[ct>>2]=u[ie>>2],u[ct+4>>2]=u[ie+4>>2],u[ct+8>>2]=u[ie+8>>2],u[ct+12>>2]=u[ie+12>>2],(oe|0)==(w+-1|0)?(u[Ke>>2]=u[E>>2],u[Ke+4>>2]=u[E+4>>2],u[Ke+8>>2]=u[E+8>>2],u[Ke+12>>2]=u[E+12>>2]):(ie=E+(oe+1<<4)|0,u[Ke>>2]=u[ie>>2],u[Ke+4>>2]=u[ie+4>>2],u[Ke+8>>2]=u[ie+8>>2],u[Ke+12>>2]=u[ie+12>>2]),w=A3(ct,Ke,d,Ye)|0;e:do if(w)E=0,b=w;else if(E=Ye,w=u[E>>2]|0,E=u[E+4>>2]|0,(E|0)>0|(E|0)==0&w>>>0>0){ce=0,ie=0;t:for(;;){if(X0=+B[ct>>3],ue=dn(w|0,E|0,ce|0,ie|0)|0,xn=+(ue>>>0)+4294967296*+(N()|0),$e=+(w>>>0)+4294967296*+(E|0),St=+(ce>>>0)+4294967296*+(ie|0),B[Re>>3]=X0*xn/$e+ +B[Ke>>3]*St/$e,B[ot>>3]=+B[Pe>>3]*xn/$e+ +B[mt>>3]*St/$e,w=S0(Re,d,De)|0,w|0){b=w;break}ue=De,K=u[ue>>2]|0,ue=u[ue+4>>2]|0,H=rr(K|0,ue|0,c|0,h|0)|0,I=N()|0,w=y+(H<<3)|0,O=w,E=u[O>>2]|0,O=u[O+4>>2]|0;n:do if((E|0)==0&(O|0)==0)Y=w,qe=16;else for(G=0,V=0;;){if((G|0)>(h|0)|(G|0)==(h|0)&V>>>0>c>>>0){b=1;break t}if((E|0)==(K|0)&(O|0)==(ue|0))break n;if(w=st(H|0,I|0,1,0)|0,H=Pa(w|0,N()|0,c|0,h|0)|0,I=N()|0,V=st(V|0,G|0,1,0)|0,G=N()|0,w=y+(H<<3)|0,O=w,E=u[O>>2]|0,O=u[O+4>>2]|0,(E|0)==0&(O|0)==0){Y=w,qe=16;break}}while(!1);if((qe|0)==16&&(qe=0,!((K|0)==0&(ue|0)==0))&&(V=Y,u[V>>2]=K,u[V+4>>2]=ue,V=m+(u[p>>2]<<3)|0,u[V>>2]=K,u[V+4>>2]=ue,V=p,V=st(u[V>>2]|0,u[V+4>>2]|0,1,0)|0,K=N()|0,ue=p,u[ue>>2]=V,u[ue+4>>2]=K),ce=st(ce|0,ie|0,1,0)|0,ie=N()|0,E=Ye,w=u[E>>2]|0,E=u[E+4>>2]|0,!((E|0)>(ie|0)|(E|0)==(ie|0)&w>>>0>ce>>>0)){E=1;break e}}E=0}else E=1;while(!1);if(oe=oe+1|0,!E){qe=21;break}if(w=u[A>>2]|0,(oe|0)>=(w|0)){b=0,qe=21;break}}return(qe|0)==21?(M=Tt,b|0):0}function n3(A,c,h,d){A=A|0,c=c|0,h=h|0,d=d|0;var p=0,m=0,y=0,b=0,w=0,E=0,I=0,O=0,H=0,G=0,V=0,K=0,ue=0,ce=0,ie=0,oe=0,Y=0,Re=0,De=0,Ee=0,Pe=0,mt=0,ot=0,ct=0,Ke=0,Ye=0,qe=0,Tt=0,$e=0,St=0,xn=0;if(xn=M,M=M+112|0,qe=xn+80|0,w=xn+72|0,Tt=xn,$e=xn+56|0,h|0)return St=15,M=xn,St|0;if(E=A+8|0,St=mi((u[E>>2]<<5)+32|0)|0,!St)return St=13,M=xn,St|0;if(hE(A,St),Ke=A,Ye=u[Ke+4>>2]|0,h=w,u[h>>2]=u[Ke>>2],u[h+4>>2]=Ye,F0(w,qe),h=p0(qe,c,Tt)|0,h)Ke=0,Ye=0;else{if(h=u[w>>2]|0,m=u[E>>2]|0,(m|0)>0){y=u[A+12>>2]|0,p=0;do h=(u[y+(p<<3)>>2]|0)+h|0,p=p+1|0;while((p|0)!=(m|0));p=h}else p=h;h=Tt,m=u[h>>2]|0,h=u[h+4>>2]|0,y=((p|0)<0)<<31>>31,(h|0)<(y|0)|(h|0)==(y|0)&m>>>0<p>>>0?(h=Tt,u[h>>2]=p,u[h+4>>2]=y,h=y):p=m,Ke=st(p|0,h|0,12,0)|0,Ye=N()|0,h=Tt,u[h>>2]=Ke,u[h+4>>2]=Ye,h=0}if(h|0)return je(St),St=h,M=xn,St|0;if(p=_i(Ke,8)|0,!p)return je(St),St=13,M=xn,St|0;if(b=_i(Ke,8)|0,!b)return je(St),je(p),St=13,M=xn,St|0;ot=qe,u[ot>>2]=0,u[ot+4>>2]=0,ot=A,ct=u[ot+4>>2]|0,h=w,u[h>>2]=u[ot>>2],u[h+4>>2]=ct,h=u0(w,Ke,Ye,c,qe,p,b)|0;e:do if(h)je(p),je(b),je(St);else{t:do if((u[E>>2]|0)>0){for(y=A+12|0,m=0;h=u0((u[y>>2]|0)+(m<<3)|0,Ke,Ye,c,qe,p,b)|0,m=m+1|0,!(h|0);)if((m|0)>=(u[E>>2]|0))break t;je(p),je(b),je(St);break e}while(!1);(Ye|0)>0|(Ye|0)==0&Ke>>>0>0&&Es(b|0,0,Ke<<3|0)|0,ct=qe,ot=u[ct+4>>2]|0;t:do if((ot|0)>0|(ot|0)==0&(u[ct>>2]|0)>>>0>0){Ee=p,Pe=b,mt=p,ot=b,ct=p,h=p,Y=p,Re=b,De=b,p=b;n:for(;;){for(ue=0,ce=0,ie=0,oe=0,m=0,y=0;;){b=Tt,w=b+56|0;do u[b>>2]=0,b=b+4|0;while((b|0)<(w|0));if(c=Ee+(ue<<3)|0,E=u[c>>2]|0,c=u[c+4>>2]|0,A0(E,c,1,Tt,0)|0){b=Tt,w=b+56|0;do u[b>>2]=0,b=b+4|0;while((b|0)<(w|0));b=_i(7,4)|0,b|0&&(Mi(E,c,1,Tt,b,7,0,0)|0,je(b))}for(K=0;;){V=Tt+(K<<3)|0,G=u[V>>2]|0,V=u[V+4>>2]|0;i:do if((G|0)==0&(V|0)==0)b=m,w=y;else{if(I=rr(G|0,V|0,Ke|0,Ye|0)|0,E=N()|0,b=d+(I<<3)|0,c=b,w=u[c>>2]|0,c=u[c+4>>2]|0,!((w|0)==0&(c|0)==0)){O=0,H=0;do{if((O|0)>(Ye|0)|(O|0)==(Ye|0)&H>>>0>Ke>>>0)break n;if((w|0)==(G|0)&(c|0)==(V|0)){b=m,w=y;break i}b=st(I|0,E|0,1,0)|0,I=Pa(b|0,N()|0,Ke|0,Ye|0)|0,E=N()|0,H=st(H|0,O|0,1,0)|0,O=N()|0,b=d+(I<<3)|0,c=b,w=u[c>>2]|0,c=u[c+4>>2]|0}while(!((w|0)==0&(c|0)==0))}(G|0)==0&(V|0)==0?(b=m,w=y):(po(G,V,$e)|0,fE(A,St,$e)|0&&(H=st(m|0,y|0,1,0)|0,y=N()|0,O=b,u[O>>2]=G,u[O+4>>2]=V,m=Pe+(m<<3)|0,u[m>>2]=G,u[m+4>>2]=V,m=H),b=m,w=y)}while(!1);if(K=K+1|0,K>>>0>=7)break;m=b,y=w}if(ue=st(ue|0,ce|0,1,0)|0,ce=N()|0,ie=st(ie|0,oe|0,1,0)|0,oe=N()|0,y=qe,m=u[y>>2]|0,y=u[y+4>>2]|0,(oe|0)<(y|0)|(oe|0)==(y|0)&ie>>>0<m>>>0)m=b,y=w;else break}if((y|0)>0|(y|0)==0&m>>>0>0){m=0,y=0;do oe=Ee+(m<<3)|0,u[oe>>2]=0,u[oe+4>>2]=0,m=st(m|0,y|0,1,0)|0,y=N()|0,oe=qe,ie=u[oe+4>>2]|0;while((y|0)<(ie|0)|((y|0)==(ie|0)?m>>>0<(u[oe>>2]|0)>>>0:0))}if(oe=qe,u[oe>>2]=b,u[oe+4>>2]=w,(w|0)>0|(w|0)==0&b>>>0>0)K=p,ue=De,ce=ct,ie=Re,oe=Pe,p=Y,De=h,Re=mt,Y=K,h=ue,ct=ot,ot=ce,mt=ie,Pe=Ee,Ee=oe;else break t}je(mt),je(ot),je(St),h=1;break e}else h=b;while(!1);je(St),je(p),je(h),h=0}while(!1);return St=h,M=xn,St|0}function i3(A,c,h){A=A|0,c=c|0,h=h|0;var d=0,p=0,m=0,y=0,b=0,w=0,E=0,I=0;if(I=M,M=M+176|0,w=I,(c|0)<1)return U0(h,0,0),E=0,M=I,E|0;for(b=A,b=_e(u[b>>2]|0,u[b+4>>2]|0,52)|0,N()|0,U0(h,(c|0)>6?c:6,b&15),b=0;d=A+(b<<3)|0,d=mo(u[d>>2]|0,u[d+4>>2]|0,w)|0,!(d|0);){if(d=u[w>>2]|0,(d|0)>0){y=0;do m=w+8+(y<<4)|0,y=y+1|0,d=w+8+(((y|0)%(d|0)|0)<<4)|0,p=RE(h,d,m)|0,p?H0(h,p)|0:IE(h,m,d)|0,d=u[w>>2]|0;while((y|0)<(d|0))}if(b=b+1|0,(b|0)>=(c|0)){d=0,E=13;break}}return(E|0)==13?(M=I,d|0):(V0(h),E=d,M=I,E|0)}function s3(A,c,h){A=A|0,c=c|0,h=h|0;var d=0,p=0,m=0,y=0;if(m=M,M=M+32|0,d=m,p=m+16|0,A=i3(A,c,p)|0,A|0)return h=A,M=m,h|0;if(u[h>>2]=0,u[h+4>>2]=0,u[h+8>>2]=0,A=z0(p)|0,A|0)do{c=sE(h)|0;do rE(c,A)|0,y=A+16|0,u[d>>2]=u[y>>2],u[d+4>>2]=u[y+4>>2],u[d+8>>2]=u[y+8>>2],u[d+12>>2]=u[y+12>>2],H0(p,A)|0,A=PE(p,d)|0;while((A|0)!=0);A=z0(p)|0}while((A|0)!=0);return V0(p),A=oE(h)|0,A?(B0(h),y=A,M=m,y|0):(y=0,M=m,y|0)}function Bt(A){return A=A|0,A>>>0>121?(A=0,A|0):(A=u[7696+(A*28|0)+16>>2]|0,A|0)}function SA(A){return A=A|0,(A|0)==4|(A|0)==117|0}function h0(A){return A=A|0,u[11120+((u[A>>2]|0)*216|0)+((u[A+4>>2]|0)*72|0)+((u[A+8>>2]|0)*24|0)+(u[A+12>>2]<<3)>>2]|0}function r3(A){return A=A|0,u[11120+((u[A>>2]|0)*216|0)+((u[A+4>>2]|0)*72|0)+((u[A+8>>2]|0)*24|0)+(u[A+12>>2]<<3)+4>>2]|0}function o3(A,c){A=A|0,c=c|0,A=7696+(A*28|0)|0,u[c>>2]=u[A>>2],u[c+4>>2]=u[A+4>>2],u[c+8>>2]=u[A+8>>2],u[c+12>>2]=u[A+12>>2]}function a3(A,c){A=A|0,c=c|0;var h=0,d=0;if(c>>>0>20)return c=-1,c|0;do if((u[11120+(c*216|0)>>2]|0)!=(A|0))if((u[11120+(c*216|0)+8>>2]|0)!=(A|0))if((u[11120+(c*216|0)+16>>2]|0)!=(A|0))if((u[11120+(c*216|0)+24>>2]|0)!=(A|0))if((u[11120+(c*216|0)+32>>2]|0)!=(A|0))if((u[11120+(c*216|0)+40>>2]|0)!=(A|0))if((u[11120+(c*216|0)+48>>2]|0)!=(A|0))if((u[11120+(c*216|0)+56>>2]|0)!=(A|0))if((u[11120+(c*216|0)+64>>2]|0)!=(A|0))if((u[11120+(c*216|0)+72>>2]|0)!=(A|0))if((u[11120+(c*216|0)+80>>2]|0)!=(A|0))if((u[11120+(c*216|0)+88>>2]|0)!=(A|0))if((u[11120+(c*216|0)+96>>2]|0)!=(A|0))if((u[11120+(c*216|0)+104>>2]|0)!=(A|0))if((u[11120+(c*216|0)+112>>2]|0)!=(A|0))if((u[11120+(c*216|0)+120>>2]|0)!=(A|0))if((u[11120+(c*216|0)+128>>2]|0)!=(A|0))if((u[11120+(c*216|0)+136>>2]|0)==(A|0))A=2,h=1,d=2;else{if((u[11120+(c*216|0)+144>>2]|0)==(A|0)){A=0,h=2,d=0;break}if((u[11120+(c*216|0)+152>>2]|0)==(A|0)){A=0,h=2,d=1;break}if((u[11120+(c*216|0)+160>>2]|0)==(A|0)){A=0,h=2,d=2;break}if((u[11120+(c*216|0)+168>>2]|0)==(A|0)){A=1,h=2,d=0;break}if((u[11120+(c*216|0)+176>>2]|0)==(A|0)){A=1,h=2,d=1;break}if((u[11120+(c*216|0)+184>>2]|0)==(A|0)){A=1,h=2,d=2;break}if((u[11120+(c*216|0)+192>>2]|0)==(A|0)){A=2,h=2,d=0;break}if((u[11120+(c*216|0)+200>>2]|0)==(A|0)){A=2,h=2,d=1;break}if((u[11120+(c*216|0)+208>>2]|0)==(A|0)){A=2,h=2,d=2;break}else A=-1;return A|0}else A=2,h=1,d=1;else A=2,h=1,d=0;else A=1,h=1,d=2;else A=1,h=1,d=1;else A=1,h=1,d=0;else A=0,h=1,d=2;else A=0,h=1,d=1;else A=0,h=1,d=0;else A=2,h=0,d=2;else A=2,h=0,d=1;else A=2,h=0,d=0;else A=1,h=0,d=2;else A=1,h=0,d=1;else A=1,h=0,d=0;else A=0,h=0,d=2;else A=0,h=0,d=1;else A=0,h=0,d=0;while(!1);return c=u[11120+(c*216|0)+(h*72|0)+(A*24|0)+(d<<3)+4>>2]|0,c|0}function f0(A,c){return A=A|0,c=c|0,(u[7696+(A*28|0)+20>>2]|0)==(c|0)?(c=1,c|0):(c=(u[7696+(A*28|0)+24>>2]|0)==(c|0),c|0)}function IA(A,c){return A=A|0,c=c|0,u[848+(A*28|0)+(c<<2)>>2]|0}function RA(A,c){return A=A|0,c=c|0,(u[848+(A*28|0)>>2]|0)==(c|0)?(c=0,c|0):(u[848+(A*28|0)+4>>2]|0)==(c|0)?(c=1,c|0):(u[848+(A*28|0)+8>>2]|0)==(c|0)?(c=2,c|0):(u[848+(A*28|0)+12>>2]|0)==(c|0)?(c=3,c|0):(u[848+(A*28|0)+16>>2]|0)==(c|0)?(c=4,c|0):(u[848+(A*28|0)+20>>2]|0)==(c|0)?(c=5,c|0):((u[848+(A*28|0)+24>>2]|0)==(c|0)?6:7)|0}function l3(){return 122}function c3(A){A=A|0;var c=0,h=0,d=0;c=0;do xe(c|0,0,45)|0,d=N()|0|134225919,h=A+(c<<3)|0,u[h>>2]=-1,u[h+4>>2]=d,c=c+1|0;while((c|0)!=122);return 0}function d0(A){return A=A|0,+B[A+16>>3]<+B[A+24>>3]|0}function g0(A,c){A=A|0,c=c|0;var h=0,d=0,p=0;return h=+B[c>>3],!(h>=+B[A+8>>3])||!(h<=+B[A>>3])?(c=0,c|0):(d=+B[A+16>>3],h=+B[A+24>>3],p=+B[c+8>>3],c=p>=h,A=p<=d&1,d<h?c&&(A=1):c||(A=0),c=(A|0)!=0,c|0)}function p0(A,c,h){A=A|0,c=c|0,h=h|0;var d=0,p=0,m=0,y=0,b=0,w=0,E=0,I=0,O=0,H=0,G=0,V=0,K=0,ue=0;V=M,M=M+288|0,I=V+264|0,O=V+96|0,E=V,b=E,w=b+96|0;do u[b>>2]=0,b=b+4|0;while((b|0)<(w|0));return c=UA(c,E)|0,c|0?(G=c,M=V,G|0):(w=E,E=u[w>>2]|0,w=u[w+4>>2]|0,po(E,w,I)|0,mo(E,w,O)|0,y=+yo(I,O+8|0),B[I>>3]=+B[A>>3],w=I+8|0,B[w>>3]=+B[A+16>>3],B[O>>3]=+B[A+8>>3],E=O+8|0,B[E>>3]=+B[A+24>>3],p=+yo(I,O),ue=+B[w>>3]-+B[E>>3],m=+it(+ue),K=+B[I>>3]-+B[O>>3],d=+it(+K),!(ue==0|K==0)&&(ue=+j0(+m,+d),ue=+tr(+(p*p/+GA(+(ue/+GA(+m,+d)),3)/(y*(y*2.59807621135)*.8))),B[at>>3]=ue,H=~~ue>>>0,G=+it(ue)>=1?ue>0?~~+xA(+en(ue/4294967296),4294967295)>>>0:~~+tr((ue-+(~~ue>>>0))/4294967296)>>>0:0,(u[at+4>>2]&2146435072|0)!=2146435072)?(O=(H|0)==0&(G|0)==0,c=h,u[c>>2]=O?1:H,u[c+4>>2]=O?0:G,c=0):c=1,G=c,M=V,G|0)}function A3(A,c,h,d){A=A|0,c=c|0,h=h|0,d=d|0;var p=0,m=0,y=0,b=0,w=0,E=0,I=0;E=M,M=M+288|0,y=E+264|0,b=E+96|0,w=E,p=w,m=p+96|0;do u[p>>2]=0,p=p+4|0;while((p|0)<(m|0));return h=UA(h,w)|0,h|0?(d=h,M=E,d|0):(h=w,p=u[h>>2]|0,h=u[h+4>>2]|0,po(p,h,y)|0,mo(p,h,b)|0,I=+yo(y,b+8|0),I=+tr(+(+yo(A,c)/(I*2))),B[at>>3]=I,h=~~I>>>0,p=+it(I)>=1?I>0?~~+xA(+en(I/4294967296),4294967295)>>>0:~~+tr((I-+(~~I>>>0))/4294967296)>>>0:0,(u[at+4>>2]&2146435072|0)==2146435072?(d=1,M=E,d|0):(w=(h|0)==0&(p|0)==0,u[d>>2]=w?1:h,u[d+4>>2]=w?0:p,d=0,M=E,d|0))}function u3(A,c,h,d){A=A|0,c=c|0,h=h|0,d=d|0,u[A>>2]=c,u[A+4>>2]=h,u[A+8>>2]=d}function h3(A,c){A=A|0,c=c|0;var h=0,d=0,p=0,m=0,y=0,b=0,w=0,E=0,I=0,O=0,H=0;O=c+8|0,u[O>>2]=0,w=+B[A>>3],y=+it(+w),E=+B[A+8>>3],b=+it(+E)/.8660254037844386,y=y+b*.5,h=~~y,A=~~b,y=y-+(h|0),b=b-+(A|0);do if(y<.5)if(y<.3333333333333333)if(u[c>>2]=h,b<(y+1)*.5){u[c+4>>2]=A;break}else{A=A+1|0,u[c+4>>2]=A;break}else if(H=1-y,A=(!(b<H)&1)+A|0,u[c+4>>2]=A,H<=b&b<y*2){h=h+1|0,u[c>>2]=h;break}else{u[c>>2]=h;break}else{if(!(y<.6666666666666666))if(h=h+1|0,u[c>>2]=h,b<y*.5){u[c+4>>2]=A;break}else{A=A+1|0,u[c+4>>2]=A;break}if(b<1-y){if(u[c+4>>2]=A,y*2+-1<b){u[c>>2]=h;break}}else A=A+1|0,u[c+4>>2]=A;h=h+1|0,u[c>>2]=h}while(!1);do if(w<0)if(A&1){I=(A+1|0)/2|0,I=dn(h|0,((h|0)<0)<<31>>31|0,I|0,((I|0)<0)<<31>>31|0)|0,h=~~(+(h|0)-((+(I>>>0)+4294967296*+(N()|0))*2+1)),u[c>>2]=h;break}else{I=(A|0)/2|0,I=dn(h|0,((h|0)<0)<<31>>31|0,I|0,((I|0)<0)<<31>>31|0)|0,h=~~(+(h|0)-(+(I>>>0)+4294967296*+(N()|0))*2),u[c>>2]=h;break}while(!1);I=c+4|0,E<0&&(h=h-((A<<1|1|0)/2|0)|0,u[c>>2]=h,A=0-A|0,u[I>>2]=A),d=A-h|0,(h|0)<0?(p=0-h|0,u[I>>2]=d,u[O>>2]=p,u[c>>2]=0,A=d,h=0):p=0,(A|0)<0&&(h=h-A|0,u[c>>2]=h,p=p-A|0,u[O>>2]=p,u[I>>2]=0,A=0),m=h-p|0,d=A-p|0,(p|0)<0&&(u[c>>2]=m,u[I>>2]=d,u[O>>2]=0,A=d,h=m,p=0),d=(A|0)<(h|0)?A:h,d=(p|0)<(d|0)?p:d,!((d|0)<=0)&&(u[c>>2]=h-d,u[I>>2]=A-d,u[O>>2]=p-d)}function fn(A){A=A|0;var c=0,h=0,d=0,p=0,m=0,y=0;c=u[A>>2]|0,y=A+4|0,h=u[y>>2]|0,(c|0)<0&&(h=h-c|0,u[y>>2]=h,m=A+8|0,u[m>>2]=(u[m>>2]|0)-c,u[A>>2]=0,c=0),(h|0)<0?(c=c-h|0,u[A>>2]=c,m=A+8|0,p=(u[m>>2]|0)-h|0,u[m>>2]=p,u[y>>2]=0,h=0):(p=A+8|0,m=p,p=u[p>>2]|0),(p|0)<0&&(c=c-p|0,u[A>>2]=c,h=h-p|0,u[y>>2]=h,u[m>>2]=0,p=0),d=(h|0)<(c|0)?h:c,d=(p|0)<(d|0)?p:d,!((d|0)<=0)&&(u[A>>2]=c-d,u[y>>2]=h-d,u[m>>2]=p-d)}function ys(A,c){A=A|0,c=c|0;var h=0,d=0;d=u[A+8>>2]|0,h=+((u[A+4>>2]|0)-d|0),B[c>>3]=+((u[A>>2]|0)-d|0)-h*.5,B[c+8>>3]=h*.8660254037844386}function En(A,c,h){A=A|0,c=c|0,h=h|0,u[h>>2]=(u[c>>2]|0)+(u[A>>2]|0),u[h+4>>2]=(u[c+4>>2]|0)+(u[A+4>>2]|0),u[h+8>>2]=(u[c+8>>2]|0)+(u[A+8>>2]|0)}function PA(A,c,h){A=A|0,c=c|0,h=h|0,u[h>>2]=(u[A>>2]|0)-(u[c>>2]|0),u[h+4>>2]=(u[A+4>>2]|0)-(u[c+4>>2]|0),u[h+8>>2]=(u[A+8>>2]|0)-(u[c+8>>2]|0)}function m0(A,c){A=A|0,c=c|0;var h=0,d=0;h=pi(u[A>>2]|0,c)|0,u[A>>2]=h,h=A+4|0,d=pi(u[h>>2]|0,c)|0,u[h>>2]=d,A=A+8|0,c=pi(u[A>>2]|0,c)|0,u[A>>2]=c}function xa(A){A=A|0;var c=0,h=0,d=0,p=0,m=0,y=0,b=0;y=u[A>>2]|0,b=(y|0)<0,d=(u[A+4>>2]|0)-(b?y:0)|0,m=(d|0)<0,p=(m?0-d|0:0)+((u[A+8>>2]|0)-(b?y:0))|0,h=(p|0)<0,A=h?0:p,c=(m?0:d)-(h?p:0)|0,p=(b?0:y)-(m?d:0)-(h?p:0)|0,h=(c|0)<(p|0)?c:p,h=(A|0)<(h|0)?A:h,d=(h|0)>0,A=A-(d?h:0)|0,c=c-(d?h:0)|0;e:do switch(p-(d?h:0)|0){case 0:switch(c|0){case 0:return b=(A|0)==0?0:(A|0)==1?1:7,b|0;case 1:return b=(A|0)==0?2:(A|0)==1?3:7,b|0;default:break e}case 1:switch(c|0){case 0:return b=(A|0)==0?4:(A|0)==1?5:7,b|0;case 1:{if(!A)A=6;else break e;return A|0}default:break e}}while(!1);return b=7,b|0}function f3(A){A=A|0;var c=0,h=0,d=0,p=0,m=0,y=0,b=0;y=A+8|0,p=u[y>>2]|0,m=(u[A>>2]|0)-p|0,b=A+4|0,p=(u[b>>2]|0)-p|0;do if(m>>>0>715827881|p>>>0>715827881){if(h=(m|0)>0,h){if((2147483647-m|0)<(m|0)||(2147483647-(m<<1)|0)<(m|0))return b=1,b|0}else if((-2147483648-m|0)>(m|0)||(-2147483648-(m<<1)|0)>(m|0))return b=1,b|0;if(c=m*3|0,(p|0)>0){if((2147483647-p|0)<(p|0))return b=1,b|0}else if((-2147483648-p|0)>(p|0))return b=1,b|0;if(d=p<<1,(m|0)>-1){if((c|-2147483648|0)>=(p|0))return b=1,b|0}else if((c^-2147483648|0)<(p|0))return b=1,b|0;if(h){if((2147483647-m|0)<(d|0))c=1;else{h=d;break}return c|0}else{if((-2147483648-m|0)>(d|0))c=1;else{h=d;break}return c|0}}else h=p<<1,c=m*3|0;while(!1);d=Wi(+(c-p|0)/7)|0,u[A>>2]=d,p=Wi(+(h+m|0)/7)|0,u[b>>2]=p,u[y>>2]=0,h=(p|0)<(d|0),c=h?d:p,h=h?p:d;do if((h|0)<0){if((c|0)>0){if((c|-2147483648|0)<(h|0)&((h|0)!=-2147483648&(2147483647-c|0)>=(h|0)))break;ke(23313,22444,355,22455)}if((h|0)==-2147483648|(-2147483648-c|0)>(h|0)&&ke(23313,22444,355,22455),(c|0)>-1){if((c|-2147483648|0)<(h|0))break;ke(23313,22444,355,22455)}else{if((c^-2147483648|0)>=(h|0))break;ke(23313,22444,355,22455)}}while(!1);return c=p-d|0,(d|0)<0?(h=0-d|0,u[b>>2]=c,u[y>>2]=h,u[A>>2]=0,d=0):(c=p,h=0),(c|0)<0&&(d=d-c|0,u[A>>2]=d,h=h-c|0,u[y>>2]=h,u[b>>2]=0,c=0),m=d-h|0,p=c-h|0,(h|0)<0?(u[A>>2]=m,u[b>>2]=p,u[y>>2]=0,c=p,p=m,h=0):p=d,d=(c|0)<(p|0)?c:p,d=(h|0)<(d|0)?h:d,(d|0)<=0?(b=0,b|0):(u[A>>2]=p-d,u[b>>2]=c-d,u[y>>2]=h-d,b=0,b|0)}function d3(A){A=A|0;var c=0,h=0,d=0,p=0,m=0,y=0,b=0;y=A+8|0,p=u[y>>2]|0,m=(u[A>>2]|0)-p|0,b=A+4|0,p=(u[b>>2]|0)-p|0;do if(m>>>0>715827881|p>>>0>715827881){if(h=(m|0)>0,h){if((2147483647-m|0)<(m|0))return b=1,b|0}else if((-2147483648-m|0)>(m|0))return b=1,b|0;if(c=m<<1,(p|0)>0){if((2147483647-p|0)<(p|0)||(2147483647-(p<<1)|0)<(p|0))return b=1,b|0}else if((-2147483648-p|0)>(p|0)||(-2147483648-(p<<1)|0)>(p|0))return b=1,b|0;if(d=p*3|0,h){if((2147483647-c|0)<(p|0))return b=1,b|0}else if((-2147483648-c|0)>(p|0))return b=1,b|0;if((p|0)>-1){if((d|-2147483648|0)<(m|0)){h=d;break}else c=1;return c|0}else{if((d^-2147483648|0)<(m|0))c=1;else{h=d;break}return c|0}}else h=p*3|0,c=m<<1;while(!1);d=Wi(+(c+p|0)/7)|0,u[A>>2]=d,p=Wi(+(h-m|0)/7)|0,u[b>>2]=p,u[y>>2]=0,h=(p|0)<(d|0),c=h?d:p,h=h?p:d;do if((h|0)<0){if((c|0)>0){if((c|-2147483648|0)<(h|0)&((h|0)!=-2147483648&(2147483647-c|0)>=(h|0)))break;ke(23313,22444,404,22469)}if((h|0)==-2147483648|(-2147483648-c|0)>(h|0)&&ke(23313,22444,404,22469),(c|0)>-1){if((c|-2147483648|0)<(h|0))break;ke(23313,22444,404,22469)}else{if((c^-2147483648|0)>=(h|0))break;ke(23313,22444,404,22469)}}while(!1);return c=p-d|0,(d|0)<0?(h=0-d|0,u[b>>2]=c,u[y>>2]=h,u[A>>2]=0,d=0):(c=p,h=0),(c|0)<0&&(d=d-c|0,u[A>>2]=d,h=h-c|0,u[y>>2]=h,u[b>>2]=0,c=0),m=d-h|0,p=c-h|0,(h|0)<0?(u[A>>2]=m,u[b>>2]=p,u[y>>2]=0,c=p,p=m,h=0):p=d,d=(c|0)<(p|0)?c:p,d=(h|0)<(d|0)?h:d,(d|0)<=0?(b=0,b|0):(u[A>>2]=p-d,u[b>>2]=c-d,u[y>>2]=h-d,b=0,b|0)}function g3(A){A=A|0;var c=0,h=0,d=0,p=0,m=0,y=0,b=0;y=A+8|0,h=u[y>>2]|0,c=(u[A>>2]|0)-h|0,b=A+4|0,h=(u[b>>2]|0)-h|0,d=Wi(+((c*3|0)-h|0)/7)|0,u[A>>2]=d,c=Wi(+((h<<1)+c|0)/7)|0,u[b>>2]=c,u[y>>2]=0,h=c-d|0,(d|0)<0?(m=0-d|0,u[b>>2]=h,u[y>>2]=m,u[A>>2]=0,c=h,d=0,h=m):h=0,(c|0)<0&&(d=d-c|0,u[A>>2]=d,h=h-c|0,u[y>>2]=h,u[b>>2]=0,c=0),m=d-h|0,p=c-h|0,(h|0)<0?(u[A>>2]=m,u[b>>2]=p,u[y>>2]=0,c=p,p=m,h=0):p=d,d=(c|0)<(p|0)?c:p,d=(h|0)<(d|0)?h:d,!((d|0)<=0)&&(u[A>>2]=p-d,u[b>>2]=c-d,u[y>>2]=h-d)}function _0(A){A=A|0;var c=0,h=0,d=0,p=0,m=0,y=0,b=0;y=A+8|0,h=u[y>>2]|0,c=(u[A>>2]|0)-h|0,b=A+4|0,h=(u[b>>2]|0)-h|0,d=Wi(+((c<<1)+h|0)/7)|0,u[A>>2]=d,c=Wi(+((h*3|0)-c|0)/7)|0,u[b>>2]=c,u[y>>2]=0,h=c-d|0,(d|0)<0?(m=0-d|0,u[b>>2]=h,u[y>>2]=m,u[A>>2]=0,c=h,d=0,h=m):h=0,(c|0)<0&&(d=d-c|0,u[A>>2]=d,h=h-c|0,u[y>>2]=h,u[b>>2]=0,c=0),m=d-h|0,p=c-h|0,(h|0)<0?(u[A>>2]=m,u[b>>2]=p,u[y>>2]=0,c=p,p=m,h=0):p=d,d=(c|0)<(p|0)?c:p,d=(h|0)<(d|0)?h:d,!((d|0)<=0)&&(u[A>>2]=p-d,u[b>>2]=c-d,u[y>>2]=h-d)}function Ca(A){A=A|0;var c=0,h=0,d=0,p=0,m=0,y=0,b=0;c=u[A>>2]|0,y=A+4|0,h=u[y>>2]|0,b=A+8|0,d=u[b>>2]|0,p=h+(c*3|0)|0,u[A>>2]=p,h=d+(h*3|0)|0,u[y>>2]=h,c=(d*3|0)+c|0,u[b>>2]=c,d=h-p|0,(p|0)<0?(c=c-p|0,u[y>>2]=d,u[b>>2]=c,u[A>>2]=0,h=d,d=0):d=p,(h|0)<0&&(d=d-h|0,u[A>>2]=d,c=c-h|0,u[b>>2]=c,u[y>>2]=0,h=0),m=d-c|0,p=h-c|0,(c|0)<0?(u[A>>2]=m,u[y>>2]=p,u[b>>2]=0,d=m,c=0):p=h,h=(p|0)<(d|0)?p:d,h=(c|0)<(h|0)?c:h,!((h|0)<=0)&&(u[A>>2]=d-h,u[y>>2]=p-h,u[b>>2]=c-h)}function bs(A){A=A|0;var c=0,h=0,d=0,p=0,m=0,y=0,b=0;p=u[A>>2]|0,y=A+4|0,c=u[y>>2]|0,b=A+8|0,h=u[b>>2]|0,d=(c*3|0)+p|0,p=h+(p*3|0)|0,u[A>>2]=p,u[y>>2]=d,c=(h*3|0)+c|0,u[b>>2]=c,h=d-p|0,(p|0)<0?(c=c-p|0,u[y>>2]=h,u[b>>2]=c,u[A>>2]=0,p=0):h=d,(h|0)<0&&(p=p-h|0,u[A>>2]=p,c=c-h|0,u[b>>2]=c,u[y>>2]=0,h=0),m=p-c|0,d=h-c|0,(c|0)<0?(u[A>>2]=m,u[y>>2]=d,u[b>>2]=0,p=m,c=0):d=h,h=(d|0)<(p|0)?d:p,h=(c|0)<(h|0)?c:h,!((h|0)<=0)&&(u[A>>2]=p-h,u[y>>2]=d-h,u[b>>2]=c-h)}function y0(A,c){A=A|0,c=c|0;var h=0,d=0,p=0,m=0,y=0,b=0;(c+-1|0)>>>0>=6||(p=(u[15440+(c*12|0)>>2]|0)+(u[A>>2]|0)|0,u[A>>2]=p,b=A+4|0,d=(u[15440+(c*12|0)+4>>2]|0)+(u[b>>2]|0)|0,u[b>>2]=d,y=A+8|0,c=(u[15440+(c*12|0)+8>>2]|0)+(u[y>>2]|0)|0,u[y>>2]=c,h=d-p|0,(p|0)<0?(c=c-p|0,u[b>>2]=h,u[y>>2]=c,u[A>>2]=0,d=0):(h=d,d=p),(h|0)<0&&(d=d-h|0,u[A>>2]=d,c=c-h|0,u[y>>2]=c,u[b>>2]=0,h=0),m=d-c|0,p=h-c|0,(c|0)<0?(u[A>>2]=m,u[b>>2]=p,u[y>>2]=0,d=m,c=0):p=h,h=(p|0)<(d|0)?p:d,h=(c|0)<(h|0)?c:h,!((h|0)<=0)&&(u[A>>2]=d-h,u[b>>2]=p-h,u[y>>2]=c-h))}function b0(A){A=A|0;var c=0,h=0,d=0,p=0,m=0,y=0,b=0;p=u[A>>2]|0,y=A+4|0,c=u[y>>2]|0,b=A+8|0,h=u[b>>2]|0,d=c+p|0,p=h+p|0,u[A>>2]=p,u[y>>2]=d,c=h+c|0,u[b>>2]=c,h=d-p|0,(p|0)<0?(c=c-p|0,u[y>>2]=h,u[b>>2]=c,u[A>>2]=0,d=0):(h=d,d=p),(h|0)<0&&(d=d-h|0,u[A>>2]=d,c=c-h|0,u[b>>2]=c,u[y>>2]=0,h=0),m=d-c|0,p=h-c|0,(c|0)<0?(u[A>>2]=m,u[y>>2]=p,u[b>>2]=0,d=m,c=0):p=h,h=(p|0)<(d|0)?p:d,h=(c|0)<(h|0)?c:h,!((h|0)<=0)&&(u[A>>2]=d-h,u[y>>2]=p-h,u[b>>2]=c-h)}function Sa(A){A=A|0;var c=0,h=0,d=0,p=0,m=0,y=0,b=0;c=u[A>>2]|0,y=A+4|0,d=u[y>>2]|0,b=A+8|0,h=u[b>>2]|0,p=d+c|0,u[A>>2]=p,d=h+d|0,u[y>>2]=d,c=h+c|0,u[b>>2]=c,h=d-p|0,(p|0)<0?(c=c-p|0,u[y>>2]=h,u[b>>2]=c,u[A>>2]=0,d=0):(h=d,d=p),(h|0)<0&&(d=d-h|0,u[A>>2]=d,c=c-h|0,u[b>>2]=c,u[y>>2]=0,h=0),m=d-c|0,p=h-c|0,(c|0)<0?(u[A>>2]=m,u[y>>2]=p,u[b>>2]=0,d=m,c=0):p=h,h=(p|0)<(d|0)?p:d,h=(c|0)<(h|0)?c:h,!((h|0)<=0)&&(u[A>>2]=d-h,u[y>>2]=p-h,u[b>>2]=c-h)}function vs(A){switch(A=A|0,A|0){case 1:{A=5;break}case 5:{A=4;break}case 4:{A=6;break}case 6:{A=2;break}case 2:{A=3;break}case 3:{A=1;break}}return A|0}function Hi(A){switch(A=A|0,A|0){case 1:{A=3;break}case 3:{A=2;break}case 2:{A=6;break}case 6:{A=4;break}case 4:{A=5;break}case 5:{A=1;break}}return A|0}function v0(A){A=A|0;var c=0,h=0,d=0,p=0,m=0,y=0,b=0;c=u[A>>2]|0,y=A+4|0,h=u[y>>2]|0,b=A+8|0,d=u[b>>2]|0,p=h+(c<<1)|0,u[A>>2]=p,h=d+(h<<1)|0,u[y>>2]=h,c=(d<<1)+c|0,u[b>>2]=c,d=h-p|0,(p|0)<0?(c=c-p|0,u[y>>2]=d,u[b>>2]=c,u[A>>2]=0,h=d,d=0):d=p,(h|0)<0&&(d=d-h|0,u[A>>2]=d,c=c-h|0,u[b>>2]=c,u[y>>2]=0,h=0),m=d-c|0,p=h-c|0,(c|0)<0?(u[A>>2]=m,u[y>>2]=p,u[b>>2]=0,d=m,c=0):p=h,h=(p|0)<(d|0)?p:d,h=(c|0)<(h|0)?c:h,!((h|0)<=0)&&(u[A>>2]=d-h,u[y>>2]=p-h,u[b>>2]=c-h)}function T0(A){A=A|0;var c=0,h=0,d=0,p=0,m=0,y=0,b=0;p=u[A>>2]|0,y=A+4|0,c=u[y>>2]|0,b=A+8|0,h=u[b>>2]|0,d=(c<<1)+p|0,p=h+(p<<1)|0,u[A>>2]=p,u[y>>2]=d,c=(h<<1)+c|0,u[b>>2]=c,h=d-p|0,(p|0)<0?(c=c-p|0,u[y>>2]=h,u[b>>2]=c,u[A>>2]=0,p=0):h=d,(h|0)<0&&(p=p-h|0,u[A>>2]=p,c=c-h|0,u[b>>2]=c,u[y>>2]=0,h=0),m=p-c|0,d=h-c|0,(c|0)<0?(u[A>>2]=m,u[y>>2]=d,u[b>>2]=0,p=m,c=0):d=h,h=(d|0)<(p|0)?d:p,h=(c|0)<(h|0)?c:h,!((h|0)<=0)&&(u[A>>2]=p-h,u[y>>2]=d-h,u[b>>2]=c-h)}function MA(A,c){A=A|0,c=c|0;var h=0,d=0,p=0,m=0,y=0,b=0;return y=(u[A>>2]|0)-(u[c>>2]|0)|0,b=(y|0)<0,d=(u[A+4>>2]|0)-(u[c+4>>2]|0)-(b?y:0)|0,m=(d|0)<0,p=(b?0-y|0:0)+(u[A+8>>2]|0)-(u[c+8>>2]|0)+(m?0-d|0:0)|0,A=(p|0)<0,c=A?0:p,h=(m?0:d)-(A?p:0)|0,p=(b?0:y)-(m?d:0)-(A?p:0)|0,A=(h|0)<(p|0)?h:p,A=(c|0)<(A|0)?c:A,d=(A|0)>0,c=c-(d?A:0)|0,h=h-(d?A:0)|0,A=p-(d?A:0)|0,A=(A|0)>-1?A:0-A|0,h=(h|0)>-1?h:0-h|0,c=(c|0)>-1?c:0-c|0,c=(h|0)>(c|0)?h:c,((A|0)>(c|0)?A:c)|0}function p3(A,c){A=A|0,c=c|0;var h=0;h=u[A+8>>2]|0,u[c>>2]=(u[A>>2]|0)-h,u[c+4>>2]=(u[A+4>>2]|0)-h}function m3(A,c){A=A|0,c=c|0;var h=0,d=0,p=0,m=0,y=0,b=0;d=u[A>>2]|0,u[c>>2]=d,p=u[A+4>>2]|0,y=c+4|0,u[y>>2]=p,b=c+8|0,u[b>>2]=0,h=(p|0)<(d|0),A=h?d:p,h=h?p:d;do if((h|0)<0){if((A|0)>0){if((A|-2147483648|0)<(h|0)&((h|0)!=-2147483648&(2147483647-A|0)>=(h|0)))break;return A=1,A|0}if((h|0)==-2147483648|(-2147483648-A|0)>(h|0))return c=1,c|0;if((A|0)>-1){if((A|-2147483648|0)<(h|0))break;return A=1,A|0}else{if((A^-2147483648|0)<(h|0))A=1;else break;return A|0}}while(!1);return A=p-d|0,(d|0)<0?(h=0-d|0,u[y>>2]=A,u[b>>2]=h,u[c>>2]=0,d=0):(A=p,h=0),(A|0)<0&&(d=d-A|0,u[c>>2]=d,h=h-A|0,u[b>>2]=h,u[y>>2]=0,A=0),m=d-h|0,p=A-h|0,(h|0)<0?(u[c>>2]=m,u[y>>2]=p,u[b>>2]=0,A=p,p=m,h=0):p=d,d=(A|0)<(p|0)?A:p,d=(h|0)<(d|0)?h:d,(d|0)<=0?(c=0,c|0):(u[c>>2]=p-d,u[y>>2]=A-d,u[b>>2]=h-d,c=0,c|0)}function w0(A){A=A|0;var c=0,h=0,d=0,p=0;c=A+8|0,p=u[c>>2]|0,h=p-(u[A>>2]|0)|0,u[A>>2]=h,d=A+4|0,A=(u[d>>2]|0)-p|0,u[d>>2]=A,u[c>>2]=0-(A+h)}function _3(A){A=A|0;var c=0,h=0,d=0,p=0,m=0,y=0,b=0;h=u[A>>2]|0,c=0-h|0,u[A>>2]=c,y=A+8|0,u[y>>2]=0,b=A+4|0,d=u[b>>2]|0,p=d+h|0,(h|0)>0?(u[b>>2]=p,u[y>>2]=h,u[A>>2]=0,c=0,d=p):h=0,(d|0)<0?(m=c-d|0,u[A>>2]=m,h=h-d|0,u[y>>2]=h,u[b>>2]=0,p=m-h|0,c=0-h|0,(h|0)<0?(u[A>>2]=p,u[b>>2]=c,u[y>>2]=0,d=c,h=0):(d=0,p=m)):p=c,c=(d|0)<(p|0)?d:p,c=(h|0)<(c|0)?h:c,!((c|0)<=0)&&(u[A>>2]=p-c,u[b>>2]=d-c,u[y>>2]=h-c)}function y3(A,c,h,d,p){A=A|0,c=c|0,h=h|0,d=d|0,p=p|0;var m=0,y=0,b=0,w=0,E=0,I=0,O=0;if(O=M,M=M+64|0,I=O,b=O+56|0,!(!0&(c&2013265920|0)==134217728&(!0&(d&2013265920|0)==134217728)))return p=5,M=O,p|0;if((A|0)==(h|0)&(c|0)==(d|0))return u[p>>2]=0,p=0,M=O,p|0;if(y=_e(A|0,c|0,52)|0,N()|0,y=y&15,E=_e(h|0,d|0,52)|0,N()|0,(y|0)!=(E&15|0))return p=12,M=O,p|0;if(m=y+-1|0,y>>>0>1){NA(A,c,m,I)|0,NA(h,d,m,b)|0,E=I,w=u[E>>2]|0,E=u[E+4>>2]|0;e:do if((w|0)==(u[b>>2]|0)&&(E|0)==(u[b+4>>2]|0)){y=(y^15)*3|0,m=_e(A|0,c|0,y|0)|0,N()|0,m=m&7,y=_e(h|0,d|0,y|0)|0,N()|0,y=y&7;do if((m|0)==0|(y|0)==0)u[p>>2]=1,m=0;else if((m|0)==7)m=5;else{if((m|0)==1|(y|0)==1&&Ot(w,E)|0){m=5;break}if((u[15536+(m<<2)>>2]|0)!=(y|0)&&(u[15568+(m<<2)>>2]|0)!=(y|0))break e;u[p>>2]=1,m=0}while(!1);return p=m,M=O,p|0}while(!1)}m=I,y=m+56|0;do u[m>>2]=0,m=m+4|0;while((m|0)<(y|0));return l0(A,c,1,I)|0,c=I,!((u[c>>2]|0)==(h|0)&&(u[c+4>>2]|0)==(d|0))&&(c=I+8|0,!((u[c>>2]|0)==(h|0)&&(u[c+4>>2]|0)==(d|0)))&&(c=I+16|0,!((u[c>>2]|0)==(h|0)&&(u[c+4>>2]|0)==(d|0)))&&(c=I+24|0,!((u[c>>2]|0)==(h|0)&&(u[c+4>>2]|0)==(d|0)))&&(c=I+32|0,!((u[c>>2]|0)==(h|0)&&(u[c+4>>2]|0)==(d|0)))&&(c=I+40|0,!((u[c>>2]|0)==(h|0)&&(u[c+4>>2]|0)==(d|0)))?(m=I+48|0,m=((u[m>>2]|0)==(h|0)?(u[m+4>>2]|0)==(d|0):0)&1):m=1,u[p>>2]=m,p=0,M=O,p|0}function b3(A,c,h,d,p){return A=A|0,c=c|0,h=h|0,d=d|0,p=p|0,h=CA(A,c,h,d)|0,(h|0)==7?(p=11,p|0):(d=xe(h|0,0,56)|0,c=c&-2130706433|(N()|0)|268435456,u[p>>2]=A|d,u[p+4>>2]=c,p=0,p|0)}function v3(A,c,h){return A=A|0,c=c|0,h=h|0,!0&(c&2013265920|0)==268435456?(u[h>>2]=A,u[h+4>>2]=c&-2130706433|134217728,h=0,h|0):(h=6,h|0)}function T3(A,c,h){A=A|0,c=c|0,h=h|0;var d=0,p=0,m=0;return p=M,M=M+16|0,d=p,u[d>>2]=0,!0&(c&2013265920|0)==268435456?(m=_e(A|0,c|0,56)|0,N()|0,d=tn(A,c&-2130706433|134217728,m&7,d,h)|0,M=p,d|0):(d=6,M=p,d|0)}function w3(A,c){A=A|0,c=c|0;var h=0;switch(h=_e(A|0,c|0,56)|0,N()|0,h&7){case 0:case 7:return h=0,h|0}return h=c&-2130706433|134217728,!(!0&(c&2013265920|0)==268435456)||!0&(c&117440512|0)==16777216&(Ot(A,h)|0)!=0?(h=0,h|0):(h=DA(A,h)|0,h|0)}function E3(A,c,h){A=A|0,c=c|0,h=h|0;var d=0,p=0,m=0,y=0;return p=M,M=M+16|0,d=p,!0&(c&2013265920|0)==268435456?(m=c&-2130706433|134217728,y=h,u[y>>2]=A,u[y+4>>2]=m,u[d>>2]=0,c=_e(A|0,c|0,56)|0,N()|0,d=tn(A,m,c&7,d,h+8|0)|0,M=p,d|0):(d=6,M=p,d|0)}function x3(A,c,h){A=A|0,c=c|0,h=h|0;var d=0,p=0;return p=(Ot(A,c)|0)==0,c=c&-2130706433,d=h,u[d>>2]=p?A:0,u[d+4>>2]=p?c|285212672:0,d=h+8|0,u[d>>2]=A,u[d+4>>2]=c|301989888,d=h+16|0,u[d>>2]=A,u[d+4>>2]=c|318767104,d=h+24|0,u[d>>2]=A,u[d+4>>2]=c|335544320,d=h+32|0,u[d>>2]=A,u[d+4>>2]=c|352321536,h=h+40|0,u[h>>2]=A,u[h+4>>2]=c|369098752,0}function Ia(A,c,h){A=A|0,c=c|0,h=h|0;var d=0,p=0,m=0,y=0;return y=M,M=M+16|0,p=y,m=c&-2130706433|134217728,!0&(c&2013265920|0)==268435456?(d=_e(A|0,c|0,56)|0,N()|0,d=EE(A,m,d&7)|0,(d|0)==-1?(u[h>>2]=0,m=6,M=y,m|0):(ir(A,m,p)|0&&ke(23313,22484,282,22499),c=_e(A|0,c|0,52)|0,N()|0,c=c&15,Ot(A,m)|0?BA(p,c,d,2,h):OA(p,c,d,2,h),m=0,M=y,m|0)):(m=6,M=y,m|0)}function C3(A,c,h){A=A|0,c=c|0,h=h|0;var d=0,p=0;d=M,M=M+16|0,p=d,S3(A,c,h,p),h3(p,h+4|0),M=d}function S3(A,c,h,d){A=A|0,c=c|0,h=h|0,d=d|0;var p=0,m=0,y=0,b=0,w=0;if(b=M,M=M+16|0,w=b,I3(A,h,w),m=+Ea(+(1-+B[w>>3]*.5)),m<1e-16){u[d>>2]=0,u[d+4>>2]=0,u[d+8>>2]=0,u[d+12>>2]=0,M=b;return}if(w=u[h>>2]|0,p=+B[15920+(w*24|0)>>3],p=+_o(p-+_o(+X3(15600+(w<<4)|0,A))),Hn(c)|0?y=+_o(p+-.3334731722518321):y=p,p=+Vn(+m)/.381966011250105,(c|0)>0){A=0;do p=p*2.6457513110645907,A=A+1|0;while((A|0)!=(c|0))}m=+vt(+y)*p,B[d>>3]=m,y=+et(+y)*p,B[d+8>>3]=y,M=b}function I3(A,c,h){A=A|0,c=c|0,h=h|0;var d=0,p=0,m=0;if(m=M,M=M+32|0,p=m,wE(A,p),u[c>>2]=0,B[h>>3]=5,d=+jt(16400,p),d<+B[h>>3]&&(u[c>>2]=0,B[h>>3]=d),d=+jt(16424,p),d<+B[h>>3]&&(u[c>>2]=1,B[h>>3]=d),d=+jt(16448,p),d<+B[h>>3]&&(u[c>>2]=2,B[h>>3]=d),d=+jt(16472,p),d<+B[h>>3]&&(u[c>>2]=3,B[h>>3]=d),d=+jt(16496,p),d<+B[h>>3]&&(u[c>>2]=4,B[h>>3]=d),d=+jt(16520,p),d<+B[h>>3]&&(u[c>>2]=5,B[h>>3]=d),d=+jt(16544,p),d<+B[h>>3]&&(u[c>>2]=6,B[h>>3]=d),d=+jt(16568,p),d<+B[h>>3]&&(u[c>>2]=7,B[h>>3]=d),d=+jt(16592,p),d<+B[h>>3]&&(u[c>>2]=8,B[h>>3]=d),d=+jt(16616,p),d<+B[h>>3]&&(u[c>>2]=9,B[h>>3]=d),d=+jt(16640,p),d<+B[h>>3]&&(u[c>>2]=10,B[h>>3]=d),d=+jt(16664,p),d<+B[h>>3]&&(u[c>>2]=11,B[h>>3]=d),d=+jt(16688,p),d<+B[h>>3]&&(u[c>>2]=12,B[h>>3]=d),d=+jt(16712,p),d<+B[h>>3]&&(u[c>>2]=13,B[h>>3]=d),d=+jt(16736,p),d<+B[h>>3]&&(u[c>>2]=14,B[h>>3]=d),d=+jt(16760,p),d<+B[h>>3]&&(u[c>>2]=15,B[h>>3]=d),d=+jt(16784,p),d<+B[h>>3]&&(u[c>>2]=16,B[h>>3]=d),d=+jt(16808,p),d<+B[h>>3]&&(u[c>>2]=17,B[h>>3]=d),d=+jt(16832,p),d<+B[h>>3]&&(u[c>>2]=18,B[h>>3]=d),d=+jt(16856,p),!(d<+B[h>>3])){M=m;return}u[c>>2]=19,B[h>>3]=d,M=m}function go(A,c,h,d,p){A=A|0,c=c|0,h=h|0,d=d|0,p=p|0;var m=0,y=0;if(m=+TE(A),m<1e-16){c=15600+(c<<4)|0,u[p>>2]=u[c>>2],u[p+4>>2]=u[c+4>>2],u[p+8>>2]=u[c+8>>2],u[p+12>>2]=u[c+12>>2];return}if(y=+zn(+ +B[A+8>>3],+ +B[A>>3]),(h|0)>0){A=0;do m=m/2.6457513110645907,A=A+1|0;while((A|0)!=(h|0))}d?(m=m/3,h=(Hn(h)|0)==0,m=+EA(+((h?m:m/2.6457513110645907)*.381966011250105))):(m=+EA(+(m*.381966011250105)),Hn(h)|0&&(y=+_o(y+.3334731722518321))),Q3(15600+(c<<4)|0,+_o(+B[15920+(c*24|0)>>3]-y),m,p)}function R3(A,c,h){A=A|0,c=c|0,h=h|0;var d=0,p=0;d=M,M=M+16|0,p=d,ys(A+4|0,p),go(p,u[A>>2]|0,c,0,h),M=d}function BA(A,c,h,d,p){A=A|0,c=c|0,h=h|0,d=d|0,p=p|0;var m=0,y=0,b=0,w=0,E=0,I=0,O=0,H=0,G=0,V=0,K=0,ue=0,ce=0,ie=0,oe=0,Y=0,Re=0,De=0,Ee=0,Pe=0,mt=0,ot=0,ct=0,Ke=0,Ye=0,qe=0,Tt=0,$e=0;if(qe=M,M=M+272|0,m=qe+256|0,ie=qe+240|0,ct=qe,Ke=qe+224|0,Ye=qe+208|0,oe=qe+176|0,Y=qe+160|0,Re=qe+192|0,De=qe+144|0,Ee=qe+128|0,Pe=qe+112|0,mt=qe+96|0,ot=qe+80|0,u[m>>2]=c,u[ie>>2]=u[A>>2],u[ie+4>>2]=u[A+4>>2],u[ie+8>>2]=u[A+8>>2],u[ie+12>>2]=u[A+12>>2],E0(ie,m,ct),u[p>>2]=0,ie=d+h+((d|0)==5&1)|0,(ie|0)<=(h|0)){M=qe;return}w=u[m>>2]|0,E=Ke+4|0,I=oe+4|0,O=h+5|0,H=16880+(w<<2)|0,G=16960+(w<<2)|0,V=Ee+8|0,K=Pe+8|0,ue=mt+8|0,ce=Ye+4|0,b=h;e:for(;;){y=ct+(((b|0)%5|0)<<4)|0,u[Ye>>2]=u[y>>2],u[Ye+4>>2]=u[y+4>>2],u[Ye+8>>2]=u[y+8>>2],u[Ye+12>>2]=u[y+12>>2];do;while((nr(Ye,w,0,1)|0)==2);if((b|0)>(h|0)&(Hn(c)|0)!=0){if(u[oe>>2]=u[Ye>>2],u[oe+4>>2]=u[Ye+4>>2],u[oe+8>>2]=u[Ye+8>>2],u[oe+12>>2]=u[Ye+12>>2],ys(E,Y),d=u[oe>>2]|0,m=u[17040+(d*80|0)+(u[Ke>>2]<<2)>>2]|0,u[oe>>2]=u[18640+(d*80|0)+(m*20|0)>>2],y=u[18640+(d*80|0)+(m*20|0)+16>>2]|0,(y|0)>0){A=0;do b0(I),A=A+1|0;while((A|0)<(y|0))}switch(y=18640+(d*80|0)+(m*20|0)+4|0,u[Re>>2]=u[y>>2],u[Re+4>>2]=u[y+4>>2],u[Re+8>>2]=u[y+8>>2],m0(Re,(u[H>>2]|0)*3|0),En(I,Re,I),fn(I),ys(I,De),Tt=+(u[G>>2]|0),B[Ee>>3]=Tt*3,B[V>>3]=0,$e=Tt*-1.5,B[Pe>>3]=$e,B[K>>3]=Tt*2.598076211353316,B[mt>>3]=$e,B[ue>>3]=Tt*-2.598076211353316,u[17040+((u[oe>>2]|0)*80|0)+(u[Ye>>2]<<2)>>2]|0){case 1:{A=Pe,d=Ee;break}case 3:{A=mt,d=Pe;break}case 2:{A=Ee,d=mt;break}default:{A=12;break e}}L0(Y,De,d,A,ot),go(ot,u[oe>>2]|0,w,1,p+8+(u[p>>2]<<4)|0),u[p>>2]=(u[p>>2]|0)+1}if((b|0)<(O|0)&&(ys(ce,oe),go(oe,u[Ye>>2]|0,w,1,p+8+(u[p>>2]<<4)|0),u[p>>2]=(u[p>>2]|0)+1),u[Ke>>2]=u[Ye>>2],u[Ke+4>>2]=u[Ye+4>>2],u[Ke+8>>2]=u[Ye+8>>2],u[Ke+12>>2]=u[Ye+12>>2],b=b+1|0,(b|0)>=(ie|0)){A=3;break}}if((A|0)==3){M=qe;return}else(A|0)==12&&ke(22522,22569,571,22579)}function E0(A,c,h){A=A|0,c=c|0,h=h|0;var d=0,p=0,m=0,y=0,b=0,w=0;w=M,M=M+128|0,d=w+64|0,p=w,m=d,y=20240,b=m+60|0;do u[m>>2]=u[y>>2],m=m+4|0,y=y+4|0;while((m|0)<(b|0));m=p,y=20304,b=m+60|0;do u[m>>2]=u[y>>2],m=m+4|0,y=y+4|0;while((m|0)<(b|0));b=(Hn(u[c>>2]|0)|0)==0,d=b?d:p,p=A+4|0,v0(p),T0(p),Hn(u[c>>2]|0)|0&&(bs(p),u[c>>2]=(u[c>>2]|0)+1),u[h>>2]=u[A>>2],c=h+4|0,En(p,d,c),fn(c),u[h+16>>2]=u[A>>2],c=h+20|0,En(p,d+12|0,c),fn(c),u[h+32>>2]=u[A>>2],c=h+36|0,En(p,d+24|0,c),fn(c),u[h+48>>2]=u[A>>2],c=h+52|0,En(p,d+36|0,c),fn(c),u[h+64>>2]=u[A>>2],h=h+68|0,En(p,d+48|0,h),fn(h),M=w}function nr(A,c,h,d){A=A|0,c=c|0,h=h|0,d=d|0;var p=0,m=0,y=0,b=0,w=0,E=0,I=0,O=0,H=0,G=0,V=0;if(V=M,M=M+32|0,H=V+12|0,b=V,G=A+4|0,O=u[16960+(c<<2)>>2]|0,I=(d|0)!=0,O=I?O*3|0:O,p=u[G>>2]|0,E=A+8|0,y=u[E>>2]|0,I){if(m=A+12|0,d=u[m>>2]|0,p=y+p+d|0,(p|0)==(O|0))return G=1,M=V,G|0;w=m}else w=A+12|0,d=u[w>>2]|0,p=y+p+d|0;if((p|0)<=(O|0))return G=0,M=V,G|0;do if((d|0)>0){if(d=u[A>>2]|0,(y|0)>0){m=18640+(d*80|0)+60|0,d=A;break}d=18640+(d*80|0)+40|0,h?(u3(H,O,0,0),PA(G,H,b),Sa(b),En(b,H,G),m=d,d=A):(m=d,d=A)}else m=18640+((u[A>>2]|0)*80|0)+20|0,d=A;while(!1);if(u[d>>2]=u[m>>2],p=m+16|0,(u[p>>2]|0)>0){d=0;do b0(G),d=d+1|0;while((d|0)<(u[p>>2]|0))}return A=m+4|0,u[H>>2]=u[A>>2],u[H+4>>2]=u[A+4>>2],u[H+8>>2]=u[A+8>>2],c=u[16880+(c<<2)>>2]|0,m0(H,I?c*3|0:c),En(G,H,G),fn(G),I?d=((u[E>>2]|0)+(u[G>>2]|0)+(u[w>>2]|0)|0)==(O|0)?1:2:d=2,G=d,M=V,G|0}function P3(A,c){A=A|0,c=c|0;var h=0;do h=nr(A,c,0,1)|0;while((h|0)==2);return h|0}function OA(A,c,h,d,p){A=A|0,c=c|0,h=h|0,d=d|0,p=p|0;var m=0,y=0,b=0,w=0,E=0,I=0,O=0,H=0,G=0,V=0,K=0,ue=0,ce=0,ie=0,oe=0,Y=0,Re=0,De=0,Ee=0,Pe=0,mt=0,ot=0,ct=0;if(mt=M,M=M+240|0,m=mt+224|0,Re=mt+208|0,De=mt,Ee=mt+192|0,Pe=mt+176|0,ue=mt+160|0,ce=mt+144|0,ie=mt+128|0,oe=mt+112|0,Y=mt+96|0,u[m>>2]=c,u[Re>>2]=u[A>>2],u[Re+4>>2]=u[A+4>>2],u[Re+8>>2]=u[A+8>>2],u[Re+12>>2]=u[A+12>>2],x0(Re,m,De),u[p>>2]=0,K=d+h+((d|0)==6&1)|0,(K|0)<=(h|0)){M=mt;return}w=u[m>>2]|0,E=h+6|0,I=16960+(w<<2)|0,O=ce+8|0,H=ie+8|0,G=oe+8|0,V=Ee+4|0,y=0,b=h,d=-1;e:for(;;){if(m=(b|0)%6|0,A=De+(m<<4)|0,u[Ee>>2]=u[A>>2],u[Ee+4>>2]=u[A+4>>2],u[Ee+8>>2]=u[A+8>>2],u[Ee+12>>2]=u[A+12>>2],A=y,y=nr(Ee,w,0,1)|0,(b|0)>(h|0)&(Hn(c)|0)!=0&&(A|0)!=1&&(u[Ee>>2]|0)!=(d|0)){switch(ys(De+(((m+5|0)%6|0)<<4)+4|0,Pe),ys(De+(m<<4)+4|0,ue),ot=+(u[I>>2]|0),B[ce>>3]=ot*3,B[O>>3]=0,ct=ot*-1.5,B[ie>>3]=ct,B[H>>3]=ot*2.598076211353316,B[oe>>3]=ct,B[G>>3]=ot*-2.598076211353316,m=u[Re>>2]|0,u[17040+(m*80|0)+(((d|0)==(m|0)?u[Ee>>2]|0:d)<<2)>>2]|0){case 1:{A=ie,d=ce;break}case 3:{A=oe,d=ie;break}case 2:{A=ce,d=oe;break}default:{A=8;break e}}L0(Pe,ue,d,A,Y),!(k0(Pe,Y)|0)&&!(k0(ue,Y)|0)&&(go(Y,u[Re>>2]|0,w,1,p+8+(u[p>>2]<<4)|0),u[p>>2]=(u[p>>2]|0)+1)}if((b|0)<(E|0)&&(ys(V,Pe),go(Pe,u[Ee>>2]|0,w,1,p+8+(u[p>>2]<<4)|0),u[p>>2]=(u[p>>2]|0)+1),b=b+1|0,(b|0)>=(K|0)){A=3;break}else d=u[Ee>>2]|0}if((A|0)==3){M=mt;return}else(A|0)==8&&ke(22606,22569,736,22651)}function x0(A,c,h){A=A|0,c=c|0,h=h|0;var d=0,p=0,m=0,y=0,b=0,w=0;w=M,M=M+160|0,d=w+80|0,p=w,m=d,y=20368,b=m+72|0;do u[m>>2]=u[y>>2],m=m+4|0,y=y+4|0;while((m|0)<(b|0));m=p,y=20448,b=m+72|0;do u[m>>2]=u[y>>2],m=m+4|0,y=y+4|0;while((m|0)<(b|0));b=(Hn(u[c>>2]|0)|0)==0,d=b?d:p,p=A+4|0,v0(p),T0(p),Hn(u[c>>2]|0)|0&&(bs(p),u[c>>2]=(u[c>>2]|0)+1),u[h>>2]=u[A>>2],c=h+4|0,En(p,d,c),fn(c),u[h+16>>2]=u[A>>2],c=h+20|0,En(p,d+12|0,c),fn(c),u[h+32>>2]=u[A>>2],c=h+36|0,En(p,d+24|0,c),fn(c),u[h+48>>2]=u[A>>2],c=h+52|0,En(p,d+36|0,c),fn(c),u[h+64>>2]=u[A>>2],c=h+68|0,En(p,d+48|0,c),fn(c),u[h+80>>2]=u[A>>2],h=h+84|0,En(p,d+60|0,h),fn(h),M=w}function M3(A,c){return A=A|0,c=c|0,c=_e(A|0,c|0,52)|0,N()|0,c&15|0}function C0(A,c){return A=A|0,c=c|0,c=_e(A|0,c|0,45)|0,N()|0,c&127|0}function DA(A,c){A=A|0,c=c|0;var h=0,d=0,p=0,m=0,y=0,b=0;if(!(!0&(c&-16777216|0)==134217728)||(y=_e(A|0,c|0,45)|0,N()|0,y=y&127,y>>>0>121))return c=0,c|0;h=_e(A|0,c|0,52)|0,N()|0,h=h&15;do if(h|0){for(p=1,d=0;;){if(m=_e(A|0,c|0,(15-p|0)*3|0)|0,N()|0,m=m&7,(m|0)!=0&(d^1))if((m|0)==1&(Bt(y)|0)!=0){b=0,d=13;break}else d=1;if((m|0)==7){b=0,d=13;break}if(p>>>0<h>>>0)p=p+1|0;else{d=9;break}}if((d|0)==9){if((h|0)==15)b=1;else break;return b|0}else if((d|0)==13)return b|0}while(!1);for(;;){if(b=_e(A|0,c|0,(14-h|0)*3|0)|0,N()|0,!((b&7|0)==7&!0)){b=0,d=13;break}if(h>>>0<14)h=h+1|0;else{b=1,d=13;break}}return(d|0)==13?b|0:0}function NA(A,c,h,d){A=A|0,c=c|0,h=h|0,d=d|0;var p=0,m=0;if(m=_e(A|0,c|0,52)|0,N()|0,m=m&15,h>>>0>15)return d=4,d|0;if((m|0)<(h|0))return d=12,d|0;if((m|0)==(h|0))return u[d>>2]=A,u[d+4>>2]=c,d=0,d|0;if(p=xe(h|0,0,52)|0,p=p|A,A=N()|0|c&-15728641,(m|0)>(h|0))do c=xe(7,0,(14-h|0)*3|0)|0,h=h+1|0,p=c|p,A=N()|0|A;while((h|0)<(m|0));return u[d>>2]=p,u[d+4>>2]=A,d=0,d|0}function Ra(A,c,h,d){A=A|0,c=c|0,h=h|0,d=d|0;var p=0,m=0,y=0;if(m=_e(A|0,c|0,52)|0,N()|0,m=m&15,!((h|0)<16&(m|0)<=(h|0)))return d=4,d|0;p=h-m|0,h=_e(A|0,c|0,45)|0,N()|0;e:do if(!(Bt(h&127)|0))h=Gi(7,0,p,((p|0)<0)<<31>>31)|0,p=N()|0;else{t:do if(m|0){for(h=1;y=xe(7,0,(15-h|0)*3|0)|0,!!((y&A|0)==0&((N()|0)&c|0)==0);)if(h>>>0<m>>>0)h=h+1|0;else break t;h=Gi(7,0,p,((p|0)<0)<<31>>31)|0,p=N()|0;break e}while(!1);h=Gi(7,0,p,((p|0)<0)<<31>>31)|0,h=gn(h|0,N()|0,5,0)|0,h=st(h|0,N()|0,-5,-1)|0,h=ws(h|0,N()|0,6,0)|0,h=st(h|0,N()|0,1,0)|0,p=N()|0}while(!1);return y=d,u[y>>2]=h,u[y+4>>2]=p,y=0,y|0}function Ot(A,c){A=A|0,c=c|0;var h=0,d=0,p=0;if(p=_e(A|0,c|0,45)|0,N()|0,!(Bt(p&127)|0))return p=0,p|0;p=_e(A|0,c|0,52)|0,N()|0,p=p&15;e:do if(!p)h=0;else for(d=1;;){if(h=_e(A|0,c|0,(15-d|0)*3|0)|0,N()|0,h=h&7,h|0)break e;if(d>>>0<p>>>0)d=d+1|0;else{h=0;break}}while(!1);return p=(h|0)==0&1,p|0}function B3(A,c,h,d){A=A|0,c=c|0,h=h|0,d=d|0;var p=0,m=0,y=0,b=0;if(y=M,M=M+16|0,m=y,R0(m,A,c,h),c=m,A=u[c>>2]|0,c=u[c+4>>2]|0,(A|0)==0&(c|0)==0)return M=y,0;p=0,h=0;do b=d+(p<<3)|0,u[b>>2]=A,u[b+4>>2]=c,p=st(p|0,h|0,1,0)|0,h=N()|0,P0(m),b=m,A=u[b>>2]|0,c=u[b+4>>2]|0;while(!((A|0)==0&(c|0)==0));return M=y,0}function O3(A,c,h,d){return A=A|0,c=c|0,h=h|0,d=d|0,(d|0)<(h|0)?(h=c,d=A,tt(h|0),d|0):(h=xe(-1,-1,((d-h|0)*3|0)+3|0)|0,d=xe(~h|0,~(N()|0)|0,(15-d|0)*3|0)|0,h=~(N()|0)&c,d=~d&A,tt(h|0),d|0)}function D3(A,c,h,d){A=A|0,c=c|0,h=h|0,d=d|0;var p=0;return p=_e(A|0,c|0,52)|0,N()|0,p=p&15,(h|0)<16&(p|0)<=(h|0)?((p|0)<(h|0)&&(p=xe(-1,-1,((h+-1-p|0)*3|0)+3|0)|0,p=xe(~p|0,~(N()|0)|0,(15-h|0)*3|0)|0,c=~(N()|0)&c,A=~p&A),p=xe(h|0,0,52)|0,h=c&-15728641|(N()|0),u[d>>2]=A|p,u[d+4>>2]=h,d=0,d|0):(d=4,d|0)}function N3(A,c,h,d){A=A|0,c=c|0,h=h|0,d=d|0;var p=0,m=0,y=0,b=0,w=0,E=0,I=0,O=0,H=0,G=0,V=0,K=0,ue=0,ce=0,ie=0,oe=0,Y=0,Re=0,De=0,Ee=0,Pe=0;if((h|0)==0&(d|0)==0)return Ee=0,Ee|0;if(p=A,m=u[p>>2]|0,p=u[p+4>>2]|0,!0&(p&15728640|0)==0){if(!((d|0)>0|(d|0)==0&h>>>0>0)||(Ee=c,u[Ee>>2]=m,u[Ee+4>>2]=p,(h|0)==1&(d|0)==0))return Ee=0,Ee|0;p=1;do Re=A+(p<<3)|0,De=u[Re+4>>2]|0,Ee=c+(p<<3)|0,u[Ee>>2]=u[Re>>2],u[Ee+4>>2]=De,p=p+1|0;while(0<(d|0)|(d|0)==0&p>>>0<h>>>0);return p=0,p|0}if(Y=h<<3,De=mi(Y)|0,!De)return Ee=13,Ee|0;if(Ba(De|0,A|0,Y|0)|0,Re=_i(h,8)|0,!Re)return je(De),Ee=13,Ee|0;e:do if(h|0){t:for(;;){p=De,ce=u[p>>2]|0,p=u[p+4>>2]|0,ie=_e(ce|0,p|0,52)|0,N()|0,ie=ie&15,oe=ie+-1|0,ue=(h|0)>0;n:do if((ie|0)!=0&ue){if(G=((h|0)<0)<<31>>31,V=xe(oe|0,0,52)|0,K=N()|0,oe>>>0>15){if(!((ce|0)==0&(p|0)==0)){Ee=17;break t}for(m=0;;){if(m=m+1|0,(m|0)>=(h|0))break n;if(d=De+(m<<3)|0,K=u[d>>2]|0,d=u[d+4>>2]|0,!((K|0)==0&(d|0)==0)){p=d,Ee=17;break t}}}for(m=0,A=ce,d=p;;){if(!((A|0)==0&(d|0)==0)){if(!(!0&(d&117440512|0)==0)){Ee=22;break t}if(b=_e(A|0,d|0,52)|0,N()|0,b=b&15,(b|0)<(oe|0)){p=12,Ee=28;break t}if((b|0)!=(oe|0)&&(A=A|V,d=d&-15728641|K,b>>>0>=ie>>>0)){y=oe;do H=xe(7,0,(14-y|0)*3|0)|0,y=y+1|0,A=H|A,d=N()|0|d;while(y>>>0<b>>>0)}if(y=rr(A|0,d|0,h|0,G|0)|0,N()|0,E=Re+(y<<3)|0,b=E,w=u[b>>2]|0,b=u[b+4>>2]|0,(w|0)==0&(b|0)==0)y=E;else for(H=0;;){if((H|0)>(h|0)){Ee=32;break t}if((w|0)==(A|0)&(b&-117440513|0)==(d|0)){I=_e(w|0,b|0,56)|0,N()|0,I=I&7,O=I+1|0,Pe=_e(w|0,b|0,45)|0,N()|0;i:do if(!(Bt(Pe&127)|0))b=7;else{if(w=_e(w|0,b|0,52)|0,N()|0,w=w&15,!w){b=6;break}for(b=1;;){if(Pe=xe(7,0,(15-b|0)*3|0)|0,!((Pe&A|0)==0&((N()|0)&d|0)==0)){b=7;break i}if(b>>>0<w>>>0)b=b+1|0;else{b=6;break}}}while(!1);if((I+2|0)>>>0>b>>>0){Ee=42;break t}Pe=xe(O|0,0,56)|0,d=N()|0|d&-117440513,O=E,u[O>>2]=0,u[O+4>>2]=0,A=Pe|A}else y=(y+1|0)%(h|0)|0;if(E=Re+(y<<3)|0,b=E,w=u[b>>2]|0,b=u[b+4>>2]|0,(w|0)==0&(b|0)==0){y=E;break}else H=H+1|0}Pe=y,u[Pe>>2]=A,u[Pe+4>>2]=d}if(m=m+1|0,(m|0)>=(h|0))break n;d=De+(m<<3)|0,A=u[d>>2]|0,d=u[d+4>>2]|0}}while(!1);if((h+5|0)>>>0<11){Ee=85;break}if(K=_i((h|0)/6|0,8)|0,!K){Ee=49;break}n:do if(ue){H=0,O=0;do{if(b=Re+(H<<3)|0,d=b,m=u[d>>2]|0,d=u[d+4>>2]|0,!((m|0)==0&(d|0)==0)){w=_e(m|0,d|0,56)|0,N()|0,w=w&7,A=w+1|0,E=d&-117440513,Pe=_e(m|0,d|0,45)|0,N()|0;i:do if(Bt(Pe&127)|0){if(I=_e(m|0,d|0,52)|0,N()|0,I=I&15,I|0)for(y=1;;){if(Pe=xe(7,0,(15-y|0)*3|0)|0,!((m&Pe|0)==0&(E&(N()|0)|0)==0))break i;if(y>>>0<I>>>0)y=y+1|0;else break}d=xe(A|0,0,56)|0,m=d|m,d=N()|0|E,A=b,u[A>>2]=m,u[A+4>>2]=d,A=w+2|0}while(!1);(A|0)==7&&(Pe=K+(O<<3)|0,u[Pe>>2]=m,u[Pe+4>>2]=d&-117440513,O=O+1|0)}H=H+1|0}while((H|0)!=(h|0));if(ue){if(H=((h|0)<0)<<31>>31,G=xe(oe|0,0,52)|0,V=N()|0,oe>>>0>15){if(!((ce|0)==0&(p|0)==0)){p=4,Ee=84;break t}for(p=0;;){if(p=p+1|0,(p|0)>=(h|0)){m=0,p=O;break n}if(Pe=De+(p<<3)|0,!((u[Pe>>2]|0)==0&(u[Pe+4>>2]|0)==0)){p=4,Ee=84;break t}}}for(I=0,m=0,E=ce;;){do if(!((E|0)==0&(p|0)==0)){if(b=_e(E|0,p|0,52)|0,N()|0,b=b&15,(b|0)<(oe|0)){p=12,Ee=84;break t}do if((b|0)==(oe|0))d=E,b=p;else{if(d=E|G,A=p&-15728641|V,b>>>0<ie>>>0){b=A;break}y=oe;do Pe=xe(7,0,(14-y|0)*3|0)|0,y=y+1|0,d=Pe|d,A=N()|0|A;while(y>>>0<b>>>0);b=A}while(!1);for(y=rr(d|0,b|0,h|0,H|0)|0,N()|0,A=0;;){if((A|0)>(h|0)){Ee=77;break t}if(Pe=Re+(y<<3)|0,w=u[Pe+4>>2]|0,(w&-117440513|0)==(b|0)&&(u[Pe>>2]|0)==(d|0)){Ee=79;break}if(y=(y+1|0)%(h|0)|0,Pe=Re+(y<<3)|0,(u[Pe>>2]|0)==(d|0)&&(u[Pe+4>>2]|0)==(b|0))break;A=A+1|0}if((Ee|0)==79&&(Ee=0,!0&(w&117440512|0)==100663296))break;Pe=c+(m<<3)|0,u[Pe>>2]=E,u[Pe+4>>2]=p,m=m+1|0}while(!1);if(p=I+1|0,(p|0)>=(h|0)){p=O;break n}Pe=De+(p<<3)|0,I=p,E=u[Pe>>2]|0,p=u[Pe+4>>2]|0}}else m=0,p=O}else m=0,p=0;while(!1);if(Es(Re|0,0,Y|0)|0,Ba(De|0,K|0,p<<3|0)|0,je(K),p)c=c+(m<<3)|0,h=p;else break e}if((Ee|0)==17)!0&(p&117440512|0)==0?(p=4,Ee=28):Ee=22;else if((Ee|0)==32)ke(23313,22674,362,22684);else{if((Ee|0)==42)return je(De),je(Re),Pe=10,Pe|0;if((Ee|0)==49)return je(De),je(Re),Pe=13,Pe|0;if((Ee|0)==77)ke(23313,22674,462,22684);else{if((Ee|0)==84)return je(K),je(De),je(Re),Pe=p,Pe|0;if((Ee|0)==85){Ba(c|0,De|0,h<<3|0)|0;break}}}if((Ee|0)==22)return je(De),je(Re),Pe=5,Pe|0;if((Ee|0)==28)return je(De),je(Re),Pe=p,Pe|0}while(!1);return je(De),je(Re),Pe=0,Pe|0}function F3(A,c,h,d,p,m,y){A=A|0,c=c|0,h=h|0,d=d|0,p=p|0,m=m|0,y=y|0;var b=0,w=0,E=0,I=0,O=0,H=0,G=0,V=0,K=0;if(K=M,M=M+16|0,V=K,!((h|0)>0|(h|0)==0&c>>>0>0))return V=0,M=K,V|0;if((y|0)>=16)return V=12,M=K,V|0;H=0,G=0,O=0,b=0;e:for(;;){if(E=A+(H<<3)|0,w=u[E>>2]|0,E=u[E+4>>2]|0,I=_e(w|0,E|0,52)|0,N()|0,(I&15|0)>(y|0)){b=12,w=11;break}if(R0(V,w,E,y),I=V,E=u[I>>2]|0,I=u[I+4>>2]|0,(E|0)==0&(I|0)==0)w=O;else{w=O;do{if(!((b|0)<(m|0)|(b|0)==(m|0)&w>>>0<p>>>0)){w=10;break e}O=d+(w<<3)|0,u[O>>2]=E,u[O+4>>2]=I,w=st(w|0,b|0,1,0)|0,b=N()|0,P0(V),O=V,E=u[O>>2]|0,I=u[O+4>>2]|0}while(!((E|0)==0&(I|0)==0))}if(H=st(H|0,G|0,1,0)|0,G=N()|0,(G|0)<(h|0)|(G|0)==(h|0)&H>>>0<c>>>0)O=w;else{b=0,w=11;break}}return(w|0)==10?(V=14,M=K,V|0):(w|0)==11?(M=K,b|0):0}function L3(A,c,h,d,p){A=A|0,c=c|0,h=h|0,d=d|0,p=p|0;var m=0,y=0,b=0,w=0,E=0,I=0,O=0,H=0;H=M,M=M+16|0,O=H;e:do if((h|0)>0|(h|0)==0&c>>>0>0){for(E=0,y=0,m=0,I=0;;){if(w=A+(E<<3)|0,b=u[w>>2]|0,w=u[w+4>>2]|0,!((b|0)==0&(w|0)==0)&&(w=(Ra(b,w,d,O)|0)==0,b=O,y=st(u[b>>2]|0,u[b+4>>2]|0,y|0,m|0)|0,m=N()|0,!w)){m=12;break}if(E=st(E|0,I|0,1,0)|0,I=N()|0,!((I|0)<(h|0)|(I|0)==(h|0)&E>>>0<c>>>0))break e}return M=H,m|0}else y=0,m=0;while(!1);return u[p>>2]=y,u[p+4>>2]=m,p=0,M=H,p|0}function k3(A,c){return A=A|0,c=c|0,c=_e(A|0,c|0,52)|0,N()|0,c&1|0}function Sn(A,c){A=A|0,c=c|0;var h=0,d=0,p=0;if(p=_e(A|0,c|0,52)|0,N()|0,p=p&15,!p)return p=0,p|0;for(d=1;;){if(h=_e(A|0,c|0,(15-d|0)*3|0)|0,N()|0,h=h&7,h|0){d=5;break}if(d>>>0<p>>>0)d=d+1|0;else{h=0,d=5;break}}return(d|0)==5?h|0:0}function FA(A,c){A=A|0,c=c|0;var h=0,d=0,p=0,m=0,y=0,b=0,w=0;if(w=_e(A|0,c|0,52)|0,N()|0,w=w&15,!w)return b=c,w=A,tt(b|0),w|0;for(b=1,h=0;;){m=(15-b|0)*3|0,d=xe(7,0,m|0)|0,p=N()|0,y=_e(A|0,c|0,m|0)|0,N()|0,m=xe(vs(y&7)|0,0,m|0)|0,y=N()|0,A=m|A&~d,c=y|c&~p;e:do if(!h)if((m&d|0)==0&(y&p|0)==0)h=0;else if(d=_e(A|0,c|0,52)|0,N()|0,d=d&15,!d)h=1;else{h=1;t:for(;;){switch(y=_e(A|0,c|0,(15-h|0)*3|0)|0,N()|0,y&7){case 1:break t;case 0:break;default:{h=1;break e}}if(h>>>0<d>>>0)h=h+1|0;else{h=1;break e}}for(h=1;;)if(y=(15-h|0)*3|0,p=_e(A|0,c|0,y|0)|0,N()|0,m=xe(7,0,y|0)|0,c=c&~(N()|0),y=xe(vs(p&7)|0,0,y|0)|0,A=A&~m|y,c=c|(N()|0),h>>>0<d>>>0)h=h+1|0;else{h=1;break}}while(!1);if(b>>>0<w>>>0)b=b+1|0;else break}return tt(c|0),A|0}function Ts(A,c){A=A|0,c=c|0;var h=0,d=0,p=0,m=0,y=0;if(d=_e(A|0,c|0,52)|0,N()|0,d=d&15,!d)return h=c,d=A,tt(h|0),d|0;for(h=1;m=(15-h|0)*3|0,y=_e(A|0,c|0,m|0)|0,N()|0,p=xe(7,0,m|0)|0,c=c&~(N()|0),m=xe(vs(y&7)|0,0,m|0)|0,A=m|A&~p,c=N()|0|c,h>>>0<d>>>0;)h=h+1|0;return tt(c|0),A|0}function U3(A,c){A=A|0,c=c|0;var h=0,d=0,p=0,m=0,y=0,b=0,w=0;if(w=_e(A|0,c|0,52)|0,N()|0,w=w&15,!w)return b=c,w=A,tt(b|0),w|0;for(b=1,h=0;;){m=(15-b|0)*3|0,d=xe(7,0,m|0)|0,p=N()|0,y=_e(A|0,c|0,m|0)|0,N()|0,m=xe(Hi(y&7)|0,0,m|0)|0,y=N()|0,A=m|A&~d,c=y|c&~p;e:do if(!h)if((m&d|0)==0&(y&p|0)==0)h=0;else if(d=_e(A|0,c|0,52)|0,N()|0,d=d&15,!d)h=1;else{h=1;t:for(;;){switch(y=_e(A|0,c|0,(15-h|0)*3|0)|0,N()|0,y&7){case 1:break t;case 0:break;default:{h=1;break e}}if(h>>>0<d>>>0)h=h+1|0;else{h=1;break e}}for(h=1;;)if(p=(15-h|0)*3|0,m=xe(7,0,p|0)|0,y=c&~(N()|0),c=_e(A|0,c|0,p|0)|0,N()|0,c=xe(Hi(c&7)|0,0,p|0)|0,A=A&~m|c,c=y|(N()|0),h>>>0<d>>>0)h=h+1|0;else{h=1;break}}while(!1);if(b>>>0<w>>>0)b=b+1|0;else break}return tt(c|0),A|0}function LA(A,c){A=A|0,c=c|0;var h=0,d=0,p=0,m=0,y=0;if(d=_e(A|0,c|0,52)|0,N()|0,d=d&15,!d)return h=c,d=A,tt(h|0),d|0;for(h=1;y=(15-h|0)*3|0,m=xe(7,0,y|0)|0,p=c&~(N()|0),c=_e(A|0,c|0,y|0)|0,N()|0,c=xe(Hi(c&7)|0,0,y|0)|0,A=c|A&~m,c=N()|0|p,h>>>0<d>>>0;)h=h+1|0;return tt(c|0),A|0}function V3(A,c){A=A|0,c=c|0;var h=0,d=0,p=0,m=0,y=0,b=0,w=0,E=0,I=0;if(w=M,M=M+64|0,b=w+40|0,d=w+24|0,p=w+12|0,m=w,xe(c|0,0,52)|0,h=N()|0|134225919,!c)return(u[A+4>>2]|0)>2||(u[A+8>>2]|0)>2||(u[A+12>>2]|0)>2?(y=0,b=0,tt(y|0),M=w,b|0):(xe(h0(A)|0,0,45)|0,y=N()|0|h,b=-1,tt(y|0),M=w,b|0);if(u[b>>2]=u[A>>2],u[b+4>>2]=u[A+4>>2],u[b+8>>2]=u[A+8>>2],u[b+12>>2]=u[A+12>>2],y=b+4|0,(c|0)>0)for(A=-1;u[d>>2]=u[y>>2],u[d+4>>2]=u[y+4>>2],u[d+8>>2]=u[y+8>>2],c&1?(g3(y),u[p>>2]=u[y>>2],u[p+4>>2]=u[y+4>>2],u[p+8>>2]=u[y+8>>2],Ca(p)):(_0(y),u[p>>2]=u[y>>2],u[p+4>>2]=u[y+4>>2],u[p+8>>2]=u[y+8>>2],bs(p)),PA(d,p,m),fn(m),I=(15-c|0)*3|0,E=xe(7,0,I|0)|0,h=h&~(N()|0),I=xe(xa(m)|0,0,I|0)|0,A=I|A&~E,h=N()|0|h,(c|0)>1;)c=c+-1|0;else A=-1;e:do if((u[y>>2]|0)<=2&&(u[b+8>>2]|0)<=2&&(u[b+12>>2]|0)<=2){if(d=h0(b)|0,c=xe(d|0,0,45)|0,c=c|A,A=N()|0|h&-1040385,m=r3(b)|0,!(Bt(d)|0)){if((m|0)<=0)break;for(p=0;;){if(d=_e(c|0,A|0,52)|0,N()|0,d=d&15,d)for(h=1;I=(15-h|0)*3|0,b=_e(c|0,A|0,I|0)|0,N()|0,E=xe(7,0,I|0)|0,A=A&~(N()|0),I=xe(vs(b&7)|0,0,I|0)|0,c=c&~E|I,A=A|(N()|0),h>>>0<d>>>0;)h=h+1|0;if(p=p+1|0,(p|0)==(m|0))break e}}p=_e(c|0,A|0,52)|0,N()|0,p=p&15;t:do if(p){h=1;n:for(;;){switch(I=_e(c|0,A|0,(15-h|0)*3|0)|0,N()|0,I&7){case 1:break n;case 0:break;default:break t}if(h>>>0<p>>>0)h=h+1|0;else break t}if(f0(d,u[b>>2]|0)|0)for(h=1;b=(15-h|0)*3|0,E=xe(7,0,b|0)|0,I=A&~(N()|0),A=_e(c|0,A|0,b|0)|0,N()|0,A=xe(Hi(A&7)|0,0,b|0)|0,c=c&~E|A,A=I|(N()|0),h>>>0<p>>>0;)h=h+1|0;else for(h=1;I=(15-h|0)*3|0,b=_e(c|0,A|0,I|0)|0,N()|0,E=xe(7,0,I|0)|0,A=A&~(N()|0),I=xe(vs(b&7)|0,0,I|0)|0,c=c&~E|I,A=A|(N()|0),h>>>0<p>>>0;)h=h+1|0}while(!1);if((m|0)>0){h=0;do c=FA(c,A)|0,A=N()|0,h=h+1|0;while((h|0)!=(m|0))}}else c=0,A=0;while(!1);return E=A,I=c,tt(E|0),M=w,I|0}function Hn(A){return A=A|0,(A|0)%2|0|0}function S0(A,c,h){A=A|0,c=c|0,h=h|0;var d=0,p=0;return p=M,M=M+16|0,d=p,c>>>0>15?(d=4,M=p,d|0):(u[A+4>>2]&2146435072|0)==2146435072||(u[A+8+4>>2]&2146435072|0)==2146435072?(d=3,M=p,d|0):(C3(A,c,d),c=V3(d,c)|0,d=N()|0,u[h>>2]=c,u[h+4>>2]=d,(c|0)==0&(d|0)==0&&ke(23313,22674,786,22697),d=0,M=p,d|0)}function kA(A,c,h){A=A|0,c=c|0,h=h|0;var d=0,p=0,m=0,y=0;if(p=h+4|0,m=_e(A|0,c|0,52)|0,N()|0,m=m&15,y=_e(A|0,c|0,45)|0,N()|0,d=(m|0)==0,Bt(y&127)|0){if(d)return y=1,y|0;d=1}else{if(d)return y=0,y|0;(u[p>>2]|0)==0&&(u[h+8>>2]|0)==0?d=(u[h+12>>2]|0)!=0&1:d=1}for(h=1;h&1?Ca(p):bs(p),y=_e(A|0,c|0,(15-h|0)*3|0)|0,N()|0,y0(p,y&7),h>>>0<m>>>0;)h=h+1|0;return d|0}function ir(A,c,h){A=A|0,c=c|0,h=h|0;var d=0,p=0,m=0,y=0,b=0,w=0,E=0,I=0;if(I=M,M=M+16|0,w=I,E=_e(A|0,c|0,45)|0,N()|0,E=E&127,E>>>0>121)return u[h>>2]=0,u[h+4>>2]=0,u[h+8>>2]=0,u[h+12>>2]=0,E=5,M=I,E|0;e:do if((Bt(E)|0)!=0&&(m=_e(A|0,c|0,52)|0,N()|0,m=m&15,(m|0)!=0)){d=1;t:for(;;){switch(b=_e(A|0,c|0,(15-d|0)*3|0)|0,N()|0,b&7){case 5:break t;case 0:break;default:{d=c;break e}}if(d>>>0<m>>>0)d=d+1|0;else{d=c;break e}}for(p=1,d=c;c=(15-p|0)*3|0,y=xe(7,0,c|0)|0,b=d&~(N()|0),d=_e(A|0,d|0,c|0)|0,N()|0,d=xe(Hi(d&7)|0,0,c|0)|0,A=A&~y|d,d=b|(N()|0),p>>>0<m>>>0;)p=p+1|0}else d=c;while(!1);if(b=7696+(E*28|0)|0,u[h>>2]=u[b>>2],u[h+4>>2]=u[b+4>>2],u[h+8>>2]=u[b+8>>2],u[h+12>>2]=u[b+12>>2],!(kA(A,d,h)|0))return E=0,M=I,E|0;if(y=h+4|0,u[w>>2]=u[y>>2],u[w+4>>2]=u[y+4>>2],u[w+8>>2]=u[y+8>>2],m=_e(A|0,d|0,52)|0,N()|0,b=m&15,m&1?(bs(y),m=b+1|0):m=b,!(Bt(E)|0))d=0;else{e:do if(!b)d=0;else for(c=1;;){if(p=_e(A|0,d|0,(15-c|0)*3|0)|0,N()|0,p=p&7,p|0){d=p;break e}if(c>>>0<b>>>0)c=c+1|0;else{d=0;break}}while(!1);d=(d|0)==4&1}if(!(nr(h,m,d,0)|0))(m|0)!=(b|0)&&(u[y>>2]=u[w>>2],u[y+4>>2]=u[w+4>>2],u[y+8>>2]=u[w+8>>2]);else{if(Bt(E)|0)do;while((nr(h,m,0,0)|0)!=0);(m|0)!=(b|0)&&_0(y)}return E=0,M=I,E|0}function po(A,c,h){A=A|0,c=c|0,h=h|0;var d=0,p=0,m=0;return m=M,M=M+16|0,d=m,p=ir(A,c,d)|0,p|0?(M=m,p|0):(p=_e(A|0,c|0,52)|0,N()|0,R3(d,p&15,h),p=0,M=m,p|0)}function mo(A,c,h){A=A|0,c=c|0,h=h|0;var d=0,p=0,m=0,y=0,b=0;if(y=M,M=M+16|0,m=y,d=ir(A,c,m)|0,d|0)return m=d,M=y,m|0;d=_e(A|0,c|0,45)|0,N()|0,d=(Bt(d&127)|0)==0,p=_e(A|0,c|0,52)|0,N()|0,p=p&15;e:do if(!d){if(p|0)for(d=1;;){if(b=xe(7,0,(15-d|0)*3|0)|0,!((b&A|0)==0&((N()|0)&c|0)==0))break e;if(d>>>0<p>>>0)d=d+1|0;else break}return BA(m,p,0,5,h),b=0,M=y,b|0}while(!1);return OA(m,p,0,6,h),b=0,M=y,b|0}function z3(A,c,h){A=A|0,c=c|0,h=h|0;var d=0,p=0,m=0;if(p=_e(A|0,c|0,45)|0,N()|0,!(Bt(p&127)|0))return p=2,u[h>>2]=p,0;if(p=_e(A|0,c|0,52)|0,N()|0,p=p&15,!p)return p=5,u[h>>2]=p,0;for(d=1;;){if(m=xe(7,0,(15-d|0)*3|0)|0,!((m&A|0)==0&((N()|0)&c|0)==0)){d=2,A=6;break}if(d>>>0<p>>>0)d=d+1|0;else{d=5,A=6;break}}return(A|0)==6&&(u[h>>2]=d),0}function I0(A,c,h){A=A|0,c=c|0,h=h|0;var d=0,p=0,m=0,y=0,b=0,w=0,E=0,I=0,O=0;O=M,M=M+128|0,E=O+112|0,m=O+96|0,I=O,p=_e(A|0,c|0,52)|0,N()|0,b=p&15,u[E>>2]=b,y=_e(A|0,c|0,45)|0,N()|0,y=y&127;e:do if(Bt(y)|0){if(b|0)for(d=1;;){if(w=xe(7,0,(15-d|0)*3|0)|0,!((w&A|0)==0&((N()|0)&c|0)==0)){p=0;break e}if(d>>>0<b>>>0)d=d+1|0;else break}if(p&1)p=1;else return w=xe(b+1|0,0,52)|0,I=N()|0|c&-15728641,E=xe(7,0,(14-b|0)*3|0)|0,I=I0((w|A)&~E,I&~(N()|0),h)|0,M=O,I|0}else p=0;while(!1);if(d=ir(A,c,m)|0,!d){p?(E0(m,E,I),w=5):(x0(m,E,I),w=6);e:do if(Bt(y)|0)if(!b)A=5;else for(d=1;;){if(y=xe(7,0,(15-d|0)*3|0)|0,!((y&A|0)==0&((N()|0)&c|0)==0)){A=2;break e}if(d>>>0<b>>>0)d=d+1|0;else{A=5;break}}else A=2;while(!1);Es(h|0,-1,A<<2|0)|0;e:do if(p)for(m=0;;){if(y=I+(m<<4)|0,P3(y,u[E>>2]|0)|0,y=u[y>>2]|0,b=u[h>>2]|0,(b|0)==-1|(b|0)==(y|0))d=h;else{p=0;do{if(p=p+1|0,p>>>0>=A>>>0){d=1;break e}d=h+(p<<2)|0,b=u[d>>2]|0}while(!((b|0)==-1|(b|0)==(y|0)))}if(u[d>>2]=y,m=m+1|0,m>>>0>=w>>>0){d=0;break}}else for(m=0;;){if(y=I+(m<<4)|0,nr(y,u[E>>2]|0,0,1)|0,y=u[y>>2]|0,b=u[h>>2]|0,(b|0)==-1|(b|0)==(y|0))d=h;else{p=0;do{if(p=p+1|0,p>>>0>=A>>>0){d=1;break e}d=h+(p<<2)|0,b=u[d>>2]|0}while(!((b|0)==-1|(b|0)==(y|0)))}if(u[d>>2]=y,m=m+1|0,m>>>0>=w>>>0){d=0;break}}while(!1)}return I=d,M=O,I|0}function H3(){return 12}function UA(A,c){A=A|0,c=c|0;var h=0,d=0,p=0,m=0,y=0,b=0,w=0;if(A>>>0>15)return b=4,b|0;if(xe(A|0,0,52)|0,b=N()|0|134225919,!A){h=0,d=0;do Bt(d)|0&&(xe(d|0,0,45)|0,y=b|(N()|0),A=c+(h<<3)|0,u[A>>2]=-1,u[A+4>>2]=y,h=h+1|0),d=d+1|0;while((d|0)!=122);return h=0,h|0}h=0,y=0;do{if(Bt(y)|0){for(xe(y|0,0,45)|0,d=1,p=-1,m=b|(N()|0);w=xe(7,0,(15-d|0)*3|0)|0,p=p&~w,m=m&~(N()|0),(d|0)!=(A|0);)d=d+1|0;w=c+(h<<3)|0,u[w>>2]=p,u[w+4>>2]=m,h=h+1|0}y=y+1|0}while((y|0)!=122);return h=0,h|0}function G3(A,c,h,d){A=A|0,c=c|0,h=h|0,d=d|0;var p=0,m=0,y=0,b=0,w=0,E=0,I=0,O=0,H=0,G=0,V=0,K=0,ue=0,ce=0,ie=0;if(ie=M,M=M+16|0,ue=ie,ce=_e(A|0,c|0,52)|0,N()|0,ce=ce&15,h>>>0>15)return ce=4,M=ie,ce|0;if((ce|0)<(h|0))return ce=12,M=ie,ce|0;if((ce|0)!=(h|0))if(m=xe(h|0,0,52)|0,m=m|A,b=N()|0|c&-15728641,(ce|0)>(h|0)){w=h;do K=xe(7,0,(14-w|0)*3|0)|0,w=w+1|0,m=K|m,b=N()|0|b;while((w|0)<(ce|0));K=m}else K=m;else K=A,b=c;V=_e(K|0,b|0,45)|0,N()|0;e:do if(Bt(V&127)|0){if(w=_e(K|0,b|0,52)|0,N()|0,w=w&15,w|0)for(m=1;;){if(V=xe(7,0,(15-m|0)*3|0)|0,!((V&K|0)==0&((N()|0)&b|0)==0)){E=33;break e}if(m>>>0<w>>>0)m=m+1|0;else break}if(V=d,u[V>>2]=0,u[V+4>>2]=0,(ce|0)>(h|0)){for(V=c&-15728641,G=ce;;){if(H=G,G=G+-1|0,G>>>0>15|(ce|0)<(G|0)){E=19;break}if((ce|0)!=(G|0))if(m=xe(G|0,0,52)|0,m=m|A,w=N()|0|V,(ce|0)<(H|0))O=m;else{E=G;do O=xe(7,0,(14-E|0)*3|0)|0,E=E+1|0,m=O|m,w=N()|0|w;while((E|0)<(ce|0));O=m}else O=A,w=c;if(I=_e(O|0,w|0,45)|0,N()|0,!(Bt(I&127)|0))m=0;else{I=_e(O|0,w|0,52)|0,N()|0,I=I&15;t:do if(!I)m=0;else for(E=1;;){if(m=_e(O|0,w|0,(15-E|0)*3|0)|0,N()|0,m=m&7,m|0)break t;if(E>>>0<I>>>0)E=E+1|0;else{m=0;break}}while(!1);m=(m|0)==0&1}if(w=_e(A|0,c|0,(15-H|0)*3|0)|0,N()|0,w=w&7,(w|0)==7){p=5,E=42;break}if(m=(m|0)!=0,(w|0)==1&m){p=5,E=42;break}if(O=w+(((w|0)!=0&m)<<31>>31)|0,O|0&&(E=ce-H|0,E=Gi(7,0,E,((E|0)<0)<<31>>31)|0,I=N()|0,m?(m=gn(E|0,I|0,5,0)|0,m=st(m|0,N()|0,-5,-1)|0,m=ws(m|0,N()|0,6,0)|0,m=st(m|0,N()|0,1,0)|0,w=N()|0):(m=E,w=I),H=O+-1|0,H=gn(E|0,I|0,H|0,((H|0)<0)<<31>>31|0)|0,H=st(m|0,w|0,H|0,N()|0)|0,O=N()|0,I=d,I=st(H|0,O|0,u[I>>2]|0,u[I+4>>2]|0)|0,O=N()|0,H=d,u[H>>2]=I,u[H+4>>2]=O),(G|0)<=(h|0)){E=37;break}}if((E|0)==19)ke(23313,22674,1099,22710);else if((E|0)==37){y=d,p=u[y+4>>2]|0,y=u[y>>2]|0;break}else if((E|0)==42)return M=ie,p|0}else p=0,y=0}else E=33;while(!1);e:do if((E|0)==33)if(V=d,u[V>>2]=0,u[V+4>>2]=0,(ce|0)>(h|0)){for(m=ce;;){if(p=_e(A|0,c|0,(15-m|0)*3|0)|0,N()|0,p=p&7,(p|0)==7){p=5;break}if(y=ce-m|0,y=Gi(7,0,y,((y|0)<0)<<31>>31)|0,p=gn(y|0,N()|0,p|0,0)|0,y=N()|0,V=d,y=st(u[V>>2]|0,u[V+4>>2]|0,p|0,y|0)|0,p=N()|0,V=d,u[V>>2]=y,u[V+4>>2]=p,m=m+-1|0,(m|0)<=(h|0))break e}return M=ie,p|0}else p=0,y=0;while(!1);return Ra(K,b,ce,ue)|0&&ke(23313,22674,1063,22725),ce=ue,ue=u[ce+4>>2]|0,((p|0)>-1|(p|0)==-1&y>>>0>4294967295)&((ue|0)>(p|0)|((ue|0)==(p|0)?(u[ce>>2]|0)>>>0>y>>>0:0))?(ce=0,M=ie,ce|0):(ke(23313,22674,1139,22710),0)}function W3(A,c,h,d,p,m){A=A|0,c=c|0,h=h|0,d=d|0,p=p|0,m=m|0;var y=0,b=0,w=0,E=0,I=0,O=0,H=0,G=0,V=0,K=0;if(O=M,M=M+16|0,y=O,p>>>0>15)return m=4,M=O,m|0;if(b=_e(h|0,d|0,52)|0,N()|0,b=b&15,(b|0)>(p|0))return m=12,M=O,m|0;if(Ra(h,d,p,y)|0&&ke(23313,22674,1063,22725),I=y,E=u[I+4>>2]|0,!(((c|0)>-1|(c|0)==-1&A>>>0>4294967295)&((E|0)>(c|0)|((E|0)==(c|0)?(u[I>>2]|0)>>>0>A>>>0:0))))return m=2,M=O,m|0;I=p-b|0,p=xe(p|0,0,52)|0,w=N()|0|d&-15728641,E=m,u[E>>2]=p|h,u[E+4>>2]=w,E=_e(h|0,d|0,45)|0,N()|0;e:do if(Bt(E&127)|0){if(b|0)for(y=1;;){if(E=xe(7,0,(15-y|0)*3|0)|0,!((E&h|0)==0&((N()|0)&d|0)==0))break e;if(y>>>0<b>>>0)y=y+1|0;else break}if((I|0)<1)return m=0,M=O,m|0;for(E=b^15,d=-1,w=1,y=1;;){b=I-w|0,b=Gi(7,0,b,((b|0)<0)<<31>>31)|0,h=N()|0;do if(y)if(y=gn(b|0,h|0,5,0)|0,y=st(y|0,N()|0,-5,-1)|0,y=ws(y|0,N()|0,6,0)|0,p=N()|0,(c|0)>(p|0)|(c|0)==(p|0)&A>>>0>y>>>0){c=st(A|0,c|0,-1,-1)|0,c=dn(c|0,N()|0,y|0,p|0)|0,y=N()|0,H=m,V=u[H>>2]|0,H=u[H+4>>2]|0,K=(E+d|0)*3|0,G=xe(7,0,K|0)|0,H=H&~(N()|0),d=ws(c|0,y|0,b|0,h|0)|0,A=N()|0,p=st(d|0,A|0,2,0)|0,K=xe(p|0,N()|0,K|0)|0,H=N()|0|H,p=m,u[p>>2]=K|V&~G,u[p+4>>2]=H,A=gn(d|0,A|0,b|0,h|0)|0,A=dn(c|0,y|0,A|0,N()|0)|0,y=0,c=N()|0;break}else{K=m,G=u[K>>2]|0,K=u[K+4>>2]|0,V=xe(7,0,(E+d|0)*3|0)|0,K=K&~(N()|0),y=m,u[y>>2]=G&~V,u[y+4>>2]=K,y=1;break}else G=m,p=u[G>>2]|0,G=u[G+4>>2]|0,d=(E+d|0)*3|0,H=xe(7,0,d|0)|0,G=G&~(N()|0),K=ws(A|0,c|0,b|0,h|0)|0,y=N()|0,d=xe(K|0,y|0,d|0)|0,G=N()|0|G,V=m,u[V>>2]=d|p&~H,u[V+4>>2]=G,y=gn(K|0,y|0,b|0,h|0)|0,A=dn(A|0,c|0,y|0,N()|0)|0,y=0,c=N()|0;while(!1);if((I|0)>(w|0))d=~w,w=w+1|0;else{c=0;break}}return M=O,c|0}while(!1);if((I|0)<1)return K=0,M=O,K|0;for(p=b^15,y=1;;)if(V=I-y|0,V=Gi(7,0,V,((V|0)<0)<<31>>31)|0,K=N()|0,w=m,h=u[w>>2]|0,w=u[w+4>>2]|0,b=(p-y|0)*3|0,d=xe(7,0,b|0)|0,w=w&~(N()|0),H=ws(A|0,c|0,V|0,K|0)|0,G=N()|0,b=xe(H|0,G|0,b|0)|0,w=N()|0|w,E=m,u[E>>2]=b|h&~d,u[E+4>>2]=w,K=gn(H|0,G|0,V|0,K|0)|0,A=dn(A|0,c|0,K|0,N()|0)|0,c=N()|0,(I|0)<=(y|0)){c=0;break}else y=y+1|0;return M=O,c|0}function R0(A,c,h,d){A=A|0,c=c|0,h=h|0,d=d|0;var p=0,m=0;p=_e(c|0,h|0,52)|0,N()|0,p=p&15,(c|0)==0&(h|0)==0|((d|0)>15|(p|0)>(d|0))?(d=-1,p=-1,c=0,h=0):(m=O3(c,h,p+1|0,d)|0,h=(N()|0)&-15728641,c=xe(d|0,0,52)|0,c=m|c,h=h|(N()|0),m=(Ot(c,h)|0)==0,d=m?-1:d),m=A,u[m>>2]=c,u[m+4>>2]=h,u[A+8>>2]=p,u[A+12>>2]=d}function P0(A){A=A|0;var c=0,h=0,d=0,p=0,m=0,y=0,b=0,w=0,E=0;if(h=A,c=u[h>>2]|0,h=u[h+4>>2]|0,!((c|0)==0&(h|0)==0)&&(d=_e(c|0,h|0,52)|0,N()|0,d=d&15,b=xe(1,0,(d^15)*3|0)|0,c=st(b|0,N()|0,c|0,h|0)|0,h=N()|0,b=A,u[b>>2]=c,u[b+4>>2]=h,b=A+8|0,y=u[b>>2]|0,!((d|0)<(y|0)))){for(w=A+12|0,m=d;;){if((m|0)==(y|0)){d=5;break}if(E=(m|0)==(u[w>>2]|0),p=(15-m|0)*3|0,d=_e(c|0,h|0,p|0)|0,N()|0,d=d&7,E&((d|0)==1&!0)){d=7;break}if(!((d|0)==7&!0)){d=10;break}if(E=xe(1,0,p|0)|0,c=st(c|0,h|0,E|0,N()|0)|0,h=N()|0,E=A,u[E>>2]=c,u[E+4>>2]=h,(m|0)>(y|0))m=m+-1|0;else{d=10;break}}if((d|0)==5){E=A,u[E>>2]=0,u[E+4>>2]=0,u[b>>2]=-1,u[w>>2]=-1;return}else if((d|0)==7){y=xe(1,0,p|0)|0,y=st(c|0,h|0,y|0,N()|0)|0,b=N()|0,E=A,u[E>>2]=y,u[E+4>>2]=b,u[w>>2]=m+-1;return}else if((d|0)==10)return}}function _o(A){A=+A;var c=0;return c=A<0?A+6.283185307179586:A,+(A>=6.283185307179586?c+-6.283185307179586:c)}function sr(A,c){return A=A|0,c=c|0,+it(+(+B[A>>3]-+B[c>>3]))<17453292519943298e-27?(c=+it(+(+B[A+8>>3]-+B[c+8>>3]))<17453292519943298e-27,c|0):(c=0,c|0)}function j3(A,c){A=A|0,c=c|0;var h=0,d=0,p=0,m=0;return p=+B[c>>3],d=+B[A>>3],m=+et(+((p-d)*.5)),h=+et(+((+B[c+8>>3]-+B[A+8>>3])*.5)),h=m*m+h*(+vt(+p)*+vt(+d)*h),+(+zn(+ +lt(+h),+ +lt(+(1-h)))*2)}function yo(A,c){A=A|0,c=c|0;var h=0,d=0,p=0,m=0;return p=+B[c>>3],d=+B[A>>3],m=+et(+((p-d)*.5)),h=+et(+((+B[c+8>>3]-+B[A+8>>3])*.5)),h=m*m+h*(+vt(+p)*+vt(+d)*h),+(+zn(+ +lt(+h),+ +lt(+(1-h)))*2*6371.007180918475)}function $3(A,c){A=A|0,c=c|0;var h=0,d=0,p=0,m=0;return p=+B[c>>3],d=+B[A>>3],m=+et(+((p-d)*.5)),h=+et(+((+B[c+8>>3]-+B[A+8>>3])*.5)),h=m*m+h*(+vt(+p)*+vt(+d)*h),+(+zn(+ +lt(+h),+ +lt(+(1-h)))*2*6371.007180918475*1e3)}function X3(A,c){A=A|0,c=c|0;var h=0,d=0,p=0,m=0,y=0;return m=+B[c>>3],d=+vt(+m),p=+B[c+8>>3]-+B[A+8>>3],y=d*+et(+p),h=+B[A>>3],+ +zn(+y,+(+et(+m)*+vt(+h)-+vt(+p)*(d*+et(+h))))}function Q3(A,c,h,d){A=A|0,c=+c,h=+h,d=d|0;var p=0,m=0,y=0,b=0;if(h<1e-16){u[d>>2]=u[A>>2],u[d+4>>2]=u[A+4>>2],u[d+8>>2]=u[A+8>>2],u[d+12>>2]=u[A+12>>2];return}m=c<0?c+6.283185307179586:c,m=c>=6.283185307179586?m+-6.283185307179586:m;do if(m<1e-16)c=+B[A>>3]+h,B[d>>3]=c,p=d;else{if(p=+it(+(m+-3.141592653589793))<1e-16,c=+B[A>>3],p){c=c-h,B[d>>3]=c,p=d;break}if(y=+vt(+h),h=+et(+h),c=y*+et(+c)+ +vt(+m)*(h*+vt(+c)),c=c>1?1:c,c=+Hw(+(c<-1?-1:c)),B[d>>3]=c,+it(+(c+-1.5707963267948966))<1e-16){B[d>>3]=1.5707963267948966,B[d+8>>3]=0;return}if(+it(+(c+1.5707963267948966))<1e-16){B[d>>3]=-1.5707963267948966,B[d+8>>3]=0;return}if(b=+vt(+c),m=h*+et(+m)/b,h=+B[A>>3],c=(y-+et(+c)*+et(+h))/+vt(+h)/b,y=m>1?1:m,c=c>1?1:c,c=+B[A+8>>3]+ +zn(+(y<-1?-1:y),+(c<-1?-1:c)),c>3.141592653589793)do c=c+-6.283185307179586;while(c>3.141592653589793);if(c<-3.141592653589793)do c=c+6.283185307179586;while(c<-3.141592653589793);B[d+8>>3]=c;return}while(!1);if(+it(+(c+-1.5707963267948966))<1e-16){B[p>>3]=1.5707963267948966,B[d+8>>3]=0;return}if(+it(+(c+1.5707963267948966))<1e-16){B[p>>3]=-1.5707963267948966,B[d+8>>3]=0;return}if(c=+B[A+8>>3],c>3.141592653589793)do c=c+-6.283185307179586;while(c>3.141592653589793);if(c<-3.141592653589793)do c=c+6.283185307179586;while(c<-3.141592653589793);B[d+8>>3]=c}function Y3(A,c){return A=A|0,c=c|0,A>>>0>15?(c=4,c|0):(B[c>>3]=+B[20528+(A<<3)>>3],c=0,c|0)}function K3(A,c){return A=A|0,c=c|0,A>>>0>15?(c=4,c|0):(B[c>>3]=+B[20656+(A<<3)>>3],c=0,c|0)}function q3(A,c){return A=A|0,c=c|0,A>>>0>15?(c=4,c|0):(B[c>>3]=+B[20784+(A<<3)>>3],c=0,c|0)}function J3(A,c){return A=A|0,c=c|0,A>>>0>15?(c=4,c|0):(B[c>>3]=+B[20912+(A<<3)>>3],c=0,c|0)}function VA(A,c){A=A|0,c=c|0;var h=0;return A>>>0>15?(c=4,c|0):(h=Gi(7,0,A,((A|0)<0)<<31>>31)|0,h=gn(h|0,N()|0,120,0)|0,A=N()|0,u[c>>2]=h|2,u[c+4>>2]=A,c=0,c|0)}function M0(A,c,h){A=A|0,c=c|0,h=h|0;var d=0,p=0,m=0,y=0,b=0,w=0,E=0,I=0,O=0,H=0;return H=+B[c>>3],I=+B[A>>3],w=+et(+((H-I)*.5)),m=+B[c+8>>3],E=+B[A+8>>3],y=+et(+((m-E)*.5)),b=+vt(+I),O=+vt(+H),y=w*w+y*(O*b*y),y=+zn(+ +lt(+y),+ +lt(+(1-y)))*2,w=+B[h>>3],H=+et(+((w-H)*.5)),d=+B[h+8>>3],m=+et(+((d-m)*.5)),p=+vt(+w),m=H*H+m*(O*p*m),m=+zn(+ +lt(+m),+ +lt(+(1-m)))*2,w=+et(+((I-w)*.5)),d=+et(+((E-d)*.5)),d=w*w+d*(b*p*d),d=+zn(+ +lt(+d),+ +lt(+(1-d)))*2,p=(y+m+d)*.5,+(+EA(+ +lt(+(+Vn(+(p*.5))*+Vn(+((p-y)*.5))*+Vn(+((p-m)*.5))*+Vn(+((p-d)*.5)))))*4)}function zA(A,c,h){A=A|0,c=c|0,h=h|0;var d=0,p=0,m=0,y=0,b=0;if(b=M,M=M+192|0,m=b+168|0,y=b,p=po(A,c,m)|0,p|0)return h=p,M=b,h|0;if(mo(A,c,y)|0&&ke(23313,22742,386,22751),c=u[y>>2]|0,(c|0)>0){if(d=+M0(y+8|0,y+8+(((c|0)!=1&1)<<4)|0,m)+0,(c|0)!=1){A=1;do p=A,A=A+1|0,d=d+ +M0(y+8+(p<<4)|0,y+8+(((A|0)%(c|0)|0)<<4)|0,m);while((A|0)<(c|0))}}else d=0;return B[h>>3]=d,h=0,M=b,h|0}function Z3(A,c,h){return A=A|0,c=c|0,h=h|0,A=zA(A,c,h)|0,A|0||(B[h>>3]=+B[h>>3]*6371.007180918475*6371.007180918475),A|0}function eE(A,c,h){return A=A|0,c=c|0,h=h|0,A=zA(A,c,h)|0,A|0||(B[h>>3]=+B[h>>3]*6371.007180918475*6371.007180918475*1e3*1e3),A|0}function tE(A,c,h){A=A|0,c=c|0,h=h|0;var d=0,p=0,m=0,y=0,b=0,w=0,E=0,I=0;if(b=M,M=M+176|0,y=b,A=Ia(A,c,y)|0,A|0)return y=A,M=b,y|0;if(B[h>>3]=0,A=u[y>>2]|0,(A|0)<=1)return y=0,M=b,y|0;c=A+-1|0,A=0,d=+B[y+8>>3],p=+B[y+16>>3],m=0;do A=A+1|0,E=d,d=+B[y+8+(A<<4)>>3],I=+et(+((d-E)*.5)),w=p,p=+B[y+8+(A<<4)+8>>3],w=+et(+((p-w)*.5)),w=I*I+w*(+vt(+d)*+vt(+E)*w),m=m+ +zn(+ +lt(+w),+ +lt(+(1-w)))*2;while((A|0)<(c|0));return B[h>>3]=m,y=0,M=b,y|0}function nE(A,c,h){A=A|0,c=c|0,h=h|0;var d=0,p=0,m=0,y=0,b=0,w=0,E=0,I=0;if(b=M,M=M+176|0,y=b,A=Ia(A,c,y)|0,A|0)return y=A,m=+B[h>>3],m=m*6371.007180918475,B[h>>3]=m,M=b,y|0;if(B[h>>3]=0,A=u[y>>2]|0,(A|0)<=1)return y=0,m=0,m=m*6371.007180918475,B[h>>3]=m,M=b,y|0;c=A+-1|0,A=0,d=+B[y+8>>3],p=+B[y+16>>3],m=0;do A=A+1|0,E=d,d=+B[y+8+(A<<4)>>3],I=+et(+((d-E)*.5)),w=p,p=+B[y+8+(A<<4)+8>>3],w=+et(+((p-w)*.5)),w=I*I+w*(+vt(+E)*+vt(+d)*w),m=m+ +zn(+ +lt(+w),+ +lt(+(1-w)))*2;while((A|0)!=(c|0));return B[h>>3]=m,y=0,I=m,I=I*6371.007180918475,B[h>>3]=I,M=b,y|0}function iE(A,c,h){A=A|0,c=c|0,h=h|0;var d=0,p=0,m=0,y=0,b=0,w=0,E=0,I=0;if(b=M,M=M+176|0,y=b,A=Ia(A,c,y)|0,A|0)return y=A,m=+B[h>>3],m=m*6371.007180918475,m=m*1e3,B[h>>3]=m,M=b,y|0;if(B[h>>3]=0,A=u[y>>2]|0,(A|0)<=1)return y=0,m=0,m=m*6371.007180918475,m=m*1e3,B[h>>3]=m,M=b,y|0;c=A+-1|0,A=0,d=+B[y+8>>3],p=+B[y+16>>3],m=0;do A=A+1|0,E=d,d=+B[y+8+(A<<4)>>3],I=+et(+((d-E)*.5)),w=p,p=+B[y+8+(A<<4)+8>>3],w=+et(+((p-w)*.5)),w=I*I+w*(+vt(+E)*+vt(+d)*w),m=m+ +zn(+ +lt(+w),+ +lt(+(1-w)))*2;while((A|0)!=(c|0));return B[h>>3]=m,y=0,I=m,I=I*6371.007180918475,I=I*1e3,B[h>>3]=I,M=b,y|0}function sE(A){A=A|0;var c=0,h=0,d=0;return c=_i(1,12)|0,c||ke(22832,22787,49,22845),h=A+4|0,d=u[h>>2]|0,d|0?(d=d+8|0,u[d>>2]=c,u[h>>2]=c,c|0):(u[A>>2]|0&&ke(22862,22787,61,22885),d=A,u[d>>2]=c,u[h>>2]=c,c|0)}function rE(A,c){A=A|0,c=c|0;var h=0,d=0;return d=mi(24)|0,d||ke(22899,22787,78,22913),u[d>>2]=u[c>>2],u[d+4>>2]=u[c+4>>2],u[d+8>>2]=u[c+8>>2],u[d+12>>2]=u[c+12>>2],u[d+16>>2]=0,c=A+4|0,h=u[c>>2]|0,h|0?(u[h+16>>2]=d,u[c>>2]=d,d|0):(u[A>>2]|0&&ke(22928,22787,82,22913),u[A>>2]=d,u[c>>2]=d,d|0)}function B0(A){A=A|0;var c=0,h=0,d=0,p=0;if(A)for(d=1;;){if(c=u[A>>2]|0,c|0)do{if(h=u[c>>2]|0,h|0)do p=h,h=u[h+16>>2]|0,je(p);while((h|0)!=0);p=c,c=u[c+8>>2]|0,je(p)}while((c|0)!=0);if(c=A,A=u[A+8>>2]|0,d||je(c),A)d=0;else break}}function oE(A){A=A|0;var c=0,h=0,d=0,p=0,m=0,y=0,b=0,w=0,E=0,I=0,O=0,H=0,G=0,V=0,K=0,ue=0,ce=0,ie=0,oe=0,Y=0,Re=0,De=0,Ee=0,Pe=0,mt=0,ot=0,ct=0,Ke=0,Ye=0,qe=0,Tt=0,$e=0;if(p=A+8|0,u[p>>2]|0)return $e=1,$e|0;if(d=u[A>>2]|0,!d)return $e=0,$e|0;c=d,h=0;do h=h+1|0,c=u[c+8>>2]|0;while((c|0)!=0);if(h>>>0<2)return $e=0,$e|0;qe=mi(h<<2)|0,qe||ke(22948,22787,317,22967),Ye=mi(h<<5)|0,Ye||ke(22989,22787,321,22967),u[A>>2]=0,De=A+4|0,u[De>>2]=0,u[p>>2]=0,h=0,Ke=0,Re=0,O=0;e:for(;;){if(I=u[d>>2]|0,I){m=0,y=I;do{if(w=+B[y+8>>3],c=y,y=u[y+16>>2]|0,E=(y|0)==0,p=E?I:y,b=+B[p+8>>3],+it(+(w-b))>3.141592653589793){$e=14;break}m=m+(b-w)*(+B[c>>3]+ +B[p>>3])}while(!E);if(($e|0)==14){$e=0,m=0,c=I;do Y=+B[c+8>>3],ct=c+16|0,ot=u[ct>>2]|0,ot=(ot|0)==0?I:ot,oe=+B[ot+8>>3],m=m+(+B[c>>3]+ +B[ot>>3])*((oe<0?oe+6.283185307179586:oe)-(Y<0?Y+6.283185307179586:Y)),c=u[((c|0)==0?d:ct)>>2]|0;while((c|0)!=0)}m>0?(u[qe+(Ke<<2)>>2]=d,Ke=Ke+1|0,p=Re,c=O):$e=19}else $e=19;if(($e|0)==19){$e=0;do if(h){if(c=h+8|0,u[c>>2]|0){$e=21;break e}if(h=_i(1,12)|0,!h){$e=23;break e}u[c>>2]=h,p=h+4|0,y=h,c=O}else if(O){p=De,y=O+8|0,c=d,h=A;break}else if(u[A>>2]|0){$e=27;break e}else{p=De,y=A,c=d,h=A;break}while(!1);if(u[y>>2]=d,u[p>>2]=d,y=Ye+(Re<<5)|0,E=u[d>>2]|0,E){for(I=Ye+(Re<<5)+8|0,B[I>>3]=17976931348623157e292,O=Ye+(Re<<5)+24|0,B[O>>3]=17976931348623157e292,B[y>>3]=-17976931348623157e292,H=Ye+(Re<<5)+16|0,B[H>>3]=-17976931348623157e292,ce=17976931348623157e292,ie=-17976931348623157e292,p=0,G=E,w=17976931348623157e292,K=17976931348623157e292,ue=-17976931348623157e292,b=-17976931348623157e292;m=+B[G>>3],Y=+B[G+8>>3],G=u[G+16>>2]|0,V=(G|0)==0,oe=+B[(V?E:G)+8>>3],m<w&&(B[I>>3]=m,w=m),Y<K&&(B[O>>3]=Y,K=Y),m>ue?B[y>>3]=m:m=ue,Y>b&&(B[H>>3]=Y,b=Y),ce=Y>0&Y<ce?Y:ce,ie=Y<0&Y>ie?Y:ie,p=p|+it(+(Y-oe))>3.141592653589793,!V;)ue=m;p&&(B[H>>3]=ie,B[O>>3]=ce)}else u[y>>2]=0,u[y+4>>2]=0,u[y+8>>2]=0,u[y+12>>2]=0,u[y+16>>2]=0,u[y+20>>2]=0,u[y+24>>2]=0,u[y+28>>2]=0;p=Re+1|0}if(ct=d+8|0,d=u[ct>>2]|0,u[ct>>2]=0,d)Re=p,O=c;else{$e=45;break}}if(($e|0)==21)ke(22765,22787,35,22799);else if(($e|0)==23)ke(22819,22787,37,22799);else if(($e|0)==27)ke(22862,22787,61,22885);else if(($e|0)==45){e:do if((Ke|0)>0){for(ct=(p|0)==0,mt=p<<2,ot=(A|0)==0,Pe=0,c=0;;){if(Ee=u[qe+(Pe<<2)>>2]|0,ct)$e=73;else{if(Re=mi(mt)|0,!Re){$e=50;break}if(De=mi(mt)|0,!De){$e=52;break}t:do if(ot)h=0;else{for(p=0,h=0,y=A;d=Ye+(p<<5)|0,O0(u[y>>2]|0,d,u[Ee>>2]|0)|0?(u[Re+(h<<2)>>2]=y,u[De+(h<<2)>>2]=d,V=h+1|0):V=h,y=u[y+8>>2]|0,y;)p=p+1|0,h=V;if((V|0)>0)if(d=u[Re>>2]|0,(V|0)==1)h=d;else for(H=0,G=-1,h=d,O=d;;){for(E=u[O>>2]|0,d=0,y=0;p=u[u[Re+(y<<2)>>2]>>2]|0,(p|0)==(E|0)?I=d:I=d+((O0(p,u[De+(y<<2)>>2]|0,u[E>>2]|0)|0)&1)|0,y=y+1|0,(y|0)!=(V|0);)d=I;if(p=(I|0)>(G|0),h=p?O:h,d=H+1|0,(d|0)==(V|0))break t;H=d,G=p?I:G,O=u[Re+(d<<2)>>2]|0}else h=0}while(!1);if(je(Re),je(De),h){if(p=h+4|0,d=u[p>>2]|0,d)h=d+8|0;else if(u[h>>2]|0){$e=70;break}u[h>>2]=Ee,u[p>>2]=Ee}else $e=73}if(($e|0)==73){if($e=0,c=u[Ee>>2]|0,c|0)do De=c,c=u[c+16>>2]|0,je(De);while((c|0)!=0);je(Ee),c=1}if(Pe=Pe+1|0,(Pe|0)>=(Ke|0)){Tt=c;break e}}($e|0)==50?ke(23004,22787,249,23023):($e|0)==52?ke(23042,22787,252,23023):($e|0)==70&&ke(22862,22787,61,22885)}else Tt=0;while(!1);return je(qe),je(Ye),$e=Tt,$e|0}return 0}function O0(A,c,h){A=A|0,c=c|0,h=h|0;var d=0,p=0,m=0,y=0,b=0,w=0,E=0,I=0;if(!(g0(c,h)|0)||(c=d0(c)|0,d=+B[h>>3],p=+B[h+8>>3],p=c&p<0?p+6.283185307179586:p,A=u[A>>2]|0,!A))return A=0,A|0;if(c){c=0,E=p,h=A;e:for(;;){for(;y=+B[h>>3],p=+B[h+8>>3],h=h+16|0,I=u[h>>2]|0,I=(I|0)==0?A:I,m=+B[I>>3],b=+B[I+8>>3],y>m?(w=y,y=b):(w=m,m=y,y=p,p=b),d=d==m|d==w?d+2220446049250313e-31:d,!!(d<m|d>w);)if(h=u[h>>2]|0,!h){h=22;break e}if(b=y<0?y+6.283185307179586:y,y=p<0?p+6.283185307179586:p,E=b==E|y==E?E+-2220446049250313e-31:E,w=b+(y-b)*((d-m)/(w-m)),(w<0?w+6.283185307179586:w)>E&&(c=c^1),h=u[h>>2]|0,!h){h=22;break}}if((h|0)==22)return c|0}else{c=0,E=p,h=A;e:for(;;){for(;y=+B[h>>3],p=+B[h+8>>3],h=h+16|0,I=u[h>>2]|0,I=(I|0)==0?A:I,m=+B[I>>3],b=+B[I+8>>3],y>m?(w=y,y=b):(w=m,m=y,y=p,p=b),d=d==m|d==w?d+2220446049250313e-31:d,!!(d<m|d>w);)if(h=u[h>>2]|0,!h){h=22;break e}if(E=y==E|p==E?E+-2220446049250313e-31:E,y+(p-y)*((d-m)/(w-m))>E&&(c=c^1),h=u[h>>2]|0,!h){h=22;break}}if((h|0)==22)return c|0}return 0}function Bi(A,c,h,d,p){A=A|0,c=c|0,h=h|0,d=d|0,p=p|0;var m=0,y=0,b=0,w=0,E=0,I=0,O=0,H=0,G=0,V=0,K=0,ue=0,ce=0,ie=0;if(ie=M,M=M+32|0,ce=ie+16|0,ue=ie,m=_e(A|0,c|0,52)|0,N()|0,m=m&15,G=_e(h|0,d|0,52)|0,N()|0,(m|0)!=(G&15|0))return ce=12,M=ie,ce|0;if(E=_e(A|0,c|0,45)|0,N()|0,E=E&127,I=_e(h|0,d|0,45)|0,N()|0,I=I&127,E>>>0>121|I>>>0>121)return ce=5,M=ie,ce|0;if(G=(E|0)!=(I|0),G){if(b=RA(E,I)|0,(b|0)==7)return ce=1,M=ie,ce|0;w=RA(I,E)|0,(w|0)==7?ke(23066,23090,161,23100):(V=b,y=w)}else V=0,y=0;O=Bt(E)|0,H=Bt(I)|0,u[ce>>2]=0,u[ce+4>>2]=0,u[ce+8>>2]=0,u[ce+12>>2]=0;do if(V){if(I=u[4272+(E*28|0)+(V<<2)>>2]|0,b=(I|0)>0,H)if(b){E=0,w=h,b=d;do w=U3(w,b)|0,b=N()|0,y=Hi(y)|0,(y|0)==1&&(y=Hi(1)|0),E=E+1|0;while((E|0)!=(I|0));I=y,E=w,w=b}else I=y,E=h,w=d;else if(b){E=0,w=h,b=d;do w=LA(w,b)|0,b=N()|0,y=Hi(y)|0,E=E+1|0;while((E|0)!=(I|0));I=y,E=w,w=b}else I=y,E=h,w=d;if(kA(E,w,ce)|0,G||ke(23115,23090,191,23100),b=(O|0)!=0,y=(H|0)!=0,b&y&&ke(23142,23090,192,23100),b){if(y=Sn(A,c)|0,(y|0)==7){m=5;break}if(He[21872+(y*7|0)+V>>0]|0){m=1;break}w=u[21040+(y*28|0)+(V<<2)>>2]|0,E=w}else if(y){if(y=Sn(E,w)|0,(y|0)==7){m=5;break}if(He[21872+(y*7|0)+I>>0]|0){m=1;break}E=0,w=u[21040+(I*28|0)+(y<<2)>>2]|0}else E=0,w=0;if((E|w|0)<0)m=5;else{if((w|0)>0){b=ce+4|0,y=0;do Sa(b),y=y+1|0;while((y|0)!=(w|0))}if(u[ue>>2]=0,u[ue+4>>2]=0,u[ue+8>>2]=0,y0(ue,V),m|0)for(;Hn(m)|0?Ca(ue):bs(ue),(m|0)>1;)m=m+-1|0;if((E|0)>0){m=0;do Sa(ue),m=m+1|0;while((m|0)!=(E|0))}K=ce+4|0,En(K,ue,K),fn(K),K=51}}else if(kA(h,d,ce)|0,(O|0)!=0&(H|0)!=0)if((I|0)!=(E|0)&&ke(23173,23090,261,23100),y=Sn(A,c)|0,m=Sn(h,d)|0,(y|0)==7|(m|0)==7)m=5;else if(He[21872+(y*7|0)+m>>0]|0)m=1;else if(y=u[21040+(y*28|0)+(m<<2)>>2]|0,(y|0)>0){b=ce+4|0,m=0;do Sa(b),m=m+1|0;while((m|0)!=(y|0));K=51}else K=51;else K=51;while(!1);return(K|0)==51&&(m=ce+4|0,u[p>>2]=u[m>>2],u[p+4>>2]=u[m+4>>2],u[p+8>>2]=u[m+8>>2],m=0),ce=m,M=ie,ce|0}function D0(A,c,h,d){A=A|0,c=c|0,h=h|0,d=d|0;var p=0,m=0,y=0,b=0,w=0,E=0,I=0,O=0,H=0,G=0,V=0,K=0,ue=0,ce=0,ie=0,oe=0;if(K=M,M=M+48|0,E=K+36|0,y=K+24|0,b=K+12|0,w=K,p=_e(A|0,c|0,52)|0,N()|0,p=p&15,H=_e(A|0,c|0,45)|0,N()|0,H=H&127,H>>>0>121)return d=5,M=K,d|0;if(I=Bt(H)|0,xe(p|0,0,52)|0,ue=N()|0|134225919,m=d,u[m>>2]=-1,u[m+4>>2]=ue,!p)return p=xa(h)|0,(p|0)==7||(p=IA(H,p)|0,(p|0)==127)?(ue=1,M=K,ue|0):(G=xe(p|0,0,45)|0,V=N()|0,H=d,V=u[H+4>>2]&-1040385|V,ue=d,u[ue>>2]=u[H>>2]|G,u[ue+4>>2]=V,ue=0,M=K,ue|0);for(u[E>>2]=u[h>>2],u[E+4>>2]=u[h+4>>2],u[E+8>>2]=u[h+8>>2],h=p;;){if(m=h,h=h+-1|0,u[y>>2]=u[E>>2],u[y+4>>2]=u[E+4>>2],u[y+8>>2]=u[E+8>>2],Hn(m)|0){if(p=f3(E)|0,p|0){h=13;break}u[b>>2]=u[E>>2],u[b+4>>2]=u[E+4>>2],u[b+8>>2]=u[E+8>>2],Ca(b)}else{if(p=d3(E)|0,p|0){h=13;break}u[b>>2]=u[E>>2],u[b+4>>2]=u[E+4>>2],u[b+8>>2]=u[E+8>>2],bs(b)}if(PA(y,b,w),fn(w),p=d,ie=u[p>>2]|0,p=u[p+4>>2]|0,oe=(15-m|0)*3|0,ce=xe(7,0,oe|0)|0,p=p&~(N()|0),oe=xe(xa(w)|0,0,oe|0)|0,p=N()|0|p,ue=d,u[ue>>2]=oe|ie&~ce,u[ue+4>>2]=p,(m|0)<=1){h=14;break}}e:do if((h|0)!=13&&(h|0)==14)if((u[E>>2]|0)<=1&&(u[E+4>>2]|0)<=1&&(u[E+8>>2]|0)<=1){h=xa(E)|0,p=IA(H,h)|0,(p|0)==127?w=0:w=Bt(p)|0;t:do if(h){if(I){if(p=Sn(A,c)|0,(p|0)==7){p=5;break e}if(m=u[21248+(p*28|0)+(h<<2)>>2]|0,(m|0)>0){p=h,h=0;do p=vs(p)|0,h=h+1|0;while((h|0)!=(m|0))}else p=h;if((p|0)==1){p=9;break e}h=IA(H,p)|0,(h|0)==127&&ke(23200,23090,411,23230),Bt(h)|0?ke(23245,23090,412,23230):(V=h,G=m,O=p)}else V=p,G=0,O=h;if(b=u[4272+(H*28|0)+(O<<2)>>2]|0,(b|0)<=-1&&ke(23276,23090,419,23230),!w){if((G|0)<0){p=5;break e}if(G|0){m=d,p=0,h=u[m>>2]|0,m=u[m+4>>2]|0;do h=Ts(h,m)|0,m=N()|0,oe=d,u[oe>>2]=h,u[oe+4>>2]=m,p=p+1|0;while((p|0)<(G|0))}if((b|0)<=0){p=V,h=58;break}for(m=d,p=0,h=u[m>>2]|0,m=u[m+4>>2]|0;;)if(h=Ts(h,m)|0,m=N()|0,oe=d,u[oe>>2]=h,u[oe+4>>2]=m,p=p+1|0,(p|0)==(b|0)){p=V,h=58;break t}}if(y=RA(V,H)|0,(y|0)==7&&ke(23066,23090,428,23230),p=d,h=u[p>>2]|0,p=u[p+4>>2]|0,(b|0)>0){m=0;do h=Ts(h,p)|0,p=N()|0,oe=d,u[oe>>2]=h,u[oe+4>>2]=p,m=m+1|0;while((m|0)!=(b|0))}if(p=Sn(h,p)|0,(p|0)==7&&ke(23313,23090,440,23230),h=SA(V)|0,h=u[(h?21664:21456)+(y*28|0)+(p<<2)>>2]|0,(h|0)<0&&ke(23313,23090,454,23230),!h)p=V,h=58;else{y=d,p=0,m=u[y>>2]|0,y=u[y+4>>2]|0;do m=FA(m,y)|0,y=N()|0,oe=d,u[oe>>2]=m,u[oe+4>>2]=y,p=p+1|0;while((p|0)<(h|0));p=V,h=58}}else if((I|0)!=0&(w|0)!=0){if(h=Sn(A,c)|0,m=d,m=Sn(u[m>>2]|0,u[m+4>>2]|0)|0,(h|0)==7|(m|0)==7){p=5;break e}if(m=u[21248+(h*28|0)+(m<<2)>>2]|0,(m|0)<0){p=5;break e}if(!m)h=59;else{b=d,h=0,y=u[b>>2]|0,b=u[b+4>>2]|0;do y=Ts(y,b)|0,b=N()|0,oe=d,u[oe>>2]=y,u[oe+4>>2]=b,h=h+1|0;while((h|0)<(m|0));h=58}}else h=58;while(!1);if((h|0)==58&&w&&(h=59),(h|0)==59&&(oe=d,(Sn(u[oe>>2]|0,u[oe+4>>2]|0)|0)==1)){p=9;break}oe=d,ce=u[oe>>2]|0,oe=u[oe+4>>2]&-1040385,ie=xe(p|0,0,45)|0,oe=oe|(N()|0),p=d,u[p>>2]=ce|ie,u[p+4>>2]=oe,p=0}else p=1;while(!1);return oe=p,M=K,oe|0}function aE(A,c,h,d,p,m){A=A|0,c=c|0,h=h|0,d=d|0,p=p|0,m=m|0;var y=0,b=0;return b=M,M=M+16|0,y=b,p?A=15:(A=Bi(A,c,h,d,y)|0,A||(p3(y,m),A=0)),M=b,A|0}function lE(A,c,h,d,p){A=A|0,c=c|0,h=h|0,d=d|0,p=p|0;var m=0,y=0;return y=M,M=M+16|0,m=y,d?h=15:(h=m3(h,m)|0,h||(h=D0(A,c,m,p)|0)),M=y,h|0}function cE(A,c,h,d,p){A=A|0,c=c|0,h=h|0,d=d|0,p=p|0;var m=0,y=0,b=0,w=0;return w=M,M=M+32|0,y=w+12|0,b=w,m=Bi(A,c,A,c,y)|0,m|0?(b=m,M=w,b|0):(A=Bi(A,c,h,d,b)|0,A|0?(b=A,M=w,b|0):(y=MA(y,b)|0,b=p,u[b>>2]=y,u[b+4>>2]=((y|0)<0)<<31>>31,b=0,M=w,b|0))}function AE(A,c,h,d,p){A=A|0,c=c|0,h=h|0,d=d|0,p=p|0;var m=0,y=0,b=0,w=0;return w=M,M=M+32|0,y=w+12|0,b=w,m=Bi(A,c,A,c,y)|0,!m&&(m=Bi(A,c,h,d,b)|0,!m)?(d=MA(y,b)|0,d=st(d|0,((d|0)<0)<<31>>31|0,1,0)|0,y=N()|0,b=p,u[b>>2]=d,u[b+4>>2]=y,b=0,M=w,b|0):(b=m,M=w,b|0)}function uE(A,c,h,d,p){A=A|0,c=c|0,h=h|0,d=d|0,p=p|0;var m=0,y=0,b=0,w=0,E=0,I=0,O=0,H=0,G=0,V=0,K=0,ue=0,ce=0,ie=0,oe=0,Y=0,Re=0,De=0,Ee=0,Pe=0;if(Ee=M,M=M+48|0,y=Ee+24|0,b=Ee+12|0,De=Ee,m=Bi(A,c,A,c,y)|0,!m&&(m=Bi(A,c,h,d,b)|0,!m)){Y=MA(y,b)|0,Re=((Y|0)<0)<<31>>31,u[y>>2]=0,u[y+4>>2]=0,u[y+8>>2]=0,u[b>>2]=0,u[b+4>>2]=0,u[b+8>>2]=0,Bi(A,c,A,c,y)|0&&ke(23313,23090,691,23299),Bi(A,c,h,d,b)|0&&ke(23313,23090,696,23299),w0(y),w0(b),Y?(O=u[y>>2]|0,V=+(Y|0),ce=y+4|0,H=u[ce>>2]|0,ie=y+8|0,G=u[ie>>2]|0,oe=y,d=O,m=H,h=G,K=+((u[b>>2]|0)-O|0)/V,ue=+((u[b+4>>2]|0)-H|0)/V,V=+((u[b+8>>2]|0)-G|0)/V):(m=y+4|0,h=y+8|0,ce=m,ie=h,oe=y,d=u[y>>2]|0,m=u[m>>2]|0,h=u[h>>2]|0,K=0,ue=0,V=0),u[De>>2]=d,G=De+4|0,u[G>>2]=m,H=De+8|0,u[H>>2]=h;e:do if((Y|0)<0)m=0;else for(I=0,O=0,m=d;;){E=+(O>>>0)+4294967296*+(I|0),Pe=K*E+ +(m|0),w=ue*E+ +(u[ce>>2]|0),E=V*E+ +(u[ie>>2]|0),h=~~+Ma(+Pe),y=~~+Ma(+w),m=~~+Ma(+E),Pe=+it(+(+(h|0)-Pe)),w=+it(+(+(y|0)-w)),E=+it(+(+(m|0)-E));do if(Pe>w&Pe>E)h=0-(y+m)|0,d=y;else if(b=0-h|0,w>E){d=b-m|0;break}else{d=y,m=b-y|0;break}while(!1);if(u[De>>2]=h,u[G>>2]=d,u[H>>2]=m,_3(De),m=D0(A,c,De,p+(O<<3)|0)|0,m|0)break e;if(!((I|0)<(Re|0)|(I|0)==(Re|0)&O>>>0<Y>>>0)){m=0;break e}m=st(O|0,I|0,1,0)|0,b=N()|0,I=b,O=m,m=u[oe>>2]|0}while(!1);return De=m,M=Ee,De|0}return De=m,M=Ee,De|0}function Gi(A,c,h,d){A=A|0,c=c|0,h=h|0,d=d|0;var p=0,m=0,y=0;if((h|0)==0&(d|0)==0)return p=0,m=1,tt(p|0),m|0;m=A,p=c,A=1,c=0;do y=(h&1|0)==0&!0,A=gn((y?1:m)|0,(y?0:p)|0,A|0,c|0)|0,c=N()|0,h=W0(h|0,d|0,1)|0,d=N()|0,m=gn(m|0,p|0,m|0,p|0)|0,p=N()|0;while(!((h|0)==0&(d|0)==0));return tt(c|0),A|0}function N0(A,c,h){A=A|0,c=c|0,h=h|0;var d=0,p=0,m=0,y=0,b=0,w=0,E=0,I=0,O=0,H=0;if(!(g0(c,h)|0)||(c=d0(c)|0,d=+B[h>>3],p=+B[h+8>>3],p=c&p<0?p+6.283185307179586:p,H=u[A>>2]|0,(H|0)<=0))return H=0,H|0;if(O=u[A+4>>2]|0,c){c=0,I=p,h=-1,A=0;e:for(;;){for(E=A;y=+B[O+(E<<4)>>3],p=+B[O+(E<<4)+8>>3],A=(h+2|0)%(H|0)|0,m=+B[O+(A<<4)>>3],b=+B[O+(A<<4)+8>>3],y>m?(w=y,y=b):(w=m,m=y,y=p,p=b),d=d==m|d==w?d+2220446049250313e-31:d,!!(d<m|d>w);)if(h=E+1|0,(h|0)>=(H|0)){h=22;break e}else A=E,E=h,h=A;if(b=y<0?y+6.283185307179586:y,y=p<0?p+6.283185307179586:p,I=b==I|y==I?I+-2220446049250313e-31:I,w=b+(y-b)*((d-m)/(w-m)),(w<0?w+6.283185307179586:w)>I&&(c=c^1),A=E+1|0,(A|0)>=(H|0)){h=22;break}else h=E}if((h|0)==22)return c|0}else{c=0,I=p,h=-1,A=0;e:for(;;){for(E=A;y=+B[O+(E<<4)>>3],p=+B[O+(E<<4)+8>>3],A=(h+2|0)%(H|0)|0,m=+B[O+(A<<4)>>3],b=+B[O+(A<<4)+8>>3],y>m?(w=y,y=b):(w=m,m=y,y=p,p=b),d=d==m|d==w?d+2220446049250313e-31:d,!!(d<m|d>w);)if(h=E+1|0,(h|0)>=(H|0)){h=22;break e}else A=E,E=h,h=A;if(I=y==I|p==I?I+-2220446049250313e-31:I,y+(p-y)*((d-m)/(w-m))>I&&(c=c^1),A=E+1|0,(A|0)>=(H|0)){h=22;break}else h=E}if((h|0)==22)return c|0}return 0}function F0(A,c){A=A|0,c=c|0;var h=0,d=0,p=0,m=0,y=0,b=0,w=0,E=0,I=0,O=0,H=0,G=0,V=0,K=0,ue=0,ce=0,ie=0;if(V=u[A>>2]|0,!V){u[c>>2]=0,u[c+4>>2]=0,u[c+8>>2]=0,u[c+12>>2]=0,u[c+16>>2]=0,u[c+20>>2]=0,u[c+24>>2]=0,u[c+28>>2]=0;return}if(K=c+8|0,B[K>>3]=17976931348623157e292,ue=c+24|0,B[ue>>3]=17976931348623157e292,B[c>>3]=-17976931348623157e292,ce=c+16|0,B[ce>>3]=-17976931348623157e292,!((V|0)<=0)){for(H=u[A+4>>2]|0,E=17976931348623157e292,I=-17976931348623157e292,O=0,A=-1,m=17976931348623157e292,y=17976931348623157e292,w=-17976931348623157e292,d=-17976931348623157e292,G=0;h=+B[H+(G<<4)>>3],b=+B[H+(G<<4)+8>>3],A=A+2|0,p=+B[H+(((A|0)==(V|0)?0:A)<<4)+8>>3],h<m&&(B[K>>3]=h,m=h),b<y&&(B[ue>>3]=b,y=b),h>w?B[c>>3]=h:h=w,b>d&&(B[ce>>3]=b,d=b),E=b>0&b<E?b:E,I=b<0&b>I?b:I,O=O|+it(+(b-p))>3.141592653589793,A=G+1|0,(A|0)!=(V|0);)ie=G,w=h,G=A,A=ie;O&&(B[ce>>3]=I,B[ue>>3]=E)}}function hE(A,c){A=A|0,c=c|0;var h=0,d=0,p=0,m=0,y=0,b=0,w=0,E=0,I=0,O=0,H=0,G=0,V=0,K=0,ue=0,ce=0,ie=0,oe=0,Y=0,Re=0,De=0,Ee=0;if(V=u[A>>2]|0,V){if(K=c+8|0,B[K>>3]=17976931348623157e292,ue=c+24|0,B[ue>>3]=17976931348623157e292,B[c>>3]=-17976931348623157e292,ce=c+16|0,B[ce>>3]=-17976931348623157e292,(V|0)>0){for(p=u[A+4>>2]|0,H=17976931348623157e292,G=-17976931348623157e292,d=0,h=-1,w=17976931348623157e292,E=17976931348623157e292,O=-17976931348623157e292,y=-17976931348623157e292,ie=0;m=+B[p+(ie<<4)>>3],I=+B[p+(ie<<4)+8>>3],De=h+2|0,b=+B[p+(((De|0)==(V|0)?0:De)<<4)+8>>3],m<w&&(B[K>>3]=m,w=m),I<E&&(B[ue>>3]=I,E=I),m>O?B[c>>3]=m:m=O,I>y&&(B[ce>>3]=I,y=I),H=I>0&I<H?I:H,G=I<0&I>G?I:G,d=d|+it(+(I-b))>3.141592653589793,h=ie+1|0,(h|0)!=(V|0);)De=ie,O=m,ie=h,h=De;d&&(B[ce>>3]=G,B[ue>>3]=H)}}else u[c>>2]=0,u[c+4>>2]=0,u[c+8>>2]=0,u[c+12>>2]=0,u[c+16>>2]=0,u[c+20>>2]=0,u[c+24>>2]=0,u[c+28>>2]=0;if(De=A+8|0,h=u[De>>2]|0,!((h|0)<=0)){Re=A+12|0,Y=0;do if(p=u[Re>>2]|0,d=Y,Y=Y+1|0,ue=c+(Y<<5)|0,ce=u[p+(d<<3)>>2]|0,ce){if(ie=c+(Y<<5)+8|0,B[ie>>3]=17976931348623157e292,A=c+(Y<<5)+24|0,B[A>>3]=17976931348623157e292,B[ue>>3]=-17976931348623157e292,oe=c+(Y<<5)+16|0,B[oe>>3]=-17976931348623157e292,(ce|0)>0){for(V=u[p+(d<<3)+4>>2]|0,H=17976931348623157e292,G=-17976931348623157e292,p=0,d=-1,K=0,w=17976931348623157e292,E=17976931348623157e292,I=-17976931348623157e292,y=-17976931348623157e292;m=+B[V+(K<<4)>>3],O=+B[V+(K<<4)+8>>3],d=d+2|0,b=+B[V+(((d|0)==(ce|0)?0:d)<<4)+8>>3],m<w&&(B[ie>>3]=m,w=m),O<E&&(B[A>>3]=O,E=O),m>I?B[ue>>3]=m:m=I,O>y&&(B[oe>>3]=O,y=O),H=O>0&O<H?O:H,G=O<0&O>G?O:G,p=p|+it(+(O-b))>3.141592653589793,d=K+1|0,(d|0)!=(ce|0);)Ee=K,K=d,I=m,d=Ee;p&&(B[oe>>3]=G,B[A>>3]=H)}}else u[ue>>2]=0,u[ue+4>>2]=0,u[ue+8>>2]=0,u[ue+12>>2]=0,u[ue+16>>2]=0,u[ue+20>>2]=0,u[ue+24>>2]=0,u[ue+28>>2]=0,h=u[De>>2]|0;while((Y|0)<(h|0))}}function fE(A,c,h){A=A|0,c=c|0,h=h|0;var d=0,p=0,m=0;if(!(N0(A,c,h)|0))return p=0,p|0;if(p=A+8|0,(u[p>>2]|0)<=0)return p=1,p|0;for(d=A+12|0,A=0;;){if(m=A,A=A+1|0,N0((u[d>>2]|0)+(m<<3)|0,c+(A<<5)|0,h)|0){A=0,d=6;break}if((A|0)>=(u[p>>2]|0)){A=1,d=6;break}}return(d|0)==6?A|0:0}function dE(){return 8}function gE(){return 16}function pE(){return 168}function mE(){return 8}function _E(){return 16}function yE(){return 12}function bE(){return 8}function vE(A){return A=A|0,+(+((u[A>>2]|0)>>>0)+4294967296*+(u[A+4>>2]|0))}function TE(A){A=A|0;var c=0,h=0;return h=+B[A>>3],c=+B[A+8>>3],+ +lt(+(h*h+c*c))}function L0(A,c,h,d,p){A=A|0,c=c|0,h=h|0,d=d|0,p=p|0;var m=0,y=0,b=0,w=0,E=0,I=0,O=0,H=0;E=+B[A>>3],w=+B[c>>3]-E,b=+B[A+8>>3],y=+B[c+8>>3]-b,O=+B[h>>3],m=+B[d>>3]-O,H=+B[h+8>>3],I=+B[d+8>>3]-H,m=(m*(b-H)-(E-O)*I)/(w*I-y*m),B[p>>3]=E+w*m,B[p+8>>3]=b+y*m}function k0(A,c){return A=A|0,c=c|0,+it(+(+B[A>>3]-+B[c>>3]))<11920928955078125e-23?(c=+it(+(+B[A+8>>3]-+B[c+8>>3]))<11920928955078125e-23,c|0):(c=0,c|0)}function jt(A,c){A=A|0,c=c|0;var h=0,d=0,p=0;return p=+B[A>>3]-+B[c>>3],d=+B[A+8>>3]-+B[c+8>>3],h=+B[A+16>>3]-+B[c+16>>3],+(p*p+d*d+h*h)}function wE(A,c){A=A|0,c=c|0;var h=0,d=0,p=0;h=+B[A>>3],d=+vt(+h),h=+et(+h),B[c+16>>3]=h,h=+B[A+8>>3],p=d*+vt(+h),B[c>>3]=p,h=d*+et(+h),B[c+8>>3]=h}function EE(A,c,h){A=A|0,c=c|0,h=h|0;var d=0,p=0,m=0;if(m=M,M=M+16|0,p=m,d=Ot(A,c)|0,(h+-1|0)>>>0>5||(d=(d|0)!=0,(h|0)==1&d))return p=-1,M=m,p|0;do if(bo(A,c,p)|0)d=-1;else if(d){d=((u[21936+(h<<2)>>2]|0)+5-(u[p>>2]|0)|0)%5|0;break}else{d=((u[21968+(h<<2)>>2]|0)+6-(u[p>>2]|0)|0)%6|0;break}while(!1);return p=d,M=m,p|0}function bo(A,c,h){A=A|0,c=c|0,h=h|0;var d=0,p=0,m=0,y=0,b=0,w=0,E=0;if(E=M,M=M+32|0,y=E+16|0,b=E,d=ir(A,c,y)|0,d|0)return h=d,M=E,h|0;m=C0(A,c)|0,w=Sn(A,c)|0,o3(m,b),d=a3(m,u[y>>2]|0)|0;e:do if(Bt(m)|0){do switch(m|0){case 4:{A=0;break}case 14:{A=1;break}case 24:{A=2;break}case 38:{A=3;break}case 49:{A=4;break}case 58:{A=5;break}case 63:{A=6;break}case 72:{A=7;break}case 83:{A=8;break}case 97:{A=9;break}case 107:{A=10;break}case 117:{A=11;break}default:{d=1;break e}}while(!1);if(p=u[22e3+(A*24|0)+8>>2]|0,c=u[22e3+(A*24|0)+16>>2]|0,A=u[y>>2]|0,(A|0)!=(u[b>>2]|0)&&(b=SA(m)|0,A=u[y>>2]|0,b|(A|0)==(c|0)&&(d=(d+1|0)%6|0)),(w|0)==3&(A|0)==(c|0)){d=(d+5|0)%6|0,p=22;break}(w|0)==5&(A|0)==(p|0)&&(d=(d+1|0)%6|0),p=22}else p=22;while(!1);return(p|0)==22&&(u[h>>2]=d,d=0),h=d,M=E,h|0}function Gn(A,c,h,d){A=A|0,c=c|0,h=h|0,d=d|0;var p=0,m=0,y=0,b=0,w=0,E=0,I=0,O=0,H=0,G=0,V=0,K=0,ue=0,ce=0,ie=0,oe=0;if(oe=M,M=M+32|0,ie=oe+24|0,ue=oe+20|0,V=oe+8|0,G=oe+16|0,H=oe,w=(Ot(A,c)|0)==0,w=w?6:5,I=_e(A|0,c|0,52)|0,N()|0,I=I&15,w>>>0<=h>>>0)return d=2,M=oe,d|0;O=(I|0)==0,!O&&(K=xe(7,0,(I^15)*3|0)|0,(K&A|0)==0&((N()|0)&c|0)==0)?p=h:m=4;e:do if((m|0)==4){if(p=(Ot(A,c)|0)!=0,((p?4:5)|0)<(h|0)||bo(A,c,ie)|0||(m=(u[ie>>2]|0)+h|0,p?p=22288+(((m|0)%5|0)<<2)|0:p=22320+(((m|0)%6|0)<<2)|0,K=u[p>>2]|0,(K|0)==7))return d=1,M=oe,d|0;u[ue>>2]=0,p=tn(A,c,K,ue,V)|0;do if(!p){if(b=V,E=u[b>>2]|0,b=u[b+4>>2]|0,y=b>>>0<c>>>0|(b|0)==(c|0)&E>>>0<A>>>0,m=y?E:A,y=y?b:c,!O&&(O=xe(7,0,(I^15)*3|0)|0,(E&O|0)==0&(b&(N()|0)|0)==0))p=h;else{if(b=(h+-1+w|0)%(w|0)|0,p=Ot(A,c)|0,(b|0)<0&&ke(23313,23315,245,23324),w=(p|0)!=0,((w?4:5)|0)<(b|0)&&ke(23313,23315,245,23324),bo(A,c,ie)|0&&ke(23313,23315,245,23324),p=(u[ie>>2]|0)+b|0,w?p=22288+(((p|0)%5|0)<<2)|0:p=22320+(((p|0)%6|0)<<2)|0,b=u[p>>2]|0,(b|0)==7&&ke(23313,23315,245,23324),u[G>>2]=0,p=tn(A,c,b,G,H)|0,p|0)break;E=H,w=u[E>>2]|0,E=u[E+4>>2]|0;do if(E>>>0<y>>>0|(E|0)==(y|0)&w>>>0<m>>>0){if(Ot(w,E)|0?m=CA(w,E,A,c)|0:m=u[22384+((((u[G>>2]|0)+(u[22352+(b<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,p=Ot(w,E)|0,(m+-1|0)>>>0>5){p=-1,m=w,y=E;break}if(p=(p|0)!=0,(m|0)==1&p){p=-1,m=w,y=E;break}do if(bo(w,E,ie)|0)p=-1;else if(p){p=((u[21936+(m<<2)>>2]|0)+5-(u[ie>>2]|0)|0)%5|0;break}else{p=((u[21968+(m<<2)>>2]|0)+6-(u[ie>>2]|0)|0)%6|0;break}while(!1);m=w,y=E}else p=h;while(!1);b=V,E=u[b>>2]|0,b=u[b+4>>2]|0}if((m|0)==(E|0)&(y|0)==(b|0)){if(w=(Ot(E,b)|0)!=0,w?A=CA(E,b,A,c)|0:A=u[22384+((((u[ue>>2]|0)+(u[22352+(K<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,p=Ot(E,b)|0,(A+-1|0)>>>0<=5&&(ce=(p|0)!=0,!((A|0)==1&ce)))do if(bo(E,b,ie)|0)p=-1;else if(ce){p=((u[21936+(A<<2)>>2]|0)+5-(u[ie>>2]|0)|0)%5|0;break}else{p=((u[21968+(A<<2)>>2]|0)+6-(u[ie>>2]|0)|0)%6|0;break}while(!1);else p=-1;p=p+1|0,p=(p|0)==6|w&(p|0)==5?0:p}c=y,A=m;break e}while(!1);return d=p,M=oe,d|0}while(!1);return ce=xe(p|0,0,56)|0,ie=N()|0|c&-2130706433|536870912,u[d>>2]=ce|A,u[d+4>>2]=ie,d=0,M=oe,d|0}function xE(A,c,h){A=A|0,c=c|0,h=h|0;var d=0,p=0,m=0;return m=(Ot(A,c)|0)==0,d=Gn(A,c,0,h)|0,p=(d|0)==0,m?!p||(d=Gn(A,c,1,h+8|0)|0,d|0)||(d=Gn(A,c,2,h+16|0)|0,d|0)||(d=Gn(A,c,3,h+24|0)|0,d|0)||(d=Gn(A,c,4,h+32|0)|0,d)?(m=d,m|0):Gn(A,c,5,h+40|0)|0:!p||(d=Gn(A,c,1,h+8|0)|0,d|0)||(d=Gn(A,c,2,h+16|0)|0,d|0)||(d=Gn(A,c,3,h+24|0)|0,d|0)||(d=Gn(A,c,4,h+32|0)|0,d|0)?(m=d,m|0):(m=h+40|0,u[m>>2]=0,u[m+4>>2]=0,m=0,m|0)}function CE(A,c,h){A=A|0,c=c|0,h=h|0;var d=0,p=0,m=0,y=0,b=0,w=0;return w=M,M=M+192|0,p=w,m=w+168|0,y=_e(A|0,c|0,56)|0,N()|0,y=y&7,b=c&-2130706433|134217728,d=ir(A,b,m)|0,d|0?(b=d,M=w,b|0):(c=_e(A|0,c|0,52)|0,N()|0,c=c&15,Ot(A,b)|0?BA(m,c,y,1,p):OA(m,c,y,1,p),b=p+8|0,u[h>>2]=u[b>>2],u[h+4>>2]=u[b+4>>2],u[h+8>>2]=u[b+8>>2],u[h+12>>2]=u[b+12>>2],b=0,M=w,b|0)}function SE(A,c){A=A|0,c=c|0;var h=0,d=0,p=0,m=0;return p=M,M=M+16|0,h=p,!(!0&(c&2013265920|0)==536870912)||(d=c&-2130706433|134217728,!(DA(A,d)|0))?(d=0,M=p,d|0):(m=_e(A|0,c|0,56)|0,N()|0,m=(Gn(A,d,m&7,h)|0)==0,d=h,d=m&((u[d>>2]|0)==(A|0)?(u[d+4>>2]|0)==(c|0):0)&1,M=p,d|0)}function U0(A,c,h){A=A|0,c=c|0,h=h|0;var d=0;(c|0)>0?(d=_i(c,4)|0,u[A>>2]=d,d||ke(23337,23360,40,23374)):u[A>>2]=0,u[A+4>>2]=c,u[A+8>>2]=0,u[A+12>>2]=h}function V0(A){A=A|0;var c=0,h=0,d=0,p=0,m=0,y=0,b=0;p=A+4|0,m=A+12|0,y=A+8|0;e:for(;;){for(h=u[p>>2]|0,c=0;;){if((c|0)>=(h|0))break e;if(d=u[A>>2]|0,b=u[d+(c<<2)>>2]|0,!b)c=c+1|0;else break}c=d+(~~(+it(+(+zi(10,+ +(15-(u[m>>2]|0)|0))*(+B[b>>3]+ +B[b+8>>3])))%+(h|0))>>>0<<2)|0,h=u[c>>2]|0;t:do if(h|0){if(d=b+32|0,(h|0)==(b|0))u[c>>2]=u[d>>2];else{if(h=h+32|0,c=u[h>>2]|0,!c)break;for(;(c|0)!=(b|0);)if(h=c+32|0,c=u[h>>2]|0,!c)break t;u[h>>2]=u[d>>2]}je(b),u[y>>2]=(u[y>>2]|0)+-1}while(!1)}je(u[A>>2]|0)}function z0(A){A=A|0;var c=0,h=0,d=0;for(d=u[A+4>>2]|0,h=0;;){if((h|0)>=(d|0)){c=0,h=4;break}if(c=u[(u[A>>2]|0)+(h<<2)>>2]|0,!c)h=h+1|0;else{h=4;break}}return(h|0)==4?c|0:0}function H0(A,c){A=A|0,c=c|0;var h=0,d=0,p=0,m=0;if(h=~~(+it(+(+zi(10,+ +(15-(u[A+12>>2]|0)|0))*(+B[c>>3]+ +B[c+8>>3])))%+(u[A+4>>2]|0))>>>0,h=(u[A>>2]|0)+(h<<2)|0,d=u[h>>2]|0,!d)return m=1,m|0;m=c+32|0;do if((d|0)!=(c|0)){if(h=u[d+32>>2]|0,!h)return m=1,m|0;for(p=h;;){if((p|0)==(c|0)){p=8;break}if(h=u[p+32>>2]|0,h)d=p,p=h;else{h=1,p=10;break}}if((p|0)==8){u[d+32>>2]=u[m>>2];break}else if((p|0)==10)return h|0}else u[h>>2]=u[m>>2];while(!1);return je(c),m=A+8|0,u[m>>2]=(u[m>>2]|0)+-1,m=0,m|0}function IE(A,c,h){A=A|0,c=c|0,h=h|0;var d=0,p=0,m=0,y=0;m=mi(40)|0,m||ke(23390,23360,98,23403),u[m>>2]=u[c>>2],u[m+4>>2]=u[c+4>>2],u[m+8>>2]=u[c+8>>2],u[m+12>>2]=u[c+12>>2],p=m+16|0,u[p>>2]=u[h>>2],u[p+4>>2]=u[h+4>>2],u[p+8>>2]=u[h+8>>2],u[p+12>>2]=u[h+12>>2],u[m+32>>2]=0,p=~~(+it(+(+zi(10,+ +(15-(u[A+12>>2]|0)|0))*(+B[c>>3]+ +B[c+8>>3])))%+(u[A+4>>2]|0))>>>0,p=(u[A>>2]|0)+(p<<2)|0,d=u[p>>2]|0;do if(!d)u[p>>2]=m;else{for(;!(sr(d,c)|0&&sr(d+16|0,h)|0);)if(p=u[d+32>>2]|0,d=(p|0)==0?d:p,!(u[d+32>>2]|0)){y=10;break}if((y|0)==10){u[d+32>>2]=m;break}return je(m),y=d,y|0}while(!1);return y=A+8|0,u[y>>2]=(u[y>>2]|0)+1,y=m,y|0}function RE(A,c,h){A=A|0,c=c|0,h=h|0;var d=0,p=0;if(p=~~(+it(+(+zi(10,+ +(15-(u[A+12>>2]|0)|0))*(+B[c>>3]+ +B[c+8>>3])))%+(u[A+4>>2]|0))>>>0,p=u[(u[A>>2]|0)+(p<<2)>>2]|0,!p)return h=0,h|0;if(!h){for(A=p;;){if(sr(A,c)|0){d=10;break}if(A=u[A+32>>2]|0,!A){A=0,d=10;break}}if((d|0)==10)return A|0}for(A=p;;){if(sr(A,c)|0&&sr(A+16|0,h)|0){d=10;break}if(A=u[A+32>>2]|0,!A){A=0,d=10;break}}return(d|0)==10?A|0:0}function PE(A,c){A=A|0,c=c|0;var h=0;if(h=~~(+it(+(+zi(10,+ +(15-(u[A+12>>2]|0)|0))*(+B[c>>3]+ +B[c+8>>3])))%+(u[A+4>>2]|0))>>>0,A=u[(u[A>>2]|0)+(h<<2)>>2]|0,!A)return h=0,h|0;for(;;){if(sr(A,c)|0){c=5;break}if(A=u[A+32>>2]|0,!A){A=0,c=5;break}}return(c|0)==5?A|0:0}function ME(){return 23424}function BE(A){return A=+A,+ +$0(+A)}function Wi(A){return A=+A,~~+BE(A)|0}function mi(A){A=A|0;var c=0,h=0,d=0,p=0,m=0,y=0,b=0,w=0,E=0,I=0,O=0,H=0,G=0,V=0,K=0,ue=0,ce=0,ie=0,oe=0,Y=0,Re=0;Re=M,M=M+16|0,H=Re;do if(A>>>0<245){if(E=A>>>0<11?16:A+11&-8,A=E>>>3,O=u[5857]|0,h=O>>>A,h&3|0)return c=(h&1^1)+A|0,A=23468+(c<<1<<2)|0,h=A+8|0,d=u[h>>2]|0,p=d+8|0,m=u[p>>2]|0,(m|0)==(A|0)?u[5857]=O&~(1<<c):(u[m+12>>2]=A,u[h>>2]=m),Y=c<<3,u[d+4>>2]=Y|3,Y=d+Y+4|0,u[Y>>2]=u[Y>>2]|1,Y=p,M=Re,Y|0;if(I=u[5859]|0,E>>>0>I>>>0){if(h|0)return c=2<<A,c=h<<A&(c|0-c),c=(c&0-c)+-1|0,b=c>>>12&16,c=c>>>b,h=c>>>5&8,c=c>>>h,m=c>>>2&4,c=c>>>m,A=c>>>1&2,c=c>>>A,d=c>>>1&1,d=(h|b|m|A|d)+(c>>>d)|0,c=23468+(d<<1<<2)|0,A=c+8|0,m=u[A>>2]|0,b=m+8|0,h=u[b>>2]|0,(h|0)==(c|0)?(A=O&~(1<<d),u[5857]=A):(u[h+12>>2]=c,u[A>>2]=h,A=O),Y=d<<3,y=Y-E|0,u[m+4>>2]=E|3,p=m+E|0,u[p+4>>2]=y|1,u[m+Y>>2]=y,I|0&&(d=u[5862]|0,c=I>>>3,h=23468+(c<<1<<2)|0,c=1<<c,A&c?(A=h+8|0,c=u[A>>2]|0):(u[5857]=A|c,c=h,A=h+8|0),u[A>>2]=d,u[c+12>>2]=d,u[d+8>>2]=c,u[d+12>>2]=h),u[5859]=y,u[5862]=p,Y=b,M=Re,Y|0;if(m=u[5858]|0,m){for(h=(m&0-m)+-1|0,p=h>>>12&16,h=h>>>p,d=h>>>5&8,h=h>>>d,y=h>>>2&4,h=h>>>y,b=h>>>1&2,h=h>>>b,w=h>>>1&1,w=u[23732+((d|p|y|b|w)+(h>>>w)<<2)>>2]|0,h=w,b=w,w=(u[w+4>>2]&-8)-E|0;A=u[h+16>>2]|0,!(!A&&(A=u[h+20>>2]|0,!A));)y=(u[A+4>>2]&-8)-E|0,p=y>>>0<w>>>0,h=A,b=p?A:b,w=p?y:w;if(y=b+E|0,y>>>0>b>>>0){p=u[b+24>>2]|0,c=u[b+12>>2]|0;do if((c|0)==(b|0)){if(A=b+20|0,c=u[A>>2]|0,!c&&(A=b+16|0,c=u[A>>2]|0,!c)){h=0;break}for(;;)if(d=c+20|0,h=u[d>>2]|0,h)c=h,A=d;else if(d=c+16|0,h=u[d>>2]|0,h)c=h,A=d;else break;u[A>>2]=0,h=c}else h=u[b+8>>2]|0,u[h+12>>2]=c,u[c+8>>2]=h,h=c;while(!1);do if(p|0){if(c=u[b+28>>2]|0,A=23732+(c<<2)|0,(b|0)==(u[A>>2]|0)){if(u[A>>2]=h,!h){u[5858]=m&~(1<<c);break}}else if(Y=p+16|0,u[((u[Y>>2]|0)==(b|0)?Y:p+20|0)>>2]=h,!h)break;u[h+24>>2]=p,c=u[b+16>>2]|0,c|0&&(u[h+16>>2]=c,u[c+24>>2]=h),c=u[b+20>>2]|0,c|0&&(u[h+20>>2]=c,u[c+24>>2]=h)}while(!1);return w>>>0<16?(Y=w+E|0,u[b+4>>2]=Y|3,Y=b+Y+4|0,u[Y>>2]=u[Y>>2]|1):(u[b+4>>2]=E|3,u[y+4>>2]=w|1,u[y+w>>2]=w,I|0&&(d=u[5862]|0,c=I>>>3,h=23468+(c<<1<<2)|0,c=1<<c,c&O?(A=h+8|0,c=u[A>>2]|0):(u[5857]=c|O,c=h,A=h+8|0),u[A>>2]=d,u[c+12>>2]=d,u[d+8>>2]=c,u[d+12>>2]=h),u[5859]=w,u[5862]=y),Y=b+8|0,M=Re,Y|0}else O=E}else O=E}else O=E}else if(A>>>0<=4294967231)if(A=A+11|0,E=A&-8,d=u[5858]|0,d){p=0-E|0,A=A>>>8,A?E>>>0>16777215?w=31:(O=(A+1048320|0)>>>16&8,K=A<<O,b=(K+520192|0)>>>16&4,K=K<<b,w=(K+245760|0)>>>16&2,w=14-(b|O|w)+(K<<w>>>15)|0,w=E>>>(w+7|0)&1|w<<1):w=0,h=u[23732+(w<<2)>>2]|0;e:do if(!h)h=0,A=0,K=61;else for(A=0,b=E<<((w|0)==31?0:25-(w>>>1)|0),m=0;;){if(y=(u[h+4>>2]&-8)-E|0,y>>>0<p>>>0)if(y)A=h,p=y;else{A=h,p=0,K=65;break e}if(K=u[h+20>>2]|0,h=u[h+16+(b>>>31<<2)>>2]|0,m=(K|0)==0|(K|0)==(h|0)?m:K,h)b=b<<1;else{h=m,K=61;break}}while(!1);if((K|0)==61){if((h|0)==0&(A|0)==0){if(A=2<<w,A=(A|0-A)&d,!A){O=E;break}O=(A&0-A)+-1|0,y=O>>>12&16,O=O>>>y,m=O>>>5&8,O=O>>>m,b=O>>>2&4,O=O>>>b,w=O>>>1&2,O=O>>>w,h=O>>>1&1,A=0,h=u[23732+((m|y|b|w|h)+(O>>>h)<<2)>>2]|0}h?K=65:(b=A,y=p)}if((K|0)==65)for(m=h;;)if(O=(u[m+4>>2]&-8)-E|0,h=O>>>0<p>>>0,p=h?O:p,A=h?m:A,h=u[m+16>>2]|0,h||(h=u[m+20>>2]|0),h)m=h;else{b=A,y=p;break}if((b|0)!=0&&y>>>0<((u[5859]|0)-E|0)>>>0&&(I=b+E|0,I>>>0>b>>>0)){m=u[b+24>>2]|0,c=u[b+12>>2]|0;do if((c|0)==(b|0)){if(A=b+20|0,c=u[A>>2]|0,!c&&(A=b+16|0,c=u[A>>2]|0,!c)){c=0;break}for(;;)if(p=c+20|0,h=u[p>>2]|0,h)c=h,A=p;else if(p=c+16|0,h=u[p>>2]|0,h)c=h,A=p;else break;u[A>>2]=0}else Y=u[b+8>>2]|0,u[Y+12>>2]=c,u[c+8>>2]=Y;while(!1);do if(m){if(A=u[b+28>>2]|0,h=23732+(A<<2)|0,(b|0)==(u[h>>2]|0)){if(u[h>>2]=c,!c){d=d&~(1<<A),u[5858]=d;break}}else if(Y=m+16|0,u[((u[Y>>2]|0)==(b|0)?Y:m+20|0)>>2]=c,!c)break;u[c+24>>2]=m,A=u[b+16>>2]|0,A|0&&(u[c+16>>2]=A,u[A+24>>2]=c),A=u[b+20>>2]|0,A&&(u[c+20>>2]=A,u[A+24>>2]=c)}while(!1);e:do if(y>>>0<16)Y=y+E|0,u[b+4>>2]=Y|3,Y=b+Y+4|0,u[Y>>2]=u[Y>>2]|1;else{if(u[b+4>>2]=E|3,u[I+4>>2]=y|1,u[I+y>>2]=y,c=y>>>3,y>>>0<256){h=23468+(c<<1<<2)|0,A=u[5857]|0,c=1<<c,A&c?(A=h+8|0,c=u[A>>2]|0):(u[5857]=A|c,c=h,A=h+8|0),u[A>>2]=I,u[c+12>>2]=I,u[I+8>>2]=c,u[I+12>>2]=h;break}if(c=y>>>8,c?y>>>0>16777215?h=31:(oe=(c+1048320|0)>>>16&8,Y=c<<oe,ie=(Y+520192|0)>>>16&4,Y=Y<<ie,h=(Y+245760|0)>>>16&2,h=14-(ie|oe|h)+(Y<<h>>>15)|0,h=y>>>(h+7|0)&1|h<<1):h=0,c=23732+(h<<2)|0,u[I+28>>2]=h,A=I+16|0,u[A+4>>2]=0,u[A>>2]=0,A=1<<h,!(d&A)){u[5858]=d|A,u[c>>2]=I,u[I+24>>2]=c,u[I+12>>2]=I,u[I+8>>2]=I;break}c=u[c>>2]|0;t:do if((u[c+4>>2]&-8|0)!=(y|0)){for(d=y<<((h|0)==31?0:25-(h>>>1)|0);h=c+16+(d>>>31<<2)|0,A=u[h>>2]|0,!!A;)if((u[A+4>>2]&-8|0)==(y|0)){c=A;break t}else d=d<<1,c=A;u[h>>2]=I,u[I+24>>2]=c,u[I+12>>2]=I,u[I+8>>2]=I;break e}while(!1);oe=c+8|0,Y=u[oe>>2]|0,u[Y+12>>2]=I,u[oe>>2]=I,u[I+8>>2]=Y,u[I+12>>2]=c,u[I+24>>2]=0}while(!1);return Y=b+8|0,M=Re,Y|0}else O=E}else O=E;else O=-1;while(!1);if(h=u[5859]|0,h>>>0>=O>>>0)return c=h-O|0,A=u[5862]|0,c>>>0>15?(Y=A+O|0,u[5862]=Y,u[5859]=c,u[Y+4>>2]=c|1,u[A+h>>2]=c,u[A+4>>2]=O|3):(u[5859]=0,u[5862]=0,u[A+4>>2]=h|3,Y=A+h+4|0,u[Y>>2]=u[Y>>2]|1),Y=A+8|0,M=Re,Y|0;if(y=u[5860]|0,y>>>0>O>>>0)return ie=y-O|0,u[5860]=ie,Y=u[5863]|0,oe=Y+O|0,u[5863]=oe,u[oe+4>>2]=ie|1,u[Y+4>>2]=O|3,Y=Y+8|0,M=Re,Y|0;if(u[5975]|0?A=u[5977]|0:(u[5977]=4096,u[5976]=4096,u[5978]=-1,u[5979]=-1,u[5980]=0,u[5968]=0,u[5975]=H&-16^1431655768,A=4096),b=O+48|0,w=O+47|0,m=A+w|0,p=0-A|0,E=m&p,E>>>0<=O>>>0||(A=u[5967]|0,A|0&&(I=u[5965]|0,H=I+E|0,H>>>0<=I>>>0|H>>>0>A>>>0)))return Y=0,M=Re,Y|0;e:do if(u[5968]&4)c=0,K=143;else{h=u[5863]|0;t:do if(h){for(d=23876;H=u[d>>2]|0,!(H>>>0<=h>>>0&&(H+(u[d+4>>2]|0)|0)>>>0>h>>>0);)if(A=u[d+8>>2]|0,A)d=A;else{K=128;break t}if(c=m-y&p,c>>>0<2147483647)if(A=ji(c|0)|0,(A|0)==((u[d>>2]|0)+(u[d+4>>2]|0)|0)){if((A|0)!=-1){y=c,m=A,K=145;break e}}else d=A,K=136;else c=0}else K=128;while(!1);do if((K|0)==128)if(h=ji(0)|0,(h|0)!=-1&&(c=h,G=u[5976]|0,V=G+-1|0,c=((V&c|0)==0?0:(V+c&0-G)-c|0)+E|0,G=u[5965]|0,V=c+G|0,c>>>0>O>>>0&c>>>0<2147483647)){if(H=u[5967]|0,H|0&&V>>>0<=G>>>0|V>>>0>H>>>0){c=0;break}if(A=ji(c|0)|0,(A|0)==(h|0)){y=c,m=h,K=145;break e}else d=A,K=136}else c=0;while(!1);do if((K|0)==136){if(h=0-c|0,!(b>>>0>c>>>0&(c>>>0<2147483647&(d|0)!=-1)))if((d|0)==-1){c=0;break}else{y=c,m=d,K=145;break e}if(A=u[5977]|0,A=w-c+A&0-A,A>>>0>=2147483647){y=c,m=d,K=145;break e}if((ji(A|0)|0)==-1){ji(h|0)|0,c=0;break}else{y=A+c|0,m=d,K=145;break e}}while(!1);u[5968]=u[5968]|4,K=143}while(!1);if((K|0)==143&&E>>>0<2147483647&&(ie=ji(E|0)|0,V=ji(0)|0,ue=V-ie|0,ce=ue>>>0>(O+40|0)>>>0,!((ie|0)==-1|ce^1|ie>>>0<V>>>0&((ie|0)!=-1&(V|0)!=-1)^1))&&(y=ce?ue:c,m=ie,K=145),(K|0)==145){c=(u[5965]|0)+y|0,u[5965]=c,c>>>0>(u[5966]|0)>>>0&&(u[5966]=c),w=u[5863]|0;e:do if(w){for(c=23876;;){if(A=u[c>>2]|0,h=u[c+4>>2]|0,(m|0)==(A+h|0)){K=154;break}if(d=u[c+8>>2]|0,d)c=d;else break}if((K|0)==154&&(oe=c+4|0,(u[c+12>>2]&8|0)==0)&&m>>>0>w>>>0&A>>>0<=w>>>0){u[oe>>2]=h+y,Y=(u[5860]|0)+y|0,ie=w+8|0,ie=(ie&7|0)==0?0:0-ie&7,oe=w+ie|0,ie=Y-ie|0,u[5863]=oe,u[5860]=ie,u[oe+4>>2]=ie|1,u[w+Y+4>>2]=40,u[5864]=u[5979];break}for(m>>>0<(u[5861]|0)>>>0&&(u[5861]=m),h=m+y|0,c=23876;;){if((u[c>>2]|0)==(h|0)){K=162;break}if(A=u[c+8>>2]|0,A)c=A;else break}if((K|0)==162&&(u[c+12>>2]&8|0)==0){u[c>>2]=m,I=c+4|0,u[I>>2]=(u[I>>2]|0)+y,I=m+8|0,I=m+((I&7|0)==0?0:0-I&7)|0,c=h+8|0,c=h+((c&7|0)==0?0:0-c&7)|0,E=I+O|0,b=c-I-O|0,u[I+4>>2]=O|3;t:do if((w|0)==(c|0))Y=(u[5860]|0)+b|0,u[5860]=Y,u[5863]=E,u[E+4>>2]=Y|1;else{if((u[5862]|0)==(c|0)){Y=(u[5859]|0)+b|0,u[5859]=Y,u[5862]=E,u[E+4>>2]=Y|1,u[E+Y>>2]=Y;break}if(A=u[c+4>>2]|0,(A&3|0)==1){y=A&-8,d=A>>>3;n:do if(A>>>0<256)if(A=u[c+8>>2]|0,h=u[c+12>>2]|0,(h|0)==(A|0)){u[5857]=u[5857]&~(1<<d);break}else{u[A+12>>2]=h,u[h+8>>2]=A;break}else{m=u[c+24>>2]|0,A=u[c+12>>2]|0;do if((A|0)==(c|0)){if(h=c+16|0,d=h+4|0,A=u[d>>2]|0,A)h=d;else if(A=u[h>>2]|0,!A){A=0;break}for(;;)if(p=A+20|0,d=u[p>>2]|0,d)A=d,h=p;else if(p=A+16|0,d=u[p>>2]|0,d)A=d,h=p;else break;u[h>>2]=0}else Y=u[c+8>>2]|0,u[Y+12>>2]=A,u[A+8>>2]=Y;while(!1);if(!m)break;h=u[c+28>>2]|0,d=23732+(h<<2)|0;do if((u[d>>2]|0)!=(c|0)){if(Y=m+16|0,u[((u[Y>>2]|0)==(c|0)?Y:m+20|0)>>2]=A,!A)break n}else{if(u[d>>2]=A,A|0)break;u[5858]=u[5858]&~(1<<h);break n}while(!1);if(u[A+24>>2]=m,h=c+16|0,d=u[h>>2]|0,d|0&&(u[A+16>>2]=d,u[d+24>>2]=A),h=u[h+4>>2]|0,!h)break;u[A+20>>2]=h,u[h+24>>2]=A}while(!1);c=c+y|0,p=y+b|0}else p=b;if(c=c+4|0,u[c>>2]=u[c>>2]&-2,u[E+4>>2]=p|1,u[E+p>>2]=p,c=p>>>3,p>>>0<256){h=23468+(c<<1<<2)|0,A=u[5857]|0,c=1<<c,A&c?(A=h+8|0,c=u[A>>2]|0):(u[5857]=A|c,c=h,A=h+8|0),u[A>>2]=E,u[c+12>>2]=E,u[E+8>>2]=c,u[E+12>>2]=h;break}c=p>>>8;do if(!c)d=0;else{if(p>>>0>16777215){d=31;break}oe=(c+1048320|0)>>>16&8,Y=c<<oe,ie=(Y+520192|0)>>>16&4,Y=Y<<ie,d=(Y+245760|0)>>>16&2,d=14-(ie|oe|d)+(Y<<d>>>15)|0,d=p>>>(d+7|0)&1|d<<1}while(!1);if(c=23732+(d<<2)|0,u[E+28>>2]=d,A=E+16|0,u[A+4>>2]=0,u[A>>2]=0,A=u[5858]|0,h=1<<d,!(A&h)){u[5858]=A|h,u[c>>2]=E,u[E+24>>2]=c,u[E+12>>2]=E,u[E+8>>2]=E;break}c=u[c>>2]|0;n:do if((u[c+4>>2]&-8|0)!=(p|0)){for(d=p<<((d|0)==31?0:25-(d>>>1)|0);h=c+16+(d>>>31<<2)|0,A=u[h>>2]|0,!!A;)if((u[A+4>>2]&-8|0)==(p|0)){c=A;break n}else d=d<<1,c=A;u[h>>2]=E,u[E+24>>2]=c,u[E+12>>2]=E,u[E+8>>2]=E;break t}while(!1);oe=c+8|0,Y=u[oe>>2]|0,u[Y+12>>2]=E,u[oe>>2]=E,u[E+8>>2]=Y,u[E+12>>2]=c,u[E+24>>2]=0}while(!1);return Y=I+8|0,M=Re,Y|0}for(c=23876;A=u[c>>2]|0,!(A>>>0<=w>>>0&&(Y=A+(u[c+4>>2]|0)|0,Y>>>0>w>>>0));)c=u[c+8>>2]|0;p=Y+-47|0,A=p+8|0,A=p+((A&7|0)==0?0:0-A&7)|0,p=w+16|0,A=A>>>0<p>>>0?w:A,c=A+8|0,h=y+-40|0,ie=m+8|0,ie=(ie&7|0)==0?0:0-ie&7,oe=m+ie|0,ie=h-ie|0,u[5863]=oe,u[5860]=ie,u[oe+4>>2]=ie|1,u[m+h+4>>2]=40,u[5864]=u[5979],h=A+4|0,u[h>>2]=27,u[c>>2]=u[5969],u[c+4>>2]=u[5970],u[c+8>>2]=u[5971],u[c+12>>2]=u[5972],u[5969]=m,u[5970]=y,u[5972]=0,u[5971]=c,c=A+24|0;do oe=c,c=c+4|0,u[c>>2]=7;while((oe+8|0)>>>0<Y>>>0);if((A|0)!=(w|0)){if(m=A-w|0,u[h>>2]=u[h>>2]&-2,u[w+4>>2]=m|1,u[A>>2]=m,c=m>>>3,m>>>0<256){h=23468+(c<<1<<2)|0,A=u[5857]|0,c=1<<c,A&c?(A=h+8|0,c=u[A>>2]|0):(u[5857]=A|c,c=h,A=h+8|0),u[A>>2]=w,u[c+12>>2]=w,u[w+8>>2]=c,u[w+12>>2]=h;break}if(c=m>>>8,c?m>>>0>16777215?d=31:(oe=(c+1048320|0)>>>16&8,Y=c<<oe,ie=(Y+520192|0)>>>16&4,Y=Y<<ie,d=(Y+245760|0)>>>16&2,d=14-(ie|oe|d)+(Y<<d>>>15)|0,d=m>>>(d+7|0)&1|d<<1):d=0,h=23732+(d<<2)|0,u[w+28>>2]=d,u[w+20>>2]=0,u[p>>2]=0,c=u[5858]|0,A=1<<d,!(c&A)){u[5858]=c|A,u[h>>2]=w,u[w+24>>2]=h,u[w+12>>2]=w,u[w+8>>2]=w;break}c=u[h>>2]|0;t:do if((u[c+4>>2]&-8|0)!=(m|0)){for(d=m<<((d|0)==31?0:25-(d>>>1)|0);h=c+16+(d>>>31<<2)|0,A=u[h>>2]|0,!!A;)if((u[A+4>>2]&-8|0)==(m|0)){c=A;break t}else d=d<<1,c=A;u[h>>2]=w,u[w+24>>2]=c,u[w+12>>2]=w,u[w+8>>2]=w;break e}while(!1);oe=c+8|0,Y=u[oe>>2]|0,u[Y+12>>2]=w,u[oe>>2]=w,u[w+8>>2]=Y,u[w+12>>2]=c,u[w+24>>2]=0}}else Y=u[5861]|0,(Y|0)==0|m>>>0<Y>>>0&&(u[5861]=m),u[5969]=m,u[5970]=y,u[5972]=0,u[5866]=u[5975],u[5865]=-1,u[5870]=23468,u[5869]=23468,u[5872]=23476,u[5871]=23476,u[5874]=23484,u[5873]=23484,u[5876]=23492,u[5875]=23492,u[5878]=23500,u[5877]=23500,u[5880]=23508,u[5879]=23508,u[5882]=23516,u[5881]=23516,u[5884]=23524,u[5883]=23524,u[5886]=23532,u[5885]=23532,u[5888]=23540,u[5887]=23540,u[5890]=23548,u[5889]=23548,u[5892]=23556,u[5891]=23556,u[5894]=23564,u[5893]=23564,u[5896]=23572,u[5895]=23572,u[5898]=23580,u[5897]=23580,u[5900]=23588,u[5899]=23588,u[5902]=23596,u[5901]=23596,u[5904]=23604,u[5903]=23604,u[5906]=23612,u[5905]=23612,u[5908]=23620,u[5907]=23620,u[5910]=23628,u[5909]=23628,u[5912]=23636,u[5911]=23636,u[5914]=23644,u[5913]=23644,u[5916]=23652,u[5915]=23652,u[5918]=23660,u[5917]=23660,u[5920]=23668,u[5919]=23668,u[5922]=23676,u[5921]=23676,u[5924]=23684,u[5923]=23684,u[5926]=23692,u[5925]=23692,u[5928]=23700,u[5927]=23700,u[5930]=23708,u[5929]=23708,u[5932]=23716,u[5931]=23716,Y=y+-40|0,ie=m+8|0,ie=(ie&7|0)==0?0:0-ie&7,oe=m+ie|0,ie=Y-ie|0,u[5863]=oe,u[5860]=ie,u[oe+4>>2]=ie|1,u[m+Y+4>>2]=40,u[5864]=u[5979];while(!1);if(c=u[5860]|0,c>>>0>O>>>0)return ie=c-O|0,u[5860]=ie,Y=u[5863]|0,oe=Y+O|0,u[5863]=oe,u[oe+4>>2]=ie|1,u[Y+4>>2]=O|3,Y=Y+8|0,M=Re,Y|0}return Y=ME()|0,u[Y>>2]=12,Y=0,M=Re,Y|0}function je(A){A=A|0;var c=0,h=0,d=0,p=0,m=0,y=0,b=0,w=0;if(A){h=A+-8|0,p=u[5861]|0,A=u[A+-4>>2]|0,c=A&-8,w=h+c|0;do if(A&1)b=h,y=h;else{if(d=u[h>>2]|0,!(A&3)||(y=h+(0-d)|0,m=d+c|0,y>>>0<p>>>0))return;if((u[5862]|0)==(y|0)){if(A=w+4|0,c=u[A>>2]|0,(c&3|0)!=3){b=y,c=m;break}u[5859]=m,u[A>>2]=c&-2,u[y+4>>2]=m|1,u[y+m>>2]=m;return}if(h=d>>>3,d>>>0<256)if(A=u[y+8>>2]|0,c=u[y+12>>2]|0,(c|0)==(A|0)){u[5857]=u[5857]&~(1<<h),b=y,c=m;break}else{u[A+12>>2]=c,u[c+8>>2]=A,b=y,c=m;break}p=u[y+24>>2]|0,A=u[y+12>>2]|0;do if((A|0)==(y|0)){if(c=y+16|0,h=c+4|0,A=u[h>>2]|0,A)c=h;else if(A=u[c>>2]|0,!A){A=0;break}for(;;)if(d=A+20|0,h=u[d>>2]|0,h)A=h,c=d;else if(d=A+16|0,h=u[d>>2]|0,h)A=h,c=d;else break;u[c>>2]=0}else b=u[y+8>>2]|0,u[b+12>>2]=A,u[A+8>>2]=b;while(!1);if(p){if(c=u[y+28>>2]|0,h=23732+(c<<2)|0,(u[h>>2]|0)==(y|0)){if(u[h>>2]=A,!A){u[5858]=u[5858]&~(1<<c),b=y,c=m;break}}else if(b=p+16|0,u[((u[b>>2]|0)==(y|0)?b:p+20|0)>>2]=A,!A){b=y,c=m;break}u[A+24>>2]=p,c=y+16|0,h=u[c>>2]|0,h|0&&(u[A+16>>2]=h,u[h+24>>2]=A),c=u[c+4>>2]|0,c?(u[A+20>>2]=c,u[c+24>>2]=A,b=y,c=m):(b=y,c=m)}else b=y,c=m}while(!1);if(!(y>>>0>=w>>>0)&&(A=w+4|0,d=u[A>>2]|0,!!(d&1))){if(d&2)u[A>>2]=d&-2,u[b+4>>2]=c|1,u[y+c>>2]=c,p=c;else{if((u[5863]|0)==(w|0)){if(w=(u[5860]|0)+c|0,u[5860]=w,u[5863]=b,u[b+4>>2]=w|1,(b|0)!=(u[5862]|0))return;u[5862]=0,u[5859]=0;return}if((u[5862]|0)==(w|0)){w=(u[5859]|0)+c|0,u[5859]=w,u[5862]=y,u[b+4>>2]=w|1,u[y+w>>2]=w;return}p=(d&-8)+c|0,h=d>>>3;do if(d>>>0<256)if(c=u[w+8>>2]|0,A=u[w+12>>2]|0,(A|0)==(c|0)){u[5857]=u[5857]&~(1<<h);break}else{u[c+12>>2]=A,u[A+8>>2]=c;break}else{m=u[w+24>>2]|0,A=u[w+12>>2]|0;do if((A|0)==(w|0)){if(c=w+16|0,h=c+4|0,A=u[h>>2]|0,A)c=h;else if(A=u[c>>2]|0,!A){h=0;break}for(;;)if(d=A+20|0,h=u[d>>2]|0,h)A=h,c=d;else if(d=A+16|0,h=u[d>>2]|0,h)A=h,c=d;else break;u[c>>2]=0,h=A}else h=u[w+8>>2]|0,u[h+12>>2]=A,u[A+8>>2]=h,h=A;while(!1);if(m|0){if(A=u[w+28>>2]|0,c=23732+(A<<2)|0,(u[c>>2]|0)==(w|0)){if(u[c>>2]=h,!h){u[5858]=u[5858]&~(1<<A);break}}else if(d=m+16|0,u[((u[d>>2]|0)==(w|0)?d:m+20|0)>>2]=h,!h)break;u[h+24>>2]=m,A=w+16|0,c=u[A>>2]|0,c|0&&(u[h+16>>2]=c,u[c+24>>2]=h),A=u[A+4>>2]|0,A|0&&(u[h+20>>2]=A,u[A+24>>2]=h)}}while(!1);if(u[b+4>>2]=p|1,u[y+p>>2]=p,(b|0)==(u[5862]|0)){u[5859]=p;return}}if(A=p>>>3,p>>>0<256){h=23468+(A<<1<<2)|0,c=u[5857]|0,A=1<<A,c&A?(c=h+8|0,A=u[c>>2]|0):(u[5857]=c|A,A=h,c=h+8|0),u[c>>2]=b,u[A+12>>2]=b,u[b+8>>2]=A,u[b+12>>2]=h;return}A=p>>>8,A?p>>>0>16777215?d=31:(y=(A+1048320|0)>>>16&8,w=A<<y,m=(w+520192|0)>>>16&4,w=w<<m,d=(w+245760|0)>>>16&2,d=14-(m|y|d)+(w<<d>>>15)|0,d=p>>>(d+7|0)&1|d<<1):d=0,A=23732+(d<<2)|0,u[b+28>>2]=d,u[b+20>>2]=0,u[b+16>>2]=0,c=u[5858]|0,h=1<<d;e:do if(!(c&h))u[5858]=c|h,u[A>>2]=b,u[b+24>>2]=A,u[b+12>>2]=b,u[b+8>>2]=b;else{A=u[A>>2]|0;t:do if((u[A+4>>2]&-8|0)!=(p|0)){for(d=p<<((d|0)==31?0:25-(d>>>1)|0);h=A+16+(d>>>31<<2)|0,c=u[h>>2]|0,!!c;)if((u[c+4>>2]&-8|0)==(p|0)){A=c;break t}else d=d<<1,A=c;u[h>>2]=b,u[b+24>>2]=A,u[b+12>>2]=b,u[b+8>>2]=b;break e}while(!1);y=A+8|0,w=u[y>>2]|0,u[w+12>>2]=b,u[y>>2]=b,u[b+8>>2]=w,u[b+12>>2]=A,u[b+24>>2]=0}while(!1);if(w=(u[5865]|0)+-1|0,u[5865]=w,!(w|0)){for(A=23884;A=u[A>>2]|0,A;)A=A+8|0;u[5865]=-1}}}}function _i(A,c){A=A|0,c=c|0;var h=0;return A?(h=pi(c,A)|0,(c|A)>>>0>65535&&(h=((h>>>0)/(A>>>0)|0|0)==(c|0)?h:-1)):h=0,A=mi(h)|0,!A||!(u[A+-4>>2]&3)||Es(A|0,0,h|0)|0,A|0}function st(A,c,h,d){return A=A|0,c=c|0,h=h|0,d=d|0,h=A+h>>>0,tt(c+d+(h>>>0<A>>>0|0)>>>0|0),h|0|0}function dn(A,c,h,d){return A=A|0,c=c|0,h=h|0,d=d|0,d=c-d-(h>>>0>A>>>0|0)>>>0,tt(d|0),A-h>>>0|0|0}function G0(A){return A=A|0,(A?31-(_s(A^A-1)|0)|0:32)|0}function HA(A,c,h,d,p){A=A|0,c=c|0,h=h|0,d=d|0,p=p|0;var m=0,y=0,b=0,w=0,E=0,I=0,O=0,H=0,G=0,V=0;if(I=A,w=c,E=w,y=h,H=d,b=H,!E)return m=(p|0)!=0,b?m?(u[p>>2]=A|0,u[p+4>>2]=c&0,H=0,p=0,tt(H|0),p|0):(H=0,p=0,tt(H|0),p|0):(m&&(u[p>>2]=(I>>>0)%(y>>>0),u[p+4>>2]=0),H=0,p=(I>>>0)/(y>>>0)>>>0,tt(H|0),p|0);m=(b|0)==0;do if(y){if(!m){if(m=(_s(b|0)|0)-(_s(E|0)|0)|0,m>>>0<=31){O=m+1|0,b=31-m|0,c=m-31>>31,y=O,A=I>>>(O>>>0)&c|E<<b,c=E>>>(O>>>0)&c,m=0,b=I<<b;break}return p?(u[p>>2]=A|0,u[p+4>>2]=w|c&0,H=0,p=0,tt(H|0),p|0):(H=0,p=0,tt(H|0),p|0)}if(m=y-1|0,m&y|0){b=(_s(y|0)|0)+33-(_s(E|0)|0)|0,V=64-b|0,O=32-b|0,w=O>>31,G=b-32|0,c=G>>31,y=b,A=O-1>>31&E>>>(G>>>0)|(E<<O|I>>>(b>>>0))&c,c=c&E>>>(b>>>0),m=I<<V&w,b=(E<<V|I>>>(G>>>0))&w|I<<O&b-33>>31;break}return p|0&&(u[p>>2]=m&I,u[p+4>>2]=0),(y|0)==1?(G=w|c&0,V=A|0|0,tt(G|0),V|0):(V=G0(y|0)|0,G=E>>>(V>>>0)|0,V=E<<32-V|I>>>(V>>>0)|0,tt(G|0),V|0)}else{if(m)return p|0&&(u[p>>2]=(E>>>0)%(y>>>0),u[p+4>>2]=0),G=0,V=(E>>>0)/(y>>>0)>>>0,tt(G|0),V|0;if(!I)return p|0&&(u[p>>2]=0,u[p+4>>2]=(E>>>0)%(b>>>0)),G=0,V=(E>>>0)/(b>>>0)>>>0,tt(G|0),V|0;if(m=b-1|0,!(m&b))return p|0&&(u[p>>2]=A|0,u[p+4>>2]=m&E|c&0),G=0,V=E>>>((G0(b|0)|0)>>>0),tt(G|0),V|0;if(m=(_s(b|0)|0)-(_s(E|0)|0)|0,m>>>0<=30){c=m+1|0,b=31-m|0,y=c,A=E<<b|I>>>(c>>>0),c=E>>>(c>>>0),m=0,b=I<<b;break}return p?(u[p>>2]=A|0,u[p+4>>2]=w|c&0,G=0,V=0,tt(G|0),V|0):(G=0,V=0,tt(G|0),V|0)}while(!1);if(!y)E=b,w=0,b=0;else{O=h|0|0,I=H|d&0,E=st(O|0,I|0,-1,-1)|0,h=N()|0,w=b,b=0;do d=w,w=m>>>31|w<<1,m=b|m<<1,d=A<<1|d>>>31|0,H=A>>>31|c<<1|0,dn(E|0,h|0,d|0,H|0)|0,V=N()|0,G=V>>31|((V|0)<0?-1:0)<<1,b=G&1,A=dn(d|0,H|0,G&O|0,(((V|0)<0?-1:0)>>31|((V|0)<0?-1:0)<<1)&I|0)|0,c=N()|0,y=y-1|0;while((y|0)!=0);E=w,w=0}return y=0,p|0&&(u[p>>2]=A,u[p+4>>2]=c),G=(m|0)>>>31|(E|y)<<1|(y<<1|m>>>31)&0|w,V=(m<<1|0)&-2|b,tt(G|0),V|0}function ws(A,c,h,d){A=A|0,c=c|0,h=h|0,d=d|0;var p=0,m=0,y=0,b=0,w=0,E=0;return E=c>>31|((c|0)<0?-1:0)<<1,w=((c|0)<0?-1:0)>>31|((c|0)<0?-1:0)<<1,m=d>>31|((d|0)<0?-1:0)<<1,p=((d|0)<0?-1:0)>>31|((d|0)<0?-1:0)<<1,b=dn(E^A|0,w^c|0,E|0,w|0)|0,y=N()|0,A=m^E,c=p^w,dn((HA(b,y,dn(m^h|0,p^d|0,m|0,p|0)|0,N()|0,0)|0)^A|0,(N()|0)^c|0,A|0,c|0)|0}function OE(A,c){A=A|0,c=c|0;var h=0,d=0,p=0,m=0;return m=A&65535,p=c&65535,h=pi(p,m)|0,d=A>>>16,A=(h>>>16)+(pi(p,d)|0)|0,p=c>>>16,c=pi(p,m)|0,tt((A>>>16)+(pi(p,d)|0)+(((A&65535)+c|0)>>>16)|0),A+c<<16|h&65535|0|0}function gn(A,c,h,d){A=A|0,c=c|0,h=h|0,d=d|0;var p=0,m=0;return p=A,m=h,h=OE(p,m)|0,A=N()|0,tt((pi(c,m)|0)+(pi(d,p)|0)+A|A&0|0),h|0|0|0}function Pa(A,c,h,d){A=A|0,c=c|0,h=h|0,d=d|0;var p=0,m=0,y=0,b=0,w=0,E=0;return p=M,M=M+16|0,b=p|0,y=c>>31|((c|0)<0?-1:0)<<1,m=((c|0)<0?-1:0)>>31|((c|0)<0?-1:0)<<1,E=d>>31|((d|0)<0?-1:0)<<1,w=((d|0)<0?-1:0)>>31|((d|0)<0?-1:0)<<1,A=dn(y^A|0,m^c|0,y|0,m|0)|0,c=N()|0,HA(A,c,dn(E^h|0,w^d|0,E|0,w|0)|0,N()|0,b)|0,d=dn(u[b>>2]^y|0,u[b+4>>2]^m|0,y|0,m|0)|0,h=N()|0,M=p,tt(h|0),d|0}function rr(A,c,h,d){A=A|0,c=c|0,h=h|0,d=d|0;var p=0,m=0;return m=M,M=M+16|0,p=m|0,HA(A,c,h,d,p)|0,M=m,tt(u[p+4>>2]|0),u[p>>2]|0|0}function W0(A,c,h){return A=A|0,c=c|0,h=h|0,(h|0)<32?(tt(c>>h|0),A>>>h|(c&(1<<h)-1)<<32-h):(tt(((c|0)<0?-1:0)|0),c>>h-32|0)}function _e(A,c,h){return A=A|0,c=c|0,h=h|0,(h|0)<32?(tt(c>>>h|0),A>>>h|(c&(1<<h)-1)<<32-h):(tt(0),c>>>h-32|0)}function xe(A,c,h){return A=A|0,c=c|0,h=h|0,(h|0)<32?(tt(c<<h|(A&(1<<h)-1<<32-h)>>>32-h|0),A<<h):(tt(A<<h-32|0),0)}function j0(A,c){return A=+A,c=+c,A!=A?+c:c!=c?+A:+Gw(+A,+c)}function GA(A,c){return A=+A,c=+c,A!=A?+c:c!=c?+A:+xA(+A,+c)}function Ma(A){return A=+A,A>=0?+en(A+.5):+tr(A-.5)}function Ba(A,c,h){A=A|0,c=c|0,h=h|0;var d=0,p=0,m=0;if((h|0)>=8192)return jw(A|0,c|0,h|0)|0,A|0;if(m=A|0,p=A+h|0,(A&3)==(c&3)){for(;A&3;){if(!h)return m|0;He[A>>0]=He[c>>0]|0,A=A+1|0,c=c+1|0,h=h-1|0}for(h=p&-4|0,d=h-64|0;(A|0)<=(d|0);)u[A>>2]=u[c>>2],u[A+4>>2]=u[c+4>>2],u[A+8>>2]=u[c+8>>2],u[A+12>>2]=u[c+12>>2],u[A+16>>2]=u[c+16>>2],u[A+20>>2]=u[c+20>>2],u[A+24>>2]=u[c+24>>2],u[A+28>>2]=u[c+28>>2],u[A+32>>2]=u[c+32>>2],u[A+36>>2]=u[c+36>>2],u[A+40>>2]=u[c+40>>2],u[A+44>>2]=u[c+44>>2],u[A+48>>2]=u[c+48>>2],u[A+52>>2]=u[c+52>>2],u[A+56>>2]=u[c+56>>2],u[A+60>>2]=u[c+60>>2],A=A+64|0,c=c+64|0;for(;(A|0)<(h|0);)u[A>>2]=u[c>>2],A=A+4|0,c=c+4|0}else for(h=p-4|0;(A|0)<(h|0);)He[A>>0]=He[c>>0]|0,He[A+1>>0]=He[c+1>>0]|0,He[A+2>>0]=He[c+2>>0]|0,He[A+3>>0]=He[c+3>>0]|0,A=A+4|0,c=c+4|0;for(;(A|0)<(p|0);)He[A>>0]=He[c>>0]|0,A=A+1|0,c=c+1|0;return m|0}function Es(A,c,h){A=A|0,c=c|0,h=h|0;var d=0,p=0,m=0,y=0;if(m=A+h|0,c=c&255,(h|0)>=67){for(;A&3;)He[A>>0]=c,A=A+1|0;for(d=m&-4|0,y=c|c<<8|c<<16|c<<24,p=d-64|0;(A|0)<=(p|0);)u[A>>2]=y,u[A+4>>2]=y,u[A+8>>2]=y,u[A+12>>2]=y,u[A+16>>2]=y,u[A+20>>2]=y,u[A+24>>2]=y,u[A+28>>2]=y,u[A+32>>2]=y,u[A+36>>2]=y,u[A+40>>2]=y,u[A+44>>2]=y,u[A+48>>2]=y,u[A+52>>2]=y,u[A+56>>2]=y,u[A+60>>2]=y,A=A+64|0;for(;(A|0)<(d|0);)u[A>>2]=y,A=A+4|0}for(;(A|0)<(m|0);)He[A>>0]=c,A=A+1|0;return m-h|0}function $0(A){return A=+A,A>=0?+en(A+.5):+tr(A-.5)}function ji(A){A=A|0;var c=0,h=0,d=0;return d=Ww()|0,h=u[bt>>2]|0,c=h+A|0,(A|0)>0&(c|0)<(h|0)|(c|0)<0?(Xw(c|0)|0,a0(12),-1):(c|0)>(d|0)&&!($w(c|0)|0)?(a0(12),-1):(u[bt>>2]=c,h|0)}return{___divdi3:ws,___muldi3:gn,___remdi3:Pa,___uremdi3:rr,_areNeighborCells:y3,_bitshift64Ashr:W0,_bitshift64Lshr:_e,_bitshift64Shl:xe,_calloc:_i,_cellAreaKm2:Z3,_cellAreaM2:eE,_cellAreaRads2:zA,_cellToBoundary:mo,_cellToCenterChild:D3,_cellToChildPos:G3,_cellToChildren:B3,_cellToChildrenSize:Ra,_cellToLatLng:po,_cellToLocalIj:aE,_cellToParent:NA,_cellToVertex:Gn,_cellToVertexes:xE,_cellsToDirectedEdge:b3,_cellsToLinkedMultiPolygon:s3,_childPosToCell:W3,_compactCells:N3,_destroyLinkedMultiPolygon:B0,_directedEdgeToBoundary:Ia,_directedEdgeToCells:E3,_edgeLengthKm:nE,_edgeLengthM:iE,_edgeLengthRads:tE,_emscripten_replace_memory:Qw,_free:je,_getBaseCellNumber:C0,_getDirectedEdgeDestination:T3,_getDirectedEdgeOrigin:v3,_getHexagonAreaAvgKm2:Y3,_getHexagonAreaAvgM2:K3,_getHexagonEdgeLengthAvgKm:q3,_getHexagonEdgeLengthAvgM:J3,_getIcosahedronFaces:I0,_getNumCells:VA,_getPentagons:UA,_getRes0Cells:c3,_getResolution:M3,_greatCircleDistanceKm:yo,_greatCircleDistanceM:$3,_greatCircleDistanceRads:j3,_gridDisk:l0,_gridDiskDistances:c0,_gridDistance:cE,_gridPathCells:uE,_gridPathCellsSize:AE,_gridRingUnsafe:e3,_i64Add:st,_i64Subtract:dn,_isPentagon:Ot,_isResClassIII:k3,_isValidCell:DA,_isValidDirectedEdge:w3,_isValidVertex:SE,_latLngToCell:S0,_llvm_maxnum_f64:j0,_llvm_minnum_f64:GA,_llvm_round_f64:Ma,_localIjToCell:lE,_malloc:mi,_maxFaceCount:z3,_maxGridDiskSize:Zw,_maxPolygonToCellsSize:t3,_memcpy:Ba,_memset:Es,_originToDirectedEdges:x3,_pentagonCount:H3,_polygonToCells:n3,_readInt64AsDoubleFromPointer:vE,_res0CellCount:l3,_round:$0,_sbrk:ji,_sizeOfCellBoundary:pE,_sizeOfCoordIJ:bE,_sizeOfGeoLoop:mE,_sizeOfGeoPolygon:_E,_sizeOfH3Index:dE,_sizeOfLatLng:gE,_sizeOfLinkedGeoPolygon:yE,_uncompactCells:F3,_uncompactCellsSize:L3,_vertexToLatLng:CE,establishStackSpace:Jw,stackAlloc:Yw,stackRestore:qw,stackSave:Kw}}(Lw,kw,L);e.___divdi3=ve.___divdi3,e.___muldi3=ve.___muldi3,e.___remdi3=ve.___remdi3,e.___uremdi3=ve.___uremdi3,e._areNeighborCells=ve._areNeighborCells,e._bitshift64Ashr=ve._bitshift64Ashr,e._bitshift64Lshr=ve._bitshift64Lshr,e._bitshift64Shl=ve._bitshift64Shl,e._calloc=ve._calloc,e._cellAreaKm2=ve._cellAreaKm2,e._cellAreaM2=ve._cellAreaM2,e._cellAreaRads2=ve._cellAreaRads2,e._cellToBoundary=ve._cellToBoundary,e._cellToCenterChild=ve._cellToCenterChild,e._cellToChildPos=ve._cellToChildPos,e._cellToChildren=ve._cellToChildren,e._cellToChildrenSize=ve._cellToChildrenSize,e._cellToLatLng=ve._cellToLatLng,e._cellToLocalIj=ve._cellToLocalIj,e._cellToParent=ve._cellToParent,e._cellToVertex=ve._cellToVertex,e._cellToVertexes=ve._cellToVertexes,e._cellsToDirectedEdge=ve._cellsToDirectedEdge,e._cellsToLinkedMultiPolygon=ve._cellsToLinkedMultiPolygon,e._childPosToCell=ve._childPosToCell,e._compactCells=ve._compactCells,e._destroyLinkedMultiPolygon=ve._destroyLinkedMultiPolygon,e._directedEdgeToBoundary=ve._directedEdgeToBoundary,e._directedEdgeToCells=ve._directedEdgeToCells,e._edgeLengthKm=ve._edgeLengthKm,e._edgeLengthM=ve._edgeLengthM,e._edgeLengthRads=ve._edgeLengthRads;var Uw=e._emscripten_replace_memory=ve._emscripten_replace_memory;e._free=ve._free,e._getBaseCellNumber=ve._getBaseCellNumber,e._getDirectedEdgeDestination=ve._getDirectedEdgeDestination,e._getDirectedEdgeOrigin=ve._getDirectedEdgeOrigin,e._getHexagonAreaAvgKm2=ve._getHexagonAreaAvgKm2,e._getHexagonAreaAvgM2=ve._getHexagonAreaAvgM2,e._getHexagonEdgeLengthAvgKm=ve._getHexagonEdgeLengthAvgKm,e._getHexagonEdgeLengthAvgM=ve._getHexagonEdgeLengthAvgM,e._getIcosahedronFaces=ve._getIcosahedronFaces,e._getNumCells=ve._getNumCells,e._getPentagons=ve._getPentagons,e._getRes0Cells=ve._getRes0Cells,e._getResolution=ve._getResolution,e._greatCircleDistanceKm=ve._greatCircleDistanceKm,e._greatCircleDistanceM=ve._greatCircleDistanceM,e._greatCircleDistanceRads=ve._greatCircleDistanceRads,e._gridDisk=ve._gridDisk,e._gridDiskDistances=ve._gridDiskDistances,e._gridDistance=ve._gridDistance,e._gridPathCells=ve._gridPathCells,e._gridPathCellsSize=ve._gridPathCellsSize,e._gridRingUnsafe=ve._gridRingUnsafe,e._i64Add=ve._i64Add,e._i64Subtract=ve._i64Subtract,e._isPentagon=ve._isPentagon,e._isResClassIII=ve._isResClassIII,e._isValidCell=ve._isValidCell,e._isValidDirectedEdge=ve._isValidDirectedEdge,e._isValidVertex=ve._isValidVertex,e._latLngToCell=ve._latLngToCell,e._llvm_maxnum_f64=ve._llvm_maxnum_f64,e._llvm_minnum_f64=ve._llvm_minnum_f64,e._llvm_round_f64=ve._llvm_round_f64,e._localIjToCell=ve._localIjToCell,e._malloc=ve._malloc,e._maxFaceCount=ve._maxFaceCount,e._maxGridDiskSize=ve._maxGridDiskSize,e._maxPolygonToCellsSize=ve._maxPolygonToCellsSize,e._memcpy=ve._memcpy,e._memset=ve._memset,e._originToDirectedEdges=ve._originToDirectedEdges,e._pentagonCount=ve._pentagonCount,e._polygonToCells=ve._polygonToCells,e._readInt64AsDoubleFromPointer=ve._readInt64AsDoubleFromPointer,e._res0CellCount=ve._res0CellCount,e._round=ve._round,e._sbrk=ve._sbrk,e._sizeOfCellBoundary=ve._sizeOfCellBoundary,e._sizeOfCoordIJ=ve._sizeOfCoordIJ,e._sizeOfGeoLoop=ve._sizeOfGeoLoop,e._sizeOfGeoPolygon=ve._sizeOfGeoPolygon,e._sizeOfH3Index=ve._sizeOfH3Index,e._sizeOfLatLng=ve._sizeOfLatLng,e._sizeOfLinkedGeoPolygon=ve._sizeOfLinkedGeoPolygon,e._uncompactCells=ve._uncompactCells,e._uncompactCellsSize=ve._uncompactCellsSize,e._vertexToLatLng=ve._vertexToLatLng,e.establishStackSpace=ve.establishStackSpace;var i0=e.stackAlloc=ve.stackAlloc,Vw=e.stackRestore=ve.stackRestore,zw=e.stackSave=ve.stackSave;if(e.asm=ve,e.cwrap=U,e.setValue=T,e.getValue=C,Pi){t0(Pi)||(Pi=r(Pi));{Cw();var TA=function(ae){ae.byteLength&&(ae=new Uint8Array(ae)),we.set(ae,v),e.memoryInitializerRequest&&delete e.memoryInitializerRequest.response,Sw()},s0=function(){o(Pi,TA,function(){throw"could not load memory initializer "+Pi})},r0=vA(Pi);if(r0)TA(r0.buffer);else if(e.memoryInitializerRequest){var o0=function(){var ae=e.memoryInitializerRequest,pe=ae.response;if(ae.status!==200&&ae.status!==0){var Be=vA(e.memoryInitializerRequestURL);if(Be)pe=Be.buffer;else{console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+ae.status+", retrying "+Pi),s0();return}}TA(pe)};e.memoryInitializerRequest.response?setTimeout(o0,0):e.memoryInitializerRequest.addEventListener("load",o0)}else s0()}}var wa;fo=function ae(){wa||wA(),wa||(fo=ae)};function wA(ae){if(ms>0||(wt(),ms>0))return;function pe(){wa||(wa=!0,!S&&(ht(),Zt(),e.onRuntimeInitialized&&e.onRuntimeInitialized(),Et()))}e.setStatus?(e.setStatus("Running..."),setTimeout(function(){setTimeout(function(){e.setStatus("")},1),pe()},1)):pe()}e.run=wA;function er(ae){throw e.onAbort&&e.onAbort(ae),ae+="",a(ae),l(ae),S=!0,"abort("+ae+"). Build with -s ASSERTIONS=1 for more info."}if(e.abort=er,e.preInit)for(typeof e.preInit=="function"&&(e.preInit=[e.preInit]);e.preInit.length>0;)e.preInit.pop()();return wA(),n}(typeof pt=="object"?pt:{}),Je="number",Ve=Je,Io=Je,Xe=Je,Qe=Je,mn=Je,Ne=Je,H5=[["sizeOfH3Index",Je],["sizeOfLatLng",Je],["sizeOfCellBoundary",Je],["sizeOfGeoLoop",Je],["sizeOfGeoPolygon",Je],["sizeOfLinkedGeoPolygon",Je],["sizeOfCoordIJ",Je],["readInt64AsDoubleFromPointer",Je],["isValidCell",Io,[Xe,Qe]],["latLngToCell",Ve,[Je,Je,mn,Ne]],["cellToLatLng",Ve,[Xe,Qe,Ne]],["cellToBoundary",Ve,[Xe,Qe,Ne]],["maxGridDiskSize",Ve,[Je,Ne]],["gridDisk",Ve,[Xe,Qe,Je,Ne]],["gridDiskDistances",Ve,[Xe,Qe,Je,Ne,Ne]],["gridRingUnsafe",Ve,[Xe,Qe,Je,Ne]],["maxPolygonToCellsSize",Ve,[Ne,mn,Je,Ne]],["polygonToCells",Ve,[Ne,mn,Je,Ne]],["cellsToLinkedMultiPolygon",Ve,[Ne,Je,Ne]],["destroyLinkedMultiPolygon",null,[Ne]],["compactCells",Ve,[Ne,Ne,Je,Je]],["uncompactCells",Ve,[Ne,Je,Je,Ne,Je,mn]],["uncompactCellsSize",Ve,[Ne,Je,Je,mn,Ne]],["isPentagon",Io,[Xe,Qe]],["isResClassIII",Io,[Xe,Qe]],["getBaseCellNumber",Je,[Xe,Qe]],["getResolution",Je,[Xe,Qe]],["maxFaceCount",Ve,[Xe,Qe,Ne]],["getIcosahedronFaces",Ve,[Xe,Qe,Ne]],["cellToParent",Ve,[Xe,Qe,mn,Ne]],["cellToChildren",Ve,[Xe,Qe,mn,Ne]],["cellToCenterChild",Ve,[Xe,Qe,mn,Ne]],["cellToChildrenSize",Ve,[Xe,Qe,mn,Ne]],["cellToChildPos",Ve,[Xe,Qe,mn,Ne]],["childPosToCell",Ve,[Je,Je,Xe,Qe,mn,Ne]],["areNeighborCells",Ve,[Xe,Qe,Xe,Qe,Ne]],["cellsToDirectedEdge",Ve,[Xe,Qe,Xe,Qe,Ne]],["getDirectedEdgeOrigin",Ve,[Xe,Qe,Ne]],["getDirectedEdgeDestination",Ve,[Xe,Qe,Ne]],["isValidDirectedEdge",Io,[Xe,Qe]],["directedEdgeToCells",Ve,[Xe,Qe,Ne]],["originToDirectedEdges",Ve,[Xe,Qe,Ne]],["directedEdgeToBoundary",Ve,[Xe,Qe,Ne]],["gridDistance",Ve,[Xe,Qe,Xe,Qe,Ne]],["gridPathCells",Ve,[Xe,Qe,Xe,Qe,Ne]],["gridPathCellsSize",Ve,[Xe,Qe,Xe,Qe,Ne]],["cellToLocalIj",Ve,[Xe,Qe,Xe,Qe,Je,Ne]],["localIjToCell",Ve,[Xe,Qe,Ne,Je,Ne]],["getHexagonAreaAvgM2",Ve,[mn,Ne]],["getHexagonAreaAvgKm2",Ve,[mn,Ne]],["getHexagonEdgeLengthAvgM",Ve,[mn,Ne]],["getHexagonEdgeLengthAvgKm",Ve,[mn,Ne]],["greatCircleDistanceM",Je,[Ne,Ne]],["greatCircleDistanceKm",Je,[Ne,Ne]],["greatCircleDistanceRads",Je,[Ne,Ne]],["cellAreaM2",Ve,[Xe,Qe,Ne]],["cellAreaKm2",Ve,[Xe,Qe,Ne]],["cellAreaRads2",Ve,[Xe,Qe,Ne]],["edgeLengthM",Ve,[Xe,Qe,Ne]],["edgeLengthKm",Ve,[Xe,Qe,Ne]],["edgeLengthRads",Ve,[Xe,Qe,Ne]],["getNumCells",Ve,[mn,Ne]],["getRes0Cells",Ve,[Ne]],["res0CellCount",Je],["getPentagons",Ve,[Je,Ne]],["pentagonCount",Je],["cellToVertex",Ve,[Xe,Qe,Je,Ne]],["cellToVertexes",Ve,[Xe,Qe,Ne]],["vertexToLatLng",Ve,[Xe,Qe,Ne]],["isValidVertex",Io,[Xe,Qe]]],G5=0,W5=1,j5=2,$5=3,Xv=4,X5=5,Q5=6,Y5=7,K5=8,q5=9,J5=10,Z5=11,eV=12,tV=13,nV=14,iV=15,hn={};hn[G5]="Success";hn[W5]="The operation failed but a more specific error is not available";hn[j5]="Argument was outside of acceptable range";hn[$5]="Latitude or longitude arguments were outside of acceptable range";hn[Xv]="Resolution argument was outside of acceptable range";hn[X5]="Cell argument was not valid";hn[Q5]="Directed edge argument was not valid";hn[Y5]="Undirected edge argument was not valid";hn[K5]="Vertex argument was not valid";hn[q5]="Pentagon distortion was encountered";hn[J5]="Duplicate input";hn[Z5]="Cell arguments were not neighbors";hn[eV]="Cell arguments had incompatible resolutions";hn[tV]="Memory allocation failed";hn[nV]="Bounds of provided memory were insufficient";hn[iV]="Mode or flags argument was not valid";var Qv=1e3,sV=1001,Yv=1002,lA={};lA[Qv]="Unknown unit";lA[sV]="Array length out of bounds";lA[Yv]="Got unexpected null value for H3 index";var rV="Unknown error";function Kv(n,e,t){var i=t&&"value"in t,s=new Error((n[e]||rV)+" (code: "+e+(i?", value: "+t.value:"")+")");return s.code=e,s}function qv(n,e){var t=arguments.length===2?{value:e}:{};return Kv(hn,n,t)}function Jv(n,e){var t=arguments.length===2?{value:e}:{};return Kv(lA,n,t)}function js(n){if(n!==0)throw qv(n)}var qt={};H5.forEach(function(e){qt[e[0]]=pt.cwrap.apply(pt,e)});var Nr=16,Zv=4,M_=4,fs=8,oV=8,Tc=qt.sizeOfH3Index(),eT=qt.sizeOfLatLng(),aV=qt.sizeOfCellBoundary();qt.sizeOfGeoPolygon();qt.sizeOfGeoLoop();var lV=qt.sizeOfLinkedGeoPolygon();qt.sizeOfCoordIJ();var B_={m:"m",m2:"m2",km:"km",km2:"km2",rads:"rads",rads2:"rads2"};function cV(n){if(typeof n!="number"||n<0||n>15||Math.floor(n)!==n)throw qv(Xv,n);return n}function AV(n){if(!n)throw Jv(Yv);return n}var uV=/[^0-9a-fA-F]/;function $s(n){if(Array.isArray(n)&&n.length===2&&Number.isInteger(n[0])&&Number.isInteger(n[1]))return n;if(typeof n!="string"||uV.test(n))return[0,0];var e=parseInt(n.substring(0,n.length-8),Nr),t=parseInt(n.substring(n.length-8),Nr);return[t,e]}function O_(n){if(n>=0)return n.toString(Nr);n=n&2147483647;var e=tT(8,n.toString(Nr)),t=(parseInt(e[0],Nr)+8).toString(Nr);return e=t+e.substring(1),e}function hV(n,e){return O_(e)+tT(8,O_(n))}function tT(n,e){for(var t=n-e.length,i="",s=0;s<t;s++)i+="0";return i=i+e,i}function fV(n,e){e===void 0&&(e=0);var t=pt.getValue(n+Tc*e,"i32"),i=pt.getValue(n+Tc*e+Zv,"i32");return i?hV(t,i):null}function dV(n,e){return e===void 0&&(e=0),pt.getValue(n+fs*e,"double")}function gV(n){return qt.readInt64AsDoubleFromPointer(n)}function pV(n,e,t){pt.HEAPU32.set($s(n),e/Zv+2*t)}function mV(n,e){for(var t=e.length,i=0;i<t;i++)pV(e[i],n,i)}function wc(n){return RV(pt.getValue(n,"double"))}function _V(n){return[wc(n),wc(n+fs)]}function nT(n){return[wc(n+fs),wc(n)]}function yV(n,e,t){for(var i=pt.getValue(n,"i32"),s=n+fs,r=[],o=nT,a=0;a<i*2;a+=2)r.push(o(s+fs*a));return r.push(r[0]),r}function bV(n,e){for(var t=[],i=nT,s,r,o,a;n;){for(t.push(s=[]),r=pt.getValue(n,"i8*");r;){for(s.push(o=[]),a=pt.getValue(r,"i8*");a;)o.push(i(a)),a=pt.getValue(a+fs*2,"i8*");o.push(o[0]),r=pt.getValue(r+M_*2,"i8*")}n=pt.getValue(n+M_*2,"i8*")}return t}function vV(n){var e=$s(n),t=e[0],i=e[1];return!!qt.isPentagon(t,i)}function TV(n){var e=$s(n),t=e[0],i=e[1];return qt.isValidCell(t,i)?qt.getResolution(t,i):-1}function wV(n,e,t){var i=pt._malloc(eT);pt.HEAPF64.set([n,e].map(IV),i/fs);var s=pt._malloc(Tc);try{return js(qt.latLngToCell(i,t,s)),AV(fV(s))}finally{pt._free(s),pt._free(i)}}function Rd(n){var e=pt._malloc(eT),t=$s(n),i=t[0],s=t[1];try{return js(qt.cellToLatLng(i,s,e)),_V(e)}finally{pt._free(e)}}function EV(n,e){var t=pt._malloc(aV),i=$s(n),s=i[0],r=i[1];try{return js(qt.cellToBoundary(s,r,t)),yV(t,e,e)}finally{pt._free(t)}}function xV(n,e){if(!n||!n.length)return[];var t=n.length,i=pt._calloc(t,Tc);mV(i,n);var s=pt._calloc(lV);try{return js(qt.cellsToLinkedMultiPolygon(i,t,s)),bV(s,e)}finally{qt.destroyLinkedMultiPolygon(s),pt._free(s),pt._free(i)}}function CV(n,e){var t=$s(n),i=t[0],s=t[1],r=$s(e),o=r[0],a=r[1],l=pt._malloc(oV);try{return js(qt.gridDistance(i,s,o,a,l)),gV(l)}finally{pt._free(l)}}function SV(n,e){cV(n);var t=pt._malloc(fs);try{switch(e){case B_.m:js(qt.getHexagonEdgeLengthAvgM(n,t));break;case B_.km:js(qt.getHexagonEdgeLengthAvgKm(n,t));break;default:throw Jv(Qv,e)}return dV(t)}finally{pt._free(t)}}function IV(n){return n*Math.PI/180}function RV(n){return n*180/Math.PI}function Pd(n,e){e=e===void 0?n[0][0]:e;for(const t of n){const i=t[0]-e;i>180?t[0]-=360:i<-180&&(t[0]+=360)}}function PV(n,e,t){const[i,s]=Rd(n),r=e.length;Pd(e,s);const o=e[0]===e[r-1]?r-1:r;for(let a=0;a<o;a++)e[a][0]=Qn(s,e[a][0],t),e[a][1]=Qn(i,e[a][1],t)}function MV(n,e,t){const i=n(e,t),[s,r]=Rd(i);return[r,s]}function D_(n,e=1){const t=EV(n,!0);return e!==1?PV(n,t,e):Pd(t),t}function BV(n){const e=new Float64Array(n.length*2);let t=0;for(const i of n)e[t++]=i[0],e[t++]=i[1];return e}const OV=10;function DV(n,e){let t;return n==null?t=e:typeof n=="object"?t={...n,coverage:e}:t={getHexagon:n,coverage:e},t}const NV={...Ao.defaultProps,highPrecision:"auto",coverage:{type:"number",min:0,max:1,value:1},centerHexagon:null,getHexagon:{type:"accessor",value:n=>n.hexagon},extruded:!0};class ho extends gi{initializeState(){ho._checkH3Lib(),this.state={edgeLengthKM:0,resolution:-1}}shouldUpdateState({changeFlags:e}){return this._shouldUseHighPrecision()?e.propsOrDataChanged:e.somethingChanged}updateState({props:e,changeFlags:t}){if(e.highPrecision!==!0&&(t.dataChanged||t.updateTriggersChanged&&t.updateTriggersChanged.getHexagon)){const i=this._calculateH3DataProps();this.setState(i)}this._updateVertices(this.context.viewport)}_calculateH3DataProps(){let e=-1,t=!1,i=!1;const{iterable:s,objectInfo:r}=Ri(this.props.data);for(const o of s){r.index++;const a=this.props.getHexagon(o,r),l=TV(a);if(e<0){if(e=l,!this.props.highPrecision)break}else if(e!==l){i=!0;break}if(vV(a)){t=!0;break}}return{resolution:e,edgeLengthKM:e>=0?SV(e,"km"):0,hasMultipleRes:i,hasPentagon:t}}_shouldUseHighPrecision(){if(this.props.highPrecision==="auto"){const{resolution:e,hasPentagon:t,hasMultipleRes:i}=this.state,{viewport:s}=this.context;return!!(s!=null&&s.resolution)||i||t||e>=0&&e<=5}return this.props.highPrecision}_updateVertices(e){if(this._shouldUseHighPrecision())return;const{resolution:t,edgeLengthKM:i,centerHex:s}=this.state;if(t<0)return;const r=this.props.centerHexagon||wV(e.latitude,e.longitude,t);if(s===r)return;if(s)try{if(CV(s,r)*i<OV)return}catch{}const{unitsPerMeter:o}=e.distanceScales;let a=D_(r);const[l,f]=Rd(r),[g,_]=e.projectFlat([f,l]);a=a.map(v=>{const T=e.projectFlat(v);return[(T[0]-g)/o[0],(T[1]-_)/o[1]]}),this.setState({centerHex:r,vertices:a})}renderLayers(){return this._shouldUseHighPrecision()?this._renderPolygonLayer():this._renderColumnLayer()}_getForwardProps(){const{elevationScale:e,material:t,coverage:i,extruded:s,wireframe:r,stroked:o,filled:a,lineWidthUnits:l,lineWidthScale:f,lineWidthMinPixels:g,lineWidthMaxPixels:_,getFillColor:v,getElevation:T,getLineColor:C,getLineWidth:S,transitions:R,updateTriggers:P}=this.props;return{elevationScale:e,extruded:s,coverage:i,wireframe:r,stroked:o,filled:a,lineWidthUnits:l,lineWidthScale:f,lineWidthMinPixels:g,lineWidthMaxPixels:_,material:t,getElevation:T,getFillColor:v,getLineColor:C,getLineWidth:S,transitions:R,updateTriggers:{getFillColor:P.getFillColor,getElevation:P.getElevation,getLineColor:P.getLineColor,getLineWidth:P.getLineWidth}}}_renderPolygonLayer(){const{data:e,getHexagon:t,updateTriggers:i,coverage:s}=this.props,r=this.getSubLayerClass("hexagon-cell-hifi",Ao),o=this._getForwardProps();return o.updateTriggers.getPolygon=DV(i.getHexagon,s),new r(o,this.getSubLayerProps({id:"hexagon-cell-hifi",updateTriggers:o.updateTriggers}),{data:e,_normalize:!1,_windingOrder:"CCW",positionFormat:"XY",getPolygon:(a,l)=>{const f=t(a,l);return BV(D_(f,s))}})}_renderColumnLayer(){const{data:e,getHexagon:t,updateTriggers:i}=this.props,s=this.getSubLayerClass("hexagon-cell",lo),r=this._getForwardProps();return r.updateTriggers.getPosition=i.getHexagon,new s(r,this.getSubLayerProps({id:"hexagon-cell",flatShading:!0,updateTriggers:r.updateTriggers}),{data:e,diskResolution:6,radius:1,vertices:this.state.vertices,getPosition:MV.bind(null,t)})}}ho.defaultProps=NV;ho.layerName="H3HexagonLayer";ho._checkH3Lib=()=>{};const FV={getHexagons:{type:"accessor",value:n=>n.hexagons}};class iT extends uo{initializeState(){ho._checkH3Lib()}updateState({props:e,changeFlags:t}){if(t.dataChanged||t.updateTriggersChanged&&t.updateTriggersChanged.getHexagons){const{data:i,getHexagons:s}=e,r=[],{iterable:o,objectInfo:a}=Ri(i);for(const l of o){a.index++;const f=s(l,a),g=xV(f,!0);for(const _ of g){for(const v of _)Pd(v);r.push(this.getSubLayerRow({polygon:_},l,a.index))}}this.setState({polygons:r})}}indexToBounds(){const{getElevation:e,getFillColor:t,getLineColor:i,getLineWidth:s}=this.props;return{data:this.state.polygons,getPolygon:r=>r.polygon,getElevation:this.getSubLayerAccessor(e),getFillColor:this.getSubLayerAccessor(t),getLineColor:this.getSubLayerAccessor(i),getLineWidth:this.getSubLayerAccessor(s)}}}iT.layerName="H3ClusterLayer";iT.defaultProps=FV;const Lu=Math.PI/180,Al=new Float32Array(16),N_=new Float32Array(12);function F_(n,e,t){const i=e[0]*Lu,s=e[1]*Lu,r=e[2]*Lu,o=Math.sin(r),a=Math.sin(i),l=Math.sin(s),f=Math.cos(r),g=Math.cos(i),_=Math.cos(s),v=t[0],T=t[1],C=t[2];n[0]=v*_*g,n[1]=v*l*g,n[2]=v*-a,n[3]=T*(-l*f+_*a*o),n[4]=T*(_*f+l*a*o),n[5]=T*g*o,n[6]=C*(l*o+_*a*f),n[7]=C*(-_*o+l*a*f),n[8]=C*g*f}function L_(n){return n[0]=n[0],n[1]=n[1],n[2]=n[2],n[3]=n[4],n[4]=n[5],n[5]=n[6],n[6]=n[8],n[7]=n[9],n[8]=n[10],n[9]=n[12],n[10]=n[13],n[11]=n[14],n.subarray(0,12)}const sT={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrixCol0:{size:3,elementOffset:0},instanceModelMatrixCol1:{size:3,elementOffset:3},instanceModelMatrixCol2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(n,{startRow:e,endRow:t}){const{data:i,getOrientation:s,getScale:r,getTranslation:o,getTransformMatrix:a}=this.props,l=Array.isArray(a),f=l&&a.length===16,g=Array.isArray(r),_=Array.isArray(s),v=Array.isArray(o),T=f||!l&&!!a(i[0]);T?n.constant=f:n.constant=_&&g&&v;const C=n.value;if(n.constant){let S;T?(Al.set(a),S=L_(Al)):(S=N_,F_(S,s,r),S.set(o,9)),n.value=new Float32Array(S)}else{let S=e*n.size;const{iterable:R,objectInfo:P}=Ri(i,e,t);for(const F of R){P.index++;let U;if(T)Al.set(f?a:a(F,P)),U=L_(Al);else{U=N_;const X=_?s:s(F,P),Z=g?r:r(F,P);F_(U,X,Z),U.set(v?o:o(F,P),9)}C[S++]=U[0],C[S++]=U[1],C[S++]=U[2],C[S++]=U[3],C[S++]=U[4],C[S++]=U[5],C[S++]=U[6],C[S++]=U[7],C[S++]=U[8],C[S++]=U[9],C[S++]=U[10],C[S++]=U[11]}}}};function rT(n,e){return e===Ue.CARTESIAN||e===Ue.METER_OFFSETS||e===Ue.DEFAULT&&!n.isGeospatial}const k_=`uniform simpleMeshUniforms {
  float sizeScale;
  bool composeModelMatrix;
  bool hasTexture;
  bool flatShading;
} simpleMesh;
`,LV={name:"simpleMesh",vs:k_,fs:k_,uniformTypes:{sizeScale:"f32",composeModelMatrix:"f32",hasTexture:"f32",flatShading:"f32"}},kV=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = texCoords;
geometry.pickingColor = instancePickingColors;
vTexCoord = texCoords;
cameraPosition = project.cameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale + instanceTranslation;
if (simpleMesh.composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
geometry.position = position_commonspace;
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
}
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,UV=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform sampler2D sampler;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
geometry.uv = vTexCoord;
vec3 normal;
if (simpleMesh.flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;
DECKGL_FILTER_COLOR(color, geometry);
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * layer.opacity);
}
`;function ku(n){const e=n.positions||n.POSITION;ze.assert(e,'no "postions" or "POSITION" attribute in mesh');const t=e.value.length/e.size;let i=n.COLOR_0||n.colors;i||(i={size:3,value:new Float32Array(t*3).fill(1)});let s=n.NORMAL||n.normals;s||(s={size:3,value:new Float32Array(t*3).fill(0)});let r=n.TEXCOORD_0||n.texCoords;return r||(r={size:2,value:new Float32Array(t*2).fill(0)}),{positions:e,colors:i,normals:s,texCoords:r}}function U_(n){return n instanceof un?(n.attributes=ku(n.attributes),n):n.attributes?new un({...n,topology:"triangle-list",attributes:ku(n.attributes)}):new un({topology:"triangle-list",attributes:ku(n)})}const VV=[0,0,0,255],zV={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:n=>n.position},getColor:{type:"accessor",value:VV},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0,value:null}};class ia extends rn{getShaders(){return super.getShaders({vs:kV,fs:UV,modules:[sn,Kf,Un,LV]})}getBounds(){var i;if(this.props._instanced)return super.getBounds();let e=this.state.positionBounds;if(e)return e;const{mesh:t}=this.props;if(!t)return null;if(e=(i=t.header)==null?void 0:i.boundingBox,!e){const{attributes:s}=U_(t);s.POSITION=s.POSITION||s.positions,e=w1(s)}return this.state.positionBounds=e,e}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:"float64",fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:"unorm8",transition:!0,size:this.props.colorFormat.length,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:sT}),this.setState({emptyTexture:this.context.device.createTexture({data:new Uint8Array(4),width:1,height:1})})}updateState(e){var r;super.updateState(e);const{props:t,oldProps:i,changeFlags:s}=e;if(t.mesh!==i.mesh||s.extensionsChanged){if(this.state.positionBounds=null,(r=this.state.model)==null||r.destroy(),t.mesh){this.state.model=this.getModel(t.mesh);const o=t.mesh.attributes||t.mesh;this.setState({hasNormals:!!(o.NORMAL||o.normals)})}this.getAttributeManager().invalidateAll()}t.texture!==i.texture&&t.texture instanceof kt&&this.setTexture(t.texture),this.state.model&&this.state.model.setTopology(this.props.wireframe?"line-strip":"triangle-list")}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw({uniforms:e}){const{model:t}=this.state;if(!t)return;const{viewport:i,renderPass:s}=this.context,{sizeScale:r,coordinateSystem:o,_instanced:a}=this.props,l={sizeScale:r,composeModelMatrix:!a||rT(i,o),flatShading:!this.state.hasNormals};t.shaderInputs.setProps({simpleMesh:l}),t.draw(s)}get isLoaded(){var e;return!!((e=this.state)!=null&&e.model&&super.isLoaded)}getModel(e){const t=new Nt(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:U_(e),isInstanced:!0}),{texture:i}=this.props,{emptyTexture:s}=this.state,r={sampler:i||s,hasTexture:!!i};return t.shaderInputs.setProps({simpleMesh:r}),t}setTexture(e){const{emptyTexture:t,model:i}=this.state;if(i){const s={sampler:e||t,hasTexture:!!e};i.shaderInputs.setProps({simpleMesh:s})}}}ia.defaultProps=zV;ia.layerName="SimpleMeshLayer";var si;(function(n){n[n.FUNC_ADD=32774]="FUNC_ADD",n[n.ONE=1]="ONE",n[n.SRC_ALPHA=770]="SRC_ALPHA",n[n.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",n[n.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",n[n.LINEAR=9729]="LINEAR",n[n.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",n[n.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL"})(si||(si={}));function oT(n,e,t,i){const s={defines:{MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},bindings:{},uniforms:{camera:[0,0,0],metallicRoughnessValues:[1,1]},parameters:{},glParameters:{},generatedTextures:[]};s.defines.USE_TEX_LOD=1;const{imageBasedLightingEnvironment:r}=i;return r&&(s.bindings.pbr_diffuseEnvSampler=r.diffuseEnvSampler.texture,s.bindings.pbr_specularEnvSampler=r.specularEnvSampler.texture,s.bindings.pbr_BrdfLUT=r.brdfLutTexture.texture,s.uniforms.scaleIBLAmbient=[1,1]),i!=null&&i.pbrDebug&&(s.defines.PBR_DEBUG=1,s.uniforms.scaleDiffBaseMR=[0,0,0,0],s.uniforms.scaleFGDSpec=[0,0,0,0]),t.NORMAL&&(s.defines.HAS_NORMALS=1),t.TANGENT&&(i!=null&&i.useTangents)&&(s.defines.HAS_TANGENTS=1),t.TEXCOORD_0&&(s.defines.HAS_UV=1),i!=null&&i.imageBasedLightingEnvironment&&(s.defines.USE_IBL=1),i!=null&&i.lights&&(s.defines.USE_LIGHTS=1),e&&HV(n,e,s),s}function HV(n,e,t){if(t.uniforms.unlit=!!e.unlit,e.pbrMetallicRoughness&&GV(n,e.pbrMetallicRoughness,t),e.normalTexture){Qo(n,e.normalTexture,"pbr_normalSampler","HAS_NORMALMAP",t);const{scale:i=1}=e.normalTexture;t.uniforms.normalScale=i}if(e.occlusionTexture){Qo(n,e.occlusionTexture,"pbr_occlusionSampler","HAS_OCCLUSIONMAP",t);const{strength:i=1}=e.occlusionTexture;t.uniforms.occlusionStrength=i}switch(e.emissiveTexture&&(Qo(n,e.emissiveTexture,"pbr_emissiveSampler","HAS_EMISSIVEMAP",t),t.uniforms.emissiveFactor=e.emissiveFactor||[0,0,0]),e.alphaMode){case"MASK":const{alphaCutoff:i=.5}=e;t.defines.ALPHA_CUTOFF=1,t.uniforms.alphaCutoff=i;break;case"BLEND":ye.warn("glTF BLEND alphaMode might not work well because it requires mesh sorting")(),t.parameters.blendColorOperation="add",t.parameters.blendColorSrcFactor="src-alpha",t.parameters.blendColorDstFactor="one-minus-src-alpha",t.parameters.blendAlphaOperation="add",t.parameters.blendAlphaSrcFactor="one",t.parameters.blendAlphaDstFactor="one-minus-src-alpha",t.glParameters.blend=!0,t.glParameters.blendEquation=si.FUNC_ADD,t.glParameters.blendFunc=[si.SRC_ALPHA,si.ONE_MINUS_SRC_ALPHA,si.ONE,si.ONE_MINUS_SRC_ALPHA];break}}function GV(n,e,t){e.baseColorTexture&&Qo(n,e.baseColorTexture,"pbr_baseColorSampler","HAS_BASECOLORMAP",t),t.uniforms.baseColorFactor=e.baseColorFactor||[1,1,1,1],e.metallicRoughnessTexture&&Qo(n,e.metallicRoughnessTexture,"pbr_metallicRoughnessSampler","HAS_METALROUGHNESSMAP",t);const{metallicFactor:i=1,roughnessFactor:s=1}=e;t.uniforms.metallicRoughnessValues=[i,s]}function Qo(n,e,t,i=null,s){var g,_;const r=((_=(g=e==null?void 0:e.texture)==null?void 0:g.sampler)==null?void 0:_.parameters)||{},o=e.texture.source.image;let a,l={};o.compressed?(a=o,l={[si.TEXTURE_MIN_FILTER]:o.data.length>1?si.LINEAR_MIPMAP_NEAREST:si.LINEAR}):a={data:o};const f=n.createTexture({id:e.uniformName||e.id,parameters:{...r,...l},pixelStore:{[si.UNPACK_FLIP_Y_WEBGL]:!1},...a});s.bindings[t]=f,i&&(s.defines[i]=1),s.generatedTextures.push(f)}const WV="4.3.2",Ec={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let V_;async function z_(n){JE(n.modules);const e=ZE("basis");return e||(V_||(V_=jV(n)),await V_)}async function jV(n){let e=null,t=null;return[e,t]=await Promise.all([await Fs(Ec.TRANSCODER,"textures",n),await Fs(Ec.TRANSCODER_WASM,"textures",n)]),e=e||globalThis.BASIS,await $V(e,t)}function $V(n,e){const t={};return e&&(t.wasmBinary=e),new Promise(i=>{n(t).then(s=>{const{BasisFile:r,initializeBasis:o}=s;o(),i({BasisFile:r})})})}let Uu;async function H_(n){const e=n.modules||{};return e.basisEncoder?e.basisEncoder:(Uu=Uu||XV(n),await Uu)}async function XV(n){let e=null,t=null;return[e,t]=await Promise.all([await Fs(Ec.ENCODER,"textures",n),await Fs(Ec.ENCODER_WASM,"textures",n)]),e=e||globalThis.BASIS,await QV(e,t)}function QV(n,e){const t={};return e&&(t.wasmBinary=e),new Promise(i=>{n(t).then(s=>{const{BasisFile:r,KTX2File:o,initializeBasis:a,BasisEncoder:l}=s;a(),i({BasisFile:r,KTX2File:o,BasisEncoder:l})})})}const Tr={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_ASTC_4X4_KHR:37808},YV=["","WEBKIT_","MOZ_"],G_={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let ul=null;function KV(n){if(!ul){n=n||qV()||void 0,ul=new Set;for(const e of YV)for(const t in G_)if(n&&n.getExtension(`${e}${t}`)){const i=G_[t];ul.add(i)}}return ul}function qV(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}const On=[171,75,84,88,32,50,48,187,13,10,26,10];function JV(n){const e=new Uint8Array(n);return!(e.byteLength<On.length||e[0]!==On[0]||e[1]!==On[1]||e[2]!==On[2]||e[3]!==On[3]||e[4]!==On[4]||e[5]!==On[5]||e[6]!==On[6]||e[7]!==On[7]||e[8]!==On[8]||e[9]!==On[9]||e[10]!==On[10]||e[11]!==On[11])}const ZV={etc1:{basisFormat:0,compressed:!0,format:Tr.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:Tr.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:Tr.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:Tr.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:Tr.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:Tr.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function e9(n,e){if(e.basis.containerFormat==="auto"){if(JV(n)){const i=await H_(e);return W_(i.KTX2File,n,e)}const{BasisFile:t}=await z_(e);return Vu(t,n,e)}switch(e.basis.module){case"encoder":const t=await H_(e);switch(e.basis.containerFormat){case"ktx2":return W_(t.KTX2File,n,e);case"basis":default:return Vu(t.BasisFile,n,e)}case"transcoder":default:const{BasisFile:i}=await z_(e);return Vu(i,n,e)}}function Vu(n,e,t){const i=new n(new Uint8Array(e));try{if(!i.startTranscoding())throw new Error("Failed to start basis transcoding");const s=i.getNumImages(),r=[];for(let o=0;o<s;o++){const a=i.getNumLevels(o),l=[];for(let f=0;f<a;f++)l.push(t9(i,o,f,t));r.push(l)}return r}finally{i.close(),i.delete()}}function t9(n,e,t,i){const s=n.getImageWidth(e,t),r=n.getImageHeight(e,t),o=n.getHasAlpha(),{compressed:a,format:l,basisFormat:f}=aT(i,o),g=n.getImageTranscodedSizeInBytes(e,t,f),_=new Uint8Array(g);if(!n.transcodeImage(_,e,t,f,0,0))throw new Error("failed to start Basis transcoding");return{width:s,height:r,data:_,compressed:a,format:l,hasAlpha:o}}function W_(n,e,t){const i=new n(new Uint8Array(e));try{if(!i.startTranscoding())throw new Error("failed to start KTX2 transcoding");const s=i.getLevels(),r=[];for(let o=0;o<s;o++)r.push(n9(i,o,t));return[r]}finally{i.close(),i.delete()}}function n9(n,e,t){const{alphaFlag:i,height:s,width:r}=n.getImageLevelInfo(e,0,0),{compressed:o,format:a,basisFormat:l}=aT(t,i),f=n.getImageTranscodedSizeInBytes(e,0,0,l),g=new Uint8Array(f);if(!n.transcodeImage(g,e,0,0,l,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:r,height:s,data:g,compressed:o,levelSize:f,hasAlpha:i,format:a}}function aT(n,e){let t=n&&n.basis&&n.basis.format;return t==="auto"&&(t=lT()),typeof t=="object"&&(t=e?t.alpha:t.noAlpha),t=t.toLowerCase(),ZV[t]}function lT(){const n=KV();return n.has("astc")?"astc-4x4":n.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:n.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:n.has("etc1")?"etc1":n.has("etc2")?"etc2":"rgb565"}const i9={dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:WV,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},s9={...i9,parse:e9},r9={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},o9={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};class a9{constructor(e){x(this,"name");x(this,"startTime",0);x(this,"playing",!0);x(this,"speed",1);x(this,"channels",[]);Object.assign(this,e)}animate(e){if(!this.playing)return;const i=(e/1e3-this.startTime)*this.speed;this.channels.forEach(({sampler:s,target:r,path:o})=>{d9(i,s,r,o),A9(r,r._node)})}}class l9{constructor(e){x(this,"animations");this.animations=e.animations.map((t,i)=>{const s=t.name||`Animation-${i}`,r=t.samplers.map(({input:a,interpolation:l="LINEAR",output:f})=>({input:j_(e.accessors[a]),interpolation:l,output:j_(e.accessors[f])})),o=t.channels.map(({sampler:a,target:l})=>({sampler:r[a],target:e.nodes[l.node],path:l.path}));return new a9({name:s,channels:o})})}animate(e){this.setTime(e)}setTime(e){this.animations.forEach(t=>t.animate(e))}getAnimations(){return this.animations}}function j_(n){if(!n._animation){const e=o9[n.componentType],t=r9[n.type],i=t*n.count,{buffer:s,byteOffset:r}=n.bufferView.data,o=new e(s,r+(n.byteOffset||0),i);if(t===1)n._animation=Array.from(o);else{const a=[];for(let l=0;l<o.length;l+=t)a.push(Array.from(o.slice(l,l+t)));n._animation=a}}return n._animation}const c9=new Ge;function A9(n,e){if(e.matrix.identity(),n.translation&&e.matrix.translate(n.translation),n.rotation){const t=c9.fromQuaternion(n.rotation);e.matrix.multiplyRight(t)}n.scale&&e.matrix.scale(n.scale)}const zu=new Jo;function u9(n,e,t,i,s){if(e==="rotation"){zu.slerp({start:t,target:i,ratio:s});for(let r=0;r<zu.length;r++)n[e][r]=zu[r]}else for(let r=0;r<t.length;r++)n[e][r]=s*i[r]+(1-s)*t[r]}function h9(n,e,{p0:t,outTangent0:i,inTangent1:s,p1:r,tDiff:o,ratio:a}){for(let l=0;l<n[e].length;l++){const f=i[l]*o,g=s[l]*o;n[e][l]=(2*Math.pow(a,3)-3*Math.pow(a,2)+1)*t[l]+(Math.pow(a,3)-2*Math.pow(a,2)+a)*f+(-2*Math.pow(a,3)+3*Math.pow(a,2))*r[l]+(Math.pow(a,3)-Math.pow(a,2))*g}}function f9(n,e,t){for(let i=0;i<t.length;i++)n[e][i]=t[i]}function d9(n,{input:e,interpolation:t,output:i},s,r){const o=e[e.length-1],a=n%o,l=e.findIndex(v=>v>=a),f=Math.max(0,l-1);if(!Array.isArray(s[r]))switch(r){case"translation":s[r]=[0,0,0];break;case"rotation":s[r]=[0,0,0,1];break;case"scale":s[r]=[1,1,1];break;default:ye.warn(`Bad animation path ${r}`)()}const g=e[f],_=e[l];switch(t){case"STEP":f9(s,r,i[f]);break;case"LINEAR":if(_>g){const v=(a-g)/(_-g);u9(s,r,i[f],i[l],v)}break;case"CUBICSPLINE":if(_>g){const v=(a-g)/(_-g),T=_-g,C=i[3*f+1],S=i[3*f+2],R=i[3*l+0],P=i[3*l+1];h9(s,r,{p0:C,outTangent0:S,inTangent1:R,p1:P,tDiff:T,ratio:v})}break;default:ye.warn(`Interpolation ${t} not supported`)();break}}const g9=`
layout(0) positions: vec4; // in vec4 POSITION;

  #ifdef HAS_NORMALS
    in vec4 normals; // in vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    in vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // in vec2 TEXCOORD_0;
    in vec2 texCoords;
  #endif

@vertex
  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * positions;
  }

@fragment
  out vec4 fragmentColor;

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`,p9=`#version 300 es

  // in vec4 POSITION;
  in vec4 positions;

  #ifdef HAS_NORMALS
    // in vec4 NORMAL;
    in vec4 normals;
  #endif

  #ifdef HAS_TANGENTS
    in vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // in vec2 TEXCOORD_0;
    in vec2 texCoords;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = pbrProjection.modelViewProjectionMatrix * positions;
  }
`,m9=`#version 300 es
  out vec4 fragmentColor;

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`;function _9(n,e){const{id:t,geometry:i,material:s,vertexCount:r,materialOptions:o,modelOptions:a}=e,l=oT(n,s,i.attributes,o);ye.info(4,"createGLTFModel defines: ",l.defines)();const f=[],g={depthWriteEnabled:!0,depthCompare:"less",depthFormat:"depth24plus",cullMode:"back"},_={id:t,source:g9,vs:p9,fs:m9,geometry:i,topology:i.topology,vertexCount:r,modules:[qf],...a,defines:{...l.defines,...a.defines},parameters:{...g,...l.parameters,...a.parameters}},v=new Nt(n,_),{camera:T,...C}={...l.uniforms,...a.uniforms,...l.bindings,...a.bindings};return v.shaderInputs.setProps({pbrMaterial:C,pbrProjection:{camera:T}}),new Wh({managedResources:f,model:v})}var Ms;(function(n){n[n.POINTS=0]="POINTS",n[n.LINES=1]="LINES",n[n.LINE_LOOP=2]="LINE_LOOP",n[n.LINE_STRIP=3]="LINE_STRIP",n[n.TRIANGLES=4]="TRIANGLES",n[n.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",n[n.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(Ms||(Ms={}));function y9(n){switch(n){case Ms.POINTS:return"point-list";case Ms.LINES:return"line-list";case Ms.LINE_STRIP:return"line-strip";case Ms.TRIANGLES:return"triangle-list";case Ms.TRIANGLE_STRIP:return"triangle-strip";default:throw new Error(String(n))}}const b9={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class v9{constructor(e,t={}){x(this,"device");x(this,"options");x(this,"gltf");this.device=e,this.options={...b9,...t}}instantiate(e){return this.gltf=lf(e),(this.gltf.scenes||[]).map(i=>this.createScene(i))}createAnimator(){return Array.isArray(this.gltf.animations)?new l9(this.gltf):null}createScene(e){const i=(e.nodes||[]).map(r=>this.createNode(r));return new zr({id:e.name||e.id,children:i})}createNode(e){if(!e._node){const s=(e.children||[]).map(o=>this.createNode(o));e.mesh&&s.push(this.createMesh(e.mesh));const r=new zr({id:e.name||e.id,children:s});if(e.matrix)r.setMatrix(e.matrix);else{if(r.matrix.identity(),e.translation&&r.matrix.translate(e.translation),e.rotation){const o=new Ge().fromQuaternion(e.rotation);r.matrix.multiplyRight(o)}e.scale&&r.matrix.scale(e.scale)}e._node=r}const t=this.gltf.nodes.find(i=>i.id===e.id);return t._node=e._node,e._node}createMesh(e){if(!e._mesh){const i=(e.primitives||[]).map((r,o)=>this.createPrimitive(r,o,e)),s=new zr({id:e.name||e.id,children:i});e._mesh=s}return e._mesh}createPrimitive(e,t,i){const s=e.name||`${i.name||i.id}-primitive-${t}`,r=y9(e.mode||4),o=e.indices?e.indices.count:this.getVertexCount(e.attributes),a=_9(this.device,{id:s,geometry:this.createGeometry(s,e,r),material:e.material,materialOptions:this.options,modelOptions:this.options.modelOptions,vertexCount:o});return a.bounds=[e.attributes.POSITION.min,e.attributes.POSITION.max],a}getVertexCount(e){throw new Error("getVertexCount not implemented")}createGeometry(e,t,i){const s={};for(const[r,o]of Object.entries(t.attributes)){const{components:a,size:l,value:f}=o;s[r]={size:l??a,value:f}}return new un({id:e,topology:i,indices:t.indices.value,attributes:s})}createBuffer(e,t){e.bufferView||(e.bufferView={});const{bufferView:i}=e;return i.lumaBuffers||(i.lumaBuffers={}),i.lumaBuffers[t]||(i.lumaBuffers[t]=this.device.createBuffer({id:`from-${i.id}`,data:i.data||e.value})),i.lumaBuffers[t]}createSampler(e){return e}needsPOT(){return!1}}function lf(n){if(ArrayBuffer.isView(n)||n instanceof ArrayBuffer||n instanceof ImageBitmap)return n;if(Array.isArray(n))return n.map(lf);if(n&&typeof n=="object"){const e={};for(const t in n)e[t]=lf(n[t]);return e}return n}function T9(n,e,t){const i=new v9(n,t),s=i.instantiate(e),r=i.createAnimator();return{scenes:s,animator:r}}function Ln(n,e){if(!n)throw new Error(e||"assert failed: gltf")}const cT={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},AT={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},w9=1.33,$_=["SCALAR","VEC2","VEC3","VEC4"],E9=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],x9=new Map(E9),C9={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},S9={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},I9={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function uT(n){return $_[n-1]||$_[0]}function cA(n){const e=x9.get(n.constructor);if(!e)throw new Error("Illegal typed array");return e}function Md(n,e){const t=I9[n.componentType],i=C9[n.type],s=S9[n.componentType],r=n.count*i,o=n.count*i*s;Ln(o>=0&&o<=e.byteLength);const a=AT[n.componentType],l=cT[n.type];return{ArrayType:t,length:r,byteLength:o,componentByteSize:a,numberOfComponentsInElement:l}}function hT(n){let{images:e,bufferViews:t}=n;e=e||[],t=t||[];const i=e.map(o=>o.bufferView);t=t.filter(o=>!i.includes(o));const s=t.reduce((o,a)=>o+a.byteLength,0),r=e.reduce((o,a)=>{const{width:l,height:f}=a.image;return o+l*f},0);return s+Math.ceil(4*r*w9)}function R9(n,e,t){const i=n.bufferViews[t];Ln(i);const s=i.buffer,r=e[s];Ln(r);const o=(i.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,o,i.byteLength)}function P9(n,e,t){var S,R;const i=typeof t=="number"?(S=n.accessors)==null?void 0:S[t]:t;if(!i)throw new Error(`No gltf accessor ${JSON.stringify(t)}`);const s=(R=n.bufferViews)==null?void 0:R[i.bufferView||0];if(!s)throw new Error(`No gltf buffer view for accessor ${s}`);const{arrayBuffer:r,byteOffset:o}=e[s.buffer],a=(o||0)+(i.byteOffset||0)+(s.byteOffset||0),{ArrayType:l,length:f,componentByteSize:g,numberOfComponentsInElement:_}=Md(i,s),v=g*_,T=s.byteStride||v;if(typeof s.byteStride>"u"||s.byteStride===v)return new l(r,a,f);const C=new l(f);for(let P=0;P<i.count;P++){const F=new l(r,a+P*T,_);C.set(F,P*_)}return C}function M9(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}class on{constructor(e){x(this,"gltf");x(this,"sourceBuffers");x(this,"byteLength");this.gltf={json:(e==null?void 0:e.json)||M9(),buffers:(e==null?void 0:e.buffers)||[],images:(e==null?void 0:e.images)||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){const t=this.getUsedExtensions().find(s=>s===e),i=this.getRequiredExtensions().find(s=>s===e);return typeof t=="string"||typeof i=="string"}getExtension(e){const t=this.getUsedExtensions().find(s=>s===e),i=this.json.extensions||{};return t?i[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(i=>i===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if(typeof t=="object")return t;const i=this.json[e]&&this.json[e][t];if(!i)throw new Error(`glTF file error: Could not find ${e}[${t}]`);return i}getTypedArrayForBufferView(e){e=this.getBufferView(e);const t=e.buffer,i=this.gltf.buffers[t];Ln(i);const s=(e.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,s,e.byteLength)}getTypedArrayForAccessor(e){const t=this.getAccessor(e);return P9(this.gltf.json,this.gltf.buffers,t)}getTypedArrayForImageData(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),s=this.getBuffer(t.buffer).data,r=t.byteOffset||0;return new Uint8Array(s,r,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,i){return e.extensions=e.extensions||{},e.extensions[t]=i,this.registerUsedExtension(t),this}setObjectExtension(e,t,i){const s=e.extensions||{};s[t]=i}removeObjectExtension(e,t){const i=(e==null?void 0:e.extensions)||{};if(i[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const s=this.json.extensionsRemoved;s.includes(t)||s.push(t)}delete i[t]}addExtension(e,t={}){return Ln(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e,t={}){return Ln(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(t=>t===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(t=>t===e)||this.json.extensionsRequired.push(e)}removeExtension(e){var t;if((t=this.json.extensions)!=null&&t[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const i=this.json.extensionsRemoved;i.includes(e)||i.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:t}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:t}),this.json.scenes.length-1}addNode(e){const{meshIndex:t,matrix:i}=e;this.json.nodes=this.json.nodes||[];const s={mesh:t};return i&&(s.matrix=i),this.json.nodes.push(s),this.json.nodes.length-1}addMesh(e){const{attributes:t,indices:i,material:s,mode:r=4}=e,a={primitives:[{attributes:this._addAttributes(t),mode:r}]};if(i){const l=this._addIndices(i);a.primitives[0].indices=l}return Number.isFinite(s)&&(a.primitives[0].material=s),this.json.meshes=this.json.meshes||[],this.json.meshes.push(a),this.json.meshes.length-1}addPointCloud(e){const i={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(i),this.json.meshes.length-1}addImage(e,t){const i=Pf(e),s=t||(i==null?void 0:i.mimeType),o={bufferView:this.addBufferView(e),mimeType:s};return this.json.images=this.json.images||[],this.json.images.push(o),this.json.images.length-1}addBufferView(e,t=0,i=this.byteLength){const s=e.byteLength;Ln(Number.isFinite(s)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const r={buffer:t,byteOffset:i,byteLength:s};return this.byteLength+=la(s,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(r),this.json.bufferViews.length-1}addAccessor(e,t){const i={bufferView:e,type:uT(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(i),this.json.accessors.length-1}addBinaryBuffer(e,t={size:3}){const i=this.addBufferView(e);let s={min:t.min,max:t.max};(!s.min||!s.max)&&(s=this._getAccessorMinMax(e,t.size));const r={size:t.size,componentType:cA(e),count:Math.round(e.length/t.size),min:s.min,max:s.max};return this.addAccessor(i,Object.assign(r,t))}addTexture(e){const{imageIndex:t}=e,i={source:t};return this.json.textures=this.json.textures||[],this.json.textures.push(i),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var r,o;const e=this.byteLength,t=new ArrayBuffer(e),i=new Uint8Array(t);let s=0;for(const a of this.sourceBuffers||[])s=Ex(a,i,s);(o=(r=this.json)==null?void 0:r.buffers)!=null&&o[0]?this.json.buffers[0].byteLength=e:this.json.buffers=[{byteLength:e}],this.gltf.binary=t,this.sourceBuffers=[t],this.gltf.buffers=[{arrayBuffer:t,byteOffset:0,byteLength:t.byteLength}]}_removeStringFromArray(e,t){let i=!0;for(;i;){const s=e.indexOf(t);s>-1?e.splice(s,1):i=!1}}_addAttributes(e={}){const t={};for(const i in e){const s=e[i],r=this._getGltfAttributeName(i),o=this.addBinaryBuffer(s.value,s);t[r]=o}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,t){const i={min:null,max:null};if(e.length<t)return i;i.min=[],i.max=[];const s=e.subarray(0,t);for(const r of s)i.min.push(r),i.max.push(r);for(let r=t;r<e.length;r+=t)for(let o=0;o<t;o++)i.min[0+o]=Math.min(i.min[0+o],e[r+o]),i.max[0+o]=Math.max(i.max[0+o],e[r+o]);return i}}function X_(n){return(n%1+1)%1}const fT={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},B9={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},dT={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function Bd(n,e){return dT[e]*fT[n]}function AA(n,e,t,i){if(t!=="UINT8"&&t!=="UINT16"&&t!=="UINT32"&&t!=="UINT64")return null;const s=n.getTypedArrayForBufferView(e),r=uA(s,"SCALAR",t,i+1);return r instanceof BigInt64Array||r instanceof BigUint64Array?null:r}function uA(n,e,t,i=1){const s=fT[e],r=B9[t],o=dT[t],a=i*s,l=a*o;let f=n.buffer,g=n.byteOffset;return g%o!==0&&(f=new Uint8Array(f).slice(g,g+l).buffer,g=0),new r(f,g,a)}function Od(n,e,t){var f,g,_,v,T;const i=`TEXCOORD_${e.texCoord||0}`,s=t.attributes[i],r=n.getTypedArrayForAccessor(s),o=n.gltf.json,a=e.index,l=(g=(f=o.textures)==null?void 0:f[a])==null?void 0:g.source;if(typeof l<"u"){const C=(v=(_=o.images)==null?void 0:_[l])==null?void 0:v.mimeType,S=(T=n.gltf.images)==null?void 0:T[l];if(S&&typeof S.width<"u"){const R=[];for(let P=0;P<r.length;P+=2){const F=O9(S,C,r,P,e.channels);R.push(F)}return R}}return[]}function gT(n,e,t,i,s){if(!(t!=null&&t.length))return;const r=[];for(const g of t){let _=i.findIndex(v=>v===g);_===-1&&(_=i.push(g)-1),r.push(_)}const o=new Uint32Array(r),a=n.gltf.buffers.push({arrayBuffer:o.buffer,byteOffset:o.byteOffset,byteLength:o.byteLength})-1,l=n.addBufferView(o,a,0),f=n.addAccessor(l,{size:1,componentType:cA(o),count:o.length});s.attributes[e]=f}function O9(n,e,t,i,s=[0]){const r={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},o=t[i],a=t[i+1];let l=1;e&&(e.indexOf("image/jpeg")!==-1||e.indexOf("image/png")!==-1)&&(l=4);const f=D9(o,a,n,l);let g=0;for(const _ of s){const v=typeof _=="number"?Object.values(r)[_]:r[_],T=f+v.offset,C=E1(n);if(C.data.length<=T)throw new Error(`${C.data.length} <= ${T}`);const S=C.data[T];g|=S<<v.shift}return g}function D9(n,e,t,i=1){const s=t.width,r=X_(n)*(s-1),o=Math.round(r),a=t.height,l=X_(e)*(a-1),f=Math.round(l),g=t.components?t.components:i;return(f*s+o)*g}function pT(n,e,t,i,s){const r=[];for(let o=0;o<e;o++){const a=t[o],l=t[o+1]-t[o];if(l+a>i)break;const f=a/s,g=l/s;r.push(n.slice(f,f+g))}return r}function mT(n,e,t){const i=[];for(let s=0;s<e;s++){const r=s*t;i.push(n.slice(r,r+t))}return i}function _T(n,e,t,i){if(t)throw new Error("Not implemented - arrayOffsets for strings is specified");if(i){const s=[],r=new TextDecoder("utf8");let o=0;for(let a=0;a<n;a++){const l=i[a+1]-i[a];if(l+o<=e.length){const f=e.subarray(o,l+o),g=r.decode(f);s.push(g),o+=l}}return s}return[]}const Wr="EXT_mesh_features",N9=Wr;async function F9(n,e){const t=new on(n);k9(t,e)}function L9(n,e){const t=new on(n);return V9(t),t.createBinaryChunk(),t.gltf}function k9(n,e){const t=n.gltf.json;if(t.meshes)for(const i of t.meshes)for(const s of i.primitives)U9(n,s,e)}function U9(n,e,t){var r,o,a;if(!((r=t==null?void 0:t.gltf)!=null&&r.loadBuffers))return;const i=(o=e.extensions)==null?void 0:o[Wr],s=i==null?void 0:i.featureIds;if(s)for(const l of s){let f;if(typeof l.attribute<"u"){const g=`_FEATURE_ID_${l.attribute}`,_=e.attributes[g];f=n.getTypedArrayForAccessor(_)}else typeof l.texture<"u"&&((a=t==null?void 0:t.gltf)!=null&&a.loadImages)?f=Od(n,l.texture,e):f=[];l.data=f}}function V9(n,e){const t=n.gltf.json.meshes;if(t)for(const i of t)for(const s of i.primitives)H9(n,s)}function z9(n,e,t,i){e.extensions||(e.extensions={});let s=e.extensions[Wr];s||(s={featureIds:[]},e.extensions[Wr]=s);const{featureIds:r}=s,o={featureCount:t.length,propertyTable:i,data:t};r.push(o),n.addObjectExtension(e,Wr,s)}function H9(n,e){var s;const t=(s=e.extensions)==null?void 0:s[Wr];if(!t)return;const i=t.featureIds;i.forEach((r,o)=>{if(r.data){const{accessorKey:a,index:l}=G9(e.attributes),f=new Uint32Array(r.data);i[o]={featureCount:f.length,propertyTable:r.propertyTable,attribute:l},n.gltf.buffers.push({arrayBuffer:f.buffer,byteOffset:f.byteOffset,byteLength:f.byteLength});const g=n.addBufferView(f),_=n.addAccessor(g,{size:1,componentType:cA(f),count:f.length});e.attributes[a]=_}})}function G9(n){const e="_FEATURE_ID_",t=Object.keys(n).filter(r=>r.indexOf(e)===0);let i=-1;for(const r of t){const o=Number(r.substring(e.length));o>i&&(i=o)}return i++,{accessorKey:`${e}${i}`,index:i}}const W9=Object.freeze(Object.defineProperty({__proto__:null,createExtMeshFeatures:z9,decode:F9,encode:L9,name:N9},Symbol.toStringTag,{value:"Module"})),Jr="EXT_structural_metadata",j9=Jr;async function $9(n,e){const t=new on(n);Q9(t,e)}function X9(n,e){const t=new on(n);return Az(t),t.createBinaryChunk(),t.gltf}function Q9(n,e){var i,s;if(!((i=e.gltf)!=null&&i.loadBuffers))return;const t=n.getExtension(Jr);t&&((s=e.gltf)!=null&&s.loadImages&&Y9(n,t),K9(n,t))}function Y9(n,e){const t=e.propertyTextures,i=n.gltf.json;if(t&&i.meshes)for(const s of i.meshes)for(const r of s.primitives)J9(n,t,r,e)}function K9(n,e){const t=e.schema;if(!t)return;const i=t.classes,s=e.propertyTables;if(i&&s)for(const r in i){const o=q9(s,r);o&&ez(n,t,o)}}function q9(n,e){for(const t of n)if(t.class===e)return t;return null}function J9(n,e,t,i){var o;if(!e)return;const s=(o=t.extensions)==null?void 0:o[Jr],r=s==null?void 0:s.propertyTextures;if(r)for(const a of r){const l=e[a];Z9(n,l,t,i)}}function Z9(n,e,t,i){var r;if(!e.properties)return;i.dataAttributeNames||(i.dataAttributeNames=[]);const s=e.class;for(const o in e.properties){const a=`${s}_${o}`,l=(r=e.properties)==null?void 0:r[o];if(!l)continue;l.data||(l.data=[]);const f=l.data,g=Od(n,l,t);g!==null&&(gT(n,a,g,f,t),l.data=f,i.dataAttributeNames.push(a))}}function ez(n,e,t){var r,o;const i=(r=e.classes)==null?void 0:r[t.class];if(!i)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${t.class}`);const s=t.count;for(const a in i.properties){const l=i.properties[a],f=(o=t.properties)==null?void 0:o[a];if(f){const g=tz(n,e,l,s,f);f.data=g}}}function tz(n,e,t,i,s){let r=[];const o=s.values,a=n.getTypedArrayForBufferView(o),l=nz(n,t,s,i),f=iz(n,s,i);switch(t.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{r=sz(t,i,a,l);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${t.type}`);case"STRING":{r=_T(i,a,l,f);break}case"ENUM":{r=rz(e,t,i,a,l);break}default:throw new Error(`Unknown classProperty type ${t.type}`)}return r}function nz(n,e,t,i){return e.array&&typeof e.count>"u"&&typeof t.arrayOffsets<"u"?AA(n,t.arrayOffsets,t.arrayOffsetType||"UINT32",i):null}function iz(n,e,t){return typeof e.stringOffsets<"u"?AA(n,e.stringOffsets,e.stringOffsetType||"UINT32",t):null}function sz(n,e,t,i){const s=n.array,r=n.count,o=Bd(n.type,n.componentType),a=t.byteLength/o;let l;return n.componentType?l=uA(t,n.type,n.componentType,a):l=t,s?i?pT(l,e,i,t.length,o):r?mT(l,e,r):[]:l}function rz(n,e,t,i,s){var _;const r=e.enumType;if(!r)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const o=(_=n.enums)==null?void 0:_[r];if(!o)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${r}`);const a=o.valueType||"UINT16",l=Bd(e.type,a),f=i.byteLength/l;let g=uA(i,e.type,a,f);if(g||(g=i),e.array){if(s)return oz({valuesData:g,numberOfElements:t,arrayOffsets:s,valuesDataBytesLength:i.length,elementSize:l,enumEntry:o});const v=e.count;return v?az(g,t,v,o):[]}return Dd(g,0,t,o)}function oz(n){const{valuesData:e,numberOfElements:t,arrayOffsets:i,valuesDataBytesLength:s,elementSize:r,enumEntry:o}=n,a=[];for(let l=0;l<t;l++){const f=i[l],g=i[l+1]-i[l];if(g+f>s)break;const _=f/r,v=g/r,T=Dd(e,_,v,o);a.push(T)}return a}function az(n,e,t,i){const s=[];for(let r=0;r<e;r++){const o=t*r,a=Dd(n,o,t,i);s.push(a)}return s}function Dd(n,e,t,i){const s=[];for(let r=0;r<t;r++)if(n instanceof BigInt64Array||n instanceof BigUint64Array)s.push("");else{const o=n[e+r],a=lz(i,o);a?s.push(a.name):s.push("")}return s}function lz(n,e){for(const t of n.values)if(t.value===e)return t;return null}const cz="schemaClassId";function Az(n,e){var i,s;const t=n.getExtension(Jr);if(t&&t.propertyTables)for(const r of t.propertyTables){const o=r.class,a=(s=(i=t.schema)==null?void 0:i.classes)==null?void 0:s[o];r.properties&&a&&uz(r,a,n)}}function uz(n,e,t){for(const i in n.properties){const s=n.properties[i].data;if(s){const r=e.properties[i];if(r){const o=gz(s,r,t);n.properties[i]=o}}}}function hz(n,e,t=cz){let i=n.getExtension(Jr);i||(i=n.addExtension(Jr)),i.schema=fz(e,t,i.schema);const s=dz(e,t,i.schema);return i.propertyTables||(i.propertyTables=[]),i.propertyTables.push(s)-1}function fz(n,e,t){const i=t??{id:"schema_id"},s={properties:{}};for(const r of n){const o={type:r.elementType,componentType:r.componentType};s.properties[r.name]=o}return i.classes={},i.classes[e]=s,i}function dz(n,e,t){var o;const i={class:e,count:0};let s=0;const r=(o=t.classes)==null?void 0:o[e];for(const a of n){if(s===0&&(s=a.values.length),s!==a.values.length&&a.values.length)throw new Error("Illegal values in attributes");(r==null?void 0:r.properties[a.name])&&(i.properties||(i.properties={}),i.properties[a.name]={values:0,data:a.values})}return i.count=s,i}function gz(n,e,t){const i={values:0};if(e.type==="STRING"){const{stringData:s,stringOffsets:r}=_z(n);i.stringOffsets=Hu(r,t),i.values=Hu(s,t)}else if(e.type==="SCALAR"&&e.componentType){const s=mz(n,e.componentType);i.values=Hu(s,t)}return i}const pz={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function mz(n,e){const t=[];for(const s of n)t.push(Number(s));const i=pz[e];if(!i)throw new Error("Illegal component type");return new i(t)}function _z(n){const e=new TextEncoder,t=[];let i=0;for(const l of n){const f=e.encode(l);i+=f.length,t.push(f)}const s=new Uint8Array(i),r=[];let o=0;for(const l of t)s.set(l,o),r.push(o),o+=l.length;r.push(o);const a=new Uint32Array(r);return{stringData:s,stringOffsets:a}}function Hu(n,e){return e.gltf.buffers.push({arrayBuffer:n.buffer,byteOffset:n.byteOffset,byteLength:n.byteLength}),e.addBufferView(n)}const yz=Object.freeze(Object.defineProperty({__proto__:null,createExtStructuralMetadata:hz,decode:$9,encode:X9,name:j9},Symbol.toStringTag,{value:"Module"})),yT="EXT_feature_metadata",bz=yT;async function vz(n,e){const t=new on(n);Tz(t,e)}function Tz(n,e){var i,s;if(!((i=e.gltf)!=null&&i.loadBuffers))return;const t=n.getExtension(yT);t&&((s=e.gltf)!=null&&s.loadImages&&wz(n,t),Ez(n,t))}function wz(n,e){const t=e.schema;if(!t)return;const i=t.classes,{featureTextures:s}=e;if(i&&s)for(const r in i){const o=i[r],a=Cz(s,r);a&&Iz(n,a,o)}}function Ez(n,e){const t=e.schema;if(!t)return;const i=t.classes,s=e.featureTables;if(i&&s)for(const r in i){const o=xz(s,r);o&&Sz(n,t,o)}}function xz(n,e){for(const t in n){const i=n[t];if(i.class===e)return i}return null}function Cz(n,e){for(const t in n){const i=n[t];if(i.class===e)return i}return null}function Sz(n,e,t){var r,o;if(!t.class)return;const i=(r=e.classes)==null?void 0:r[t.class];if(!i)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${t.class}`);const s=t.count;for(const a in i.properties){const l=i.properties[a],f=(o=t.properties)==null?void 0:o[a];if(f){const g=Rz(n,e,l,s,f);f.data=g}}}function Iz(n,e,t){var s;const i=e.class;for(const r in t.properties){const o=(s=e==null?void 0:e.properties)==null?void 0:s[r];if(o){const a=Dz(n,o,i);o.data=a}}}function Rz(n,e,t,i,s){let r=[];const o=s.bufferView,a=n.getTypedArrayForBufferView(o),l=Pz(n,t,s,i),f=Mz(n,t,s,i);return t.type==="STRING"||t.componentType==="STRING"?r=_T(i,a,l,f):Bz(t)&&(r=Oz(t,i,a,l)),r}function Pz(n,e,t,i){return e.type==="ARRAY"&&typeof e.componentCount>"u"&&typeof t.arrayOffsetBufferView<"u"?AA(n,t.arrayOffsetBufferView,t.offsetType||"UINT32",i):null}function Mz(n,e,t,i){return typeof t.stringOffsetBufferView<"u"?AA(n,t.stringOffsetBufferView,t.offsetType||"UINT32",i):null}function Bz(n){const e=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return e.includes(n.type)||typeof n.componentType<"u"&&e.includes(n.componentType)}function Oz(n,e,t,i){const s=n.type==="ARRAY",r=n.componentCount,o="SCALAR",a=n.componentType||n.type,l=Bd(o,a),f=t.byteLength/l,g=uA(t,o,a,f);return s?i?pT(g,e,i,t.length,l):r?mT(g,e,r):[]:g}function Dz(n,e,t){const i=n.gltf.json;if(!i.meshes)return[];const s=[];for(const r of i.meshes)for(const o of r.primitives)Nz(n,t,e,s,o);return s}function Nz(n,e,t,i,s){const r={channels:t.channels,...t.texture},o=Od(n,r,s);o&&gT(n,e,o,i,s)}const Fz=Object.freeze(Object.defineProperty({__proto__:null,decode:vz,name:bz},Symbol.toStringTag,{value:"Module"})),Lz="4.3.2",Zr=!0,Q_=1735152710,Nd=12,xc=8,kz=1313821514,Uz=5130562,Vz=0,zz=0,Hz=1;function Gz(n,e=0){return`${String.fromCharCode(n.getUint8(e+0))}${String.fromCharCode(n.getUint8(e+1))}${String.fromCharCode(n.getUint8(e+2))}${String.fromCharCode(n.getUint8(e+3))}`}function Wz(n,e=0,t={}){const i=new DataView(n),{magic:s=Q_}=t,r=i.getUint32(e,!1);return r===s||r===Q_}function jz(n,e,t=0,i={}){const s=new DataView(e),r=Gz(s,t+0),o=s.getUint32(t+4,Zr),a=s.getUint32(t+8,Zr);switch(Object.assign(n,{header:{byteOffset:t,byteLength:a,hasBinChunk:!1},type:r,version:o,json:{},binChunks:[]}),t+=Nd,n.version){case 1:return $z(n,s,t);case 2:return Xz(n,s,t,i={});default:throw new Error(`Invalid GLB version ${n.version}. Only supports version 1 and 2.`)}}function $z(n,e,t){Rt(n.header.byteLength>Nd+xc);const i=e.getUint32(t+0,Zr),s=e.getUint32(t+4,Zr);return t+=xc,Rt(s===Vz),cf(n,e,t,i),t+=i,t+=Af(n,e,t,n.header.byteLength),t}function Xz(n,e,t,i){return Rt(n.header.byteLength>Nd+xc),Qz(n,e,t,i),t+n.header.byteLength}function Qz(n,e,t,i){for(;t+8<=n.header.byteLength;){const s=e.getUint32(t+0,Zr),r=e.getUint32(t+4,Zr);switch(t+=xc,r){case kz:cf(n,e,t,s);break;case Uz:Af(n,e,t,s);break;case zz:i.strict||cf(n,e,t,s);break;case Hz:i.strict||Af(n,e,t,s);break}t+=la(s,4)}return t}function cf(n,e,t,i){const s=new Uint8Array(e.buffer,t,i),o=new TextDecoder("utf8").decode(s);return n.json=JSON.parse(o),la(i,4)}function Af(n,e,t,i){return n.header.hasBinChunk=!0,n.binChunks.push({byteOffset:t,byteLength:i,arrayBuffer:e.buffer}),la(i,4)}function bT(n,e){if(n.startsWith("data:")||n.startsWith("http:")||n.startsWith("https:"))return n;const i=e.baseUri||e.uri;if(!i)throw new Error(`'baseUri' must be provided to resolve relative url ${n}`);return i.substr(0,i.lastIndexOf("/")+1)+n}const Yz="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",Kz="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",qz=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),Jz=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),Zz={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},e7={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function t7(n,e,t,i,s,r="NONE"){const o=await n7();r7(o,o.exports[e7[s]],n,e,t,i,o.exports[Zz[r||"NONE"]])}let Gu;async function n7(){return Gu||(Gu=i7()),Gu}async function i7(){let n=Yz;WebAssembly.validate(qz)&&(n=Kz,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(s7(n),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function s7(n){const e=new Uint8Array(n.length);for(let i=0;i<n.length;++i){const s=n.charCodeAt(i);e[i]=s>96?s-71:s>64?s-65:s>47?s+4:s>46?63:62}let t=0;for(let i=0;i<n.length;++i)e[t++]=e[i]<60?Jz[e[i]]:(e[i]-60)*64+e[++i];return e.buffer.slice(0,t)}function r7(n,e,t,i,s,r,o){const a=n.exports.sbrk,l=i+3&-4,f=a(l*s),g=a(r.length),_=new Uint8Array(n.exports.memory.buffer);_.set(r,g);const v=e(f,i,s,g,r.length);if(v===0&&o&&o(f,l,s),t.set(_.subarray(f,f+i*s)),a(f-a(0)),v!==0)throw new Error(`Malformed buffer data: ${v}`)}const Cc="EXT_meshopt_compression",o7=Cc;async function a7(n,e){var s,r;const t=new on(n);if(!((s=e==null?void 0:e.gltf)!=null&&s.decompressMeshes)||!((r=e.gltf)!=null&&r.loadBuffers))return;const i=[];for(const o of n.json.bufferViews||[])i.push(l7(t,o));await Promise.all(i),t.removeExtension(Cc)}async function l7(n,e){const t=n.getObjectExtension(e,Cc);if(t){const{byteOffset:i=0,byteLength:s=0,byteStride:r,count:o,mode:a,filter:l="NONE",buffer:f}=t,g=n.gltf.buffers[f],_=new Uint8Array(g.arrayBuffer,g.byteOffset+i,s),v=new Uint8Array(n.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);await t7(v,o,r,_,a,l),n.removeObjectExtension(e,Cc)}}const c7=Object.freeze(Object.defineProperty({__proto__:null,decode:a7,name:o7},Symbol.toStringTag,{value:"Module"})),Cr="EXT_texture_webp",A7=Cr;function u7(n,e){const t=new on(n);if(!_S("image/webp")){if(t.getRequiredExtensions().includes(Cr))throw new Error(`gltf: Required extension ${Cr} not supported by browser`);return}const{json:i}=t;for(const s of i.textures||[]){const r=t.getObjectExtension(s,Cr);r&&(s.source=r.source),t.removeObjectExtension(s,Cr)}t.removeExtension(Cr)}const h7=Object.freeze(Object.defineProperty({__proto__:null,name:A7,preprocess:u7},Symbol.toStringTag,{value:"Module"})),Dl="KHR_texture_basisu",f7=Dl;function d7(n,e){const t=new on(n),{json:i}=t;for(const s of i.textures||[]){const r=t.getObjectExtension(s,Dl);r&&(s.source=r.source,t.removeObjectExtension(s,Dl))}t.removeExtension(Dl)}const g7=Object.freeze(Object.defineProperty({__proto__:null,name:f7,preprocess:d7},Symbol.toStringTag,{value:"Module"})),p7="4.3.2",m7={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:p7,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function _7(n,e,t){const i=vT(e.metadata),s=[],r=y7(e.attributes);for(const o in n){const a=n[o],l=Y_(o,a,r[o]);s.push(l)}if(t){const o=Y_("indices",t);s.push(o)}return{fields:s,metadata:i}}function y7(n){const e={};for(const t in n){const i=n[t];e[i.name||"undefined"]=i}return e}function Y_(n,e,t){const i=t?vT(t.metadata):void 0;return kC(n,e,i)}function vT(n){Object.entries(n);const e={};for(const t in n)e[`${t}.string`]=JSON.stringify(n[t]);return e}const K_={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},b7={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},v7=4;class T7{constructor(e){x(this,"draco");x(this,"decoder");x(this,"metadataQuerier");this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e,t={}){const i=new this.draco.DecoderBuffer;i.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(t);const s=this.decoder.GetEncodedGeometryType(i),r=s===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let o;switch(s){case this.draco.TRIANGULAR_MESH:o=this.decoder.DecodeBufferToMesh(i,r);break;case this.draco.POINT_CLOUD:o=this.decoder.DecodeBufferToPointCloud(i,r);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!o.ok()||!r.ptr){const v=`DRACO decompression failed: ${o.error_msg()}`;throw new Error(v)}const a=this._getDracoLoaderData(r,s,t),l=this._getMeshData(r,a,t),f=w1(l.attributes),g=_7(l.attributes,a,l.indices);return{loader:"draco",loaderData:a,header:{vertexCount:r.num_points(),boundingBox:f},...l,schema:g}}finally{this.draco.destroy(i),r&&this.draco.destroy(r)}}_getDracoLoaderData(e,t,i){const s=this._getTopLevelMetadata(e),r=this._getDracoAttributes(e,i);return{geometry_type:t,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:s,attributes:r}}_getDracoAttributes(e,t){const i={};for(let s=0;s<e.num_attributes();s++){const r=this.decoder.GetAttribute(e,s),o=this._getAttributeMetadata(e,s);i[r.unique_id()]={unique_id:r.unique_id(),attribute_type:r.attribute_type(),data_type:r.data_type(),num_components:r.num_components(),byte_offset:r.byte_offset(),byte_stride:r.byte_stride(),normalized:r.normalized(),attribute_index:s,metadata:o};const a=this._getQuantizationTransform(r,t);a&&(i[r.unique_id()].quantization_transform=a);const l=this._getOctahedronTransform(r,t);l&&(i[r.unique_id()].octahedron_transform=l)}return i}_getMeshData(e,t,i){const s=this._getMeshAttributes(t,e,i);if(!s.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(i.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:s,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:s,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:s}}_getMeshAttributes(e,t,i){const s={};for(const r of Object.values(e.attributes)){const o=this._deduceAttributeName(r,i);r.name=o;const a=this._getAttributeValues(t,r);if(a){const{value:l,size:f}=a;s[o]={value:l,size:f,byteOffset:r.byte_offset,byteStride:r.byte_stride,normalized:r.normalized}}}return s}_getTriangleListIndices(e){const i=e.num_faces()*3,s=i*v7,r=this.draco._malloc(s);try{return this.decoder.GetTrianglesUInt32Array(e,s,r),new Uint32Array(this.draco.HEAPF32.buffer,r,i).slice()}finally{this.draco._free(r)}}_getTriangleStripIndices(e){const t=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,t),x7(t)}finally{this.draco.destroy(t)}}_getAttributeValues(e,t){const i=b7[t.data_type];if(!i)return console.warn(`DRACO: Unsupported attribute type ${t.data_type}`),null;const s=t.num_components,o=e.num_points()*s,a=o*i.BYTES_PER_ELEMENT,l=w7(this.draco,i);let f;const g=this.draco._malloc(a);try{const _=this.decoder.GetAttribute(e,t.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,_,l,a,g),f=new i(this.draco.HEAPF32.buffer,g,o).slice()}finally{this.draco._free(g)}return{value:f,size:s}}_deduceAttributeName(e,t){const i=e.unique_id;for(const[o,a]of Object.entries(t.extraAttributes||{}))if(a===i)return o;const s=e.attribute_type;for(const o in K_)if(this.draco[o]===s)return K_[o];const r=t.attributeNameEntry||"name";return e.metadata[r]?e.metadata[r].string:`CUSTOM_ATTRIBUTE_${i}`}_getTopLevelMetadata(e){const t=this.decoder.GetMetadata(e);return this._getDracoMetadata(t)}_getAttributeMetadata(e,t){const i=this.decoder.GetAttributeMetadata(e,t);return this._getDracoMetadata(i)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const t={},i=this.metadataQuerier.NumEntries(e);for(let s=0;s<i;s++){const r=this.metadataQuerier.GetEntryName(e,s);t[r]=this._getDracoMetadataField(e,r)}return t}_getDracoMetadataField(e,t){const i=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,t,i);const s=E7(i);return{int:this.metadataQuerier.GetIntEntry(e,t),string:this.metadataQuerier.GetStringEntry(e,t),double:this.metadataQuerier.GetDoubleEntry(e,t),intArray:s}}finally{this.draco.destroy(i)}}_disableAttributeTransforms(e){const{quantizedAttributes:t=[],octahedronAttributes:i=[]}=e,s=[...t,...i];for(const r of s)this.decoder.SkipAttributeTransform(this.draco[r])}_getQuantizationTransform(e,t){const{quantizedAttributes:i=[]}=t,s=e.attribute_type();if(i.map(o=>this.decoder[o]).includes(s)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(e))return{quantization_bits:o.quantization_bits(),range:o.range(),min_values:new Float32Array([1,2,3]).map(a=>o.min_value(a))}}finally{this.draco.destroy(o)}}return null}_getOctahedronTransform(e,t){const{octahedronAttributes:i=[]}=t,s=e.attribute_type();if(i.map(o=>this.decoder[o]).includes(s)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(e))return{quantization_bits:o.quantization_bits()}}finally{this.draco.destroy(o)}}return null}}function w7(n,e){switch(e){case Float32Array:return n.DT_FLOAT32;case Int8Array:return n.DT_INT8;case Int16Array:return n.DT_INT16;case Int32Array:return n.DT_INT32;case Uint8Array:return n.DT_UINT8;case Uint16Array:return n.DT_UINT16;case Uint32Array:return n.DT_UINT32;default:return n.DT_INVALID}}function E7(n){const e=n.size(),t=new Int32Array(e);for(let i=0;i<e;i++)t[i]=n.GetValue(i);return t}function x7(n){const e=n.size(),t=new Int32Array(e);for(let i=0;i<e;i++)t[i]=n.GetValue(i);return t}const C7="1.5.6",S7="1.4.1",Wu=`https://www.gstatic.com/draco/versioned/decoders/${C7}`,Pn={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},ju={[Pn.DECODER]:`${Wu}/${Pn.DECODER}`,[Pn.DECODER_WASM]:`${Wu}/${Pn.DECODER_WASM}`,[Pn.FALLBACK_DECODER]:`${Wu}/${Pn.FALLBACK_DECODER}`,[Pn.ENCODER]:`https://raw.githubusercontent.com/google/draco/${S7}/javascript/${Pn.ENCODER}`};let $u;async function I7(n){const e=n.modules||{};return e.draco3d?$u||($u=e.draco3d.createDecoderModule({}).then(t=>({draco:t}))):$u||($u=R7(n)),await $u}async function R7(n){let e,t;switch(n.draco&&n.draco.decoderType){case"js":e=await Fs(ju[Pn.FALLBACK_DECODER],"draco",n,Pn.FALLBACK_DECODER);break;case"wasm":default:[e,t]=await Promise.all([await Fs(ju[Pn.DECODER],"draco",n,Pn.DECODER),await Fs(ju[Pn.DECODER_WASM],"draco",n,Pn.DECODER_WASM)])}return e=e||globalThis.DracoDecoderModule,await P7(e,t)}function P7(n,e){const t={};return e&&(t.wasmBinary=e),new Promise(i=>{n({...t,onModuleLoaded:s=>i({draco:s})})})}const TT={...m7,parse:M7};async function M7(n,e){const{draco:t}=await I7(e),i=new T7(t);try{return i.parseSync(n,e==null?void 0:e.draco)}finally{i.destroy()}}function B7(n){const e={};for(const t in n){const i=n[t];if(t!=="indices"){const s=wT(i);e[t]=s}}return e}function wT(n){const{buffer:e,size:t,count:i}=O7(n);return{value:e,size:t,byteOffset:0,count:i,type:uT(t),componentType:cA(e)}}function O7(n){let e=n,t=1,i=0;return n&&n.value&&(e=n.value,t=n.size||1),e&&(ArrayBuffer.isView(e)||(e=D7(e,Float32Array)),i=e.length/t),{buffer:e,size:t,count:i}}function D7(n,e,t=!1){return n?Array.isArray(n)?new e(n):t&&!(n instanceof e)?new e(n):n:null}const ds="KHR_draco_mesh_compression",N7=ds;function F7(n,e,t){const i=new on(n);for(const s of ET(i))i.getObjectExtension(s,ds)}async function L7(n,e,t){var r;if(!((r=e==null?void 0:e.gltf)!=null&&r.decompressMeshes))return;const i=new on(n),s=[];for(const o of ET(i))i.getObjectExtension(o,ds)&&s.push(U7(i,o,e,t));await Promise.all(s),i.removeExtension(ds)}function k7(n,e={}){const t=new on(n);for(const i of t.json.meshes||[])V7(i),t.addRequiredExtension(ds)}async function U7(n,e,t,i){const s=n.getObjectExtension(e,ds);if(!s)return;const r=n.getTypedArrayForBufferView(s.bufferView),o=wf(r.buffer,r.byteOffset),a={...t};delete a["3d-tiles"];const l=await aa(o,TT,a,i),f=B7(l.attributes);for(const[g,_]of Object.entries(f))if(g in e.attributes){const v=e.attributes[g],T=n.getAccessor(v);T!=null&&T.min&&(T!=null&&T.max)&&(_.min=T.min,_.max=T.max)}e.attributes=f,l.indices&&(e.indices=wT(l.indices)),n.removeObjectExtension(e,ds),z7(e)}function V7(n,e,t=4,i,s){var g;if(!i.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const r=i.DracoWriter.encodeSync({attributes:n}),o=(g=s==null?void 0:s.parseSync)==null?void 0:g.call(s,{attributes:n}),a=i._addFauxAttributes(o.attributes),l=i.addBufferView(r);return{primitives:[{attributes:a,mode:t,extensions:{[ds]:{bufferView:l,attributes:a}}}]}}function z7(n){if(!n.attributes&&Object.keys(n.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*ET(n){for(const e of n.json.meshes||[])for(const t of e.primitives)yield t}const H7=Object.freeze(Object.defineProperty({__proto__:null,decode:L7,encode:k7,name:N7,preprocess:F7},Symbol.toStringTag,{value:"Module"})),hA="KHR_texture_transform",G7=hA,hl=new ee,W7=new Wt,j7=new Wt;async function $7(n,e){var r;if(!new on(n).hasExtension(hA)||!((r=e.gltf)!=null&&r.loadBuffers))return;const s=n.json.materials||[];for(let o=0;o<s.length;o++)X7(o,n)}function X7(n,e){var r,o,a,l;const t=(r=e.json.materials)==null?void 0:r[n],i=[(o=t==null?void 0:t.pbrMetallicRoughness)==null?void 0:o.baseColorTexture,t==null?void 0:t.emissiveTexture,t==null?void 0:t.normalTexture,t==null?void 0:t.occlusionTexture,(a=t==null?void 0:t.pbrMetallicRoughness)==null?void 0:a.metallicRoughnessTexture],s=[];for(const f of i)f&&((l=f==null?void 0:f.extensions)!=null&&l[hA])&&Q7(e,n,f,s)}function Q7(n,e,t,i){const s=Y7(t,i);if(!s)return;const r=n.json.meshes||[];for(const o of r)for(const a of o.primitives){const l=a.material;Number.isFinite(l)&&e===l&&K7(n,a,s)}}function Y7(n,e){var o;const t=(o=n.extensions)==null?void 0:o[hA],{texCoord:i=0}=n,{texCoord:s=i}=t;if(!(e.findIndex(([a,l])=>a===i&&l===s)!==-1)){const a=Z7(t);return i!==s&&(n.texCoord=s),e.push([i,s]),{originalTexCoord:i,texCoord:s,matrix:a}}return null}function K7(n,e,t){var a,l;const{originalTexCoord:i,texCoord:s,matrix:r}=t,o=e.attributes[`TEXCOORD_${i}`];if(Number.isFinite(o)){const f=(a=n.json.accessors)==null?void 0:a[o];if(f&&f.bufferView){const g=(l=n.json.bufferViews)==null?void 0:l[f.bufferView];if(g){const{arrayBuffer:_,byteOffset:v}=n.buffers[g.buffer],T=(v||0)+(f.byteOffset||0)+(g.byteOffset||0),{ArrayType:C,length:S}=Md(f,g),R=AT[f.componentType],P=cT[f.type],F=g.byteStride||R*P,U=new Float32Array(S);for(let X=0;X<f.count;X++){const Z=new C(_,T+X*F,2);hl.set(Z[0],Z[1],1),hl.transformByMatrix3(r),U.set([hl[0],hl[1]],X*P)}i===s?q7(f,g,n.buffers,U):J7(s,f,e,n,U)}}}}function q7(n,e,t,i){n.componentType=5126,t.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength}),e.buffer=t.length-1,e.byteLength=i.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function J7(n,e,t,i,s){i.buffers.push({arrayBuffer:s.buffer,byteOffset:0,byteLength:s.buffer.byteLength});const r=i.json.bufferViews;if(!r)return;r.push({buffer:i.buffers.length-1,byteLength:s.buffer.byteLength,byteOffset:0});const o=i.json.accessors;o&&(o.push({bufferView:(r==null?void 0:r.length)-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),t.attributes[`TEXCOORD_${n}`]=o.length-1)}function Z7(n){const{offset:e=[0,0],rotation:t=0,scale:i=[1,1]}=n,s=new Wt().set(1,0,0,0,1,0,e[0],e[1],1),r=W7.set(Math.cos(t),Math.sin(t),0,-Math.sin(t),Math.cos(t),0,0,0,1),o=j7.set(i[0],0,0,0,i[1],0,0,0,1);return s.multiplyRight(r).multiplyRight(o)}const eH=Object.freeze(Object.defineProperty({__proto__:null,decode:$7,name:G7},Symbol.toStringTag,{value:"Module"})),Ns="KHR_lights_punctual",tH=Ns;async function nH(n){const e=new on(n),{json:t}=e,i=e.getExtension(Ns);i&&(e.json.lights=i.lights,e.removeExtension(Ns));for(const s of t.nodes||[]){const r=e.getObjectExtension(s,Ns);r&&(s.light=r.light),e.removeObjectExtension(s,Ns)}}async function iH(n){const e=new on(n),{json:t}=e;if(t.lights){const i=e.addExtension(Ns);Ln(!i.lights),i.lights=t.lights,delete t.lights}if(e.json.lights){for(const i of e.json.lights){const s=i.node;e.addObjectExtension(s,Ns,i)}delete e.json.lights}}const sH=Object.freeze(Object.defineProperty({__proto__:null,decode:nH,encode:iH,name:tH},Symbol.toStringTag,{value:"Module"})),sa="KHR_materials_unlit",rH=sa;async function oH(n){const e=new on(n),{json:t}=e;for(const i of t.materials||[])i.extensions&&i.extensions.KHR_materials_unlit&&(i.unlit=!0),e.removeObjectExtension(i,sa);e.removeExtension(sa)}function aH(n){const e=new on(n),{json:t}=e;if(e.materials)for(const i of t.materials||[])i.unlit&&(delete i.unlit,e.addObjectExtension(i,sa,{}),e.addExtension(sa))}const lH=Object.freeze(Object.defineProperty({__proto__:null,decode:oH,encode:aH,name:rH},Symbol.toStringTag,{value:"Module"})),Vo="KHR_techniques_webgl",cH=Vo;async function AH(n){const e=new on(n),{json:t}=e,i=e.getExtension(Vo);if(i){const s=hH(i,e);for(const r of t.materials||[]){const o=e.getObjectExtension(r,Vo);o&&(r.technique=Object.assign({},o,s[o.technique]),r.technique.values=fH(r.technique,e)),e.removeObjectExtension(r,Vo)}e.removeExtension(Vo)}}async function uH(n,e){}function hH(n,e){const{programs:t=[],shaders:i=[],techniques:s=[]}=n,r=new TextDecoder;return i.forEach(o=>{if(Number.isFinite(o.bufferView))o.code=r.decode(e.getTypedArrayForBufferView(o.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),t.forEach(o=>{o.fragmentShader=i[o.fragmentShader],o.vertexShader=i[o.vertexShader]}),s.forEach(o=>{o.program=t[o.program]}),s}function fH(n,e){const t=Object.assign({},n.values);return Object.keys(n.uniforms||{}).forEach(i=>{n.uniforms[i].value&&!(i in t)&&(t[i]=n.uniforms[i].value)}),Object.keys(t).forEach(i=>{typeof t[i]=="object"&&t[i].index!==void 0&&(t[i].texture=e.getTexture(t[i].index))}),t}const dH=Object.freeze(Object.defineProperty({__proto__:null,decode:AH,encode:uH,name:cH},Symbol.toStringTag,{value:"Module"})),xT=[yz,W9,c7,h7,g7,H7,sH,lH,dH,eH,Fz];function gH(n,e={},t){var s;const i=xT.filter(r=>CT(r.name,e));for(const r of i)(s=r.preprocess)==null||s.call(r,n,e,t)}async function pH(n,e={},t){var s;const i=xT.filter(r=>CT(r.name,e));for(const r of i)await((s=r.decode)==null?void 0:s.call(r,n,e,t))}function CT(n,e){var s;const t=((s=e==null?void 0:e.gltf)==null?void 0:s.excludeExtensions)||{};return!(n in t&&!t[n])}const Xu="KHR_binary_glTF";function mH(n){const e=new on(n),{json:t}=e;for(const i of t.images||[]){const s=e.getObjectExtension(i,Xu);s&&Object.assign(i,s),e.removeObjectExtension(i,Xu)}t.buffers&&t.buffers[0]&&delete t.buffers[0].uri,e.removeExtension(Xu)}const q_={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},_H={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class yH{constructor(){x(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}});x(this,"json")}normalize(e,t){this.json=e.json;const i=e.json;switch(i.asset&&i.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${i.asset.version}`);return}if(!t.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(i),this._convertTopLevelObjectsToArrays(i),mH(e),this._convertObjectIdsToArrayIndices(i),this._updateObjects(i),this._updateMaterial(i)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const t in q_)this._convertTopLevelObjectToArray(e,t)}_convertTopLevelObjectToArray(e,t){const i=e[t];if(!(!i||Array.isArray(i))){e[t]=[];for(const s in i){const r=i[s];r.id=r.id||s;const o=e[t].length;e[t].push(r),this.idToIndexMap[t][s]=o}}}_convertObjectIdsToArrayIndices(e){for(const t in q_)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const t of e.textures)this._convertTextureIds(t);for(const t of e.meshes)this._convertMeshIds(t);for(const t of e.nodes)this._convertNodeIds(t);for(const t of e.scenes)this._convertSceneIds(t)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const t of e.primitives){const{attributes:i,indices:s,material:r}=t;for(const o in i)i[o]=this._convertIdToIndex(i[o],"accessor");s&&(t.indices=this._convertIdToIndex(s,"accessor")),r&&(t.material=this._convertIdToIndex(r,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(t=>this._convertIdToIndex(t,"node"))),e.meshes&&(e.meshes=e.meshes.map(t=>this._convertIdToIndex(t,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(t=>this._convertIdToIndex(t,"node")))}_convertIdsToIndices(e,t){e[t]||(console.warn(`gltf v1: json doesn't contain attribute ${t}`),e[t]=[]);for(const i of e[t])for(const s in i){const r=i[s],o=this._convertIdToIndex(r,s);i[s]=o}}_convertIdToIndex(e,t){const i=_H[t];if(i in this.idToIndexMap){const s=this.idToIndexMap[i][e];if(!Number.isFinite(s))throw new Error(`gltf v1: failed to resolve ${t} with id ${e}`);return s}return e}_updateObjects(e){for(const t of this.json.buffers)delete t.type}_updateMaterial(e){var t,i,s;for(const r of e.materials){r.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const o=((t=r.values)==null?void 0:t.tex)||((i=r.values)==null?void 0:i.texture2d_0)||((s=r.values)==null?void 0:s.diffuseTex),a=e.textures.findIndex(l=>l.id===o);a!==-1&&(r.pbrMetallicRoughness.baseColorTexture={index:a})}}}function bH(n,e={}){return new yH().normalize(n,e)}async function vH(n,e,t=0,i,s){var r,o,a;return TH(n,e,t,i),bH(n,{normalize:(r=i==null?void 0:i.gltf)==null?void 0:r.normalize}),gH(n,i,s),(o=i==null?void 0:i.gltf)!=null&&o.loadBuffers&&n.json.buffers&&await wH(n,i,s),(a=i==null?void 0:i.gltf)!=null&&a.loadImages&&await EH(n,i,s),await pH(n,i,s),n}function TH(n,e,t,i){if(i.uri&&(n.baseUri=i.uri),e instanceof ArrayBuffer&&!Wz(e,t,i)&&(e=new TextDecoder().decode(e)),typeof e=="string")n.json=bx(e);else if(e instanceof ArrayBuffer){const o={};t=jz(o,e,t,i.glb),Ln(o.type==="glTF",`Invalid GLB magic string ${o.type}`),n._glb=o,n.json=o.json}else Ln(!1,"GLTF: must be ArrayBuffer or string");const s=n.json.buffers||[];if(n.buffers=new Array(s.length).fill(null),n._glb&&n._glb.header.hasBinChunk){const{binChunks:o}=n._glb;n.buffers[0]={arrayBuffer:o[0].arrayBuffer,byteOffset:o[0].byteOffset,byteLength:o[0].byteLength}}const r=n.json.images||[];n.images=new Array(r.length).fill({})}async function wH(n,e,t){var s,r;const i=n.json.buffers||[];for(let o=0;o<i.length;++o){const a=i[o];if(a.uri){const{fetch:l}=t;Ln(l);const f=bT(a.uri,e),g=await((s=t==null?void 0:t.fetch)==null?void 0:s.call(t,f)),_=await((r=g==null?void 0:g.arrayBuffer)==null?void 0:r.call(g));n.buffers[o]={arrayBuffer:_,byteOffset:0,byteLength:_.byteLength},delete a.uri}else n.buffers[o]===null&&(n.buffers[o]={arrayBuffer:new ArrayBuffer(a.byteLength),byteOffset:0,byteLength:a.byteLength})}}async function EH(n,e,t){const i=xH(n),s=n.json.images||[],r=[];for(const o of i)r.push(CH(n,s[o],o,e,t));return await Promise.all(r)}function xH(n){const e=new Set,t=n.json.textures||[];for(const i of t)i.source!==void 0&&e.add(i.source);return Array.from(e).sort()}async function CH(n,e,t,i,s){let r;if(e.uri&&!e.hasOwnProperty("bufferView")){const a=bT(e.uri,i),{fetch:l}=s;r=await(await l(a)).arrayBuffer(),e.bufferView={data:r}}if(Number.isFinite(e.bufferView)){const a=R9(n.json,n.buffers,e.bufferView);r=wf(a.buffer,a.byteOffset,a.byteLength)}Ln(r,"glTF image has no data");let o=await aa(r,[S1,s9],{...i,mimeType:e.mimeType,basis:i.basis||{format:lT()}},s);o&&o[0]&&(o={compressed:!0,mipmaps:!1,width:o[0].width,height:o[0].height,data:o[0]}),n.images=n.images||[],n.images[t]=o}const ra={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:Lz,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:SH,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function SH(n,e={},t){e={...ra.options,...e},e.gltf={...ra.options.gltf,...e.gltf};const{byteOffset:i=0}=e;return await vH({},n,i,e,t)}const IH={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},RH={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Wn={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},PH={magFilter:Wn.TEXTURE_MAG_FILTER,minFilter:Wn.TEXTURE_MIN_FILTER,wrapS:Wn.TEXTURE_WRAP_S,wrapT:Wn.TEXTURE_WRAP_T},MH={[Wn.TEXTURE_MAG_FILTER]:Wn.LINEAR,[Wn.TEXTURE_MIN_FILTER]:Wn.NEAREST_MIPMAP_LINEAR,[Wn.TEXTURE_WRAP_S]:Wn.REPEAT,[Wn.TEXTURE_WRAP_T]:Wn.REPEAT};function BH(){return{id:"default-sampler",parameters:MH}}function OH(n){return RH[n]}function DH(n){return IH[n]}class NH{constructor(){x(this,"baseUri","");x(this,"jsonUnprocessed");x(this,"json");x(this,"buffers",[]);x(this,"images",[])}postProcess(e,t={}){const{json:i,buffers:s=[],images:r=[]}=e,{baseUri:o=""}=e;return Ln(i),this.baseUri=o,this.buffers=s,this.images=r,this.jsonUnprocessed=i,this.json=this._resolveTree(e.json,t),this.json}_resolveTree(e,t={}){const i={...e};return this.json=i,e.bufferViews&&(i.bufferViews=e.bufferViews.map((s,r)=>this._resolveBufferView(s,r))),e.images&&(i.images=e.images.map((s,r)=>this._resolveImage(s,r))),e.samplers&&(i.samplers=e.samplers.map((s,r)=>this._resolveSampler(s,r))),e.textures&&(i.textures=e.textures.map((s,r)=>this._resolveTexture(s,r))),e.accessors&&(i.accessors=e.accessors.map((s,r)=>this._resolveAccessor(s,r))),e.materials&&(i.materials=e.materials.map((s,r)=>this._resolveMaterial(s,r))),e.meshes&&(i.meshes=e.meshes.map((s,r)=>this._resolveMesh(s,r))),e.nodes&&(i.nodes=e.nodes.map((s,r)=>this._resolveNode(s,r)),i.nodes=i.nodes.map((s,r)=>this._resolveNodeChildren(s))),e.skins&&(i.skins=e.skins.map((s,r)=>this._resolveSkin(s,r))),e.scenes&&(i.scenes=e.scenes.map((s,r)=>this._resolveScene(s,r))),typeof this.json.scene=="number"&&i.scenes&&(i.scene=i.scenes[this.json.scene]),i}getScene(e){return this._get(this.json.scenes,e)}getNode(e){return this._get(this.json.nodes,e)}getSkin(e){return this._get(this.json.skins,e)}getMesh(e){return this._get(this.json.meshes,e)}getMaterial(e){return this._get(this.json.materials,e)}getAccessor(e){return this._get(this.json.accessors,e)}getCamera(e){return this._get(this.json.cameras,e)}getTexture(e){return this._get(this.json.textures,e)}getSampler(e){return this._get(this.json.samplers,e)}getImage(e){return this._get(this.json.images,e)}getBufferView(e){return this._get(this.json.bufferViews,e)}getBuffer(e){return this._get(this.json.buffers,e)}_get(e,t){if(typeof t=="object")return t;const i=e&&e[t];return i||console.warn(`glTF file error: Could not find ${e}[${t}]`),i}_resolveScene(e,t){return{...e,id:e.id||`scene-${t}`,nodes:(e.nodes||[]).map(i=>this.getNode(i))}}_resolveNode(e,t){const i={...e,id:(e==null?void 0:e.id)||`node-${t}`};return e.mesh!==void 0&&(i.mesh=this.getMesh(e.mesh)),e.camera!==void 0&&(i.camera=this.getCamera(e.camera)),e.skin!==void 0&&(i.skin=this.getSkin(e.skin)),e.meshes!==void 0&&e.meshes.length&&(i.mesh=e.meshes.reduce((s,r)=>{const o=this.getMesh(r);return s.id=o.id,s.primitives=s.primitives.concat(o.primitives),s},{primitives:[]})),i}_resolveNodeChildren(e){return e.children&&(e.children=e.children.map(t=>this.getNode(t))),e}_resolveSkin(e,t){const i=typeof e.inverseBindMatrices=="number"?this.getAccessor(e.inverseBindMatrices):void 0;return{...e,id:e.id||`skin-${t}`,inverseBindMatrices:i}}_resolveMesh(e,t){const i={...e,id:e.id||`mesh-${t}`,primitives:[]};return e.primitives&&(i.primitives=e.primitives.map(s=>{const r={...s,attributes:{},indices:void 0,material:void 0},o=s.attributes;for(const a in o)r.attributes[a]=this.getAccessor(o[a]);return s.indices!==void 0&&(r.indices=this.getAccessor(s.indices)),s.material!==void 0&&(r.material=this.getMaterial(s.material)),r})),i}_resolveMaterial(e,t){const i={...e,id:e.id||`material-${t}`};if(i.normalTexture&&(i.normalTexture={...i.normalTexture},i.normalTexture.texture=this.getTexture(i.normalTexture.index)),i.occlusionTexture&&(i.occlusionTexture={...i.occlusionTexture},i.occlusionTexture.texture=this.getTexture(i.occlusionTexture.index)),i.emissiveTexture&&(i.emissiveTexture={...i.emissiveTexture},i.emissiveTexture.texture=this.getTexture(i.emissiveTexture.index)),i.emissiveFactor||(i.emissiveFactor=i.emissiveTexture?[1,1,1]:[0,0,0]),i.pbrMetallicRoughness){i.pbrMetallicRoughness={...i.pbrMetallicRoughness};const s=i.pbrMetallicRoughness;s.baseColorTexture&&(s.baseColorTexture={...s.baseColorTexture},s.baseColorTexture.texture=this.getTexture(s.baseColorTexture.index)),s.metallicRoughnessTexture&&(s.metallicRoughnessTexture={...s.metallicRoughnessTexture},s.metallicRoughnessTexture.texture=this.getTexture(s.metallicRoughnessTexture.index))}return i}_resolveAccessor(e,t){const i=OH(e.componentType),s=DH(e.type),r=i*s,o={...e,id:e.id||`accessor-${t}`,bytesPerComponent:i,components:s,bytesPerElement:r,value:void 0,bufferView:void 0,sparse:void 0};if(e.bufferView!==void 0&&(o.bufferView=this.getBufferView(e.bufferView)),o.bufferView){const a=o.bufferView.buffer,{ArrayType:l,byteLength:f}=Md(o,o.bufferView),g=(o.bufferView.byteOffset||0)+(o.byteOffset||0)+a.byteOffset;let _=a.arrayBuffer.slice(g,g+f);o.bufferView.byteStride&&(_=this._getValueFromInterleavedBuffer(a,g,o.bufferView.byteStride,o.bytesPerElement,o.count)),o.value=new l(_)}return o}_getValueFromInterleavedBuffer(e,t,i,s,r){const o=new Uint8Array(r*s);for(let a=0;a<r;a++){const l=t+a*i;o.set(new Uint8Array(e.arrayBuffer.slice(l,l+s)),a*s)}return o.buffer}_resolveTexture(e,t){return{...e,id:e.id||`texture-${t}`,sampler:typeof e.sampler=="number"?this.getSampler(e.sampler):BH(),source:typeof e.source=="number"?this.getImage(e.source):void 0}}_resolveSampler(e,t){const i={id:e.id||`sampler-${t}`,...e,parameters:{}};for(const s in i){const r=this._enumSamplerParameter(s);r!==void 0&&(i.parameters[r]=i[s])}return i}_enumSamplerParameter(e){return PH[e]}_resolveImage(e,t){const i={...e,id:e.id||`image-${t}`,image:null,bufferView:e.bufferView!==void 0?this.getBufferView(e.bufferView):void 0},s=this.images[t];return s&&(i.image=s),i}_resolveBufferView(e,t){const i=e.buffer,s=this.buffers[i].arrayBuffer;let r=this.buffers[i].byteOffset||0;return e.byteOffset&&(r+=e.byteOffset),{id:`bufferView-${t}`,...e,buffer:this.buffers[i],data:new Uint8Array(s,r,e.byteLength)}}_resolveCamera(e,t){const i={...e,id:e.id||`camera-${t}`};return i.perspective,i.orthographic,i}}function Fd(n,e){return new NH().postProcess(n,e)}async function FH(n){const e=[];return n.scenes.forEach(t=>{t.traverse(i=>{Object.values(i.model.uniforms).forEach(s=>{s.loaded===!1&&e.push(s)})})}),await LH(()=>e.some(t=>!t.loaded))}async function LH(n){for(;n();)await new Promise(e=>requestAnimationFrame(e))}const J_=`uniform scenegraphUniforms {
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  mat4 sceneModelMatrix;
  bool composeModelMatrix;
} scenegraph;
`,kH={name:"scenegraph",vs:J_,fs:J_,uniformTypes:{sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",sceneModelMatrix:"mat4x4<f32>",composeModelMatrix:"f32"}},UH=`#version 300 es
#define SHADER_NAME scenegraph-layer-vertex-shader
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
in vec3 positions;
#ifdef HAS_UV
in vec2 texCoords;
#endif
#ifdef LIGHTING_PBR
#ifdef HAS_NORMALS
in vec3 normals;
#endif
#endif
out vec4 vColor;
#ifndef LIGHTING_PBR
#ifdef HAS_UV
out vec2 vTEXCOORD_0;
#endif
#endif
void main(void) {
#if defined(HAS_UV) && !defined(LIGHTING_PBR)
vTEXCOORD_0 = texCoords;
geometry.uv = texCoords;
#endif
geometry.worldPosition = instancePositions;
geometry.pickingColor = instancePickingColors;
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 normal = vec3(0.0, 0.0, 1.0);
#ifdef LIGHTING_PBR
#ifdef HAS_NORMALS
normal = instanceModelMatrix * (scenegraph.sceneModelMatrix * vec4(normals, 0.0)).xyz;
#endif
#endif
float originalSize = project_size_to_pixel(scenegraph.sizeScale);
float clampedSize = clamp(originalSize, scenegraph.sizeMinPixels, scenegraph.sizeMaxPixels);
vec3 pos = (instanceModelMatrix * (scenegraph.sceneModelMatrix * vec4(positions, 1.0)).xyz) * scenegraph.sizeScale * (clampedSize / originalSize) + instanceTranslation;
if(scenegraph.composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
geometry.normal = project_normal(normal);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
geometry.normal = project_normal(normal);
}
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef LIGHTING_PBR
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = texCoords;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,VH=`#version 300 es
#define SHADER_NAME scenegraph-layer-fragment-shader
in vec4 vColor;
out vec4 fragColor;
#ifndef LIGHTING_PBR
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
in vec2 vTEXCOORD_0;
uniform sampler2D pbr_baseColorSampler;
#endif
#endif
void main(void) {
#ifdef LIGHTING_PBR
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
#else
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
fragColor = vColor * texture(pbr_baseColorSampler, vTEXCOORD_0);
geometry.uv = vTEXCOORD_0;
#else
fragColor = vColor;
#endif
#endif
fragColor.a *= layer.opacity;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,ST=[255,255,255,255],zH={scenegraph:{type:"object",value:null,async:!0},getScene:n=>n&&n.scenes?typeof n.scene=="object"?n.scene:n.scenes[n.scene||0]:n,getAnimator:n=>n&&n.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:n=>n.position},getColor:{type:"accessor",value:ST},_lighting:"flat",_imageBasedLightingEnvironment:void 0,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[ra]};class Ld extends rn{getShaders(){const e={};let t;this.props._lighting==="pbr"?(t=qf,e.LIGHTING_PBR=1):t={name:"pbrMaterial"};const i=[sn,Un,kH,t];return super.getShaders({defines:e,vs:UH,fs:VH,modules:i})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:"unorm8",size:this.props.colorFormat.length,accessor:"getColor",defaultValue:ST,transition:!0},instanceModelMatrix:sT})}updateState(e){super.updateState(e);const{props:t,oldProps:i}=e;t.scenegraph!==i.scenegraph?this._updateScenegraph():t._animations!==i._animations&&this._applyAnimationsProp(this.state.animator,t._animations)}finalizeState(e){var t;super.finalizeState(e),(t=this.state.scenegraph)==null||t.destroy()}get isLoaded(){var e;return!!((e=this.state)!=null&&e.scenegraph&&super.isLoaded)}_updateScenegraph(){var a;const e=this.props,{device:t}=this.context;let i=null;if(e.scenegraph instanceof cc)i={scenes:[e.scenegraph]};else if(e.scenegraph&&typeof e.scenegraph=="object"){const l=e.scenegraph,f=l.json?Fd(l):l,g=T9(t,f,this._getModelOptions());i={gltf:f,...g},FH(g).then(()=>{this.setNeedsRedraw()}).catch(_=>{this.raiseError(_,"loading glTF")})}const s={layer:this,device:this.context.device},r=e.getScene(i,s),o=e.getAnimator(i,s);if(r instanceof zr){(a=this.state.scenegraph)==null||a.destroy(),this._applyAnimationsProp(o,e._animations);const l=[];r.traverse(f=>{f instanceof Wh&&l.push(f.model)}),this.setState({scenegraph:r,animator:o,models:l}),this.getAttributeManager().invalidateAll()}else r!==null&&ze.warn("invalid scenegraph:",r)()}_applyAnimationsProp(e,t){if(!e||!t)return;const i=e.getAnimations();Object.keys(t).sort().forEach(s=>{const r=t[s];if(s==="*")i.forEach(o=>{Object.assign(o,r)});else if(Number.isFinite(Number(s))){const o=Number(s);o>=0&&o<i.length?Object.assign(i[o],r):ze.warn(`animation ${s} not found`)()}else{const o=i.find(({name:a})=>a===s);o?Object.assign(o,r):ze.warn(`animation ${s} not found`)()}})}_getModelOptions(){const{_imageBasedLightingEnvironment:e}=this.props;let t;return e&&(typeof e=="function"?t=e({gl:this.context.gl,layer:this}):t=e),{imageBasedLightingEnvironment:t,modelOptions:{id:this.props.id,isInstanced:!0,bufferLayout:this.getAttributeManager().getBufferLayouts(),...this.getShaders()},useTangents:!1}}draw({context:e}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(e.timeline.getTime()),this.setNeedsRedraw());const{viewport:t,renderPass:i}=this.context,{sizeScale:s,sizeMinPixels:r,sizeMaxPixels:o,coordinateSystem:a}=this.props,l=this.getNumInstances();this.state.scenegraph.traverse((f,{worldMatrix:g})=>{if(f instanceof Wh){const{model:_}=f;_.setInstanceCount(l);const v={camera:_.uniforms.cameraPosition},T={sizeScale:s,sizeMinPixels:r,sizeMaxPixels:o,composeModelMatrix:rT(t,a),sceneModelMatrix:g};_.shaderInputs.setProps({pbrProjection:v,scenegraph:T}),_.draw(i)}})}}Ld.defaultProps=zH;Ld.layerName="ScenegraphLayer";const Z_=`uniform meshUniforms {
  bool pickFeatureIds;
} mesh;
`,HH={name:"mesh",vs:Z_,fs:Z_,uniformTypes:{pickFeatureIds:"f32"}},GH=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
vec2 applyUVRegion(vec2 uv) {
#ifdef HAS_UV_REGIONS
return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
#else
return uv;
#endif
}
void main(void) {
vec2 uv = applyUVRegion(texCoords);
geometry.uv = uv;
if (mesh.pickFeatureIds) {
geometry.pickingColor = featureIdsPickingColors;
} else {
geometry.pickingColor = instancePickingColors;
}
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vTexCoord = uv;
cameraPosition = project.cameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
vec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale;
vec3 projectedPosition = project_position(positions);
position_commonspace = vec4(projectedPosition, 1.0);
gl_Position = project_common_position_to_clipspace(position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef MODULE_PBRMATERIAL
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = uv;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,WH=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform sampler2D sampler;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
#ifdef MODULE_PBRMATERIAL
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
fragColor.a *= layer.opacity;
#else
geometry.uv = vTexCoord;
vec3 normal;
if (simpleMesh.flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * layer.opacity);
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function jH(n){const e=n.positions||n.POSITION,t=e.value.length/e.size;n.COLOR_0||n.colors||(n.colors={size:4,value:new Uint8Array(t*4).fill(255),normalized:!0})}const $H={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class kd extends ia{getShaders(){const e=super.getShaders();return e.modules.push(qf,HH),{...e,vs:GH,fs:WH}}initializeState(){const{featureIds:e}=this.props;super.initializeState();const t=this.getAttributeManager();e&&t.add({featureIdsPickingColors:{type:"uint8",size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(e){super.updateState(e);const{props:t,oldProps:i}=e;t.pbrMaterial!==i.pbrMaterial&&this.updatePbrMaterialUniforms(t.pbrMaterial)}draw(e){const{featureIds:t}=this.props,{model:i}=this.state;if(!i)return;const s={pickFeatureIds:!!t},r={camera:i.uniforms.cameraPosition};i.shaderInputs.setProps({pbrProjection:r,mesh:s}),super.draw(e)}getModel(e){const{id:t}=this.props,i=this.parseMaterial(this.props.pbrMaterial,e);this.setState({parsedPBRMaterial:i});const s=this.getShaders();return jH(e.attributes),new Nt(this.context.device,{...this.getShaders(),id:t,geometry:e,bufferLayout:this.getAttributeManager().getBufferLayouts(),defines:{...s.defines,...i==null?void 0:i.defines,HAS_UV_REGIONS:e.attributes.uvRegions?1:0},parameters:i==null?void 0:i.parameters,isInstanced:!0})}updatePbrMaterialUniforms(e){const{model:t}=this.state;if(t){const{mesh:i}=this.props,s=this.parseMaterial(e,i);this.setState({parsedPBRMaterial:s});const{pbr_baseColorSampler:r}=s.bindings,{emptyTexture:o}=this.state,a={sampler:r||o,hasTexture:!!r},{camera:l,...f}={...s.bindings,...s.uniforms};t.shaderInputs.setProps({simpleMesh:a,pbrMaterial:f})}}parseMaterial(e,t){const i=!!(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return oT(this.context.device,{unlit:i,...e},{NORMAL:t.attributes.normals,TEXCOORD_0:t.attributes.texCoords},{pbrDebug:!1,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(e){const t=this.props.featureIds,i=new Uint8ClampedArray(t.length*e.size),s=[];for(let r=0;r<t.length;r++)this.encodePickingColor(t[r],s),i[r*3]=s[0],i[r*3+1]=s[1],i[r*3+2]=s[2];e.value=i}finalizeState(e){var t;super.finalizeState(e),(t=this.state.parsedPBRMaterial)==null||t.generatedTextures.forEach(i=>i.destroy()),this.setState({parsedPBRMaterial:null})}}kd.layerName="MeshLayer";kd.defaultProps=$H;const XH=6378137,QH=6378137,YH=6356752314245179e-9;function fA(n){return n}new ee;function KH(n,e=[],t=fA){return"longitude"in n?(e[0]=t(n.longitude),e[1]=t(n.latitude),e[2]=n.height):"x"in n?(e[0]=t(n.x),e[1]=t(n.y),e[2]=n.z):(e[0]=t(n[0]),e[1]=t(n[1]),e[2]=n[2]),e}function qH(n,e=[]){return KH(n,e,Yt._cartographicRadians?fA:PR)}function JH(n,e,t=fA){return"longitude"in e?(e.longitude=t(n[0]),e.latitude=t(n[1]),e.height=n[2]):"x"in e?(e.x=t(n[0]),e.y=t(n[1]),e.z=n[2]):(e[0]=t(n[0]),e[1]=t(n[1]),e[2]=n[2]),e}function ZH(n,e){return JH(n,e,Yt._cartographicRadians?fA:MR)}const e2=1e-14,eG=new ee,t2={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},Qu={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},Ro={east:new ee,north:new ee,up:new ee,west:new ee,south:new ee,down:new ee},tG=new ee,nG=new ee,iG=new ee;function n2(n,e,t,i,s,r){const o=t2[e]&&t2[e][t];ii(o&&(!i||i===o));let a,l,f;const g=eG.copy(s);if(Cn(g.x,0,e2)&&Cn(g.y,0,e2)){const v=Math.sign(g.z);a=tG.fromArray(Qu[e]),e!=="east"&&e!=="west"&&a.scale(v),l=nG.fromArray(Qu[t]),t!=="east"&&t!=="west"&&l.scale(v),f=iG.fromArray(Qu[i]),i!=="east"&&i!=="west"&&f.scale(v)}else{const{up:v,east:T,north:C}=Ro;T.set(-g.y,g.x,0).normalize(),n.geodeticSurfaceNormal(g,v),C.copy(v).cross(T);const{down:S,west:R,south:P}=Ro;S.copy(v).scale(-1),R.copy(T).scale(-1),P.copy(C).scale(-1),a=Ro[e],l=Ro[t],f=Ro[i]}return r[0]=a.x,r[1]=a.y,r[2]=a.z,r[3]=0,r[4]=l.x,r[5]=l.y,r[6]=l.z,r[7]=0,r[8]=f.x,r[9]=f.y,r[10]=f.z,r[11]=0,r[12]=g.x,r[13]=g.y,r[14]=g.z,r[15]=1,r}const wr=new ee,sG=new ee,rG=new ee;function oG(n,e,t=[]){const{oneOverRadii:i,oneOverRadiiSquared:s,centerToleranceSquared:r}=e;wr.from(n);const o=wr.x,a=wr.y,l=wr.z,f=i.x,g=i.y,_=i.z,v=o*o*f*f,T=a*a*g*g,C=l*l*_*_,S=v+T+C,R=Math.sqrt(1/S);if(!Number.isFinite(R))return;const P=sG;if(P.copy(n).scale(R),S<r)return P.to(t);const F=s.x,U=s.y,X=s.z,Z=rG;Z.set(P.x*F*2,P.y*U*2,P.z*X*2);let se=(1-R)*wr.len()/(.5*Z.len()),Se=0,me,J,q,L;do{se-=Se,me=1/(1+se*F),J=1/(1+se*U),q=1/(1+se*X);const fe=me*me,we=J*J,Me=q*q,Fe=fe*me,z=we*J,Q=Me*q;L=v*fe+T*we+C*Me-1;const Ae=-2*(v*Fe*F+T*z*U+C*Q*X);Se=L/Ae}while(Math.abs(L)>ZP);return wr.scale([me,J,q]).to(t)}const fl=new ee,i2=new ee,aG=new ee,Zn=new ee,lG=new ee,dl=new ee;class Pt{constructor(e=0,t=0,i=0){this.centerToleranceSquared=JP,ii(e>=0),ii(t>=0),ii(i>=0),this.radii=new ee(e,t,i),this.radiiSquared=new ee(e*e,t*t,i*i),this.radiiToTheFourth=new ee(e*e*e*e,t*t*t*t,i*i*i*i),this.oneOverRadii=new ee(e===0?0:1/e,t===0?0:1/t,i===0?0:1/i),this.oneOverRadiiSquared=new ee(e===0?0:1/(e*e),t===0?0:1/(t*t),i===0?0:1/(i*i)),this.minimumRadius=Math.min(e,t,i),this.maximumRadius=Math.max(e,t,i),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||!!(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e,t=[0,0,0]){const i=i2,s=aG,[,,r]=e;this.geodeticSurfaceNormalCartographic(e,i),s.copy(this.radiiSquared).scale(i);const o=Math.sqrt(i.dot(s));return s.scale(1/o),i.scale(r),s.add(i),s.to(t)}cartesianToCartographic(e,t=[0,0,0]){dl.from(e);const i=this.scaleToGeodeticSurface(dl,Zn);if(!i)return;const s=this.geodeticSurfaceNormal(i,i2),r=lG;r.copy(dl).subtract(i);const o=Math.atan2(s.y,s.x),a=Math.asin(s.z),l=Math.sign(jf(r,dl))*Wf(r);return ZH([o,a,l],t)}eastNorthUpToFixedFrame(e,t=new Ge){return n2(this,"east","north","up",e,t)}localFrameToFixedFrame(e,t,i,s,r=new Ge){return n2(this,e,t,i,s,r)}geocentricSurfaceNormal(e,t=[0,0,0]){return fl.from(e).normalize().to(t)}geodeticSurfaceNormalCartographic(e,t=[0,0,0]){const i=qH(e),s=i[0],r=i[1],o=Math.cos(r);return fl.set(o*Math.cos(s),o*Math.sin(s),Math.sin(r)).normalize(),fl.to(t)}geodeticSurfaceNormal(e,t=[0,0,0]){return fl.from(e).scale(this.oneOverRadiiSquared).normalize().to(t)}scaleToGeodeticSurface(e,t){return oG(e,this,t)}scaleToGeocentricSurface(e,t=[0,0,0]){Zn.from(e);const i=Zn.x,s=Zn.y,r=Zn.z,o=this.oneOverRadiiSquared,a=1/Math.sqrt(i*i*o.x+s*s*o.y+r*r*o.z);return Zn.multiplyScalar(a).to(t)}transformPositionToScaledSpace(e,t=[0,0,0]){return Zn.from(e).scale(this.oneOverRadii).to(t)}transformPositionFromScaledSpace(e,t=[0,0,0]){return Zn.from(e).scale(this.radii).to(t)}getSurfaceNormalIntersectionWithZAxis(e,t=0,i=[0,0,0]){ii(Cn(this.radii.x,this.radii.y,Dy)),ii(this.radii.z>0),Zn.from(e);const s=Zn.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(s)>=this.radii.z-t))return Zn.set(0,0,s).to(i)}}Pt.WGS84=new Pt(XH,QH,YH);class cG{constructor(e,t,i){x(this,"item");x(this,"previous");x(this,"next");this.item=e,this.previous=t,this.next=i}}class AG{constructor(){x(this,"head",null);x(this,"tail",null);x(this,"_length",0)}get length(){return this._length}add(e){const t=new cG(e,this.tail,null);return this.tail?(this.tail.next=t,this.tail=t):(this.head=t,this.tail=t),++this._length,t}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,t){e!==t&&(this.remove(t),this._insert(e,t))}_insert(e,t){const i=e.next;e.next=t,this.tail===e?this.tail=t:i.previous=t,t.next=i,t.previous=e,++this._length}}class uG{constructor(){x(this,"_list");x(this,"_sentinel");x(this,"_trimTiles");this._list=new AG,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){const t=e._cacheNode;t&&this._list.splice(this._sentinel,t)}add(e,t,i){t._cacheNode||(t._cacheNode=this._list.add(t),i&&i(e,t))}unloadTile(e,t,i){const s=t._cacheNode;s&&(this._list.remove(s),t._cacheNode=null,i&&i(e,t))}unloadTiles(e,t){const i=this._trimTiles;this._trimTiles=!1;const s=this._list,r=e.maximumMemoryUsage*1024*1024,o=this._sentinel;let a=s.head;for(;a!==o&&(e.gpuMemoryUsageInBytes>r||i);){const l=a.item;a=a.next,this.unloadTile(e,l,t)}}trim(){this._trimTiles=!0}}function hG(n,e){Rt(n),Rt(e);const{rtcCenter:t,gltfUpAxis:i}=e,{computedTransform:s,boundingVolume:{center:r}}=n;let o=new Ge(s);switch(t&&o.translate(t),i){case"Z":break;case"Y":const _=new Ge().rotateX(Math.PI/2);o=o.multiplyRight(_);break;case"X":const v=new Ge().rotateY(-Math.PI/2);o=o.multiplyRight(v);break}e.isQuantized&&o.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);const a=new ee(r);e.cartesianModelMatrix=o,e.cartesianOrigin=a;const l=Pt.WGS84.cartesianToCartographic(a,new ee),g=Pt.WGS84.eastNorthUpToFixedFrame(a).invert();e.cartographicModelMatrix=g.multiplyRight(o),e.cartographicOrigin=l,e.coordinateSystem||(e.modelMatrix=e.cartographicModelMatrix)}const s2=new ee,Yu=new ee,uf=new Fn([new ni,new ni,new ni,new ni,new ni,new ni]);function fG(n,e){const{cameraDirection:t,cameraUp:i,height:s}=n,{metersPerUnit:r}=n.distanceScales,o=Nl(n,n.center),a=Pt.WGS84.eastNorthUpToFixedFrame(o),l=n.unprojectPosition(n.cameraPosition),f=Pt.WGS84.cartographicToCartesian(l,new ee),g=new ee(a.transformAsVector(new ee(t).scale(r))).normalize(),_=new ee(a.transformAsVector(new ee(i).scale(r))).normalize();gG(n);const v=n.constructor,{longitude:T,latitude:C,width:S,bearing:R,zoom:P}=n,F=new v({longitude:T,latitude:C,height:s,width:S,bearing:R,zoom:P,pitch:0});return{camera:{position:f,direction:g,up:_},viewport:n,topDownViewport:F,height:s,cullingVolume:uf,frameNumber:e,sseDenominator:1.15}}function dG(n,e,t){if(t===0||n.length<=t)return[n,[]];const i=[],{longitude:s,latitude:r}=e.viewport;for(const[f,g]of n.entries()){const[_,v]=g.header.mbs,T=Math.abs(s-_),C=Math.abs(r-v),S=Math.sqrt(C*C+T*T);i.push([f,S])}const o=i.sort((f,g)=>f[1]-g[1]),a=[];for(let f=0;f<t;f++)a.push(n[o[f][0]]);const l=[];for(let f=t;f<o.length;f++)l.push(n[o[f][0]]);return[a,l]}function gG(n){const e=n.getFrustumPlanes(),t=r2(e.near,n.cameraPosition),i=Nl(n,t),s=Nl(n,n.cameraPosition,Yu);let r=0;uf.planes[r++].fromPointNormal(i,s2.copy(i).subtract(s));for(const o in e){if(o==="near")continue;const a=e[o],l=r2(a,t,Yu),f=Nl(n,l,Yu);uf.planes[r++].fromPointNormal(f,s2.copy(i).subtract(f))}}function r2(n,e,t=new ee){const i=n.normal.dot(e);return t.copy(n.normal).scale(n.distance-i).add(e),t}function Nl(n,e,t=new ee){const i=n.unprojectPosition(e);return Pt.WGS84.cartographicToCartesian(i,t)}const pG=6378137,mG=6378137,hf=6356752314245179e-9,Fr=new ee;function _G(n,e){if(n instanceof ya){const{halfAxes:t}=n,i=bG(t);return Math.log2(hf/(i+e[2]))}else if(n instanceof _a){const{radius:t}=n;return Math.log2(hf/(t+e[2]))}else if(n.width&&n.height){const{width:t,height:i}=n,s=Math.log2(pG/t),r=Math.log2(mG/i);return(s+r)/2}return 1}function IT(n,e,t){Pt.WGS84.cartographicToCartesian([n.xmax,n.ymax,n.zmax],Fr);const i=Math.sqrt(Math.pow(Fr[0]-t[0],2)+Math.pow(Fr[1]-t[1],2)+Math.pow(Fr[2]-t[2],2));return Math.log2(hf/(i+e[2]))}function yG(n,e,t){const[i,s,r,o]=n;return IT({xmax:r,ymax:o,zmax:0},e,t)}function bG(n){n.getColumn(0,Fr);const e=n.getColumn(1),t=n.getColumn(2);return Fr.add(e).add(t).len()}const Dn={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5};var ui;(function(n){n[n.ADD=1]="ADD",n[n.REPLACE=2]="REPLACE"})(ui||(ui={}));var Di;(function(n){n.EMPTY="empty",n.SCENEGRAPH="scenegraph",n.POINTCLOUD="pointcloud",n.MESH="mesh"})(Di||(Di={}));var Rn;(function(n){n.I3S="I3S",n.TILES3D="TILES3D"})(Rn||(Rn={}));var eo;(function(n){n.GEOMETRIC_ERROR="geometricError",n.MAX_SCREEN_THRESHOLD="maxScreenThreshold"})(eo||(eo={}));const vG={USE_OPTIMIZATION:1};function RT(n){return n!=null}const vn=new ee,Fl=new ee,TG=new ee,wG=new ee,Rs=new ee,o2=new ee,a2=new ee,l2=new ee;function Ku(n,e,t){if(Rt(n,"3D Tile: boundingVolume must be defined"),n.box)return PT(n.box,e,t);if(n.region)return CG(n.region);if(n.sphere)return xG(n.sphere,e,t);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function EG(n,e){if(n.box)return SG(e);if(n.region){const[t,i,s,r,o,a]=n.region;return[[cn(t),cn(i),o],[cn(s),cn(r),a]]}if(n.sphere)return IG(e);throw new Error("Unkown boundingVolume type")}function PT(n,e,t){const i=new ee(n[0],n[1],n[2]);e.transform(i,i);let s=[];if(n.length===10){const f=n.slice(3,6),g=new Jo;g.fromArray(n,6);const _=new ee([1,0,0]),v=new ee([0,1,0]),T=new ee([0,0,1]);_.transformByQuaternion(g),_.scale(f[0]),v.transformByQuaternion(g),v.scale(f[1]),T.transformByQuaternion(g),T.scale(f[2]),s=[..._.toArray(),...v.toArray(),...T.toArray()]}else s=[...n.slice(3,6),...n.slice(6,9),...n.slice(9,12)];const r=e.transformAsVector(s.slice(0,3)),o=e.transformAsVector(s.slice(3,6)),a=e.transformAsVector(s.slice(6,9)),l=new Wt([r[0],r[1],r[2],o[0],o[1],o[2],a[0],a[1],a[2]]);return RT(t)?(t.center=i,t.halfAxes=l,t):new ya(i,l)}function xG(n,e,t){const i=new ee(n[0],n[1],n[2]);e.transform(i,i);const s=e.getScale(Fl),r=Math.max(Math.max(s[0],s[1]),s[2]),o=n[3]*r;return RT(t)?(t.center=i,t.radius=o,t):new _a(i,o)}function CG(n){const[e,t,i,s,r,o]=n,a=Pt.WGS84.cartographicToCartesian([cn(e),cn(s),r],TG),l=Pt.WGS84.cartographicToCartesian([cn(i),cn(t),o],wG),f=new ee().addVectors(a,l).multiplyByScalar(.5);return Pt.WGS84.cartesianToCartographic(f,Rs),Pt.WGS84.cartographicToCartesian([cn(i),Rs[1],Rs[2]],o2),Pt.WGS84.cartographicToCartesian([Rs[0],cn(s),Rs[2]],a2),Pt.WGS84.cartographicToCartesian([Rs[0],Rs[1],o],l2),PT([...f,...o2.subtract(f),...a2.subtract(f),...l2.subtract(f)],new Ge)}function SG(n){const e=MT(),{halfAxes:t}=n,i=new ee(t.getColumn(0)),s=new ee(t.getColumn(1)),r=new ee(t.getColumn(2));for(let o=0;o<2;o++){for(let a=0;a<2;a++){for(let l=0;l<2;l++)vn.copy(n.center),vn.add(i),vn.add(s),vn.add(r),BT(e,vn),r.negate();s.negate()}i.negate()}return e}function IG(n){const e=MT(),{center:t,radius:i}=n,s=Pt.WGS84.scaleToGeodeticSurface(t,vn);let r;s?r=Pt.WGS84.geodeticSurfaceNormal(s):r=new ee(0,0,1);let o=new ee(r[2],-r[1],0);o.len()>0?o.normalize():o=new ee(0,1,0);const a=o.clone().cross(r);for(const l of[o,a,r]){Fl.copy(l).scale(i);for(let f=0;f<2;f++)vn.copy(t),vn.add(Fl),BT(e,vn),Fl.negate()}return e}function MT(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function BT(n,e){Pt.WGS84.cartesianToCartographic(e,vn),n[0][0]=Math.min(n[0][0],vn[0]),n[0][1]=Math.min(n[0][1],vn[1]),n[0][2]=Math.min(n[0][2],vn[2]),n[1][0]=Math.max(n[1][0],vn[0]),n[1][1]=Math.max(n[1][1],vn[1]),n[1][2]=Math.max(n[1][2],vn[2])}new ee;new ee;new Ge;new ee;new ee;new ee;function RG(n,e){const t=n*e;return 1-Math.exp(-(t*t))}function PG(n,e){if(n.dynamicScreenSpaceError&&n.dynamicScreenSpaceErrorComputedDensity){const t=n.dynamicScreenSpaceErrorComputedDensity,i=n.dynamicScreenSpaceErrorFactor;return RG(e,t)*i}return 0}function MG(n,e,t){const i=n.tileset,s=n.parent&&n.parent.lodMetricValue||n.lodMetricValue,r=t?s:n.lodMetricValue;if(r===0)return 0;const o=Math.max(n._distanceToCamera,1e-7),{height:a,sseDenominator:l}=e,{viewDistanceScale:f}=i.options;let g=r*a*(f||1)/(o*l);return g-=PG(i,o),g}const qu=new ee,c2=new ee,qi=new ee,A2=new ee,BG=new ee,Ju=new Ge,u2=new Ge;function OG(n,e){if(n.lodMetricValue===0||isNaN(n.lodMetricValue))return"DIG";const t=2*OT(n,e);return t<2?"OUT":!n.header.children||t<=n.lodMetricValue?"DRAW":n.header.children?"DIG":"OUT"}function OT(n,e){const{topDownViewport:t}=e,i=n.header.mbs[1],s=n.header.mbs[0],r=n.header.mbs[2],o=n.header.mbs[3],a=[...n.boundingVolume.center],l=t.unprojectPosition(t.cameraPosition);Pt.WGS84.cartographicToCartesian(l,qu),c2.copy(qu).subtract(a).normalize(),Pt.WGS84.eastNorthUpToFixedFrame(a,Ju),u2.copy(Ju).invert(),qi.copy(qu).transform(u2);const f=Math.sqrt(qi[0]*qi[0]+qi[1]*qi[1]),g=f*f/qi[2];A2.copy([qi[0],qi[1],g]);const v=A2.transform(Ju).subtract(a).normalize(),C=c2.cross(v).normalize().scale(o).add(a),S=Pt.WGS84.cartesianToCartographic(C),R=t.project([s,i,r]),P=t.project(S);return BG.copy(R).subtract(P).magnitude()}function DG(n){return{assetGltfUpAxis:n.asset&&n.asset.gltfUpAxis||"Y"}}class h2{constructor(e=0){x(this,"_map",new Map);x(this,"_array");x(this,"_length");this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return Rt(e<this._array.length),this._array[e]}set(e,t){Rt(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=t,this._map.set(t,e)}delete(e){const t=this._map.get(e);t>=0&&(this._array.splice(t,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){const t=this.length++;this._array[t]=e,this._map.set(e,t)}}pop(){const e=this._array[--this.length];return this._map.delete(e),e}reserve(e){Rt(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){Rt(e>=0),this.length=e}trim(e){e==null&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}}const NG={loadSiblings:!1,skipLevelOfDetail:!1,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class dA{constructor(e){x(this,"options");x(this,"root",null);x(this,"selectedTiles",{});x(this,"requestedTiles",{});x(this,"emptyTiles",{});x(this,"lastUpdate",new Date().getTime());x(this,"updateDebounceTime",1e3);x(this,"_traversalStack",new h2);x(this,"_emptyTraversalStack",new h2);x(this,"_frameNumber",null);this.options={...NG,...e}}traversalFinished(e){return!0}traverse(e,t,i){this.root=e,this.options={...this.options,...i},this.reset(),this.updateTile(e,t),this._frameNumber=t.frameNumber,this.executeTraversal(e,t)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,t){const i=this._traversalStack;for(e._selectionDepth=1,i.push(e);i.length>0;){const r=i.pop();let o=!1;this.canTraverse(r,t)&&(this.updateChildTiles(r,t),o=this.updateAndPushChildren(r,t,i,r.hasRenderContent?r._selectionDepth+1:r._selectionDepth));const a=r.parent,l=!!(!a||a._shouldRefine),f=!o;r.hasRenderContent?r.refine===ui.ADD?(this.loadTile(r,t),this.selectTile(r,t)):r.refine===ui.REPLACE&&(this.loadTile(r,t),f&&this.selectTile(r,t)):(this.emptyTiles[r.id]=r,this.loadTile(r,t),f&&this.selectTile(r,t)),this.touchTile(r,t),r._shouldRefine=o&&l}const s=new Date().getTime();(this.traversalFinished(t)||s-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=s,this.options.onTraversalEnd(t))}updateChildTiles(e,t){const i=e.children;for(const s of i)this.updateTile(s,t)}updateAndPushChildren(e,t,i,s){const{loadSiblings:r,skipLevelOfDetail:o}=this.options,a=e.children;a.sort(this.compareDistanceToCamera.bind(this));const l=e.refine===ui.REPLACE&&e.hasRenderContent&&!o;let f=!1,g=!0;for(const _ of a)if(_._selectionDepth=s,_.isVisibleAndInRequestVolume?(i.find(_)&&i.delete(_),i.push(_),f=!0):(l||r)&&(this.loadTile(_,t),this.touchTile(_,t)),l){let v;if(_._inRequestVolume?_.hasRenderContent?v=_.contentAvailable:v=this.executeEmptyTraversal(_,t):v=!1,g=g&&v,!g)return!1}return f||(g=!1),g}updateTile(e,t){this.updateTileVisibility(e,t)}selectTile(e,t){this.shouldSelectTile(e)&&(e._selectedFrame=t.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,t){this.shouldLoadTile(e)&&(e._requestedFrame=t.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,t){e.tileset._cache.touch(e),e._touchedFrame=t.frameNumber}canTraverse(e,t){return e.hasChildren?e.hasTilesetContent?!e.contentExpired:this.shouldRefine(e,t):!1}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,t,i=!1){let s=e._screenSpaceError;return i&&(s=e.getScreenSpaceError(t,!0)),s>e.tileset.memoryAdjustedScreenSpaceError}updateTileVisibility(e,t){const i=[];if(this.options.viewportTraversersMap)for(const s in this.options.viewportTraversersMap)this.options.viewportTraversersMap[s]===t.viewport.id&&i.push(s);else i.push(t.viewport.id);e.updateVisibility(t,i)}compareDistanceToCamera(e,t){return e._distanceToCamera-t._distanceToCamera}anyChildrenVisible(e,t){let i=!1;for(const s of e.children)s.updateVisibility(t),i=i||s.isVisibleAndInRequestVolume;return i}executeEmptyTraversal(e,t){let i=!0;const s=this._emptyTraversalStack;for(s.push(e);s.length>0;){const r=s.pop(),o=!r.hasRenderContent&&this.canTraverse(r,t),a=!r.hasRenderContent&&r.children.length===0;if(!o&&!r.contentAvailable&&!a&&(i=!1),this.updateTile(r,t),r.isVisibleAndInRequestVolume||(this.loadTile(r,t),this.touchTile(r,t)),o){const l=r.children;for(const f of l)s.push(f)}}return i}}const f2=new ee;function FG(n){return n!=null}class ff{constructor(e,t,i,s=""){x(this,"tileset");x(this,"header");x(this,"id");x(this,"url");x(this,"parent");x(this,"refine");x(this,"type");x(this,"contentUrl");x(this,"lodMetricType","geometricError");x(this,"lodMetricValue",0);x(this,"boundingVolume",null);x(this,"content",null);x(this,"contentState",Dn.UNLOADED);x(this,"gpuMemoryUsageInBytes",0);x(this,"children",[]);x(this,"depth",0);x(this,"viewportIds",[]);x(this,"transform",new Ge);x(this,"extensions",null);x(this,"implicitTiling",null);x(this,"userData",{});x(this,"computedTransform");x(this,"hasEmptyContent",!1);x(this,"hasTilesetContent",!1);x(this,"traverser",new dA({}));x(this,"_cacheNode",null);x(this,"_frameNumber",null);x(this,"_expireDate",null);x(this,"_expiredContent",null);x(this,"_boundingBox");x(this,"_distanceToCamera",0);x(this,"_screenSpaceError",0);x(this,"_visibilityPlaneMask");x(this,"_visible");x(this,"_contentBoundingVolume");x(this,"_viewerRequestVolume");x(this,"_initialTransform",new Ge);x(this,"_priority",0);x(this,"_selectedFrame",0);x(this,"_requestedFrame",0);x(this,"_selectionDepth",0);x(this,"_touchedFrame",0);x(this,"_centerZDepth",0);x(this,"_shouldRefine",!1);x(this,"_stackLength",0);x(this,"_visitedFrame",0);x(this,"_inRequestVolume",!1);x(this,"_lodJudge",null);this.header=t,this.tileset=e,this.id=s||t.id,this.url=t.url,this.parent=i,this.refine=this._getRefine(t.refine),this.type=t.type,this.contentUrl=t.contentUrl,this._initializeLodMetric(t),this._initializeTransforms(t),this._initializeBoundingVolumes(t),this._initializeContent(t),this._initializeRenderingState(t),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===Dn.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===Dn.UNLOADED}get contentExpired(){return this.contentState===Dn.EXPIRED}get contentFailed(){return this.contentState===Dn.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=EG(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(e,t){switch(this.tileset.type){case Rn.I3S:return OT(this,e);case Rn.TILES3D:return MG(this,e,t);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const e=this.tileset._traverser,{skipLevelOfDetail:t}=e.options,i=this.refine===ui.ADD||t;if(i&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===Dn.UNLOADED)return-1;const s=this.parent,o=s&&(!i||this._screenSpaceError===0||s.hasTilesetContent)?s._screenSpaceError:this._screenSpaceError,a=e.root?e.root._screenSpaceError:0;return Math.max(a-o,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=Dn.LOADING;const t=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!t)return this.contentState=Dn.UNLOADED,!1;try{const i=this.tileset.getTileUrl(this.contentUrl),s=this.tileset.loader,r={...this.tileset.loadOptions,[s.id]:{...this.tileset.loadOptions[s.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(s.id)}};return this.content=await Li(i,s,r),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=Dn.READY,this._onContentLoaded(),!0}catch(i){throw this.contentState=Dn.FAILED,i}finally{t.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=Dn.UNLOADED,!0}updateVisibility(e,t){if(this._frameNumber===e.frameNumber)return;const i=this.parent,s=i?i._visibilityPlaneMask:Fn.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const r=i?i.computedTransform:this.tileset.modelMatrix;this._updateTransform(r)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,s),this._visible=this._visibilityPlaneMask!==Fn.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=t}visibility(e,t){const{cullingVolume:i}=e,{boundingVolume:s}=this;return i.computeVisibilityWithPlaneMask(s,t)}contentVisibility(){return!0}distanceToTile(e){const t=this.boundingVolume;return Math.sqrt(Math.max(t.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth({camera:e}){const t=this.boundingVolume;return f2.subVectors(t.center,e.position),e.direction.dot(f2)}insideViewerRequestVolume(e){const t=this._viewerRequestVolume;return!t||t.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(FG(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=Dn.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new Ge(e.transform):new Ge;const t=this.parent,i=this.tileset,s=t&&t.computedTransform?t.computedTransform.clone():i.modelMatrix.clone();this.computedTransform=new Ge(s).multiplyRight(this.transform);const r=t&&t._initialTransform?t._initialTransform.clone():new Ge;this._initialTransform=new Ge(r).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=Dn.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=Fn.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||ui.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(e){this.boundingVolume=Ku(e.boundingVolume,this.computedTransform,this.boundingVolume);const t=e.content;t&&(t.boundingVolume&&(this._contentBoundingVolume=Ku(t.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=Ku(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(e=new Ge){const t=e.clone().multiplyRight(this.transform);t.equals(this.computedTransform)||(this.computedTransform=t,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){switch(e){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return DG(this.tileset.tileset)}}}class LG extends dA{compareDistanceToCamera(e,t){return t._distanceToCamera===0&&e._distanceToCamera===0?t._centerZDepth-e._centerZDepth:t._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,t){if(super.updateTileVisibility(e,t),!e.isVisibleAndInRequestVolume)return;const i=e.children.length>0;if(e.hasTilesetContent&&i){const o=e.children[0];this.updateTileVisibility(o,t),e._visible=o._visible;return}if(this.meetsScreenSpaceErrorEarly(e,t)){e._visible=!1;return}const s=e.refine===ui.REPLACE,r=e._optimChildrenWithinParent===vG.USE_OPTIMIZATION;if(s&&r&&i&&!this.anyChildrenVisible(e,t)){e._visible=!1;return}}meetsScreenSpaceErrorEarly(e,t){const{parent:i}=e;return!i||i.hasTilesetContent||i.refine!==ui.ADD?!1:!this.shouldRefine(e,t,!0)}}class kG{constructor(){x(this,"frameNumberMap",new Map)}register(e,t){const i=this.frameNumberMap.get(e)||new Map,s=i.get(t)||0;i.set(t,s+1),this.frameNumberMap.set(e,i)}deregister(e,t){const i=this.frameNumberMap.get(e);if(!i)return;const s=i.get(t)||1;i.set(t,s-1)}isZero(e,t){var s;return(((s=this.frameNumberMap.get(e))==null?void 0:s.get(t))||0)===0}}const Zu={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class UG{constructor(){x(this,"_statusMap");x(this,"pendingTilesRegister",new kG);this._statusMap={}}add(e,t,i,s){if(!this._statusMap[t]){const{frameNumber:r,viewport:{id:o}}=s;this._statusMap[t]={request:e,callback:i,key:t,frameState:s,status:Zu.REQUESTED},this.pendingTilesRegister.register(o,r),e().then(a=>{this._statusMap[t].status=Zu.COMPLETED;const{frameNumber:l,viewport:{id:f}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(f,l),this._statusMap[t].callback(a,s)}).catch(a=>{this._statusMap[t].status=Zu.ERROR;const{frameNumber:l,viewport:{id:f}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(f,l),i(a)})}}update(e,t){if(this._statusMap[e]){const{frameNumber:i,viewport:{id:s}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(s,i);const{frameNumber:r,viewport:{id:o}}=t;this.pendingTilesRegister.register(o,r),this._statusMap[e].frameState=t}}find(e){return this._statusMap[e]}hasPendingTiles(e,t){return!this.pendingTilesRegister.isZero(e,t)}}class VG extends dA{constructor(t){super(t);x(this,"_tileManager");this._tileManager=new UG}traversalFinished(t){return!this._tileManager.hasPendingTiles(t.viewport.id,this._frameNumber||0)}shouldRefine(t,i){return t._lodJudge=OG(t,i),t._lodJudge==="DIG"}updateChildTiles(t,i){const s=t.header.children||[],r=t.children,o=t.tileset;for(const a of s){const l=`${a.id}-${i.viewport.id}`,f=r&&r.find(g=>g.id===l);if(f)f&&this.updateTile(f,i);else{let g=()=>this._loadTile(a.id,o);this._tileManager.find(l)?this._tileManager.update(l,i):(o.tileset.nodePages&&(g=()=>o.tileset.nodePagesTile.formTileFromNodePages(a.id)),this._tileManager.add(g,l,v=>this._onTileLoad(v,t,l),i))}}return!1}async _loadTile(t,i){const{loader:s}=i,r=i.getTileUrl(`${i.url}/nodes/${t}`),o={...i.loadOptions,i3s:{...i.loadOptions.i3s,isTileHeader:!0}};return await Li(r,s,o)}_onTileLoad(t,i,s){const r=new ff(i.tileset,t,i,s);i.children.push(r);const o=this._tileManager.find(r.id).frameState;this.updateTile(r,o),this._frameNumber===o.frameNumber&&(this.traversalFinished(o)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(r,o)}}const zG={description:"",ellipsoid:Pt.WGS84,modelMatrix:new Ge,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,memoryCacheOverflow:1,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:n=>n,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,memoryAdjustedScreenSpaceError:!1,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},gl="Tiles In Tileset(s)",eh="Tiles In Memory",d2="Tiles In View",g2="Tiles To Render",p2="Tiles Loaded",th="Tiles Loading",m2="Tiles Unloaded",_2="Failed Tile Loads",y2="Points/Vertices",nh="Tile Memory Use",b2="Maximum Screen Space Error";class HG{constructor(e,t){x(this,"options");x(this,"loadOptions");x(this,"type");x(this,"tileset");x(this,"loader");x(this,"url");x(this,"basePath");x(this,"modelMatrix");x(this,"ellipsoid");x(this,"lodMetricType");x(this,"lodMetricValue");x(this,"refine");x(this,"root",null);x(this,"roots",{});x(this,"asset",{});x(this,"description","");x(this,"properties");x(this,"extras",null);x(this,"attributions",{});x(this,"credits",{});x(this,"stats");x(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1});x(this,"cartographicCenter",null);x(this,"cartesianCenter",null);x(this,"zoom",1);x(this,"boundingVolume",null);x(this,"dynamicScreenSpaceErrorComputedDensity",0);x(this,"maximumMemoryUsage",32);x(this,"gpuMemoryUsageInBytes",0);x(this,"memoryAdjustedScreenSpaceError",0);x(this,"_cacheBytes",0);x(this,"_cacheOverflowBytes",0);x(this,"_frameNumber",0);x(this,"_queryParams",{});x(this,"_extensionsUsed",[]);x(this,"_tiles",{});x(this,"_pendingCount",0);x(this,"selectedTiles",[]);x(this,"traverseCounter",0);x(this,"geometricError",0);x(this,"lastUpdatedVieports",null);x(this,"_requestedTiles",[]);x(this,"_emptyTiles",[]);x(this,"frameStateData",{});x(this,"_traverser");x(this,"_cache",new uG);x(this,"_requestScheduler");x(this,"updatePromise",null);x(this,"tilesetInitializationPromise");this.options={...zG,...t},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||Ef(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new l1({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.memoryAdjustedScreenSpaceError=this.options.maximumScreenSpaceError,this._cacheBytes=this.options.maximumMemoryUsage*1024*1024,this._cacheOverflowBytes=this.options.memoryCacheOverflow*1024*1024,this.stats=new so({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(e){this.options={...this.options,...e}}getTileUrl(e){if(e.startsWith("data:"))return e;let i=e;return this.queryParams.length&&(i=`${e}${e.includes("?")?"&":"?"}${this.queryParams}`),i}hasExtension(e){return this._extensionsUsed.indexOf(e)>-1}update(e=null){this.tilesetInitializationPromise.then(()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)})}async selectTiles(e=null){return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise(t=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),t(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}adjustScreenSpaceError(){this.gpuMemoryUsageInBytes<this._cacheBytes?this.memoryAdjustedScreenSpaceError=Math.max(this.memoryAdjustedScreenSpaceError/1.02,this.options.maximumScreenSpaceError):this.gpuMemoryUsageInBytes>this._cacheBytes+this._cacheOverflowBytes&&(this.memoryAdjustedScreenSpaceError*=1.02)}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const t=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=t.length;const i=[];for(const s of t){const r=s.id;this._needTraverse(r)?i.push(r):this.traverseCounter--}for(const s of t){const r=s.id;if(this.roots[r]||(this.roots[r]=this._initializeTileHeaders(this.tileset,null)),!i.includes(r))continue;const o=fG(s,this._frameNumber);this._traverser.traverse(this.roots[r],o,this.options)}}_needTraverse(e){let t=e;return this.options.viewportTraversersMap&&(t=this.options.viewportTraversersMap[e]),t===e}_onTraversalEnd(e){const t=e.viewport.id;this.frameStateData[t]||(this.frameStateData[t]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const i=this.frameStateData[t],s=Object.values(this._traverser.selectedTiles),[r,o]=dG(s,e,this.options.maximumTilesSelected);i.selectedTiles=r;for(const a of o)a.unselect();i._requestedTiles=Object.values(this._traverser.requestedTiles),i._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const e in this.frameStateData){const t=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(t.selectedTiles),this._requestedTiles=this._requestedTiles.concat(t._requestedTiles),this._emptyTiles=this._emptyTiles.concat(t._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,t){if(e.length!==t.length)return!0;const i=new Set(e.map(o=>o.id)),s=new Set(t.map(o=>o.id));let r=e.filter(o=>!s.has(o.id)).length>0;return r=r||t.filter(o=>!i.has(o.id)).length>0,r}_loadTiles(){for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,(e,t)=>e._unloadTile(t))}_updateStats(){let e=0,t=0;for(const i of this.selectedTiles)i.contentAvailable&&i.content&&(e++,i.content.pointCount?t+=i.content.pointCount:t+=i.content.vertexCount);this.stats.get(d2).count=this.selectedTiles.length,this.stats.get(g2).count=e,this.stats.get(y2).count=t,this.stats.get(b2).count=this.memoryAdjustedScreenSpaceError}async _initializeTileSet(e){this.type===Rn.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===Rn.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===Rn.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var i;const e=this.tileset.fullExtent;if(e){const{xmin:s,xmax:r,ymin:o,ymax:a,zmin:l,zmax:f}=e;this.cartographicCenter=new ee(s+(r-s)/2,o+(a-o)/2,l+(f-l)/2),this.cartesianCenter=new ee,Pt.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=IT(e,this.cartographicCenter,this.cartesianCenter);return}const t=(i=this.tileset.store)==null?void 0:i.extent;if(t){const[s,r,o,a]=t;this.cartographicCenter=new ee(s+(o-s)/2,r+(a-r)/2,0),this.cartesianCenter=new ee,Pt.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=yG(t,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new ee,this.zoom=1}calculateViewPropsTiles3D(){const e=this.root,{center:t}=e.boundingVolume;if(!t){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new ee,this.zoom=1;return}t[0]!==0||t[1]!==0||t[2]!==0?(this.cartographicCenter=new ee,Pt.WGS84.cartesianToCartographic(t,this.cartographicCenter)):this.cartographicCenter=new ee(0,0,-Pt.WGS84.radii[0]),this.cartesianCenter=t,this.zoom=_G(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(gl),this.stats.get(th),this.stats.get(eh),this.stats.get(d2),this.stats.get(g2),this.stats.get(p2),this.stats.get(m2),this.stats.get(_2),this.stats.get(y2),this.stats.get(nh,"memory"),this.stats.get(b2)}_initializeTileHeaders(e,t){var s;const i=new ff(this,e.root,t);if(t&&(t.children.push(i),i.depth=t.depth+1),this.type===Rn.TILES3D){const r=[];for(r.push(i);r.length>0;){const o=r.pop();this.stats.get(gl).incrementCount();const a=o.header.children||[];for(const l of a){const f=new ff(this,l,o);if((s=f.contentUrl)!=null&&s.includes("?session=")){const _=new URL(f.contentUrl).searchParams.get("session");_&&(this._queryParams.session=_)}o.children.push(f),f.depth=o.depth+1,r.push(f)}}}return i}_initializeTraverser(){let e;switch(this.type){case Rn.TILES3D:e=LG;break;case Rn.I3S:e=VG;break;default:e=dA}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let t;try{this._onStartTileLoading(),t=await e.loadContent()}catch(i){this._onTileLoadError(e,i instanceof Error?i:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(e,t)}}_onTileLoadError(e,t){this.stats.get(_2).incrementCount();const i=t.message||t.toString(),s=e.url;console.error(`A 3D tile failed to load: ${e.url} ${i}`),this.options.onTileError(e,i,s)}_onTileLoad(e,t){var i,s;if(t){if(this.type===Rn.I3S){const r=((s=(i=this.tileset)==null?void 0:i.nodePagesTile)==null?void 0:s.nodesInNodePages)||0;this.stats.get(gl).reset(),this.stats.get(gl).addCount(r)}e&&e.content&&hG(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}updateContentTypes(e){var t;if(this.type===Rn.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===Rn.TILES3D){const{extensionsRemoved:i=[]}=((t=e.content)==null?void 0:t.gltf)||{};i.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),i.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),i.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(th).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(th).decrementCount()}_addTileToCache(e){this._cache.add(this,e,t=>t._updateCacheStats(e))}_updateCacheStats(e){this.stats.get(p2).incrementCount(),this.stats.get(eh).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get(nh).count=this.gpuMemoryUsageInBytes,this.options.memoryAdjustedScreenSpaceError&&this.adjustScreenSpaceError()}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get(eh).decrementCount(),this.stats.get(m2).incrementCount(),this.stats.get(nh).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){const e=[];for(this.root&&e.push(this.root);e.length>0;){const t=e.pop();for(const i of t.children)e.push(i);this._destroyTile(t)}this.root=null}_destroySubtree(e){const t=e,i=[];for(i.push(t);i.length>0;){e=i.pop();for(const s of e.children)i.push(s);e!==t&&this._destroyTile(e)}t.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(e.queryString){const t=new URLSearchParams(e.queryString),i=Object.fromEntries(t.entries());this._queryParams={...this._queryParams,...i}}if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0"&&this.asset.version!=="1.1")throw new Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const DT="4.3.2",Po={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GLTF:"glTF"};function NT(n,e,t){Rt(n instanceof ArrayBuffer);const i=new TextDecoder("utf8"),s=new Uint8Array(n,e,t);return i.decode(s)}function GG(n,e=0){const t=new DataView(n);return`${String.fromCharCode(t.getUint8(e+0))}${String.fromCharCode(t.getUint8(e+1))}${String.fromCharCode(t.getUint8(e+2))}${String.fromCharCode(t.getUint8(e+3))}`}const WG={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Xt={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},At={...WG,...Xt},ih={[Xt.DOUBLE]:Float64Array,[Xt.FLOAT]:Float32Array,[Xt.UNSIGNED_SHORT]:Uint16Array,[Xt.UNSIGNED_INT]:Uint32Array,[Xt.UNSIGNED_BYTE]:Uint8Array,[Xt.BYTE]:Int8Array,[Xt.SHORT]:Int16Array,[Xt.INT]:Int32Array},jG={DOUBLE:Xt.DOUBLE,FLOAT:Xt.FLOAT,UNSIGNED_SHORT:Xt.UNSIGNED_SHORT,UNSIGNED_INT:Xt.UNSIGNED_INT,UNSIGNED_BYTE:Xt.UNSIGNED_BYTE,BYTE:Xt.BYTE,SHORT:Xt.SHORT,INT:Xt.INT},sh="Failed to convert GL type";class xi{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const t in ih)if(ih[t]===e)return t;throw new Error(sh)}static fromName(e){const t=jG[e];if(!t)throw new Error(sh);return t}static getArrayType(e){switch(e){case Xt.UNSIGNED_SHORT_5_6_5:case Xt.UNSIGNED_SHORT_4_4_4_4:case Xt.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const t=ih[e];if(!t)throw new Error(sh);return t}}static getByteSize(e){return xi.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return!!xi.getArrayType(e)}static createTypedArray(e,t,i=0,s){s===void 0&&(s=(t.byteLength-i)/xi.getByteSize(e));const r=xi.getArrayType(e);return new r(t,i,s)}}function $G(n,e){if(!n)throw new Error(`math.gl assertion failed. ${e}`)}function XG(n,e=[0,0,0]){const t=n>>11&31,i=n>>5&63,s=n&31;return e[0]=t<<3,e[1]=i<<2,e[2]=s<<3,e}new Gf;new ee;new Gf;new Gf;function v2(n,e=255){return Ut(n,0,e)/e*2-1}function T2(n){return n<0?-1:1}function QG(n,e,t,i){if($G(i),n<0||n>t||e<0||e>t)throw new Error(`x and y must be unsigned normalized integers between 0 and ${t}`);if(i.x=v2(n,t),i.y=v2(e,t),i.z=1-(Math.abs(i.x)+Math.abs(i.y)),i.z<0){const s=i.x;i.x=(1-Math.abs(i.y))*T2(s),i.y=(1-Math.abs(s))*T2(i.y)}return i.normalize()}function YG(n,e,t){return QG(n,e,255,t)}class Ud{constructor(e,t){x(this,"json");x(this,"buffer");x(this,"featuresLength",0);x(this,"_cachedTypedArrays",{});this.json=e,this.buffer=t}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return!!this.json[e]}getGlobalProperty(e,t=At.UNSIGNED_INT,i=1){const s=this.json[e];return s&&Number.isFinite(s.byteOffset)?this._getTypedArrayFromBinary(e,t,i,1,s.byteOffset):s}getPropertyArray(e,t,i){const s=this.json[e];return s&&Number.isFinite(s.byteOffset)?("componentType"in s&&(t=xi.fromName(s.componentType)),this._getTypedArrayFromBinary(e,t,i,this.featuresLength,s.byteOffset)):this._getTypedArrayFromArray(e,t,s)}getProperty(e,t,i,s,r){const o=this.json[e];if(!o)return o;const a=this.getPropertyArray(e,t,i);if(i===1)return a[s];for(let l=0;l<i;++l)r[l]=a[i*s+l];return r}_getTypedArrayFromBinary(e,t,i,s,r){const o=this._cachedTypedArrays;let a=o[e];return a||(a=xi.createTypedArray(t,this.buffer.buffer,this.buffer.byteOffset+r,s*i),o[e]=a),a}_getTypedArrayFromArray(e,t,i){const s=this._cachedTypedArrays;let r=s[e];return r||(r=xi.createTypedArray(t,i),s[e]=r),r}}const KG={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},qG={SCALAR:(n,e)=>n[e],VEC2:(n,e)=>[n[2*e+0],n[2*e+1]],VEC3:(n,e)=>[n[3*e+0],n[3*e+1],n[3*e+2]],VEC4:(n,e)=>[n[4*e+0],n[4*e+1],n[4*e+2],n[4*e+3]],MAT2:(n,e)=>[n[4*e+0],n[4*e+1],n[4*e+2],n[4*e+3]],MAT3:(n,e)=>[n[9*e+0],n[9*e+1],n[9*e+2],n[9*e+3],n[9*e+4],n[9*e+5],n[9*e+6],n[9*e+7],n[9*e+8]],MAT4:(n,e)=>[n[16*e+0],n[16*e+1],n[16*e+2],n[16*e+3],n[16*e+4],n[16*e+5],n[16*e+6],n[16*e+7],n[16*e+8],n[16*e+9],n[16*e+10],n[16*e+11],n[16*e+12],n[16*e+13],n[16*e+14],n[16*e+15]]},JG={SCALAR:(n,e,t)=>{e[t]=n},VEC2:(n,e,t)=>{e[2*t+0]=n[0],e[2*t+1]=n[1]},VEC3:(n,e,t)=>{e[3*t+0]=n[0],e[3*t+1]=n[1],e[3*t+2]=n[2]},VEC4:(n,e,t)=>{e[4*t+0]=n[0],e[4*t+1]=n[1],e[4*t+2]=n[2],e[4*t+3]=n[3]},MAT2:(n,e,t)=>{e[4*t+0]=n[0],e[4*t+1]=n[1],e[4*t+2]=n[2],e[4*t+3]=n[3]},MAT3:(n,e,t)=>{e[9*t+0]=n[0],e[9*t+1]=n[1],e[9*t+2]=n[2],e[9*t+3]=n[3],e[9*t+4]=n[4],e[9*t+5]=n[5],e[9*t+6]=n[6],e[9*t+7]=n[7],e[9*t+8]=n[8],e[9*t+9]=n[9]},MAT4:(n,e,t)=>{e[16*t+0]=n[0],e[16*t+1]=n[1],e[16*t+2]=n[2],e[16*t+3]=n[3],e[16*t+4]=n[4],e[16*t+5]=n[5],e[16*t+6]=n[6],e[16*t+7]=n[7],e[16*t+8]=n[8],e[16*t+9]=n[9],e[16*t+10]=n[10],e[16*t+11]=n[11],e[16*t+12]=n[12],e[16*t+13]=n[13],e[16*t+14]=n[14],e[16*t+15]=n[15]}};function ZG(n,e,t,i){const{componentType:s}=n;Rt(n.componentType);const r=typeof s=="string"?xi.fromName(s):s,o=KG[n.type],a=qG[n.type],l=JG[n.type];return t+=n.byteOffset,{values:xi.createTypedArray(r,e,t,o*i),type:r,size:o,unpacker:a,packer:l}}const wi=n=>n!==void 0;function eW(n,e,t){if(!e)return null;let i=n.getExtension("3DTILES_batch_table_hierarchy");const s=e.HIERARCHY;return s&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=s,i=s),i?tW(i,t):null}function tW(n,e){let t,i,s;const r=n.instancesLength,o=n.classes;let a=n.classIds,l=n.parentCounts,f=n.parentIds,g=r;wi(a.byteOffset)&&(a.componentType=defaultValue(a.componentType,GL.UNSIGNED_SHORT),a.type=AttributeType.SCALAR,s=getBinaryAccessor(a),a=s.createArrayBufferView(e.buffer,e.byteOffset+a.byteOffset,r));let _;if(wi(l))for(wi(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,s=getBinaryAccessor(l),l=s.createArrayBufferView(e.buffer,e.byteOffset+l.byteOffset,r)),_=new Uint16Array(r),g=0,t=0;t<r;++t)_[t]=g,g+=l[t];wi(f)&&wi(f.byteOffset)&&(f.componentType=defaultValue(f.componentType,GL.UNSIGNED_SHORT),f.type=AttributeType.SCALAR,s=getBinaryAccessor(f),f=s.createArrayBufferView(e.buffer,e.byteOffset+f.byteOffset,g));const v=o.length;for(t=0;t<v;++t){const R=o[t].length,P=o[t].instances,F=getBinaryProperties(R,P,e);o[t].instances=combine(F,P)}const T=new Array(v).fill(0),C=new Uint16Array(r);for(t=0;t<r;++t)i=a[t],C[t]=T[i],++T[i];const S={classes:o,classIds:a,classIndexes:C,parentCounts:l,parentIndexes:_,parentIds:f};return sW(S),S}function Mo(n,e,t){if(!n)return;const i=n.parentCounts;return n.parentIds?t(n,e):i>0?nW(n,e,t):iW(n,e,t)}function nW(n,e,t){const i=n.classIds,s=n.parentCounts,r=n.parentIds,o=n.parentIndexes,a=i.length,l=scratchVisited;l.length=Math.max(l.length,a);const f=++marker,g=scratchStack;for(g.length=0,g.push(e);g.length>0;){if(e=g.pop(),l[e]===f)continue;l[e]=f;const _=t(n,e);if(wi(_))return _;const v=s[e],T=o[e];for(let C=0;C<v;++C){const S=r[T+C];S!==e&&g.push(S)}}return null}function iW(n,e,t){let i=!0;for(;i;){const s=t(n,e);if(wi(s))return s;const r=n.parentIds[e];i=r!==e,e=r}throw new Error("traverseHierarchySingleParent")}function sW(n){const t=n.classIds.length;for(let i=0;i<t;++i)FT(n,i,stack)}function FT(n,e,t){const i=n.parentCounts,s=n.parentIds,r=n.parentIndexes,a=n.classIds.length;if(!wi(s))return;assert(e<a,`Parent index ${e} exceeds the total number of instances: ${a}`),assert(t.indexOf(e)===-1,"Circular dependency detected in the batch table hierarchy."),t.push(e);const l=wi(i)?i[e]:1,f=wi(i)?r[e]:e;for(let g=0;g<l;++g){const _=s[f+g];_!==e&&FT(n,_,t)}t.pop(e)}function In(n){return n!=null}const pl=(n,e)=>n,rW={HIERARCHY:!0,extensions:!0,extras:!0};class LT{constructor(e,t,i,s={}){x(this,"json");x(this,"binary");x(this,"featureCount");x(this,"_extensions");x(this,"_properties");x(this,"_binaryProperties");x(this,"_hierarchy");var r;Rt(i>=0),this.json=e||{},this.binary=t,this.featureCount=i,this._extensions=((r=this.json)==null?void 0:r.extensions)||{},this._properties={};for(const o in this.json)rW[o]||(this._properties[o]=this.json[o]);this._binaryProperties=this._initializeBinaryProperties(),s["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=eW(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,t){if(this._checkBatchId(e),Rt(typeof t=="string",t),this._hierarchy){const i=Mo(this._hierarchy,e,(s,r)=>{const o=s.classIds[r];return s.classes[o].name===t});return In(i)}return!1}isExactClass(e,t){return Rt(typeof t=="string",t),this.getExactClassName(e)===t}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){const t=this._hierarchy.classIds[e];return this._hierarchy.classes[t].name}}hasProperty(e,t){return this._checkBatchId(e),Rt(typeof t=="string",t),In(this._properties[t])||this._hasPropertyInHierarchy(e,t)}getPropertyNames(e,t){this._checkBatchId(e),t=In(t)?t:[],t.length=0;const i=Object.keys(this._properties);return t.push(...i),this._hierarchy&&this._getPropertyNamesInHierarchy(e,t),t}getProperty(e,t){if(this._checkBatchId(e),Rt(typeof t=="string",t),this._binaryProperties){const s=this._binaryProperties[t];if(In(s))return this._getBinaryProperty(s,e)}const i=this._properties[t];if(In(i))return pl(i[e]);if(this._hierarchy){const s=this._getHierarchyProperty(e,t);if(In(s))return s}}setProperty(e,t,i){const s=this.featureCount;if(this._checkBatchId(e),Rt(typeof t=="string",t),this._binaryProperties){const o=this._binaryProperties[t];if(o){this._setBinaryProperty(o,e,i);return}}if(this._hierarchy&&this._setHierarchyProperty(this,e,t,i))return;let r=this._properties[t];In(r)||(this._properties[t]=new Array(s),r=this._properties[t]),r[e]=pl(i)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,t){return e.unpack(e.typedArray,t)}_setBinaryProperty(e,t,i){e.pack(i,e.typedArray,t)}_initializeBinaryProperties(){let e=null;for(const t in this._properties){const i=this._properties[t],s=this._initializeBinaryProperty(t,i);s&&(e=e||{},e[t]=s)}return e}_initializeBinaryProperty(e,t){if("byteOffset"in t){const i=t;Rt(this.binary,`Property ${e} requires a batch table binary.`),Rt(i.type,`Property ${e} requires a type.`);const s=ZG(i,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:s.values,componentCount:s.size,unpack:s.unpacker,pack:s.packer}}return null}_hasPropertyInHierarchy(e,t){if(!this._hierarchy)return!1;const i=Mo(this._hierarchy,e,(s,r)=>{const o=s.classIds[r],a=s.classes[o].instances;return In(a[t])});return In(i)}_getPropertyNamesInHierarchy(e,t){Mo(this._hierarchy,e,(i,s)=>{const r=i.classIds[s],o=i.classes[r].instances;for(const a in o)o.hasOwnProperty(a)&&t.indexOf(a)===-1&&t.push(a)})}_getHierarchyProperty(e,t){return Mo(this._hierarchy,e,(i,s)=>{const r=i.classIds[s],o=i.classes[r],a=i.classIndexes[s],l=o.instances[t];return In(l)?In(l.typedArray)?this._getBinaryProperty(l,a):pl(l[a]):null})}_setHierarchyProperty(e,t,i,s){const r=Mo(this._hierarchy,t,(o,a)=>{const l=o.classIds[a],f=o.classes[l],g=o.classIndexes[a],_=f.instances[i];return In(_)?(Rt(a===t,`Inherited property "${i}" is read-only.`),In(_.typedArray)?this._setBinaryProperty(_,g,s):_[g]=pl(s),!0):!1});return In(r)}}const rh=4;function gA(n,e,t=0){const i=new DataView(e);if(n.magic=i.getUint32(t,!0),t+=rh,n.version=i.getUint32(t,!0),t+=rh,n.byteLength=i.getUint32(t,!0),t+=rh,n.version!==1)throw new Error(`3D Tile Version ${n.version} not supported`);return t}const Er=4,w2="b3dm tile in legacy format.";function Vd(n,e,t){const i=new DataView(e);let s;n.header=n.header||{};let r=i.getUint32(t,!0);t+=Er;let o=i.getUint32(t,!0);t+=Er;let a=i.getUint32(t,!0);t+=Er;let l=i.getUint32(t,!0);return t+=Er,a>=570425344?(t-=Er*2,s=r,a=o,l=0,r=0,o=0,console.warn(w2)):l>=570425344&&(t-=Er,s=a,a=r,l=o,r=0,o=0,console.warn(w2)),n.header.featureTableJsonByteLength=r,n.header.featureTableBinaryByteLength=o,n.header.batchTableJsonByteLength=a,n.header.batchTableBinaryByteLength=l,n.header.batchLength=s,t}function zd(n,e,t,i){return t=oW(n,e,t),t=aW(n,e,t),t}function oW(n,e,t,i){const{featureTableJsonByteLength:s,featureTableBinaryByteLength:r,batchLength:o}=n.header||{};if(n.featureTableJson={BATCH_LENGTH:o||0},s&&s>0){const a=NT(e,t,s);n.featureTableJson=JSON.parse(a)}return t+=s||0,n.featureTableBinary=new Uint8Array(e,t,r),t+=r||0,t}function aW(n,e,t,i){const{batchTableJsonByteLength:s,batchTableBinaryByteLength:r}=n.header||{};if(s&&s>0){const o=NT(e,t,s);n.batchTableJson=JSON.parse(o),t+=s,r&&r>0&&(n.batchTableBinary=new Uint8Array(e,t,r),n.batchTableBinary=new Uint8Array(n.batchTableBinary),t+=r)}return t}function kT(n,e,t){if(!e&&(!n||!n.batchIds||!t))return null;const{batchIds:i,isRGB565:s,pointCount:r=0}=n;if(i&&t){const o=new Uint8ClampedArray(r*3);for(let a=0;a<r;a++){const l=i[a],g=t.getProperty(l,"dimensions").map(_=>_*255);o[a*3]=g[0],o[a*3+1]=g[1],o[a*3+2]=g[2]}return{type:At.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}if(e&&s){const o=new Uint8ClampedArray(r*3);for(let a=0;a<r;a++){const l=XG(e[a]);o[a*3]=l[0],o[a*3+1]=l[1],o[a*3+2]=l[2]}return{type:At.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}return e&&e.length===r*3?{type:At.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:At.UNSIGNED_BYTE,value:e||new Uint8ClampedArray,size:4,normalized:!0}}const E2=new ee;function lW(n,e){if(!e)return null;if(n.isOctEncoded16P){const t=new Float32Array((n.pointsLength||0)*3);for(let i=0;i<(n.pointsLength||0);i++)YG(e[i*2],e[i*2+1],E2),E2.toArray(t,i*3);return{type:At.FLOAT,size:2,value:t}}return{type:At.FLOAT,size:2,value:e}}function cW(n,e,t){return n.isQuantized?t["3d-tiles"]&&t["3d-tiles"].decodeQuantizedPositions?(n.isQuantized=!1,AW(n,e)):{type:At.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}function AW(n,e){const t=new ee,i=new Float32Array(n.pointCount*3);for(let s=0;s<n.pointCount;s++)t.set(e[s*3],e[s*3+1],e[s*3+2]).scale(1/n.quantizedRange).multiply(n.quantizedVolumeScale).add(n.quantizedVolumeOffset).toArray(i,s*3);return i}async function uW(n,e,t,i,s){t=gA(n,e,t),t=Vd(n,e,t),t=zd(n,e,t),hW(n);const{featureTable:r,batchTable:o}=fW(n);return await _W(n,r,o,i,s),dW(n,r,i),gW(n,r,o),pW(n,r),t}function hW(n){n.attributes={positions:null,colors:null,normals:null,batchIds:null},n.isQuantized=!1,n.isTranslucent=!1,n.isRGB565=!1,n.isOctEncoded16P=!1}function fW(n){const e=new Ud(n.featureTableJson,n.featureTableBinary),t=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(t))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=t,n.featuresLength=t,n.pointsLength=t,n.pointCount=t,n.rtcCenter=e.getGlobalProperty("RTC_CENTER",At.FLOAT,3);const i=mW(n,e);return{featureTable:e,batchTable:i}}function dW(n,e,t){if(n.attributes=n.attributes||{positions:null,colors:null,normals:null,batchIds:null},!n.attributes.positions){if(e.hasProperty("POSITION"))n.attributes.positions=e.getPropertyArray("POSITION",At.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const i=e.getPropertyArray("POSITION_QUANTIZED",At.UNSIGNED_SHORT,3);if(n.isQuantized=!0,n.quantizedRange=65535,n.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",At.FLOAT,3),!n.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(n.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",At.FLOAT,3),!n.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");n.attributes.positions=cW(n,i,t)}}if(!n.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function gW(n,e,t){if(n.attributes=n.attributes||{positions:null,colors:null,normals:null,batchIds:null},!n.attributes.colors){let i=null;e.hasProperty("RGBA")?(i=e.getPropertyArray("RGBA",At.UNSIGNED_BYTE,4),n.isTranslucent=!0):e.hasProperty("RGB")?i=e.getPropertyArray("RGB",At.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(i=e.getPropertyArray("RGB565",At.UNSIGNED_SHORT,1),n.isRGB565=!0),n.attributes.colors=kT(n,i,t)}e.hasProperty("CONSTANT_RGBA")&&(n.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",At.UNSIGNED_BYTE,4))}function pW(n,e){if(n.attributes=n.attributes||{positions:null,colors:null,normals:null,batchIds:null},!n.attributes.normals){let t=null;e.hasProperty("NORMAL")?t=e.getPropertyArray("NORMAL",At.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(t=e.getPropertyArray("NORMAL_OCT16P",At.UNSIGNED_BYTE,2),n.isOctEncoded16P=!0),n.attributes.normals=lW(n,t)}}function mW(n,e){let t=null;if(!n.batchIds&&e.hasProperty("BATCH_ID")&&(n.batchIds=e.getPropertyArray("BATCH_ID",At.UNSIGNED_SHORT,1),n.batchIds)){const i=e.getGlobalProperty("BATCH_LENGTH");if(!i)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:s,batchTableBinary:r}=n;t=new LT(s,r,i)}return t}async function _W(n,e,t,i,s){let r,o,a;const l=n.batchTableJson&&n.batchTableJson.extensions&&n.batchTableJson.extensions["3DTILES_draco_point_compression"];l&&(a=l.properties);const f=e.getExtension("3DTILES_draco_point_compression");if(f){o=f.properties;const _=f.byteOffset,v=f.byteLength;if(!o||!Number.isFinite(_)||!v)throw new Error("Draco properties, byteOffset, and byteLength must be defined");r=(n.featureTableBinary||[]).slice(_,_+v),n.hasPositions=Number.isFinite(o.POSITION),n.hasColors=Number.isFinite(o.RGB)||Number.isFinite(o.RGBA),n.hasNormals=Number.isFinite(o.NORMAL),n.hasBatchIds=Number.isFinite(o.BATCH_ID),n.isTranslucent=Number.isFinite(o.RGBA)}if(!r)return!0;const g={buffer:r,properties:{...o,...a},batchTableProperties:a};return await yW(n,g,i,s)}async function yW(n,e,t,i){if(!i)return;const s={...t,draco:{...t==null?void 0:t.draco,extraAttributes:e.batchTableProperties||{}}};delete s["3d-tiles"];const r=await aa(e.buffer,TT,s,i),o=r.attributes.POSITION&&r.attributes.POSITION.value,a=r.attributes.COLOR_0&&r.attributes.COLOR_0.value,l=r.attributes.NORMAL&&r.attributes.NORMAL.value,f=r.attributes.BATCH_ID&&r.attributes.BATCH_ID.value,g=o&&r.attributes.POSITION.value.quantization,_=l&&r.attributes.NORMAL.value.quantization;if(g){const T=r.POSITION.data.quantization,C=T.range;n.quantizedVolumeScale=new ee(C,C,C),n.quantizedVolumeOffset=new ee(T.minValues),n.quantizedRange=(1<<T.quantizationBits)-1,n.isQuantizedDraco=!0}_&&(n.octEncodedRange=(1<<r.NORMAL.data.quantization.quantizationBits)-1,n.isOctEncodedDraco=!0);const v={};if(e.batchTableProperties)for(const T of Object.keys(e.batchTableProperties))r.attributes[T]&&r.attributes[T].value&&(v[T.toLowerCase()]=r.attributes[T].value);n.attributes={positions:o,colors:kT(n,a,void 0),normals:l,batchIds:f,...v}}const df={URI:0,EMBEDDED:1};function UT(n,e,t,i){n.rotateYtoZ=!0;const s=(n.byteOffset||0)+(n.byteLength||0)-t;if(s===0)throw new Error("glTF byte length must be greater than 0.");return n.gltfUpAxis=i!=null&&i["3d-tiles"]&&i["3d-tiles"].assetGltfUpAxis?i["3d-tiles"].assetGltfUpAxis:"Y",n.gltfArrayBuffer=wf(e,t,s),n.gltfByteOffset=0,n.gltfByteLength=s,t%4===0||console.warn(`${n.type}: embedded glb is not aligned to a 4-byte boundary.`),(n.byteOffset||0)+(n.byteLength||0)}async function VT(n,e,t,i){const s=(t==null?void 0:t["3d-tiles"])||{};if(bW(n,e),s.loadGLTF){if(!i)return;if(n.gltfUrl){const{fetch:r}=i,o=await r(n.gltfUrl,t);n.gltfArrayBuffer=await o.arrayBuffer(),n.gltfByteOffset=0}if(n.gltfArrayBuffer){const r=await aa(n.gltfArrayBuffer,ra,t,i);n.gltf=Fd(r),n.gpuMemoryUsageInBytes=hT(n.gltf),delete n.gltfArrayBuffer,delete n.gltfByteOffset,delete n.gltfByteLength}}}function bW(n,e,t){switch(e){case df.URI:if(n.gltfArrayBuffer){const i=new Uint8Array(n.gltfArrayBuffer,n.gltfByteOffset),r=new TextDecoder().decode(i);n.gltfUrl=r.replace(/[\s\0]+$/,"")}delete n.gltfArrayBuffer,delete n.gltfByteOffset,delete n.gltfByteLength;break;case df.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function vW(n,e,t,i,s){var o;t=TW(n,e,t,i),await VT(n,df.EMBEDDED,i,s);const r=(o=n==null?void 0:n.gltf)==null?void 0:o.extensions;return r&&r.CESIUM_RTC&&(n.rtcCenter=r.CESIUM_RTC.center),t}function TW(n,e,t,i,s){t=gA(n,e,t),t=Vd(n,e,t),t=zd(n,e,t),t=UT(n,e,t,i);const r=new Ud(n.featureTableJson,n.featureTableBinary);return n.rtcCenter=r.getGlobalProperty("RTC_CENTER",At.FLOAT,3),t}async function wW(n,e,t,i,s){return t=EW(n,e,t,i),await VT(n,n.gltfFormat||0,i,s),t}function EW(n,e,t,i,s){var f;if(t=gA(n,e,t),n.version!==1)throw new Error(`Instanced 3D Model version ${n.version} is not supported`);t=Vd(n,e,t);const r=new DataView(e);if(n.gltfFormat=r.getUint32(t,!0),t+=4,t=zd(n,e,t),t=UT(n,e,t,i),!((f=n==null?void 0:n.header)!=null&&f.featureTableJsonByteLength)||n.header.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const o=new Ud(n.featureTableJson,n.featureTableBinary),a=o.getGlobalProperty("INSTANCES_LENGTH");if(o.featuresLength=a,!Number.isFinite(a))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");n.eastNorthUp=o.getGlobalProperty("EAST_NORTH_UP"),n.rtcCenter=o.getGlobalProperty("RTC_CENTER",At.FLOAT,3);const l=new LT(n.batchTableJson,n.batchTableBinary,a);return xW(n,o,l,a),t}function xW(n,e,t,i){const s=new Array(i),r=new ee;new ee,new ee,new ee;const o=new Wt,a=new Jo,l=new ee,f={},g=new Ge,_=[],v=[],T=[],C=[];for(let S=0;S<i;S++){let R;if(e.hasProperty("POSITION"))R=e.getProperty("POSITION",At.FLOAT,3,S,r);else if(e.hasProperty("POSITION_QUANTIZED")){R=e.getProperty("POSITION_QUANTIZED",At.UNSIGNED_SHORT,3,S,r);const se=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",At.FLOAT,3);if(!se)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const Se=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",At.FLOAT,3);if(!Se)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const me=65535;for(let J=0;J<3;J++)R[J]=R[J]/me*Se[J]+se[J]}if(!R)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(r.copy(R),f.translation=r,n.normalUp=e.getProperty("NORMAL_UP",At.FLOAT,3,S,_),n.normalRight=e.getProperty("NORMAL_RIGHT",At.FLOAT,3,S,v),n.normalUp){if(!n.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");n.hasCustomOrientation=!0}else{if(n.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",At.UNSIGNED_SHORT,2,S,_),n.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",At.UNSIGNED_SHORT,2,S,v),n.octNormalUp)throw n.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");n.eastNorthUp?(Pt.WGS84.eastNorthUpToFixedFrame(r,g),g.getRotationMatrix3(o)):o.identity()}a.fromMatrix3(o),f.rotation=a,l.set(1,1,1);const P=e.getProperty("SCALE",At.FLOAT,1,S,T);Number.isFinite(P)&&l.multiplyByScalar(P);const F=e.getProperty("SCALE_NON_UNIFORM",At.FLOAT,3,S,_);F&&l.scale(F),f.scale=l;let U=e.getProperty("BATCH_ID",At.UNSIGNED_SHORT,1,S,C);U===void 0&&(U=S);const X=new Ge().fromQuaternion(f.rotation);g.identity(),g.translate(f.translation),g.multiplyRight(X),g.scale(f.scale);const Z=g.clone();s[S]={modelMatrix:Z,batchId:U}}n.instances=s}async function CW(n,e,t,i,s,r){t=gA(n,e,t);const o=new DataView(e);for(n.tilesLength=o.getUint32(t,!0),t+=4,n.tiles=[];n.tiles.length<n.tilesLength&&(n.byteLength||0)-t>12;){const a={shape:"tile3d"};n.tiles.push(a),t=await r(e,t,i,s,a)}return t}async function SW(n,e,t,i){var s,r;if(n.rotateYtoZ=!0,n.gltfUpAxis=(s=t==null?void 0:t["3d-tiles"])!=null&&s.assetGltfUpAxis?t["3d-tiles"].assetGltfUpAxis:"Y",(r=t==null?void 0:t["3d-tiles"])!=null&&r.loadGLTF){if(!i)return e.byteLength;const o=await aa(e,ra,t,i);n.gltf=Fd(o),n.gpuMemoryUsageInBytes=hT(n.gltf)}else n.gltfArrayBuffer=e;return e.byteLength}async function zT(n,e=0,t,i,s={shape:"tile3d"}){switch(s.byteOffset=e,s.type=GG(n,e),s.type){case Po.COMPOSITE:return await CW(s,n,e,t,i,zT);case Po.BATCHED_3D_MODEL:return await vW(s,n,e,t,i);case Po.GLTF:return await SW(s,n,t,i);case Po.INSTANCED_3D_MODEL:return await wW(s,n,e,t,i);case Po.POINT_CLOUD:return await uW(s,n,e,t,i);default:throw new Error(`3DTileLoader: unknown type ${s.type}`)}}const IW=1952609651,RW=1;async function PW(n,e,t){if(new Uint32Array(n.slice(0,4))[0]!==IW)throw new Error("Wrong subtree file magic number");if(new Uint32Array(n.slice(4,8))[0]!==RW)throw new Error("Wrong subtree file verson, must be 1");const r=x2(n.slice(8,16)),o=new Uint8Array(n,24,r),l=new TextDecoder("utf8").decode(o),f=JSON.parse(l),g=x2(n.slice(16,24));let _=new ArrayBuffer(0);if(g&&(_=n.slice(24+r)),await ml(f,f.tileAvailability,_,t),Array.isArray(f.contentAvailability))for(const v of f.contentAvailability)await ml(f,v,_,t);else await ml(f,f.contentAvailability,_,t);return await ml(f,f.childSubtreeAvailability,_,t),f}async function ml(n,e,t,i){const s=Number.isFinite(e.bitstream)?e.bitstream:e.bufferView;if(typeof s!="number")return;const r=n.bufferViews[s],o=n.buffers[r.buffer];if(!(i!=null&&i.baseUrl))throw new Error("Url is not provided");if(!i.fetch)throw new Error("fetch is not provided");if(o.uri){const l=`${(i==null?void 0:i.baseUrl)||""}/${o.uri}`,g=await(await i.fetch(l)).arrayBuffer();e.explicitBitstream=new Uint8Array(g,r.byteOffset,r.byteLength);return}const a=n.buffers.slice(0,r.buffer).reduce((l,f)=>l+f.byteLength,0);e.explicitBitstream=new Uint8Array(t.slice(a,a+o.byteLength),r.byteOffset,r.byteLength)}function x2(n){const e=new DataView(n),t=e.getUint32(0,!0),i=e.getUint32(4,!0);return t+2**32*i}const HT={dataType:null,batchType:null,id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:DT,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:PW,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var jn=null;try{jn=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function yt(n,e,t){this.low=n|0,this.high=e|0,this.unsigned=!!t}yt.prototype.__isLong__;Object.defineProperty(yt.prototype,"__isLong__",{value:!0});function wn(n){return(n&&n.__isLong__)===!0}function C2(n){var e=Math.clz32(n&-n);return n?31-e:e}yt.isLong=wn;var S2={},I2={};function Js(n,e){var t,i,s;return e?(n>>>=0,(s=0<=n&&n<256)&&(i=I2[n],i)?i:(t=ut(n,0,!0),s&&(I2[n]=t),t)):(n|=0,(s=-128<=n&&n<128)&&(i=S2[n],i)?i:(t=ut(n,n<0?-1:0,!1),s&&(S2[n]=t),t))}yt.fromInt=Js;function $n(n,e){if(isNaN(n))return e?Ni:ci;if(e){if(n<0)return Ni;if(n>=GT)return $T}else{if(n<=-9223372036854776e3)return Mn;if(n+1>=BW)return jT}return n<0?$n(-n,e).neg():ut(n%to|0,n/to|0,e)}yt.fromNumber=$n;function ut(n,e,t){return new yt(n,e,t)}yt.fromBits=ut;var Sc=Math.pow;function Hd(n,e,t){if(n.length===0)throw Error("empty string");if(typeof e=="number"?(t=e,e=!1):e=!!e,n==="NaN"||n==="Infinity"||n==="+Infinity"||n==="-Infinity")return e?Ni:ci;if(t=t||10,t<2||36<t)throw RangeError("radix");var i;if((i=n.indexOf("-"))>0)throw Error("interior hyphen");if(i===0)return Hd(n.substring(1),e,t).neg();for(var s=$n(Sc(t,8)),r=ci,o=0;o<n.length;o+=8){var a=Math.min(8,n.length-o),l=parseInt(n.substring(o,o+a),t);if(a<8){var f=$n(Sc(t,a));r=r.mul(f).add($n(l))}else r=r.mul(s),r=r.add($n(l))}return r.unsigned=e,r}yt.fromString=Hd;function qn(n,e){return typeof n=="number"?$n(n,e):typeof n=="string"?Hd(n,e):ut(n.low,n.high,typeof e=="boolean"?e:n.unsigned)}yt.fromValue=qn;var R2=65536,MW=1<<24,to=R2*R2,GT=to*to,BW=GT/2,P2=Js(MW),ci=Js(0);yt.ZERO=ci;var Ni=Js(0,!0);yt.UZERO=Ni;var Lr=Js(1);yt.ONE=Lr;var WT=Js(1,!0);yt.UONE=WT;var gf=Js(-1);yt.NEG_ONE=gf;var jT=ut(-1,2147483647,!1);yt.MAX_VALUE=jT;var $T=ut(-1,-1,!0);yt.MAX_UNSIGNED_VALUE=$T;var Mn=ut(0,-2147483648,!1);yt.MIN_VALUE=Mn;var Te=yt.prototype;Te.toInt=function(){return this.unsigned?this.low>>>0:this.low};Te.toNumber=function(){return this.unsigned?(this.high>>>0)*to+(this.low>>>0):this.high*to+(this.low>>>0)};Te.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Mn)){var t=$n(e),i=this.div(t),s=i.mul(t).sub(this);return i.toString(e)+s.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var r=$n(Sc(e,6),this.unsigned),o=this,a="";;){var l=o.div(r),f=o.sub(l.mul(r)).toInt()>>>0,g=f.toString(e);if(o=l,o.isZero())return g+a;for(;g.length<6;)g="0"+g;a=""+g+a}};Te.getHighBits=function(){return this.high};Te.getHighBitsUnsigned=function(){return this.high>>>0};Te.getLowBits=function(){return this.low};Te.getLowBitsUnsigned=function(){return this.low>>>0};Te.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Mn)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};Te.isSafeInteger=function(){var e=this.high>>21;return e?this.unsigned?!1:e===-1&&!(this.low===0&&this.high===-2097152):!0};Te.isZero=function(){return this.high===0&&this.low===0};Te.eqz=Te.isZero;Te.isNegative=function(){return!this.unsigned&&this.high<0};Te.isPositive=function(){return this.unsigned||this.high>=0};Te.isOdd=function(){return(this.low&1)===1};Te.isEven=function(){return(this.low&1)===0};Te.equals=function(e){return wn(e)||(e=qn(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Te.eq=Te.equals;Te.notEquals=function(e){return!this.eq(e)};Te.neq=Te.notEquals;Te.ne=Te.notEquals;Te.lessThan=function(e){return this.comp(e)<0};Te.lt=Te.lessThan;Te.lessThanOrEqual=function(e){return this.comp(e)<=0};Te.lte=Te.lessThanOrEqual;Te.le=Te.lessThanOrEqual;Te.greaterThan=function(e){return this.comp(e)>0};Te.gt=Te.greaterThan;Te.greaterThanOrEqual=function(e){return this.comp(e)>=0};Te.gte=Te.greaterThanOrEqual;Te.ge=Te.greaterThanOrEqual;Te.compare=function(e){if(wn(e)||(e=qn(e)),this.eq(e))return 0;var t=this.isNegative(),i=e.isNegative();return t&&!i?-1:!t&&i?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Te.comp=Te.compare;Te.negate=function(){return!this.unsigned&&this.eq(Mn)?Mn:this.not().add(Lr)};Te.neg=Te.negate;Te.add=function(e){wn(e)||(e=qn(e));var t=this.high>>>16,i=this.high&65535,s=this.low>>>16,r=this.low&65535,o=e.high>>>16,a=e.high&65535,l=e.low>>>16,f=e.low&65535,g=0,_=0,v=0,T=0;return T+=r+f,v+=T>>>16,T&=65535,v+=s+l,_+=v>>>16,v&=65535,_+=i+a,g+=_>>>16,_&=65535,g+=t+o,g&=65535,ut(v<<16|T,g<<16|_,this.unsigned)};Te.subtract=function(e){return wn(e)||(e=qn(e)),this.add(e.neg())};Te.sub=Te.subtract;Te.multiply=function(e){if(this.isZero())return this;if(wn(e)||(e=qn(e)),jn){var t=jn.mul(this.low,this.high,e.low,e.high);return ut(t,jn.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?Ni:ci;if(this.eq(Mn))return e.isOdd()?Mn:ci;if(e.eq(Mn))return this.isOdd()?Mn:ci;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(P2)&&e.lt(P2))return $n(this.toNumber()*e.toNumber(),this.unsigned);var i=this.high>>>16,s=this.high&65535,r=this.low>>>16,o=this.low&65535,a=e.high>>>16,l=e.high&65535,f=e.low>>>16,g=e.low&65535,_=0,v=0,T=0,C=0;return C+=o*g,T+=C>>>16,C&=65535,T+=r*g,v+=T>>>16,T&=65535,T+=o*f,v+=T>>>16,T&=65535,v+=s*g,_+=v>>>16,v&=65535,v+=r*f,_+=v>>>16,v&=65535,v+=o*l,_+=v>>>16,v&=65535,_+=i*g+s*f+r*l+o*a,_&=65535,ut(T<<16|C,_<<16|v,this.unsigned)};Te.mul=Te.multiply;Te.divide=function(e){if(wn(e)||(e=qn(e)),e.isZero())throw Error("division by zero");if(jn){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?jn.div_u:jn.div_s)(this.low,this.high,e.low,e.high);return ut(t,jn.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Ni:ci;var i,s,r;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Ni;if(e.gt(this.shru(1)))return WT;r=Ni}else{if(this.eq(Mn)){if(e.eq(Lr)||e.eq(gf))return Mn;if(e.eq(Mn))return Lr;var o=this.shr(1);return i=o.div(e).shl(1),i.eq(ci)?e.isNegative()?Lr:gf:(s=this.sub(e.mul(i)),r=i.add(s.div(e)),r)}else if(e.eq(Mn))return this.unsigned?Ni:ci;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();r=ci}for(s=this;s.gte(e);){i=Math.max(1,Math.floor(s.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(i)/Math.LN2),l=a<=48?1:Sc(2,a-48),f=$n(i),g=f.mul(e);g.isNegative()||g.gt(s);)i-=l,f=$n(i,this.unsigned),g=f.mul(e);f.isZero()&&(f=Lr),r=r.add(f),s=s.sub(g)}return r};Te.div=Te.divide;Te.modulo=function(e){if(wn(e)||(e=qn(e)),jn){var t=(this.unsigned?jn.rem_u:jn.rem_s)(this.low,this.high,e.low,e.high);return ut(t,jn.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Te.mod=Te.modulo;Te.rem=Te.modulo;Te.not=function(){return ut(~this.low,~this.high,this.unsigned)};Te.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};Te.clz=Te.countLeadingZeros;Te.countTrailingZeros=function(){return this.low?C2(this.low):C2(this.high)+32};Te.ctz=Te.countTrailingZeros;Te.and=function(e){return wn(e)||(e=qn(e)),ut(this.low&e.low,this.high&e.high,this.unsigned)};Te.or=function(e){return wn(e)||(e=qn(e)),ut(this.low|e.low,this.high|e.high,this.unsigned)};Te.xor=function(e){return wn(e)||(e=qn(e)),ut(this.low^e.low,this.high^e.high,this.unsigned)};Te.shiftLeft=function(e){return wn(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?ut(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):ut(0,this.low<<e-32,this.unsigned)};Te.shl=Te.shiftLeft;Te.shiftRight=function(e){return wn(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?ut(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):ut(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Te.shr=Te.shiftRight;Te.shiftRightUnsigned=function(e){return wn(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?ut(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?ut(this.high,0,this.unsigned):ut(this.high>>>e-32,0,this.unsigned)};Te.shru=Te.shiftRightUnsigned;Te.shr_u=Te.shiftRightUnsigned;Te.rotateLeft=function(e){var t;return wn(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?ut(this.high,this.low,this.unsigned):e<32?(t=32-e,ut(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,ut(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))};Te.rotl=Te.rotateLeft;Te.rotateRight=function(e){var t;return wn(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?ut(this.high,this.low,this.unsigned):e<32?(t=32-e,ut(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,ut(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))};Te.rotr=Te.rotateRight;Te.toSigned=function(){return this.unsigned?ut(this.low,this.high,!1):this};Te.toUnsigned=function(){return this.unsigned?this:ut(this.low,this.high,!0)};Te.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Te.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Te.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};yt.fromBytes=function(e,t,i){return i?yt.fromBytesLE(e,t):yt.fromBytesBE(e,t)};yt.fromBytesLE=function(e,t){return new yt(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};yt.fromBytesBE=function(e,t){return new yt(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};typeof BigInt=="function"&&(yt.fromBigInt=function(e,t){var i=Number(BigInt.asIntN(32,e)),s=Number(BigInt.asIntN(32,e>>BigInt(32)));return ut(i,s,t)},yt.fromValue=function(e,t){return typeof e=="bigint"?fromBigInt(e,t):qn(e,t)},Te.toBigInt=function(){var e=BigInt(this.low>>>0),t=BigInt(this.unsigned?this.high>>>0:this.high);return t<<BigInt(32)|e});const OW=16;function XT(n){n==="X"&&(n="");const e=n.padEnd(OW,"0");return yt.fromString(e,!0,16)}function DW(n){if(n.isZero())return"X";let e=n.countTrailingZeros();const t=e%4;e=(e-t)/4;const i=e;e*=4;const r=n.shiftRightUnsigned(e).toString(16).replace(/0+$/,"");return Array(17-i-r.length).join("0")+r}function NW(n,e){const t=FW(n).shiftRightUnsigned(2);return n.add(yt.fromNumber(2*e+1-4).multiply(t))}function FW(n){return n.and(n.not().add(1))}const LW=3,kW=30,UW=2*kW+1,M2=180/Math.PI;function VW(n){if(n.length===0)throw new Error(`Invalid Hilbert quad key ${n}`);const e=n.split("/"),t=parseInt(e[0],10),i=e[1],s=i.length;let r=0;const o=[0,0];for(let a=s-1;a>=0;a--){r=s-a;const l=i[a];let f=0,g=0;l==="1"?g=1:l==="2"?(f=1,g=1):l==="3"&&(f=1);const _=Math.pow(2,r-1);HW(_,o,f,g),o[0]+=_*f,o[1]+=_*g}if(t%2===1){const a=o[0];o[0]=o[1],o[1]=a}return{face:t,ij:o,level:r}}function zW(n){if(n.isZero())return"";let e=n.toString(2);for(;e.length<LW+UW;)e="0"+e;const t=e.lastIndexOf("1"),i=e.substring(0,3),s=e.substring(3,t),r=s.length/2,o=yt.fromString(i,!0,2).toString(10);let a="";if(r!==0)for(a=yt.fromString(s,!0,2).toString(4);a.length<r;)a="0"+a;return`${o}/${a}`}function QT(n,e,t){const i=1<<e;return[(n[0]+t[0])/i,(n[1]+t[1])/i]}function B2(n){return n>=.5?1/3*(4*n*n-1):1/3*(1-4*(1-n)*(1-n))}function YT(n){return[B2(n[0]),B2(n[1])]}function KT(n,[e,t]){switch(n){case 0:return[1,e,t];case 1:return[-e,1,t];case 2:return[-e,-t,1];case 3:return[-1,-t,-e];case 4:return[t,-1,-e];case 5:return[t,e,-1];default:throw new Error("Invalid face")}}function qT([n,e,t]){const i=Math.atan2(t,Math.sqrt(n*n+e*e));return[Math.atan2(e,n)*M2,i*M2]}function HW(n,e,t,i){if(i===0){t===1&&(e[0]=n-1-e[0],e[1]=n-1-e[1]);const s=e[0];e[0]=e[1],e[1]=s}}function GW(n){const e=QT(n.ij,n.level,[.5,.5]),t=YT(e),i=KT(n.face,t);return qT(i)}const WW=100;function O2(n){const{face:e,ij:t,level:i}=n,s=[[0,0],[0,1],[1,1],[1,0],[0,0]],r=Math.max(1,Math.ceil(WW*Math.pow(2,-i))),o=new Float64Array(4*r*2+2);let a=0,l=0;for(let f=0;f<4;f++){const g=s[f].slice(0),_=s[f+1],v=(_[0]-g[0])/r,T=(_[1]-g[1])/r;for(let C=0;C<r;C++){g[0]+=v,g[1]+=T;const S=QT(t,i,g),R=YT(S),P=KT(e,R),F=qT(P);Math.abs(F[1])>89.999&&(F[0]=l);const U=F[0]-l;F[0]+=U>180?-360:U<-180?360:0,o[a++]=F[0],o[a++]=F[1],l=F[0]}}return o[a++]=o[0],o[a++]=o[1],o}function Gd(n){const e=jW(n);return VW(e)}function jW(n){if(n.indexOf("/")>0)return n;const e=XT(n);return zW(e)}function $W(n){const e=Gd(n);return GW(e)}function XW(n){let e;if(n.face===2||n.face===5){let t=null,i=0;for(let s=0;s<4;s++){const r=`${n.face}/${s}`,o=Gd(r),a=O2(o);(typeof t>"u"||t===null)&&(t=new Float64Array(4*a.length)),t.set(a,i),i+=a.length}e=D2(t)}else{const t=O2(n);e=D2(t)}return e}function D2(n){if(n.length%2!==0)throw new Error("Invalid corners");const e=[],t=[];for(let i=0;i<n.length;i+=2)e.push(n[i]),t.push(n[i+1]);return e.sort((i,s)=>i-s),t.sort((i,s)=>i-s),{west:e[0],east:e[e.length-1],north:t[t.length-1],south:t[0]}}function QW(n,e){const t=(e==null?void 0:e.minimumHeight)||0,i=(e==null?void 0:e.maximumHeight)||0,s=Gd(n),r=XW(s),o=r.west,a=r.south,l=r.east,f=r.north,g=[];return g.push(new ee(o,f,t)),g.push(new ee(l,f,t)),g.push(new ee(l,a,t)),g.push(new ee(o,a,t)),g.push(new ee(o,f,i)),g.push(new ee(l,f,i)),g.push(new ee(l,a,i)),g.push(new ee(o,a,i)),g}function JT(n){const e=n.token,t={minimumHeight:n.minimumHeight,maximumHeight:n.maximumHeight},i=QW(e,t),s=$W(e),r=s[0],o=s[1],a=Pt.WGS84.cartographicToCartesian([r,o,t.maximumHeight]),l=new ee(a[0],a[1],a[2]);i.push(l);const f=zv(i);return[...f.center,...f.halfAxes]}const YW=4,KW=8,qW={QUADTREE:YW,OCTREE:KW};function JW(n,e,t){if(n!=null&&n.box){const i=XT(n.s2VolumeInfo.token),s=NW(i,e),r=DW(s),o={...n.s2VolumeInfo};switch(o.token=r,t){case"OCTREE":const f=n.s2VolumeInfo,g=f.maximumHeight-f.minimumHeight,_=g/2,v=f.minimumHeight+g/2;f.minimumHeight=v-_,f.maximumHeight=v+_;break}return{box:JT(o),s2VolumeInfo:o}}}async function ZT(n){const{subtree:e,subtreeData:t={level:0,x:0,y:0,z:0},parentData:i={mortonIndex:0,localLevel:-1,localX:0,localY:0,localZ:0},childIndex:s=0,implicitOptions:r,loaderOptions:o,s2VolumeBox:a}=n,{subdivisionScheme:l,subtreeLevels:f,maximumLevel:g,contentUrlTemplate:_,subtreesUriTemplate:v,basePath:T}=r,C={children:[],lodMetricValue:0,contentUrl:""};if(!g)return i1.once(`Missing 'maximumLevel' or 'availableLevels' property. The subtree ${_} won't be loaded...`),C;const S=i.localLevel+1,R=t.level+S;if(R>g)return C;const P=qW[l],F=Math.log2(P),U=s&1,X=s>>1&1,Z=s>>2&1,se=Ps(i.localX,U,1),Se=Ps(i.localY,X,1),me=Ps(i.localZ,Z,1),J=Ps(t.x,se,S),q=Ps(t.y,Se,S),L=Ps(t.z,me,S),fe=Ps(i.mortonIndex,s,F),we=S===f&&oh(e.childSubtreeAvailability,fe);let Me,Fe,z,Q;if(we){const le=`${T}/${v}`,he=pf(le,R,J,q,L);Me=await Li(he,HT,o),Q=0,Fe={level:R,x:J,y:q,z:L},z={mortonIndex:0,localLevel:0,localX:0,localY:0,localZ:0}}else Me=e,Q=(P**S-1)/(P-1)+fe,Fe=t,z={mortonIndex:fe,localLevel:S,localX:se,localY:Se,localZ:me};if(!oh(Me.tileAvailability,Q))return C;oh(Me.contentAvailability,Q)&&(C.contentUrl=pf(_,R,J,q,L));for(let le=0;le<P;le++){const he=JW(a,le,l),ge=await ZT({subtree:Me,subtreeData:Fe,parentData:z,childIndex:le,implicitOptions:r,loaderOptions:o,s2VolumeBox:he});(ge.contentUrl||ge.children.length)&&C.children.push(ge)}return C.contentUrl||C.children.length?ZW(C,{level:R,x:J,y:q,z:L},r,a):C}function oh(n,e){let t;return Array.isArray(n)?(t=n[0],n.length>1&&i1.once('Not supported extension "3DTILES_multiple_contents" has been detected')):t=n,"constant"in t?!!t.constant:t.explicitBitstream?nj(e,t.explicitBitstream):!1}function ZW(n,e,t,i){const{basePath:s,refine:r,getRefine:o,lodMetricType:a,getTileType:l,rootLodMetricValue:f,rootBoundingVolume:g}=t,_=n.contentUrl&&n.contentUrl.replace(`${s}/`,""),v=f/2**e.level,T=i!=null&&i.box?{box:i.box}:g,C=ej(T,e,t.subdivisionScheme);return{children:n.children,contentUrl:n.contentUrl,content:{uri:_},id:n.contentUrl,refine:o(r),type:l(n),lodMetricType:a,lodMetricValue:v,geometricError:v,transform:n.transform,boundingVolume:C}}function ej(n,e,t){if(n.region){const{level:i,x:s,y:r,z:o}=e,[a,l,f,g,_,v]=n.region,T=2**i,C=(f-a)/T,[S,R]=[a+C*s,a+C*(s+1)],P=(g-l)/T,[F,U]=[l+P*r,l+P*(r+1)];let X,Z;if(t==="OCTREE"){const se=(v-_)/T;[X,Z]=[_+se*o,_+se*(o+1)]}else[X,Z]=[_,v];return{region:[S,F,R,U,X,Z]}}if(n.box)return n;throw new Error(`Unsupported bounding volume type ${JSON.stringify(n)}`)}function Ps(n,e,t){return(n<<t)+e}function pf(n,e,t,i,s){const r=tj({level:e,x:t,y:i,z:s});return n.replace(/{level}|{x}|{y}|{z}/gi,o=>r[o])}function tj(n){const e={};for(const t in n)e[`{${t}}`]=n[t];return e}function nj(n,e){const t=Math.floor(n/8),i=n%8;return(e[t]>>i&1)===1}function Wd(n,e=""){if(!e)return Di.EMPTY;const i=e.split("?")[0].split(".").pop();switch(i){case"pnts":return Di.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return Di.SCENEGRAPH;default:return i||Di.EMPTY}}function jd(n){switch(n){case"REPLACE":case"replace":return ui.REPLACE;case"ADD":case"add":return ui.ADD;default:return n}}function mf(n,e){if(/^[a-z][0-9a-z+.-]*:/i.test(e)){const i=new URL(n,`${e}/`);return decodeURI(i.toString())}else if(n.startsWith("/"))return n;return Fx(e,n)}function N2(n,e){var s;if(!n)return null;let t;if(n.content){const r=n.content.uri||((s=n.content)==null?void 0:s.url);typeof r<"u"&&(t=mf(r,e))}return{...n,id:t,contentUrl:t,lodMetricType:eo.GEOMETRIC_ERROR,lodMetricValue:n.geometricError,transformMatrix:n.transform,type:Wd(n,t),refine:jd(n.refine)}}async function ij(n,e,t){let i=null;const s=L2(n.root);s&&n.root?i=await F2(n.root,n,e,s,t):i=N2(n.root,e);const r=[];for(r.push(i);r.length>0;){const o=r.pop()||{},a=o.children||[],l=[];for(const f of a){const g=L2(f);let _;g?_=await F2(f,n,e,g,t):_=N2(f,e),_&&(l.push(_),r.push(_))}o.children=l}return i}async function F2(n,e,t,i,s){var X,Z,se;const{subdivisionScheme:r,maximumLevel:o,availableLevels:a,subtreeLevels:l,subtrees:{uri:f}}=i,g=pf(f,0,0,0,0),_=mf(g,t),v=await Li(_,HT,s),T=(X=n.content)==null?void 0:X.uri,C=T?mf(T,t):"",S=(Z=e==null?void 0:e.root)==null?void 0:Z.refine,R=n.geometricError,P=(se=n.boundingVolume.extensions)==null?void 0:se["3DTILES_bounding_volume_S2"];if(P){const me={box:JT(P),s2VolumeInfo:P};n.boundingVolume=me}const F=n.boundingVolume,U={contentUrlTemplate:C,subtreesUriTemplate:f,subdivisionScheme:r,subtreeLevels:l,maximumLevel:Number.isFinite(a)?a-1:o,refine:S,basePath:t,lodMetricType:eo.GEOMETRIC_ERROR,rootLodMetricValue:R,rootBoundingVolume:F,getTileType:Wd,getRefine:jd};return await sj(n,t,v,U,s)}async function sj(n,e,t,i,s){if(!n)return null;const{children:r,contentUrl:o}=await ZT({subtree:t,implicitOptions:i,loaderOptions:s});let a,l=null;return o&&(a=o,l={uri:o.replace(`${e}/`,"")}),{...n,id:a,contentUrl:a,lodMetricType:eo.GEOMETRIC_ERROR,lodMetricValue:n.geometricError,transformMatrix:n.transform,type:Wd(n,a),refine:jd(n.refine),content:l||n.content,children:r}}function L2(n){var e;return((e=n==null?void 0:n.extensions)==null?void 0:e["3DTILES_implicit_tiling"])||(n==null?void 0:n.implicitTiling)}const ew={dataType:null,batchType:null,id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:DT,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:rj,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};async function rj(n,e={},t){const i=e["3d-tiles"]||{};let s;return i.isTileset==="auto"?s=(t==null?void 0:t.url)&&t.url.indexOf(".json")!==-1:s=i.isTileset,s?oj(n,e,t):aj(n,e,t)}async function oj(n,e,t){var l;const i=JSON.parse(new TextDecoder().decode(n)),s=(t==null?void 0:t.url)||"",r=lj(s),o=await ij(i,r,e||{});return{...i,shape:"tileset3d",loader:ew,url:s,queryString:(t==null?void 0:t.queryString)||"",basePath:r,root:o||i.root,type:Rn.TILES3D,lodMetricType:eo.GEOMETRIC_ERROR,lodMetricValue:((l=i.root)==null?void 0:l.geometricError)||0}}async function aj(n,e,t){const i={content:{shape:"tile3d",featureIds:null}};return await zT(n,0,e,t,i.content),i.content}function lj(n){return Ef(n)}const k2=[0],cj={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:ew,onTilesetLoad:{type:"function",value:n=>{}},onTileLoad:{type:"function",value:n=>{}},onTileUnload:{type:"function",value:n=>{}},onTileError:{type:"function",value:(n,e,t)=>{}},_getMeshColor:{type:"function",value:n=>[255,255,255]}};class tw extends gi{initializeState(){"onTileLoadFail"in this.props&&ze.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){var e,t;return!!((t=(e=this.state)==null?void 0:e.tileset3d)!=null&&t.isLoaded()&&super.isLoaded)}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({props:e,oldProps:t,changeFlags:i}){if(e.data&&e.data!==t.data&&this._loadTileset(e.data),i.viewportChanged){const{activeViewports:s}=this.state;Object.keys(s).length&&(this._updateTileset(s),this.state.lastUpdatedViewports=s,this.state.activeViewports={})}if(i.propsChanged){const{layerMap:s}=this.state;for(const r in s)s[r].needsUpdate=!0}}activateViewport(e){const{activeViewports:t,lastUpdatedViewports:i}=this.state;this.internalState.viewport=e,t[e.id]=e;const s=i==null?void 0:i[e.id];(!s||!e.equals(s))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo({info:e,sourceLayer:t}){const i=t&&t.props.tile;return e.picked&&(e.object=i),e.sourceTile=i,e}filterSubLayer({layer:e,viewport:t}){const{tile:i}=e.props,{id:s}=t;return i.selected&&i.viewportIds.includes(s)}_updateAutoHighlight(e){const t=e.sourceTile,i=this.state.layerMap[t==null?void 0:t.id];i&&i.layer&&i.layer.updateAutoHighlight(e)}async _loadTileset(e){const{loadOptions:t={}}=this.props,i=this.props.loader||this.props.loaders,s=Array.isArray(i)?i[0]:i,r={loadOptions:{...t}};let o=e;if(s.preload){const f=await s.preload(e,t);f.url&&(o=f.url),f.headers&&(r.loadOptions.fetch={...r.loadOptions.fetch,headers:f.headers}),Object.assign(r,f)}const a=await Li(o,s,r.loadOptions),l=new HG(a,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...r});this.setState({tileset3d:l,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(l)}_onTileLoad(e){const{lastUpdatedViewports:t}=this.state;this.props.onTileLoad(e),this._updateTileset(t),this.setNeedsUpdate()}_onTileUnload(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)}_updateTileset(e){if(!e)return;const{tileset3d:t}=this.state,{timeline:i}=this.context,s=Object.keys(e).length;!i||!s||!t||t.selectTiles(Object.values(e)).then(r=>{this.state.frameNumber!==r&&this.setState({frameNumber:r})})}_getSubLayer(e,t){if(!e.content)return null;switch(e.type){case Di.POINTCLOUD:return this._makePointCloudLayer(e,t);case Di.SCENEGRAPH:return this._make3DModelLayer(e);case Di.MESH:return this._makeSimpleMeshLayer(e,t);default:throw new Error(`Tile3DLayer: Failed to render layer of type ${e.content.type}`)}}_makePointCloudLayer(e,t){const{attributes:i,pointCount:s,constantRGBA:r,cartographicOrigin:o,modelMatrix:a}=e.content,{positions:l,normals:f,colors:g}=i;if(!l)return null;const _=t&&t.props.data||{header:{vertexCount:s},attributes:{POSITION:l,NORMAL:f,COLOR_0:g}},{pointSize:v,getPointColor:T}=this.props,C=this.getSubLayerClass("pointcloud",gd);return new C({pointSize:v},this.getSubLayerProps({id:"pointcloud"}),{id:`${this.id}-pointcloud-${e.id}`,tile:e,data:_,coordinateSystem:Ue.METER_OFFSETS,coordinateOrigin:o,modelMatrix:a,getColor:r||T,_offset:0})}_make3DModelLayer(e){const{gltf:t,instances:i,cartographicOrigin:s,modelMatrix:r}=e.content,o=this.getSubLayerClass("scenegraph",Ld);return new o({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:`${this.id}-scenegraph-${e.id}`,tile:e,data:i||k2,scenegraph:t,coordinateSystem:Ue.METER_OFFSETS,coordinateOrigin:s,modelMatrix:r,getTransformMatrix:a=>a.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(e,t){const i=e.content,{attributes:s,indices:r,modelMatrix:o,cartographicOrigin:a,coordinateSystem:l=Ue.METER_OFFSETS,material:f,featureIds:g}=i,{_getMeshColor:_}=this.props,v=t&&t.props.mesh||new un({topology:"triangle-list",attributes:Aj(s),indices:r}),T=this.getSubLayerClass("mesh",kd);return new T(this.getSubLayerProps({id:"mesh"}),{id:`${this.id}-mesh-${e.id}`,tile:e,mesh:v,data:k2,getColor:_(e),pbrMaterial:f,modelMatrix:o,coordinateOrigin:a,coordinateSystem:l,featureIds:g,_offset:0})}renderLayers(){const{tileset3d:e,layerMap:t}=this.state;return e?e.tiles.map(i=>{const s=t[i.id]=t[i.id]||{tile:i};let{layer:r}=s;return i.selected&&(r?s.needsUpdate&&(r=this._getSubLayer(i,r),s.needsUpdate=!1):r=this._getSubLayer(i)),s.layer=r,r}).filter(Boolean):null}}tw.defaultProps=cj;tw.layerName="Tile3DLayer";function Aj(n){const e={};return e.positions={...n.positions,value:new Float32Array(n.positions.value)},n.normals&&(e.normals=n.normals),n.texCoords&&(e.texCoords=n.texCoords),n.colors&&(e.colors=n.colors),n.uvRegions&&(e.uvRegions=n.uvRegions),e}const uj="4.3.2",nw={dataType:null,batchType:null,name:"Terrain",id:"terrain",module:"terrain",version:uj,worker:!0,extensions:["png","pngraw","jpg","jpeg","gif","webp","bmp"],mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp"],options:{terrain:{tesselator:"auto",bounds:void 0,meshMaxError:10,elevationDecoder:{rScaler:1,gScaler:0,bScaler:0,offset:0},skirtHeight:void 0}}};({...nw});const U2=[1],hj={...ba.defaultProps,elevationData:bc,texture:{...bc,optional:!0},meshMaxError:{type:"number",value:4},bounds:{type:"array",value:null,optional:!0,compare:!0},color:{type:"color",value:[255,255,255]},elevationDecoder:{type:"object",value:{rScaler:1,gScaler:0,bScaler:0,offset:0}},workerUrl:"",wireframe:!1,material:!0,loaders:[nw]};function V2(n){return Array.isArray(n)?n.join(";"):n||""}class iw extends gi{updateState({props:e,oldProps:t}){const i=e.elevationData!==t.elevationData;if(i){const{elevationData:r}=e,o=r&&(Array.isArray(r)||r.includes("{x}")&&r.includes("{y}"));this.setState({isTiled:o})}const s=i||e.meshMaxError!==t.meshMaxError||e.elevationDecoder!==t.elevationDecoder||e.bounds!==t.bounds;if(!this.state.isTiled&&s){const r=this.loadTerrain(e);this.setState({terrain:r})}e.workerUrl&&ze.removed("workerUrl","loadOptions.terrain.workerUrl")()}loadTerrain({elevationData:e,bounds:t,elevationDecoder:i,meshMaxError:s,signal:r}){if(!e)return null;let o=this.getLoadOptions();o={...o,terrain:{skirtHeight:this.state.isTiled?s*2:0,...o==null?void 0:o.terrain,bounds:t,meshMaxError:s,elevationDecoder:i}};const{fetch:a}=this.props;return a(e,{propName:"elevationData",layer:this,loadOptions:o,signal:r})}getTiledTerrainData(e){const{elevationData:t,fetch:i,texture:s,elevationDecoder:r,meshMaxError:o}=this.props,{viewport:a}=this.context,l=vc(t,e),f=s&&vc(s,e),{signal:g}=e;let _=[0,0],v=[0,0];if(a.isGeospatial){const R=e.bbox;_=a.projectFlat([R.west,R.south]),v=a.projectFlat([R.east,R.north])}else{const R=e.bbox;_=[R.left,R.bottom],v=[R.right,R.top]}const T=[_[0],_[1],v[0],v[1]],C=this.loadTerrain({elevationData:l,bounds:T,elevationDecoder:r,meshMaxError:o,signal:g}),S=f?i(f,{propName:"texture",layer:this,loaders:[],signal:g}).catch(R=>null):Promise.resolve(null);return Promise.all([C,S])}renderSubLayers(e){const t=this.getSubLayerClass("mesh",ia),{color:i,wireframe:s,material:r}=this.props,{data:o}=e;if(!o)return null;const[a,l]=o;return new t(e,{data:U2,mesh:a,texture:l,_instanced:!1,coordinateSystem:Ue.CARTESIAN,getPosition:f=>[0,0,0],getColor:i,wireframe:s,material:r})}onViewportLoad(e){if(!e)return;const{zRange:t}=this.state,i=e.map(o=>o.content).filter(Boolean).map(o=>o[0].header.boundingBox.map(l=>l[2]));if(i.length===0)return;const s=Math.min(...i.map(o=>o[0])),r=Math.max(...i.map(o=>o[1]));(!t||s<t[0]||r>t[1])&&this.setState({zRange:[s,r]})}renderLayers(){const{color:e,material:t,elevationData:i,texture:s,wireframe:r,meshMaxError:o,elevationDecoder:a,tileSize:l,maxZoom:f,minZoom:g,extent:_,maxRequests:v,onTileLoad:T,onTileUnload:C,onTileError:S,maxCacheSize:R,maxCacheByteSize:P,refinementStrategy:F}=this.props;if(this.state.isTiled)return new ba(this.getSubLayerProps({id:"tiles"}),{getTileData:this.getTiledTerrainData.bind(this),renderSubLayers:this.renderSubLayers.bind(this),updateTriggers:{getTileData:{elevationData:V2(i),texture:V2(s),meshMaxError:o,elevationDecoder:a}},onViewportLoad:this.onViewportLoad.bind(this),zRange:this.state.zRange||null,tileSize:l,maxZoom:f,minZoom:g,extent:_,maxRequests:v,onTileLoad:T,onTileUnload:C,onTileError:S,maxCacheSize:R,maxCacheByteSize:P,refinementStrategy:F});if(!i)return null;const U=this.getSubLayerClass("mesh",ia);return new U(this.getSubLayerProps({id:"mesh"}),{data:U2,mesh:this.state.terrain,texture:s,_instanced:!1,getPosition:X=>[0,0,0],getColor:e,material:t,wireframe:r})}}iw.defaultProps=hj;iw.layerName="TerrainLayer";const fj={clipBounds:[0,0,1,1],clipByInstance:void 0},sw=`
uniform clipUniforms {
  vec4 bounds;
} clip;

bool clip_isInBounds(vec2 position) {
  return position.x >= clip.bounds[0] && position.y >= clip.bounds[1] && position.x < clip.bounds[2] && position.y < clip.bounds[3];
}
`,dj={name:"clip",vs:sw,uniformTypes:{bounds:"vec4<f32>"}},gj={"vs:#decl":`
out float clip_isVisible;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_isVisible = float(clip_isInBounds(geometry.worldPosition.xy));
`,"fs:#decl":`
in float clip_isVisible;
`,"fs:DECKGL_FILTER_COLOR":`
  if (clip_isVisible < 0.5) discard;
`},pj={name:"clip",fs:sw,uniformTypes:{bounds:"vec4<f32>"}},mj={"vs:#decl":`
out vec2 clip_commonPosition;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_commonPosition = geometry.position.xy;
`,"fs:#decl":`
in vec2 clip_commonPosition;
`,"fs:DECKGL_FILTER_COLOR":`
  if (!clip_isInBounds(clip_commonPosition)) discard;
`};class $d extends hd{getShaders(){let e="instancePositions"in this.getAttributeManager().attributes;return this.props.clipByInstance!==void 0&&(e=!!this.props.clipByInstance),this.state.clipByInstance=e,e?{modules:[dj],inject:gj}:{modules:[pj],inject:mj}}draw(){const{clipBounds:e}=this.props,t={};if(this.state.clipByInstance)t.bounds=e;else{const i=this.projectPosition([e[0],e[1],0]),s=this.projectPosition([e[2],e[3],0]);t.bounds=[Math.min(i[0],s[0]),Math.min(i[1],s[1]),Math.max(i[0],s[0]),Math.max(i[1],s[1])]}this.setShaderModuleProps({clip:t})}}$d.defaultProps=fj;$d.extensionName="ClipExtension";function z2(n,e){const t=e==null?void 0:e.globalFeatureId;return t!==void 0?_j(n,t):yj(n,e==null?void 0:e.type)}function _j(n,e){const t=rw(n);for(const i of t){let s=0,r=i.featureIds.value[0];for(let o=0;o<i.featureIds.value.length;o++){const a=i.featureIds.value[o];if(a!==r){if(e===i.globalFeatureIds.value[s])return Ic(i,s,o);s=o,r=a}}if(e===i.globalFeatureIds.value[s])return Ic(i,s,i.featureIds.value.length)}throw new Error(`featureId:${e} not found`)}function yj(n,e){const t=rw(n);return vj(t)}function bj(n,e,t){switch(n.type){case"Point":return xj(n,e,t);case"LineString":return Ej(n,e,t);case"Polygon":return ow(n,e,t);default:const i=n;throw new Error(`Unsupported geometry type: ${i==null?void 0:i.type}`)}}function rw(n,e){const t=[];return n.points&&(n.points.type="Point",t.push(n.points)),n.lines&&(n.lines.type="LineString",t.push(n.lines)),n.polygons&&(n.polygons.type="Polygon",t.push(n.polygons)),t}function vj(n){const e=[];for(const t of n){if(t.featureIds.value.length===0)continue;let i=0,s=t.featureIds.value[0];for(let r=0;r<t.featureIds.value.length;r++){const o=t.featureIds.value[r];o!==s&&(e.push(Ic(t,i,r)),i=r,s=o)}e.push(Ic(t,i,t.featureIds.value.length))}return e}function Ic(n,e,t){const i=bj(n,e,t),s=wj(n,e),r=Tj(n,e);return{type:"Feature",geometry:i,properties:s,...r}}function Tj(n,e=0,t){return n.fields&&n.fields[n.featureIds.value[e]]}function wj(n,e=0,t){const i=Object.assign({},n.properties[n.featureIds.value[e]]);for(const s in n.numericProps)i[s]=n.numericProps[s].value[e];return i}function ow(n,e=-1/0,t=1/0){const{positions:i}=n,s=n.polygonIndices.value.filter(l=>l>=e&&l<=t),r=n.primitivePolygonIndices.value.filter(l=>l>=e&&l<=t);if(!(s.length>2)){const l=[];for(let f=0;f<r.length-1;f++){const g=r[f],_=r[f+1],v=Rc(i,g,_);l.push(v)}return{type:"Polygon",coordinates:l}}const a=[];for(let l=0;l<s.length-1;l++){const f=s[l],g=s[l+1],_=ow(n,f,g).coordinates;a.push(_)}return{type:"MultiPolygon",coordinates:a}}function Ej(n,e=-1/0,t=1/0){const{positions:i}=n,s=n.pathIndices.value.filter(a=>a>=e&&a<=t);if(!(s.length>2))return{type:"LineString",coordinates:Rc(i,s[0],s[1])};const o=[];for(let a=0;a<s.length-1;a++){const l=Rc(i,s[a],s[a+1]);o.push(l)}return{type:"MultiLineString",coordinates:o}}function xj(n,e,t){const{positions:i}=n,s=Rc(i,e,t);return s.length>1?{type:"MultiPoint",coordinates:s}:{type:"Point",coordinates:s[0]}}function Rc(n,e,t){e=e||0,t=t||n.value.length/n.size;const i=[];for(let s=e;s<t;s++){const r=Array();for(let o=s*n.size;o<(s+1)*n.size;o++)r.push(Number(n.value[o]));i.push(r)}return i}const Cj="4.3.2",aw={dataType:null,batchType:null,name:"Mapbox Vector Tile",id:"mvt",module:"mvt",version:Cj,extensions:["mvt","pbf"],mimeTypes:["application/vnd.mapbox-vector-tile","application/x-protobuf"],worker:!0,category:"geometry",options:{mvt:{shape:"geojson",coordinates:"local",layerProperty:"layerName",layers:void 0,tileIndex:void 0}}};({...aw});const Sj={Point:lw,MultiPoint:Ij,LineString:cw,MultiLineString:Rj,Polygon:Aw,MultiPolygon:Pj};function lw([n,e],[t,i],s){const r=Qn(t[0],i[0],n),o=Qn(t[1],i[1],e);return s.unprojectFlat([r,o])}function Xd(n,e,t){return n.map(i=>lw(i,e,t))}function Ij(n,e,t){return Xd(n,e,t)}function cw(n,e,t){return Xd(n,e,t)}function Rj(n,e,t){return n.map(i=>cw(i,e,t))}function Aw(n,e,t){return n.map(i=>Xd(i,e,t))}function Pj(n,e,t){return n.map(i=>Aw(i,e,t))}function Mj(n,e,t){const i=t.projectFlat([e.west,e.north]),s=t.projectFlat([e.east,e.south]),r=[i,s];return{...n,coordinates:Sj[n.type](n.coordinates,r,t)}}const Bj=["points","lines","polygons"];function Oj(n,e,t,i){for(const s of Bj){const r=n[s]&&Dj(n[s],e,t,i);if(r>=0)return r}return-1}function Dj(n,e,t,i){const s=n.featureIds.value;if(!s.length)return-1;let r=0,o=s[s.length-1]+1;if(i){const l=Nj(n,i);if(l)r=l[0],o=l[1]+1;else return-1}let a=-1;if(e in n.numericProps){const l=n.numericProps[e].value.findIndex((f,g)=>f===t&&s[g]>=r&&s[g]<o);return l>=0?n.globalFeatureIds.value[l]:-1}else e?a=H2(n.properties,l=>l[e]===t,r,o):n.fields&&(a=H2(n.fields,l=>l.id===t,r,o));return a>=0?Fj(n,a):-1}function Nj(n,e){if(!n.__layers){const t={},{properties:i}=n;for(let s=0;s<i.length;s++){const{layerName:r}=i[s];r&&(t[r]?t[r][1]=s:t[r]=[s,s])}n.__layers=t}return n.__layers[e]}function Fj(n,e){if(!n.__ids){const t=[],i=n.featureIds.value,s=n.globalFeatureIds.value;for(let r=0;r<i.length;r++)t[i[r]]=s[r];n.__ids=t}return n.__ids[e]}function H2(n,e,t,i){for(let s=t;s<i;s++)if(e(n[s],s))return s;return-1}const ah=512,Lj={...ga.defaultProps,data:bc,onDataLoad:{type:"function",value:null,optional:!0,compare:!1},uniqueIdProperty:"",highlightedFeatureId:null,loaders:[aw],binary:!0};class uw extends ba{initializeState(){super.initializeState();const e=this.context.viewport.resolution!==void 0?!1:this.props.binary;this.setState({binary:e,data:null,tileJSON:null,hoveredFeatureId:null,hoveredFeatureLayerName:null})}get isLoaded(){var e;return!!((e=this.state)!=null&&e.data&&super.isLoaded)}updateState({props:e,oldProps:t,context:i,changeFlags:s}){var o;s.dataChanged&&this._updateTileData(),(o=this.state)!=null&&o.data&&(super.updateState({props:e,oldProps:t,context:i,changeFlags:s}),this._setWGS84PropertyForTiles());const{highlightColor:r}=e;r!==t.highlightColor&&Array.isArray(r)&&this.setState({highlightColor:r})}async _updateTileData(){let e=this.props.data,t=null;if(typeof e=="string"&&!S5(e)){const{onDataLoad:i,fetch:s}=this.props;this.setState({data:null,tileJSON:null});try{t=await s(e,{propName:"data",layer:this,loaders:[]})}catch(r){this.raiseError(r,"loading TileJSON"),e=null}i&&i(t,{propName:"data",layer:this})}else e&&typeof e=="object"&&"tilejson"in e&&(t=e);t&&(e=t.tiles),this.setState({data:e,tileJSON:t})}_getTilesetOptions(){const e=super._getTilesetOptions(),t=this.state.tileJSON,{minZoom:i,maxZoom:s}=this.props;return t&&(Number.isFinite(t.minzoom)&&t.minzoom>i&&(e.minZoom=t.minzoom),Number.isFinite(t.maxzoom)&&(!Number.isFinite(s)||t.maxzoom<s)&&(e.maxZoom=t.maxzoom)),e}renderLayers(){var e;return(e=this.state)!=null&&e.data?super.renderLayers():null}getTileData(e){const{data:t,binary:i}=this.state,{index:s,signal:r}=e,o=vc(t,e);if(!o)return Promise.reject("Invalid URL");let a=this.getLoadOptions();const{fetch:l}=this.props;return a={...a,mimeType:"application/x-protobuf",mvt:{...a==null?void 0:a.mvt,coordinates:this.context.viewport.resolution?"wgs84":"local",tileIndex:s},gis:i?{format:"binary"}:{}},l(o,{propName:"data",layer:this,loadOptions:a,signal:r})}renderSubLayers(e){const{x:t,y:i,z:s}=e.tile.index,r=Math.pow(2,s),o=ah/r,a=-o,l=ah*t/r,f=ah*(1-i/r),g=new Ge().scale([o,a,1]);e.autoHighlight=!1,this.context.viewport.resolution||(e.modelMatrix=g,e.coordinateOrigin=[l,f,0],e.coordinateSystem=Ue.CARTESIAN,e.extensions=[...e.extensions||[],new $d]);const _=super.renderSubLayers(e);return this.state.binary&&!(_ instanceof ga)&&ze.warn("renderSubLayers() must return GeoJsonLayer when using binary:true")(),_}_updateAutoHighlight(e){const{uniqueIdProperty:t}=this.props,{hoveredFeatureId:i,hoveredFeatureLayerName:s}=this.state,r=e.object;let o=null,a=null;r&&(o=lh(r,t),a=G2(r));let{highlightColor:l}=this.props;typeof l=="function"&&(l=l(e)),(i!==o||s!==a)&&this.setState({highlightColor:l,hoveredFeatureId:o,hoveredFeatureLayerName:a})}_isWGS84(){return!!this.context.viewport.resolution}getPickingInfo(e){const t=super.getPickingInfo(e);if(this.state.binary&&t.index!==-1){const{data:i}=e.sourceLayer.props;t.object=z2(i,{globalFeatureId:t.index})}return t.object&&!this._isWGS84()&&(t.object=j2(t.object,t.tile.bbox,this.context.viewport)),t}getSubLayerPropsByTile(e){return{highlightedObjectIndex:this.getHighlightedObjectIndex(e),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(e){const{hoveredFeatureId:t,hoveredFeatureLayerName:i,binary:s}=this.state,{uniqueIdProperty:r,highlightedFeatureId:o}=this.props,a=e.content,l=W2(o);if(!(W2(t)||l))return-1;const g=l?o:t;return Array.isArray(a)?a.findIndex(_=>{const v=lh(_,r)===g,T=l||G2(_)===i;return v&&T}):a&&s?Oj(a,r,g,l?"":i):-1}_pickObjects(e){const{deck:t,viewport:i}=this.context,s=i.width,r=i.height,o=i.x,a=i.y,l=[this.id];return t.pickObjects({x:o,y:a,width:s,height:r,layerIds:l,maxObjects:e})}getRenderedFeatures(e=null){const t=this._pickObjects(e),i=new Set,s=[];for(const r of t){const o=lh(r.object,this.props.uniqueIdProperty);o===void 0?s.push(r.object):i.has(o)||(i.add(o),s.push(r.object))}return s}_setWGS84PropertyForTiles(){const e="dataInWGS84";this.state.tileset.selectedTiles.forEach(i=>{i.hasOwnProperty(e)||Object.defineProperty(i,e,{get:()=>{if(!i.content)return null;if(this.state.binary&&Array.isArray(i.content)&&!i.content.length)return[];const{bbox:s}=i;if(i._contentWGS84===void 0&&I5(s)){const r=this.state.binary?z2(i.content):i.content;i._contentWGS84=r.map(o=>j2(o,s,this.context.viewport))}return i._contentWGS84}})})}}uw.layerName="MVTLayer";uw.defaultProps=Lj;function lh(n,e){if(n.properties&&e)return n.properties[e];if("id"in n)return n.id}function G2(n){var e;return((e=n.properties)==null?void 0:e.layerName)||null}function W2(n){return n!=null&&n!==""}function j2(n,e,t){const i={...n,geometry:{type:n.geometry.type}};return Object.defineProperty(i.geometry,"coordinates",{get:()=>Mj(n.geometry,e,t).coordinates}),i}const $2="0123456789bcdefghjkmnpqrstuvwxyz",hw={};for(let n=0;n<$2.length;n++)hw[$2.charAt(n)]=n;const kj=-90,Uj=90,Vj=-180,zj=180;function Hj(n){let e=!0,t=Uj,i=kj,s=zj,r=Vj,o,a=0;for(let l=0,f=n.length;l<f;l++){const g=n[l].toLowerCase();a=hw[g];for(let _=4;_>=0;_--){const v=a>>_&1;e?(o=(s+r)/2,v===1?r=o:s=o):(o=(t+i)/2,v===1?i=o:t=o),e=!e}}return[i,r,t,s]}function Gj(n){const[e,t,i,s]=Hj(n);return[s,i,s,e,t,e,t,i,s,i]}const Wj={getGeohash:{type:"accessor",value:n=>n.geohash}};class fw extends uo{indexToBounds(){const{data:e,getGeohash:t}=this.props;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(i,s)=>Gj(t(i,s))}}}fw.layerName="GeohashLayer";fw.defaultProps=Wj;const jj=typeof window<"u"?Gt.useLayoutEffect:Gt.useEffect;function Pc(n,e){for(;n;){if(n===e)return!0;n=Object.getPrototypeOf(n)}return!1}const $j={position:"absolute",zIndex:-1};function dw(n,e){if(typeof n=="function")return n(e);if(Array.isArray(n))return n.map(t=>dw(t,e));if(pA(n)){if(Xj(n))return e.style=$j,Gt.cloneElement(n,e);if(Qj(n))return Gt.cloneElement(n,e)}return n}function pA(n){return n&&typeof n=="object"&&"type"in n||!1}function Xj(n){var e;return(e=n.props)==null?void 0:e.mapStyle}function Qj(n){const e=n.type;return e&&e.deckGLViewProps}function _f(n){if(typeof n=="function")return Gt.createElement(Si,{},n);if(Array.isArray(n))return n.map(_f);if(pA(n)){if(n.type===Gt.Fragment)return _f(n.props.children);if(Pc(n.type,Si))return n}return n}function Yj({children:n,layers:e=[],views:t=null}){const i=[],s=[],r={};return Gt.Children.forEach(_f(n),o=>{if(pA(o)){const a=o.type;if(Pc(a,rn)){const l=Kj(a,o.props);s.push(l)}else i.push(o);if(Pc(a,Si)&&a!==Si&&o.props.id){const l=new a(o.props);r[l.id]=l}}else o&&i.push(o)}),Object.keys(r).length>0&&(Array.isArray(t)?t.forEach(o=>{r[o.id]=o}):t&&(r[t.id]=t),t=Object.values(r)),e=s.length>0?[...s,...e]:e,{layers:e,children:i,views:t}}function Kj(n,e){const t={},i=n.defaultProps||{};for(const s in e)i[s]!==e[s]&&(t[s]=e[s]);return new n(t)}const qj=Gt.createContext();function Jj({children:n,deck:e,ContextProvider:t=qj.Provider}){const{viewManager:i}=e||{};if(!i||!i.views.length)return[];const s={},r=i.views[0].id;for(const o of n){let a=r,l=o;pA(o)&&Pc(o.type,Si)&&(a=o.props.id||r,l=o.props.children);const f=i.getViewport(a),g=i.getViewState(a);if(f){g.padding=f.padding;const{x:_,y:v,width:T,height:C}=f;l=dw(l,{x:_,y:v,width:T,height:C,viewport:f,viewState:g}),s[a]||(s[a]={viewport:f,children:[]}),s[a].children.push(l)}}return Object.keys(s).map(o=>{const{viewport:a,children:l}=s[o],{x:f,y:g,width:_,height:v}=a,T={position:"absolute",left:f,top:g,width:_,height:v},C=`view-${o}`,S=Gt.createElement("div",{key:C,id:C,style:T},...l),R={deck:e,viewport:a,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:F=>{F.viewId=o,e._onViewStateChange(F)},widgets:[]},P=`view-${o}-context`;return Gt.createElement(t,{key:P,value:R},S)})}const Zj={mixBlendMode:null};function e$({width:n,height:e,style:t}){const i={position:"absolute",zIndex:0,left:0,top:0,width:n,height:e},s={left:0,top:0};if(t)for(const r in t)r in Zj?s[r]=t[r]:i[r]=t[r];return{containerStyle:i,canvasStyle:s}}function t$(n){return{get deck(){return n.deck},pickObject:e=>n.deck.pickObject(e),pickMultipleObjects:e=>n.deck.pickMultipleObjects(e),pickObjects:e=>n.deck.pickObjects(e)}}function gw(n){n.redrawReason&&(n.deck._drawLayers(n.redrawReason),n.redrawReason=null)}function n$(n,e,t){const i=new e({...t,_customRender:s=>{n.redrawReason=s;const r=i.getViewports();n.lastRenderedViewports!==r?n.forceUpdate():gw(n)}});return i}function i$(n,e){const[t,i]=Gt.useState(0),r=Gt.useRef({control:null,version:t,forceUpdate:()=>i(Z=>Z+1)}).current,o=Gt.useRef(null),a=Gt.useRef(null),l=Gt.useMemo(()=>Yj(n),[n.layers,n.views,n.children]);let f=!0;const g=Z=>{var se;return f&&n.viewState?(r.viewStateUpdateRequested=Z,null):(r.viewStateUpdateRequested=null,(se=n.onViewStateChange)==null?void 0:se.call(n,Z))},_=Z=>{var se;f?r.interactionStateUpdateRequested=Z:(r.interactionStateUpdateRequested=null,(se=n.onInteractionStateChange)==null||se.call(n,Z))},v=Gt.useMemo(()=>{const Z={widgets:[],...n,style:null,width:"100%",height:"100%",parent:o.current,canvas:a.current,layers:l.layers,views:l.views,onViewStateChange:g,onInteractionStateChange:_};return delete Z._customRender,r.deck&&r.deck.setProps(Z),Z},[n]);Gt.useEffect(()=>{const Z=n.Deck||ad;return r.deck=n$(r,Z,{...v,parent:o.current,canvas:a.current}),()=>{var se;return(se=r.deck)==null?void 0:se.finalize()}},[]),jj(()=>{gw(r);const{viewStateUpdateRequested:Z,interactionStateUpdateRequested:se}=r;Z&&g(Z),se&&_(se)}),Gt.useImperativeHandle(e,()=>t$(r),[]);const T=r.deck&&r.deck.isInitialized?r.deck.getViewports():void 0,{ContextProvider:C,width:S="100%",height:R="100%",id:P,style:F}=n,{containerStyle:U,canvasStyle:X}=Gt.useMemo(()=>e$({width:S,height:R,style:F}),[S,R,F]);if(!r.viewStateUpdateRequested&&r.lastRenderedViewports===T||r.version!==t){r.lastRenderedViewports=T,r.version=t;const Z=Jj({children:l.children,deck:r.deck,ContextProvider:C}),se=Gt.createElement("canvas",{key:"canvas",id:P||"deckgl-overlay",ref:a,style:X});r.control=Gt.createElement("div",{id:`${P||"deckgl"}-wrapper`,ref:o,style:U},[se,Z])}return f=!1,r.control}const sX=Gt.forwardRef(i$);var mA,Dt,pw,Bs,X2,mw,_w,yw,Qd,yf,bf,oa={},bw=[],s$=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Yd=Array.isArray;function as(n,e){for(var t in e)n[t]=e[t];return n}function Kd(n){n&&n.parentNode&&n.parentNode.removeChild(n)}function r$(n,e,t){var i,s,r,o={};for(r in e)r=="key"?i=e[r]:r=="ref"?s=e[r]:o[r]=e[r];if(arguments.length>2&&(o.children=arguments.length>3?mA.call(arguments,2):t),typeof n=="function"&&n.defaultProps!=null)for(r in n.defaultProps)o[r]===void 0&&(o[r]=n.defaultProps[r]);return Ll(n,o,i,s,null)}function Ll(n,e,t,i,s){var r={type:n,props:e,key:t,ref:i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:s??++pw,__i:-1,__u:0};return s==null&&Dt.vnode!=null&&Dt.vnode(r),r}function _A(n){return n.children}function kl(n,e){this.props=n,this.context=e}function no(n,e){if(e==null)return n.__?no(n.__,n.__i+1):null;for(var t;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null)return t.__e;return typeof n.type=="function"?no(n):null}function vw(n){var e,t;if((n=n.__)!=null&&n.__c!=null){for(n.__e=n.__c.base=null,e=0;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null){n.__e=n.__c.base=t.__e;break}return vw(n)}}function Q2(n){(!n.__d&&(n.__d=!0)&&Bs.push(n)&&!Mc.__r++||X2!==Dt.debounceRendering)&&((X2=Dt.debounceRendering)||mw)(Mc)}function Mc(){for(var n,e,t,i,s,r,o,a=1;Bs.length;)Bs.length>a&&Bs.sort(_w),n=Bs.shift(),a=Bs.length,n.__d&&(t=void 0,s=(i=(e=n).__v).__e,r=[],o=[],e.__P&&((t=as({},i)).__v=i.__v+1,Dt.vnode&&Dt.vnode(t),qd(e.__P,t,i,e.__n,e.__P.namespaceURI,32&i.__u?[s]:null,r,s??no(i),!!(32&i.__u),o),t.__v=i.__v,t.__.__k[t.__i]=t,Ew(r,t,o),t.__e!=s&&vw(t)));Mc.__r=0}function Tw(n,e,t,i,s,r,o,a,l,f,g){var _,v,T,C,S,R,P=i&&i.__k||bw,F=e.length;for(l=o$(t,e,P,l,F),_=0;_<F;_++)(T=t.__k[_])!=null&&(v=T.__i===-1?oa:P[T.__i]||oa,T.__i=_,R=qd(n,T,v,s,r,o,a,l,f,g),C=T.__e,T.ref&&v.ref!=T.ref&&(v.ref&&Jd(v.ref,null,T),g.push(T.ref,T.__c||C,T)),S==null&&C!=null&&(S=C),4&T.__u||v.__k===T.__k?l=ww(T,l,n):typeof T.type=="function"&&R!==void 0?l=R:C&&(l=C.nextSibling),T.__u&=-7);return t.__e=S,l}function o$(n,e,t,i,s){var r,o,a,l,f,g=t.length,_=g,v=0;for(n.__k=new Array(s),r=0;r<s;r++)(o=e[r])!=null&&typeof o!="boolean"&&typeof o!="function"?(l=r+v,(o=n.__k[r]=typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?Ll(null,o,null,null,null):Yd(o)?Ll(_A,{children:o},null,null,null):o.constructor===void 0&&o.__b>0?Ll(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):o).__=n,o.__b=n.__b+1,a=null,(f=o.__i=a$(o,t,l,_))!==-1&&(_--,(a=t[f])&&(a.__u|=2)),a==null||a.__v===null?(f==-1&&(s>g?v--:s<g&&v++),typeof o.type!="function"&&(o.__u|=4)):f!=l&&(f==l-1?v--:f==l+1?v++:(f>l?v--:v++,o.__u|=4))):n.__k[r]=null;if(_)for(r=0;r<g;r++)(a=t[r])!=null&&(2&a.__u)==0&&(a.__e==i&&(i=no(a)),xw(a,a));return i}function ww(n,e,t){var i,s;if(typeof n.type=="function"){for(i=n.__k,s=0;i&&s<i.length;s++)i[s]&&(i[s].__=n,e=ww(i[s],e,t));return e}n.__e!=e&&(e&&n.type&&!t.contains(e)&&(e=no(n)),t.insertBefore(n.__e,e||null),e=n.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function a$(n,e,t,i){var s,r,o=n.key,a=n.type,l=e[t];if(l===null&&n.key==null||l&&o==l.key&&a===l.type&&(2&l.__u)==0)return t;if(i>(l!=null&&(2&l.__u)==0?1:0))for(s=t-1,r=t+1;s>=0||r<e.length;){if(s>=0){if((l=e[s])&&(2&l.__u)==0&&o==l.key&&a===l.type)return s;s--}if(r<e.length){if((l=e[r])&&(2&l.__u)==0&&o==l.key&&a===l.type)return r;r++}}return-1}function Y2(n,e,t){e[0]=="-"?n.setProperty(e,t??""):n[e]=t==null?"":typeof t!="number"||s$.test(e)?t:t+"px"}function _l(n,e,t,i,s){var r;e:if(e=="style")if(typeof t=="string")n.style.cssText=t;else{if(typeof i=="string"&&(n.style.cssText=i=""),i)for(e in i)t&&e in t||Y2(n.style,e,"");if(t)for(e in t)i&&t[e]===i[e]||Y2(n.style,e,t[e])}else if(e[0]=="o"&&e[1]=="n")r=e!=(e=e.replace(yw,"$1")),e=e.toLowerCase()in n||e=="onFocusOut"||e=="onFocusIn"?e.toLowerCase().slice(2):e.slice(2),n.l||(n.l={}),n.l[e+r]=t,t?i?t.u=i.u:(t.u=Qd,n.addEventListener(e,r?bf:yf,r)):n.removeEventListener(e,r?bf:yf,r);else{if(s=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in n)try{n[e]=t??"";break e}catch{}typeof t=="function"||(t==null||t===!1&&e[4]!="-"?n.removeAttribute(e):n.setAttribute(e,e=="popover"&&t==1?"":t))}}function K2(n){return function(e){if(this.l){var t=this.l[e.type+n];if(e.t==null)e.t=Qd++;else if(e.t<t.u)return;return t(Dt.event?Dt.event(e):e)}}}function qd(n,e,t,i,s,r,o,a,l,f){var g,_,v,T,C,S,R,P,F,U,X,Z,se,Se,me,J,q,L,fe=e.type;if(e.constructor!==void 0)return null;128&t.__u&&(l=!!(32&t.__u),r=[a=e.__e=t.__e]),(g=Dt.__b)&&g(e);e:if(typeof fe=="function")try{if(P=e.props,F="prototype"in fe&&fe.prototype.render,U=(g=fe.contextType)&&i[g.__c],X=g?U?U.props.value:g.__:i,t.__c?R=(_=e.__c=t.__c).__=_.__E:(F?e.__c=_=new fe(P,X):(e.__c=_=new kl(P,X),_.constructor=fe,_.render=c$),U&&U.sub(_),_.props=P,_.state||(_.state={}),_.context=X,_.__n=i,v=_.__d=!0,_.__h=[],_._sb=[]),F&&_.__s==null&&(_.__s=_.state),F&&fe.getDerivedStateFromProps!=null&&(_.__s==_.state&&(_.__s=as({},_.__s)),as(_.__s,fe.getDerivedStateFromProps(P,_.__s))),T=_.props,C=_.state,_.__v=e,v)F&&fe.getDerivedStateFromProps==null&&_.componentWillMount!=null&&_.componentWillMount(),F&&_.componentDidMount!=null&&_.__h.push(_.componentDidMount);else{if(F&&fe.getDerivedStateFromProps==null&&P!==T&&_.componentWillReceiveProps!=null&&_.componentWillReceiveProps(P,X),!_.__e&&(_.shouldComponentUpdate!=null&&_.shouldComponentUpdate(P,_.__s,X)===!1||e.__v==t.__v)){for(e.__v!=t.__v&&(_.props=P,_.state=_.__s,_.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.some(function(we){we&&(we.__=e)}),Z=0;Z<_._sb.length;Z++)_.__h.push(_._sb[Z]);_._sb=[],_.__h.length&&o.push(_);break e}_.componentWillUpdate!=null&&_.componentWillUpdate(P,_.__s,X),F&&_.componentDidUpdate!=null&&_.__h.push(function(){_.componentDidUpdate(T,C,S)})}if(_.context=X,_.props=P,_.__P=n,_.__e=!1,se=Dt.__r,Se=0,F){for(_.state=_.__s,_.__d=!1,se&&se(e),g=_.render(_.props,_.state,_.context),me=0;me<_._sb.length;me++)_.__h.push(_._sb[me]);_._sb=[]}else do _.__d=!1,se&&se(e),g=_.render(_.props,_.state,_.context),_.state=_.__s;while(_.__d&&++Se<25);_.state=_.__s,_.getChildContext!=null&&(i=as(as({},i),_.getChildContext())),F&&!v&&_.getSnapshotBeforeUpdate!=null&&(S=_.getSnapshotBeforeUpdate(T,C)),q=(J=g!=null&&g.type===_A&&g.key==null)?g.props.children:g,J&&(g.props.children=null),a=Tw(n,Yd(q)?q:[q],e,t,i,s,r,o,a,l,f),_.base=e.__e,e.__u&=-161,_.__h.length&&o.push(_),R&&(_.__E=_.__=null)}catch(we){if(e.__v=null,l||r!=null)if(we.then){for(e.__u|=l?160:128;a&&a.nodeType==8&&a.nextSibling;)a=a.nextSibling;r[r.indexOf(a)]=null,e.__e=a}else for(L=r.length;L--;)Kd(r[L]);else e.__e=t.__e,e.__k=t.__k;Dt.__e(we,e,t)}else r==null&&e.__v==t.__v?(e.__k=t.__k,e.__e=t.__e):a=e.__e=l$(t.__e,e,t,i,s,r,o,l,f);return(g=Dt.diffed)&&g(e),128&e.__u?void 0:a}function Ew(n,e,t){for(var i=0;i<t.length;i++)Jd(t[i],t[++i],t[++i]);Dt.__c&&Dt.__c(e,n),n.some(function(s){try{n=s.__h,s.__h=[],n.some(function(r){r.call(s)})}catch(r){Dt.__e(r,s.__v)}})}function l$(n,e,t,i,s,r,o,a,l){var f,g,_,v,T,C,S,R=t.props,P=e.props,F=e.type;if(F=="svg"?s="http://www.w3.org/2000/svg":F=="math"?s="http://www.w3.org/1998/Math/MathML":s||(s="http://www.w3.org/1999/xhtml"),r!=null){for(f=0;f<r.length;f++)if((T=r[f])&&"setAttribute"in T==!!F&&(F?T.localName==F:T.nodeType==3)){n=T,r[f]=null;break}}if(n==null){if(F==null)return document.createTextNode(P);n=document.createElementNS(s,F,P.is&&P),a&&(Dt.__m&&Dt.__m(e,r),a=!1),r=null}if(F===null)R===P||a&&n.data===P||(n.data=P);else{if(r=r&&mA.call(n.childNodes),R=t.props||oa,!a&&r!=null)for(R={},f=0;f<n.attributes.length;f++)R[(T=n.attributes[f]).name]=T.value;for(f in R)if(T=R[f],f!="children"){if(f=="dangerouslySetInnerHTML")_=T;else if(!(f in P)){if(f=="value"&&"defaultValue"in P||f=="checked"&&"defaultChecked"in P)continue;_l(n,f,null,T,s)}}for(f in P)T=P[f],f=="children"?v=T:f=="dangerouslySetInnerHTML"?g=T:f=="value"?C=T:f=="checked"?S=T:a&&typeof T!="function"||R[f]===T||_l(n,f,T,R[f],s);if(g)a||_&&(g.__html===_.__html||g.__html===n.innerHTML)||(n.innerHTML=g.__html),e.__k=[];else if(_&&(n.innerHTML=""),Tw(e.type==="template"?n.content:n,Yd(v)?v:[v],e,t,i,F=="foreignObject"?"http://www.w3.org/1999/xhtml":s,r,o,r?r[0]:t.__k&&no(t,0),a,l),r!=null)for(f=r.length;f--;)Kd(r[f]);a||(f="value",F=="progress"&&C==null?n.removeAttribute("value"):C!==void 0&&(C!==n[f]||F=="progress"&&!C||F=="option"&&C!==R[f])&&_l(n,f,C,R[f],s),f="checked",S!==void 0&&S!==n[f]&&_l(n,f,S,R[f],s))}return n}function Jd(n,e,t){try{if(typeof n=="function"){var i=typeof n.__u=="function";i&&n.__u(),i&&e==null||(n.__u=n(e))}else n.current=e}catch(s){Dt.__e(s,t)}}function xw(n,e,t){var i,s;if(Dt.unmount&&Dt.unmount(n),(i=n.ref)&&(i.current&&i.current!==n.__e||Jd(i,null,e)),(i=n.__c)!=null){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(r){Dt.__e(r,e)}i.base=i.__P=null}if(i=n.__k)for(s=0;s<i.length;s++)i[s]&&xw(i[s],e,t||typeof n.type!="function");t||Kd(n.__e),n.__c=n.__=n.__e=void 0}function c$(n,e,t){return this.constructor(n,t)}function Zd(n,e,t){var i,s,r,o;e==document&&(e=document.documentElement),Dt.__&&Dt.__(n,e),s=(i=!1)?null:e.__k,r=[],o=[],qd(e,n=e.__k=r$(_A,null,[n]),s||oa,oa,e.namespaceURI,s?null:e.firstChild?mA.call(e.childNodes):null,r,s?s.__e:e.firstChild,i,o),Ew(r,n,o)}mA=bw.slice,Dt={__e:function(n,e,t,i){for(var s,r,o;e=e.__;)if((s=e.__c)&&!s.__)try{if((r=s.constructor)&&r.getDerivedStateFromError!=null&&(s.setState(r.getDerivedStateFromError(n)),o=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(n,i||{}),o=s.__d),o)return s.__E=s}catch(a){n=a}throw n}},pw=0,kl.prototype.setState=function(n,e){var t;t=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=as({},this.state),typeof n=="function"&&(n=n(as({},t),this.props)),n&&as(t,n),n!=null&&this.__v&&(e&&this._sb.push(e),Q2(this))},kl.prototype.forceUpdate=function(n){this.__v&&(this.__e=!0,n&&this.__h.push(n),Q2(this))},kl.prototype.render=_A,Bs=[],mw=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,_w=function(n,e){return n.__v.__b-e.__v.__b},Mc.__r=0,yw=/(PointerCapture)$|Capture$/i,Qd=0,yf=K2(!1),bf=K2(!0);var A$=0;function Tn(n,e,t,i,s,r){e||(e={});var o,a,l=e;if("ref"in l)for(a in l={},e)a=="ref"?o=e[a]:l[a]=e[a];var f={type:n,props:l,key:t,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--A$,__i:-1,__u:0,__source:s,__self:r};if(typeof n=="function"&&(o=n.defaultProps))for(a in o)l[a]===void 0&&(l[a]=o[a]);return Dt.vnode&&Dt.vnode(f),f}const u$=n=>{const{className:e,label:t,onClick:i}=n;return Tn("div",{className:"deck-widget-button",children:Tn("button",{className:`deck-widget-icon-button ${e}`,type:"button",onClick:i,title:t,children:Tn("div",{className:"deck-widget-icon"})})})},h$=n=>{const{children:e,orientation:t}=n;return Tn("div",{className:`deck-widget-button-group ${t}`,children:e})},q2=n=>{const{className:e,label:t,onClick:i}=n;return Tn("button",{className:`deck-widget-icon-button ${e}`,type:"button",onClick:i,title:t,children:Tn("div",{className:"deck-widget-icon"})})};class rX{constructor(e){this.id="fullscreen",this.placement="top-left",this.fullscreen=!1,this.id=e.id??this.id,this.placement=e.placement??this.placement,this.props={...e,enterLabel:e.enterLabel??"Enter Fullscreen",exitLabel:e.exitLabel??"Exit Fullscreen",style:e.style??{}}}onAdd({deck:e}){const{style:t,className:i}=this.props,s=document.createElement("div");return s.classList.add("deck-widget","deck-widget-fullscreen"),i&&s.classList.add(i),qr(s,t),this.deck=e,this.element=s,this.update(),document.addEventListener("fullscreenchange",this.onFullscreenChange.bind(this)),s}onRemove(){this.deck=void 0,this.element=void 0,document.removeEventListener("fullscreenchange",this.onFullscreenChange.bind(this))}update(){const{enterLabel:e,exitLabel:t}=this.props,i=this.element;if(!i)return;const s=Tn(u$,{onClick:this.handleClick.bind(this),label:this.fullscreen?t:e,className:this.fullscreen?"deck-widget-fullscreen-exit":"deck-widget-fullscreen-enter"});Zd(s,i)}setProps(e){this.placement=e.placement??this.placement;const t=this.props,i=this.element;i&&(t.className!==e.className&&(t.className&&i.classList.remove(t.className),e.className&&i.classList.add(e.className)),Kt(t.style,e.style,1)||(fd(i,t.style),qr(i,e.style))),Object.assign(this.props,e),this.update()}getContainer(){var e,t;return this.props.container||((t=(e=this.deck)==null?void 0:e.getCanvas())==null?void 0:t.parentElement)}onFullscreenChange(){const e=this.fullscreen,t=document.fullscreenElement===this.getContainer();e!==t&&(this.fullscreen=!this.fullscreen),this.update()}async handleClick(){this.fullscreen?await this.exitFullscreen():await this.requestFullscreen(),this.update()}async requestFullscreen(){const e=this.getContainer();e!=null&&e.requestFullscreen?await e.requestFullscreen({navigationUI:"hide"}):this.togglePseudoFullscreen()}async exitFullscreen(){document.exitFullscreen?await document.exitFullscreen():this.togglePseudoFullscreen()}togglePseudoFullscreen(){var e;(e=this.getContainer())==null||e.classList.toggle("deck-pseudo-fullscreen")}}class oX{constructor(e){this.id="compass",this.placement="top-left",this.viewId=null,this.viewports={},this.id=e.id??this.id,this.viewId=e.viewId??this.viewId,this.placement=e.placement??this.placement,this.props={...e,transitionDuration:e.transitionDuration??200,label:e.label??"Reset Compass",style:e.style??{}}}setProps(e){this.placement=e.placement??this.placement,this.viewId=e.viewId??this.viewId;const t=this.props,i=this.element;i&&(t.className!==e.className&&(t.className&&i.classList.remove(t.className),e.className&&i.classList.add(e.className)),Kt(t.style,e.style,1)||(fd(i,t.style),qr(i,e.style))),Object.assign(this.props,e),this.update()}onViewportChange(e){e.equals(this.viewports[e.id])||(this.viewports[e.id]=e,this.update())}onAdd({deck:e}){const{style:t,className:i}=this.props,s=document.createElement("div");return s.classList.add("deck-widget","deck-widget-compass"),i&&s.classList.add(i),qr(s,t),this.deck=e,this.element=s,this.update(),s}getRotation(e){return e instanceof fi?[-e.bearing,e.pitch]:e instanceof Ad?[0,Math.max(-80,Math.min(80,e.latitude))]:[0,0]}update(){var a;const e=this.viewId||((a=Object.values(this.viewports)[0])==null?void 0:a.id)||"default-view",t=this.viewports[e],[i,s]=this.getRotation(t),r=this.element;if(!r)return;const o=Tn("div",{className:"deck-widget-button",style:{perspective:100},children:Tn("button",{type:"button",onClick:()=>{for(const l of Object.values(this.viewports))this.handleCompassReset(l)},title:this.props.label,style:{transform:`rotateX(${s}deg)`},children:Tn("svg",{fill:"none",width:"100%",height:"100%",viewBox:"0 0 26 26",children:Tn("g",{transform:`rotate(${i},13,13)`,children:[Tn("path",{d:"M10 13.0001L12.9999 5L15.9997 13.0001H10Z",fill:"var(--icon-compass-north-color, #F05C44)"}),Tn("path",{d:"M16.0002 12.9999L13.0004 21L10.0005 12.9999H16.0002Z",fill:"var(--icon-compass-south-color, #C2C2CC)"})]})})})});Zd(o,r)}onRemove(){this.deck=void 0,this.element=void 0}handleCompassReset(e){const t=this.viewId||e.id||"default-view";if(e instanceof fi){const i={...e,bearing:0,...this.getRotation(e)[0]===0?{pitch:0}:{},transitionDuration:this.props.transitionDuration,transitionInterpolator:new ev};this.deck._onViewStateChange({viewId:t,viewState:i,interactionState:{}})}}}class e0{constructor(e={}){this.id="zoom",this.placement="top-left",this.viewId=null,this.viewports={},this.id=e.id??this.id,this.viewId=e.viewId??this.viewId,this.placement=e.placement??this.placement,this.props={...e0.defaultProps,...e}}onAdd({deck:e}){const{style:t,className:i}=this.props,s=document.createElement("div");return s.classList.add("deck-widget","deck-widget-zoom"),i&&s.classList.add(i),qr(s,t),this.deck=e,this.element=s,this.update(),s}onRemove(){this.deck=void 0,this.element=void 0}setProps(e){this.placement=e.placement??this.placement,this.viewId=e.viewId??this.viewId;const t=this.props,i=this.element;i&&(t.className!==e.className&&(t.className&&i.classList.remove(t.className),e.className&&i.classList.add(e.className)),Kt(t.style,e.style,1)||(fd(i,t.style),qr(i,e.style))),Object.assign(this.props,e),this.update()}onViewportChange(e){this.viewports[e.id]=e}handleZoom(e,t){const i=this.viewId||(e==null?void 0:e.id)||"default-view",s={...e,zoom:t};this.props.transitionDuration>0&&(s.transitionDuration=this.props.transitionDuration,s.transitionInterpolator="latitude"in s?new ev:new qs),this.setViewState(i,s)}handleZoomIn(){for(const e of Object.values(this.viewports))this.handleZoom(e,e.zoom+1)}handleZoomOut(){for(const e of Object.values(this.viewports))this.handleZoom(e,e.zoom-1)}setViewState(e,t){this.deck._onViewStateChange({viewId:e,viewState:t,interactionState:{}})}update(){const e=this.element;if(!e)return;const t=Tn(h$,{orientation:this.props.orientation,children:[Tn(q2,{onClick:()=>this.handleZoomIn(),label:this.props.zoomInLabel,className:"deck-widget-zoom-in"}),Tn(q2,{onClick:()=>this.handleZoomOut(),label:this.props.zoomOutLabel,className:"deck-widget-zoom-out"})]});Zd(t,e)}}e0.defaultProps={id:"zoom-widget",style:{},placement:"top-left",className:void 0,orientation:"vertical",transitionDuration:200,zoomInLabel:"Zoom In",zoomOutLabel:"Zoom Out",viewId:void 0};export{fO as AmbientLight,dd as ArcLayer,Wb as Attribute,tA as AttributeManager,nv as BitmapLayer,Ue as COORDINATE_SYSTEM,pa as CPUAggregator,lo as ColumnLayer,oX as CompassWidget,gi as CompositeLayer,Bv as ContourLayer,fa as Controller,ad as Deck,sX as DeckGL,Y4 as DeckRenderer,fp as DirectionalLight,MF as FirstPersonController,BF as FirstPersonView,PF as FirstPersonViewport,ev as FlyToInterpolator,rX as FullscreenWidget,ga as GeoJsonLayer,fw as GeohashLayer,kv as GreatCircleLayer,hv as GridCellLayer,Dv as GridLayer,iT as H3ClusterLayer,ho as H3HexagonLayer,Lv as HeatmapLayer,Mv as HexagonLayer,iA as IconLayer,rn as Layer,hd as LayerExtension,O4 as LayerManager,ub as LightingEffect,sv as LineLayer,qs as LinearInterpolator,uw as MVTLayer,G4 as MapController,Eb as MapView,J$ as OPERATION,OF as OrbitController,DF as OrbitView,CF as OrbitViewport,FF as OrthographicController,LF as OrthographicView,RF as OrthographicViewport,co as PathLayer,gd as PointCloudLayer,Z$ as PointLight,Ao as PolygonLayer,eX as PostProcessEffect,Vv as QuadkeyLayer,Uv as S2Layer,pd as ScatterplotLayer,Ld as ScenegraphLayer,Iv as ScreenGridLayer,ia as SimpleMeshLayer,da as SolidPolygonLayer,jh as TRANSITION_EVENTS,iw as TerrainLayer,tv as Tesselator,vd as TextLayer,tw as Tile3DLayer,ba as TileLayer,Tb as TransitionInterpolator,$v as TripsLayer,kn as UNIT,CS as VERSION,Si as View,Kn as Viewport,li as WebGLAggregator,fi as WebMercatorViewport,e0 as ZoomWidget,UF as _GlobeController,VF as _GlobeView,Ad as _GlobeViewport,F5 as _Tileset2D,An as assert,Ri as createIterable,sX as default,xO as fp64LowPart,cO as getShaderAssembler,Y$ as gouraudLighting,ze as log,K$ as phongLighting,Un as picking,Jf as project,sn as project32,hp as shadow};
