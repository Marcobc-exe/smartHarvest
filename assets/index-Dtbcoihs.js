var l2=Object.defineProperty;var u2=(s,e,t)=>e in s?l2(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var G=(s,e,t)=>u2(s,typeof e!="symbol"?e+"":e,t);import{L as f2,i as xi,a as h2,V as d2,b as ga,c as nt,S as Ef,d as g2,e as Tf,f as vf,g as As,h as gt,t as p2,v as m2,j as If,k as B2,l as C2,m as _2,n as Mf,o as y2,p as b2,A as FA,M as E2,q as T2,r as wf,s as v2,u as I2,w as M2,x as w2,y as S2,z as Sf,B as x2,C as ul,D as xf,E as Yr,F as Df,G as D2,H as P2,I as F2,J as L2,K as R2,N as O2,O as Cn,P as Mt,Q as Xi,R as Pf,T as Ft,U as k,W as G2,X as N2,Y as Ff,Z as U2,_ as H2,$ as jo,a0 as Qo,a1 as Qs,a2 as k2,a3 as J2,a4 as V2,a5 as fl,a6 as z2,a7 as pt,a8 as Ct,a9 as j2,aa as Ht,ab as pa,ac as Fe,ad as bi,ae as Q2,af as K2,ag as as,ah as Lf,ai as Rf,aj as W2,ak as X2,al as $r,am as Y2,an as $2,ao as Z2,ap as Of,aq as q2,ar as e1,as as sr,at as Di,au as Gf,av as LA,aw as ir,ax as t1,ay as Ei,az as wn,aA as n1,aB as Hn,aC as sn,aD as St,aE as fn,aF as _n,aG as ti,aH as cs,aI as at,aJ as Nf,aK as s1,aL as i1,aM as xn,aN as Uf,aO as ma,aP as A1,aQ as r1,aR as Ba,aS as o1,aT as Ar,aU as a1,aV as c1,aW as vn,aX as l1,aY as u1,aZ as Hf,a_ as kf,a$ as Pi,b0 as Jf,b1 as f1,b2 as h1,b3 as Vf,b4 as d1}from"./index-DMmEOZhk.js";import{bi as SL,ba as xL,b7 as DL,bn as PL,be as FL,bj as LL,bd as RL,bh as OL,b9 as NL,b8 as UL,b6 as HL,bg as kL,bk as JL,b5 as VL,bf as zL,bn as jL,bl as QL,bm as KL,bb as WL,bc as XL}from"./index-DMmEOZhk.js";async function ls(s,e,t,n){return n._parse(s,e,t,n)}globalThis.probe={};const zf=new f2({id:"@probe.gl/log"});function jf(s){var e;globalThis.loaders||(globalThis.loaders={}),(e=globalThis.loaders).modules||(e.modules={}),Object.assign(globalThis.loaders.modules,s)}function Qf(s){var t,n;return((n=(t=globalThis.loaders)==null?void 0:t.modules)==null?void 0:n[s])||null}const Zr={};async function kt(s,e=null,t={},n=null){return e&&(s=g1(s,e,t,n)),Zr[s]=Zr[s]||p1(s),await Zr[s]}function g1(s,e,t={},n=null){if(!t.useLocalLibraries&&s.startsWith("http"))return s;n=n||s;const i=t.modules||{};return i[n]?i[n]:xi?t.CDN?(h2(t.CDN.startsWith("http")),`${t.CDN}/${e}@${d2}/dist/libs/${n}`):ga?`../src/libs/${n}`:`modules/${e}/src/libs/${n}`:`modules/${e}/dist/libs/${n}`}async function p1(s){if(s.endsWith("wasm"))return await B1(s);if(!xi)try{const{requireFromFile:t}=globalThis.loaders||{};return await(t==null?void 0:t(s))}catch(t){return console.error(t),null}if(ga)return importScripts(s);const e=await C1(s);return m1(e,s)}function m1(s,e){if(!xi){const{requireFromString:n}=globalThis.loaders||{};return n==null?void 0:n(s,e)}if(ga)return eval.call(globalThis,s),null;const t=document.createElement("script");t.id=e;try{t.appendChild(document.createTextNode(s))}catch{t.text=s}return document.body.appendChild(t),null}async function B1(s){const{readFileAsArrayBuffer:e}=globalThis.loaders||{};return xi||!e||s.startsWith("http")?await(await fetch(s)).arrayBuffer():await e(s)}async function C1(s){const{readFileAsText:e}=globalThis.loaders||{};return xi||!e||s.startsWith("http")?await(await fetch(s)).text():await e(s)}function _1(s,e=5){return typeof s=="string"?s.slice(0,e):ArrayBuffer.isView(s)?hl(s.buffer,s.byteOffset,e):s instanceof ArrayBuffer?hl(s,0,e):""}function hl(s,e,t){if(s.byteLength<=e+t)return"";const n=new DataView(s);let i="";for(let A=0;A<t;A++)i+=String.fromCharCode(n.getUint8(e+A));return i}function Kf(s){try{return JSON.parse(s)}catch{throw new Error(`Failed to parse JSON from data starting with "${_1(s)}"`)}}function Dn(s,e){return nt(s>=0),nt(e>0),s+(e-1)&-4}function Wf(s,e,t){let n;if(s instanceof ArrayBuffer)n=new Uint8Array(s);else{const i=s.byteOffset,A=s.byteLength;n=new Uint8Array(s.buffer||s.arrayBuffer,i,A)}return e.set(n,t),t+Dn(n.byteLength,4)}const y1="Queued Requests",b1="Active Requests",E1="Cancelled Requests",T1="Queued Requests Ever",v1="Active Requests Ever",I1={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class Xf{constructor(e={}){G(this,"props");G(this,"stats");G(this,"activeRequestCount",0);G(this,"requestQueue",[]);G(this,"requestMap",new Map);G(this,"updateTimer",null);this.props={...I1,...e},this.stats=new Ef({id:this.props.id}),this.stats.get(y1),this.stats.get(b1),this.stats.get(E1),this.stats.get(T1),this.stats.get(v1)}scheduleRequest(e,t=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const n={handle:e,priority:0,getPriority:t},i=new Promise(A=>(n.resolve=A,n));return this.requestQueue.push(n),this.requestMap.set(e,i),this._issueNewRequests(),i}_issueRequest(e){const{handle:t,resolve:n}=e;let i=!1;const A=()=>{i||(i=!0,this.requestMap.delete(t),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,n?n({done:A}):Promise.resolve({done:A})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let t=0;t<e;++t){const n=this.requestQueue.shift();n&&this._issueRequest(n)}}}_updateAllRequests(){const e=this.requestQueue;for(let t=0;t<e.length;++t){const n=e[t];this._updateRequest(n)||(e.splice(t,1),this.requestMap.delete(n.handle),t--)}e.sort((t,n)=>t.priority-n.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}function M1(s){switch(s.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function Ca(s){let e=1/0,t=1/0,n=1/0,i=-1/0,A=-1/0,l=-1/0;const h=s.POSITION?s.POSITION.value:[],g=h&&h.length;for(let B=0;B<g;B+=3){const C=h[B],y=h[B+1],E=h[B+2];e=C<e?C:e,t=y<t?y:t,n=E<n?E:n,i=C>i?C:i,A=y>A?y:A,l=E>l?E:l}return[[e,t,n],[i,A,l]]}function Yf(s,e,t){const n=M1(e.value),i=t||w1(e);return{name:s,type:{type:"fixed-size-list",listSize:e.size,children:[{name:"value",type:n}]},nullable:!1,metadata:i}}function w1(s){const e={};return"byteOffset"in s&&(e.byteOffset=s.byteOffset.toString(10)),"byteStride"in s&&(e.byteStride=s.byteStride.toString(10)),"normalized"in s&&(e.normalized=s.normalized.toString()),e}const qr={};function $f(s){if(qr[s]===void 0){const e=g2?x1(s):S1(s);qr[s]=e}return qr[s]}function S1(s){var i,A;const e=["image/png","image/jpeg","image/gif"],t=((i=globalThis.loaders)==null?void 0:i.imageFormatsNode)||e;return!!((A=globalThis.loaders)==null?void 0:A.parseImageNode)&&t.includes(s)}function x1(s){switch(s){case"image/avif":case"image/webp":return D1(s);default:return!0}}function D1(s){try{return document.createElement("canvas").toDataURL(s).indexOf(`data:${s}`)===0}catch{return!1}}class _a extends Tf{constructor(e=0,t=0){super(2),vf(e)&&arguments.length===1?this.copy(e):(As.debug&&(gt(e),gt(t)),this[0]=e,this[1]=t)}set(e,t){return this[0]=e,this[1]=t,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return As.debug&&(gt(e.x),gt(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return p2(this,this,e),this.check()}transformAsVector(e){return m2(this,this,e),this.check()}transformByMatrix3(e){return If(this,this,e),this.check()}transformByMatrix2x3(e){return B2(this,this,e),this.check()}transformByMatrix2(e){return C2(this,this,e),this.check()}}let Yi;class ya extends Tf{static get ZERO(){return Yi||(Yi=new ya(0,0,0,0),Object.freeze(Yi)),Yi}constructor(e=0,t=0,n=0,i=0){super(-0,-0,-0,-0),vf(e)&&arguments.length===1?this.copy(e):(As.debug&&(gt(e),gt(t),gt(n),gt(i)),this[0]=e,this[1]=t,this[2]=n,this[3]=i)}set(e,t,n,i){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return As.debug&&(gt(e.x),gt(e.y),gt(e.z),gt(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=gt(e)}get w(){return this[3]}set w(e){this[3]=gt(e)}transform(e){return _2(this,this,e),this.check()}transformByMatrix3(e){return Mf(this,this,e),this.check()}transformByMatrix2(e){return y2(this,this,e),this.check()}transformByQuaternion(e){return b2(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}function P1(){const s=new FA(9);return FA!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s}function F1(s,e){if(s===e){const t=e[1],n=e[2],i=e[5];s[1]=e[3],s[2]=e[6],s[3]=t,s[5]=e[7],s[6]=n,s[7]=i}else s[0]=e[0],s[1]=e[3],s[2]=e[6],s[3]=e[1],s[4]=e[4],s[5]=e[7],s[6]=e[2],s[7]=e[5],s[8]=e[8];return s}function L1(s,e){const t=e[0],n=e[1],i=e[2],A=e[3],l=e[4],h=e[5],g=e[6],B=e[7],C=e[8],y=C*l-h*B,E=-C*A+h*g,T=B*A-l*g;let x=t*y+n*E+i*T;return x?(x=1/x,s[0]=y*x,s[1]=(-C*n+i*B)*x,s[2]=(h*n-i*l)*x,s[3]=E*x,s[4]=(C*t-i*g)*x,s[5]=(-h*t+i*A)*x,s[6]=T*x,s[7]=(-B*t+n*g)*x,s[8]=(l*t-n*A)*x,s):null}function R1(s){const e=s[0],t=s[1],n=s[2],i=s[3],A=s[4],l=s[5],h=s[6],g=s[7],B=s[8];return e*(B*A-l*g)+t*(-B*i+l*h)+n*(g*i-A*h)}function dl(s,e,t){const n=e[0],i=e[1],A=e[2],l=e[3],h=e[4],g=e[5],B=e[6],C=e[7],y=e[8],E=t[0],T=t[1],x=t[2],F=t[3],N=t[4],R=t[5],Q=t[6],Y=t[7],se=t[8];return s[0]=E*n+T*l+x*B,s[1]=E*i+T*h+x*C,s[2]=E*A+T*g+x*y,s[3]=F*n+N*l+R*B,s[4]=F*i+N*h+R*C,s[5]=F*A+N*g+R*y,s[6]=Q*n+Y*l+se*B,s[7]=Q*i+Y*h+se*C,s[8]=Q*A+Y*g+se*y,s}function O1(s,e,t){const n=e[0],i=e[1],A=e[2],l=e[3],h=e[4],g=e[5],B=e[6],C=e[7],y=e[8],E=t[0],T=t[1];return s[0]=n,s[1]=i,s[2]=A,s[3]=l,s[4]=h,s[5]=g,s[6]=E*n+T*l+B,s[7]=E*i+T*h+C,s[8]=E*A+T*g+y,s}function G1(s,e,t){const n=e[0],i=e[1],A=e[2],l=e[3],h=e[4],g=e[5],B=e[6],C=e[7],y=e[8],E=Math.sin(t),T=Math.cos(t);return s[0]=T*n+E*l,s[1]=T*i+E*h,s[2]=T*A+E*g,s[3]=T*l-E*n,s[4]=T*h-E*i,s[5]=T*g-E*A,s[6]=B,s[7]=C,s[8]=y,s}function gl(s,e,t){const n=t[0],i=t[1];return s[0]=n*e[0],s[1]=n*e[1],s[2]=n*e[2],s[3]=i*e[3],s[4]=i*e[4],s[5]=i*e[5],s[6]=e[6],s[7]=e[7],s[8]=e[8],s}function N1(s,e){const t=e[0],n=e[1],i=e[2],A=e[3],l=t+t,h=n+n,g=i+i,B=t*l,C=n*l,y=n*h,E=i*l,T=i*h,x=i*g,F=A*l,N=A*h,R=A*g;return s[0]=1-y-x,s[3]=C-R,s[6]=E+N,s[1]=C+R,s[4]=1-B-x,s[7]=T-F,s[2]=E-N,s[5]=T+F,s[8]=1-B-y,s}var Ko;(function(s){s[s.COL0ROW0=0]="COL0ROW0",s[s.COL0ROW1=1]="COL0ROW1",s[s.COL0ROW2=2]="COL0ROW2",s[s.COL1ROW0=3]="COL1ROW0",s[s.COL1ROW1=4]="COL1ROW1",s[s.COL1ROW2=5]="COL1ROW2",s[s.COL2ROW0=6]="COL2ROW0",s[s.COL2ROW1=7]="COL2ROW1",s[s.COL2ROW2=8]="COL2ROW2"})(Ko||(Ko={}));const U1=Object.freeze([1,0,0,0,1,0,0,0,1]);class At extends E2{static get IDENTITY(){return k1()}static get ZERO(){return H1()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return Ko}constructor(e,...t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):t.length>0?this.copy([e,...t]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(U1)}fromObject(e){return this.check()}fromQuaternion(e){return N1(this,e),this.check()}set(e,t,n,i,A,l,h,g,B){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this[4]=A,this[5]=l,this[6]=h,this[7]=g,this[8]=B,this.check()}setRowMajor(e,t,n,i,A,l,h,g,B){return this[0]=e,this[1]=i,this[2]=h,this[3]=t,this[4]=A,this[5]=g,this[6]=n,this[7]=l,this[8]=B,this.check()}determinant(){return R1(this)}transpose(){return F1(this,this),this.check()}invert(){return L1(this,this),this.check()}multiplyLeft(e){return dl(this,e,this),this.check()}multiplyRight(e){return dl(this,this,e),this.check()}rotate(e){return G1(this,this,e),this.check()}scale(e){return Array.isArray(e)?gl(this,this,e):gl(this,this,[e,e]),this.check()}translate(e){return O1(this,this,e),this.check()}transform(e,t){let n;switch(e.length){case 2:n=If(t||[-0,-0],e,this);break;case 3:n=T2(t||[-0,-0,-0],e,this);break;case 4:n=Mf(t||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return wf(n,e.length),n}transformVector(e,t){return this.transform(e,t)}transformVector2(e,t){return this.transform(e,t)}transformVector3(e,t){return this.transform(e,t)}}let $i,Zi=null;function H1(){return $i||($i=new At([0,0,0,0,0,0,0,0,0]),Object.freeze($i)),$i}function k1(){return Zi||(Zi=new At,Object.freeze(Zi)),Zi}function pl(){const s=new FA(4);return FA!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s[3]=1,s}function J1(s){return s[0]=0,s[1]=0,s[2]=0,s[3]=1,s}function Zf(s,e,t){t=t*.5;const n=Math.sin(t);return s[0]=n*e[0],s[1]=n*e[1],s[2]=n*e[2],s[3]=Math.cos(t),s}function ml(s,e,t){const n=e[0],i=e[1],A=e[2],l=e[3],h=t[0],g=t[1],B=t[2],C=t[3];return s[0]=n*C+l*h+i*B-A*g,s[1]=i*C+l*g+A*h-n*B,s[2]=A*C+l*B+n*g-i*h,s[3]=l*C-n*h-i*g-A*B,s}function V1(s,e,t){t*=.5;const n=e[0],i=e[1],A=e[2],l=e[3],h=Math.sin(t),g=Math.cos(t);return s[0]=n*g+l*h,s[1]=i*g+A*h,s[2]=A*g-i*h,s[3]=l*g-n*h,s}function z1(s,e,t){t*=.5;const n=e[0],i=e[1],A=e[2],l=e[3],h=Math.sin(t),g=Math.cos(t);return s[0]=n*g-A*h,s[1]=i*g+l*h,s[2]=A*g+n*h,s[3]=l*g-i*h,s}function j1(s,e,t){t*=.5;const n=e[0],i=e[1],A=e[2],l=e[3],h=Math.sin(t),g=Math.cos(t);return s[0]=n*g+i*h,s[1]=i*g-n*h,s[2]=A*g+l*h,s[3]=l*g-A*h,s}function Q1(s,e){const t=e[0],n=e[1],i=e[2];return s[0]=t,s[1]=n,s[2]=i,s[3]=Math.sqrt(Math.abs(1-t*t-n*n-i*i)),s}function _A(s,e,t,n){const i=e[0],A=e[1],l=e[2],h=e[3];let g=t[0],B=t[1],C=t[2],y=t[3],E,T,x,F,N;return E=i*g+A*B+l*C+h*y,E<0&&(E=-E,g=-g,B=-B,C=-C,y=-y),1-E>F2?(T=Math.acos(E),N=Math.sin(T),x=Math.sin((1-n)*T)/N,F=Math.sin(n*T)/N):(x=1-n,F=n),s[0]=x*i+F*g,s[1]=x*A+F*B,s[2]=x*l+F*C,s[3]=x*h+F*y,s}function K1(s,e){const t=e[0],n=e[1],i=e[2],A=e[3],l=t*t+n*n+i*i+A*A,h=l?1/l:0;return s[0]=-t*h,s[1]=-n*h,s[2]=-i*h,s[3]=A*h,s}function W1(s,e){return s[0]=-e[0],s[1]=-e[1],s[2]=-e[2],s[3]=e[3],s}function qf(s,e){const t=e[0]+e[4]+e[8];let n;if(t>0)n=Math.sqrt(t+1),s[3]=.5*n,n=.5/n,s[0]=(e[5]-e[7])*n,s[1]=(e[6]-e[2])*n,s[2]=(e[1]-e[3])*n;else{let i=0;e[4]>e[0]&&(i=1),e[8]>e[i*3+i]&&(i=2);const A=(i+1)%3,l=(i+2)%3;n=Math.sqrt(e[i*3+i]-e[A*3+A]-e[l*3+l]+1),s[i]=.5*n,n=.5/n,s[3]=(e[A*3+l]-e[l*3+A])*n,s[A]=(e[A*3+i]+e[i*3+A])*n,s[l]=(e[l*3+i]+e[i*3+l])*n}return s}const X1=w2,Y1=Sf,$1=M2,Z1=S2,q1=v2,eB=I2,eh=P2,tB=function(){const s=x2(),e=ul(1,0,0),t=ul(0,1,0);return function(n,i,A){const l=xf(i,A);return l<-.999999?(Yr(s,e,i),Df(s)<1e-6&&Yr(s,t,i),D2(s,s),Zf(n,s,Math.PI),n):l>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(Yr(s,i,A),n[0]=s[0],n[1]=s[1],n[2]=s[2],n[3]=1+l,eh(n,n))}}();(function(){const s=pl(),e=pl();return function(t,n,i,A,l,h){return _A(s,n,l,h),_A(e,i,A,h),_A(t,s,e,2*h*(1-h)),t}})();(function(){const s=P1();return function(e,t,n,i){return s[0]=n[0],s[3]=n[1],s[6]=n[2],s[1]=i[0],s[4]=i[1],s[7]=i[2],s[2]=-t[0],s[5]=-t[1],s[8]=-t[2],eh(e,qf(e,s))}})();const nB=[0,0,0,1];class Ti extends L2{constructor(e=0,t=0,n=0,i=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,t,n,i)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,t,n,i){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return qf(this,e),this.check()}fromAxisRotation(e,t){return Zf(this,e,t),this.check()}identity(){return J1(this),this.check()}setAxisAngle(e,t){return this.fromAxisRotation(e,t)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=gt(e)}get y(){return this[1]}set y(e){this[1]=gt(e)}get z(){return this[2]}set z(e){this[2]=gt(e)}get w(){return this[3]}set w(e){this[3]=gt(e)}len(){return q1(this)}lengthSquared(){return eB(this)}dot(e){return $1(this,e)}rotationTo(e,t){return tB(this,e,t),this.check()}add(e){return X1(this,this,e),this.check()}calculateW(){return Q1(this,this),this.check()}conjugate(){return W1(this,this),this.check()}invert(){return K1(this,this),this.check()}lerp(e,t,n){return n===void 0?this.lerp(this,e,t):(Z1(this,e,t,n),this.check())}multiplyRight(e){return ml(this,this,e),this.check()}multiplyLeft(e){return ml(this,e,this),this.check()}normalize(){const e=this.len(),t=e>0?1/e:0;return this[0]=this[0]*t,this[1]=this[1]*t,this[2]=this[2]*t,this[3]=this[3]*t,e===0&&(this[3]=1),this.check()}rotateX(e){return V1(this,this,e),this.check()}rotateY(e){return z1(this,this,e),this.check()}rotateZ(e){return j1(this,this,e),this.check()}scale(e){return Y1(this,this,e),this.check()}slerp(e,t,n){let i,A,l;switch(arguments.length){case 1:({start:i=nB,target:A,ratio:l}=e);break;case 2:i=this,A=e,l=t;break;default:i=e,A=t,l=n}return _A(this,i,A,l),this.check()}transformVector4(e,t=new ya){return R2(t,e,this),wf(t,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,t){return this.setAxisAngle(e,t)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const Bl=1e-6,sB=6371e3;class ks{constructor({phi:e=0,theta:t=0,radius:n=1,bearing:i,pitch:A,altitude:l,radiusScale:h=sB}={}){this.phi=e,this.theta=t,this.radius=n||l||1,this.radiusScale=h||1,i!==void 0&&(this.bearing=i),A!==void 0&&(this.pitch=A),this.check()}toString(){return this.formatString(As)}formatString({printTypes:e=!1}){const t=O2;return`${e?"Spherical":""}[rho:${t(this.radius)},theta:${t(this.theta)},phi:${t(this.phi)}]`}equals(e){return Cn(this.radius,e.radius)&&Cn(this.theta,e.theta)&&Cn(this.phi,e.phi)}exactEquals(e){return this.radius===e.radius&&this.theta===e.theta&&this.phi===e.phi}get bearing(){return 180-Mt(this.phi)}set bearing(e){this.phi=Math.PI-Xi(e)}get pitch(){return Mt(this.theta)}set pitch(e){this.theta=Xi(e)}get longitude(){return Mt(this.phi)}get latitude(){return Mt(this.theta)}get lng(){return Mt(this.phi)}get lat(){return Mt(this.theta)}get z(){return(this.radius-1)*this.radiusScale}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this.check()}clone(){return new ks().copy(this)}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this.check()}fromLngLatZ([e,t,n]){return this.radius=1+n/this.radiusScale,this.phi=Xi(t),this.theta=Xi(e),this.check()}fromVector3(e){return this.radius=Pf(e),this.radius>0&&(this.theta=Math.atan2(e[0],e[1]),this.phi=Math.acos(Ft(e[2]/this.radius,-1,1))),this.check()}toVector3(){return new k(0,0,this.radius).rotateX({radians:this.theta}).rotateZ({radians:this.phi})}makeSafe(){return this.phi=Math.max(Bl,Math.min(Math.PI-Bl,this.phi)),this}check(){if(!Number.isFinite(this.phi)||!Number.isFinite(this.theta)||!(this.radius>0))throw new Error("SphericalCoordinates: some fields set to invalid numbers");return this}}const iB=.1,AB=1e-12,th=1e-15,rB=1e-20,oB=`struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> material : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`,ba={name:"phongMaterial",dependencies:[Ff],source:oB,vs:N2,fs:G2,defines:{LIGHTING_FRAGMENT:1},uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(s){const e={...s};return e.specularColor&&(e.specularColor=e.specularColor.map(t=>t/255)),{...ba.defaultUniforms,...e}}},aB=`out vec3 pbr_vPosition;
out vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
out mat3 pbr_vTBN;
# else
out vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = pbrProjection.modelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(pbrProjection.normalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(pbrProjection.modelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else // HAS_TANGENTS != 1
  pbr_vNormal = normalize(vec3(pbrProjection.modelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`,cB=`precision highp float;

uniform pbrMaterialUniforms {
  // Material is unlit
  bool unlit;

  // Base color map
  bool baseColorMapEnabled;
  vec4 baseColorFactor;

  bool normalMapEnabled;  
  float normalScale; // #ifdef HAS_NORMALMAP

  bool emissiveMapEnabled;
  vec3 emissiveFactor; // #ifdef HAS_EMISSIVEMAP

  vec2 metallicRoughnessValues;
  bool metallicRoughnessMapEnabled;

  bool occlusionMapEnabled;
  float occlusionStrength; // #ifdef HAS_OCCLUSIONMAP
  
  bool alphaCutoffEnabled;
  float alphaCutoff; // #ifdef ALPHA_CUTOFF
  
  // IBL
  bool IBLenabled;
  vec2 scaleIBLAmbient; // #ifdef USE_IBL
  
  // debugging flags used for shader output of intermediate PBR variables
  // #ifdef PBR_DEBUG
  vec4 scaleDiffBaseMR;
  vec4 scaleFGDSpec;
  // #endif
} pbrMaterial;

// Samplers
#ifdef HAS_BASECOLORMAP
uniform sampler2D pbr_baseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D pbr_normalSampler;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D pbr_emissiveSampler;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D pbr_metallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D pbr_occlusionSampler;
#endif
#ifdef USE_IBL
uniform samplerCube pbr_diffuseEnvSampler;
uniform samplerCube pbr_specularEnvSampler;
uniform sampler2D pbr_brdfLUT;
#endif

// Inputs from vertex shader

in vec3 pbr_vPosition;
in vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
in mat3 pbr_vTBN;
#else
in vec3 pbr_vNormal;
#endif
#endif

// Encapsulate the various inputs used by the various functions in the shading equation
// We store values in this struct to simplify the integration of alternative implementations
// of the shading terms, outlined in the Readme.MD Appendix.
struct PBRInfo {
  float NdotL;                  // cos angle between normal and light direction
  float NdotV;                  // cos angle between normal and view direction
  float NdotH;                  // cos angle between normal and half vector
  float LdotH;                  // cos angle between light direction and half vector
  float VdotH;                  // cos angle between view direction and half vector
  float perceptualRoughness;    // roughness value, as authored by the model creator (input to shader)
  float metalness;              // metallic value at the surface
  vec3 reflectance0;            // full reflectance color (normal incidence angle)
  vec3 reflectance90;           // reflectance color at grazing angle
  float alphaRoughness;         // roughness mapped to a more linear change in the roughness (proposed by [2])
  vec3 diffuseColor;            // color contribution from diffuse lighting
  vec3 specularColor;           // color contribution from specular lighting
  vec3 n;                       // normal at surface point
  vec3 v;                       // vector from surface point to camera
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else // SRGB_FAST_APPROXIMATION
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif //SRGB_FAST_APPROXIMATION
  return vec4(linOut,srgbIn.w);;
#else //MANUAL_SRGB
  return srgbIn;
#endif //MANUAL_SRGB
}

// Find the normal for this fragment, pulling either from a predefined normal map
// or from the interpolated mesh normal and tangent attributes.
vec3 getNormal()
{
  // Retrieve the tangent space matrix
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else // HAS_TANGENTS
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture(pbr_normalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(pbrMaterial.normalScale, pbrMaterial.normalScale, 1.0)));
#else
  // The tbn matrix is linearly interpolated, so we need to re-normalize
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}

// Calculation of the lighting contribution from an optional Image Based Light source.
// Precomputed Environment Maps are required uniform inputs and are computed as outlined in [1].
// See our README.md on Environment Maps [3] for additional discussion.
#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInfo, vec3 n, vec3 reflection)
{
  float mipCount = 9.0; // resolution of 512x512
  float lod = (pbrInfo.perceptualRoughness * mipCount);
  // retrieve a scale and bias to F0. See [1], Figure 3
  vec3 brdf = SRGBtoLINEAR(texture(pbr_brdfLUT,
    vec2(pbrInfo.NdotV, 1.0 - pbrInfo.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(texture(pbr_diffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInfo.diffuseColor;
  vec3 specular = specularLight * (pbrInfo.specularColor * brdf.x + brdf.y);

  // For presentation, this allows us to disable IBL terms
  diffuse *= pbrMaterial.scaleIBLAmbient.x;
  specular *= pbrMaterial.scaleIBLAmbient.y;

  return diffuse + specular;
}
#endif

// Basic Lambertian diffuse
// Implementation from Lambert's Photometria https://archive.org/details/lambertsphotome00lambgoog
// See also [1], Equation 1
vec3 diffuse(PBRInfo pbrInfo)
{
  return pbrInfo.diffuseColor / M_PI;
}

// The following equation models the Fresnel reflectance term of the spec equation (aka F())
// Implementation of fresnel from [4], Equation 15
vec3 specularReflection(PBRInfo pbrInfo)
{
  return pbrInfo.reflectance0 +
    (pbrInfo.reflectance90 - pbrInfo.reflectance0) *
    pow(clamp(1.0 - pbrInfo.VdotH, 0.0, 1.0), 5.0);
}

// This calculates the specular geometric attenuation (aka G()),
// where rougher material will reflect less light back to the viewer.
// This implementation is based on [1] Equation 4, and we adopt their modifications to
// alphaRoughness as input as originally proposed in [2].
float geometricOcclusion(PBRInfo pbrInfo)
{
  float NdotL = pbrInfo.NdotL;
  float NdotV = pbrInfo.NdotV;
  float r = pbrInfo.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}

// The following equation(s) model the distribution of microfacet normals across
// the area being drawn (aka D())
// Implementation from "Average Irregularity Representation of a Roughened Surface
// for Ray Reflection" by T. S. Trowbridge, and K. P. Reitz
// Follows the distribution function recommended in the SIGGRAPH 2013 course notes
// from EPIC Games [1], Equation 3.
float microfacetDistribution(PBRInfo pbrInfo)
{
  float roughnessSq = pbrInfo.alphaRoughness * pbrInfo.alphaRoughness;
  float f = (pbrInfo.NdotH * roughnessSq - pbrInfo.NdotH) * pbrInfo.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInfo) {
  pbrInfo.NdotL = 1.0;
  pbrInfo.NdotH = 0.0;
  pbrInfo.LdotH = 0.0;
  pbrInfo.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInfo, vec3 lightDirection) {
  vec3 n = pbrInfo.n;
  vec3 v = pbrInfo.v;
  vec3 l = normalize(lightDirection);             // Vector from surface point to light
  vec3 h = normalize(l+v);                        // Half vector between both l and v

  pbrInfo.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInfo, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInfo, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInfo, vec3 lightColor) {
  // Calculate the shading terms for the microfacet specular shading model
  vec3 F = specularReflection(pbrInfo);
  float G = geometricOcclusion(pbrInfo);
  float D = microfacetDistribution(pbrInfo);

  // Calculation of analytical lighting contribution
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInfo);
  vec3 specContrib = F * G * D / (4.0 * pbrInfo.NdotL * pbrInfo.NdotV);
  // Obtain final intensity as reflectance (BRDF) scaled by the energy of the light (cosine law)
  return pbrInfo.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
  // The albedo may be defined from a base texture or a flat color
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture(pbr_baseColorSampler, pbr_vUV)) * pbrMaterial.baseColorFactor;
#else
  vec4 baseColor = pbrMaterial.baseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < pbrMaterial.alphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbrMaterial.unlit){
    color.rgb = baseColor.rgb;
  }
  else{
    // Metallic and Roughness material properties are packed together
    // In glTF, these factors can be specified by fixed scalar values
    // or from a metallic-roughness map
    float perceptualRoughness = pbrMaterial.metallicRoughnessValues.y;
    float metallic = pbrMaterial.metallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP
    // Roughness is stored in the 'g' channel, metallic is stored in the 'b' channel.
    // This layout intentionally reserves the 'r' channel for (optional) occlusion map data
    vec4 mrSample = texture(pbr_metallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);
    // Roughness is authored as perceptual roughness; as is convention,
    // convert to material roughness by squaring the perceptual roughness [2].
    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);

    // Compute reflectance.
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);

    // For typical incident reflectance range (between 4% to 100%) set the grazing
    // reflectance to 100% for typical fresnel effect.
    // For very low reflectance range on highly diffuse objects (below 4%),
    // incrementally reduce grazing reflecance to 0%.
    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();                          // normal at surface point
    vec3 v = normalize(pbrProjection.camera - pbr_vPosition);  // Vector from surface point to camera

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInfo = PBRInfo(
      0.0, // NdotL
      NdotV,
      0.0, // NdotH
      0.0, // LdotH
      0.0, // VdotH
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );


#ifdef USE_LIGHTS
    // Apply ambient light
    PBRInfo_setAmbientLight(pbrInfo);
    color += calculateFinalColor(pbrInfo, lighting.ambientColor);

    // Apply directional light
    for(int i = 0; i < lighting.directionalLightCount; i++) {
      if (i < lighting.directionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInfo, lighting_getDirectionalLight(i).direction);
        color += calculateFinalColor(pbrInfo, lighting_getDirectionalLight(i).color);
      }
    }

    // Apply point light
    for(int i = 0; i < lighting.pointLightCount; i++) {
      if (i < lighting.pointLightCount) {
        PBRInfo_setPointLight(pbrInfo, lighting_getPointLight(i));
        float attenuation = getPointLightAttenuation(lighting_getPointLight(i), distance(lighting_getPointLight(i).position, pbr_vPosition));
        color += calculateFinalColor(pbrInfo, lighting_getPointLight(i).color / attenuation);
      }
    }
#endif

    // Calculate lighting contribution from image based lighting source (IBL)
#ifdef USE_IBL
    if (pbrMaterial.IBLenabled) {
      color += getIBLContribution(pbrInfo, n, reflection);
    }
#endif

 // Apply optional PBR terms for additional (optional) shading
#ifdef HAS_OCCLUSIONMAP
    if (pbrMaterial.occlusionMapEnabled) {
      float ao = texture(pbr_occlusionSampler, pbr_vUV).r;
      color = mix(color, color * ao, pbrMaterial.occlusionStrength);
    }
#endif

#ifdef HAS_EMISSIVEMAP
    if (pbrMaterial.emissiveMapEnabled) {
      vec3 emissive = SRGBtoLINEAR(texture(pbr_emissiveSampler, pbr_vUV)).rgb * pbrMaterial.emissiveFactor;
      color += emissive;
    }
#endif

    // This section uses mix to override final color for reference app visualization
    // of various parameters in the lighting equation.
#ifdef PBR_DEBUG
    // TODO: Figure out how to debug multiple lights

    // color = mix(color, F, pbr_scaleFGDSpec.x);
    // color = mix(color, vec3(G), pbr_scaleFGDSpec.y);
    // color = mix(color, vec3(D), pbr_scaleFGDSpec.z);
    // color = mix(color, specContrib, pbr_scaleFGDSpec.w);

    // color = mix(color, diffuseContrib, pbr_scaleDiffBaseMR.x);
    color = mix(color, baseColor.rgb, pbrMaterial.scaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), pbrMaterial.scaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), pbrMaterial.scaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,Cl=`uniform pbrProjectionUniforms {
  mat4 modelViewProjectionMatrix;
  mat4 modelMatrix;
  mat4 normalMatrix;
  vec3 camera;
} pbrProjection;
`,lB={name:"pbrProjection",vs:Cl,fs:Cl,getUniforms:s=>s,uniformTypes:{modelViewProjectionMatrix:"mat4x4<f32>",modelMatrix:"mat4x4<f32>",normalMatrix:"mat4x4<f32>",camera:"vec3<i32>"}},Ea={props:{},uniforms:{},name:"pbrMaterial",dependencies:[Ff,lB],vs:aB,fs:cB,defines:{LIGHTING_FRAGMENT:1},getUniforms:s=>s,uniformTypes:{unlit:"i32",baseColorMapEnabled:"i32",baseColorFactor:"vec4<f32>",normalMapEnabled:"i32",normalScale:"f32",emissiveMapEnabled:"i32",emissiveFactor:"vec3<f32>",metallicRoughnessValues:"vec2<f32>",metallicRoughnessMapEnabled:"i32",occlusionMapEnabled:"i32",occlusionStrength:"f32",alphaCutoffEnabled:"i32",alphaCutoff:"f32",IBLenabled:"i32",scaleIBLAmbient:"vec2<f32>",scaleDiffBaseMR:"vec4<f32>",scaleFGDSpec:"vec4<f32>"}},_l=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;

 // Constant-Linear-Exponential
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`,uB={lightSources:{}};function eo(s={}){const{color:e=[0,0,0],intensity:t=1}=s;return e.map(n=>n*t/255)}function fB({ambientLight:s,pointLights:e=[],directionalLights:t=[]}){const n={};return s?n["lighting_uAmbientLight.color"]=eo(s):n["lighting_uAmbientLight.color"]=[0,0,0],e.forEach((i,A)=>{n[`lighting_uPointLight[${A}].color`]=eo(i),n[`lighting_uPointLight[${A}].position`]=i.position,n[`lighting_uPointLight[${A}].attenuation`]=i.attenuation||[1,0,0]}),n.lighting_uPointLightCount=e.length,t.forEach((i,A)=>{n[`lighting_uDirectionalLight[${A}].color`]=eo(i),n[`lighting_uDirectionalLight[${A}].direction`]=i.direction}),n.lighting_uDirectionalLightCount=t.length,n}function nh(s=uB){var e,t;if("lightSources"in s){const{ambientLight:n,pointLights:i,directionalLights:A}=s.lightSources||{};return n||i&&i.length>0||A&&A.length>0?Object.assign({},fB({ambientLight:n,pointLights:i,directionalLights:A}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in s){const n={pointLights:[],directionalLights:[]};for(const i of s.lights||[])switch(i.type){case"ambient":n.ambientLight=i;break;case"directional":(e=n.directionalLights)==null||e.push(i);break;case"point":(t=n.pointLights)==null||t.push(i);break}return nh({lightSources:n})}return{}}const sh={name:"lights",vs:_l,fs:_l,getUniforms:nh,defines:{MAX_LIGHTS:3}},ih=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`,hB={};function dB(s){const{ambient:e=.35,diffuse:t=.6,shininess:n=32,specularColor:i=[30,30,30]}=s;return{lighting_uAmbient:e,lighting_uDiffuse:t,lighting_uShininess:n,lighting_uSpecularColor:i.map(A=>A/255)}}function Ah(s=hB){if(!("material"in s))return{};const{material:e}=s;return e?dB(e):{lighting_uEnabled:!1}}const dL={name:"gouraud-lighting",dependencies:[sh],vs:ih,defines:{LIGHTING_VERTEX:1},getUniforms:Ah},gL={name:"phong-lighting",dependencies:[sh],fs:ih,defines:{LIGHTING_FRAGMENT:1},getUniforms:Ah},rh=.01,gB=["longitude","latitude","zoom"],oh={curve:1.414,speed:1.2};function pB(s,e,t,n){const{startZoom:i,startCenterXY:A,uDelta:l,w0:h,u1:g,S:B,rho:C,rho2:y,r0:E}=ah(s,e,n);if(g<rh){const se={};for(const re of gB){const ue=s[re],Te=e[re];se[re]=U2(ue,Te,t)}return se}const T=t*B,x=Math.cosh(E)/Math.cosh(E+C*T),F=h*((Math.cosh(E)*Math.tanh(E+C*T)-Math.sinh(E))/y)/g,N=1/x,R=i+J2(N),Q=H2([],l,F);jo(Q,Q,A);const Y=Qo(Q);return{longitude:Y[0],latitude:Y[1],zoom:R}}function mB(s,e,t){const n={...oh,...t},{screenSpeed:i,speed:A,maxDuration:l}=n,{S:h,rho:g}=ah(s,e,n),B=1e3*h;let C;return Number.isFinite(i)?C=B/(i/g):C=B/A,Number.isFinite(l)&&C>l?0:C}function ah(s,e,t){t=Object.assign({},oh,t);const n=t.curve,i=s.zoom,A=[s.longitude,s.latitude],l=fl(i),h=e.zoom,g=[e.longitude,e.latitude],B=fl(h-i),C=Qs(A),y=Qs(g),E=k2([],y,C),T=Math.max(s.width,s.height),x=T/B,F=V2(E)*l,N=Math.max(F,rh),R=n*n,Q=(x*x-T*T+R*R*N*N)/(2*T*R*N),Y=(x*x-T*T-R*R*N*N)/(2*x*R*N),se=Math.log(Math.sqrt(Q*Q+1)-Q),re=Math.log(Math.sqrt(Y*Y+1)-Y),ue=(re-se)/n;return{startZoom:i,startCenterXY:C,uDelta:E,w0:T,u1:F,S:ue,rho:n,rho2:R,r0:se,r1:re}}const BB=[255,255,255],CB=1,_B=[1,0,0],yB=[0,0,1];let bB=0;class pL{constructor(e={}){this.type="point";const{color:t=BB}=e,{intensity:n=CB}=e,{position:i=yB}=e;this.id=e.id||`point-${bB++}`,this.color=t,this.intensity=n,this.type="point",this.position=i,this.attenuation=EB(e),this.projectedLight={...this}}getProjectedLight({layer:e}){const{projectedLight:t}=this,n=e.context.viewport,{coordinateSystem:i,coordinateOrigin:A}=e.props,l=z2(this.position,{viewport:n,coordinateSystem:i,coordinateOrigin:A,fromCoordinateSystem:n.isGeospatial?pt.LNGLAT:pt.CARTESIAN,fromCoordinateOrigin:[0,0,0]});return t.color=this.color,t.intensity=this.intensity,t.position=l,t}}function EB(s){return s.attenuation?s.attenuation:_B}const TB="transform_output";class yl{constructor(e,t){G(this,"device");G(this,"model");G(this,"sampler");G(this,"currentIndex",0);G(this,"samplerTextureMap",null);G(this,"bindings",[]);G(this,"resources",{});this.device=e,this.sampler=e.createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",minFilter:"nearest",magFilter:"nearest",mipmapFilter:"nearest"}),this.model=new Ct(this.device,{id:t.id||"texture-transform-model",fs:t.fs||j2({input:t.targetTextureVarying,inputChannels:t.targetTextureChannels,output:TB}),vertexCount:t.vertexCount,...t}),this._initialize(t),Object.seal(this)}destroy(){var e;this.model.destroy();for(const t of this.bindings)(e=t.framebuffer)==null||e.destroy()}delete(){this.destroy()}run(e){const{framebuffer:t}=this.bindings[this.currentIndex],n=this.device.beginRenderPass({framebuffer:t,...e});this.model.draw(n),n.end()}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}_initialize(e){this._updateBindings(e)}_updateBindings(e){this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e)}_updateBinding(e,{sourceBuffers:t,sourceTextures:n,targetTexture:i}){if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,n),Object.assign(e.sourceBuffers,t),i){e.targetTexture=i;const{width:A,height:l}=i;e.framebuffer&&e.framebuffer.destroy(),e.framebuffer=this.device.createFramebuffer({id:"transform-framebuffer",width:A,height:l,colorAttachments:[i]}),e.framebuffer.resize({width:A,height:l})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:t}=this.bindings[e];for(const n in t)t[n].sampler=this.sampler}}const vB=`struct VertexInputs {
  @location(0) clipSpacePosition: vec2<f32>,
  @location(1) texCoord: vec2<f32>,
  @location(2) coordinate: vec2<f32>  
}

struct FragmentInputs {
  @builtin(position) Position : vec4<f32>,
  @location(0) position : vec2<f32>,
  @location(1) coordinate : vec2<f32>,
  @location(2) uv : vec2<f32>
};

@vertex
fn vertexMain(inputs: VertexInputs) -> FragmentInputs {
  var outputs: FragmentInputs;
  outputs.Position = vec4(inputs.clipSpacePosition, 0., 1.);
  outputs.position = inputs.clipSpacePosition;
  outputs.coordinate = inputs.coordinate;
  outputs.uv = inputs.texCoord;
  return outputs;
}
`,IB=`#version 300 es
in vec2 clipSpacePositions;
in vec2 texCoords;
in vec2 coordinates;

out vec2 position;
out vec2 coordinate;
out vec2 uv;

void main(void) {
  gl_Position = vec4(clipSpacePositions, 0., 1.);
  position = clipSpacePositions;
  coordinate = coordinates;
  uv = texCoords;
}
`,bl=[-1,-1,1,-1,-1,1,1,1];class MB extends Ct{constructor(e,t){const n=bl.map(i=>i===-1?0:i);t.source&&(t={...t,source:`${vB}
${t.source}`}),super(e,{id:t.id||pa("clip-space"),...t,vs:IB,vertexCount:4,geometry:new Ht({topology:"triangle-strip",vertexCount:4,attributes:{clipSpacePositions:{size:2,value:new Float32Array(bl)},texCoords:{size:2,value:new Float32Array(n)},coordinates:{size:2,value:new Float32Array(n)}}})})}}class RA{constructor(e={}){G(this,"id");G(this,"matrix",new Fe);G(this,"display",!0);G(this,"position",new k);G(this,"rotation",new k);G(this,"scale",new k(1,1,1));G(this,"userData",{});G(this,"props",{});const{id:t}=e;this.id=t||pa(this.constructor.name),this._setScenegraphNodeProps(e)}getBounds(){return null}destroy(){}delete(){this.destroy()}setProps(e){return this._setScenegraphNodeProps(e),this}toString(){return`{type: ScenegraphNode, id: ${this.id})}`}setPosition(e){return this.position=e,this}setRotation(e){return this.rotation=e,this}setScale(e){return this.scale=e,this}setMatrix(e,t=!0){t?this.matrix.copy(e):this.matrix=e}setMatrixComponents(e){const{position:t,rotation:n,scale:i,update:A=!0}=e;return t&&this.setPosition(t),n&&this.setRotation(n),i&&this.setScale(i),A&&this.updateMatrix(),this}updateMatrix(){const e=this.position,t=this.rotation,n=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(t),this.matrix.scale(n),this}update(e={}){const{position:t,rotation:n,scale:i}=e;return t&&this.setPosition(t),n&&this.setRotation(n),i&&this.setScale(i),this.updateMatrix(),this}getCoordinateUniforms(e,t){t=t||this.matrix;const n=new Fe(e).multiplyRight(t),i=n.invert(),A=i.transpose();return{viewMatrix:e,modelMatrix:t,objectMatrix:t,worldMatrix:n,worldInverseMatrix:i,worldInverseTransposeMatrix:A}}_setScenegraphNodeProps(e){"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}}class Js extends RA{constructor(t={}){t=Array.isArray(t)?{children:t}:t;const{children:n=[]}=t;bi.assert(n.every(i=>i instanceof RA),"every child must an instance of ScenegraphNode");super(t);G(this,"children");this.children=n}getBounds(){const t=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((n,{worldMatrix:i})=>{const A=n.getBounds();if(!A)return;const[l,h]=A,g=new k(l).add(h).divide([2,2,2]);i.transformAsPoint(g,g);const B=new k(h).subtract(l).divide([2,2,2]);i.transformAsVector(B,B);for(let C=0;C<8;C++){const y=new k(C&1?-1:1,C&2?-1:1,C&4?-1:1).multiply(B).add(g);for(let E=0;E<3;E++)t[0][E]=Math.min(t[0][E],y[E]),t[1][E]=Math.max(t[1][E],y[E])}}),Number.isFinite(t[0][0])?t:null}destroy(){this.children.forEach(t=>t.destroy()),this.removeAll(),super.destroy()}add(...t){for(const n of t)Array.isArray(n)?this.add(...n):this.children.push(n);return this}remove(t){const n=this.children,i=n.indexOf(t);return i>-1&&n.splice(i,1),this}removeAll(){return this.children=[],this}traverse(t,{worldMatrix:n=new Fe}={}){const i=new Fe(n).multiplyRight(this.matrix);for(const A of this.children)A instanceof Js?A.traverse(t,{worldMatrix:i}):t(A,{worldMatrix:i})}}class Wo extends RA{constructor(t){super(t);G(this,"model");G(this,"bounds",null);G(this,"managedResources");this.model=t.model,this.managedResources=t.managedResources||[],this.bounds=t.bounds||null,this.setProps(t)}destroy(){this.model&&(this.model.destroy(),this.model=null),this.managedResources.forEach(t=>t.destroy()),this.managedResources=[]}getBounds(){return this.bounds}draw(t){return this.model.draw(t)}}class ch extends Ht{constructor(e={}){const{id:t=pa("cube-geometry"),indices:n=!0}=e;super(n?{...e,id:t,topology:"triangle-list",indices:{size:1,value:wB},attributes:{...RB,...e.attributes}}:{...e,id:t,topology:"triangle-list",indices:void 0,attributes:{...OB,...e.attributes}})}}const wB=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),SB=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),xB=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),DB=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),PB=new Float32Array([1,-1,1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,-1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,1,1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,-1,1,1,1,-1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1]),FB=new Float32Array([1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,1,0,0]),LB=new Float32Array([1,0,1,1,0,0,1,1,0,0,0,1,1,0,0,1,1,0,1,1,0,0,0,1,1,1,1,1,1,0,1,1,1,0,0,1,1,1,0,1,1,1,1,1,1,0,0,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1,0,1,0,1,1,1,1,1,0,1,0,0,1,1,0,1,1,1,0,1,0,1,0,0,0,1,0,0,1,1,0,1,0,1,1,1,1,1,0,1,1,1,0,0,1,1,0,0,1,1,1,0,1,1,1,1,1,1,1,0,0,1,0,0,0,1,0,1,0,1,1,1,0,1,1,0,0,1,0,1,0,1]),RB={POSITION:{size:3,value:SB},NORMAL:{size:3,value:xB},TEXCOORD_0:{size:2,value:DB}},OB={POSITION:{size:3,value:PB},TEXCOORD_0:{size:2,value:FB},COLOR_0:{size:3,value:LB}},GB=`uniform screenUniforms {
  vec2 texSize;
} screen;
`,NB={name:"screen",fs:GB,uniformTypes:{texSize:"vec2<f32>"}};class UB extends Q2{constructor(e,t){super(e,t);const{module:n,fs:i,id:A}=t,l={depthWriteEnabled:!1,depthCompare:"always"};this.model=new MB(e,{id:A,fs:i,modules:[n,NB],parameters:l})}render(e){this._renderPass(this.device,e)}delete(){this.model.destroy(),this.model=null}_renderPass(e,t){const{clearCanvas:n,inputBuffer:i,outputBuffer:A}=t,l=[i.width,i.height],h={texSrc:i.colorAttachments[0],texSize:l};this.model.shaderInputs.setProps({screen:h,...t.moduleProps});const g=this.device.beginRenderPass({framebuffer:A,parameters:{viewport:[0,0,...l]},clearColor:n?[0,0,0,0]:!1,clearDepth:1});this.model.draw(g),g.end()}}class mL{constructor(e,t){this.id=`${e.name}-pass`,this.props=t,K2(e),this.module=e}setup({device:e}){this.passes=HB(e,this.module,this.id)}setProps(e){this.props=e}preRender(){}postRender(e){const t=this.passes,{target:n}=e;let i=e.inputBuffer,A=e.swapBuffer;for(let l=0;l<t.length;l++){const h=l===t.length-1,g=n!==void 0&&h;g&&(A=n);const B=!g||!!e.clearCanvas,C={},y=this.module.passes[l].uniforms;C[this.module.name]={...this.props,...y},t[l].render({clearCanvas:B,inputBuffer:i,outputBuffer:A,moduleProps:C});const E=A;A=i,i=E}return i}cleanup(){if(this.passes){for(const e of this.passes)e.delete();this.passes=void 0}}}function HB(s,e,t){return e.passes.map((n,i)=>{const A=VB(e,n),l=`${t}-${i}`;return new UB(s,{id:l,module:e,fs:A})})}const lh=`#version 300 es
uniform sampler2D texSrc;

in vec2 position;
in vec2 coordinate;
in vec2 uv;

out vec4 fragColor;
`,kB=s=>`${lh}
void main() {
  fragColor = texture(texSrc, coordinate);
  fragColor = ${s}(fragColor, screen.texSize, coordinate);
}
`,JB=s=>`${lh}
void main() {
  fragColor = ${s}(texSrc, screen.texSize, coordinate);
}
`;function VB(s,e){if(e.filter){const t=typeof e.filter=="string"?e.filter:`${s.name}_filterColor_ext`;return kB(t)}if(e.sampler){const t=typeof e.sampler=="string"?e.sampler:`${s.name}_sampleColor`;return JB(t)}return""}const qi=Math.PI/180,El=180/Math.PI,yA=6370972,Rs=256;function zB(){const s=Rs/yA,e=Math.PI/180*Rs;return{unitsPerMeter:[s,s,s],unitsPerMeter2:[0,0,0],metersPerUnit:[1/s,1/s,1/s],unitsPerDegree:[e,e,s],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/s]}}class Ta extends as{constructor(e={}){const{longitude:t=0,zoom:n=0,nearZMultiplier:i=.5,farZMultiplier:A=1,resolution:l=10}=e;let{latitude:h=0,height:g,altitude:B=1.5,fovy:C}=e;h=Math.max(Math.min(h,Lf),-85.051129),g=g||1,C?B=Rf(C):C=W2(B);const y=1/Math.PI/Math.cos(h*Math.PI/180),E=Math.pow(2,n)*y,T=e.nearZ??i,x=e.farZ??(B+Rs*2*E/g)*A,F=new Fe().lookAt({eye:[0,-B,0],up:[0,0,1]});F.rotateX(h*qi),F.rotateZ(-t*qi),F.scale(E/g),super({...e,height:g,viewMatrix:F,longitude:t,latitude:h,zoom:n,distanceScales:zB(),fovy:C,focalDistance:B,near:T,far:x}),this.scale=E,this.latitude=h,this.longitude=t,this.resolution=l}get projectionMode(){return X2.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const t={targetZ:e.z||0},n=this.unproject([0,this.height/2],t),i=this.unproject([this.width/2,0],t),A=this.unproject([this.width,this.height/2],t),l=this.unproject([this.width/2,this.height],t);return A[0]<this.longitude&&(A[0]+=360),n[0]>this.longitude&&(n[0]-=360),[Math.min(n[0],A[0],i[0],l[0]),Math.min(n[1],A[1],i[1],l[1]),Math.max(n[0],A[0],i[0],l[0]),Math.max(n[1],A[1],i[1],l[1])]}unproject(e,{topLeft:t=!0,targetZ:n}={}){const[i,A,l]=e,h=t?A:this.height-A,{pixelUnprojectionMatrix:g}=this;let B;if(Number.isFinite(l))B=to(g,[i,h,l,1]);else{const T=to(g,[i,h,-1,1]),x=to(g,[i,h,1,1]),F=((n||0)/yA+1)*Rs,N=$r(Y2([],T,x)),R=$r(T),Q=$r(x),se=4*((4*R*Q-(N-R-Q)**2)/16)/N,re=Math.sqrt(R-se),ue=Math.sqrt(Math.max(0,F*F-se)),Te=(re-ue)/Math.sqrt(N);B=$2([],T,x,Te)}const[C,y,E]=this.unprojectPosition(B);return Number.isFinite(l)?[C,y,E]:Number.isFinite(n)?[C,y,n]:[C,y]}projectPosition(e){const[t,n,i=0]=e,A=t*qi,l=n*qi,h=Math.cos(l),g=(i/yA+1)*Rs;return[Math.sin(A)*h*g,-Math.cos(A)*h*g,Math.sin(l)*g]}unprojectPosition(e){const[t,n,i]=e,A=Df(e),l=Math.asin(i/A),g=Math.atan2(t,-n)*El,B=l*El,C=(A/Rs-1)*yA;return[g,B,C]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,t){const n=this.unproject(t);return{longitude:e[0]-n[0]+this.longitude,latitude:e[1]-n[1]+this.latitude}}}function to(s,e){const t=Z2([],e,s);return Sf(t,t,1/t[3]),t}const no=Math.PI/180;function jB({height:s,focalDistance:e,orbitAxis:t,rotationX:n,rotationOrbit:i,zoom:A}){const l=t==="Z"?[0,0,1]:[0,1,0],h=t==="Z"?[0,-e,0]:[0,0,e],g=new Fe().lookAt({eye:h,up:l});g.rotateX(n*no),t==="Z"?g.rotateZ(i*no):g.rotateY(i*no);const B=Math.pow(2,A)/s;return g.scale(B),g}class QB extends as{constructor(e){const{height:t,projectionMatrix:n,fovy:i=50,orbitAxis:A="Z",target:l=[0,0,0],rotationX:h=0,rotationOrbit:g=0,zoom:B=0}=e,C=n?n[5]/2:Rf(i);super({...e,longitude:void 0,viewMatrix:jB({height:t||1,focalDistance:C,orbitAxis:A,rotationX:h,rotationOrbit:g,zoom:B}),fovy:i,focalDistance:C,position:l,zoom:B}),this.projectedCenter=this.project(this.center)}unproject(e,{topLeft:t=!0}={}){const[n,i,A=this.projectedCenter[2]]=e,l=t?i:this.height-i,[h,g,B]=Of([n,l,A],this.pixelUnprojectionMatrix);return[h,g,B]}panByPosition(e,t){const n=this.project(e),i=[this.width/2+n[0]-t[0],this.height/2+n[1]-t[1],this.projectedCenter[2]];return{target:this.unproject(i)}}}const KB=new Fe().lookAt({eye:[0,0,1]});function WB({width:s,height:e,near:t,far:n,padding:i}){let A=-s/2,l=s/2,h=-e/2,g=e/2;if(i){const{left:B=0,right:C=0,top:y=0,bottom:E=0}=i,T=Ft((B+s-C)/2,0,s)-s/2,x=Ft((y+e-E)/2,0,e)-e/2;A-=T,l-=T,h+=x,g+=x}return new Fe().ortho({left:A,right:l,bottom:h,top:g,near:t,far:n})}class XB extends as{constructor(e){const{width:t,height:n,near:i=.1,far:A=1e3,zoom:l=0,target:h=[0,0,0],padding:g=null,flipY:B=!0}=e,C=Array.isArray(l)?l[0]:l,y=Array.isArray(l)?l[1]:l,E=Math.min(C,y),T=Math.pow(2,E);let x;if(C!==y){const F=Math.pow(2,C),N=Math.pow(2,y);x={unitsPerMeter:[F/T,N/T,1],metersPerUnit:[T/F,T/N,1]}}super({...e,longitude:void 0,position:h,viewMatrix:KB.clone().scale([T,T*(B?-1:1),T]),projectionMatrix:WB({width:t||1,height:n||1,padding:g,near:i,far:A}),zoom:E,distanceScales:x})}projectFlat([e,t]){const{unitsPerMeter:n}=this.distanceScales;return[e*n[0],t*n[1]]}unprojectFlat([e,t]){const{metersPerUnit:n}=this.distanceScales;return[e*n[0],t*n[1]]}panByPosition(e,t){const n=Of(t,this.pixelUnprojectionMatrix),i=this.projectFlat(e),A=jo([],i,q2([],n)),l=jo([],this.center,A);return{target:this.unprojectFlat(l)}}}class YB extends as{constructor(e){const{longitude:t,latitude:n,modelMatrix:i,bearing:A=0,pitch:l=0,up:h=[0,0,1]}=e,B=new ks({bearing:A,pitch:l===-90?1e-4:90+l}).toVector3().normalize(),C=i?new Fe(i).transformAsVector(B):B,y=Number.isFinite(n)?e1({latitude:n}):0,E=Math.pow(2,y),T=new Fe().lookAt({eye:[0,0,0],center:C,up:h}).scale(E);super({...e,zoom:y,viewMatrix:T}),this.latitude=n,this.longitude=t}}const Zn=20,Tl=500;class va extends Gf{constructor(e){const{width:t,height:n,position:i=[0,0,0],bearing:A=0,pitch:l=0,longitude:h=null,latitude:g=null,maxPitch:B=90,minPitch:C=-90,startRotatePos:y,startBearing:E,startPitch:T,startZoomPosition:x,startPanPos:F,startPanPosition:N}=e;super({width:t,height:n,position:i,bearing:A,pitch:l,longitude:h,latitude:g,maxPitch:B,minPitch:C},{startRotatePos:y,startBearing:E,startPitch:T,startZoomPosition:x,startPanPos:F,startPanPosition:N}),this.makeViewport=e.makeViewport}panStart({pos:e}){const{position:t}=this.getViewportProps();return this._getUpdatedState({startPanPos:e,startPanPosition:t})}pan({pos:e}){if(!e)return this;const{startPanPos:t=[0,0],startPanPosition:n=[0,0]}=this.getState(),{width:i,height:A,bearing:l,pitch:h}=this.getViewportProps(),g=Tl*(e[0]-t[0])/i,B=Tl*(e[1]-t[1])/A,C=new ks({bearing:l,pitch:h}),y=new ks({bearing:l,pitch:-90}),E=C.toVector3().normalize(),T=y.toVector3().cross(E).normalize();return this._getUpdatedState({position:new k(n).add(T.scale(g)).add(E.scale(B))})}panEnd(){return this._getUpdatedState({startPanPos:null,startPanPosition:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:n=0}){const{startRotatePos:i,startBearing:A,startPitch:l}=this.getState(),{width:h,height:g}=this.getViewportProps();if(!i||A===void 0||l===void 0)return this;let B;if(e){const C=(e[0]-i[0])/h,y=(e[1]-i[1])/g;B={bearing:A-C*180,pitch:l-y*90}}else B={bearing:A-t,pitch:l-n};return this._getUpdatedState(B)}rotateEnd(){return this._getUpdatedState({startRotatePos:null,startBearing:null,startPitch:null})}zoomStart(){return this._getUpdatedState({startZoomPosition:this.getViewportProps().position})}zoom({pos:e,scale:t}){const n=this.getViewportProps(),i=this.getState().startZoomPosition||n.position,A=this.makeViewport(n),{projectionMatrix:l,width:h}=A,B=2*Math.atan(1/l[0])*(e[0]/h-.5),C=this.getDirection(!0);return this._move(C.rotateZ({radians:-B}),Math.log2(t)*Zn,i)}zoomEnd(){return this._getUpdatedState({startZoomPosition:null})}moveLeft(e=Zn){const t=this.getDirection(!0);return this._move(t.rotateZ({radians:Math.PI/2}),e)}moveRight(e=Zn){const t=this.getDirection(!0);return this._move(t.rotateZ({radians:-Math.PI/2}),e)}moveUp(e=Zn){const t=this.getDirection(!0);return this._move(t,e)}moveDown(e=Zn){const t=this.getDirection(!0);return this._move(t.negate(),e)}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}zoomIn(e=Zn){return this._move(new k(0,0,1),e)}zoomOut(e=Zn){return this._move(new k(0,0,-1),e)}shortestPathFrom(e){const t=e.getViewportProps(),n={...this.getViewportProps()},{bearing:i,longitude:A}=n;return Math.abs(i-t.bearing)>180&&(n.bearing=i<0?i+360:i-360),A!==null&&t.longitude!==null&&Math.abs(A-t.longitude)>180&&(n.longitude=A<0?A+360:A-360),n}_move(e,t,n=this.getViewportProps().position){const i=e.scale(t);return this._getUpdatedState({position:new k(n).add(i)})}getDirection(e=!1){return new ks({bearing:this.getViewportProps().bearing,pitch:e?90:90+this.getViewportProps().pitch}).toVector3().normalize()}_getUpdatedState(e){return new va({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}applyConstraints(e){const{pitch:t,maxPitch:n,minPitch:i,longitude:A,bearing:l}=e;return e.pitch=Ft(t,i,n),A!==null&&(A<-180||A>180)&&(e.longitude=LA(A+180,360)-180),(l<-180||l>180)&&(e.bearing=LA(l+180,360)-180),e}}class $B extends sr{constructor(){super(...arguments),this.ControllerState=va,this.transition={transitionDuration:300,transitionInterpolator:new Di(["position","pitch","bearing"])}}}class ZB extends ir{constructor(e={}){super(e)}getViewportType(){return YB}get ControllerType(){return $B}}ZB.displayName="FirstPersonView";class uh extends Gf{constructor(e){const{width:t,height:n,rotationX:i=0,rotationOrbit:A=0,target:l=[0,0,0],zoom:h=0,minRotationX:g=-90,maxRotationX:B=90,minZoom:C=-1/0,maxZoom:y=1/0,startPanPosition:E,startRotatePos:T,startRotationX:x,startRotationOrbit:F,startZoomPosition:N,startZoom:R}=e;super({width:t,height:n,rotationX:i,rotationOrbit:A,target:l,zoom:h,minRotationX:g,maxRotationX:B,minZoom:C,maxZoom:y},{startPanPosition:E,startRotatePos:T,startRotationX:x,startRotationOrbit:F,startZoomPosition:N,startZoom:R}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanPosition:this._unproject(e)})}pan({pos:e,startPosition:t}){const n=this.getState().startPanPosition||t;if(!n)return this;const A=this.makeViewport(this.getViewportProps()).panByPosition(n,e);return this._getUpdatedState(A)}panEnd(){return this._getUpdatedState({startPanPosition:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startRotationX:this.getViewportProps().rotationX,startRotationOrbit:this.getViewportProps().rotationOrbit})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:n=0}){const{startRotatePos:i,startRotationX:A,startRotationOrbit:l}=this.getState(),{width:h,height:g}=this.getViewportProps();if(!i||A===void 0||l===void 0)return this;let B;if(e){let C=(e[0]-i[0])/h;const y=(e[1]-i[1])/g;(A<-90||A>90)&&(C*=-1),B={rotationX:A+y*180,rotationOrbit:l+C*180}}else B={rotationX:A+n,rotationOrbit:l+t};return this._getUpdatedState(B)}rotateEnd(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}shortestPathFrom(e){const t=e.getViewportProps(),n={...this.getViewportProps()},{rotationOrbit:i}=n;return Math.abs(i-t.rotationOrbit)>180&&(n.rotationOrbit=i<0?i+360:i-360),n}zoomStart({pos:e}){return this._getUpdatedState({startZoomPosition:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:n}){let{startZoom:i,startZoomPosition:A}=this.getState();if(A||(i=this.getViewportProps().zoom,A=this._unproject(t)||this._unproject(e)),!A)return this;const l=this._calculateNewZoom({scale:n,startZoom:i}),h=this.makeViewport({...this.getViewportProps(),zoom:l});return this._getUpdatedState({zoom:l,...h.panByPosition(A,e)})}zoomEnd(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}zoomIn(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:e})})}zoomOut(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/e})})}moveLeft(e=50){return this._panFromCenter([-e,0])}moveRight(e=50){return this._panFromCenter([e,0])}moveUp(e=50){return this._panFromCenter([0,-e])}moveDown(e=50){return this._panFromCenter([0,e])}rotateLeft(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit-e})}rotateRight(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit+e})}rotateUp(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX-e})}rotateDown(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX+e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_calculateNewZoom({scale:e,startZoom:t}){const{maxZoom:n,minZoom:i}=this.getViewportProps();t===void 0&&(t=this.getViewportProps().zoom);const A=t+Math.log2(e);return Ft(A,i,n)}_panFromCenter(e){const{width:t,height:n,target:i}=this.getViewportProps();return this.pan({startPosition:i,pos:[t/2+e[0],n/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}applyConstraints(e){const{maxZoom:t,minZoom:n,zoom:i,maxRotationX:A,minRotationX:l,rotationOrbit:h}=e;return e.zoom=Array.isArray(i)?[Ft(i[0],n,t),Ft(i[1],n,t)]:Ft(i,n,t),e.rotationX=Ft(e.rotationX,l,A),(h<-180||h>180)&&(e.rotationOrbit=LA(h+180,360)-180),e}}class qB extends sr{constructor(){super(...arguments),this.ControllerState=uh,this.transition={transitionDuration:300,transitionInterpolator:new Di({transitionProps:{compare:["target","zoom","rotationX","rotationOrbit"],required:["target","zoom"]}})}}}class eC extends ir{constructor(e={}){super(e),this.props.orbitAxis=e.orbitAxis||"Z"}getViewportType(){return QB}get ControllerType(){return qB}}eC.displayName="OrbitView";class tC extends uh{constructor(e){super(e),this.zoomAxis=e.zoomAxis||"all"}_calculateNewZoom({scale:e,startZoom:t}){const{maxZoom:n,minZoom:i}=this.getViewportProps();t===void 0&&(t=this.getViewportProps().zoom);let A=Math.log2(e);if(Array.isArray(t)){let[l,h]=t;switch(this.zoomAxis){case"X":l=Ft(l+A,i,n);break;case"Y":h=Ft(h+A,i,n);break;default:let g=Math.min(l+A,h+A);g<i&&(A+=i-g),g=Math.max(l+A,h+A),g>n&&(A+=n-g),l+=A,h+=A}return[l,h]}return Ft(t+A,i,n)}}class nC extends sr{constructor(){super(...arguments),this.ControllerState=tC,this.transition={transitionDuration:300,transitionInterpolator:new Di(["target","zoom"])},this.dragMode="pan"}_onPanRotate(){return!1}}class sC extends ir{constructor(e={}){super(e)}getViewportType(){return XB}get ControllerType(){return nC}}sC.displayName="OrthographicView";class iC extends t1{applyConstraints(e){const{maxZoom:t,minZoom:n,zoom:i}=e;e.zoom=Ft(i,n,t);const{longitude:A,latitude:l}=e;return(A<-180||A>180)&&(e.longitude=LA(A+180,360)-180),e.latitude=Ft(l,-85.051129,Lf),e}}class AC extends sr{constructor(){super(...arguments),this.ControllerState=iC,this.transition={transitionDuration:300,transitionInterpolator:new Di(["longitude","latitude","zoom"])},this.dragMode="pan"}setProps(e){super.setProps(e),this.dragRotate=!1,this.touchRotate=!1}}class rC extends ir{constructor(e={}){super(e)}getViewportType(e){return e.zoom>12?Ei:Ta}get ControllerType(){return AC}}rC.displayName="GlobeView";class Ia{static get componentName(){return Object.prototype.hasOwnProperty.call(this,"extensionName")?this.extensionName:""}constructor(e){e&&(this.opts=e)}equals(e){return this===e?!0:this.constructor===e.constructor&&wn(this.opts,e.opts,1)}getShaders(e){return null}getSubLayerProps(e){const{defaultProps:t}=e.constructor,n={updateTriggers:{}};for(const i in t)if(i in this.props){const A=t[i],l=this.props[i];n[i]=l,A&&A.type==="accessor"&&(n.updateTriggers[i]=this.props.updateTriggers[i],typeof l=="function"&&(n[i]=this.getSubLayerAccessor(l)))}return n}initializeState(e,t){}updateState(e,t){}onNeedsRedraw(e){}getNeedsPickingBuffer(e){return!1}draw(e,t){}finalizeState(e,t){}}Ia.defaultProps={};Ia.extensionName="LayerExtension";const so={bearing:0,pitch:0,position:[0,0,0]},oC={speed:1.2,curve:1.414};class fh extends n1{constructor(e={}){super({compare:["longitude","latitude","zoom","bearing","pitch","position"],extract:["width","height","longitude","latitude","zoom","bearing","pitch","position"],required:["width","height","latitude","longitude","zoom"]}),this.opts={...oC,...e}}interpolateProps(e,t,n){const i=pB(e,t,n,this.opts);for(const A in so)i[A]=Hn(e[A]||so[A],t[A]||so[A],n);return i}getDuration(e,t){let{transitionDuration:n}=t;return n==="auto"&&(n=mB(e,t,this.opts)),n}}function Ks(s,e){e&&Object.entries(e).map(([t,n])=>{t.startsWith("--")?s.style.setProperty(t,n):s.style[t]=n})}function Ma(s,e){e&&Object.keys(e).map(t=>{t.startsWith("--")?s.style.removeProperty(t):s.style[t]=""})}const vl=`uniform arcUniforms {
  bool greatCircle;
  bool useShortestPath;
  float numSegments;
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  highp int widthUnits;
} arc;
`,aC={name:"arc",vs:vl,fs:vl,uniformTypes:{greatCircle:"f32",useShortestPath:"f32",numSegments:"f32",widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",widthUnits:"i32"}},cC=`#version 300 es
#define SHADER_NAME arc-layer-vertex-shader
in vec4 instanceSourceColors;
in vec4 instanceTargetColors;
in vec3 instanceSourcePositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions;
in vec3 instanceTargetPositions64Low;
in vec3 instancePickingColors;
in float instanceWidths;
in float instanceHeights;
in float instanceTilts;
out vec4 vColor;
out vec2 uv;
out float isValid;
float paraboloid(float distance, float sourceZ, float targetZ, float ratio) {
float deltaZ = targetZ - sourceZ;
float dh = distance * instanceHeights;
if (dh == 0.0) {
return sourceZ + deltaZ * ratio;
}
float unitZ = deltaZ / dh;
float p2 = unitZ * unitZ + 1.0;
float dir = step(deltaZ, 0.0);
float z0 = mix(sourceZ, targetZ, dir);
float r = mix(ratio, 1.0 - ratio, dir);
return sqrt(r * (p2 - r)) * dh + z0;
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
float getSegmentRatio(float index) {
return smoothstep(0.0, 1.0, index / (arc.numSegments - 1.0));
}
vec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {
float distance = length(source.xy - target.xy);
float z = paraboloid(distance, source.z, target.z, segmentRatio);
float tiltAngle = radians(instanceTilts);
vec2 tiltDirection = normalize(target.xy - source.xy);
vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);
return vec3(
mix(source.xy, target.xy, segmentRatio) + tilt,
z * cos(tiltAngle)
);
}
float getAngularDist (vec2 source, vec2 target) {
vec2 sourceRadians = radians(source);
vec2 targetRadians = radians(target);
vec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);
vec2 shd_sq = sin_half_delta * sin_half_delta;
float a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;
return 2.0 * asin(sqrt(a));
}
vec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {
vec2 lngLat;
if(abs(angularDist - PI) < 0.001) {
lngLat = (1.0 - t) * source.xy + t * target.xy;
} else {
float a = sin((1.0 - t) * angularDist);
float b = sin(t * angularDist);
vec3 p = source3D.yxz * a + target3D.yxz * b;
lngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));
}
float z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);
return vec3(lngLat, z);
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
float segmentIndex = float(gl_VertexID / 2);
float segmentSide = mod(float(gl_VertexID), 2.) == 0. ? -1. : 1.;
float segmentRatio = getSegmentRatio(segmentIndex);
float prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));
float nextSegmentRatio = getSegmentRatio(min(arc.numSegments - 1.0, segmentIndex + 1.0));
float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
isValid = 1.0;
uv = vec2(segmentRatio, segmentSide);
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
vec4 curr;
vec4 next;
vec3 source;
vec3 target;
if ((arc.greatCircle || project.projectionMode == PROJECTION_MODE_GLOBE) && project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
source = project_globe_(vec3(instanceSourcePositions.xy, 0.0));
target = project_globe_(vec3(instanceTargetPositions.xy, 0.0));
float angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);
vec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);
vec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);
vec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);
if (abs(currPos.x - prevPos.x) > 180.0) {
indexDir = -1.0;
isValid = 0.0;
} else if (abs(currPos.x - nextPos.x) > 180.0) {
indexDir = 1.0;
isValid = 0.0;
}
nextPos = indexDir < 0.0 ? prevPos : nextPos;
nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
if (isValid == 0.0) {
nextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;
float t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);
currPos = mix(currPos, nextPos, t);
segmentRatio = mix(segmentRatio, nextSegmentRatio, t);
}
vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);
vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);
curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);
next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));
} else {
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
if (arc.useShortestPath) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng > 180.) target_world.x -= 360.;
if (deltaLng < -180.) source_world.x -= 360.;
}
source = project_position(source_world, instanceSourcePositions64Low);
target = project_position(target_world, instanceTargetPositions64Low);
float antiMeridianX = 0.0;
if (arc.useShortestPath) {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
antiMeridianX = -(project.coordinateOrigin.x + 180.) / 360. * TILE_SIZE;
}
float thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);
if (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {
isValid = 0.0;
indexDir = sign(segmentRatio - thresholdRatio);
segmentRatio = thresholdRatio;
}
}
nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
vec3 currPos = interpolateFlat(source, target, segmentRatio);
vec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);
if (arc.useShortestPath) {
if (nextPos.x < antiMeridianX) {
currPos.x += TILE_SIZE;
nextPos.x += TILE_SIZE;
}
}
curr = project_common_position_to_clipspace(vec4(currPos, 1.0));
next = project_common_position_to_clipspace(vec4(nextPos, 1.0));
geometry.position = vec4(currPos, 1.0);
}
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * arc.widthScale, arc.widthUnits),
arc.widthMinPixels, arc.widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset((next.xy - curr.xy) * indexDir, segmentSide, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(curr, geometry);
gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);
vColor = vec4(color.rgb, color.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,lC=`#version 300 es
#define SHADER_NAME arc-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
in float isValid;
out vec4 fragColor;
void main(void) {
if (isValid == 0.0) {
discard;
}
fragColor = vColor;
geometry.uv = uv;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,OA=[0,0,0,255],uC={getSourcePosition:{type:"accessor",value:s=>s.sourcePosition},getTargetPosition:{type:"accessor",value:s=>s.targetPosition},getSourceColor:{type:"accessor",value:OA},getTargetColor:{type:"accessor",value:OA},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,numSegments:{type:"number",value:50,min:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class wa extends sn{getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:cC,fs:lC,modules:[St,fn,aC]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getSourceColor",defaultValue:OA},instanceTargetColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getTargetColor",defaultValue:OA},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}updateState(e){var t;super.updateState(e),e.changeFlags.extensionsChanged&&((t=this.state.model)==null||t.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{widthUnits:t,widthScale:n,widthMinPixels:i,widthMaxPixels:A,greatCircle:l,wrapLongitude:h,numSegments:g}=this.props,B={numSegments:g,widthUnits:_n[t],widthScale:n,widthMinPixels:i,widthMaxPixels:A,greatCircle:l,useShortestPath:h},C=this.state.model;C.shaderInputs.setProps({arc:B}),C.setVertexCount(g*2),C.draw(this.context.renderPass)}_getModel(){return new Ct(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-strip",isInstanced:!0})}}wa.layerName="ArcLayer";wa.defaultProps=uC;const fC=new Uint32Array([0,2,1,0,3,2]),hC=new Float32Array([0,1,0,0,1,0,1,1]);function dC(s,e){if(!e)return gC(s);const t=Math.max(Math.abs(s[0][0]-s[3][0]),Math.abs(s[1][0]-s[2][0])),n=Math.max(Math.abs(s[1][1]-s[0][1]),Math.abs(s[2][1]-s[3][1])),i=Math.ceil(t/e)+1,A=Math.ceil(n/e)+1,l=(i-1)*(A-1)*6,h=new Uint32Array(l),g=new Float32Array(i*A*2),B=new Float64Array(i*A*3);let C=0,y=0;for(let E=0;E<i;E++){const T=E/(i-1);for(let x=0;x<A;x++){const F=x/(A-1),N=pC(s,T,F);B[C*3+0]=N[0],B[C*3+1]=N[1],B[C*3+2]=N[2]||0,g[C*2+0]=T,g[C*2+1]=1-F,E>0&&x>0&&(h[y++]=C-A,h[y++]=C-A-1,h[y++]=C-1,h[y++]=C-A,h[y++]=C-1,h[y++]=C),C++}}return{vertexCount:l,positions:B,indices:h,texCoords:g}}function gC(s){const e=new Float64Array(12);for(let t=0;t<s.length;t++)e[t*3+0]=s[t][0],e[t*3+1]=s[t][1],e[t*3+2]=s[t][2]||0;return{vertexCount:6,positions:e,indices:fC,texCoords:hC}}function pC(s,e,t){return Hn(Hn(s[0],s[1],t),Hn(s[3],s[2],t),e)}const Il=`uniform bitmapUniforms {
  vec4 bounds;
  float coordinateConversion;
  float desaturate;
  vec3 tintColor;
  vec4 transparentColor;
} bitmap;
`,mC={name:"bitmap",vs:Il,fs:Il,uniformTypes:{bounds:"vec4<f32>",coordinateConversion:"f32",desaturate:"f32",tintColor:"vec3<f32>",transparentColor:"vec4<f32>"}},BC=`#version 300 es
#define SHADER_NAME bitmap-layer-vertex-shader

in vec2 texCoords;
in vec3 positions;
in vec3 positions64Low;

out vec2 vTexCoord;
out vec2 vTexPos;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (bitmap.coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy + project.commonOrigin.xy;
  } else if (bitmap.coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`,CC=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`,_C=`#version 300 es
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

in vec2 vTexCoord;
in vec2 vTexPos;

out vec4 fragColor;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), bitmap.desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * bitmap.tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  if (bitmap.transparentColor.a == 0.0) {
    return vec4(color, alpha);
  }
  float blendedAlpha = alpha + bitmap.transparentColor.a * (1.0 - alpha);
  float highLightRatio = alpha / blendedAlpha;
  vec3 blendedRGB = mix(bitmap.transparentColor.rgb, color, highLightRatio);
  return vec4(blendedRGB, blendedAlpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bitmap.bounds[0]) / (bitmap.bounds[2] - bitmap.bounds[0]),
    (pos.y - bitmap.bounds[3]) / (bitmap.bounds[1] - bitmap.bounds[3])
  );
}

${CC}

void main(void) {
  vec2 uv = vTexCoord;
  if (bitmap.coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (bitmap.coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture(bitmapTexture, uv);

  fragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * layer.opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(fragColor, geometry);

  if (bool(picking.isActive) && !bool(picking.isAttribute)) {
    // Since instance information is not used, we can use picking color for pixel index
    fragColor.rgb = packUVsIntoRGB(uv);
  }
}
`,yC={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:pt.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0,value:null}};class hh extends sn{getShaders(){return super.getShaders({vs:BC,fs:_C,modules:[St,fn,mC]})}initializeState(){const e=this.getAttributeManager();e.remove(["instancePickingColors"]);const t=!0;e.add({indices:{size:1,isIndexed:!0,update:n=>n.value=this.state.mesh.indices,noAlloc:t},positions:{size:3,type:"float64",fp64:this.use64bitPositions(),update:n=>n.value=this.state.mesh.positions,noAlloc:t},texCoords:{size:2,update:n=>n.value=this.state.mesh.texCoords,noAlloc:t}})}updateState({props:e,oldProps:t,changeFlags:n}){var A;const i=this.getAttributeManager();if(n.extensionsChanged&&((A=this.state.model)==null||A.destroy(),this.state.model=this._getModel(),i.invalidateAll()),e.bounds!==t.bounds){const l=this.state.mesh,h=this._createMesh();this.state.model.setVertexCount(h.vertexCount);for(const g in h)l&&l[g]!==h[g]&&i.invalidate(g);this.setState({mesh:h,...this._getCoordinateUniforms()})}else e._imageCoordinateSystem!==t._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(e){const{image:t}=this.props,n=e.info;if(!n.color||!t)return n.bitmap=null,n;const{width:i,height:A}=t;n.index=0;const l=bC(n.color);return n.bitmap={size:{width:i,height:A},uv:l,pixel:[Math.floor(l[0]*i),Math.floor(l[1]*A)]},n}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(e){super._updateAutoHighlight({...e,color:this.encodePickingColor(0)})}_createMesh(){const{bounds:e}=this.props;let t=e;return Ml(e)&&(t=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]]),dC(t,this.context.viewport.resolution)}_getModel(){return new Ct(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-list",isInstanced:!1})}draw(e){const{shaderModuleProps:t}=e,{model:n,coordinateConversion:i,bounds:A,disablePicking:l}=this.state,{image:h,desaturate:g,transparentColor:B,tintColor:C}=this.props;if(!(t.picking.isActive&&l)&&h&&n){const y={bitmapTexture:h,bounds:A,coordinateConversion:i,desaturate:g,tintColor:C.slice(0,3).map(E=>E/255),transparentColor:B.map(E=>E/255)};n.shaderInputs.setProps({bitmap:y}),n.draw(this.context.renderPass)}}_getCoordinateUniforms(){const{LNGLAT:e,CARTESIAN:t,DEFAULT:n}=pt;let{_imageCoordinateSystem:i}=this.props;if(i!==n){const{bounds:A}=this.props;if(!Ml(A))throw new Error("_imageCoordinateSystem only supports rectangular bounds");const l=this.context.viewport.resolution?e:t;if(i=i===e?e:t,i===e&&l===t)return{coordinateConversion:-1,bounds:A};if(i===t&&l===e){const h=Qs([A[0],A[1]]),g=Qs([A[2],A[3]]);return{coordinateConversion:1,bounds:[h[0],h[1],g[0],g[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}hh.layerName="BitmapLayer";hh.defaultProps=yC;function bC(s){const[e,t,n]=s,i=(n&240)/256,A=(n&15)/16;return[(e+A)/256,(t+i)/256]}function Ml(s){return Number.isFinite(s[0])}const wl=`uniform iconUniforms {
  float sizeScale;
  vec2 iconsTextureDim;
  float sizeMinPixels;
  float sizeMaxPixels;
  bool billboard;
  highp int sizeUnits;
  float alphaCutoff;
} icon;
`,EC={name:"icon",vs:wl,fs:wl,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}},TC=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),
icon.sizeMinPixels, icon.sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (icon.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / icon.iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,vC=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * layer.opacity * vColor.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,IC=1024,MC=4,Sl=()=>{},xl={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},wC={x:0,y:0,width:0,height:0};function SC(s){return Math.pow(2,Math.ceil(Math.log2(s)))}function xC(s,e,t,n){const i=Math.min(t/e.width,n/e.height),A=Math.floor(e.width*i),l=Math.floor(e.height*i);return i===1?{image:e,width:A,height:l}:(s.canvas.height=l,s.canvas.width=A,s.clearRect(0,0,A,l),s.drawImage(e,0,0,e.width,e.height,0,0,A,l),{image:s.canvas,width:A,height:l})}function vi(s){return s&&(s.id||s.url)}function DC(s,e,t,n){const{width:i,height:A,device:l}=s,h=l.createTexture({format:"rgba8unorm",width:e,height:t,sampler:n,mipmaps:!0}),g=l.createCommandEncoder();return g.copyTextureToTexture({sourceTexture:s,destinationTexture:h,width:i,height:A}),g.finish(),s.destroy(),h}function Dl(s,e,t){for(let n=0;n<e.length;n++){const{icon:i,xOffset:A}=e[n],l=vi(i);s[l]={...i,x:A,y:t}}}function PC({icons:s,buffer:e,mapping:t={},xOffset:n=0,yOffset:i=0,rowHeight:A=0,canvasWidth:l}){let h=[];for(let g=0;g<s.length;g++){const B=s[g],C=vi(B);if(!t[C]){const{height:y,width:E}=B;n+E+e>l&&(Dl(t,h,i),n=0,i=A+i+e,A=0,h=[]),h.push({icon:B,xOffset:n}),n=n+E+e,A=Math.max(A,y)}}return h.length>0&&Dl(t,h,i),{mapping:t,rowHeight:A,xOffset:n,yOffset:i,canvasWidth:l,canvasHeight:SC(A+i+e)}}function FC(s,e,t){if(!s||!e)return null;t=t||{};const n={},{iterable:i,objectInfo:A}=cs(s);for(const l of i){A.index++;const h=e(l,A),g=vi(h);if(!h)throw new Error("Icon is missing.");if(!h.url)throw new Error("Icon url is missing.");!n[g]&&(!t[g]||h.url!==t[g].url)&&(n[g]={...h,source:l,sourceIndex:A.index})}return n}class LC{constructor(e,{onUpdate:t=Sl,onError:n=Sl}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=MC,this._canvasWidth=IC,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=t,this.onError=n}finalize(){var e;(e=this._texture)==null||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const t=this._autoPacking?vi(e):e;return this._mapping[t]||wC}setProps({loadOptions:e,autoPacking:t,iconAtlas:n,iconMapping:i,textureParameters:A}){var l;e&&(this._loadOptions=e),t!==void 0&&(this._autoPacking=t),i&&(this._mapping=i),n&&((l=this._texture)==null||l.delete(),this._texture=null,this._externalTexture=n),A&&(this._samplerParameters=A)}get isLoaded(){return this._pendingCount===0}packIcons(e,t){if(!this._autoPacking||typeof document>"u")return;const n=Object.values(FC(e,t,this._mapping)||{});if(n.length>0){const{mapping:i,xOffset:A,yOffset:l,rowHeight:h,canvasHeight:g}=PC({icons:n,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=h,this._mapping=i,this._xOffset=A,this._yOffset=l,this._canvasHeight=g,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||xl,mipmaps:!0})),this._texture.height!==this._canvasHeight&&(this._texture=DC(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||xl)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(n)}}_loadIcons(e){const t=this._canvas.getContext("2d",{willReadFrequently:!0});for(const n of e)this._pendingCount++,ti(n.url,this._loadOptions).then(i=>{var x;const A=vi(n),l=this._mapping[A],{x:h,y:g,width:B,height:C}=l,{image:y,width:E,height:T}=xC(t,i,B,C);(x=this._texture)==null||x.copyExternalImage({image:y,x:h+(B-E)/2,y:g+(C-T)/2,width:E,height:T}),l.width=E,l.height=T,this._texture.generateMipmap(),this.onUpdate()}).catch(i=>{this.onError({url:n.url,source:n.source,sourceIndex:n.sourceIndex,loadOptions:this._loadOptions,error:i})}).finally(()=>{this._pendingCount--})}}const dh=[0,0,0,255],RC={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:s=>s.position},getIcon:{type:"accessor",value:s=>s.icon},getColor:{type:"accessor",value:dh},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class rr extends sn{getShaders(){return super.getShaders({vs:TC,fs:vC,modules:[St,fn,EC]})}initializeState(){this.state={iconManager:new LC(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:dh},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){var T;super.updateState(e);const{props:t,oldProps:n,changeFlags:i}=e,A=this.getAttributeManager(),{iconAtlas:l,iconMapping:h,data:g,getIcon:B,textureParameters:C}=t,{iconManager:y}=this.state;if(typeof l=="string")return;const E=l||this.internalState.isAsyncPropLoading("iconAtlas");y.setProps({loadOptions:t.loadOptions,autoPacking:!E,iconAtlas:l,iconMapping:E?h:null,textureParameters:C}),E?n.iconMapping!==t.iconMapping&&A.invalidate("getIcon"):(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getIcon))&&y.packIcons(g,B),i.extensionsChanged&&((T=this.state.model)==null||T.destroy(),this.state.model=this._getModel(),A.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:t,sizeMinPixels:n,sizeMaxPixels:i,sizeUnits:A,billboard:l,alphaCutoff:h}=this.props,{iconManager:g}=this.state,B=g.getTexture();if(B){const C=this.state.model,y={iconsTexture:B,iconsTextureDim:[B.width,B.height],sizeUnits:_n[A],sizeScale:t,sizeMinPixels:n,sizeMaxPixels:i,billboard:l,alphaCutoff:h};C.shaderInputs.setProps({icon:y}),C.draw(this.context.renderPass)}}_getModel(){const e=[-1,-1,1,-1,-1,1,1,1];return new Ct(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Ht({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var n;const t=(n=this.getCurrentLayer())==null?void 0:n.props.onIconError;t?t(e):at.error(e.error.message)()}getInstanceOffset(e){const{width:t,height:n,anchorX:i=t/2,anchorY:A=n/2}=this.state.iconManager.getIconMapping(e);return[t/2-i,n/2-A]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:t,y:n,width:i,height:A}=this.state.iconManager.getIconMapping(e);return[t,n,i,A]}}rr.defaultProps=RC;rr.layerName="IconLayer";const Pl=`uniform lineUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float useShortestPath;
  highp int widthUnits;
} line;
`,OC={name:"line",vs:Pl,fs:Pl,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",useShortestPath:"f32",widthUnits:"i32"}},GC=`#version 300 es
#define SHADER_NAME line-layer-vertex-shader
in vec3 positions;
in vec3 instanceSourcePositions;
in vec3 instanceTargetPositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in float instanceWidths;
out vec4 vColor;
out vec2 uv;
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
vec3 splitLine(vec3 a, vec3 b, float x) {
float t = (x - a.x) / (b.x - a.x);
return vec3(x, mix(a.yz, b.yz, t));
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
vec3 source_world_64low = instanceSourcePositions64Low;
vec3 target_world_64low = instanceTargetPositions64Low;
if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng * line.useShortestPath > 180.) {
source_world.x += 360. * line.useShortestPath;
source_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
source_world_64low = vec3(0.0);
} else if (deltaLng * line.useShortestPath < -180.) {
target_world.x += 360. * line.useShortestPath;
target_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
target_world_64low = vec3(0.0);
} else if (line.useShortestPath < 0.) {
gl_Position = vec4(0.);
return;
}
}
vec4 source_commonspace;
vec4 target_commonspace;
vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
float segmentIndex = positions.x;
vec4 p = mix(source, target, segmentIndex);
geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
uv = positions.xy;
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
line.widthMinPixels, line.widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(p, geometry);
gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,NC=`#version 300 es
#define SHADER_NAME line-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,UC=[0,0,0,255],HC={getSourcePosition:{type:"accessor",value:s=>s.sourcePosition},getTargetPosition:{type:"accessor",value:s=>s.targetPosition},getColor:{type:"accessor",value:UC},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class gh extends sn{getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:GC,fs:NC,modules:[St,fn,OC]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(e){var t;super.updateState(e),e.changeFlags.extensionsChanged&&((t=this.state.model)==null||t.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{widthUnits:t,widthScale:n,widthMinPixels:i,widthMaxPixels:A,wrapLongitude:l}=this.props,h=this.state.model,g={widthUnits:_n[t],widthScale:n,widthMinPixels:i,widthMaxPixels:A,useShortestPath:l?1:0};h.shaderInputs.setProps({line:g}),h.draw(this.context.renderPass),l&&(h.shaderInputs.setProps({line:{...g,useShortestPath:-1}}),h.draw(this.context.renderPass))}_getModel(){const e=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new Ct(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Ht({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}gh.layerName="LineLayer";gh.defaultProps=HC;const Fl=`uniform pointCloudUniforms {
  float radiusPixels;
  highp int sizeUnits;
} pointCloud;
`,kC={name:"pointCloud",vs:Fl,fs:Fl,uniformTypes:{radiusPixels:"f32",sizeUnits:"i32"}},JC=`#version 300 es
#define SHADER_NAME point-cloud-layer-vertex-shader
in vec3 positions;
in vec3 instanceNormals;
in vec4 instanceColors;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec3 instancePickingColors;
out vec4 vColor;
out vec2 unitPosition;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.normal = project_normal(instanceNormals);
unitPosition = positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
vec3 offset = vec3(positions.xy * project_size_to_pixel(pointCloud.radiusPixels, pointCloud.sizeUnits), 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,VC=`#version 300 es
#define SHADER_NAME point-cloud-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 unitPosition;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition.xy;
float distToCenter = length(unitPosition);
if (distToCenter > 1.0) {
discard;
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,ph=[0,0,0,255],mh=[0,0,1],zC={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:s=>s.position},getNormal:{type:"accessor",value:mh},getColor:{type:"accessor",value:ph},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function jC(s){const{header:e,attributes:t}=s;if(!(!e||!t)&&(s.length=e.vertexCount,t.POSITION&&(t.instancePositions=t.POSITION),t.NORMAL&&(t.instanceNormals=t.NORMAL),t.COLOR_0)){const{size:n,value:i}=t.COLOR_0;t.instanceColors={size:n,type:"unorm8",value:i}}}class Sa extends sn{getShaders(){return super.getShaders({vs:JC,fs:VC,modules:[St,Nf,fn,kC]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:mh},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:ph}})}updateState(e){var i;const{changeFlags:t,props:n}=e;super.updateState(e),t.extensionsChanged&&((i=this.state.model)==null||i.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll()),t.dataChanged&&jC(n.data)}draw({uniforms:e}){const{pointSize:t,sizeUnits:n}=this.props,i=this.state.model,A={sizeUnits:_n[n],radiusPixels:t};i.shaderInputs.setProps({pointCloud:A}),i.draw(this.context.renderPass)}_getModel(){const e=[];for(let t=0;t<3;t++){const n=t/3*Math.PI*2;e.push(Math.cos(n)*2,Math.sin(n)*2,0)}return new Ct(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Ht({topology:"triangle-list",attributes:{positions:new Float32Array(e)}}),isInstanced:!0})}}Sa.layerName="PointCloudLayer";Sa.defaultProps=zC;const Ll=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  bool filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,QC={name:"scatterplot",vs:Ll,fs:Ll,uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},KC=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,WC=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled == false) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Rl=[0,0,0,255],XC={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:s=>s.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:Rl},getLineColor:{type:"accessor",value:Rl},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class xa extends sn{getShaders(){return super.getShaders({vs:KC,fs:WC,modules:[St,fn,QC]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var t;super.updateState(e),e.changeFlags.extensionsChanged&&((t=this.state.model)==null||t.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:t,radiusScale:n,radiusMinPixels:i,radiusMaxPixels:A,stroked:l,filled:h,billboard:g,antialiasing:B,lineWidthUnits:C,lineWidthScale:y,lineWidthMinPixels:E,lineWidthMaxPixels:T}=this.props,x={stroked:l,filled:h,billboard:g,antialiasing:B,radiusUnits:_n[t],radiusScale:n,radiusMinPixels:i,radiusMaxPixels:A,lineWidthUnits:_n[C],lineWidthScale:y,lineWidthMinPixels:E,lineWidthMaxPixels:T},F=this.state.model;F.shaderInputs.setProps({scatterplot:x}),F.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new Ct(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Ht({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}xa.defaultProps=XC;xa.layerName="ScatterplotLayer";class YC extends Ht{constructor(e){const{indices:t,attributes:n}=$C(e);super({...e,indices:t,attributes:n})}}function $C(s){const{radius:e,height:t=1,nradial:n=10}=s;let{vertices:i}=s;i&&(at.assert(i.length>=n),i=i.flatMap(T=>[T[0],T[1]]),s1(i,i1.COUNTER_CLOCKWISE));const A=t>0,l=n+1,h=A?l*3+1:n,g=Math.PI*2/n,B=new Uint16Array(A?n*3*2:0),C=new Float32Array(h*3),y=new Float32Array(h*3);let E=0;if(A){for(let T=0;T<l;T++){const x=T*g,F=T%n,N=Math.sin(x),R=Math.cos(x);for(let Q=0;Q<2;Q++)C[E+0]=i?i[F*2]:R*e,C[E+1]=i?i[F*2+1]:N*e,C[E+2]=(1/2-Q)*t,y[E+0]=i?i[F*2]:R,y[E+1]=i?i[F*2+1]:N,E+=3}C[E+0]=C[E-3],C[E+1]=C[E-2],C[E+2]=C[E-1],E+=3}for(let T=A?0:1;T<l;T++){const x=Math.floor(T/2)*Math.sign(.5-T%2),F=x*g,N=(x+n)%n,R=Math.sin(F),Q=Math.cos(F);C[E+0]=i?i[N*2]:Q*e,C[E+1]=i?i[N*2+1]:R*e,C[E+2]=t/2,y[E+2]=1,E+=3}if(A){let T=0;for(let x=0;x<n;x++)B[T++]=x*2+0,B[T++]=x*2+2,B[T++]=x*2+0,B[T++]=x*2+1,B[T++]=x*2+1,B[T++]=x*2+3}return{indices:B,attributes:{POSITION:{size:3,value:C},NORMAL:{size:3,value:y}}}}const Ol=`uniform columnUniforms {
  float radius;
  float angle;
  vec2 offset;
  bool extruded;
  bool stroked;
  bool isStroke;
  float coverage;
  float elevationScale;
  float edgeDistance;
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  highp int radiusUnits;
  highp int widthUnits;
} column;
`,ZC={name:"column",vs:Ol,fs:Ol,uniformTypes:{radius:"f32",angle:"f32",offset:"vec2<f32>",extruded:"f32",stroked:"f32",isStroke:"f32",coverage:"f32",elevationScale:"f32",edgeDistance:"f32",widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",radiusUnits:"i32",widthUnits:"i32"}},qC=`#version 300 es
#define SHADER_NAME column-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec3 instancePositions;
in float instanceElevations;
in vec3 instancePositions64Low;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in float instanceStrokeWidths;
in vec3 instancePickingColors;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec3 cameraPosition;
out vec4 position_commonspace;
#endif
void main(void) {
geometry.worldPosition = instancePositions;
vec4 color = column.isStroke ? instanceLineColors : instanceFillColors;
mat2 rotationMatrix = mat2(cos(column.angle), sin(column.angle), -sin(column.angle), cos(column.angle));
float elevation = 0.0;
float strokeOffsetRatio = 1.0;
if (column.extruded) {
elevation = instanceElevations * (positions.z + 1.0) / 2.0 * column.elevationScale;
} else if (column.stroked) {
float widthPixels = clamp(
project_size_to_pixel(instanceStrokeWidths * column.widthScale, column.widthUnits),
column.widthMinPixels, column.widthMaxPixels) / 2.0;
float halfOffset = project_pixel_size(widthPixels) / project_size(column.edgeDistance * column.coverage * column.radius);
if (column.isStroke) {
strokeOffsetRatio -= sign(positions.z) * halfOffset;
} else {
strokeOffsetRatio -= halfOffset;
}
}
float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
float dotRadius = column.radius * column.coverage * shouldRender;
geometry.pickingColor = instancePickingColors;
vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);
vec3 centroidPosition64Low = instancePositions64Low;
vec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + column.offset) * dotRadius;
if (column.radiusUnits == UNIT_METERS) {
offset = project_size(offset);
}
vec3 pos = vec3(offset, 0.);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (column.extruded && !column.isStroke) {
#ifdef FLAT_SHADING
cameraPosition = project.cameraPosition;
position_commonspace = geometry.position;
vColor = vec4(color.rgb, color.a * layer.opacity);
#else
vec3 lightColor = lighting_getLightColor(color.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, color.a * layer.opacity);
#endif
} else {
vColor = vec4(color.rgb, color.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,e_=`#version 300 es
#define SHADER_NAME column-layer-fragment-shader
precision highp float;
out vec4 fragColor;
in vec4 vColor;
#ifdef FLAT_SHADING
in vec3 cameraPosition;
in vec4 position_commonspace;
#endif
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
#ifdef FLAT_SHADING
if (column.extruded && !column.isStroke && !bool(picking.isActive)) {
vec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
fragColor.rgb = lighting_getLightColor(vColor.rgb, cameraPosition, position_commonspace.xyz, normal);
}
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,GA=[0,0,0,255],t_={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,flatShading:!1,getPosition:{type:"accessor",value:s=>s.position},getFillColor:{type:"accessor",value:GA},getLineColor:{type:"accessor",value:GA},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class ni extends sn{getShaders(){const e={},{flatShading:t}=this.props;return t&&(e.FLAT_SHADING=1),super.getShaders({vs:qC,fs:e_,defines:e,modules:[St,t?ba:Nf,fn,ZC]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getFillColor",defaultValue:GA},instanceLineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getLineColor",defaultValue:GA},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState(e){var h;super.updateState(e);const{props:t,oldProps:n,changeFlags:i}=e,A=i.extensionsChanged||t.flatShading!==n.flatShading;A&&((h=this.state.models)==null||h.forEach(g=>g.destroy()),this.setState(this._getModels()),this.getAttributeManager().invalidateAll());const l=this.getNumInstances();this.state.fillModel.setInstanceCount(l),this.state.wireframeModel.setInstanceCount(l),(A||t.diskResolution!==n.diskResolution||t.vertices!==n.vertices||(t.extruded||t.stroked)!==(n.extruded||n.stroked))&&this._updateGeometry(t)}getGeometry(e,t,n){const i=new YC({radius:1,height:n?2:0,vertices:t,nradial:e});let A=0;if(t)for(let l=0;l<e;l++){const h=t[l],g=Math.sqrt(h[0]*h[0]+h[1]*h[1]);A+=g/e}else A=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*A}),i}_getModels(){const e=this.getShaders(),t=this.getAttributeManager().getBufferLayouts(),n=new Ct(this.context.device,{...e,id:`${this.props.id}-fill`,bufferLayout:t,isInstanced:!0}),i=new Ct(this.context.device,{...e,id:`${this.props.id}-wireframe`,bufferLayout:t,isInstanced:!0});return{fillModel:n,wireframeModel:i,models:[i,n]}}_updateGeometry({diskResolution:e,vertices:t,extruded:n,stroked:i}){const A=this.getGeometry(e,t,n||i);this.setState({fillVertexCount:A.attributes.POSITION.value.length/3});const l=this.state.fillModel,h=this.state.wireframeModel;l.setGeometry(A),l.setTopology("triangle-strip"),l.setIndexBuffer(null),h.setGeometry(A),h.setTopology("line-list")}draw({uniforms:e}){const{lineWidthUnits:t,lineWidthScale:n,lineWidthMinPixels:i,lineWidthMaxPixels:A,radiusUnits:l,elevationScale:h,extruded:g,filled:B,stroked:C,wireframe:y,offset:E,coverage:T,radius:x,angle:F}=this.props,N=this.state.fillModel,R=this.state.wireframeModel,{fillVertexCount:Q,edgeDistance:Y}=this.state,se={radius:x,angle:F/180*Math.PI,offset:E,extruded:g,stroked:C,coverage:T,elevationScale:h,edgeDistance:Y,radiusUnits:_n[l],widthUnits:_n[t],widthScale:n,widthMinPixels:i,widthMaxPixels:A};g&&y&&(R.shaderInputs.setProps({column:{...se,isStroke:!0}}),R.draw(this.context.renderPass)),B&&(N.setVertexCount(Q),N.shaderInputs.setProps({column:{...se,isStroke:!1}}),N.draw(this.context.renderPass)),!g&&C&&(N.setVertexCount(Q*2/3),N.shaderInputs.setProps({column:{...se,isStroke:!0}}),N.draw(this.context.renderPass))}}ni.layerName="ColumnLayer";ni.defaultProps=t_;const n_={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",value:[1,1]}};let Bh=class extends ni{_updateGeometry(){const e=new ch;this.state.fillModel.setGeometry(e)}draw({uniforms:e}){const{elevationScale:t,extruded:n,offset:i,coverage:A,cellSize:l,angle:h,radiusUnits:g}=this.props,B=this.state.fillModel,C={radius:l/2,radiusUnits:_n[g],angle:h,offset:i,extruded:n,stroked:!1,coverage:A,elevationScale:t,edgeDistance:1,isStroke:!1,widthUnits:0,widthScale:0,widthMinPixels:0,widthMaxPixels:0};B.shaderInputs.setProps({column:C}),B.draw(this.context.renderPass)}};Bh.layerName="GridCellLayer";Bh.defaultProps=n_;function s_(s,e){if(!s)return null;const t="startIndices"in s?s.startIndices[e]:e,n=s.featureIds.value[t];return t!==-1?i_(s,n,t):null}function i_(s,e,t){const n={properties:{...s.properties[e]}};for(const i in s.numericProps)n.properties[i]=s.numericProps[i].value[t];return n}function A_(s,e){const t={points:null,lines:null,polygons:null};for(const n in t){const i=s[n].globalFeatureIds.value;t[n]=new Uint8ClampedArray(i.length*4);const A=[];for(let l=0;l<i.length;l++)e(i[l],A),t[n][l*4+0]=A[0],t[n][l*4+1]=A[1],t[n][l*4+2]=A[2],t[n][l*4+3]=255}return t}const Gl=`uniform sdfUniforms {
  float gamma;
  bool enabled;
  float buffer;
  float outlineBuffer;
  vec4 outlineColor;
} sdf;
`,r_={name:"sdf",vs:Gl,fs:Gl,uniformTypes:{gamma:"f32",enabled:"f32",buffer:"f32",outlineBuffer:"f32",outlineColor:"vec4<f32>"}},o_=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf.enabled) {
float distance = alpha;
alpha = smoothstep(sdf.buffer - sdf.gamma, sdf.buffer + sdf.gamma, distance);
if (sdf.outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(sdf.outlineBuffer - sdf.gamma, sdf.outlineBuffer + sdf.gamma, distance);
color = mix(sdf.outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * layer.opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,io=192/256,Nl=[],a_={getIconOffsets:{type:"accessor",value:s=>s.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class Da extends rr{getShaders(){const e=super.getShaders();return{...e,modules:[...e.modules,r_],fs:o_}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(t,{index:n,target:i})=>this.encodePickingColor(n,i)}})}updateState(e){super.updateState(e);const{props:t,oldProps:n}=e;let{outlineColor:i}=t;i!==n.outlineColor&&(i=i.map(A=>A/255),i[3]=Number.isFinite(i[3])?i[3]:1,this.setState({outlineColor:i})),!t.sdf&&t.outlineWidth&&at.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){const{sdf:t,smoothing:n,outlineWidth:i}=this.props,{outlineColor:A}=this.state,l=i?Math.max(n,io*(1-i)):-1,h=this.state.model,g={buffer:io,outlineBuffer:l,gamma:n,enabled:!!t,outlineColor:A};if(h.shaderInputs.setProps({sdf:g}),super.draw(e),t&&i){const{iconManager:B}=this.state;B.getTexture()&&(h.shaderInputs.setProps({sdf:{...g,outlineBuffer:io}}),h.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(t=>super.getInstanceOffset(t)):Nl}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(t=>super.getInstanceIconFrame(t)):Nl}}Da.defaultProps=a_;Da.layerName="MultiIconLayer";const NA=1e20;class c_{constructor({fontSize:e=24,buffer:t=3,radius:n=8,cutoff:i=.25,fontFamily:A="sans-serif",fontWeight:l="normal",fontStyle:h="normal"}={}){this.buffer=t,this.cutoff=i,this.radius=n;const g=this.size=e+t*4,B=this._createCanvas(g),C=this.ctx=B.getContext("2d",{willReadFrequently:!0});C.font=`${h} ${l} ${e}px ${A}`,C.textBaseline="alphabetic",C.textAlign="left",C.fillStyle="black",this.gridOuter=new Float64Array(g*g),this.gridInner=new Float64Array(g*g),this.f=new Float64Array(g),this.z=new Float64Array(g+1),this.v=new Uint16Array(g)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:i,actualBoundingBoxLeft:A,actualBoundingBoxRight:l}=this.ctx.measureText(e),h=Math.ceil(n),g=0,B=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(l-A))),C=Math.min(this.size-this.buffer,h+Math.ceil(i)),y=B+2*this.buffer,E=C+2*this.buffer,T=Math.max(y*E,0),x=new Uint8ClampedArray(T),F={data:x,width:y,height:E,glyphWidth:B,glyphHeight:C,glyphTop:h,glyphLeft:g,glyphAdvance:t};if(B===0||C===0)return F;const{ctx:N,buffer:R,gridInner:Q,gridOuter:Y}=this;N.clearRect(R,R,B,C),N.fillText(e,R,R+h);const se=N.getImageData(R,R,B,C);Y.fill(NA,0,T),Q.fill(0,0,T);for(let re=0;re<C;re++)for(let ue=0;ue<B;ue++){const Te=se.data[4*(re*B+ue)+3]/255;if(Te===0)continue;const ge=(re+R)*y+ue+R;if(Te===1)Y[ge]=0,Q[ge]=NA;else{const $=.5-Te;Y[ge]=$>0?$*$:0,Q[ge]=$<0?$*$:0}}Ul(Y,0,0,y,E,y,this.f,this.v,this.z),Ul(Q,R,R,B,C,y,this.f,this.v,this.z);for(let re=0;re<T;re++){const ue=Math.sqrt(Y[re])-Math.sqrt(Q[re]);x[re]=Math.round(255-255*(ue/this.radius+this.cutoff))}return F}}function Ul(s,e,t,n,i,A,l,h,g){for(let B=e;B<e+n;B++)Hl(s,t*A+B,A,i,l,h,g);for(let B=t;B<t+i;B++)Hl(s,B*A+e,1,n,l,h,g)}function Hl(s,e,t,n,i,A,l){A[0]=0,l[0]=-1e20,l[1]=NA,i[0]=s[e];for(let h=1,g=0,B=0;h<n;h++){i[h]=s[e+h*t];const C=h*h;do{const y=A[g];B=(i[h]-i[y]+C-y*y)/(h-y)/2}while(B<=l[g]&&--g>-1);g++,A[g]=h,l[g]=B,l[g+1]=NA}for(let h=0,g=0;h<n;h++){for(;l[g+1]<h;)g++;const B=A[g],C=h-B;s[e+h*t]=i[B]+C*C}}const l_=32,u_=[];function f_(s){return Math.pow(2,Math.ceil(Math.log2(s)))}function h_({characterSet:s,getFontWidth:e,fontHeight:t,buffer:n,maxCanvasWidth:i,mapping:A={},xOffset:l=0,yOffset:h=0}){let g=0,B=l;const C=t+n*2;for(const y of s)if(!A[y]){const E=e(y);B+E+n*2>i&&(B=0,g++),A[y]={x:B+n,y:h+g*C+n,width:E,height:C,layoutWidth:E,layoutHeight:t},B+=E+n*2}return{mapping:A,xOffset:B,yOffset:h+g*C,canvasHeight:f_(h+(g+1)*C)}}function Ch(s,e,t,n){var A;let i=0;for(let l=e;l<t;l++){const h=s[l];i+=((A=n[h])==null?void 0:A.layoutWidth)||0}return i}function _h(s,e,t,n,i,A){let l=e,h=0;for(let g=e;g<t;g++){const B=Ch(s,g,g+1,i);h+B>n&&(l<g&&A.push(g),l=g,h=0),h+=B}return h}function d_(s,e,t,n,i,A){let l=e,h=e,g=e,B=0;for(let C=e;C<t;C++)if((s[C]===" "||s[C+1]===" "||C+1===t)&&(g=C+1),g>h){let y=Ch(s,h,g,i);B+y>n&&(l<h&&(A.push(h),l=h,B=0),y>n&&(y=_h(s,h,g,n,i,A),l=A[A.length-1])),h=g,B+=y}return B}function g_(s,e,t,n,i=0,A){A===void 0&&(A=s.length);const l=[];return e==="break-all"?_h(s,i,A,t,n,l):d_(s,i,A,t,n,l),l}function p_(s,e,t,n,i,A){let l=0,h=0;for(let g=e;g<t;g++){const B=s[g],C=n[B];C?(h||(h=C.layoutHeight),i[g]=l+C.layoutWidth/2,l+=C.layoutWidth):(at.warn(`Missing character: ${B} (${B.codePointAt(0)})`)(),i[g]=l,l+=l_)}A[0]=l,A[1]=h}function m_(s,e,t,n,i){var N;const A=Array.from(s),l=A.length,h=new Array(l),g=new Array(l),B=new Array(l),C=(t==="break-word"||t==="break-all")&&isFinite(n)&&n>0,y=[0,0],E=[0,0];let T=0,x=0,F=0;for(let R=0;R<=l;R++){const Q=A[R];if((Q===`
`||R===l)&&(F=R),F>x){const Y=C?g_(A,t,n,i,x,F):u_;for(let se=0;se<=Y.length;se++){const re=se===0?x:Y[se-1],ue=se<Y.length?Y[se]:F;p_(A,re,ue,i,h,E);for(let Te=re;Te<ue;Te++){const ge=A[Te],$=((N=i[ge])==null?void 0:N.layoutOffsetY)||0;g[Te]=T+E[1]/2+$,B[Te]=E[0]}T=T+E[1]*e,y[0]=Math.max(y[0],E[0])}x=F}Q===`
`&&(h[x]=0,g[x]=0,B[x]=0,x++)}return y[1]=T,{x:h,y:g,rowWidth:B,size:y}}function B_({value:s,length:e,stride:t,offset:n,startIndices:i,characterSet:A}){const l=s.BYTES_PER_ELEMENT,h=t?t/l:1,g=n?n/l:0,B=i[e]||Math.ceil((s.length-g)/h),C=A&&new Set,y=new Array(e);let E=s;if(h>1||g>0){const T=s.constructor;E=new T(B);for(let x=0;x<B;x++)E[x]=s[x*h+g]}for(let T=0;T<e;T++){const x=i[T],F=i[T+1]||B,N=E.subarray(x,F);y[T]=String.fromCodePoint.apply(null,N),C&&N.forEach(C.add,C)}if(C)for(const T of C)A.add(String.fromCodePoint(T));return{texts:y,characterCount:B}}class yh{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){const t=this._cache[e];return t&&(this._deleteOrder(e),this._appendOrder(e)),t}set(e,t){this._cache[e]?(this.delete(e),this._cache[e]=t,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=t,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const t=this._order.indexOf(e);t>=0&&this._order.splice(t,1)}_appendOrder(e){this._order.push(e)}}function C_(){const s=[];for(let e=32;e<128;e++)s.push(String.fromCharCode(e));return s}const Vs={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:C_(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},kl=1024,Jl=.9,Vl=1.2,bh=3;let UA=new yh(bh);function __(s,e){let t;typeof e=="string"?t=new Set(Array.from(e)):t=new Set(e);const n=UA.get(s);if(!n)return t;for(const i in n.mapping)t.has(i)&&t.delete(i);return t}function y_(s,e){for(let t=0;t<s.length;t++)e.data[4*t+3]=s[t]}function zl(s,e,t,n){s.font=`${n} ${t}px ${e}`,s.fillStyle="#000",s.textBaseline="alphabetic",s.textAlign="left"}function b_(s){at.assert(Number.isFinite(s)&&s>=bh,"Invalid cache limit"),UA=new yh(s)}class E_{constructor(){this.props={...Vs}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:t}=this.props;return(e*Vl+t*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const t=__(this._key,this.props.characterSet),n=UA.get(this._key);if(n&&t.size===0){this._atlas!==n&&(this._atlas=n);return}const i=this._generateFontAtlas(t,n);this._atlas=i,UA.set(this._key,i)}_generateFontAtlas(e,t){const{fontFamily:n,fontWeight:i,fontSize:A,buffer:l,sdf:h,radius:g,cutoff:B}=this.props;let C=t&&t.data;C||(C=document.createElement("canvas"),C.width=kl);const y=C.getContext("2d",{willReadFrequently:!0});zl(y,n,A,i);const{mapping:E,canvasHeight:T,xOffset:x,yOffset:F}=h_({getFontWidth:N=>y.measureText(N).width,fontHeight:A*Vl,buffer:l,characterSet:e,maxCanvasWidth:kl,...t&&{mapping:t.mapping,xOffset:t.xOffset,yOffset:t.yOffset}});if(C.height!==T){const N=y.getImageData(0,0,C.width,C.height);C.height=T,y.putImageData(N,0,0)}if(zl(y,n,A,i),h){const N=new c_({fontSize:A,buffer:l,radius:g,cutoff:B,fontFamily:n,fontWeight:`${i}`});for(const R of e){const{data:Q,width:Y,height:se,glyphTop:re}=N.draw(R);E[R].width=Y,E[R].layoutOffsetY=A*Jl-re;const ue=y.createImageData(Y,se);y_(Q,ue),y.putImageData(ue,E[R].x,E[R].y)}}else for(const N of e)y.fillText(N,E[N].x,E[N].y+l+A*Jl);return{xOffset:x,yOffset:F,mapping:E,data:C,width:C.width,height:C.height}}_getKey(){const{fontFamily:e,fontWeight:t,fontSize:n,buffer:i,sdf:A,radius:l,cutoff:h}=this.props;return A?`${e} ${t} ${n} ${i} ${l} ${h}`:`${e} ${t} ${n} ${i}`}}const jl=`uniform textBackgroundUniforms {
  bool billboard;
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  vec4 padding;
  highp int sizeUnits;
  bool stroked;
} textBackground;
`,T_={name:"textBackground",vs:jl,fs:jl,uniformTypes:{billboard:"f32",sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",padding:"vec4<f32>",sizeUnits:"i32",stroked:"f32"}},v_=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * textBackground.sizeScale, textBackground.sizeUnits),
textBackground.sizeMinPixels, textBackground.sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + textBackground.padding.xy + textBackground.padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-textBackground.padding.xy, textBackground.padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (textBackground.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,I_=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec2 pixelPosition = uv * dimensions;
if (textBackground.stroked) {
float distToEdge = min(
min(pixelPosition.x, dimensions.x - pixelPosition.x),
min(pixelPosition.y, dimensions.y - pixelPosition.y)
);
float isBorder = smoothedge(distToEdge, vLineWidth);
fragColor = mix(vFillColor, vLineColor, isBorder);
} else {
fragColor = vFillColor;
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,M_={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:s=>s.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class Pa extends sn{getShaders(){return super.getShaders({vs:v_,fs:I_,modules:[St,fn,T_]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var n;super.updateState(e);const{changeFlags:t}=e;t.extensionsChanged&&((n=this.state.model)==null||n.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{billboard:t,sizeScale:n,sizeUnits:i,sizeMinPixels:A,sizeMaxPixels:l,getLineWidth:h}=this.props;let{padding:g}=this.props;g.length<4&&(g=[g[0],g[1],g[0],g[1]]);const B=this.state.model,C={billboard:t,stroked:!!h,padding:g,sizeUnits:_n[i],sizeScale:n,sizeMinPixels:A,sizeMaxPixels:l};B.shaderInputs.setProps({textBackground:C}),B.draw(this.context.renderPass)}_getModel(){const e=[0,0,1,0,0,1,1,1];return new Ct(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Ht({topology:"triangle-strip",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}}Pa.defaultProps=M_;Pa.layerName="TextBackgroundLayer";const Ql={start:1,middle:0,end:-1},Kl={top:1,center:0,bottom:-1},Ao=[0,0,0,255],w_=1,S_={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:Ao},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Vs.characterSet},fontFamily:Vs.fontFamily,fontWeight:Vs.fontWeight,lineHeight:w_,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:Ao},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:s=>s.text},getPosition:{type:"accessor",value:s=>s.position},getColor:{type:"accessor",value:Ao},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class Fa extends xn{constructor(){super(...arguments),this.getBoundingRect=(e,t)=>{let{size:[n,i]}=this.transformParagraph(e,t);const{fontSize:A}=this.state.fontAtlasManager.props;n/=A,i/=A;const{getTextAnchor:l,getAlignmentBaseline:h}=this.props,g=Ql[typeof l=="function"?l(e,t):l],B=Kl[typeof h=="function"?h(e,t):h];return[(g-1)*n/2,(B-1)*i/2,n,i]},this.getIconOffsets=(e,t)=>{const{getTextAnchor:n,getAlignmentBaseline:i}=this.props,{x:A,y:l,rowWidth:h,size:[g,B]}=this.transformParagraph(e,t),C=Ql[typeof n=="function"?n(e,t):n],y=Kl[typeof i=="function"?i(e,t):i],E=A.length,T=new Array(E*2);let x=0;for(let F=0;F<E;F++){const N=(1-C)*(g-h[F])/2;T[x++]=(C-1)*g/2+N+A[F],T[x++]=(y-1)*B/2+l[F]}return T}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new E_},this.props.maxWidth>0&&at.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:t,oldProps:n,changeFlags:i}=e;(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||t.lineHeight!==n.lineHeight||t.wordBreak!==n.wordBreak||t.maxWidth!==n.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:t,fontWeight:n}=this.props,{fontAtlasManager:i,characterSet:A}=this.state,l={...e,characterSet:A,fontFamily:t,fontWeight:n};if(!i.mapping)return i.setProps(l),!0;for(const h in l)if(l[h]!==i.props[h])return i.setProps(l),!0;return!1}_updateText(){var g;const{data:e,characterSet:t}=this.props,n=(g=e.attributes)==null?void 0:g.getText;let{getText:i}=this.props,A=e.startIndices,l;const h=t==="auto"&&new Set;if(n&&A){const{texts:B,characterCount:C}=B_({...ArrayBuffer.isView(n)?{value:n}:n,length:e.length,startIndices:A,characterSet:h});l=C,i=(y,{index:E})=>B[E]}else{const{iterable:B,objectInfo:C}=cs(e);A=[0],l=0;for(const y of B){C.index++;const E=Array.from(i(y,C)||"");h&&E.forEach(h.add,h),l+=E.length,A.push(l)}}this.setState({getText:i,startIndices:A,numInstances:l,characterSet:h||t})}transformParagraph(e,t){const{fontAtlasManager:n}=this.state,i=n.mapping,A=this.state.getText,{wordBreak:l,lineHeight:h,maxWidth:g}=this.props,B=A(e,t)||"";return m_(B,h,l,g*n.props.fontSize,i)}renderLayers(){const{startIndices:e,numInstances:t,getText:n,fontAtlasManager:{scale:i,atlas:A,mapping:l},styleVersion:h}=this.state,{data:g,_dataDiff:B,getPosition:C,getColor:y,getSize:E,getAngle:T,getPixelOffset:x,getBackgroundColor:F,getBorderColor:N,getBorderWidth:R,backgroundPadding:Q,background:Y,billboard:se,fontSettings:re,outlineWidth:ue,outlineColor:Te,sizeScale:ge,sizeUnits:$,sizeMinPixels:K,sizeMaxPixels:O,transitions:ne,updateTriggers:he}=this.props,Le=this.getSubLayerClass("characters",Da),Re=this.getSubLayerClass("background",Pa);return[Y&&new Re({getFillColor:F,getLineColor:N,getLineWidth:R,padding:Q,getPosition:C,getSize:E,getAngle:T,getPixelOffset:x,billboard:se,sizeScale:ge,sizeUnits:$,sizeMinPixels:K,sizeMaxPixels:O,transitions:ne&&{getPosition:ne.getPosition,getAngle:ne.getAngle,getSize:ne.getSize,getFillColor:ne.getBackgroundColor,getLineColor:ne.getBorderColor,getLineWidth:ne.getBorderWidth,getPixelOffset:ne.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:he.getPosition,getAngle:he.getAngle,getSize:he.getSize,getFillColor:he.getBackgroundColor,getLineColor:he.getBorderColor,getLineWidth:he.getBorderWidth,getPixelOffset:he.getPixelOffset,getBoundingRect:{getText:he.getText,getTextAnchor:he.getTextAnchor,getAlignmentBaseline:he.getAlignmentBaseline,styleVersion:h}}}),{data:g.attributes&&g.attributes.background?{length:g.length,attributes:g.attributes.background}:g,_dataDiff:B,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new Le({sdf:re.sdf,smoothing:Number.isFinite(re.smoothing)?re.smoothing:Vs.smoothing,outlineWidth:ue/(re.radius||Vs.radius),outlineColor:Te,iconAtlas:A,iconMapping:l,getPosition:C,getColor:y,getSize:E,getAngle:T,getPixelOffset:x,billboard:se,sizeScale:ge*i,sizeUnits:$,sizeMinPixels:K*i,sizeMaxPixels:O*i,transitions:ne&&{getPosition:ne.getPosition,getAngle:ne.getAngle,getColor:ne.getColor,getSize:ne.getSize,getPixelOffset:ne.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:he.getText,getPosition:he.getPosition,getAngle:he.getAngle,getColor:he.getColor,getSize:he.getSize,getPixelOffset:he.getPixelOffset,getIconOffsets:{getTextAnchor:he.getTextAnchor,getAlignmentBaseline:he.getAlignmentBaseline,styleVersion:h}}}),{data:g,_dataDiff:B,startIndices:e,numInstances:t,getIconOffsets:this.getIconOffsets,getIcon:n})]}static set fontAtlasCacheLimit(e){b_(e)}}Fa.defaultProps=S_;Fa.layerName="TextLayer";const bA={circle:{type:xa,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:rr,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:Fa,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},EA={type:ma,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},Xo={type:Uf,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function fi({type:s,props:e}){const t={};for(const n in e)t[n]=s.defaultProps[e[n]];return t}function ro(s,e){const{transitions:t,updateTriggers:n}=s.props,i={updateTriggers:{},transitions:t&&{getPosition:t.geometry}};for(const A in e){const l=e[A];let h=s.props[A];A.startsWith("get")&&(h=s.getSubLayerAccessor(h),i.updateTriggers[l]=n[A],t&&(i.transitions[l]=t[A])),i[l]=h}return i}function x_(s){if(Array.isArray(s))return s;switch(at.assert(s.type,"GeoJSON does not have type"),s.type){case"Feature":return[s];case"FeatureCollection":return at.assert(Array.isArray(s.features),"GeoJSON does not have features array"),s.features;default:return[{geometry:s}]}}function Wl(s,e,t={}){const n={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:i=0,endRow:A=s.length}=t;for(let l=i;l<A;l++){const h=s[l],{geometry:g}=h;if(g)if(g.type==="GeometryCollection"){at.assert(Array.isArray(g.geometries),"GeoJSON does not have geometries array");const{geometries:B}=g;for(let C=0;C<B.length;C++){const y=B[C];Xl(y,n,e,h,l)}}else Xl(g,n,e,h,l)}return n}function Xl(s,e,t,n,i){const{type:A,coordinates:l}=s,{pointFeatures:h,lineFeatures:g,polygonFeatures:B,polygonOutlineFeatures:C}=e;if(!P_(A,l)){at.warn(`${A} coordinates are malformed`)();return}switch(A){case"Point":h.push(t({geometry:s},n,i));break;case"MultiPoint":l.forEach(y=>{h.push(t({geometry:{type:"Point",coordinates:y}},n,i))});break;case"LineString":g.push(t({geometry:s},n,i));break;case"MultiLineString":l.forEach(y=>{g.push(t({geometry:{type:"LineString",coordinates:y}},n,i))});break;case"Polygon":B.push(t({geometry:s},n,i)),l.forEach(y=>{C.push(t({geometry:{type:"LineString",coordinates:y}},n,i))});break;case"MultiPolygon":l.forEach(y=>{B.push(t({geometry:{type:"Polygon",coordinates:y}},n,i)),y.forEach(E=>{C.push(t({geometry:{type:"LineString",coordinates:E}},n,i))})});break}}const D_={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function P_(s,e){let t=D_[s];for(at.assert(t,`Unknown GeoJSON type ${s}`);e&&--t>0;)e=e[0];return e&&Number.isFinite(e[0])}function Eh(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function eA(s){return s.geometry.coordinates}function F_(s,e){const t=Eh(),{pointFeatures:n,lineFeatures:i,polygonFeatures:A,polygonOutlineFeatures:l}=s;return t.points.data=n,t.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),t.points.getPosition=eA,t.lines.data=i,t.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),t.lines.getPath=eA,t.polygons.data=A,t.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),t.polygons.getPolygon=eA,t.polygonsOutline.data=l,t.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),t.polygonsOutline.getPath=eA,t}function L_(s,e){const t=Eh(),{points:n,lines:i,polygons:A}=s,l=A_(s,e);return t.points.data={length:n.positions.value.length/n.positions.size,attributes:{...n.attributes,getPosition:n.positions,instancePickingColors:{size:4,value:l.points}},properties:n.properties,numericProps:n.numericProps,featureIds:n.featureIds},t.lines.data={length:i.pathIndices.value.length-1,startIndices:i.pathIndices.value,attributes:{...i.attributes,getPath:i.positions,instancePickingColors:{size:4,value:l.lines}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},t.lines._pathType="open",t.polygons.data={length:A.polygonIndices.value.length-1,startIndices:A.polygonIndices.value,attributes:{...A.attributes,getPolygon:A.positions,pickingColors:{size:4,value:l.polygons}},properties:A.properties,numericProps:A.numericProps,featureIds:A.featureIds},t.polygons._normalize=!1,A.triangles&&(t.polygons.data.attributes.indices=A.triangles.value),t.polygonsOutline.data={length:A.primitivePolygonIndices.value.length-1,startIndices:A.primitivePolygonIndices.value,attributes:{...A.attributes,getPath:A.positions,instancePickingColors:{size:4,value:l.polygons}},properties:A.properties,numericProps:A.numericProps,featureIds:A.featureIds},t.polygonsOutline._pathType="open",t}const R_=["points","linestrings","polygons"],O_={...fi(bA.circle),...fi(bA.icon),...fi(bA.text),...fi(EA),...fi(Xo),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:s=>s.properties.icon},getText:{type:"accessor",value:s=>s.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class Fi extends xn{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:t}){if(!t.dataChanged)return;const{data:n}=this.props,i=n&&"points"in n&&"polygons"in n&&"lines"in n;this.setState({binary:i}),i?this._updateStateBinary({props:e,changeFlags:t}):this._updateStateJSON({props:e,changeFlags:t})}_updateStateBinary({props:e,changeFlags:t}){const n=L_(e.data,this.encodePickingColor);this.setState({layerProps:n})}_updateStateJSON({props:e,changeFlags:t}){const n=x_(e.data),i=this.getSubLayerRow.bind(this);let A={};const l={};if(Array.isArray(t.dataChanged)){const g=this.state.features;for(const B in g)A[B]=g[B].slice(),l[B]=[];for(const B of t.dataChanged){const C=Wl(n,i,B);for(const y in g)l[y].push(A1({data:A[y],getIndex:E=>E.__source.index,dataRange:B,replace:C[y]}))}}else A=Wl(n,i);const h=F_(A,l);this.setState({features:A,featuresDiff:l,layerProps:h})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:n,sourceLayer:i}=t;return t.featureType=R_.find(A=>i.id.startsWith(`${this.id}-${A}-`)),n>=0&&i.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(t.index=this.props.data.points.globalFeatureIds.value[n]),t}_updateAutoHighlight(e){const t=`${this.id}-points-`,n=e.featureType==="points";for(const i of this.getSubLayers())i.id.startsWith(t)===n&&i.updateAutoHighlight(e)}_renderPolygonLayer(){var l;const{extruded:e,wireframe:t}=this.props,{layerProps:n}=this.state,i="polygons-fill",A=this.shouldRenderSubLayer(i,(l=n.polygons)==null?void 0:l.data)&&this.getSubLayerClass(i,Xo.type);if(A){const h=ro(this,Xo.props),g=e&&t;return g||delete h.getLineColor,h.updateTriggers.lineColors=g,new A(h,this.getSubLayerProps({id:i,updateTriggers:h.updateTriggers}),n.polygons)}return null}_renderLineLayers(){var g,B;const{extruded:e,stroked:t}=this.props,{layerProps:n}=this.state,i="polygons-stroke",A="linestrings",l=!e&&t&&this.shouldRenderSubLayer(i,(g=n.polygonsOutline)==null?void 0:g.data)&&this.getSubLayerClass(i,EA.type),h=this.shouldRenderSubLayer(A,(B=n.lines)==null?void 0:B.data)&&this.getSubLayerClass(A,EA.type);if(l||h){const C=ro(this,EA.props);return[l&&new l(C,this.getSubLayerProps({id:i,updateTriggers:C.updateTriggers}),n.polygonsOutline),h&&new h(C,this.getSubLayerProps({id:A,updateTriggers:C.updateTriggers}),n.lines)]}return null}_renderPointLayers(){var h;const{pointType:e}=this.props,{layerProps:t,binary:n}=this.state;let{highlightedObjectIndex:i}=this.props;!n&&Number.isFinite(i)&&(i=t.points.data.findIndex(g=>g.__source.index===i));const A=new Set(e.split("+")),l=[];for(const g of A){const B=`points-${g}`,C=bA[g],y=C&&this.shouldRenderSubLayer(B,(h=t.points)==null?void 0:h.data)&&this.getSubLayerClass(B,C.type);if(y){const E=ro(this,C.props);let T=t.points;if(g==="text"&&n){const{instancePickingColors:x,...F}=T.data.attributes;T={...T,data:{...T.data,attributes:F}}}l.push(new y(E,this.getSubLayerProps({id:B,updateTriggers:E.updateTriggers,highlightedObjectIndex:i}),T))}}return l}renderLayers(){const{extruded:e}=this.props,t=this._renderPolygonLayer(),n=this._renderLineLayers(),i=this._renderPointLayers();return[!e&&t,n,i,e&&t]}getSubLayerAccessor(e){const{binary:t}=this.state;return!t||typeof e!="function"?super.getSubLayerAccessor(e):(n,i)=>{const{data:A,index:l}=i,h=s_(A,l);return e(h,i)}}}Fi.layerName="GeoJsonLayer";Fi.defaultProps=O_;function G_({pointCount:s,getBinId:e}){const t=new Map;for(let n=0;n<s;n++){const i=e(n);if(i===null)continue;let A=t.get(String(i));A?A.points.push(n):(A={id:i,index:t.size,points:[n]},t.set(String(i),A))}return Array.from(t.values())}function N_({bins:s,dimensions:e,target:t}){const n=s.length*e;(!t||t.length<n)&&(t=new Float32Array(n));for(let i=0;i<s.length;i++){const{id:A}=s[i];Array.isArray(A)?t.set(A,i*e):t[i]=A}return t}const U_=s=>s.length,Th=(s,e)=>{let t=0;for(const n of s)t+=e(n);return t},H_=(s,e)=>s.length===0?NaN:Th(s,e)/s.length,k_=(s,e)=>{let t=1/0;for(const n of s){const i=e(n);i<t&&(t=i)}return t},J_=(s,e)=>{let t=-1/0;for(const n of s){const i=e(n);i>t&&(t=i)}return t},V_={COUNT:U_,SUM:Th,MEAN:H_,MIN:k_,MAX:J_};function z_({bins:s,getValue:e,operation:t,target:n}){(!n||n.length<s.length)&&(n=new Float32Array(s.length));let i=1/0,A=-1/0;for(let l=0;l<s.length;l++){const{points:h}=s[l];n[l]=t(h,e),n[l]<i&&(i=n[l]),n[l]>A&&(A=n[l])}return{value:n,domain:[i,A]}}function Yl(s,e,t){const n={};for(const A of s.sources||[]){const l=e[A];if(l)n[A]=j_(l);else throw new Error(`Cannot find attribute ${A}`)}const i={};return A=>{for(const l in n)i[l]=n[l](A);return s.getValue(i,A,t)}}function j_(s){const e=s.value,{offset:t=0,stride:n,size:i}=s.getAccessor(),A=e.BYTES_PER_ELEMENT,l=t/A,h=n?n/A:i;if(i===1)return s.isConstant?()=>e[0]:B=>{const C=l+h*B;return e[C]};let g;return s.isConstant?(g=Array.from(e),()=>g):(g=new Array(i),B=>{const C=l+h*B;for(let y=0;y<i;y++)g[y]=e[C+y];return g})}class Li{constructor(e){this.bins=[],this.binIds=null,this.results=[],this.dimensions=e.dimensions,this.channelCount=e.getValue.length,this.props={...e,binOptions:{},pointCount:0,operations:[],customOperations:[],attributes:{}},this.needsUpdate=!0,this.setProps(e)}destroy(){}get binCount(){return this.bins.length}setProps(e){const t=this.props;if(e.binOptions&&(wn(e.binOptions,t.binOptions,2)||this.setNeedsUpdate()),e.operations)for(let n=0;n<this.channelCount;n++)e.operations[n]!==t.operations[n]&&this.setNeedsUpdate(n);if(e.customOperations)for(let n=0;n<this.channelCount;n++)!!e.customOperations[n]!=!!t.customOperations[n]&&this.setNeedsUpdate(n);e.pointCount!==void 0&&e.pointCount!==t.pointCount&&this.setNeedsUpdate(),e.attributes&&(e.attributes={...t.attributes,...e.attributes}),Object.assign(this.props,e)}setNeedsUpdate(e){e===void 0?this.needsUpdate=!0:this.needsUpdate!==!0&&(this.needsUpdate=this.needsUpdate||[],this.needsUpdate[e]=!0)}update(){var e,t,n,i;if(this.needsUpdate===!0){this.bins=G_({pointCount:this.props.pointCount,getBinId:Yl(this.props.getBin,this.props.attributes,this.props.binOptions)});const A=N_({bins:this.bins,dimensions:this.dimensions,target:(e=this.binIds)==null?void 0:e.value});this.binIds={value:A,type:"float32",size:this.dimensions}}for(let A=0;A<this.channelCount;A++)if(this.needsUpdate===!0||this.needsUpdate[A]){const l=this.props.customOperations[A]||V_[this.props.operations[A]],{value:h,domain:g}=z_({bins:this.bins,getValue:Yl(this.props.getValue[A],this.props.attributes,void 0),operation:l,target:(t=this.results[A])==null?void 0:t.value});this.results[A]={value:h,domain:g,type:"float32",size:1},(i=(n=this.props).onUpdate)==null||i.call(n,{channel:A})}this.needsUpdate=!1}preDraw(){}getBins(){return this.binIds}getResult(e){return this.results[e]}getResultDomain(e){var t;return((t=this.results[e])==null?void 0:t.domain)??[1/0,-1/0]}getBin(e){const t=this.bins[e];if(!t)return null;const n=new Array(this.channelCount);for(let i=0;i<n.length;i++){const A=this.results[i];n[i]=A==null?void 0:A.value[e]}return{id:t.id,value:n,count:t.points.length,pointIndices:t.points}}}function vh(s,e,t){return s.createFramebuffer({width:e,height:t,colorAttachments:[s.createTexture({width:e,height:t,format:"rgba32float",mipmaps:!1,sampler:{minFilter:"nearest",magFilter:"nearest"}})]})}const Q_=`uniform binSorterUniforms {
  ivec4 binIdRange;
  ivec2 targetSize;
} binSorter;
`,K_={name:"binSorter",vs:Q_,uniformTypes:{binIdRange:"vec4<i32>",targetSize:"vec2<i32>"}},Ih=[1,2,4,8],W_=3e38,X_={SUM:0,MEAN:0,MIN:0,MAX:0,COUNT:0},TA=1024;class Y_{constructor(e,t){this.binsFBO=null,this.device=e,this.model=Z_(e,t)}get texture(){return this.binsFBO?this.binsFBO.colorAttachments[0].texture:null}destroy(){var e,t;this.model.destroy(),(e=this.binsFBO)==null||e.colorAttachments[0].texture.destroy(),(t=this.binsFBO)==null||t.destroy()}getBinValues(e){if(!this.binsFBO)return null;const t=e%TA,n=Math.floor(e/TA),i=this.device.readPixelsToArrayWebGL(this.binsFBO,{sourceX:t,sourceY:n,sourceWidth:1,sourceHeight:1}).buffer;return new Float32Array(i)}setDimensions(e,t){var l,h;const n=TA,i=Math.ceil(e/n);this.binsFBO?this.binsFBO.height<i&&this.binsFBO.resize({width:n,height:i}):this.binsFBO=vh(this.device,n,i);const A={binIdRange:[t[0][0],t[0][1],((l=t[1])==null?void 0:l[0])||0,((h=t[1])==null?void 0:h[1])||0],targetSize:[this.binsFBO.width,this.binsFBO.height]};this.model.shaderInputs.setProps({binSorter:A})}setModelProps(e){const t=this.model;e.attributes&&t.setAttributes(e.attributes),e.constantAttributes&&t.setConstantAttributes(e.constantAttributes),e.vertexCount!==void 0&&t.setVertexCount(e.vertexCount),e.shaderModuleProps&&t.shaderInputs.setProps(e.shaderModuleProps)}update(e){if(!this.binsFBO)return;const t=$_(e);this._updateBins("SUM",t.SUM+t.MEAN),this._updateBins("MIN",t.MIN),this._updateBins("MAX",t.MAX)}_updateBins(e,t){if(t===0)return;t|=Ih[3];const n=this.model,i=this.binsFBO,A=e==="MAX"?-3e38:e==="MIN"?W_:0,l=this.device.beginRenderPass({id:`gpu-aggregation-${e}`,framebuffer:i,parameters:{viewport:[0,0,i.width,i.height],colorMask:t},clearColor:[A,A,A,0],clearDepth:!1,clearStencil:!1});n.setParameters({blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",blendColorOperation:e==="MAX"?"max":e==="MIN"?"min":"add",blendAlphaOperation:"add"}),n.draw(l),l.end()}}function $_(s){const e={...X_};for(let t=0;t<s.length;t++){const n=s[t];n&&(e[n]+=Ih[t])}return e}function Z_(s,e){let t=e.vs;e.dimensions===2&&(t+=`
void getBin(out int binId) {
  ivec2 binId2;
  getBin(binId2);
  if (binId2.x < binSorter.binIdRange.x || binId2.x >= binSorter.binIdRange.y) {
    binId = -1;
  } else {
    binId = (binId2.y - binSorter.binIdRange.z) * (binSorter.binIdRange.y - binSorter.binIdRange.x) + binId2.x;
  }
}
`);const n=`#version 300 es
#define SHADER_NAME gpu-aggregation-sort-bins-vertex

${t}

out vec3 v_Value;

void main() {
  int binIndex;
  getBin(binIndex);
  binIndex = binIndex - binSorter.binIdRange.x;
  if (binIndex < 0) {
    gl_Position = vec4(0.);
    return;
  }
  int row = binIndex / binSorter.targetSize.x;
  int col = binIndex - row * binSorter.targetSize.x;
  vec2 position = (vec2(col, row) + 0.5) / vec2(binSorter.targetSize) * 2.0 - 1.0;
  gl_Position = vec4(position, 0.0, 1.0);
  gl_PointSize = 1.0;

#if NUM_CHANNELS == 3
  getValue(v_Value);
#elif NUM_CHANNELS == 2
  getValue(v_Value.xy);
#else
  getValue(v_Value.x);
#endif
}
`,i=`#version 300 es
#define SHADER_NAME gpu-aggregation-sort-bins-fragment

precision highp float;

in vec3 v_Value;
out vec4 fragColor;

void main() {
  fragColor.xyz = v_Value;

  #ifdef MODULE_GEOMETRY
  geometry.uv = vec2(0.);
  DECKGL_FILTER_COLOR(fragColor, geometry);
  #endif

  fragColor.w = 1.0;
}
`;return new Ct(s,{bufferLayout:e.bufferLayout,modules:[...e.modules||[],K_],defines:{...e.defines,NON_INSTANCED_MODEL:1,NUM_CHANNELS:e.channelCount},isInstanced:!1,vs:n,fs:i,topology:"point-list",disableWarnings:!0})}const q_=`uniform aggregatorTransformUniforms {
  ivec4 binIdRange;
  bvec3 isCount;
  bvec3 isMean;
  float naN;
} aggregatorTransform;
`,ey={name:"aggregatorTransform",vs:q_,uniformTypes:{binIdRange:"vec4<i32>",isCount:"vec3<f32>",isMean:"vec3<f32>"}};class ty{constructor(e,t){this.binBuffer=null,this.valueBuffer=null,this._domains=null,this.device=e,this.channelCount=t.channelCount,this.transform=ny(e,t),this.domainFBO=vh(e,2,1)}destroy(){var e,t;this.transform.destroy(),(e=this.binBuffer)==null||e.destroy(),(t=this.valueBuffer)==null||t.destroy(),this.domainFBO.colorAttachments[0].texture.destroy(),this.domainFBO.destroy()}get domains(){if(!this._domains){const e=this.device.readPixelsToArrayWebGL(this.domainFBO).buffer,t=new Float32Array(e);this._domains=[[-t[4],t[0]],[-t[5],t[1]],[-t[6],t[2]]].slice(0,this.channelCount)}return this._domains}setDimensions(e,t){var g,B,C,y;const{model:n,transformFeedback:i}=this.transform;n.setVertexCount(e);const A={binIdRange:[t[0][0],t[0][1],((g=t[1])==null?void 0:g[0])||0,((B=t[1])==null?void 0:B[1])||0]};n.shaderInputs.setProps({aggregatorTransform:A});const l=e*t.length*4;(!this.binBuffer||this.binBuffer.byteLength<l)&&((C=this.binBuffer)==null||C.destroy(),this.binBuffer=this.device.createBuffer({byteLength:l}),i.setBuffer("binIds",this.binBuffer));const h=e*this.channelCount*4;(!this.valueBuffer||this.valueBuffer.byteLength<h)&&((y=this.valueBuffer)==null||y.destroy(),this.valueBuffer=this.device.createBuffer({byteLength:h}),i.setBuffer("values",this.valueBuffer))}update(e,t){if(!e)return;const n=this.transform,i=this.domainFBO,A=[0,1,2].map(g=>t[g]==="COUNT"?1:0),l=[0,1,2].map(g=>t[g]==="MEAN"?1:0),h={isCount:A,isMean:l,bins:e};n.model.shaderInputs.setProps({aggregatorTransform:h}),n.run({id:"gpu-aggregation-domain",framebuffer:i,parameters:{viewport:[0,0,2,1]},clearColor:[-3e38,-3e38,-3e38,0],clearDepth:!1,clearStencil:!1}),this._domains=null}}function ny(s,e){const t=`#version 300 es
#define SHADER_NAME gpu-aggregation-domain-vertex

uniform sampler2D bins;

#if NUM_DIMS == 1
out float binIds;
#else
out vec2 binIds;
#endif

#if NUM_CHANNELS == 1
flat out float values;
#elif NUM_CHANNELS == 2
flat out vec2 values;
#else
flat out vec3 values;
#endif

const float NAN = intBitsToFloat(-1);

void main() {
  int row = gl_VertexID / SAMPLER_WIDTH;
  int col = gl_VertexID - row * SAMPLER_WIDTH;
  vec4 weights = texelFetch(bins, ivec2(col, row), 0);
  vec3 value3 = mix(
    mix(weights.rgb, vec3(weights.a), aggregatorTransform.isCount),
    weights.rgb / max(weights.a, 1.0),
    aggregatorTransform.isMean
  );
  if (weights.a == 0.0) {
    value3 = vec3(NAN);
  }

#if NUM_DIMS == 1
  binIds = float(gl_VertexID + aggregatorTransform.binIdRange.x);
#else
  int y = gl_VertexID / (aggregatorTransform.binIdRange.y - aggregatorTransform.binIdRange.x);
  int x = gl_VertexID - y * (aggregatorTransform.binIdRange.y - aggregatorTransform.binIdRange.x);
  binIds.y = float(y + aggregatorTransform.binIdRange.z);
  binIds.x = float(x + aggregatorTransform.binIdRange.x);
#endif

#if NUM_CHANNELS == 3
  values = value3;
#elif NUM_CHANNELS == 2
  values = value3.xy;
#else
  values = value3.x;
#endif

  gl_Position = vec4(0., 0., 0., 1.);
  // This model renders into a 2x1 texture to obtain min and max simultaneously.
  // See comments in fragment shader
  gl_PointSize = 2.0;
}
`,n=`#version 300 es
#define SHADER_NAME gpu-aggregation-domain-fragment

precision highp float;

#if NUM_CHANNELS == 1
flat in float values;
#elif NUM_CHANNELS == 2
flat in vec2 values;
#else
flat in vec3 values;
#endif

out vec4 fragColor;

void main() {
  vec3 value3;
#if NUM_CHANNELS == 3
  value3 = values;
#elif NUM_CHANNELS == 2
  value3.xy = values;
#else
  value3.x = values;
#endif
  if (isnan(value3.x)) discard;
  // This shader renders into a 2x1 texture with blending=max
  // The left pixel yields the max value of each channel
  // The right pixel yields the min value of each channel
  if (gl_FragCoord.x < 1.0) {
    fragColor = vec4(value3, 1.0);
  } else {
    fragColor = vec4(-value3, 1.0);
  }
}
`;return new r1(s,{vs:t,fs:n,topology:"point-list",modules:[ey],parameters:{blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one",blendColorOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",blendAlphaOperation:"max"},defines:{NUM_DIMS:e.dimensions,NUM_CHANNELS:e.channelCount,SAMPLER_WIDTH:TA},varyings:["binIds","values"],disableWarnings:!0})}class cn{static isSupported(e){return e.features.has("float32-renderable-webgl")&&e.features.has("texture-blend-float-webgl")}constructor(e,t){this.binCount=0,this.binIds=null,this.results=[],this.device=e,this.dimensions=t.dimensions,this.channelCount=t.channelCount,this.props={...t,pointCount:0,binIdRange:[[0,0]],operations:[],attributes:{},binOptions:{}},this.needsUpdate=new Array(this.channelCount).fill(!0),this.binSorter=new Y_(e,t),this.aggregationTransform=new ty(e,t),this.setProps(t)}getBins(){var t;const e=this.aggregationTransform.binBuffer;return e?(((t=this.binIds)==null?void 0:t.buffer)!==e&&(this.binIds={buffer:e,type:"float32",size:this.dimensions}),this.binIds):null}getResult(e){var n;const t=this.aggregationTransform.valueBuffer;return!t||e>=this.channelCount?null:(((n=this.results[e])==null?void 0:n.buffer)!==t&&(this.results[e]={buffer:t,type:"float32",size:1,stride:this.channelCount*4,offset:e*4}),this.results[e])}getResultDomain(e){return this.aggregationTransform.domains[e]}getBin(e){if(e<0||e>=this.binCount)return null;const{binIdRange:t}=this.props;let n;if(this.dimensions===1)n=[e+t[0][0]];else{const[[h,g],[B]]=t,C=g-h;n=[e%C+h,Math.floor(e/C)+B]}const i=this.binSorter.getBinValues(e);if(!i)return null;const A=i[3],l=[];for(let h=0;h<this.channelCount;h++){const g=this.props.operations[h];g==="COUNT"?l[h]=A:A===0?l[h]=NaN:l[h]=g==="MEAN"?i[h]/A:i[h]}return{id:n,value:l,count:A}}destroy(){this.binSorter.destroy(),this.aggregationTransform.destroy()}setProps(e){const t=this.props;if("binIdRange"in e&&!wn(e.binIdRange,t.binIdRange,2)){const n=e.binIdRange;if(at.assert(n.length===this.dimensions),this.dimensions===1){const[[i,A]]=n;this.binCount=A-i}else{const[[i,A],[l,h]]=n;this.binCount=(A-i)*(h-l)}this.binSorter.setDimensions(this.binCount,n),this.aggregationTransform.setDimensions(this.binCount,n),this.setNeedsUpdate()}if(e.operations)for(let n=0;n<this.channelCount;n++)e.operations[n]!==t.operations[n]&&this.setNeedsUpdate(n);if(e.pointCount!==void 0&&e.pointCount!==t.pointCount&&(this.binSorter.setModelProps({vertexCount:e.pointCount}),this.setNeedsUpdate()),e.binOptions&&(wn(e.binOptions,t.binOptions,2)||this.setNeedsUpdate(),this.binSorter.model.shaderInputs.setProps({binOptions:e.binOptions})),e.attributes){const n={},i={};for(const A of Object.values(e.attributes))for(const[l,h]of Object.entries(A.getValue()))ArrayBuffer.isView(h)?i[l]=h:h&&(n[l]=h);this.binSorter.setModelProps({attributes:n,constantAttributes:i})}e.shaderModuleProps&&this.binSorter.setModelProps({shaderModuleProps:e.shaderModuleProps}),Object.assign(this.props,e)}setNeedsUpdate(e){e===void 0?this.needsUpdate.fill(!0):this.needsUpdate[e]=!0}update(){}preDraw(){var n,i;if(!this.needsUpdate.some(Boolean))return;const{operations:e}=this.props,t=this.needsUpdate.map((A,l)=>A?e[l]:null);this.binSorter.update(t),this.aggregationTransform.update(this.binSorter.texture,e);for(let A=0;A<this.channelCount;A++)this.needsUpdate[A]&&(this.needsUpdate[A]=!1,(i=(n=this.props).onUpdate)==null||i.call(n,{channel:A}))}}let Ri=class extends xn{get isDrawable(){return!0}initializeState(){this.getAttributeManager().remove(["instancePickingColors"])}updateState(e){var n,i;super.updateState(e);const t=this.getAggregatorType();if(e.changeFlags.extensionsChanged||this.state.aggregatorType!==t){(n=this.state.aggregator)==null||n.destroy();const A=this.createAggregator(t);return A.setProps({attributes:(i=this.getAttributeManager())==null?void 0:i.attributes}),this.setState({aggregator:A,aggregatorType:t}),!0}return!1}finalizeState(e){super.finalizeState(e),this.state.aggregator.destroy()}updateAttributes(e){const{aggregator:t}=this.state;t.setProps({attributes:e});for(const n in e)this.onAttributeChange(n);t.update()}draw({shaderModuleProps:e}){const{aggregator:t}=this.state;t.setProps({shaderModuleProps:e}),t.preDraw()}_getAttributeManager(){return new Ba(this.context.device,{id:this.props.id,stats:this.context.stats})}};Ri.layerName="AggregationLayer";const or=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function Mh(s,e=!1,t=Float32Array){let n;if(Number.isFinite(s[0]))n=new t(s);else{n=new t(s.length*4);let i=0;for(let A=0;A<s.length;A++){const l=s[A];n[i++]=l[0],n[i++]=l[1],n[i++]=l[2],n[i++]=Number.isFinite(l[3])?l[3]:255}}if(e)for(let i=0;i<n.length;i++)n[i]/=255;return n}const HA={linear:"linear",quantile:"nearest",quantize:"nearest",ordinal:"nearest"};function La(s,e){s.setSampler({minFilter:HA[e],magFilter:HA[e]})}function Ra(s,e,t="linear"){const n=Mh(e,!1,Uint8Array);return s.createTexture({format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:HA[t],magFilter:HA[t],addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},data:n,width:n.length/4,height:1})}const sy=`#version 300 es
#define SHADER_NAME screen-grid-layer-vertex-shader
#define RANGE_COUNT 6
in vec2 positions;
in vec2 instancePositions;
in float instanceWeights;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
if (isnan(instanceWeights)) {
gl_Position = vec4(0.);
return;
}
vec2 pos = instancePositions * screenGrid.gridSizeClipspace + positions * screenGrid.cellSizeClipspace;
pos.x = pos.x - 1.0;
pos.y = 1.0 - pos.y;
gl_Position = vec4(pos, 0., 1.);
vColor = interp(instanceWeights, screenGrid.colorDomain, colorRange);
vColor.a *= layer.opacity;
picking_setPickingColor(instancePickingColors);
}
`,iy=`#version 300 es
#define SHADER_NAME screen-grid-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Ay=`uniform screenGridUniforms {
  vec2 cellSizeClipspace;
  vec2 gridSizeClipspace;
  vec2 colorDomain;
} screenGrid;
`,ry={name:"screenGrid",vs:Ay,uniformTypes:{cellSizeClipspace:"vec2<f32>",gridSizeClipspace:"vec2<f32>",colorDomain:"vec2<f32>"}};class wh extends sn{getShaders(){return super.getShaders({vs:sy,fs:iy,modules:[fn,ry]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceWeights:{size:1,type:"float32",accessor:"getWeight"}}),this.state.model=this._getModel()}updateState(e){var l;super.updateState(e);const{props:t,oldProps:n,changeFlags:i}=e,A=this.state.model;if(n.colorRange!==t.colorRange){(l=this.state.colorTexture)==null||l.destroy(),this.state.colorTexture=Ra(this.context.device,t.colorRange,t.colorScaleType);const h={colorRange:this.state.colorTexture};A.shaderInputs.setProps({screenGrid:h})}else n.colorScaleType!==t.colorScaleType&&La(this.state.colorTexture,t.colorScaleType);if(n.cellMarginPixels!==t.cellMarginPixels||n.cellSizePixels!==t.cellSizePixels||i.viewportChanged){const{width:h,height:g}=this.context.viewport,{cellSizePixels:B,cellMarginPixels:C}=this.props,y=Math.max(B-C,0),E={gridSizeClipspace:[B/h*2,B/g*2],cellSizeClipspace:[y/h*2,y/g*2]};A.shaderInputs.setProps({screenGrid:E})}}finalizeState(e){var t;super.finalizeState(e),(t=this.state.colorTexture)==null||t.destroy()}draw({uniforms:e}){const t=this.props.colorDomain(),n=this.state.model,i={colorDomain:t};n.shaderInputs.setProps({screenGrid:i}),n.draw(this.context.renderPass)}_getModel(){return new Ct(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Ht({topology:"triangle-strip",attributes:{positions:{value:new Float32Array([0,0,1,0,0,1,1,1]),size:2}}}),isInstanced:!0})}}wh.layerName="ScreenGridCellLayer";const oy=`uniform binOptionsUniforms {
  float cellSizePixels;
} binOptions;
`,ay={name:"binOptions",vs:oy,uniformTypes:{cellSizePixels:"f32"}},cy={cellSizePixels:{type:"number",value:100,min:1},cellMarginPixels:{type:"number",value:2,min:0},colorRange:or,colorScaleType:"linear",getPosition:{type:"accessor",value:s=>s.position},getWeight:{type:"accessor",value:1},gpuAggregation:!0,aggregation:"SUM"};class Sh extends Ri{getAggregatorType(){return this.props.gpuAggregation&&cn.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){return e==="cpu"||!cn.isSupported(this.context.device)?new Li({dimensions:2,getBin:{sources:["positions"],getValue:({positions:t},n,i)=>{const A=this.context.viewport,l=A.project(t),h=i.cellSizePixels;return l[0]<0||l[0]>=A.width||l[1]<0||l[1]>=A.height?null:[Math.floor(l[0]/h),Math.floor(l[1]/h)]}},getValue:[{sources:["counts"],getValue:({counts:t})=>t}]}):new cn(this.context.device,{dimensions:2,channelCount:1,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[St,ay],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float counts;
  
  void getBin(out ivec2 binId) {
    vec4 pos = project_position_to_clipspace(positions, positions64Low, vec3(0.0));
    vec2 screenCoords = vec2(pos.x / pos.w + 1.0, 1.0 - pos.y / pos.w) / 2.0 * project.viewportSize / project.devicePixelRatio;
    vec2 gridCoords = floor(screenCoords / binOptions.cellSizePixels);
    binId = ivec2(gridCoords);
  }
  void getValue(out float weight) {
    weight = counts;
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},counts:{size:1,accessor:"getWeight"}})}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState(e){const t=super.updateState(e),{props:n,oldProps:i,changeFlags:A}=e,{cellSizePixels:l,aggregation:h}=n;if(t||A.dataChanged||A.updateTriggersChanged||A.viewportChanged||h!==i.aggregation||l!==i.cellSizePixels){const{width:g,height:B}=this.context.viewport,{aggregator:C}=this.state;C instanceof cn&&C.setProps({binIdRange:[[0,Math.ceil(g/l)],[0,Math.ceil(B/l)]]}),C.setProps({pointCount:this.getNumInstances(),operations:[h],binOptions:{cellSizePixels:l}})}return A.viewportChanged&&this.state.aggregator.setNeedsUpdate(),t}onAttributeChange(e){const{aggregator:t}=this.state;switch(e){case"positions":t.setNeedsUpdate();break;case"counts":t.setNeedsUpdate(0);break}}renderLayers(){const{aggregator:e}=this.state,t=this.getSubLayerClass("cells",wh),n=e.getBins(),i=e.getResult(0);return new t(this.props,this.getSubLayerProps({id:"cell-layer"}),{data:{length:e.binCount,attributes:{getBin:n,getWeight:i}},dataComparator:(A,l)=>A.length===l.length,updateTriggers:{getBin:[n],getWeight:[i]},parameters:{depthWriteEnabled:!1,...this.props.parameters},colorDomain:()=>this.props.colorDomain||e.getResultDomain(0),extensions:[]})}getPickingInfo(e){const t=e.info,{index:n}=t;if(n>=0){const i=this.state.aggregator.getBin(n);let A;i&&(A={col:i.id[0],row:i.id[1],value:i.value[0],count:i.count},i.pointIndices&&(A.pointIndices=i.pointIndices,A.points=Array.isArray(this.props.data)?i.pointIndices.map(l=>this.props.data[l]):[])),t.object=A}return t}}Sh.layerName="ScreenGridLayer";Sh.defaultProps=cy;class kA{constructor(e,t){this.props={scaleType:"linear",lowerPercentile:0,upperPercentile:100},this.domain=null,this.cutoff=null,this.input=e,this.inputLength=t,this.attribute=e}getScalePercentile(){if(!this._percentile){const e=$l(this.input,this.inputLength);this._percentile=uy(e)}return this._percentile}getScaleOrdinal(){if(!this._ordinal){const e=$l(this.input,this.inputLength);this._ordinal=ly(e)}return this._ordinal}getCutoff({scaleType:e,lowerPercentile:t,upperPercentile:n}){if(e==="quantile")return[t,n-1];if(t>0||n<100){const{domain:i}=this.getScalePercentile();let A=i[Math.floor(t)-1]??-1/0,l=i[Math.floor(n)-1]??1/0;if(e==="ordinal"){const{domain:h}=this.getScaleOrdinal();A=h.findIndex(g=>g>=A),l=h.findIndex(g=>g>l)-1,l===-2&&(l=h.length-1)}return[A,l]}return null}update(e){const t=this.props;if(e.scaleType!==t.scaleType)switch(e.scaleType){case"quantile":{const{attribute:n}=this.getScalePercentile();this.attribute=n,this.domain=[0,99];break}case"ordinal":{const{attribute:n,domain:i}=this.getScaleOrdinal();this.attribute=n,this.domain=[0,i.length-1];break}default:this.attribute=this.input,this.domain=null}return(e.scaleType!==t.scaleType||e.lowerPercentile!==t.lowerPercentile||e.upperPercentile!==t.upperPercentile)&&(this.cutoff=this.getCutoff(e)),this.props=e,this}}function ly(s){const e=new Set;for(const i of s)Number.isFinite(i)&&e.add(i);const t=Array.from(e).sort(),n=new Map;for(let i=0;i<t.length;i++)n.set(t[i],i);return{attribute:{value:s.map(i=>Number.isFinite(i)?n.get(i):NaN),type:"float32",size:1},domain:t}}function uy(s,e=100){const t=Array.from(s).filter(Number.isFinite).sort(fy);let n=0;const i=Math.max(1,e),A=new Array(i-1);for(;++n<i;)A[n-1]=hy(t,n/i);return{attribute:{value:s.map(l=>Number.isFinite(l)?dy(A,l):NaN),type:"float32",size:1},domain:A}}function $l(s,e){var l;const t=(s.stride??4)/4,n=(s.offset??0)/4;let i=s.value;if(!i){const h=(l=s.buffer)==null?void 0:l.readSyncWebGL(0,t*4*e);h&&(i=new Float32Array(h.buffer),s.value=i)}if(t===1)return i.subarray(0,e);const A=new Float32Array(e);for(let h=0;h<e;h++)A[h]=i[h*t+n];return A}function fy(s,e){return s-e}function hy(s,e){const t=s.length;if(e<=0||t<2)return s[0];if(e>=1)return s[t-1];const n=(t-1)*e,i=Math.floor(n),A=s[i],l=s[i+1];return A+(l-A)*(n-i)}function dy(s,e){let t=0,n=s.length;for(;t<n;){const i=t+n>>>1;s[i]>e?n=i:t=i+1}return t}function Oa({dataBounds:s,getBinId:e,padding:t=0}){const n=[s[0],s[1],[s[0][0],s[1][1]],[s[1][0],s[0][1]]].map(g=>e(g)),i=Math.min(...n.map(g=>g[0]))-t,A=Math.min(...n.map(g=>g[1]))-t,l=Math.max(...n.map(g=>g[0]))+t+1,h=Math.max(...n.map(g=>g[1]))+t+1;return[[i,l],[A,h]]}const xh=Math.PI/3,ar=2*Math.sin(xh),cr=1.5,gy=Array.from({length:6},(s,e)=>{const t=e*xh;return[Math.sin(t),-Math.cos(t)]});function oo([s,e],t){let n=Math.round(e=e/t/cr),i=Math.round(s=s/t/ar-(n&1)/2);const A=e-n;if(Math.abs(A)*3>1){const l=s-i,h=i+(s<i?-1:1)/2,g=n+(e<n?-1:1),B=s-h,C=e-g;l*l+A*A>B*B+C*C&&(i=h+(n&1?1:-1)/2,n=g)}return[i,n]}const py=`
const vec2 DIST = vec2(${ar}, ${cr});

ivec2 pointToHexbin(vec2 p, float radius) {
  p /= radius * DIST;
  float pj = round(p.y);
  float pjm2 = mod(pj, 2.0);
  p.x -= pjm2 * 0.5;
  float pi = round(p.x);
  vec2 d1 = p - vec2(pi, pj);

  if (abs(d1.y) * 3. > 1.) {
    vec2 v2 = step(0.0, d1) - 0.5;
    v2.y *= 2.0;
    vec2 d2 = d1 - v2;
    if (dot(d1, d1) > dot(d2, d2)) {
      pi += v2.x + pjm2 - 0.5;
      pj += v2.y;
    }
  }
  return ivec2(pi, pj);
}
`;function Zl([s,e],t){return[(s+(e&1)/2)*t*ar,e*t*cr]}const my=`
const vec2 DIST = vec2(${ar}, ${cr});

vec2 hexbinCentroid(vec2 binId, float radius) {
  binId.x += fract(binId.y * 0.5);
  return binId * DIST * radius;
}
`,By=`#version 300 es
#define SHADER_NAME hexagon-cell-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec2 instancePositions;
in float instanceElevationValues;
in float instanceColorValues;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
${my}
float interp(float value, vec2 domain, vec2 range) {
float r = min(max((value - domain.x) / (domain.y - domain.x), 0.), 1.);
return mix(range.x, range.y, r);
}
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
geometry.pickingColor = instancePickingColors;
if (isnan(instanceColorValues) ||
instanceColorValues < hexagon.colorDomain.z ||
instanceColorValues > hexagon.colorDomain.w ||
instanceElevationValues < hexagon.elevationDomain.z ||
instanceElevationValues > hexagon.elevationDomain.w
) {
gl_Position = vec4(0.);
return;
}
vec2 commonPosition = hexbinCentroid(instancePositions, column.radius) + (hexagon.originCommon - project.commonOrigin.xy);
commonPosition += positions.xy * column.radius * column.coverage;
geometry.position = vec4(commonPosition, 0.0, 1.0);
geometry.normal = project_normal(normals);
float elevation = 0.0;
if (column.extruded) {
elevation = interp(instanceElevationValues, hexagon.elevationDomain.xy, hexagon.elevationRange);
elevation = project_size(elevation);
geometry.position.z = (positions.z + 1.0) / 2.0 * elevation;
}
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vColor = interp(instanceColorValues, hexagon.colorDomain.xy, colorRange);
vColor.a *= layer.opacity;
if (column.extruded) {
vColor.rgb = lighting_getLightColor(vColor.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Cy=`uniform hexagonUniforms {
  vec4 colorDomain;
  vec4 elevationDomain;
  vec2 elevationRange;
  vec2 originCommon;
} hexagon;
`,_y={name:"hexagon",vs:Cy,uniformTypes:{colorDomain:"vec4<f32>",elevationDomain:"vec4<f32>",elevationRange:"vec2<f32>",originCommon:"vec2<f32>"}};class Dh extends ni{getShaders(){const e=super.getShaders();return e.modules.push(_y),{...e,vs:By}}initializeState(){super.initializeState();const e=this.getAttributeManager();e.remove(["instanceElevations","instanceFillColors","instanceLineColors","instanceStrokeWidths"]),e.addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceColorValues:{size:1,type:"float32",accessor:"getColorValue"},instanceElevationValues:{size:1,type:"float32",accessor:"getElevationValue"}})}updateState(e){var A;super.updateState(e);const{props:t,oldProps:n}=e,i=this.state.fillModel;if(n.colorRange!==t.colorRange){(A=this.state.colorTexture)==null||A.destroy(),this.state.colorTexture=Ra(this.context.device,t.colorRange,t.colorScaleType);const l={colorRange:this.state.colorTexture};i.shaderInputs.setProps({hexagon:l})}else n.colorScaleType!==t.colorScaleType&&La(this.state.colorTexture,t.colorScaleType)}finalizeState(e){var t;super.finalizeState(e),(t=this.state.colorTexture)==null||t.destroy()}draw({uniforms:e}){const{radius:t,hexOriginCommon:n,elevationRange:i,elevationScale:A,extruded:l,coverage:h,colorDomain:g,elevationDomain:B}=this.props,C=this.props.colorCutoff||[-1/0,1/0],y=this.props.elevationCutoff||[-1/0,1/0],E=this.state.fillModel;E.vertexArray.indexBuffer&&E.setIndexBuffer(null),E.setVertexCount(this.state.fillVertexCount);const T={colorDomain:[Math.max(g[0],C[0]),Math.min(g[1],C[1]),Math.max(g[0]-1,C[0]),Math.min(g[1]+1,C[1])],elevationDomain:[Math.max(B[0],y[0]),Math.min(B[1],y[1]),Math.max(B[0]-1,y[0]),Math.min(B[1]+1,y[1])],elevationRange:[i[0]*A,i[1]*A],originCommon:n};E.shaderInputs.setProps({column:{extruded:l,coverage:h,radius:t},hexagon:T}),E.draw(this.context.renderPass)}}Dh.layerName="HexagonCellLayer";const yy=`uniform binOptionsUniforms {
  vec2 hexOriginCommon;
  float radiusCommon;
} binOptions;
`,by={name:"binOptions",vs:yy,uniformTypes:{hexOriginCommon:"vec2<f32>",radiusCommon:"f32"}};function ql(){}const Ey={gpuAggregation:!0,colorDomain:null,colorRange:or,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:ql,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScaleType:"linear",onSetElevationDomain:ql,radius:{type:"number",min:1,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:s=>s.position},hexagonAggregator:{type:"function",optional:!0,value:null},extruded:!1,material:!0};class Ph extends Ri{getAggregatorType(){const{gpuAggregation:e,hexagonAggregator:t,getColorValue:n,getElevationValue:i}=this.props;return e&&(t||n||i)?(at.warn("Features not supported by GPU aggregation, falling back to CPU")(),"cpu"):e&&cn.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){if(e==="cpu"){const{hexagonAggregator:t,radius:n}=this.props;return new Li({dimensions:2,getBin:{sources:["positions"],getValue:({positions:i},A,l)=>{if(t)return t(i,n);const g=this.state.aggregatorViewport.projectPosition(i),{radiusCommon:B,hexOriginCommon:C}=l;return oo([g[0]-C[0],g[1]-C[1]],B)}},getValue:[{sources:["colorWeights"],getValue:({colorWeights:i})=>i},{sources:["elevationWeights"],getValue:({elevationWeights:i})=>i}]})}return new cn(this.context.device,{dimensions:2,channelCount:2,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[St,by],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float colorWeights;
  in float elevationWeights;
  
  ${py}

  void getBin(out ivec2 binId) {
    vec3 positionCommon = project_position(positions, positions64Low);
    binId = pointToHexbin(positionCommon.xy, binOptions.radiusCommon);
  }
  void getValue(out vec2 value) {
    value = vec2(colorWeights, elevationWeights);
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},colorWeights:{size:1,accessor:"getColorWeight"},elevationWeights:{size:1,accessor:"getElevationWeight"}})}updateState(e){const t=super.updateState(e),{props:n,oldProps:i,changeFlags:A}=e,{aggregator:l}=this.state;if((A.dataChanged||!this.state.dataAsArray)&&(n.getColorValue||n.getElevationValue)&&(this.state.dataAsArray=Array.from(cs(n.data).iterable)),t||A.dataChanged||n.radius!==i.radius||n.getColorValue!==i.getColorValue||n.getElevationValue!==i.getElevationValue||n.colorAggregation!==i.colorAggregation||n.elevationAggregation!==i.elevationAggregation){this._updateBinOptions();const{radiusCommon:h,hexOriginCommon:g,binIdRange:B,dataAsArray:C}=this.state;if(l.setProps({binIdRange:B,pointCount:this.getNumInstances(),operations:[n.colorAggregation,n.elevationAggregation],binOptions:{radiusCommon:h,hexOriginCommon:g},onUpdate:this._onAggregationUpdate.bind(this)}),C){const{getColorValue:y,getElevationValue:E}=this.props;l.setProps({customOperations:[y&&(T=>y(T.map(x=>C[x]),{indices:T,data:n.data})),E&&(T=>E(T.map(x=>C[x]),{indices:T,data:n.data}))]})}}return A.updateTriggersChanged&&A.updateTriggersChanged.getColorValue&&l.setNeedsUpdate(0),A.updateTriggersChanged&&A.updateTriggersChanged.getElevationValue&&l.setNeedsUpdate(1),t}_updateBinOptions(){const e=this.getBounds();let t=1,n=[0,0],i=[[0,1],[0,1]],A=this.context.viewport;if(e&&Number.isFinite(e[0][0])){let l=[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2];const{radius:h}=this.props,{unitsPerMeter:g}=A.getDistanceScales(l);t=g[0]*h;const B=oo(A.projectFlat(l),t);l=A.unprojectFlat(Zl(B,t));const C=A.constructor;A=A.isGeospatial?new C({longitude:l[0],latitude:l[1],zoom:12}):new as({position:[l[0],l[1],0],zoom:12}),n=[Math.fround(A.center[0]),Math.fround(A.center[1])],i=Oa({dataBounds:e,getBinId:y=>{const E=A.projectFlat(y);return E[0]-=n[0],E[1]-=n[1],oo(E,t)},padding:1})}this.setState({radiusCommon:t,hexOriginCommon:n,binIdRange:i,aggregatorViewport:A})}draw(e){e.shaderModuleProps.project&&(e.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(e)}_onAggregationUpdate({channel:e}){const t=this.getCurrentLayer().props,{aggregator:n}=this.state;if(e===0){const i=n.getResult(0);this.setState({colors:new kA(i,n.binCount)}),t.onSetColorDomain(n.getResultDomain(0))}else if(e===1){const i=n.getResult(1);this.setState({elevations:new kA(i,n.binCount)}),t.onSetElevationDomain(n.getResultDomain(1))}}onAttributeChange(e){const{aggregator:t}=this.state;switch(e){case"positions":t.setNeedsUpdate(),this._updateBinOptions();const{radiusCommon:n,hexOriginCommon:i,binIdRange:A}=this.state;t.setProps({binIdRange:A,binOptions:{radiusCommon:n,hexOriginCommon:i}});break;case"colorWeights":t.setNeedsUpdate(0);break;case"elevationWeights":t.setNeedsUpdate(1);break}}renderLayers(){var Te,ge;const{aggregator:e,radiusCommon:t,hexOriginCommon:n}=this.state,{elevationScale:i,colorRange:A,elevationRange:l,extruded:h,coverage:g,material:B,transitions:C,colorScaleType:y,lowerPercentile:E,upperPercentile:T,colorDomain:x,elevationScaleType:F,elevationLowerPercentile:N,elevationUpperPercentile:R,elevationDomain:Q}=this.props,Y=this.getSubLayerClass("cells",Dh),se=e.getBins(),re=(Te=this.state.colors)==null?void 0:Te.update({scaleType:y,lowerPercentile:E,upperPercentile:T}),ue=(ge=this.state.elevations)==null?void 0:ge.update({scaleType:F,lowerPercentile:N,upperPercentile:R});return!re||!ue?null:new Y(this.getSubLayerProps({id:"cells"}),{data:{length:e.binCount,attributes:{getBin:se,getColorValue:re.attribute,getElevationValue:ue.attribute}},dataComparator:($,K)=>$.length===K.length,updateTriggers:{getBin:[se],getColorValue:[re.attribute],getElevationValue:[ue.attribute]},diskResolution:6,vertices:gy,radius:t,hexOriginCommon:n,elevationScale:i,colorRange:A,colorScaleType:y,elevationRange:l,extruded:h,coverage:g,material:B,colorDomain:re.domain||x||e.getResultDomain(0),elevationDomain:ue.domain||Q||e.getResultDomain(1),colorCutoff:re.cutoff,elevationCutoff:ue.cutoff,transitions:C&&{getFillColor:C.getColorValue||C.getColorWeight,getElevation:C.getElevationValue||C.getElevationWeight},extensions:[]})}getPickingInfo(e){const t=e.info,{index:n}=t;if(n>=0){const i=this.state.aggregator.getBin(n);let A;if(i){const l=Zl(i.id,this.state.radiusCommon),h=this.context.viewport.unprojectFlat(l);A={col:i.id[0],row:i.id[1],position:h,colorValue:i.value[0],elevationValue:i.value[1],count:i.count},i.pointIndices&&(A.pointIndices=i.pointIndices,A.points=Array.isArray(this.props.data)?i.pointIndices.map(g=>this.props.data[g]):[])}t.object=A}return t}}Ph.layerName="HexagonLayer";Ph.defaultProps=Ey;const xe=.5,Oe=1/6,V={N:[0,xe],E:[xe,0],S:[0,-.5],W:[-.5,0],NE:[xe,xe],NW:[-.5,xe],SE:[xe,-.5],SW:[-.5,-.5]},Cs=[V.W,V.SW,V.S],_s=[V.S,V.SE,V.E],ys=[V.E,V.NE,V.N],bs=[V.NW,V.W,V.N],Es=[[-.5,Oe],[-.5,-.16666666666666666],[-.16666666666666666,-.5],[Oe,-.5]],Ts=[[-.16666666666666666,-.5],[Oe,-.5],[xe,-.16666666666666666],[xe,Oe]],vs=[[xe,-.16666666666666666],[xe,Oe],[Oe,xe],[-.16666666666666666,xe]],Is=[[-.5,Oe],[-.5,-.16666666666666666],[Oe,xe],[-.16666666666666666,xe]],e0=[V.W,V.SW,V.SE,V.E],t0=[V.S,V.SE,V.NE,V.N],n0=[V.NW,V.W,V.E,V.NE],s0=[V.NW,V.SW,V.S,V.N],i0=[[-.5,Oe],[-.5,-.16666666666666666],[xe,-.16666666666666666],[xe,Oe]],A0=[[-.16666666666666666,-.5],[Oe,-.5],[Oe,xe],[-.16666666666666666,xe]],Ty=[V.NW,V.SW,V.SE,V.NE],r0=[V.NW,V.SW,V.SE,V.E,V.N],o0=[V.W,V.SW,V.SE,V.NE,V.N],a0=[V.NW,V.W,V.S,V.SE,V.NE],c0=[V.NW,V.SW,V.S,V.E,V.NE],l0=[V.NW,V.W,[xe,-.16666666666666666],[xe,Oe],V.N],u0=[[-.16666666666666666,-.5],[Oe,-.5],V.E,V.NE,V.N],f0=[[-.5,Oe],[-.5,-.16666666666666666],V.S,V.SE,V.E],h0=[V.W,V.SW,V.S,[Oe,xe],[-.16666666666666666,xe]],d0=[V.NW,V.W,[-.16666666666666666,-.5],[Oe,-.5],V.N],g0=[[-.5,Oe],[-.5,-.16666666666666666],V.E,V.NE,V.N],p0=[V.S,V.SE,V.E,[Oe,xe],[-.16666666666666666,xe]],m0=[V.W,V.SW,V.S,[xe,-.16666666666666666],[xe,Oe]],B0=[V.W,V.SW,V.SE,V.E,[Oe,xe],[-.16666666666666666,xe]],C0=[[-.5,Oe],[-.5,-.16666666666666666],V.S,V.SE,V.NE,V.N],_0=[V.NW,V.W,[-.16666666666666666,-.5],[Oe,-.5],V.E,V.NE],y0=[V.NW,V.SW,V.S,[xe,-.16666666666666666],[xe,Oe],V.N],Ms=[V.W,V.SW,V.S,V.E,V.NE,V.N],ws=[V.NW,V.W,V.S,V.SE,V.E,V.N],tA=[[-.5,Oe],[-.5,-.16666666666666666],[-.16666666666666666,-.5],[Oe,-.5],V.E,V.NE,V.N],nA=[V.W,V.SW,V.S,[xe,-.16666666666666666],[xe,Oe],[Oe,xe],[-.16666666666666666,xe]],sA=[V.NW,V.W,[-.16666666666666666,-.5],[Oe,-.5],[xe,-.16666666666666666],[xe,Oe],V.N],iA=[[-.5,Oe],[-.5,-.16666666666666666],V.S,V.SE,V.E,[Oe,xe],[-.16666666666666666,xe]],b0=[[-.5,Oe],[-.5,-.16666666666666666],[-.16666666666666666,-.5],[Oe,-.5],[xe,-.16666666666666666],[xe,Oe],[Oe,xe],[-.16666666666666666,xe]],vy={0:[],1:[[V.W,V.S]],2:[[V.S,V.E]],3:[[V.W,V.E]],4:[[V.N,V.E]],5:{0:[[V.W,V.S],[V.N,V.E]],1:[[V.W,V.N],[V.S,V.E]]},6:[[V.N,V.S]],7:[[V.W,V.N]],8:[[V.W,V.N]],9:[[V.N,V.S]],10:{0:[[V.W,V.N],[V.S,V.E]],1:[[V.W,V.S],[V.N,V.E]]},11:[[V.N,V.E]],12:[[V.W,V.E]],13:[[V.S,V.E]],14:[[V.W,V.S]],15:[]};function oe(s){return parseInt(s,4)}const Iy={[oe("0000")]:[],[oe("2222")]:[],[oe("2221")]:[Cs],[oe("2212")]:[_s],[oe("2122")]:[ys],[oe("1222")]:[bs],[oe("0001")]:[Cs],[oe("0010")]:[_s],[oe("0100")]:[ys],[oe("1000")]:[bs],[oe("2220")]:[Es],[oe("2202")]:[Ts],[oe("2022")]:[vs],[oe("0222")]:[Is],[oe("0002")]:[Es],[oe("0020")]:[Ts],[oe("0200")]:[vs],[oe("2000")]:[Is],[oe("0011")]:[e0],[oe("0110")]:[t0],[oe("1100")]:[n0],[oe("1001")]:[s0],[oe("2211")]:[e0],[oe("2112")]:[t0],[oe("1122")]:[n0],[oe("1221")]:[s0],[oe("2200")]:[i0],[oe("2002")]:[A0],[oe("0022")]:[i0],[oe("0220")]:[A0],[oe("1111")]:[Ty],[oe("1211")]:[r0],[oe("2111")]:[o0],[oe("1112")]:[a0],[oe("1121")]:[c0],[oe("1011")]:[r0],[oe("0111")]:[o0],[oe("1110")]:[a0],[oe("1101")]:[c0],[oe("1200")]:[l0],[oe("0120")]:[u0],[oe("0012")]:[f0],[oe("2001")]:[h0],[oe("1022")]:[l0],[oe("2102")]:[u0],[oe("2210")]:[f0],[oe("0221")]:[h0],[oe("1002")]:[d0],[oe("2100")]:[g0],[oe("0210")]:[p0],[oe("0021")]:[m0],[oe("1220")]:[d0],[oe("0122")]:[g0],[oe("2012")]:[p0],[oe("2201")]:[m0],[oe("0211")]:[B0],[oe("2110")]:[C0],[oe("1102")]:[_0],[oe("1021")]:[y0],[oe("2011")]:[B0],[oe("0112")]:[C0],[oe("1120")]:[_0],[oe("1201")]:[y0],[oe("2101")]:[Ms],[oe("0121")]:[Ms],[oe("1012")]:[ws],[oe("1210")]:[ws],[oe("0101")]:{0:[Cs,ys],1:[Ms],2:[Ms]},[oe("1010")]:{0:[bs,_s],1:[ws],2:[ws]},[oe("2121")]:{0:[Ms],1:[Ms],2:[Cs,ys]},[oe("1212")]:{0:[ws],1:[ws],2:[bs,_s]},[oe("2120")]:{0:[tA],1:[tA],2:[Es,ys]},[oe("2021")]:{0:[nA],1:[nA],2:[Cs,vs]},[oe("1202")]:{0:[sA],1:[sA],2:[bs,Ts]},[oe("0212")]:{0:[iA],1:[iA],2:[_s,Is]},[oe("0102")]:{0:[Es,ys],1:[tA],2:[tA]},[oe("0201")]:{0:[Cs,vs],1:[nA],2:[nA]},[oe("1020")]:{0:[bs,Ts],1:[sA],2:[sA]},[oe("2010")]:{0:[_s,Is],1:[iA],2:[iA]},[oe("2020")]:{0:[Is,Ts],1:[b0],2:[Es,vs]},[oe("0202")]:{0:[vs,Es],1:[b0],2:[Is,Ts]}};function hi(s,e){return Number.isNaN(s)?0:Array.isArray(e)?s<e[0]?0:s<e[1]?1:2:s>=e?1:0}function My(s){const{x:e,y:t,xRange:n,yRange:i,getValue:A,threshold:l}=s,h=e<n[0],g=e>=n[1]-1,B=t<i[0],C=t>=i[1]-1,y=h||g||B||C;let E=0,T,x,F,N;if(h||C)F=0;else{const Y=A(e,t+1);F=hi(Y,l),E+=Y}if(g||C)N=0;else{const Y=A(e+1,t+1);N=hi(Y,l),E+=Y}if(g||B)x=0;else{const Y=A(e+1,t);x=hi(Y,l),E+=Y}if(h||B)T=0;else{const Y=A(e,t);T=hi(Y,l),E+=Y}let R=-1;Number.isFinite(l)&&(R=F<<3|N<<2|x<<1|T),Array.isArray(l)&&(R=F<<6|N<<4|x<<2|T);let Q=0;return y||(Q=hi(E/4,l)),{code:R,meanCode:Q}}function wy(s){const{x:e,y:t,z:n,code:i,meanCode:A}=s;let l=Iy[i];Array.isArray(l)||(l=l[A]);const h=e+1,g=t+1,B=[];return l.forEach(C=>{const y=[];C.forEach(E=>{const T=h+E[0],x=g+E[1];y.push([T,x,n])}),B.push(y)}),B}function Sy(s){const{x:e,y:t,z:n,code:i,meanCode:A}=s;let l=vy[i];Array.isArray(l)||(l=l[A]);const h=e+1,g=t+1,B=[];return l.forEach(C=>{C.forEach(y=>{const E=h+y[0],T=g+y[1];B.push([E,T,n])})}),B}function xy({contours:s,getValue:e,xRange:t,yRange:n}){const i=[],A=[];let l=0,h=0;for(let g=0;g<s.length;g++){const B=s[g],C=B.zIndex??g,{threshold:y}=B;for(let E=t[0]-1;E<t[1];E++)for(let T=n[0]-1;T<n[1];T++){const{code:x,meanCode:F}=My({getValue:e,threshold:y,x:E,y:T,xRange:t,yRange:n}),N={x:E,y:T,z:C,code:x,meanCode:F};if(Array.isArray(y)){const R=wy(N);for(const Q of R)A[h++]={vertices:Q,contour:B}}else{const R=Sy(N);R.length>0&&(i[l++]={vertices:R,contour:B})}}}return{lines:i,polygons:A}}function Dy(s){var i,A,l;const{aggregator:e,binIdRange:t,channel:n}=s;if(e instanceof cn){const h=(i=e.getResult(n))==null?void 0:i.buffer;if(h){const g=new Float32Array(h.readSyncWebGL().buffer);return Py(g,t)}}if(e instanceof Li){const h=(A=e.getResult(n))==null?void 0:A.value,g=(l=e.getBins())==null?void 0:l.value;if(g&&h)return Fy(h,g,e.binCount)}return null}function Py(s,e){const[[t,n],[i,A]]=e,l=n-t,h=A-i;return(g,B)=>(g-=t,B-=i,g<0||g>=l||B<0||B>=h?NaN:s[B*l+g])}function Fy(s,e,t){const n={};for(let i=0;i<t;i++){const A=e[i*2],l=e[i*2+1];n[A]=n[A]||{},n[A][l]=s[i]}return(i,A)=>{var l;return((l=n[i])==null?void 0:l[A])??NaN}}const Ly=`uniform binOptionsUniforms {
  vec2 cellOriginCommon;
  vec2 cellSizeCommon;
} binOptions;
`,Ry={name:"binOptions",vs:Ly,uniformTypes:{cellOriginCommon:"vec2<f32>",cellSizeCommon:"vec2<f32>"}},E0=[255,255,255,255],Oy=1,Gy={cellSize:{type:"number",min:1,value:1e3},gridOrigin:{type:"array",compare:!0,value:[0,0]},getPosition:{type:"accessor",value:s=>s.position},getWeight:{type:"accessor",value:1},gpuAggregation:!0,aggregation:"SUM",contours:{type:"object",value:[{threshold:1}],optional:!0,compare:3},zOffset:.005};let Fh=class extends Ri{getAggregatorType(){return this.props.gpuAggregation&&cn.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){return e==="cpu"?new Li({dimensions:2,getBin:{sources:["positions"],getValue:({positions:t},n,i)=>{const l=this.state.aggregatorViewport.projectPosition(t),{cellSizeCommon:h,cellOriginCommon:g}=i;return[Math.floor((l[0]-g[0])/h[0]),Math.floor((l[1]-g[1])/h[1])]}},getValue:[{sources:["counts"],getValue:({counts:t})=>t}],onUpdate:this._onAggregationUpdate.bind(this)}):new cn(this.context.device,{dimensions:2,channelCount:1,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[St,Ry],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float counts;

  void getBin(out ivec2 binId) {
    vec3 positionCommon = project_position(positions, positions64Low);
    vec2 gridCoords = floor(positionCommon.xy / binOptions.cellSizeCommon);
    binId = ivec2(gridCoords);
  }
  void getValue(out float value) {
    value = counts;
  }
  `}),onUpdate:this._onAggregationUpdate.bind(this)})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},counts:{size:1,accessor:"getWeight"}})}updateState(e){const t=super.updateState(e),{props:n,oldProps:i,changeFlags:A}=e,{aggregator:l}=this.state;if(t||A.dataChanged||n.cellSize!==i.cellSize||!wn(n.gridOrigin,i.gridOrigin,1)||n.aggregation!==i.aggregation){this._updateBinOptions();const{cellSizeCommon:h,cellOriginCommon:g,binIdRange:B}=this.state;l.setProps({binIdRange:B,pointCount:this.getNumInstances(),operations:[n.aggregation],binOptions:{cellSizeCommon:h,cellOriginCommon:g}})}return wn(i.contours,n.contours,2)||this.setState({contourData:null}),t}_updateBinOptions(){const e=this.getBounds(),t=[1,1];let n=[0,0],i=[[0,1],[0,1]],A=this.context.viewport;if(e&&Number.isFinite(e[0][0])){let l=[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2];const{cellSize:h,gridOrigin:g}=this.props,{unitsPerMeter:B}=A.getDistanceScales(l);t[0]=B[0]*h,t[1]=B[1]*h;const C=A.projectFlat(l);n=[Math.floor((C[0]-g[0])/t[0])*t[0]+g[0],Math.floor((C[1]-g[1])/t[1])*t[1]+g[1]],l=A.unprojectFlat(n);const y=A.constructor;A=A.isGeospatial?new y({longitude:l[0],latitude:l[1],zoom:12}):new as({position:[l[0],l[1],0],zoom:12}),n=[Math.fround(A.center[0]),Math.fround(A.center[1])],i=Oa({dataBounds:e,getBinId:E=>{const T=A.projectFlat(E);return[Math.floor((T[0]-n[0])/t[0]),Math.floor((T[1]-n[1])/t[1])]}})}this.setState({cellSizeCommon:t,cellOriginCommon:n,binIdRange:i,aggregatorViewport:A})}draw(e){e.shaderModuleProps.project&&(e.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(e)}_onAggregationUpdate(){const{aggregator:e,binIdRange:t}=this.state;this.setState({aggregatedValueReader:Dy({aggregator:e,binIdRange:t,channel:0}),contourData:null})}_getContours(){const{aggregatedValueReader:e}=this.state;if(!e)return null;if(!this.state.contourData){const{binIdRange:t}=this.state,{contours:n}=this.props,i=xy({contours:n,getValue:e,xRange:t[0],yRange:t[1]});this.state.contourData=i}return this.state.contourData}onAttributeChange(e){const{aggregator:t}=this.state;switch(e){case"positions":t.setNeedsUpdate(),this._updateBinOptions();const{cellSizeCommon:n,cellOriginCommon:i,binIdRange:A}=this.state;t.setProps({binIdRange:A,binOptions:{cellSizeCommon:n,cellOriginCommon:i}});break;case"counts":t.setNeedsUpdate(0);break}}renderLayers(){const e=this._getContours();if(!e)return null;const{lines:t,polygons:n}=e,{zOffset:i}=this.props,{cellOriginCommon:A,cellSizeCommon:l}=this.state,h=this.getSubLayerClass("lines",ma),g=this.getSubLayerClass("bands",Uf),B=new Fe().translate([A[0],A[1],0]).scale([l[0],l[1],i]),C=t&&t.length>0&&new h(this.getSubLayerProps({id:"lines"}),{data:t,coordinateSystem:pt.CARTESIAN,modelMatrix:B,getPath:E=>E.vertices,getColor:E=>E.contour.color??E0,getWidth:E=>E.contour.strokeWidth??Oy,widthUnits:"pixels"}),y=n&&n.length>0&&new g(this.getSubLayerProps({id:"bands"}),{data:n,coordinateSystem:pt.CARTESIAN,modelMatrix:B,getPolygon:E=>E.vertices,getFillColor:E=>E.contour.color??E0});return[C,y]}getPickingInfo(e){const t=e.info,{object:n}=t;return n&&(t.object={contour:n.contour}),t}};Fh.layerName="ContourLayer";Fh.defaultProps=Gy;const Ny=`#version 300 es
#define SHADER_NAME grid-cell-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec2 instancePositions;
in float instanceElevationValues;
in float instanceColorValues;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
float interp(float value, vec2 domain, vec2 range) {
float r = min(max((value - domain.x) / (domain.y - domain.x), 0.), 1.);
return mix(range.x, range.y, r);
}
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
geometry.pickingColor = instancePickingColors;
if (isnan(instanceColorValues) ||
instanceColorValues < grid.colorDomain.z ||
instanceColorValues > grid.colorDomain.w ||
instanceElevationValues < grid.elevationDomain.z ||
instanceElevationValues > grid.elevationDomain.w
) {
gl_Position = vec4(0.);
return;
}
vec2 commonPosition = (instancePositions + (positions.xy + 1.0) / 2.0 * column.coverage) * grid.sizeCommon + grid.originCommon - project.commonOrigin.xy;
geometry.position = vec4(commonPosition, 0.0, 1.0);
geometry.normal = project_normal(normals);
float elevation = 0.0;
if (column.extruded) {
elevation = interp(instanceElevationValues, grid.elevationDomain.xy, grid.elevationRange);
elevation = project_size(elevation);
geometry.position.z = (positions.z + 1.0) / 2.0 * elevation;
}
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vColor = interp(instanceColorValues, grid.colorDomain.xy, colorRange);
vColor.a *= layer.opacity;
if (column.extruded) {
vColor.rgb = lighting_getLightColor(vColor.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Uy=`uniform gridUniforms {
  vec4 colorDomain;
  vec4 elevationDomain;
  vec2 elevationRange;
  vec2 originCommon;
  vec2 sizeCommon;
} grid;
`,Hy={name:"grid",vs:Uy,uniformTypes:{colorDomain:"vec4<f32>",elevationDomain:"vec4<f32>",elevationRange:"vec2<f32>",originCommon:"vec2<f32>",sizeCommon:"vec2<f32>"}};class Lh extends ni{getShaders(){const e=super.getShaders();return e.modules.push(Hy),{...e,vs:Ny}}initializeState(){super.initializeState();const e=this.getAttributeManager();e.remove(["instanceElevations","instanceFillColors","instanceLineColors","instanceStrokeWidths"]),e.addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceColorValues:{size:1,type:"float32",accessor:"getColorValue"},instanceElevationValues:{size:1,type:"float32",accessor:"getElevationValue"}})}updateState(e){var A;super.updateState(e);const{props:t,oldProps:n}=e,i=this.state.fillModel;if(n.colorRange!==t.colorRange){(A=this.state.colorTexture)==null||A.destroy(),this.state.colorTexture=Ra(this.context.device,t.colorRange,t.colorScaleType);const l={colorRange:this.state.colorTexture};i.shaderInputs.setProps({grid:l})}else n.colorScaleType!==t.colorScaleType&&La(this.state.colorTexture,t.colorScaleType)}finalizeState(e){var t;super.finalizeState(e),(t=this.state.colorTexture)==null||t.destroy()}_updateGeometry(){const e=new ch;this.state.fillModel.setGeometry(e)}draw({uniforms:e}){const{cellOriginCommon:t,cellSizeCommon:n,elevationRange:i,elevationScale:A,extruded:l,coverage:h,colorDomain:g,elevationDomain:B}=this.props,C=this.props.colorCutoff||[-1/0,1/0],y=this.props.elevationCutoff||[-1/0,1/0],E=this.state.fillModel,T={colorDomain:[Math.max(g[0],C[0]),Math.min(g[1],C[1]),Math.max(g[0]-1,C[0]),Math.min(g[1]+1,C[1])],elevationDomain:[Math.max(B[0],y[0]),Math.min(B[1],y[1]),Math.max(B[0]-1,y[0]),Math.min(B[1]+1,y[1])],elevationRange:[i[0]*A,i[1]*A],originCommon:t,sizeCommon:n};E.shaderInputs.setProps({column:{extruded:l,coverage:h},grid:T}),E.draw(this.context.renderPass)}}Lh.layerName="GridCellLayer";const ky=`uniform binOptionsUniforms {
  vec2 cellOriginCommon;
  vec2 cellSizeCommon;
} binOptions;
`,Jy={name:"binOptions",vs:ky,uniformTypes:{cellOriginCommon:"vec2<f32>",cellSizeCommon:"vec2<f32>"}};function T0(){}const Vy={gpuAggregation:!0,colorDomain:null,colorRange:or,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:T0,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScaleType:"linear",onSetElevationDomain:T0,cellSize:{type:"number",min:0,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:s=>s.position},gridAggregator:{type:"function",optional:!0,value:null},extruded:!1,material:!0};class Rh extends Ri{getAggregatorType(){const{gpuAggregation:e,gridAggregator:t,getColorValue:n,getElevationValue:i}=this.props;return e&&(t||n||i)?(at.warn("Features not supported by GPU aggregation, falling back to CPU")(),"cpu"):e&&cn.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){if(e==="cpu"){const{gridAggregator:t,cellSize:n}=this.props;return new Li({dimensions:2,getBin:{sources:["positions"],getValue:({positions:i},A,l)=>{if(t)return t(i,n);const g=this.state.aggregatorViewport.projectPosition(i),{cellSizeCommon:B,cellOriginCommon:C}=l;return[Math.floor((g[0]-C[0])/B[0]),Math.floor((g[1]-C[1])/B[1])]}},getValue:[{sources:["colorWeights"],getValue:({colorWeights:i})=>i},{sources:["elevationWeights"],getValue:({elevationWeights:i})=>i}]})}return new cn(this.context.device,{dimensions:2,channelCount:2,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[St,Jy],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float colorWeights;
  in float elevationWeights;

  void getBin(out ivec2 binId) {
    vec3 positionCommon = project_position(positions, positions64Low);
    vec2 gridCoords = floor(positionCommon.xy / binOptions.cellSizeCommon);
    binId = ivec2(gridCoords);
  }
  void getValue(out vec2 value) {
    value = vec2(colorWeights, elevationWeights);
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},colorWeights:{size:1,accessor:"getColorWeight"},elevationWeights:{size:1,accessor:"getElevationWeight"}})}updateState(e){const t=super.updateState(e),{props:n,oldProps:i,changeFlags:A}=e,{aggregator:l}=this.state;if((A.dataChanged||!this.state.dataAsArray)&&(n.getColorValue||n.getElevationValue)&&(this.state.dataAsArray=Array.from(cs(n.data).iterable)),t||A.dataChanged||n.cellSize!==i.cellSize||n.getColorValue!==i.getColorValue||n.getElevationValue!==i.getElevationValue||n.colorAggregation!==i.colorAggregation||n.elevationAggregation!==i.elevationAggregation){this._updateBinOptions();const{cellSizeCommon:h,cellOriginCommon:g,binIdRange:B,dataAsArray:C}=this.state;if(l.setProps({binIdRange:B,pointCount:this.getNumInstances(),operations:[n.colorAggregation,n.elevationAggregation],binOptions:{cellSizeCommon:h,cellOriginCommon:g},onUpdate:this._onAggregationUpdate.bind(this)}),C){const{getColorValue:y,getElevationValue:E}=this.props;l.setProps({customOperations:[y&&(T=>y(T.map(x=>C[x]),{indices:T,data:n.data})),E&&(T=>E(T.map(x=>C[x]),{indices:T,data:n.data}))]})}}return A.updateTriggersChanged&&A.updateTriggersChanged.getColorValue&&l.setNeedsUpdate(0),A.updateTriggersChanged&&A.updateTriggersChanged.getElevationValue&&l.setNeedsUpdate(1),t}_updateBinOptions(){const e=this.getBounds(),t=[1,1];let n=[0,0],i=[[0,1],[0,1]],A=this.context.viewport;if(e&&Number.isFinite(e[0][0])){let l=[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2];const{cellSize:h}=this.props,{unitsPerMeter:g}=A.getDistanceScales(l);t[0]=g[0]*h,t[1]=g[1]*h;const B=A.projectFlat(l);n=[Math.floor(B[0]/t[0])*t[0],Math.floor(B[1]/t[1])*t[1]],l=A.unprojectFlat(n);const C=A.constructor;A=A.isGeospatial?new C({longitude:l[0],latitude:l[1],zoom:12}):new as({position:[l[0],l[1],0],zoom:12}),n=[Math.fround(A.center[0]),Math.fround(A.center[1])],i=Oa({dataBounds:e,getBinId:y=>{const E=A.projectFlat(y);return[Math.floor((E[0]-n[0])/t[0]),Math.floor((E[1]-n[1])/t[1])]}})}this.setState({cellSizeCommon:t,cellOriginCommon:n,binIdRange:i,aggregatorViewport:A})}draw(e){e.shaderModuleProps.project&&(e.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(e)}_onAggregationUpdate({channel:e}){const t=this.getCurrentLayer().props,{aggregator:n}=this.state;if(e===0){const i=n.getResult(0);this.setState({colors:new kA(i,n.binCount)}),t.onSetColorDomain(n.getResultDomain(0))}else if(e===1){const i=n.getResult(1);this.setState({elevations:new kA(i,n.binCount)}),t.onSetElevationDomain(n.getResultDomain(1))}}onAttributeChange(e){const{aggregator:t}=this.state;switch(e){case"positions":t.setNeedsUpdate(),this._updateBinOptions();const{cellSizeCommon:n,cellOriginCommon:i,binIdRange:A}=this.state;t.setProps({binIdRange:A,binOptions:{cellSizeCommon:n,cellOriginCommon:i}});break;case"colorWeights":t.setNeedsUpdate(0);break;case"elevationWeights":t.setNeedsUpdate(1);break}}renderLayers(){var Te,ge;const{aggregator:e,cellOriginCommon:t,cellSizeCommon:n}=this.state,{elevationScale:i,colorRange:A,elevationRange:l,extruded:h,coverage:g,material:B,transitions:C,colorScaleType:y,lowerPercentile:E,upperPercentile:T,colorDomain:x,elevationScaleType:F,elevationLowerPercentile:N,elevationUpperPercentile:R,elevationDomain:Q}=this.props,Y=this.getSubLayerClass("cells",Lh),se=e.getBins(),re=(Te=this.state.colors)==null?void 0:Te.update({scaleType:y,lowerPercentile:E,upperPercentile:T}),ue=(ge=this.state.elevations)==null?void 0:ge.update({scaleType:F,lowerPercentile:N,upperPercentile:R});return!re||!ue?null:new Y(this.getSubLayerProps({id:"cells"}),{data:{length:e.binCount,attributes:{getBin:se,getColorValue:re.attribute,getElevationValue:ue.attribute}},dataComparator:($,K)=>$.length===K.length,updateTriggers:{getBin:[se],getColorValue:[re.attribute],getElevationValue:[ue.attribute]},cellOriginCommon:t,cellSizeCommon:n,elevationScale:i,colorRange:A,colorScaleType:y,elevationRange:l,extruded:h,coverage:g,material:B,colorDomain:re.domain||x||e.getResultDomain(0),elevationDomain:ue.domain||Q||e.getResultDomain(1),colorCutoff:re.cutoff,elevationCutoff:ue.cutoff,transitions:C&&{getFillColor:C.getColorValue||C.getColorWeight,getElevation:C.getElevationValue||C.getElevationWeight},extensions:[]})}getPickingInfo(e){const t=e.info,{index:n}=t;if(n>=0){const i=this.state.aggregator.getBin(n);let A;i&&(A={col:i.id[0],row:i.id[1],colorValue:i.value[0],elevationValue:i.value[1],count:i.count},i.pointIndices&&(A.pointIndices=i.pointIndices,A.points=Array.isArray(this.props.data)?i.pointIndices.map(l=>this.props.data[l]):[])),t.object=A}return t}}Rh.layerName="GridLayer";Rh.defaultProps=Vy;function zy(s){const e=s.map(h=>h[0]),t=s.map(h=>h[1]),n=Math.min.apply(null,e),i=Math.max.apply(null,e),A=Math.min.apply(null,t),l=Math.max.apply(null,t);return[n,A,i,l]}function jy(s,e){return e[0]>=s[0]&&e[2]<=s[2]&&e[1]>=s[1]&&e[3]<=s[3]}const v0=new Float32Array(12);function I0(s,e=2){let t=0;for(const n of s)for(let i=0;i<e;i++)v0[t++]=n[i]||0;return v0}function Qy(s,e,t){const[n,i,A,l]=s,h=A-n,g=l-i;let B=h,C=g;h/g<e/t?B=e/t*g:C=t/e*h,B<e&&(B=e,C=t);const y=(A+n)/2,E=(l+i)/2;return[y-B/2,E-C/2,y+B/2,E+C/2]}function Ky(s,e){const[t,n,i,A]=e;return[(s[0]-t)/(i-t),(s[1]-n)/(A-n)]}const Wy=`#version 300 es
#define SHADER_NAME heatp-map-layer-vertex-shader
uniform sampler2D maxTexture;
in vec3 positions;
in vec2 texCoords;
out vec2 vTexCoords;
out float vIntensityMin;
out float vIntensityMax;
void main(void) {
gl_Position = project_position_to_clipspace(positions, vec3(0.0), vec3(0.0));
vTexCoords = texCoords;
vec4 maxTexture = texture(maxTexture, vec2(0.5));
float maxValue = triangle.aggregationMode < 0.5 ? maxTexture.r : maxTexture.g;
float minValue = maxValue * triangle.threshold;
if (triangle.colorDomain[1] > 0.) {
maxValue = triangle.colorDomain[1];
minValue = triangle.colorDomain[0];
}
vIntensityMax = triangle.intensity / maxValue;
vIntensityMin = triangle.intensity / minValue;
}
`,Xy=`#version 300 es
#define SHADER_NAME triangle-layer-fragment-shader
precision highp float;
uniform sampler2D weightsTexture;
uniform sampler2D colorTexture;
in vec2 vTexCoords;
in float vIntensityMin;
in float vIntensityMax;
out vec4 fragColor;
vec4 getLinearColor(float value) {
float factor = clamp(value * vIntensityMax, 0., 1.);
vec4 color = texture(colorTexture, vec2(factor, 0.5));
color.a *= min(value * vIntensityMin, 1.0);
return color;
}
void main(void) {
vec4 weights = texture(weightsTexture, vTexCoords);
float weight = weights.r;
if (triangle.aggregationMode > 0.5) {
weight /= max(1.0, weights.a);
}
if (weight <= 0.) {
discard;
}
vec4 linearColor = getLinearColor(weight);
linearColor.a *= layer.opacity;
fragColor = linearColor;
}
`,M0=`uniform triangleUniforms {
  float aggregationMode;
  vec2 colorDomain;
  float intensity;
  float threshold;
} triangle;
`,Yy={name:"triangle",vs:M0,fs:M0,uniformTypes:{aggregationMode:"f32",colorDomain:"vec2<f32>",intensity:"f32",threshold:"f32"}};class Oh extends sn{getShaders(){return super.getShaders({vs:Wy,fs:Xy,modules:[St,Yy]})}initializeState({device:e}){this.setState({model:this._getModel(e)})}_getModel(e){const{vertexCount:t,data:n}=this.props;return new Ct(e,{...this.getShaders(),id:this.props.id,attributes:n.attributes,bufferLayout:[{name:"positions",format:"float32x3"},{name:"texCoords",format:"float32x2"}],topology:"triangle-strip",vertexCount:t})}draw(){const{model:e}=this.state,{aggregationMode:t,colorDomain:n,intensity:i,threshold:A,colorTexture:l,maxTexture:h,weightsTexture:g}=this.props,B={aggregationMode:t,colorDomain:n,intensity:i,threshold:A,colorTexture:l,maxTexture:h,weightsTexture:g};e.shaderInputs.setProps({triangle:B}),e.draw(this.context.renderPass)}}Oh.layerName="TriangleLayer";function $y(s,e){const t={};for(const n in s)e.includes(n)||(t[n]=s[n]);return t}class Gh extends xn{initializeAggregationLayer(e){super.initializeState(this.context),this.setState({ignoreProps:$y(this.constructor._propTypes,e.data.props),dimensions:e})}updateState(e){super.updateState(e);const{changeFlags:t}=e;if(t.extensionsChanged){const n=this.getShaders({});n&&n.defines&&(n.defines.NON_INSTANCED_MODEL=1),this.updateShaders(n)}this._updateAttributes()}updateAttributes(e){this.setState({changedAttributes:e})}getAttributes(){return this.getAttributeManager().getAttributes()}getModuleSettings(){const{viewport:e,mousePosition:t,device:n}=this.context;return Object.assign(Object.create(this.props),{viewport:e,mousePosition:t,picking:{isActive:0},devicePixelRatio:n.canvasContext.cssToDeviceRatio()})}updateShaders(e){}isAggregationDirty(e,t={}){const{props:n,oldProps:i,changeFlags:A}=e,{compareAll:l=!1,dimension:h}=t,{ignoreProps:g}=this.state,{props:B,accessors:C=[]}=h,{updateTriggersChanged:y}=A;if(A.dataChanged)return!0;if(y){if(y.all)return!0;for(const E of C)if(y[E])return!0}if(l)return A.extensionsChanged?!0:o1({oldProps:i,newProps:n,ignoreProps:g,propTypes:this.constructor._propTypes});for(const E of B)if(n[E]!==i[E])return!0;return!1}isAttributeChanged(e){const{changedAttributes:t}=this.state;return e?t&&t[e]!==void 0:!Zy(t)}_getAttributeManager(){return new Ba(this.context.device,{id:this.props.id,stats:this.context.stats})}}Gh.layerName="AggregationLayer";function Zy(s){let e=!0;for(const t in s){e=!1;break}return e}const w0=`#version 300 es
in vec3 positions;
in vec3 positions64Low;
in float weights;
out vec4 weightsTexture;
void main()
{
weightsTexture = vec4(weights * weight.weightsScale, 0., 0., 1.);
float radiusTexels = project_pixel_size(weight.radiusPixels) * weight.textureWidth / (weight.commonBounds.z - weight.commonBounds.x);
gl_PointSize = radiusTexels * 2.;
vec3 commonPosition = project_position(positions, positions64Low);
gl_Position.xy = (commonPosition.xy - weight.commonBounds.xy) / (weight.commonBounds.zw - weight.commonBounds.xy) ;
gl_Position.xy = (gl_Position.xy * 2.) - (1.);
gl_Position.w = 1.0;
}
`,S0=`#version 300 es
in vec4 weightsTexture;
out vec4 fragColor;
float gaussianKDE(float u){
return pow(2.71828, -u*u/0.05555)/(1.77245385*0.166666);
}
void main()
{
float dist = length(gl_PointCoord - vec2(0.5, 0.5));
if (dist > 0.5) {
discard;
}
fragColor = weightsTexture * gaussianKDE(2. * dist);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,qy=`#version 300 es
uniform sampler2D inTexture;
out vec4 outTexture;
void main()
{
int yIndex = gl_VertexID / int(maxWeight.textureSize);
int xIndex = gl_VertexID - (yIndex * int(maxWeight.textureSize));
vec2 uv = (0.5 + vec2(float(xIndex), float(yIndex))) / maxWeight.textureSize;
outTexture = texture(inTexture, uv);
gl_Position = vec4(0.0, 0.0, 0.0, 1.0);
gl_PointSize = 1.0;
}
`,eb=`#version 300 es
in vec4 outTexture;
out vec4 fragColor;
void main() {
fragColor = outTexture;
fragColor.g = outTexture.r / max(1.0, outTexture.a);
}
`,tb=`uniform weightUniforms {
  vec4 commonBounds;
  float radiusPixels;
  float textureWidth;
  float weightsScale;
} weight;
`,nb={name:"weight",vs:tb,uniformTypes:{commonBounds:"vec4<f32>",radiusPixels:"f32",textureWidth:"f32",weightsScale:"f32"}},sb={name:"maxWeight",vs:`uniform maxWeightUniforms {
  float textureSize;
} maxWeight;
`,uniformTypes:{textureSize:"f32"}},ib=2,ao={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}},x0=[0,0],Ab={SUM:0,MEAN:1},rb={getPosition:{type:"accessor",value:s=>s.position},getWeight:{type:"accessor",value:1},intensity:{type:"number",min:0,value:1},radiusPixels:{type:"number",min:1,max:100,value:50},colorRange:or,threshold:{type:"number",min:0,max:1,value:.05},colorDomain:{type:"array",value:null,optional:!0},aggregation:"SUM",weightsTextureSize:{type:"number",min:128,max:2048,value:2048},debounceTimeout:{type:"number",min:0,max:1e3,value:500}},ob=["float32-renderable-webgl","texture-blend-float-webgl"],ab={data:{props:["radiusPixels"]}};class Nh extends Gh{getShaders(e){let t=[St];return e.modules&&(t=[...t,...e.modules]),super.getShaders({...e,modules:t})}initializeState(){super.initializeAggregationLayer(ab),this.setState({colorDomain:x0}),this._setupTextureParams(),this._setupAttributes(),this._setupResources()}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState(e){super.updateState(e),this._updateHeatmapState(e)}_updateHeatmapState(e){const{props:t,oldProps:n}=e,i=this._getChangeFlags(e);(i.dataChanged||i.viewportChanged)&&(i.boundsChanged=this._updateBounds(i.dataChanged),this._updateTextureRenderingBounds()),i.dataChanged||i.boundsChanged?(clearTimeout(this.state.updateTimer),this.setState({isWeightMapDirty:!0})):i.viewportZoomChanged&&this._debouncedUpdateWeightmap(),t.colorRange!==n.colorRange&&this._updateColorTexture(e),this.state.isWeightMapDirty&&this._updateWeightmap(),this.setState({zoom:e.context.viewport.zoom})}renderLayers(){const{weightsTexture:e,triPositionBuffer:t,triTexCoordBuffer:n,maxWeightsTexture:i,colorTexture:A,colorDomain:l}=this.state,{updateTriggers:h,intensity:g,threshold:B,aggregation:C}=this.props,y=this.getSubLayerClass("triangle",Oh);return new y(this.getSubLayerProps({id:"triangle-layer",updateTriggers:h}),{coordinateSystem:pt.DEFAULT,data:{attributes:{positions:t,texCoords:n}},vertexCount:4,maxTexture:i,colorTexture:A,aggregationMode:Ab[C]||0,weightsTexture:e,intensity:g,threshold:B,colorDomain:l})}finalizeState(e){super.finalizeState(e);const{weightsTransform:t,weightsTexture:n,maxWeightTransform:i,maxWeightsTexture:A,triPositionBuffer:l,triTexCoordBuffer:h,colorTexture:g,updateTimer:B}=this.state;t==null||t.destroy(),n==null||n.destroy(),i==null||i.destroy(),A==null||A.destroy(),l==null||l.destroy(),h==null||h.destroy(),g==null||g.destroy(),B&&clearTimeout(B)}_getAttributeManager(){return new Ba(this.context.device,{id:this.props.id,stats:this.context.stats})}_getChangeFlags(e){const t={},{dimensions:n}=this.state;t.dataChanged=this.isAttributeChanged()&&"attribute changed"||this.isAggregationDirty(e,{compareAll:!0,dimension:n.data})&&"aggregation is dirty",t.viewportChanged=e.changeFlags.viewportChanged;const{zoom:i}=this.state;return(!e.context.viewport||e.context.viewport.zoom!==i)&&(t.viewportZoomChanged=!0),t}_createTextures(){const{textureSize:e,format:t}=this.state;this.setState({weightsTexture:this.context.device.createTexture({...ao,width:e,height:e,format:t}),maxWeightsTexture:this.context.device.createTexture({...ao,width:1,height:1,format:t})})}_setupAttributes(){this.getAttributeManager().add({positions:{size:3,type:"float64",accessor:"getPosition"},weights:{size:1,accessor:"getWeight"}}),this.setState({positionAttributeName:"positions"})}_setupTextureParams(){const{device:e}=this.context,{weightsTextureSize:t}=this.props,n=Math.min(t,e.limits.maxTextureDimension2D),i=ob.every(h=>e.features.has(h)),A=i?"rgba32float":"rgba8unorm",l=i?1:1/255;this.setState({textureSize:n,format:A,weightsScale:l}),i||at.warn(`HeatmapLayer: ${this.id} rendering to float texture not supported, falling back to low precision format`)()}_createWeightsTransform(e){let{weightsTransform:t}=this.state;const{weightsTexture:n}=this.state,i=this.getAttributeManager();t==null||t.destroy(),t=new yl(this.context.device,{id:`${this.id}-weights-transform`,bufferLayout:i.getBufferLayouts(),vertexCount:1,targetTexture:n,parameters:{depthWriteEnabled:!1,blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"},topology:"point-list",...e,modules:[...e.modules,nb]}),this.setState({weightsTransform:t})}_setupResources(){this._createTextures();const{device:e}=this.context,{textureSize:t,weightsTexture:n,maxWeightsTexture:i}=this.state,A=this.getShaders({vs:w0,fs:S0});this._createWeightsTransform(A);const l=this.getShaders({vs:qy,fs:eb,modules:[sb]}),h=new yl(e,{id:`${this.id}-max-weights-transform`,targetTexture:i,...l,vertexCount:t*t,topology:"point-list",parameters:{depthWriteEnabled:!1,blendColorOperation:"max",blendAlphaOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}}),g={inTexture:n,textureSize:t};h.model.shaderInputs.setProps({maxWeight:g}),this.setState({weightsTexture:n,maxWeightsTexture:i,maxWeightTransform:h,zoom:null,triPositionBuffer:e.createBuffer({byteLength:48}),triTexCoordBuffer:e.createBuffer({byteLength:48})})}updateShaders(e){this._createWeightsTransform({vs:w0,fs:S0,...e})}_updateMaxWeightValue(){const{maxWeightTransform:e}=this.state;e.run({parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]})}_updateBounds(e=!1){const{viewport:t}=this.context,n=[t.unproject([0,0]),t.unproject([t.width,0]),t.unproject([0,t.height]),t.unproject([t.width,t.height])].map(h=>h.map(Math.fround)),i=zy(n),A={visibleWorldBounds:i,viewportCorners:n};let l=!1;if(e||!this.state.worldBounds||!jy(this.state.worldBounds,i)){const h=this._worldToCommonBounds(i),g=this._commonToWorldBounds(h);this.props.coordinateSystem===pt.LNGLAT&&(g[1]=Math.max(g[1],-85.051129),g[3]=Math.min(g[3],85.051129),g[0]=Math.max(g[0],-360),g[2]=Math.min(g[2],360));const B=this._worldToCommonBounds(g);A.worldBounds=g,A.normalizedCommonBounds=B,l=!0}return this.setState(A),l}_updateTextureRenderingBounds(){const{triPositionBuffer:e,triTexCoordBuffer:t,normalizedCommonBounds:n,viewportCorners:i}=this.state,{viewport:A}=this.context;e.write(I0(i,3));const l=i.map(h=>Ky(A.projectPosition(h),n));t.write(I0(l,2))}_updateColorTexture(e){const{colorRange:t}=e.props;let{colorTexture:n}=this.state;const i=Mh(t,!1,Uint8Array);n&&(n==null?void 0:n.width)===t.length?n.setTexture2DData({data:i}):(n==null||n.destroy(),n=this.context.device.createTexture({...ao,data:i,width:t.length,height:1})),this.setState({colorTexture:n})}_updateWeightmap(){const{radiusPixels:e,colorDomain:t,aggregation:n}=this.props,{worldBounds:i,textureSize:A,weightsScale:l,weightsTexture:h}=this.state,g=this.state.weightsTransform;this.state.isWeightMapDirty=!1;const B=this._worldToCommonBounds(i,{useLayerCoordinateSystem:!0});if(t&&n==="SUM"){const{viewport:Y}=this.context,se=Y.distanceScales.metersPerUnit[2]*(B[2]-B[0])/A;this.state.colorDomain=t.map(re=>re*se*l)}else this.state.colorDomain=t||x0;const y=this.getAttributeManager().getAttributes(),E=this.getModuleSettings();this._setModelAttributes(g.model,y),g.model.setVertexCount(this.getNumInstances());const T={radiusPixels:e,commonBounds:B,textureWidth:A,weightsScale:l,weightsTexture:h},{viewport:x,devicePixelRatio:F,coordinateSystem:N,coordinateOrigin:R}=E,{modelMatrix:Q}=this.props;g.model.shaderInputs.setProps({project:{viewport:x,devicePixelRatio:F,modelMatrix:Q,coordinateSystem:N,coordinateOrigin:R},weight:T}),g.run({parameters:{viewport:[0,0,A,A]},clearColor:[0,0,0,0]}),this._updateMaxWeightValue()}_debouncedUpdateWeightmap(e=!1){let{updateTimer:t}=this.state;const{debounceTimeout:n}=this.props;e?(t=null,this._updateBounds(!0),this._updateTextureRenderingBounds(),this.setState({isWeightMapDirty:!0})):(this.setState({isWeightMapDirty:!1}),clearTimeout(t),t=setTimeout(this._debouncedUpdateWeightmap.bind(this,!0),n)),this.setState({updateTimer:t})}_worldToCommonBounds(e,t={}){const{useLayerCoordinateSystem:n=!1}=t,[i,A,l,h]=e,{viewport:g}=this.context,{textureSize:B}=this.state,{coordinateSystem:C}=this.props,y=n&&(C===pt.LNGLAT_OFFSETS||C===pt.METER_OFFSETS),E=y?g.projectPosition(this.props.coordinateOrigin):[0,0],T=B*ib/g.scale;let x,F;return n&&!y?(x=this.projectPosition([i,A,0]),F=this.projectPosition([l,h,0])):(x=g.projectPosition([i,A,0]),F=g.projectPosition([l,h,0])),Qy([x[0]-E[0],x[1]-E[1],F[0]-E[0],F[1]-E[1]],T,T)}_commonToWorldBounds(e){const[t,n,i,A]=e,{viewport:l}=this.context,h=l.unprojectPosition([t,n]),g=l.unprojectPosition([i,A]);return h.slice(0,2).concat(g.slice(0,2))}}Nh.layerName="HeatmapLayer";Nh.defaultProps=rb;const cb={getHeight:{type:"accessor",value:0},greatCircle:!0};class Uh extends wa{}Uh.layerName="GreatCircleLayer";Uh.defaultProps=cb;const lb={...Ar.defaultProps};class si extends xn{indexToBounds(){return null}renderLayers(){const{elevationScale:e,extruded:t,wireframe:n,filled:i,stroked:A,lineWidthUnits:l,lineWidthScale:h,lineWidthMinPixels:g,lineWidthMaxPixels:B,lineJointRounded:C,lineMiterLimit:y,lineDashJustified:E,getElevation:T,getFillColor:x,getLineColor:F,getLineWidth:N}=this.props,{updateTriggers:R,material:Q,transitions:Y}=this.props,se=this.getSubLayerClass("cell",Ar),{updateTriggers:re,...ue}=this.indexToBounds()||{};return new se({filled:i,wireframe:n,extruded:t,elevationScale:e,stroked:A,lineWidthUnits:l,lineWidthScale:h,lineWidthMinPixels:g,lineWidthMaxPixels:B,lineJointRounded:C,lineMiterLimit:y,lineDashJustified:E,material:Q,transitions:Y,getElevation:T,getFillColor:x,getLineColor:F,getLineWidth:N},this.getSubLayerProps({id:"cell",updateTriggers:R&&{...re,getElevation:R.getElevation,getFillColor:R.getFillColor,getLineColor:R.getLineColor,getLineWidth:R.getLineWidth}}),ue)}}si.layerName="GeoCellLayer";si.defaultProps=lb;function ub(s){throw new Error('Could not dynamically require "'+s+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var vA={exports:{}},fb=vA.exports,D0;function hb(){return D0||(D0=1,function(s){/**
 * @license long.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
 * Released under the Apache License, Version 2.0
 * see: https://github.com/dcodeIO/long.js for details
 */(function(e,t){typeof ub=="function"&&s&&s.exports?s.exports=t():(e.dcodeIO=e.dcodeIO||{}).Long=t()})(fb,function(){function e(K,O,ne){this.low=K|0,this.high=O|0,this.unsigned=!!ne}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1});function t(K){return(K&&K.__isLong__)===!0}e.isLong=t;var n={},i={};function A(K,O){var ne,he,Le;return O?(K>>>=0,(Le=0<=K&&K<256)&&(he=i[K],he)?he:(ne=h(K,(K|0)<0?-1:0,!0),Le&&(i[K]=ne),ne)):(K|=0,(Le=-128<=K&&K<128)&&(he=n[K],he)?he:(ne=h(K,K<0?-1:0,!1),Le&&(n[K]=ne),ne))}e.fromInt=A;function l(K,O){if(isNaN(K)||!isFinite(K))return O?Q:R;if(O){if(K<0)return Q;if(K>=x)return Te}else{if(K<=-9223372036854776e3)return ge;if(K+1>=F)return ue}return K<0?l(-K,O).neg():h(K%T|0,K/T|0,O)}e.fromNumber=l;function h(K,O,ne){return new e(K,O,ne)}e.fromBits=h;var g=Math.pow;function B(K,O,ne){if(K.length===0)throw Error("empty string");if(K==="NaN"||K==="Infinity"||K==="+Infinity"||K==="-Infinity")return R;if(typeof O=="number"?(ne=O,O=!1):O=!!O,ne=ne||10,ne<2||36<ne)throw RangeError("radix");var he;if((he=K.indexOf("-"))>0)throw Error("interior hyphen");if(he===0)return B(K.substring(1),O,ne).neg();for(var Le=l(g(ne,8)),Re=R,Ye=0;Ye<K.length;Ye+=8){var it=Math.min(8,K.length-Ye),ot=parseInt(K.substring(Ye,Ye+it),ne);if(it<8){var ct=l(g(ne,it));Re=Re.mul(ct).add(l(ot))}else Re=Re.mul(Le),Re=Re.add(l(ot))}return Re.unsigned=O,Re}e.fromString=B;function C(K){return K instanceof e?K:typeof K=="number"?l(K):typeof K=="string"?B(K):h(K.low,K.high,K.unsigned)}e.fromValue=C;var y=65536,E=1<<24,T=y*y,x=T*T,F=x/2,N=A(E),R=A(0);e.ZERO=R;var Q=A(0,!0);e.UZERO=Q;var Y=A(1);e.ONE=Y;var se=A(1,!0);e.UONE=se;var re=A(-1);e.NEG_ONE=re;var ue=h(-1,2147483647,!1);e.MAX_VALUE=ue;var Te=h(-1,-1,!0);e.MAX_UNSIGNED_VALUE=Te;var ge=h(0,-2147483648,!1);e.MIN_VALUE=ge;var $=e.prototype;return $.toInt=function(){return this.unsigned?this.low>>>0:this.low},$.toNumber=function(){return this.unsigned?(this.high>>>0)*T+(this.low>>>0):this.high*T+(this.low>>>0)},$.toString=function(O){if(O=O||10,O<2||36<O)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(ge)){var ne=l(O),he=this.div(ne),Le=he.mul(ne).sub(this);return he.toString(O)+Le.toInt().toString(O)}else return"-"+this.neg().toString(O);for(var Re=l(g(O,6),this.unsigned),Ye=this,it="";;){var ot=Ye.div(Re),ct=Ye.sub(ot.mul(Re)).toInt()>>>0,We=ct.toString(O);if(Ye=ot,Ye.isZero())return We+it;for(;We.length<6;)We="0"+We;it=""+We+it}},$.getHighBits=function(){return this.high},$.getHighBitsUnsigned=function(){return this.high>>>0},$.getLowBits=function(){return this.low},$.getLowBitsUnsigned=function(){return this.low>>>0},$.getNumBitsAbs=function(){if(this.isNegative())return this.eq(ge)?64:this.neg().getNumBitsAbs();for(var O=this.high!=0?this.high:this.low,ne=31;ne>0&&(O&1<<ne)==0;ne--);return this.high!=0?ne+33:ne+1},$.isZero=function(){return this.high===0&&this.low===0},$.isNegative=function(){return!this.unsigned&&this.high<0},$.isPositive=function(){return this.unsigned||this.high>=0},$.isOdd=function(){return(this.low&1)===1},$.isEven=function(){return(this.low&1)===0},$.equals=function(O){return t(O)||(O=C(O)),this.unsigned!==O.unsigned&&this.high>>>31===1&&O.high>>>31===1?!1:this.high===O.high&&this.low===O.low},$.eq=$.equals,$.notEquals=function(O){return!this.eq(O)},$.neq=$.notEquals,$.lessThan=function(O){return this.comp(O)<0},$.lt=$.lessThan,$.lessThanOrEqual=function(O){return this.comp(O)<=0},$.lte=$.lessThanOrEqual,$.greaterThan=function(O){return this.comp(O)>0},$.gt=$.greaterThan,$.greaterThanOrEqual=function(O){return this.comp(O)>=0},$.gte=$.greaterThanOrEqual,$.compare=function(O){if(t(O)||(O=C(O)),this.eq(O))return 0;var ne=this.isNegative(),he=O.isNegative();return ne&&!he?-1:!ne&&he?1:this.unsigned?O.high>>>0>this.high>>>0||O.high===this.high&&O.low>>>0>this.low>>>0?-1:1:this.sub(O).isNegative()?-1:1},$.comp=$.compare,$.negate=function(){return!this.unsigned&&this.eq(ge)?ge:this.not().add(Y)},$.neg=$.negate,$.add=function(O){t(O)||(O=C(O));var ne=this.high>>>16,he=this.high&65535,Le=this.low>>>16,Re=this.low&65535,Ye=O.high>>>16,it=O.high&65535,ot=O.low>>>16,ct=O.low&65535,We=0,qe=0,rt=0,Wt=0;return Wt+=Re+ct,rt+=Wt>>>16,Wt&=65535,rt+=Le+ot,qe+=rt>>>16,rt&=65535,qe+=he+it,We+=qe>>>16,qe&=65535,We+=ne+Ye,We&=65535,h(rt<<16|Wt,We<<16|qe,this.unsigned)},$.subtract=function(O){return t(O)||(O=C(O)),this.add(O.neg())},$.sub=$.subtract,$.multiply=function(O){if(this.isZero()||(t(O)||(O=C(O)),O.isZero()))return R;if(this.eq(ge))return O.isOdd()?ge:R;if(O.eq(ge))return this.isOdd()?ge:R;if(this.isNegative())return O.isNegative()?this.neg().mul(O.neg()):this.neg().mul(O).neg();if(O.isNegative())return this.mul(O.neg()).neg();if(this.lt(N)&&O.lt(N))return l(this.toNumber()*O.toNumber(),this.unsigned);var ne=this.high>>>16,he=this.high&65535,Le=this.low>>>16,Re=this.low&65535,Ye=O.high>>>16,it=O.high&65535,ot=O.low>>>16,ct=O.low&65535,We=0,qe=0,rt=0,Wt=0;return Wt+=Re*ct,rt+=Wt>>>16,Wt&=65535,rt+=Le*ct,qe+=rt>>>16,rt&=65535,rt+=Re*ot,qe+=rt>>>16,rt&=65535,qe+=he*ct,We+=qe>>>16,qe&=65535,qe+=Le*ot,We+=qe>>>16,qe&=65535,qe+=Re*it,We+=qe>>>16,qe&=65535,We+=ne*ct+he*ot+Le*it+Re*Ye,We&=65535,h(rt<<16|Wt,We<<16|qe,this.unsigned)},$.mul=$.multiply,$.divide=function(O){if(t(O)||(O=C(O)),O.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?Q:R;var ne,he,Le;if(this.unsigned){if(O.unsigned||(O=O.toUnsigned()),O.gt(this))return Q;if(O.gt(this.shru(1)))return se;Le=Q}else{if(this.eq(ge)){if(O.eq(Y)||O.eq(re))return ge;if(O.eq(ge))return Y;var Re=this.shr(1);return ne=Re.div(O).shl(1),ne.eq(R)?O.isNegative()?Y:re:(he=this.sub(O.mul(ne)),Le=ne.add(he.div(O)),Le)}else if(O.eq(ge))return this.unsigned?Q:R;if(this.isNegative())return O.isNegative()?this.neg().div(O.neg()):this.neg().div(O).neg();if(O.isNegative())return this.div(O.neg()).neg();Le=R}for(he=this;he.gte(O);){ne=Math.max(1,Math.floor(he.toNumber()/O.toNumber()));for(var Ye=Math.ceil(Math.log(ne)/Math.LN2),it=Ye<=48?1:g(2,Ye-48),ot=l(ne),ct=ot.mul(O);ct.isNegative()||ct.gt(he);)ne-=it,ot=l(ne,this.unsigned),ct=ot.mul(O);ot.isZero()&&(ot=Y),Le=Le.add(ot),he=he.sub(ct)}return Le},$.div=$.divide,$.modulo=function(O){return t(O)||(O=C(O)),this.sub(this.div(O).mul(O))},$.mod=$.modulo,$.not=function(){return h(~this.low,~this.high,this.unsigned)},$.and=function(O){return t(O)||(O=C(O)),h(this.low&O.low,this.high&O.high,this.unsigned)},$.or=function(O){return t(O)||(O=C(O)),h(this.low|O.low,this.high|O.high,this.unsigned)},$.xor=function(O){return t(O)||(O=C(O)),h(this.low^O.low,this.high^O.high,this.unsigned)},$.shiftLeft=function(O){return t(O)&&(O=O.toInt()),(O&=63)===0?this:O<32?h(this.low<<O,this.high<<O|this.low>>>32-O,this.unsigned):h(0,this.low<<O-32,this.unsigned)},$.shl=$.shiftLeft,$.shiftRight=function(O){return t(O)&&(O=O.toInt()),(O&=63)===0?this:O<32?h(this.low>>>O|this.high<<32-O,this.high>>O,this.unsigned):h(this.high>>O-32,this.high>=0?0:-1,this.unsigned)},$.shr=$.shiftRight,$.shiftRightUnsigned=function(O){if(t(O)&&(O=O.toInt()),O&=63,O===0)return this;var ne=this.high;if(O<32){var he=this.low;return h(he>>>O|ne<<32-O,ne>>>O,this.unsigned)}else return O===32?h(ne,0,this.unsigned):h(ne>>>O-32,0,this.unsigned)},$.shru=$.shiftRightUnsigned,$.toSigned=function(){return this.unsigned?h(this.low,this.high,!1):this},$.toUnsigned=function(){return this.unsigned?this:h(this.low,this.high,!0)},$.toBytes=function(K){return K?this.toBytesLE():this.toBytesBE()},$.toBytesLE=function(){var K=this.high,O=this.low;return[O&255,O>>>8&255,O>>>16&255,O>>>24&255,K&255,K>>>8&255,K>>>16&255,K>>>24&255]},$.toBytesBE=function(){var K=this.high,O=this.low;return[K>>>24&255,K>>>16&255,K>>>8&255,K&255,O>>>24&255,O>>>16&255,O>>>8&255,O&255]},e})}(vA)),vA.exports}var db=hb();const IA=a1(db),gb=3,pb=30,mb=2*pb+1,P0=180/Math.PI;function Bb(s,e,t){const n=1<<e;return[(s[0]+t[0])/n,(s[1]+t[1])/n]}function F0(s){return s>=.5?1/3*(4*s*s-1):1/3*(1-4*(1-s)*(1-s))}function Cb(s){return[F0(s[0]),F0(s[1])]}function _b(s,[e,t]){switch(s){case 0:return[1,e,t];case 1:return[-e,1,t];case 2:return[-e,-t,1];case 3:return[-1,-t,-e];case 4:return[t,-1,-e];case 5:return[t,e,-1];default:throw new Error("Invalid face")}}function yb([s,e,t]){const n=Math.atan2(t,Math.sqrt(s*s+e*e));return[Math.atan2(e,s)*P0,n*P0]}function bb(s){let e=IA.fromString(s,!0,10).toString(2);for(;e.length<gb+mb;)e="0"+e;const t=e.lastIndexOf("1"),n=e.substring(0,3),i=e.substring(3,t),A=i.length/2,l=IA.fromString(n,!0,2).toString(10);let h=IA.fromString(i,!0,2).toString(4);for(;h.length<A;)h="0"+h;return`${l}/${h}`}function Eb(s,e,t,n){if(n===0){t===1&&(e[0]=s-1-e[0],e[1]=s-1-e[1]);const i=e[0];e[0]=e[1],e[1]=i}}function Tb(s){const e=s.split("/"),t=parseInt(e[0],10),n=e[1],i=n.length,A=[0,0];let l;for(let h=i-1;h>=0;h--){l=i-h;const g=n[h];let B=0,C=0;g==="1"?C=1:g==="2"?(B=1,C=1):g==="3"&&(B=1);const y=Math.pow(2,l-1);Eb(y,A,B,C),A[0]+=y*B,A[1]+=y*C}if(t%2===1){const h=A[0];A[0]=A[1],A[1]=h}return{face:t,ij:A,level:l}}function vb(s){const e=s.padEnd(16,"0");return IA.fromString(e,16)}const Ib=100;function Mb({face:s,ij:e,level:t}){const n=[[0,0],[0,1],[1,1],[1,0],[0,0]],i=Math.max(1,Math.ceil(Ib*Math.pow(2,-t))),A=new Float64Array(4*i*2+2);let l=0,h=0;for(let g=0;g<4;g++){const B=n[g].slice(0),C=n[g+1],y=(C[0]-B[0])/i,E=(C[1]-B[1])/i;for(let T=0;T<i;T++){B[0]+=y,B[1]+=E;const x=Bb(e,t,B),F=Cb(x),N=_b(s,F),R=yb(N);Math.abs(R[1])>89.999&&(R[0]=h);const Q=R[0]-h;R[0]+=Q>180?-360:Q<-180?360:0,A[l++]=R[0],A[l++]=R[1],h=R[0]}}return A[l++]=A[0],A[l++]=A[1],A}function wb(s){if(typeof s=="string"){if(s.indexOf("/")>0)return s;s=vb(s)}return bb(s.toString())}function Sb(s){const e=wb(s),t=Tb(e);return Mb(t)}const xb={getS2Token:{type:"accessor",value:s=>s.token}};class Hh extends si{indexToBounds(){const{data:e,getS2Token:t}=this.props;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(n,i)=>Sb(t(n,i))}}}Hh.layerName="S2Layer";Hh.defaultProps=xb;const co=512;function Db(s,e){let t=0,n=0,i=1<<s.length;const A=i/co;for(let l=0;l<s.length;l++){i>>=1;const h=parseInt(s[l]);h%2&&(t|=i),h>1&&(n|=i)}return[[t/A,co-n/A],[(t+e)/A,co-(n+e)/A]]}function Pb(s,e=1){const[t,n]=Db(s,e),[i,A]=Qo(t),[l,h]=Qo(n);return[l,A,l,h,i,h,i,A,l,A]}const Fb={getQuadkey:{type:"accessor",value:s=>s.quadkey}};class kh extends si{indexToBounds(){const{data:e,extruded:t,getQuadkey:n}=this.props,i=t?.99:1;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(A,l)=>Pb(n(A,l),i),updateTriggers:{getPolygon:i}}}}kh.layerName="QuadkeyLayer";kh.defaultProps=Fb;class Lb{constructor(e){this.index=e,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(e){this._bbox||(this._bbox=e,"west"in e?this.boundingBox=[[e.west,e.south],[e.east,e.north]]:this.boundingBox=[[e.left,e.top],[e.right,e.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return!!this._loader&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const e=this.content?this.content.byteLength:0;return Number.isFinite(e)||console.error("byteLength not defined in tile data"),e}async _loadData({getData:e,requestScheduler:t,onLoad:n,onError:i}){const{index:A,id:l,bbox:h,userData:g,zoom:B}=this,C=this._loaderId;this._abortController=new AbortController;const{signal:y}=this._abortController,E=await t.scheduleRequest(this,F=>F.isSelected?1:-1);if(!E){this._isCancelled=!0;return}if(this._isCancelled){E.done();return}let T=null,x;try{T=await e({index:A,id:l,bbox:h,userData:g,zoom:B,signal:y})}catch(F){x=F||!0}finally{E.done()}if(C===this._loaderId){if(this._loader=void 0,this.content=T,this._isCancelled&&!T){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,x?i(x,this):n(this)}}loadData(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){var e;this.isLoaded||(this._isCancelled=!0,(e=this._abortController)==null||e.abort())}}const vt={OUTSIDE:-1,INTERSECTING:0,INSIDE:1},L0=new k,Rb=new k;class Ga{constructor(e=[0,0,0],t=[0,0,0],n){n=n||L0.copy(e).add(t).scale(.5),this.center=new k(n),this.halfDiagonal=new k(t).subtract(this.center),this.minimum=new k(e),this.maximum=new k(t)}clone(){return new Ga(this.minimum,this.maximum,this.center)}equals(e){return this===e||!!e&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){const{halfDiagonal:t}=this,n=Rb.from(e.normal),i=t.x*Math.abs(n.x)+t.y*Math.abs(n.y)+t.z*Math.abs(n.z),A=this.center.dot(n)+e.distance;return A-i>0?vt.INSIDE:A+i<0?vt.OUTSIDE:vt.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=L0.from(e).subtract(this.center),{halfDiagonal:n}=this;let i=0,A;return A=Math.abs(t.x)-n.x,A>0&&(i+=A*A),A=Math.abs(t.y)-n.y,A>0&&(i+=A*A),A=Math.abs(t.z)-n.z,A>0&&(i+=A*A),i}}const di=new k,R0=new k;class Oi{constructor(e=[0,0,0],t=0){this.radius=-0,this.center=new k,this.fromCenterRadius(e,t)}fromCenterRadius(e,t){return this.center.from(e),this.radius=t,this}fromCornerPoints(e,t){return t=di.from(t),this.center=new k().from(e).add(t).scale(.5),this.radius=this.center.distance(t),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new Oi(this.center,this.radius)}union(e){const t=this.center,n=this.radius,i=e.center,A=e.radius,l=di.copy(i).subtract(t),h=l.magnitude();if(n>=h+A)return this.clone();if(A>=h+n)return e.clone();const g=(n+h+A)*.5;return R0.copy(l).scale((-n+g)/h).add(t),this.center.copy(R0),this.radius=g,this}expand(e){const n=di.from(e).subtract(this.center).magnitude();return n>this.radius&&(this.radius=n),this}transform(e){this.center.transform(e);const t=c1(di,e);return this.radius=Math.max(t[0],Math.max(t[1],t[2]))*this.radius,this}distanceSquaredTo(e){const t=this.distanceTo(e);return t*t}distanceTo(e){const n=di.from(e).subtract(this.center);return Math.max(0,n.len()-this.radius)}intersectPlane(e){const t=this.center,n=this.radius,A=e.normal.dot(t)+e.distance;return A<-n?vt.OUTSIDE:A<n?vt.INTERSECTING:vt.INSIDE}}const Ob=new k,Gb=new k,AA=new k,rA=new k,oA=new k,Nb=new k,Ub=new k,Tn={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class Gi{constructor(e=[0,0,0],t=[0,0,0,0,0,0,0,0,0]){this.center=new k().from(e),this.halfAxes=new At(t)}get halfSize(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2);return[new k(e).len(),new k(t).len(),new k(n).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2),i=new k(e).normalize(),A=new k(t).normalize(),l=new k(n).normalize();return new Ti().fromMatrix3(new At([...i,...A,...l]))}fromCenterHalfSizeQuaternion(e,t,n){const i=new Ti(n),A=new At().fromQuaternion(i);return A[0]=A[0]*t[0],A[1]=A[1]*t[0],A[2]=A[2]*t[0],A[3]=A[3]*t[1],A[4]=A[4]*t[1],A[5]=A[5]*t[1],A[6]=A[6]*t[2],A[7]=A[7]*t[2],A[8]=A[8]*t[2],this.center=new k().from(e),this.halfAxes=A,this}clone(){return new Gi(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new Oi){const t=this.halfAxes,n=t.getColumn(0,AA),i=t.getColumn(1,rA),A=t.getColumn(2,oA),l=Ob.copy(n).add(i).add(A);return e.center.copy(this.center),e.radius=l.magnitude(),e}intersectPlane(e){const t=this.center,n=e.normal,i=this.halfAxes,A=n.x,l=n.y,h=n.z,g=Math.abs(A*i[Tn.COLUMN0ROW0]+l*i[Tn.COLUMN0ROW1]+h*i[Tn.COLUMN0ROW2])+Math.abs(A*i[Tn.COLUMN1ROW0]+l*i[Tn.COLUMN1ROW1]+h*i[Tn.COLUMN1ROW2])+Math.abs(A*i[Tn.COLUMN2ROW0]+l*i[Tn.COLUMN2ROW1]+h*i[Tn.COLUMN2ROW2]),B=n.dot(t)+e.distance;return B<=-g?vt.OUTSIDE:B>=g?vt.INSIDE:vt.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=Gb.from(e).subtract(this.center),n=this.halfAxes,i=n.getColumn(0,AA),A=n.getColumn(1,rA),l=n.getColumn(2,oA),h=i.magnitude(),g=A.magnitude(),B=l.magnitude();i.normalize(),A.normalize(),l.normalize();let C=0,y;return y=Math.abs(t.dot(i))-h,y>0&&(C+=y*y),y=Math.abs(t.dot(A))-g,y>0&&(C+=y*y),y=Math.abs(t.dot(l))-B,y>0&&(C+=y*y),C}computePlaneDistances(e,t,n=[-0,-0]){let i=Number.POSITIVE_INFINITY,A=Number.NEGATIVE_INFINITY;const l=this.center,h=this.halfAxes,g=h.getColumn(0,AA),B=h.getColumn(1,rA),C=h.getColumn(2,oA),y=Nb.copy(g).add(B).add(C).add(l),E=Ub.copy(y).subtract(e);let T=t.dot(E);return i=Math.min(T,i),A=Math.max(T,A),y.copy(l).add(g).add(B).subtract(C),E.copy(y).subtract(e),T=t.dot(E),i=Math.min(T,i),A=Math.max(T,A),y.copy(l).add(g).subtract(B).add(C),E.copy(y).subtract(e),T=t.dot(E),i=Math.min(T,i),A=Math.max(T,A),y.copy(l).add(g).subtract(B).subtract(C),E.copy(y).subtract(e),T=t.dot(E),i=Math.min(T,i),A=Math.max(T,A),l.copy(y).subtract(g).add(B).add(C),E.copy(y).subtract(e),T=t.dot(E),i=Math.min(T,i),A=Math.max(T,A),l.copy(y).subtract(g).add(B).subtract(C),E.copy(y).subtract(e),T=t.dot(E),i=Math.min(T,i),A=Math.max(T,A),l.copy(y).subtract(g).subtract(B).add(C),E.copy(y).subtract(e),T=t.dot(E),i=Math.min(T,i),A=Math.max(T,A),l.copy(y).subtract(g).subtract(B).subtract(C),E.copy(y).subtract(e),T=t.dot(E),i=Math.min(T,i),A=Math.max(T,A),n[0]=i,n[1]=A,n}transform(e){this.center.transformAsPoint(e);const t=this.halfAxes.getColumn(0,AA);t.transformAsPoint(e);const n=this.halfAxes.getColumn(1,rA);n.transformAsPoint(e);const i=this.halfAxes.getColumn(2,oA);return i.transformAsPoint(e),this.halfAxes=new At([...t,...n,...i]),this}getTransform(){throw new Error("not implemented")}}const O0=new k,G0=new k;class on{constructor(e=[0,0,1],t=0){this.normal=new k,this.distance=-0,this.fromNormalDistance(e,t)}fromNormalDistance(e,t){return vn(Number.isFinite(t)),this.normal.from(e).normalize(),this.distance=t,this}fromPointNormal(e,t){e=O0.from(e),this.normal.from(t).normalize();const n=-this.normal.dot(e);return this.distance=n,this}fromCoefficients(e,t,n,i){return this.normal.set(e,t,n),vn(Cn(this.normal.len(),1)),this.distance=i,this}clone(){return new on(this.normal,this.distance)}equals(e){return Cn(this.distance,e.distance)&&Cn(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const t=G0.copy(this.normal).transformAsVector(e).normalize(),n=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(n,t)}projectPointOntoPlane(e,t=[0,0,0]){const n=O0.from(e),i=this.getPointDistance(n),A=G0.copy(this.normal).scale(i);return n.subtract(A).to(t)}}const N0=[new k([1,0,0]),new k([0,1,0]),new k([0,0,1])],U0=new k,Hb=new k;class jt{constructor(e=[]){this.planes=e}fromBoundingSphere(e){this.planes.length=2*N0.length;const t=e.center,n=e.radius;let i=0;for(const A of N0){let l=this.planes[i],h=this.planes[i+1];l||(l=this.planes[i]=new on),h||(h=this.planes[i+1]=new on);const g=U0.copy(A).scale(-n).add(t);l.fromPointNormal(g,A);const B=U0.copy(A).scale(n).add(t),C=Hb.copy(A).negate();h.fromPointNormal(B,C),i+=2}return this}computeVisibility(e){let t=vt.INSIDE;for(const n of this.planes)switch(e.intersectPlane(n)){case vt.OUTSIDE:return vt.OUTSIDE;case vt.INTERSECTING:t=vt.INTERSECTING;break}return t}computeVisibilityWithPlaneMask(e,t){if(vn(Number.isFinite(t),"parentPlaneMask is required."),t===jt.MASK_OUTSIDE||t===jt.MASK_INSIDE)return t;let n=jt.MASK_INSIDE;const i=this.planes;for(let A=0;A<this.planes.length;++A){const l=A<31?1<<A:0;if(A<31&&(t&l)===0)continue;const h=i[A],g=e.intersectPlane(h);if(g===vt.OUTSIDE)return jt.MASK_OUTSIDE;g===vt.INTERSECTING&&(n|=l)}return n}}jt.MASK_OUTSIDE=4294967295;jt.MASK_INSIDE=0;jt.MASK_INDETERMINATE=2147483647;new k;new k;new k;new k;new k;new k;new k;new k;new k;new k;new k;new k;new k;new k;new k;new k;new k;const pn=new At,kb=new At,Jb=new At,aA=new At,H0=new At;function Vb(s,e={}){const t=rB,n=10;let i=0,A=0;const l=kb,h=Jb;l.identity(),h.copy(s);const g=t*zb(h);for(;A<n&&jb(h)>g;)Qb(h,aA),H0.copy(aA).transpose(),h.multiplyRight(aA),h.multiplyLeft(H0),l.multiplyRight(aA),++i>2&&(++A,i=0);return e.unitary=l.toTarget(e.unitary),e.diagonal=h.toTarget(e.diagonal),e}function zb(s){let e=0;for(let t=0;t<9;++t){const n=s[t];e+=n*n}return Math.sqrt(e)}const Yo=[1,0,0],$o=[2,2,1];function jb(s){let e=0;for(let t=0;t<3;++t){const n=s[pn.getElementIndex($o[t],Yo[t])];e+=2*n*n}return Math.sqrt(e)}function Qb(s,e){const t=th;let n=0,i=1;for(let B=0;B<3;++B){const C=Math.abs(s[pn.getElementIndex($o[B],Yo[B])]);C>n&&(i=B,n=C)}const A=Yo[i],l=$o[i];let h=1,g=0;if(Math.abs(s[pn.getElementIndex(l,A)])>t){const B=s[pn.getElementIndex(l,l)],C=s[pn.getElementIndex(A,A)],y=s[pn.getElementIndex(l,A)],E=(B-C)/2/y;let T;E<0?T=-1/(-E+Math.sqrt(1+E*E)):T=1/(E+Math.sqrt(1+E*E)),h=1/Math.sqrt(1+T*T),g=T*h}return At.IDENTITY.to(e),e[pn.getElementIndex(A,A)]=e[pn.getElementIndex(l,l)]=h,e[pn.getElementIndex(l,A)]=g,e[pn.getElementIndex(A,l)]=-g,e}const Gn=new k,Kb=new k,Wb=new k,Xb=new k,Yb=new k,$b=new At,Zb={diagonal:new At,unitary:new At};function Jh(s,e=new Gi){if(!s||s.length===0)return e.halfAxes=new At([0,0,0,0,0,0,0,0,0]),e.center=new k,e;const t=s.length,n=new k(0,0,0);for(const $ of s)n.add($);const i=1/t;n.multiplyByScalar(i);let A=0,l=0,h=0,g=0,B=0,C=0;for(const $ of s){const K=Gn.copy($).subtract(n);A+=K.x*K.x,l+=K.x*K.y,h+=K.x*K.z,g+=K.y*K.y,B+=K.y*K.z,C+=K.z*K.z}A*=i,l*=i,h*=i,g*=i,B*=i,C*=i;const y=$b;y[0]=A,y[1]=l,y[2]=h,y[3]=l,y[4]=g,y[5]=B,y[6]=h,y[7]=B,y[8]=C;const{unitary:E}=Vb(y,Zb),T=e.halfAxes.copy(E);let x=T.getColumn(0,Wb),F=T.getColumn(1,Xb),N=T.getColumn(2,Yb),R=-Number.MAX_VALUE,Q=-Number.MAX_VALUE,Y=-Number.MAX_VALUE,se=Number.MAX_VALUE,re=Number.MAX_VALUE,ue=Number.MAX_VALUE;for(const $ of s)Gn.copy($),R=Math.max(Gn.dot(x),R),Q=Math.max(Gn.dot(F),Q),Y=Math.max(Gn.dot(N),Y),se=Math.min(Gn.dot(x),se),re=Math.min(Gn.dot(F),re),ue=Math.min(Gn.dot(N),ue);x=x.multiplyByScalar(.5*(se+R)),F=F.multiplyByScalar(.5*(re+Q)),N=N.multiplyByScalar(.5*(ue+Y)),e.center.copy(x).add(F).add(N);const Te=Kb.set(R-se,Q-re,Y-ue).multiplyByScalar(.5),ge=new At([Te[0],0,0,0,Te[1],0,0,0,Te[2]]);return e.halfAxes.multiplyRight(ge),e}const Os=512,qb=3,Vh=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],zh=Vh.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),eE=zh.concat([[.25,.5],[.75,.5]]);class Gs{constructor(e,t,n){this.x=e,this.y=t,this.z=n}get children(){if(!this._children){const e=this.x*2,t=this.y*2,n=this.z+1;this._children=[new Gs(e,t,n),new Gs(e,t+1,n),new Gs(e+1,t,n),new Gs(e+1,t+1,n)]}return this._children}update(e){const{viewport:t,cullingVolume:n,elevationBounds:i,minZ:A,maxZ:l,bounds:h,offset:g,project:B}=e,C=this.getBoundingVolume(i,g,B);if(h&&!this.insideBounds(h)||n.computeVisibility(C)<0)return!1;if(!this.childVisible){let{z:E}=this;if(E<l&&E>=A){const T=C.distanceTo(t.cameraPosition)*t.scale/t.height;E+=Math.floor(Math.log2(T))}if(E>=l)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const E of this.children)E.update(e);return!0}getSelected(e=[]){if(this.selected&&e.push(this),this._children)for(const t of this._children)t.getSelected(e);return e}insideBounds([e,t,n,i]){const A=Math.pow(2,this.z),l=Os/A;return this.x*l<n&&this.y*l<i&&(this.x+1)*l>e&&(this.y+1)*l>t}getBoundingVolume(e,t,n){if(n){const g=this.z<1?eE:this.z<2?zh:Vh,B=[];for(const C of g){const y=qo(this.x+C[0],this.y+C[1],this.z);y[2]=e[0],B.push(n(y)),e[0]!==e[1]&&(y[2]=e[1],B.push(n(y)))}return Jh(B)}const i=Math.pow(2,this.z),A=Os/i,l=this.x*A+t*Os,h=Os-(this.y+1)*A;return new Ga([l,h,e[0]],[l+A,h+A,e[1]])}}function tE(s,e,t,n){const i=s instanceof Ta&&s.resolution?s.projectPosition:null,A=Object.values(s.getFrustumPlanes()).map(({normal:T,distance:x})=>new on(T.clone().negate(),x)),l=new jt(A),h=s.distanceScales.unitsPerMeter[2],g=t&&t[0]*h||0,B=t&&t[1]*h||0,C=s instanceof Ei&&s.pitch<=60?e:0;if(n){const[T,x,F,N]=n,R=Qs([T,N]),Q=Qs([F,x]);n=[R[0],Os-R[1],Q[0],Os-Q[1]]}const y=new Gs(0,0,0),E={viewport:s,project:i,cullingVolume:l,elevationBounds:[g,B],minZ:C,maxZ:e,bounds:n,offset:0};if(y.update(E),s instanceof Ei&&s.subViewports&&s.subViewports.length>1){for(E.offset=-1;y.update(E)&&!(--E.offset<-3););for(E.offset=1;y.update(E)&&!(++E.offset>qb););}return y.getSelected()}const Sn=512,nE=[-1/0,-1/0,1/0,1/0],JA={type:"object",value:null,validate:(s,e)=>e.optional&&s===null||typeof s=="string"||Array.isArray(s)&&s.every(t=>typeof t=="string"),equal:(s,e)=>{if(s===e)return!0;if(!Array.isArray(s)||!Array.isArray(e))return!1;const t=s.length;if(t!==e.length)return!1;for(let n=0;n<t;n++)if(s[n]!==e[n])return!1;return!0}};function jh(s,e){const t=[e.transformAsPoint([s[0],s[1]]),e.transformAsPoint([s[2],s[1]]),e.transformAsPoint([s[0],s[3]]),e.transformAsPoint([s[2],s[3]])];return[Math.min(...t.map(i=>i[0])),Math.min(...t.map(i=>i[1])),Math.max(...t.map(i=>i[0])),Math.max(...t.map(i=>i[1]))]}function sE(s){return Math.abs(s.split("").reduce((e,t)=>(e<<5)-e+t.charCodeAt(0)|0,0))}function VA(s,e){if(!s||!s.length)return null;const{index:t,id:n}=e;if(Array.isArray(s)){const A=sE(n)%s.length;s=s[A]}let i=s;for(const A of Object.keys(t)){const l=new RegExp(`{${A}}`,"g");i=i.replace(l,String(t[A]))}return Number.isInteger(t.y)&&Number.isInteger(t.z)&&(i=i.replace(/\{-y\}/g,String(Math.pow(2,t.z)-t.y-1))),i}function iE(s,e,t){let n;return n=s.getBounds(),s.isGeospatial?[Math.max(n[0],t[0]),Math.max(n[1],t[1]),Math.min(n[2],t[2]),Math.min(n[3],t[3])]:[Math.max(Math.min(n[0],t[2]),t[0]),Math.max(Math.min(n[1],t[3]),t[1]),Math.min(Math.max(n[2],t[0]),t[2]),Math.min(Math.max(n[3],t[1]),t[3])]}function AE({viewport:s,z:e,cullRect:t}){return(s.subViewports||[s]).map(i=>Zo(i,e||0,t))}function Zo(s,e,t){if(!Array.isArray(e)){const A=t.x-s.x,l=t.y-s.y,{width:h,height:g}=t,B={targetZ:e},C=s.unproject([A,l],B),y=s.unproject([A+h,l],B),E=s.unproject([A,l+g],B),T=s.unproject([A+h,l+g],B);return[Math.min(C[0],y[0],E[0],T[0]),Math.min(C[1],y[1],E[1],T[1]),Math.max(C[0],y[0],E[0],T[0]),Math.max(C[1],y[1],E[1],T[1])]}const n=Zo(s,e[0],t),i=Zo(s,e[1],t);return[Math.min(n[0],i[0]),Math.min(n[1],i[1]),Math.max(n[2],i[2]),Math.max(n[3],i[3])]}function rE(s,e,t){return t?jh(s,t).map(i=>i*e/Sn):s.map(n=>n*e/Sn)}function Na(s,e){return Math.pow(2,s)*Sn/e}function qo(s,e,t){const n=Na(t,Sn),i=s/n*360-180,A=Math.PI-2*Math.PI*e/n,l=180/Math.PI*Math.atan(.5*(Math.exp(A)-Math.exp(-A)));return[i,l]}function k0(s,e,t,n){const i=Na(t,n);return[s/i*Sn,e/i*Sn]}function oE(s,e,t,n,i=Sn){if(s.isGeospatial){const[B,C]=qo(e,t,n),[y,E]=qo(e+1,t+1,n);return{west:B,north:C,east:y,south:E}}const[A,l]=k0(e,t,n,i),[h,g]=k0(e+1,t+1,n,i);return{left:A,top:l,right:h,bottom:g}}function aE(s,e,t,n,i){const A=iE(s,null,n),l=Na(e,t),[h,g,B,C]=rE(A,l,i),y=[];for(let E=Math.floor(h);E<B;E++)for(let T=Math.floor(g);T<C;T++)y.push({x:E,y:T,z:e});return y}function cE({viewport:s,maxZoom:e,minZoom:t,zRange:n,extent:i,tileSize:A=Sn,modelMatrix:l,modelMatrixInverse:h,zoomOffset:g=0}){let B=s.isGeospatial?Math.round(s.zoom+Math.log2(Sn/A))+g:Math.ceil(s.zoom)+g;if(typeof t=="number"&&Number.isFinite(t)&&B<t){if(!i)return[];B=t}typeof e=="number"&&Number.isFinite(e)&&B>e&&(B=e);let C=i;return l&&h&&i&&!s.isGeospatial&&(C=jh(i,l)),s.isGeospatial?tE(s,B,n,i):aE(s,B,A,C||nE,h)}function lE(s){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(s)}function uE(s){return Number.isFinite(s.west)&&Number.isFinite(s.north)&&Number.isFinite(s.east)&&Number.isFinite(s.south)}function fE(s){let e={},t;return n=>{for(const i in n)if(!hE(n[i],e[i])){t=s(n),e=n;break}return t}}function hE(s,e){if(s===e)return!0;if(Array.isArray(s)){const t=s.length;if(!e||e.length!==t)return!1;for(let n=0;n<t;n++)if(s[n]!==e[n])return!1;return!0}return!1}const J0=1,lr=2,dE="never",gE="no-overlap",Ua="best-available",pE=5,mE={[Ua]:_E,[gE]:yE,[dE]:()=>{}},BE={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}};class CE{constructor(e){this._getCullBounds=fE(AE),this.opts={...BE,...e},this.setOptions(this.opts),this.onTileLoad=t=>{var n,i;(i=(n=this.opts).onTileLoad)==null||i.call(n,t),this.opts.maxCacheByteSize!==null&&(this._cacheByteSize+=t.byteLength,this._resizeCache())},this._requestScheduler=new Xf({throttleRequests:this.opts.maxRequests>0||this.opts.debounceTime>0,maxRequests:this.opts.maxRequests,debounceTime:this.opts.debounceTime}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._zRange=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new Fe,this._modelMatrixInverse=new Fe}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(e=>e.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(e=>e.needsReload)}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(const e of this._cache.values())e.isLoading&&e.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const e of this._cache.keys()){const t=this._cache.get(e);!this._selectedTiles||!this._selectedTiles.includes(t)?this._cache.delete(e):t.setNeedsReload()}}update(e,{zRange:t,modelMatrix:n}={zRange:null,modelMatrix:null}){const i=n?new Fe(n):new Fe,A=!i.equals(this._modelMatrix);if(!this._viewport||!e.equals(this._viewport)||!Cn(this._zRange,t)||A){A&&(this._modelMatrixInverse=i.clone().invert(),this._modelMatrix=i),this._viewport=e,this._zRange=t;const h=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:t,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=h.map(g=>this._getTile(g,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(h=>this._getTile(h.index,!0)));const l=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),l&&this._frameNumber++,this._frameNumber}isTileVisible(e,t){if(!e.isVisible)return!1;if(t&&this._viewport){const n=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:t}),{bbox:i}=e;for(const[A,l,h,g]of n){let B;if("west"in i)B=i.west<h&&i.east>A&&i.south<g&&i.north>l;else{const C=Math.min(i.top,i.bottom),y=Math.max(i.top,i.bottom);B=i.left<h&&i.right>A&&C<g&&y>l}if(B)return!0}return!1}return!0}getTileIndices({viewport:e,maxZoom:t,minZoom:n,zRange:i,modelMatrix:A,modelMatrixInverse:l}){const{tileSize:h,extent:g,zoomOffset:B}=this.opts;return cE({viewport:e,maxZoom:t,minZoom:n,zRange:i,tileSize:h,extent:g,modelMatrix:A,modelMatrixInverse:l,zoomOffset:B})}getTileId(e){return`${e.x}-${e.y}-${e.z}`}getTileZoom(e){return e.z}getTileMetadata(e){const{tileSize:t}=this.opts;return{bbox:oE(this._viewport,e.x,e.y,e.z,t)}}getParentIndex(e){const t=Math.floor(e.x/2),n=Math.floor(e.y/2),i=e.z-1;return{x:t,y:n,z:i}}updateTileStates(){const e=this.opts.refinementStrategy||Ua,t=new Array(this._cache.size);let n=0;for(const i of this._cache.values())t[n++]=i.isVisible,i.isSelected=!1,i.isVisible=!1;for(const i of this._selectedTiles)i.isSelected=!0,i.isVisible=!0;(typeof e=="function"?e:mE[e])(Array.from(this._cache.values())),n=0;for(const i of this._cache.values())if(t[n++]!==i.isVisible)return!0;return!1}_pruneRequests(){const{maxRequests:e=0}=this.opts,t=[];let n=0;for(const i of this._cache.values())i.isLoading&&(n++,!i.isSelected&&!i.isVisible&&t.push(i));for(;e>0&&n>e&&t.length>0;)t.shift().abort(),n--}_rebuildTree(){const{_cache:e}=this;for(const t of e.values())t.parent=null,t.children&&(t.children.length=0);for(const t of e.values()){const n=this._getNearestAncestor(t);t.parent=n,n!=null&&n.children&&n.children.push(t)}}_resizeCache(){var l,h;const{_cache:e,opts:t}=this,n=t.maxCacheSize??(t.maxCacheByteSize!==null?1/0:pE*this.selectedTiles.length),i=t.maxCacheByteSize??1/0;if(e.size>n||this._cacheByteSize>i){for(const[g,B]of e)if(!B.isVisible&&!B.isSelected&&(this._cacheByteSize-=t.maxCacheByteSize!==null?B.byteLength:0,e.delete(g),(h=(l=this.opts).onTileUnload)==null||h.call(l,B)),e.size<=n&&this._cacheByteSize<=i)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((g,B)=>g.zoom-B.zoom),this._dirty=!1)}_getTile(e,t){const n=this.getTileId(e);let i=this._cache.get(n),A=!1;return!i&&t?(i=new Lb(e),Object.assign(i,this.getTileMetadata(i.index)),Object.assign(i,{id:n,zoom:this.getTileZoom(i.index)}),A=!0,this._cache.set(n,i),this._dirty=!0):i&&i.needsReload&&(A=!0),i&&A&&i.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),i}_getNearestAncestor(e){const{_minZoom:t=0}=this;let n=e.index;for(;this.getTileZoom(n)>t;){n=this.getParentIndex(n);const i=this._getTile(n);if(i)return i}return null}}function _E(s){for(const e of s)e.state=0;for(const e of s)e.isSelected&&!Qh(e)&&Ha(e);for(const e of s)e.isVisible=!!(e.state&lr)}function yE(s){for(const t of s)t.state=0;for(const t of s)t.isSelected&&Qh(t);const e=Array.from(s).sort((t,n)=>t.zoom-n.zoom);for(const t of e)if(t.isVisible=!!(t.state&lr),t.children&&(t.isVisible||t.state&J0))for(const n of t.children)n.state=J0;else t.isSelected&&Ha(t)}function Qh(s){let e=s;for(;e;){if(e.isLoaded||e.content)return e.state|=lr,!0;e=e.parent}return!1}function Ha(s){for(const e of s.children)e.isLoaded||e.content?e.state|=lr:Ha(e)}const bE={TilesetClass:CE,data:{type:"data",value:[]},dataComparator:JA.equal,renderSubLayers:{type:"function",value:s=>new Fi(s)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:s=>{}},onTileUnload:{type:"function",value:s=>{}},onTileError:{type:"function",value:s=>console.error(s)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:Ua,zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0};class Ni extends xn{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){var e,t;(t=(e=this.state)==null?void 0:e.tileset)==null||t.finalize()}get isLoaded(){var e,t,n;return!!((n=(t=(e=this.state)==null?void 0:e.tileset)==null?void 0:t.selectedTiles)!=null&&n.every(i=>i.isLoaded&&i.layers&&i.layers.every(A=>A.isLoaded)))}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({changeFlags:e}){let{tileset:t}=this.state;const n=e.propsOrDataChanged||e.updateTriggersChanged,i=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getTileData);t?n&&(t.setOptions(this._getTilesetOptions()),i?t.reloadAll():t.tiles.forEach(A=>{A.layers=null})):(t=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:t})),this._updateTileset()}_getTilesetOptions(){const{tileSize:e,maxCacheSize:t,maxCacheByteSize:n,refinementStrategy:i,extent:A,maxZoom:l,minZoom:h,maxRequests:g,debounceTime:B,zoomOffset:C}=this.props;return{maxCacheSize:t,maxCacheByteSize:n,maxZoom:l,minZoom:h,tileSize:e,refinementStrategy:i,extent:A,maxRequests:g,debounceTime:B,zoomOffset:C,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const e=this.state.tileset,{zRange:t,modelMatrix:n}=this.props,i=e.update(this.context.viewport,{zRange:t,modelMatrix:n}),{isLoaded:A}=e,l=this.state.isLoaded!==A,h=this.state.frameNumber!==i;A&&(l||h)&&this._onViewportLoad(),h&&this.setState({frameNumber:i}),this.state.isLoaded=A}_onViewportLoad(){const{tileset:e}=this.state,{onViewportLoad:t}=this.props;t&&t(e.selectedTiles)}_onTileLoad(e){this.props.onTileLoad(e),e.layers=null,this.setNeedsUpdate()}_onTileError(e,t){this.props.onTileError(e),t.layers=null,this.setNeedsUpdate()}_onTileUnload(e){this.props.onTileUnload(e)}getTileData(e){const{data:t,getTileData:n,fetch:i}=this.props,{signal:A}=e;return e.url=typeof t=="string"||Array.isArray(t)?VA(t,e):null,n?n(e):i&&e.url?i(e.url,{propName:"data",layer:this,signal:A}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getSubLayerPropsByTile(e){return null}getPickingInfo(e){const t=e.sourceLayer,n=t.props.tile,i=e.info;return i.picked&&(i.tile=n),i.sourceTile=n,i.sourceTileSubLayer=t,i}_updateAutoHighlight(e){e.sourceTileSubLayer.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map(e=>{const t=this.getSubLayerPropsByTile(e);if(!(!e.isLoaded&&!e.content))if(e.layers)t&&e.layers[0]&&Object.keys(t).some(n=>e.layers[0].props[n]!==t[n])&&(e.layers=e.layers.map(n=>n.clone(t)));else{const n=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:e.id,updateTriggers:this.props.updateTriggers}),data:e.content,_offset:0,tile:e});e.layers=l1(n,Boolean).map(i=>i.clone({tile:e,...t}))}return e.layers})}filterSubLayer({layer:e,cullRect:t}){const{tile:n}=e.props;return this.state.tileset.isTileVisible(n,t)}}Ni.defaultProps=bE;Ni.layerName="TileLayer";const V0=`uniform tripsUniforms {
  bool fadeTrail;
  float trailLength;
  float currentTime;
} trips;
`,EE={name:"trips",vs:V0,fs:V0,uniformTypes:{fadeTrail:"f32",trailLength:"f32",currentTime:"f32"}},TE={fadeTrail:!0,trailLength:{type:"number",value:120,min:0},currentTime:{type:"number",value:0,min:0},getTimestamps:{type:"accessor",value:s=>s.timestamps}};class Kh extends ma{getShaders(){const e=super.getShaders();return e.inject={"vs:#decl":`in float instanceTimestamps;
in float instanceNextTimestamps;
out float vTime;
`,"vs:#main-end":`vTime = instanceTimestamps + (instanceNextTimestamps - instanceTimestamps) * vPathPosition.y / vPathLength;
`,"fs:#decl":`in float vTime;
`,"fs:#main-start":`if(vTime > trips.currentTime || (trips.fadeTrail && (vTime < trips.currentTime - trips.trailLength))) {
  discard;
}
`,"fs:DECKGL_FILTER_COLOR":`if(trips.fadeTrail) {
  color.a *= 1.0 - (trips.currentTime - vTime) / trips.trailLength;
}
`},e.modules=[...e.modules,EE],e}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({timestamps:{size:1,accessor:"getTimestamps",shaderAttributes:{instanceTimestamps:{vertexOffset:0},instanceNextTimestamps:{vertexOffset:1}}}})}draw(e){const{fadeTrail:t,trailLength:n,currentTime:i}=this.props,A={fadeTrail:t,trailLength:n,currentTime:i};this.state.model.shaderInputs.setProps({trips:A}),super.draw(e)}}Kh.layerName="TripsLayer";Kh.defaultProps=TE;var Ve=function(s){s=s||{};var e=typeof s<"u"?s:{},t={},n;for(n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);var i="";function A(j){return e.locateFile?e.locateFile(j,i):i+j}var l;typeof document<"u"&&document.currentScript&&(i=document.currentScript.src),i.indexOf("blob:")!==0?i=i.substr(0,i.lastIndexOf("/")+1):i="",l=function(Z,le,Be){var a=new XMLHttpRequest;a.open("GET",Z,!0),a.responseType="arraybuffer",a.onload=function(){if(a.status==200||a.status==0&&a.response){le(a.response);return}var Ne=Mr(Z);if(Ne){le(Ne.buffer);return}Be()},a.onerror=Be,a.send(null)};var h=e.print||console.log.bind(console),g=e.printErr||console.warn.bind(console);for(n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);t=null,e.arguments&&e.arguments;var B=0,C=function(j){B=j},y=function(){return B},E=8;function T(j,Z,le,Be){switch(le=le||"i8",le.charAt(le.length-1)==="*"&&(le="i32"),le){case"i1":ne[j>>0]=Z;break;case"i8":ne[j>>0]=Z;break;case"i16":Le[j>>1]=Z;break;case"i32":Re[j>>2]=Z;break;case"i64":Ir=[Z>>>0,(fs=Z,+Zg(fs)>=1?fs>0?(tp(+ep(fs/4294967296),4294967295)|0)>>>0:~~+qg((fs-+(~~fs>>>0))/4294967296)>>>0:0)],Re[j>>2]=Ir[0],Re[j+4>>2]=Ir[1];break;case"float":Ye[j>>2]=Z;break;case"double":it[j>>3]=Z;break;default:hs("invalid type for setValue: "+le)}}function x(j,Z,le){switch(Z=Z||"i8",Z.charAt(Z.length-1)==="*"&&(Z="i32"),Z){case"i1":return ne[j>>0];case"i8":return ne[j>>0];case"i16":return Le[j>>1];case"i32":return Re[j>>2];case"i64":return Re[j>>2];case"float":return Ye[j>>2];case"double":return it[j>>3];default:hs("invalid type for getValue: "+Z)}return null}var F=!1;function N(j,Z){j||hs("Assertion failed: "+Z)}function R(j){var Z=e["_"+j];return N(Z,"Cannot call unknown function "+j+", make sure it is exported"),Z}function Q(j,Z,le,Be,a){var M={string:function(we){var Xt=0;if(we!=null&&we!==0){var Hi=(we.length<<2)+1;Xt=_c(Hi),ge(we,Xt,Hi)}return Xt},array:function(we){var Xt=_c(we.length);return $(we,Xt),Xt}};function Ne(we){return Z==="string"?ue(we):Z==="boolean"?!!we:we}var Qe=R(j),ht=[],De=0;if(Be)for(var Ue=0;Ue<Be.length;Ue++){var Pn=M[le[Ue]];Pn?(De===0&&(De=mp()),ht[Ue]=Pn(Be[Ue])):ht[Ue]=Be[Ue]}var Ke=Qe.apply(null,ht);return Ke=Ne(Ke),De!==0&&pp(De),Ke}function Y(j,Z,le,Be){le=le||[];var a=le.every(function(Ne){return Ne==="number"}),M=Z!=="string";return M&&a&&!Be?R(j):function(){return Q(j,Z,le,arguments)}}var se=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function re(j,Z,le){for(var Be=Z+le,a=Z;j[a]&&!(a>=Be);)++a;if(a-Z>16&&j.subarray&&se)return se.decode(j.subarray(Z,a));for(var M="";Z<a;){var Ne=j[Z++];if(!(Ne&128)){M+=String.fromCharCode(Ne);continue}var Qe=j[Z++]&63;if((Ne&224)==192){M+=String.fromCharCode((Ne&31)<<6|Qe);continue}var ht=j[Z++]&63;if((Ne&240)==224?Ne=(Ne&15)<<12|Qe<<6|ht:Ne=(Ne&7)<<18|Qe<<12|ht<<6|j[Z++]&63,Ne<65536)M+=String.fromCharCode(Ne);else{var De=Ne-65536;M+=String.fromCharCode(55296|De>>10,56320|De&1023)}}return M}function ue(j,Z){return j?re(he,j,Z):""}function Te(j,Z,le,Be){if(!(Be>0))return 0;for(var a=le,M=le+Be-1,Ne=0;Ne<j.length;++Ne){var Qe=j.charCodeAt(Ne);if(Qe>=55296&&Qe<=57343){var ht=j.charCodeAt(++Ne);Qe=65536+((Qe&1023)<<10)|ht&1023}if(Qe<=127){if(le>=M)break;Z[le++]=Qe}else if(Qe<=2047){if(le+1>=M)break;Z[le++]=192|Qe>>6,Z[le++]=128|Qe&63}else if(Qe<=65535){if(le+2>=M)break;Z[le++]=224|Qe>>12,Z[le++]=128|Qe>>6&63,Z[le++]=128|Qe&63}else{if(le+3>=M)break;Z[le++]=240|Qe>>18,Z[le++]=128|Qe>>12&63,Z[le++]=128|Qe>>6&63,Z[le++]=128|Qe&63}}return Z[le]=0,le-a}function ge(j,Z,le){return Te(j,he,Z,le)}typeof TextDecoder<"u"&&new TextDecoder("utf-16le");function $(j,Z){ne.set(j,Z)}function K(j,Z){return j%Z>0&&(j+=Z-j%Z),j}var O,ne,he,Le,Re,Ye,it;function ot(j){O=j,e.HEAP8=ne=new Int8Array(j),e.HEAP16=Le=new Int16Array(j),e.HEAP32=Re=new Int32Array(j),e.HEAPU8=he=new Uint8Array(j),e.HEAPU16=new Uint16Array(j),e.HEAPU32=new Uint32Array(j),e.HEAPF32=Ye=new Float32Array(j),e.HEAPF64=it=new Float64Array(j)}var ct=5267040,We=24128,qe=e.TOTAL_MEMORY||33554432;e.buffer?O=e.buffer:O=new ArrayBuffer(qe),qe=O.byteLength,ot(O),Re[We>>2]=ct;function rt(j){for(;j.length>0;){var Z=j.shift();if(typeof Z=="function"){Z();continue}var le=Z.func;typeof le=="number"?Z.arg===void 0?e.dynCall_v(le):e.dynCall_vi(le,Z.arg):le(Z.arg===void 0?null:Z.arg)}}var Wt=[],zg=[],jg=[],mc=[];function Qg(){if(e.preRun)for(typeof e.preRun=="function"&&(e.preRun=[e.preRun]);e.preRun.length;)Yg(e.preRun.shift());rt(Wt)}function Kg(){rt(zg)}function Wg(){rt(jg)}function Xg(){if(e.postRun)for(typeof e.postRun=="function"&&(e.postRun=[e.postRun]);e.postRun.length;)$g(e.postRun.shift());rt(mc)}function Yg(j){Wt.unshift(j)}function $g(j){mc.unshift(j)}var Zg=Math.abs,qg=Math.ceil,ep=Math.floor,tp=Math.min,zn=0,Ai=null;function np(j){zn++,e.monitorRunDependencies&&e.monitorRunDependencies(zn)}function sp(j){if(zn--,e.monitorRunDependencies&&e.monitorRunDependencies(zn),zn==0&&Ai){var Z=Ai;Ai=null,Z()}}e.preloadedImages={},e.preloadedAudios={};var yn=null,vr="data:application/octet-stream;base64,";function Bc(j){return String.prototype.startsWith?j.startsWith(vr):j.indexOf(vr)===0}var fs,Ir;yn="data:application/octet-stream;base64,AAAAAAAAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAAAQAAAAQAAAADAAAABgAAAAUAAAACAAAAAAAAAAIAAAADAAAAAQAAAAQAAAAGAAAAAAAAAAUAAAADAAAABgAAAAQAAAAFAAAAAAAAAAEAAAACAAAABAAAAAUAAAAGAAAAAAAAAAIAAAADAAAAAQAAAAUAAAACAAAAAAAAAAEAAAADAAAABgAAAAQAAAAGAAAAAAAAAAUAAAACAAAAAQAAAAQAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAAAAAAEAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAYAAAAAAAAABQAAAAAAAAAAAAAABAAAAAUAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAYAAAAAAAAABgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAIAAAAAAAAAAAAAAAYAAAAAAAAAAwAAAAIAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAFAAAABAAAAAAAAAABAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAYAAAAAAAAABAAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAgAAAAQAAAADAAAACAAAAAEAAAAHAAAABgAAAAkAAAAAAAAAAwAAAAIAAAACAAAA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AAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAUAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABAAAAAUAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAUAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAD//////////wEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAAAAAAAAAAABAAAAAgAAAAYAAAAEAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAAAAAAAAAAAAQAAAAEAAAAFAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAAAAAAAAAAABAAAAAwAAAAcAAAAGAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADgAAAAIAAAAAAAAAAAAAAAEAAAAAAAAACQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAAAAAAAAAAAAAEAAAAEAAAACAAAAAoAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAAAAAAAAAAAAQAAAAsAAAAPAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAIAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAAAAAAAAAAAAQAAAAwAAAAQAAAADAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAAAAAAAAAAABAAAACgAAABMAAAAIAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAAAAAAAAAAAAAEAAAANAAAAEQAAAA0AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAACAAAAAAAAAAAAAAABAAAADgAAABIAAAAPAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAADwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABIAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAAAAAAAAQAAAP//////////EwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAASAAAAAAAAABgAAAAAAAAAIQAAAAAAAAAeAAAAAAAAACAAAAADAAAAMQAAAAEAAAAwAAAAAwAAADIAAAADAAAACAAAAAAAAAAFAAAABQAAAAoAAAAFAAAAFgAAAAAAAAAQAAAAAAAAABIAAAAAAAAAKQAAAAEAAAAhAAAAAAAAAB4AAAAAAAAABAAAAAAAAAAAAAAABQAAAAIAAAAFAAAADwAAAAEAAAAIAAAAAAAAAAUAAAAFAAAAHwAAAAEAAAAWAAAAAAAAABAAAAAAAAAAAgAAAAAAAAAGAAAAAAAAAA4AAAAAAAAACgAAAAAAAAALAAAAAAAAABEAAAADAAAAGAAAAAEAAAAXAAAAAwAAABkAAAADAAAAAAAAAAAAAAABAAAABQAAAAkAAAAFAAAABQAAAAAAAAACAAAAAAAAAAYAAAAAAAAAEgAAAAEAAAAKAAAAAAAAAAsAAAAAAAAABAAAAAEAAAADAAAABQAAAAcAAAAFAAAACAAAAAEAAAAAAAAAAAAAAAEAAAAFAAAAEAAAAAEAAAAFAAAAAAAAAAIAAAAAAAAABwAAAAAAAAAVAAAAAAAAACYAAAAAAAAACQAAAAAAAAATAAAAAAAAACIAAAADAAAADgAAAAEAAAAUAAAAAwAAACQAAAADAAAAAwAAAAAAAAANAAAABQAAAB0AAAAFAAAAAQAAAAAAAAAHAAAAAAAAABUAAAAAAAAABgAAAAEAAAAJAAAAAAAAABMAAAAAAAAABAAAAAIAAAAMAAAA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Zhu25b633D8c1YgmzowSQNM25BRKWARArGS08/lNxD+LFssHwmMRQLC5aNcxBgJABL9HT0WRF0CjCmJmOGEOQHsuaVzMP/s/TWJCaGGwBUCeu1PAPLzjP9nqN9DZOBNAKE4JcydbCkCGtbd1qjPzP8dgm9U8jhVAtPeKTkVwDkCeCLss5l37P401XMPLmBdAFd29VMVQDUBg0yA55h75Pz6odcYLCRdApBM4rBrkAkDyAVWgQxbRP4XDMnK20hFAymLlF7EmzD8GUgo9XBHlP3lbK7T9COc/k+OhPthhy7+YGEpnrOvCPzBFhLs15u4/epbqB6H4uz9IuuLF5svev6lzLKY31es/CaQ0envF5z8ZY0xlUADXv7zaz7HYEuI/CfbK1sn16T8uAQfWwxLWPzKn/YuFN94/5KdbC1AFu793fyCSnlfvPzK2y4doAMY/NRg5t1/X6b/shq4QJaHDP5yNIAKPOeI/vpn7BSE30r/X4YQrO6nrv78Ziv/Thto/DqJ1Y6+y5z9l51NaxFrlv8QlA65HOLS/86dxiEc96z+Hj0+LFjneP6LzBZ8LTc2/DaJ1Y6+y579l51NaxFrlP8QlA65HOLQ/8qdxiEc967+Jj0+LFjnev6LzBZ8LTc0/1qdbC1AFuz93fyCSnlfvvzK2y4doAMa/NRg5t1/X6T/vhq4QJaHDv5yNIAKPOeK/wJn7BSE30j/W4YQrO6nrP78Ziv/Thtq/CaQ0envF578XY0xlUADXP7zaz7HYEuK/CvbK1sn16b8rAQfWwxLWvzKn/YuFN96/zWLlF7EmzL8GUgo9XBHlv3lbK7T9COe/kOOhPthhyz+cGEpnrOvCvzBFhLs15u6/c5bqB6H4u79IuuLF5sveP6lzLKY31eu/AQAAAP////8HAAAA/////zEAAAD/////VwEAAP////9hCQAA/////6dBAAD/////kcsBAP/////3kAwA/////8H2VwAAAAAAAAAAAAAAAAACAAAA/////w4AAAD/////YgAAAP////+uAgAA/////8ISAAD/////ToMAAP////8ilwMA/////+4hGQD/////gu2vAAAAAAAAAAAAAAAAAAAAAAACAAAA//////////8BAAAAAwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////AgAAAP//////////AQAAAAAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD/////////////////////AQAAAP///////////////wIAAAD///////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP///////////////////////////////wIAAAD///////////////8BAAAA/////////////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAABAAAA//////////8CAAAA//////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAAAQAAAP//////////AgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAACAAAAAAAAAAIAAAABAAAAAQAAAAIAAAACAAAAAAAAAAUAAAAFAAAAAAAAAAIAAAACAAAAAwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAEAAAACAAAAAgAAAAIAAAAAAAAABQAAAAYAAAAAAAAAAgAAAAIAAAADAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAAAAAACAAAAAQAAAAMAAAACAAAAAgAAAAAAAAAFAAAABwAAAAAAAAACAAAAAgAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAACAAAAAAAAAAIAAAABAAAABAAAAAIAAAACAAAAAAAAAAUAAAAIAAAAAAAAAAIAAAACAAAAAwAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAIAAAAAAAAAAgAAAAEAAAAAAAAAAgAAAAIAAAAAAAAABQAAAAkAAAAAAAAAAgAAAAIAAAADAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAIAAAAAAAAAAwAAAA4AAAACAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAgAAAAMAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAgAAAAAAAAADAAAACgAAAAIAAAAAAAAAAgAAAAMAAAABAAAAAAAAAAIAAAACAAAAAwAAAAcAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAACAAAAAAAAAAMAAAALAAAAAgAAAAAAAAACAAAAAwAAAAIAAAAAAAAAAgAAAAIAAAADAAAACAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAIAAAAAAAAAAwAAAAwAAAACAAAAAAAAAAIAAAADAAAAAwAAAAAAAAACAAAAAgAAAAMAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAACAAAAAgAAAAAAAAADAAAADQAAAAIAAAAAAAAAAgAAAAMAAAAEAAAAAAAAAAIAAAACAAAAAwAAAAoAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAACAAAAAAAAAAMAAAAGAAAAAgAAAAAAAAACAAAAAwAAAA8AAAAAAAAAAgAAAAIAAAADAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAIAAAAAAAAAAwAAAAcAAAACAAAAAAAAAAIAAAADAAAAEAAAAAAAAAACAAAAAgAAAAMAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAgAAAAAAAAADAAAACAAAAAIAAAAAAAAAAgAAAAMAAAARAAAAAAAAAAIAAAACAAAAAwAAAA0AAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAACAAAAAAAAAAMAAAAJAAAAAgAAAAAAAAACAAAAAwAAABIAAAAAAAAAAgAAAAIAAAADAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAgAAAAIAAAAAAAAAAwAAAAUAAAACAAAAAAAAAAIAAAADAAAAEwAAAAAAAAACAAAAAgAAAAMAAAAPAAAAAAAAAAAAAAAAAAAAAAAAABAAAAACAAAAAAAAAAIAAAABAAAAEwAAAAIAAAACAAAAAAAAAAUAAAAKAAAAAAAAAAIAAAACAAAAAwAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAIAAAAAAAAAAgAAAAEAAAAPAAAAAgAAAAIAAAAAAAAABQAAAAsAAAAAAAAAAgAAAAIAAAADAAAAEQAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAgAAAAAAAAACAAAAAQAAABAAAAACAAAAAgAAAAAAAAAFAAAADAAAAAAAAAACAAAAAgAAAAMAAAASAAAAAAAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAIAAAABAAAAEQAAAAIAAAACAAAAAAAAAAUAAAANAAAAAAAAAAIAAAACAAAAAwAAABMAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAIAAAAAAAAAAgAAAAEAAAASAAAAAgAAAAIAAAAAAAAABQAAAA4AAAAAAAAAAgAAAAIAAAADAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAAAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAOgehWlKfUEEz1zLi+JsiQa2og3wcMfVAWCbHorc0yEDi+Yn/Y6mbQJ11/mfsnG9At6bnG4UQQkBvMCQWKqUUQJVmwwswmOc/3hVgVBL3uj//qqOEOdGOPw/WDN4gnGE/H3ANkCUgND+AA8btKgAHPwTXBqJVSdo+XfRQAqsKrj4fc+zLYbSPQklEmCZHv2FCUP+uDso1NEKYtPhwphUHQptxnyFXYdpB7CddZAMmrkGAt1AxSTqBQUibBVdTsFNBSuX3MV+AJkFocv82SLf5QAqmgj7AY81A23VDSEnLoEDGEJVSeDFzQDYrqvBk70VA8U157pcRGUBWfEF+ZKbsP7KBdLHZTpFAqKYk69AqekDbeGY41MdjQD8AZzHK501A1vcrrjubNkD5LnquvBYhQCbiRRD71QlAqt72EbOH8z8Eu+jL1YbdP4uaox/xUcY/abedg1XfsD+BsUdzJ4KZP5wE9YFySIM/rW1kAKMpbT+rZFthVRhWPy4PKlXIs0A/qMZLlwDnMEHByqEF0I0ZQQYSFD8lUQNBPpY+dFs07UAH8BZImBPWQN9RY0I0sMBA2T7kLfc6qUByFYvfhBKTQMq+0Mis1XxA0XQbeQXMZUBJJ5aEGXpQQP7/SY0a6ThAaMD92b/UIkAs8s8yqXoMQNIegOvCk/U/aOi7NZJP4D8AAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAD/////AAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAA/////wAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAP////8AAAAABQAAAAAAAAAAAAAAAAAAAAAAAAD/////BQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAABAAAAAAAAAAUAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAEAAQAAAQEAAAAAAAEAAAABAAAAAQABAAAAAAAAAAAAAAAAAAAAAAcAAAAHAAAAAQAAAAIAAAAEAAAAAwAAAAAAAAAAAAAABwAAAAMAAAABAAAAAgAAAAUAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAGAAAAAgAAAAMAAAAFAAAABAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAwAAAAEAAAAFAAAABAAAAAAAAAAAAAAABwAAAAUAAAADAAAABAAAAAEAAAAAAAAAAgAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAAGFsZ29zLmMAaDNOZWlnaGJvclJvdGF0aW9ucwBjb29yZGlqay5jAF91cEFwN0NoZWNrZWQAX3VwQXA3ckNoZWNrZWQAZGlyZWN0ZWRFZGdlLmMAZGlyZWN0ZWRFZGdlVG9Cb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbdG1wRmlqay5mYWNlXVtmaWprLmZhY2VdID09IEtJAGZhY2VpamsuYwBfZmFjZUlqa1BlbnRUb0NlbGxCb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbY2VudGVySUpLLmZhY2VdW2ZhY2UyXSA9PSBLSQBfZmFjZUlqa1RvQ2VsbEJvdW5kYXJ5AGgzSW5kZXguYwBjb21wYWN0Q2VsbHMAbGF0TG5nVG9DZWxsAGNlbGxUb0NoaWxkUG9zAHZhbGlkYXRlQ2hpbGRQb3MAbGF0TG5nLmMAY2VsbEFyZWFSYWRzMgBwb2x5Z29uLT5uZXh0ID09IE5VTEwAbGlua2VkR2VvLmMAYWRkTmV3TGlua2VkUG9seWdvbgBuZXh0ICE9IE5VTEwAbG9vcCAhPSBOVUxMAGFkZE5ld0xpbmtlZExvb3AAcG9seWdvbi0+Zmlyc3QgPT0gTlVMTABhZGRMaW5rZWRMb29wAGNvb3JkICE9IE5VTEwAYWRkTGlua2VkQ29vcmQAbG9vcC0+Zmlyc3QgPT0gTlVMTABpbm5lckxvb3BzICE9IE5VTEwAbm9ybWFsaXplTXVsdGlQb2x5Z29uAGJib3hlcyAhPSBOVUxMAGNhbmRpZGF0ZXMgIT0gTlVMTABmaW5kUG9seWdvbkZvckhvbGUAY2FuZGlkYXRlQkJveGVzICE9IE5VTEwAcmV2RGlyICE9IElOVkFMSURfRElHSVQAbG9jYWxpai5jAGNlbGxUb0xvY2FsSWprAGJhc2VDZWxsICE9IG9yaWdpbkJhc2VDZWxsACEob3JpZ2luT25QZW50ICYmIGluZGV4T25QZW50KQBiYXNlQ2VsbCA9PSBvcmlnaW5CYXNlQ2VsbABiYXNlQ2VsbCAhPSBJTlZBTElEX0JBU0VfQ0VMTABsb2NhbElqa1RvQ2VsbAAhX2lzQmFzZUNlbGxQZW50YWdvbihiYXNlQ2VsbCkAYmFzZUNlbGxSb3RhdGlvbnMgPj0gMABncmlkUGF0aENlbGxzADAAdmVydGV4LmMAY2VsbFRvVmVydGV4AGdyYXBoLT5idWNrZXRzICE9IE5VTEwAdmVydGV4R3JhcGguYwBpbml0VmVydGV4R3JhcGgAbm9kZSAhPSBOVUxMAGFkZFZlcnRleE5vZGU=";var ip=24144;function Ap(j,Z,le,Be){hs("Assertion failed: "+ue(j)+", at: "+[Z?ue(Z):"unknown filename",le,Be?ue(Be):"unknown function"])}function Cc(){return ne.length}function rp(j,Z,le){he.set(he.subarray(Z,Z+le),j)}function op(j){return e.___errno_location&&(Re[e.___errno_location()>>2]=j),j}function ap(j){hs("OOM")}function cp(j){try{var Z=new ArrayBuffer(j);return Z.byteLength!=j?void 0:(new Int8Array(Z).set(ne),gp(Z),ot(Z),1)}catch{}}function lp(j){var Z=Cc(),le=16777216,Be=2147483648-le;if(j>Be)return!1;for(var a=16777216,M=Math.max(Z,a);M<j;)M<=536870912?M=K(2*M,le):M=Math.min(K((3*M+2147483648)/4,le),Be);var Ne=cp(M);return!!Ne}var up=typeof atob=="function"?atob:function(j){var Z="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",le="",Be,a,M,Ne,Qe,ht,De,Ue=0;j=j.replace(/[^A-Za-z0-9\+\/\=]/g,"");do Ne=Z.indexOf(j.charAt(Ue++)),Qe=Z.indexOf(j.charAt(Ue++)),ht=Z.indexOf(j.charAt(Ue++)),De=Z.indexOf(j.charAt(Ue++)),Be=Ne<<2|Qe>>4,a=(Qe&15)<<4|ht>>2,M=(ht&3)<<6|De,le=le+String.fromCharCode(Be),ht!==64&&(le=le+String.fromCharCode(a)),De!==64&&(le=le+String.fromCharCode(M));while(Ue<j.length);return le};function fp(j){try{for(var Z=up(j),le=new Uint8Array(Z.length),Be=0;Be<Z.length;++Be)le[Be]=Z.charCodeAt(Be);return le}catch{throw new Error("Converting base64 string to bytes failed.")}}function Mr(j){if(Bc(j))return fp(j.slice(vr.length))}var hp={Math,Int8Array,Int32Array,Uint8Array,Float32Array,Float64Array},dp={b:C,c:y,d:Ap,e:op,f:Cc,g:rp,h:lp,i:ap,o:ip,p:We},ee=function(j,Z,le){"almost asm";var Be=new j.Int8Array(le),a=new j.Int32Array(le);new j.Uint8Array(le),new j.Float32Array(le);var M=new j.Float64Array(le),Ne=Z.o|0,Qe=Z.p|0,ht=j.Math.floor,De=j.Math.abs,Ue=j.Math.sqrt,Pn=j.Math.pow,Ke=j.Math.cos,we=j.Math.sin,Xt=j.Math.tan,Hi=j.Math.acos,Bp=j.Math.asin,xr=j.Math.atan,Yt=j.Math.atan2,ds=j.Math.ceil,hn=j.Math.imul,Dr=j.Math.min,Cp=j.Math.max,jn=j.Math.clz32,Se=Z.b,S=Z.c,pe=Z.d,Tc=Z.e,_p=Z.f,yp=Z.g,bp=Z.h,Ep=Z.i,I=24160;function Tp(o){return Be=new Int8Array(o),a=new Int32Array(o),M=new Float64Array(o),le=o,!0}function vp(o){o=o|0;var r=0;return r=I,I=I+o|0,I=I+15&-16,r|0}function Ip(){return I|0}function Mp(o){o=o|0,I=o}function wp(o,r){o=o|0,I=o}function Sp(o,r){o=o|0,r=r|0;var c=0,u=0,f=0;return(o|0)<0?(r=2,r|0):(o|0)>13780509?(r=Qr(15,r)|0,r|0):(c=((o|0)<0)<<31>>31,f=Et(o|0,c|0,3,0)|0,u=S()|0,c=Pe(o|0,c|0,1,0)|0,c=Et(f|0,u|0,c|0,S()|0)|0,c=Pe(c|0,S()|0,1,0)|0,o=S()|0,a[r>>2]=c,a[r+4>>2]=o,r=0,r|0)}function vc(o,r,c,u){return o=o|0,r=r|0,c=c|0,u=u|0,Ic(o,r,c,u,0)|0}function Ic(o,r,c,u,f){o=o|0,r=r|0,c=c|0,u=u|0,f=f|0;var d=0,p=0,m=0,_=0,b=0;if(_=I,I=I+16|0,p=_,!(Mc(o,r,c,u,f)|0))return u=0,I=_,u|0;do if((c|0)>=0){if((c|0)>13780509){if(d=Qr(15,p)|0,d|0)break;m=p,p=a[m>>2]|0,m=a[m+4>>2]|0}else d=((c|0)<0)<<31>>31,b=Et(c|0,d|0,3,0)|0,m=S()|0,d=Pe(c|0,d|0,1,0)|0,d=Et(b|0,m|0,d|0,S()|0)|0,d=Pe(d|0,S()|0,1,0)|0,m=S()|0,a[p>>2]=d,a[p+4>>2]=m,p=d;if($n(u|0,0,p<<3|0)|0,f|0){$n(f|0,0,p<<2|0)|0,d=bn(o,r,c,u,f,p,m,0)|0;break}d=gn(p,4)|0,d?(b=bn(o,r,c,u,d,p,m,0)|0,Ce(d),d=b):d=13}else d=2;while(!1);return b=d,I=_,b|0}function Mc(o,r,c,u,f){o=o|0,r=r|0,c=c|0,u=u|0,f=f|0;var d=0,p=0,m=0,_=0,b=0,v=0,w=0,P=0,L=0,D=0,H=0;if(H=I,I=I+16|0,L=H,D=H+8|0,P=L,a[P>>2]=o,a[P+4>>2]=r,(c|0)<0)return D=2,I=H,D|0;if(d=u,a[d>>2]=o,a[d+4>>2]=r,d=(f|0)!=0,d&&(a[f>>2]=0),tt(o,r)|0)return D=9,I=H,D|0;a[D>>2]=0;e:do if((c|0)>=1)if(d)for(v=1,b=0,w=0,P=1,d=o;;){if(!(b|w)){if(d=dt(d,r,4,D,L)|0,d|0)break e;if(r=L,d=a[r>>2]|0,r=a[r+4>>2]|0,tt(d,r)|0){d=9;break e}}if(d=dt(d,r,a[22384+(w<<2)>>2]|0,D,L)|0,d|0)break e;if(r=L,d=a[r>>2]|0,r=a[r+4>>2]|0,o=u+(v<<3)|0,a[o>>2]=d,a[o+4>>2]=r,a[f+(v<<2)>>2]=P,o=b+1|0,p=(o|0)==(P|0),m=w+1|0,_=(m|0)==6,tt(d,r)|0){d=9;break e}if(P=P+(_&p&1)|0,(P|0)>(c|0)){d=0;break}else v=v+1|0,b=p?0:o,w=p?_?0:m:w}else for(v=1,b=0,w=0,P=1,d=o;;){if(!(b|w)){if(d=dt(d,r,4,D,L)|0,d|0)break e;if(r=L,d=a[r>>2]|0,r=a[r+4>>2]|0,tt(d,r)|0){d=9;break e}}if(d=dt(d,r,a[22384+(w<<2)>>2]|0,D,L)|0,d|0)break e;if(r=L,d=a[r>>2]|0,r=a[r+4>>2]|0,o=u+(v<<3)|0,a[o>>2]=d,a[o+4>>2]=r,o=b+1|0,p=(o|0)==(P|0),m=w+1|0,_=(m|0)==6,tt(d,r)|0){d=9;break e}if(P=P+(_&p&1)|0,(P|0)>(c|0)){d=0;break}else v=v+1|0,b=p?0:o,w=p?_?0:m:w}else d=0;while(!1);return D=d,I=H,D|0}function bn(o,r,c,u,f,d,p,m){o=o|0,r=r|0,c=c|0,u=u|0,f=f|0,d=d|0,p=p|0,m=m|0;var _=0,b=0,v=0,w=0,P=0,L=0,D=0,H=0,X=0,W=0;if(H=I,I=I+16|0,L=H+8|0,D=H,_=Bs(o|0,r|0,d|0,p|0)|0,v=S()|0,w=u+(_<<3)|0,X=w,W=a[X>>2]|0,X=a[X+4>>2]|0,b=(W|0)==(o|0)&(X|0)==(r|0),!((W|0)==0&(X|0)==0|b))do _=Pe(_|0,v|0,1,0)|0,_=Qi(_|0,S()|0,d|0,p|0)|0,v=S()|0,w=u+(_<<3)|0,W=w,X=a[W>>2]|0,W=a[W+4>>2]|0,b=(X|0)==(o|0)&(W|0)==(r|0);while(!((X|0)==0&(W|0)==0|b));if(_=f+(_<<2)|0,b&&(a[_>>2]|0)<=(m|0)||(W=w,a[W>>2]=o,a[W+4>>2]=r,a[_>>2]=m,(m|0)>=(c|0)))return W=0,I=H,W|0;switch(b=m+1|0,a[L>>2]=0,_=dt(o,r,2,L,D)|0,_|0){case 9:{P=9;break}case 0:{_=D,_=bn(a[_>>2]|0,a[_+4>>2]|0,c,u,f,d,p,b)|0,_||(P=9);break}}e:do if((P|0)==9){switch(a[L>>2]=0,_=dt(o,r,3,L,D)|0,_|0){case 9:break;case 0:{if(_=D,_=bn(a[_>>2]|0,a[_+4>>2]|0,c,u,f,d,p,b)|0,_|0)break e;break}default:break e}switch(a[L>>2]=0,_=dt(o,r,1,L,D)|0,_|0){case 9:break;case 0:{if(_=D,_=bn(a[_>>2]|0,a[_+4>>2]|0,c,u,f,d,p,b)|0,_|0)break e;break}default:break e}switch(a[L>>2]=0,_=dt(o,r,5,L,D)|0,_|0){case 9:break;case 0:{if(_=D,_=bn(a[_>>2]|0,a[_+4>>2]|0,c,u,f,d,p,b)|0,_|0)break e;break}default:break e}switch(a[L>>2]=0,_=dt(o,r,4,L,D)|0,_|0){case 9:break;case 0:{if(_=D,_=bn(a[_>>2]|0,a[_+4>>2]|0,c,u,f,d,p,b)|0,_|0)break e;break}default:break e}switch(a[L>>2]=0,_=dt(o,r,6,L,D)|0,_|0){case 9:break;case 0:{if(_=D,_=bn(a[_>>2]|0,a[_+4>>2]|0,c,u,f,d,p,b)|0,_|0)break e;break}default:break e}return W=0,I=H,W|0}while(!1);return W=_,I=H,W|0}function dt(o,r,c,u,f){o=o|0,r=r|0,c=c|0,u=u|0,f=f|0;var d=0,p=0,m=0,_=0,b=0,v=0,w=0,P=0,L=0,D=0;if(c>>>0>6)return f=1,f|0;if(w=(a[u>>2]|0)%6|0,a[u>>2]=w,(w|0)>0){d=0;do c=Wn(c)|0,d=d+1|0;while((d|0)<(a[u>>2]|0))}if(w=q(o|0,r|0,45)|0,S()|0,v=w&127,v>>>0>121)return f=5,f|0;_=Lt(o,r)|0,d=q(o|0,r|0,52)|0,S()|0,d=d&15;e:do if(!d)b=8;else{for(;;){if(p=(15-d|0)*3|0,m=q(o|0,r|0,p|0)|0,S()|0,m=m&7,(m|0)==7){r=5;break}if(D=($t(d)|0)==0,d=d+-1|0,P=Ae(7,0,p|0)|0,r=r&~(S()|0),L=Ae(a[(D?432:16)+(m*28|0)+(c<<2)>>2]|0,0,p|0)|0,p=S()|0,c=a[(D?640:224)+(m*28|0)+(c<<2)>>2]|0,o=L|o&~P,r=p|r,!c){c=0;break e}if(!d){b=8;break e}}return r|0}while(!1);(b|0)==8&&(D=a[848+(v*28|0)+(c<<2)>>2]|0,L=Ae(D|0,0,45)|0,o=L|o,r=S()|0|r&-1040385,c=a[4272+(v*28|0)+(c<<2)>>2]|0,(D&127|0)==127&&(D=Ae(a[848+(v*28|0)+20>>2]|0,0,45)|0,r=S()|0|r&-1040385,c=a[4272+(v*28|0)+20>>2]|0,o=Xn(D|o,r)|0,r=S()|0,a[u>>2]=(a[u>>2]|0)+1)),m=q(o|0,r|0,45)|0,S()|0,m=m&127;e:do if(et(m)|0){t:do if((Lt(o,r)|0)==1){if((v|0)!=(m|0))if(xc(m,a[7696+(v*28|0)>>2]|0)|0){o=Vr(o,r)|0,p=1,r=S()|0;break}else pe(23313,22416,436,22424);switch(_|0){case 3:{o=Xn(o,r)|0,r=S()|0,a[u>>2]=(a[u>>2]|0)+1,p=0;break t}case 5:{o=Vr(o,r)|0,r=S()|0,a[u>>2]=(a[u>>2]|0)+5,p=0;break t}case 0:return D=9,D|0;default:return D=1,D|0}}else p=0;while(!1);if((c|0)>0){d=0;do o=Jr(o,r)|0,r=S()|0,d=d+1|0;while((d|0)!=(c|0))}if((v|0)!=(m|0)){if(!(Fr(m)|0)){if((p|0)!=0|(Lt(o,r)|0)!=5)break;a[u>>2]=(a[u>>2]|0)+1;break}switch(w&127){case 8:case 118:break e}(Lt(o,r)|0)!=3&&(a[u>>2]=(a[u>>2]|0)+1)}}else if((c|0)>0){d=0;do o=Xn(o,r)|0,r=S()|0,d=d+1|0;while((d|0)!=(c|0))}while(!1);return a[u>>2]=((a[u>>2]|0)+c|0)%6|0,D=f,a[D>>2]=o,a[D+4>>2]=r,D=0,D|0}function Pr(o,r,c,u){o=o|0,r=r|0,c=c|0,u=u|0;var f=0,d=0,p=0,m=0,_=0,b=0;for(m=I,I=I+16|0,d=m,p=m+8|0,f=(tt(o,r)|0)==0,f=f?1:2;;){if(a[p>>2]=0,b=(dt(o,r,f,p,d)|0)==0,_=d,b&((a[_>>2]|0)==(c|0)?(a[_+4>>2]|0)==(u|0):0)){o=4;break}if(f=f+1|0,f>>>0>=7){f=7,o=4;break}}return(o|0)==4?(I=m,f|0):0}function xp(o,r,c,u){o=o|0,r=r|0,c=c|0,u=u|0;var f=0,d=0,p=0,m=0,_=0,b=0,v=0,w=0,P=0,L=0,D=0;if(D=I,I=I+16|0,P=D,L=D+8|0,w=P,a[w>>2]=o,a[w+4>>2]=r,!c)return L=u,a[L>>2]=o,a[L+4>>2]=r,L=0,I=D,L|0;a[L>>2]=0;e:do if(tt(o,r)|0)o=9;else{if(d=(c|0)>0,d){f=0,w=o;do{if(o=dt(w,r,4,L,P)|0,o|0)break e;if(r=P,w=a[r>>2]|0,r=a[r+4>>2]|0,f=f+1|0,tt(w,r)|0){o=9;break e}}while((f|0)<(c|0));if(v=u,a[v>>2]=w,a[v+4>>2]=r,v=c+-1|0,d){b=0,o=1;do{if(f=22384+(b<<2)|0,(b|0)==5)for(p=a[f>>2]|0,d=0,f=o;;){if(o=P,o=dt(a[o>>2]|0,a[o+4>>2]|0,p,L,P)|0,o|0)break e;if((d|0)!=(v|0))if(_=P,m=a[_>>2]|0,_=a[_+4>>2]|0,o=u+(f<<3)|0,a[o>>2]=m,a[o+4>>2]=_,!(tt(m,_)|0))o=f+1|0;else{o=9;break e}else o=f;if(d=d+1|0,(d|0)>=(c|0))break;f=o}else for(p=P,_=a[f>>2]|0,m=0,f=o,d=a[p>>2]|0,p=a[p+4>>2]|0;;){if(o=dt(d,p,_,L,P)|0,o|0)break e;if(p=P,d=a[p>>2]|0,p=a[p+4>>2]|0,o=u+(f<<3)|0,a[o>>2]=d,a[o+4>>2]=p,o=f+1|0,tt(d,p)|0){o=9;break e}if(m=m+1|0,(m|0)>=(c|0))break;f=o}b=b+1|0}while(b>>>0<6);o=P,p=w,f=a[o>>2]|0,d=r,o=a[o+4>>2]|0}else p=w,f=w,d=r,o=r}else p=u,a[p>>2]=o,a[p+4>>2]=r,p=o,f=o,d=r,o=r;o=(p|0)==(f|0)&(d|0)==(o|0)?0:9}while(!1);return L=o,I=D,L|0}function Dp(o,r,c,u){o=o|0,r=r|0,c=c|0,u=u|0;var f=0,d=0,p=0,m=0,_=0,b=0;if(m=I,I=I+48|0,f=m+16|0,d=m+8|0,p=m,c|0)return p=15,I=m,p|0;if(b=o,_=a[b+4>>2]|0,c=d,a[c>>2]=a[b>>2],a[c+4>>2]=_,qc(d,f),r=Fc(f,r,p)|0,!r){if(c=a[d>>2]|0,d=a[o+8>>2]|0,(d|0)>0){f=a[o+12>>2]|0,r=0;do c=(a[f+(r<<3)>>2]|0)+c|0,r=r+1|0;while((r|0)<(d|0))}r=p,f=a[r>>2]|0,r=a[r+4>>2]|0,d=((c|0)<0)<<31>>31,(r|0)<(d|0)|(r|0)==(d|0)&f>>>0<c>>>0?(r=p,a[r>>2]=c,a[r+4>>2]=d,r=d):c=f,_=Pe(c|0,r|0,12,0)|0,b=S()|0,r=p,a[r>>2]=_,a[r+4>>2]=b,r=u,a[r>>2]=_,a[r+4>>2]=b,r=0}return b=r,I=m,b|0}function wc(o,r,c,u,f,d,p){o=o|0,r=r|0,c=c|0,u=u|0,f=f|0,d=d|0,p=p|0;var m=0,_=0,b=0,v=0,w=0,P=0,L=0,D=0,H=0,X=0,W=0,J=0,z=0,U=0,ae=0,fe=0,ie=0,ce=0,ze=0,Ge=0,He=0,ve=0,Ee=0,Ie=0,Xe=0,_e=0,$e=0,Pt=0,ll=0;if(Xe=I,I=I+64|0,He=Xe+48|0,ve=Xe+32|0,Ee=Xe+24|0,ae=Xe+8|0,fe=Xe,_=a[o>>2]|0,(_|0)<=0)return Ie=0,I=Xe,Ie|0;for(ie=o+4|0,ce=He+8|0,ze=ve+8|0,Ge=ae+8|0,m=0,z=0;;){b=a[ie>>2]|0,J=b+(z<<4)|0,a[He>>2]=a[J>>2],a[He+4>>2]=a[J+4>>2],a[He+8>>2]=a[J+8>>2],a[He+12>>2]=a[J+12>>2],(z|0)==(_+-1|0)?(a[ve>>2]=a[b>>2],a[ve+4>>2]=a[b+4>>2],a[ve+8>>2]=a[b+8>>2],a[ve+12>>2]=a[b+12>>2]):(J=b+(z+1<<4)|0,a[ve>>2]=a[J>>2],a[ve+4>>2]=a[J+4>>2],a[ve+8>>2]=a[J+8>>2],a[ve+12>>2]=a[J+12>>2]),_=Hp(He,ve,u,Ee)|0;e:do if(_)b=0,m=_;else if(b=Ee,_=a[b>>2]|0,b=a[b+4>>2]|0,(b|0)>0|(b|0)==0&_>>>0>0){W=0,J=0;t:for(;;){if(ll=+M[He>>3],X=bt(_|0,b|0,W|0,J|0)|0,Pt=+(X>>>0)+4294967296*+(S()|0),_e=+(_>>>0)+4294967296*+(b|0),$e=+(W>>>0)+4294967296*+(J|0),M[ae>>3]=ll*Pt/_e+ +M[ve>>3]*$e/_e,M[Ge>>3]=+M[ce>>3]*Pt/_e+ +M[ze>>3]*$e/_e,_=zc(ae,u,fe)|0,_|0){m=_;break}X=fe,H=a[X>>2]|0,X=a[X+4>>2]|0,P=Bs(H|0,X|0,r|0,c|0)|0,v=S()|0,_=p+(P<<3)|0,w=_,b=a[w>>2]|0,w=a[w+4>>2]|0;n:do if((b|0)==0&(w|0)==0)U=_,Ie=16;else for(L=0,D=0;;){if((L|0)>(c|0)|(L|0)==(c|0)&D>>>0>r>>>0){m=1;break t}if((b|0)==(H|0)&(w|0)==(X|0))break n;if(_=Pe(P|0,v|0,1,0)|0,P=Qi(_|0,S()|0,r|0,c|0)|0,v=S()|0,D=Pe(D|0,L|0,1,0)|0,L=S()|0,_=p+(P<<3)|0,w=_,b=a[w>>2]|0,w=a[w+4>>2]|0,(b|0)==0&(w|0)==0){U=_,Ie=16;break}}while(!1);if((Ie|0)==16&&(Ie=0,!((H|0)==0&(X|0)==0))&&(D=U,a[D>>2]=H,a[D+4>>2]=X,D=d+(a[f>>2]<<3)|0,a[D>>2]=H,a[D+4>>2]=X,D=f,D=Pe(a[D>>2]|0,a[D+4>>2]|0,1,0)|0,H=S()|0,X=f,a[X>>2]=D,a[X+4>>2]=H),W=Pe(W|0,J|0,1,0)|0,J=S()|0,b=Ee,_=a[b>>2]|0,b=a[b+4>>2]|0,!((b|0)>(J|0)|(b|0)==(J|0)&_>>>0>W>>>0)){b=1;break e}}b=0}else b=1;while(!1);if(z=z+1|0,!b){Ie=21;break}if(_=a[o>>2]|0,(z|0)>=(_|0)){m=0,Ie=21;break}}return(Ie|0)==21?(I=Xe,m|0):0}function Pp(o,r,c,u){o=o|0,r=r|0,c=c|0,u=u|0;var f=0,d=0,p=0,m=0,_=0,b=0,v=0,w=0,P=0,L=0,D=0,H=0,X=0,W=0,J=0,z=0,U=0,ae=0,fe=0,ie=0,ce=0,ze=0,Ge=0,He=0,ve=0,Ee=0,Ie=0,Xe=0,_e=0,$e=0,Pt=0;if(Pt=I,I=I+112|0,Ie=Pt+80|0,_=Pt+72|0,Xe=Pt,_e=Pt+56|0,c|0)return $e=15,I=Pt,$e|0;if(b=o+8|0,$e=dn((a[b>>2]<<5)+32|0)|0,!$e)return $e=13,I=Pt,$e|0;if(Jm(o,$e),ve=o,Ee=a[ve+4>>2]|0,c=_,a[c>>2]=a[ve>>2],a[c+4>>2]=Ee,qc(_,Ie),c=Fc(Ie,r,Xe)|0,c)ve=0,Ee=0;else{if(c=a[_>>2]|0,d=a[b>>2]|0,(d|0)>0){p=a[o+12>>2]|0,f=0;do c=(a[p+(f<<3)>>2]|0)+c|0,f=f+1|0;while((f|0)!=(d|0));f=c}else f=c;c=Xe,d=a[c>>2]|0,c=a[c+4>>2]|0,p=((f|0)<0)<<31>>31,(c|0)<(p|0)|(c|0)==(p|0)&d>>>0<f>>>0?(c=Xe,a[c>>2]=f,a[c+4>>2]=p,c=p):f=d,ve=Pe(f|0,c|0,12,0)|0,Ee=S()|0,c=Xe,a[c>>2]=ve,a[c+4>>2]=Ee,c=0}if(c|0)return Ce($e),$e=c,I=Pt,$e|0;if(f=gn(ve,8)|0,!f)return Ce($e),$e=13,I=Pt,$e|0;if(m=gn(ve,8)|0,!m)return Ce($e),Ce(f),$e=13,I=Pt,$e|0;Ge=Ie,a[Ge>>2]=0,a[Ge+4>>2]=0,Ge=o,He=a[Ge+4>>2]|0,c=_,a[c>>2]=a[Ge>>2],a[c+4>>2]=He,c=wc(_,ve,Ee,r,Ie,f,m)|0;e:do if(c)Ce(f),Ce(m),Ce($e);else{t:do if((a[b>>2]|0)>0){for(p=o+12|0,d=0;c=wc((a[p>>2]|0)+(d<<3)|0,ve,Ee,r,Ie,f,m)|0,d=d+1|0,!(c|0);)if((d|0)>=(a[b>>2]|0))break t;Ce(f),Ce(m),Ce($e);break e}while(!1);(Ee|0)>0|(Ee|0)==0&ve>>>0>0&&$n(m|0,0,ve<<3|0)|0,He=Ie,Ge=a[He+4>>2]|0;t:do if((Ge|0)>0|(Ge|0)==0&(a[He>>2]|0)>>>0>0){ie=f,ce=m,ze=f,Ge=m,He=f,c=f,U=f,ae=m,fe=m,f=m;n:for(;;){for(X=0,W=0,J=0,z=0,d=0,p=0;;){m=Xe,_=m+56|0;do a[m>>2]=0,m=m+4|0;while((m|0)<(_|0));if(r=ie+(X<<3)|0,b=a[r>>2]|0,r=a[r+4>>2]|0,Mc(b,r,1,Xe,0)|0){m=Xe,_=m+56|0;do a[m>>2]=0,m=m+4|0;while((m|0)<(_|0));m=gn(7,4)|0,m|0&&(bn(b,r,1,Xe,m,7,0,0)|0,Ce(m))}for(H=0;;){D=Xe+(H<<3)|0,L=a[D>>2]|0,D=a[D+4>>2]|0;s:do if((L|0)==0&(D|0)==0)m=d,_=p;else{if(v=Bs(L|0,D|0,ve|0,Ee|0)|0,b=S()|0,m=u+(v<<3)|0,r=m,_=a[r>>2]|0,r=a[r+4>>2]|0,!((_|0)==0&(r|0)==0)){w=0,P=0;do{if((w|0)>(Ee|0)|(w|0)==(Ee|0)&P>>>0>ve>>>0)break n;if((_|0)==(L|0)&(r|0)==(D|0)){m=d,_=p;break s}m=Pe(v|0,b|0,1,0)|0,v=Qi(m|0,S()|0,ve|0,Ee|0)|0,b=S()|0,P=Pe(P|0,w|0,1,0)|0,w=S()|0,m=u+(v<<3)|0,r=m,_=a[r>>2]|0,r=a[r+4>>2]|0}while(!((_|0)==0&(r|0)==0))}(L|0)==0&(D|0)==0?(m=d,_=p):(oi(L,D,_e)|0,Vm(o,$e,_e)|0&&(P=Pe(d|0,p|0,1,0)|0,p=S()|0,w=m,a[w>>2]=L,a[w+4>>2]=D,d=ce+(d<<3)|0,a[d>>2]=L,a[d+4>>2]=D,d=P),m=d,_=p)}while(!1);if(H=H+1|0,H>>>0>=7)break;d=m,p=_}if(X=Pe(X|0,W|0,1,0)|0,W=S()|0,J=Pe(J|0,z|0,1,0)|0,z=S()|0,p=Ie,d=a[p>>2]|0,p=a[p+4>>2]|0,(z|0)<(p|0)|(z|0)==(p|0)&J>>>0<d>>>0)d=m,p=_;else break}if((p|0)>0|(p|0)==0&d>>>0>0){d=0,p=0;do z=ie+(d<<3)|0,a[z>>2]=0,a[z+4>>2]=0,d=Pe(d|0,p|0,1,0)|0,p=S()|0,z=Ie,J=a[z+4>>2]|0;while((p|0)<(J|0)|((p|0)==(J|0)?d>>>0<(a[z>>2]|0)>>>0:0))}if(z=Ie,a[z>>2]=m,a[z+4>>2]=_,(_|0)>0|(_|0)==0&m>>>0>0)H=f,X=fe,W=He,J=ae,z=ce,f=U,fe=c,ae=ze,U=H,c=X,He=Ge,Ge=W,ze=J,ce=ie,ie=z;else break t}Ce(ze),Ce(Ge),Ce($e),c=1;break e}else c=m;while(!1);Ce($e),Ce(f),Ce(c),c=0}while(!1);return $e=c,I=Pt,$e|0}function Fp(o,r,c){o=o|0,r=r|0,c=c|0;var u=0,f=0,d=0,p=0,m=0,_=0,b=0,v=0;if(v=I,I=I+176|0,_=v,(r|0)<1)return nl(c,0,0),b=0,I=v,b|0;for(m=o,m=q(a[m>>2]|0,a[m+4>>2]|0,52)|0,S()|0,nl(c,(r|0)>6?r:6,m&15),m=0;u=o+(m<<3)|0,u=ai(a[u>>2]|0,a[u+4>>2]|0,_)|0,!(u|0);){if(u=a[_>>2]|0,(u|0)>0){p=0;do d=_+8+(p<<4)|0,p=p+1|0,u=_+8+(((p|0)%(u|0)|0)<<4)|0,f=A2(c,u,d)|0,f?Al(c,f)|0:i2(c,d,u)|0,u=a[_>>2]|0;while((p|0)<(u|0))}if(m=m+1|0,(m|0)>=(r|0)){u=0,b=13;break}}return(b|0)==13?(I=v,u|0):(sl(c),b=u,I=v,b|0)}function Lp(o,r,c){o=o|0,r=r|0,c=c|0;var u=0,f=0,d=0,p=0;if(d=I,I=I+32|0,u=d,f=d+16|0,o=Fp(o,r,f)|0,o|0)return c=o,I=d,c|0;if(a[c>>2]=0,a[c+4>>2]=0,a[c+8>>2]=0,o=il(f)|0,o|0)do{r=Lm(c)|0;do Rm(r,o)|0,p=o+16|0,a[u>>2]=a[p>>2],a[u+4>>2]=a[p+4>>2],a[u+8>>2]=a[p+8>>2],a[u+12>>2]=a[p+12>>2],Al(f,o)|0,o=r2(f,u)|0;while((o|0)!=0);o=il(f)|0}while((o|0)!=0);return sl(f),o=Om(c)|0,o?(Xc(c),p=o,I=d,p|0):(p=0,I=d,p|0)}function et(o){return o=o|0,o>>>0>121?(o=0,o|0):(o=a[7696+(o*28|0)+16>>2]|0,o|0)}function Fr(o){return o=o|0,(o|0)==4|(o|0)==117|0}function Sc(o){return o=o|0,a[11120+((a[o>>2]|0)*216|0)+((a[o+4>>2]|0)*72|0)+((a[o+8>>2]|0)*24|0)+(a[o+12>>2]<<3)>>2]|0}function Rp(o){return o=o|0,a[11120+((a[o>>2]|0)*216|0)+((a[o+4>>2]|0)*72|0)+((a[o+8>>2]|0)*24|0)+(a[o+12>>2]<<3)+4>>2]|0}function Op(o,r){o=o|0,r=r|0,o=7696+(o*28|0)|0,a[r>>2]=a[o>>2],a[r+4>>2]=a[o+4>>2],a[r+8>>2]=a[o+8>>2],a[r+12>>2]=a[o+12>>2]}function Gp(o,r){o=o|0,r=r|0;var c=0,u=0;if(r>>>0>20)return r=-1,r|0;do if((a[11120+(r*216|0)>>2]|0)!=(o|0))if((a[11120+(r*216|0)+8>>2]|0)!=(o|0))if((a[11120+(r*216|0)+16>>2]|0)!=(o|0))if((a[11120+(r*216|0)+24>>2]|0)!=(o|0))if((a[11120+(r*216|0)+32>>2]|0)!=(o|0))if((a[11120+(r*216|0)+40>>2]|0)!=(o|0))if((a[11120+(r*216|0)+48>>2]|0)!=(o|0))if((a[11120+(r*216|0)+56>>2]|0)!=(o|0))if((a[11120+(r*216|0)+64>>2]|0)!=(o|0))if((a[11120+(r*216|0)+72>>2]|0)!=(o|0))if((a[11120+(r*216|0)+80>>2]|0)!=(o|0))if((a[11120+(r*216|0)+88>>2]|0)!=(o|0))if((a[11120+(r*216|0)+96>>2]|0)!=(o|0))if((a[11120+(r*216|0)+104>>2]|0)!=(o|0))if((a[11120+(r*216|0)+112>>2]|0)!=(o|0))if((a[11120+(r*216|0)+120>>2]|0)!=(o|0))if((a[11120+(r*216|0)+128>>2]|0)!=(o|0))if((a[11120+(r*216|0)+136>>2]|0)==(o|0))o=2,c=1,u=2;else{if((a[11120+(r*216|0)+144>>2]|0)==(o|0)){o=0,c=2,u=0;break}if((a[11120+(r*216|0)+152>>2]|0)==(o|0)){o=0,c=2,u=1;break}if((a[11120+(r*216|0)+160>>2]|0)==(o|0)){o=0,c=2,u=2;break}if((a[11120+(r*216|0)+168>>2]|0)==(o|0)){o=1,c=2,u=0;break}if((a[11120+(r*216|0)+176>>2]|0)==(o|0)){o=1,c=2,u=1;break}if((a[11120+(r*216|0)+184>>2]|0)==(o|0)){o=1,c=2,u=2;break}if((a[11120+(r*216|0)+192>>2]|0)==(o|0)){o=2,c=2,u=0;break}if((a[11120+(r*216|0)+200>>2]|0)==(o|0)){o=2,c=2,u=1;break}if((a[11120+(r*216|0)+208>>2]|0)==(o|0)){o=2,c=2,u=2;break}else o=-1;return o|0}else o=2,c=1,u=1;else o=2,c=1,u=0;else o=1,c=1,u=2;else o=1,c=1,u=1;else o=1,c=1,u=0;else o=0,c=1,u=2;else o=0,c=1,u=1;else o=0,c=1,u=0;else o=2,c=0,u=2;else o=2,c=0,u=1;else o=2,c=0,u=0;else o=1,c=0,u=2;else o=1,c=0,u=1;else o=1,c=0,u=0;else o=0,c=0,u=2;else o=0,c=0,u=1;else o=0,c=0,u=0;while(!1);return r=a[11120+(r*216|0)+(c*72|0)+(o*24|0)+(u<<3)+4>>2]|0,r|0}function xc(o,r){return o=o|0,r=r|0,(a[7696+(o*28|0)+20>>2]|0)==(r|0)?(r=1,r|0):(r=(a[7696+(o*28|0)+24>>2]|0)==(r|0),r|0)}function Lr(o,r){return o=o|0,r=r|0,a[848+(o*28|0)+(r<<2)>>2]|0}function Rr(o,r){return o=o|0,r=r|0,(a[848+(o*28|0)>>2]|0)==(r|0)?(r=0,r|0):(a[848+(o*28|0)+4>>2]|0)==(r|0)?(r=1,r|0):(a[848+(o*28|0)+8>>2]|0)==(r|0)?(r=2,r|0):(a[848+(o*28|0)+12>>2]|0)==(r|0)?(r=3,r|0):(a[848+(o*28|0)+16>>2]|0)==(r|0)?(r=4,r|0):(a[848+(o*28|0)+20>>2]|0)==(r|0)?(r=5,r|0):((a[848+(o*28|0)+24>>2]|0)==(r|0)?6:7)|0}function Np(){return 122}function Up(o){o=o|0;var r=0,c=0,u=0;r=0;do Ae(r|0,0,45)|0,u=S()|0|134225919,c=o+(r<<3)|0,a[c>>2]=-1,a[c+4>>2]=u,r=r+1|0;while((r|0)!=122);return 0}function Dc(o){return o=o|0,+M[o+16>>3]<+M[o+24>>3]|0}function Pc(o,r){o=o|0,r=r|0;var c=0,u=0,f=0;return c=+M[r>>3],!(c>=+M[o+8>>3])||!(c<=+M[o>>3])?(r=0,r|0):(u=+M[o+16>>3],c=+M[o+24>>3],f=+M[r+8>>3],r=f>=c,o=f<=u&1,u<c?r&&(o=1):r||(o=0),r=(o|0)!=0,r|0)}function Fc(o,r,c){o=o|0,r=r|0,c=c|0;var u=0,f=0,d=0,p=0,m=0,_=0,b=0,v=0,w=0,P=0,L=0,D=0,H=0,X=0;D=I,I=I+288|0,v=D+264|0,w=D+96|0,b=D,m=b,_=m+96|0;do a[m>>2]=0,m=m+4|0;while((m|0)<(_|0));return r=jr(r,b)|0,r|0?(L=r,I=D,L|0):(_=b,b=a[_>>2]|0,_=a[_+4>>2]|0,oi(b,_,v)|0,ai(b,_,w)|0,p=+li(v,w+8|0),M[v>>3]=+M[o>>3],_=v+8|0,M[_>>3]=+M[o+16>>3],M[w>>3]=+M[o+8>>3],b=w+8|0,M[b>>3]=+M[o+24>>3],f=+li(v,w),X=+M[_>>3]-+M[b>>3],d=+De(+X),H=+M[v>>3]-+M[w>>3],u=+De(+H),!(X==0|H==0)&&(X=+al(+d,+u),X=+ds(+(f*f/+Xr(+(X/+Xr(+d,+u)),3)/(p*(p*2.59807621135)*.8))),M[Ne>>3]=X,P=~~X>>>0,L=+De(X)>=1?X>0?~~+Dr(+ht(X/4294967296),4294967295)>>>0:~~+ds((X-+(~~X>>>0))/4294967296)>>>0:0,(a[Ne+4>>2]&2146435072|0)!=2146435072)?(w=(P|0)==0&(L|0)==0,r=c,a[r>>2]=w?1:P,a[r+4>>2]=w?0:L,r=0):r=1,L=r,I=D,L|0)}function Hp(o,r,c,u){o=o|0,r=r|0,c=c|0,u=u|0;var f=0,d=0,p=0,m=0,_=0,b=0,v=0;b=I,I=I+288|0,p=b+264|0,m=b+96|0,_=b,f=_,d=f+96|0;do a[f>>2]=0,f=f+4|0;while((f|0)<(d|0));return c=jr(c,_)|0,c|0?(u=c,I=b,u|0):(c=_,f=a[c>>2]|0,c=a[c+4>>2]|0,oi(f,c,p)|0,ai(f,c,m)|0,v=+li(p,m+8|0),v=+ds(+(+li(o,r)/(v*2))),M[Ne>>3]=v,c=~~v>>>0,f=+De(v)>=1?v>0?~~+Dr(+ht(v/4294967296),4294967295)>>>0:~~+ds((v-+(~~v>>>0))/4294967296)>>>0:0,(a[Ne+4>>2]&2146435072|0)==2146435072?(u=1,I=b,u|0):(_=(c|0)==0&(f|0)==0,a[u>>2]=_?1:c,a[u+4>>2]=_?0:f,u=0,I=b,u|0))}function kp(o,r,c,u){o=o|0,r=r|0,c=c|0,u=u|0,a[o>>2]=r,a[o+4>>2]=c,a[o+8>>2]=u}function Jp(o,r){o=o|0,r=r|0;var c=0,u=0,f=0,d=0,p=0,m=0,_=0,b=0,v=0,w=0,P=0;w=r+8|0,a[w>>2]=0,_=+M[o>>3],p=+De(+_),b=+M[o+8>>3],m=+De(+b)/.8660254037844386,p=p+m*.5,c=~~p,o=~~m,p=p-+(c|0),m=m-+(o|0);do if(p<.5)if(p<.3333333333333333)if(a[r>>2]=c,m<(p+1)*.5){a[r+4>>2]=o;break}else{o=o+1|0,a[r+4>>2]=o;break}else if(P=1-p,o=(!(m<P)&1)+o|0,a[r+4>>2]=o,P<=m&m<p*2){c=c+1|0,a[r>>2]=c;break}else{a[r>>2]=c;break}else{if(!(p<.6666666666666666))if(c=c+1|0,a[r>>2]=c,m<p*.5){a[r+4>>2]=o;break}else{o=o+1|0,a[r+4>>2]=o;break}if(m<1-p){if(a[r+4>>2]=o,p*2+-1<m){a[r>>2]=c;break}}else o=o+1|0,a[r+4>>2]=o;c=c+1|0,a[r>>2]=c}while(!1);do if(_<0)if(o&1){v=(o+1|0)/2|0,v=bt(c|0,((c|0)<0)<<31>>31|0,v|0,((v|0)<0)<<31>>31|0)|0,c=~~(+(c|0)-((+(v>>>0)+4294967296*+(S()|0))*2+1)),a[r>>2]=c;break}else{v=(o|0)/2|0,v=bt(c|0,((c|0)<0)<<31>>31|0,v|0,((v|0)<0)<<31>>31|0)|0,c=~~(+(c|0)-(+(v>>>0)+4294967296*+(S()|0))*2),a[r>>2]=c;break}while(!1);v=r+4|0,b<0&&(c=c-((o<<1|1|0)/2|0)|0,a[r>>2]=c,o=0-o|0,a[v>>2]=o),u=o-c|0,(c|0)<0?(f=0-c|0,a[v>>2]=u,a[w>>2]=f,a[r>>2]=0,o=u,c=0):f=0,(o|0)<0&&(c=c-o|0,a[r>>2]=c,f=f-o|0,a[w>>2]=f,a[v>>2]=0,o=0),d=c-f|0,u=o-f|0,(f|0)<0&&(a[r>>2]=d,a[v>>2]=u,a[w>>2]=0,o=u,c=d,f=0),u=(o|0)<(c|0)?o:c,u=(f|0)<(u|0)?f:u,!((u|0)<=0)&&(a[r>>2]=c-u,a[v>>2]=o-u,a[w>>2]=f-u)}function yt(o){o=o|0;var r=0,c=0,u=0,f=0,d=0,p=0;r=a[o>>2]|0,p=o+4|0,c=a[p>>2]|0,(r|0)<0&&(c=c-r|0,a[p>>2]=c,d=o+8|0,a[d>>2]=(a[d>>2]|0)-r,a[o>>2]=0,r=0),(c|0)<0?(r=r-c|0,a[o>>2]=r,d=o+8|0,f=(a[d>>2]|0)-c|0,a[d>>2]=f,a[p>>2]=0,c=0):(f=o+8|0,d=f,f=a[f>>2]|0),(f|0)<0&&(r=r-f|0,a[o>>2]=r,c=c-f|0,a[p>>2]=c,a[d>>2]=0,f=0),u=(c|0)<(r|0)?c:r,u=(f|0)<(u|0)?f:u,!((u|0)<=0)&&(a[o>>2]=r-u,a[p>>2]=c-u,a[d>>2]=f-u)}function Qn(o,r){o=o|0,r=r|0;var c=0,u=0;u=a[o+8>>2]|0,c=+((a[o+4>>2]|0)-u|0),M[r>>3]=+((a[o>>2]|0)-u|0)-c*.5,M[r+8>>3]=c*.8660254037844386}function Dt(o,r,c){o=o|0,r=r|0,c=c|0,a[c>>2]=(a[r>>2]|0)+(a[o>>2]|0),a[c+4>>2]=(a[r+4>>2]|0)+(a[o+4>>2]|0),a[c+8>>2]=(a[r+8>>2]|0)+(a[o+8>>2]|0)}function Or(o,r,c){o=o|0,r=r|0,c=c|0,a[c>>2]=(a[o>>2]|0)-(a[r>>2]|0),a[c+4>>2]=(a[o+4>>2]|0)-(a[r+4>>2]|0),a[c+8>>2]=(a[o+8>>2]|0)-(a[r+8>>2]|0)}function Lc(o,r){o=o|0,r=r|0;var c=0,u=0;c=hn(a[o>>2]|0,r)|0,a[o>>2]=c,c=o+4|0,u=hn(a[c>>2]|0,r)|0,a[c>>2]=u,o=o+8|0,r=hn(a[o>>2]|0,r)|0,a[o>>2]=r}function ki(o){o=o|0;var r=0,c=0,u=0,f=0,d=0,p=0,m=0;p=a[o>>2]|0,m=(p|0)<0,u=(a[o+4>>2]|0)-(m?p:0)|0,d=(u|0)<0,f=(d?0-u|0:0)+((a[o+8>>2]|0)-(m?p:0))|0,c=(f|0)<0,o=c?0:f,r=(d?0:u)-(c?f:0)|0,f=(m?0:p)-(d?u:0)-(c?f:0)|0,c=(r|0)<(f|0)?r:f,c=(o|0)<(c|0)?o:c,u=(c|0)>0,o=o-(u?c:0)|0,r=r-(u?c:0)|0;e:do switch(f-(u?c:0)|0){case 0:switch(r|0){case 0:return m=(o|0)==0?0:(o|0)==1?1:7,m|0;case 1:return m=(o|0)==0?2:(o|0)==1?3:7,m|0;default:break e}case 1:switch(r|0){case 0:return m=(o|0)==0?4:(o|0)==1?5:7,m|0;case 1:{if(!o)o=6;else break e;return o|0}default:break e}}while(!1);return m=7,m|0}function Vp(o){o=o|0;var r=0,c=0,u=0,f=0,d=0,p=0,m=0;p=o+8|0,f=a[p>>2]|0,d=(a[o>>2]|0)-f|0,m=o+4|0,f=(a[m>>2]|0)-f|0;do if(d>>>0>715827881|f>>>0>715827881){if(c=(d|0)>0,c){if((2147483647-d|0)<(d|0)||(2147483647-(d<<1)|0)<(d|0))return m=1,m|0}else if((-2147483648-d|0)>(d|0)||(-2147483648-(d<<1)|0)>(d|0))return m=1,m|0;if(r=d*3|0,(f|0)>0){if((2147483647-f|0)<(f|0))return m=1,m|0}else if((-2147483648-f|0)>(f|0))return m=1,m|0;if(u=f<<1,(d|0)>-1){if((r|-2147483648|0)>=(f|0))return m=1,m|0}else if((r^-2147483648|0)<(f|0))return m=1,m|0;if(c){if((2147483647-d|0)<(u|0))r=1;else{c=u;break}return r|0}else{if((-2147483648-d|0)>(u|0))r=1;else{c=u;break}return r|0}}else c=f<<1,r=d*3|0;while(!1);u=Rn(+(r-f|0)/7)|0,a[o>>2]=u,f=Rn(+(c+d|0)/7)|0,a[m>>2]=f,a[p>>2]=0,c=(f|0)<(u|0),r=c?u:f,c=c?f:u;do if((c|0)<0){if((r|0)>0){if((r|-2147483648|0)<(c|0)&((c|0)!=-2147483648&(2147483647-r|0)>=(c|0)))break;pe(23313,22444,355,22455)}if((c|0)==-2147483648|(-2147483648-r|0)>(c|0)&&pe(23313,22444,355,22455),(r|0)>-1){if((r|-2147483648|0)<(c|0))break;pe(23313,22444,355,22455)}else{if((r^-2147483648|0)>=(c|0))break;pe(23313,22444,355,22455)}}while(!1);return r=f-u|0,(u|0)<0?(c=0-u|0,a[m>>2]=r,a[p>>2]=c,a[o>>2]=0,u=0):(r=f,c=0),(r|0)<0&&(u=u-r|0,a[o>>2]=u,c=c-r|0,a[p>>2]=c,a[m>>2]=0,r=0),d=u-c|0,f=r-c|0,(c|0)<0?(a[o>>2]=d,a[m>>2]=f,a[p>>2]=0,r=f,f=d,c=0):f=u,u=(r|0)<(f|0)?r:f,u=(c|0)<(u|0)?c:u,(u|0)<=0?(m=0,m|0):(a[o>>2]=f-u,a[m>>2]=r-u,a[p>>2]=c-u,m=0,m|0)}function zp(o){o=o|0;var r=0,c=0,u=0,f=0,d=0,p=0,m=0;p=o+8|0,f=a[p>>2]|0,d=(a[o>>2]|0)-f|0,m=o+4|0,f=(a[m>>2]|0)-f|0;do if(d>>>0>715827881|f>>>0>715827881){if(c=(d|0)>0,c){if((2147483647-d|0)<(d|0))return m=1,m|0}else if((-2147483648-d|0)>(d|0))return m=1,m|0;if(r=d<<1,(f|0)>0){if((2147483647-f|0)<(f|0)||(2147483647-(f<<1)|0)<(f|0))return m=1,m|0}else if((-2147483648-f|0)>(f|0)||(-2147483648-(f<<1)|0)>(f|0))return m=1,m|0;if(u=f*3|0,c){if((2147483647-r|0)<(f|0))return m=1,m|0}else if((-2147483648-r|0)>(f|0))return m=1,m|0;if((f|0)>-1){if((u|-2147483648|0)<(d|0)){c=u;break}else r=1;return r|0}else{if((u^-2147483648|0)<(d|0))r=1;else{c=u;break}return r|0}}else c=f*3|0,r=d<<1;while(!1);u=Rn(+(r+f|0)/7)|0,a[o>>2]=u,f=Rn(+(c-d|0)/7)|0,a[m>>2]=f,a[p>>2]=0,c=(f|0)<(u|0),r=c?u:f,c=c?f:u;do if((c|0)<0){if((r|0)>0){if((r|-2147483648|0)<(c|0)&((c|0)!=-2147483648&(2147483647-r|0)>=(c|0)))break;pe(23313,22444,404,22469)}if((c|0)==-2147483648|(-2147483648-r|0)>(c|0)&&pe(23313,22444,404,22469),(r|0)>-1){if((r|-2147483648|0)<(c|0))break;pe(23313,22444,404,22469)}else{if((r^-2147483648|0)>=(c|0))break;pe(23313,22444,404,22469)}}while(!1);return r=f-u|0,(u|0)<0?(c=0-u|0,a[m>>2]=r,a[p>>2]=c,a[o>>2]=0,u=0):(r=f,c=0),(r|0)<0&&(u=u-r|0,a[o>>2]=u,c=c-r|0,a[p>>2]=c,a[m>>2]=0,r=0),d=u-c|0,f=r-c|0,(c|0)<0?(a[o>>2]=d,a[m>>2]=f,a[p>>2]=0,r=f,f=d,c=0):f=u,u=(r|0)<(f|0)?r:f,u=(c|0)<(u|0)?c:u,(u|0)<=0?(m=0,m|0):(a[o>>2]=f-u,a[m>>2]=r-u,a[p>>2]=c-u,m=0,m|0)}function jp(o){o=o|0;var r=0,c=0,u=0,f=0,d=0,p=0,m=0;p=o+8|0,c=a[p>>2]|0,r=(a[o>>2]|0)-c|0,m=o+4|0,c=(a[m>>2]|0)-c|0,u=Rn(+((r*3|0)-c|0)/7)|0,a[o>>2]=u,r=Rn(+((c<<1)+r|0)/7)|0,a[m>>2]=r,a[p>>2]=0,c=r-u|0,(u|0)<0?(d=0-u|0,a[m>>2]=c,a[p>>2]=d,a[o>>2]=0,r=c,u=0,c=d):c=0,(r|0)<0&&(u=u-r|0,a[o>>2]=u,c=c-r|0,a[p>>2]=c,a[m>>2]=0,r=0),d=u-c|0,f=r-c|0,(c|0)<0?(a[o>>2]=d,a[m>>2]=f,a[p>>2]=0,r=f,f=d,c=0):f=u,u=(r|0)<(f|0)?r:f,u=(c|0)<(u|0)?c:u,!((u|0)<=0)&&(a[o>>2]=f-u,a[m>>2]=r-u,a[p>>2]=c-u)}function Rc(o){o=o|0;var r=0,c=0,u=0,f=0,d=0,p=0,m=0;p=o+8|0,c=a[p>>2]|0,r=(a[o>>2]|0)-c|0,m=o+4|0,c=(a[m>>2]|0)-c|0,u=Rn(+((r<<1)+c|0)/7)|0,a[o>>2]=u,r=Rn(+((c*3|0)-r|0)/7)|0,a[m>>2]=r,a[p>>2]=0,c=r-u|0,(u|0)<0?(d=0-u|0,a[m>>2]=c,a[p>>2]=d,a[o>>2]=0,r=c,u=0,c=d):c=0,(r|0)<0&&(u=u-r|0,a[o>>2]=u,c=c-r|0,a[p>>2]=c,a[m>>2]=0,r=0),d=u-c|0,f=r-c|0,(c|0)<0?(a[o>>2]=d,a[m>>2]=f,a[p>>2]=0,r=f,f=d,c=0):f=u,u=(r|0)<(f|0)?r:f,u=(c|0)<(u|0)?c:u,!((u|0)<=0)&&(a[o>>2]=f-u,a[m>>2]=r-u,a[p>>2]=c-u)}function Ji(o){o=o|0;var r=0,c=0,u=0,f=0,d=0,p=0,m=0;r=a[o>>2]|0,p=o+4|0,c=a[p>>2]|0,m=o+8|0,u=a[m>>2]|0,f=c+(r*3|0)|0,a[o>>2]=f,c=u+(c*3|0)|0,a[p>>2]=c,r=(u*3|0)+r|0,a[m>>2]=r,u=c-f|0,(f|0)<0?(r=r-f|0,a[p>>2]=u,a[m>>2]=r,a[o>>2]=0,c=u,u=0):u=f,(c|0)<0&&(u=u-c|0,a[o>>2]=u,r=r-c|0,a[m>>2]=r,a[p>>2]=0,c=0),d=u-r|0,f=c-r|0,(r|0)<0?(a[o>>2]=d,a[p>>2]=f,a[m>>2]=0,u=d,r=0):f=c,c=(f|0)<(u|0)?f:u,c=(r|0)<(c|0)?r:c,!((c|0)<=0)&&(a[o>>2]=u-c,a[p>>2]=f-c,a[m>>2]=r-c)}function Kn(o){o=o|0;var r=0,c=0,u=0,f=0,d=0,p=0,m=0;f=a[o>>2]|0,p=o+4|0,r=a[p>>2]|0,m=o+8|0,c=a[m>>2]|0,u=(r*3|0)+f|0,f=c+(f*3|0)|0,a[o>>2]=f,a[p>>2]=u,r=(c*3|0)+r|0,a[m>>2]=r,c=u-f|0,(f|0)<0?(r=r-f|0,a[p>>2]=c,a[m>>2]=r,a[o>>2]=0,f=0):c=u,(c|0)<0&&(f=f-c|0,a[o>>2]=f,r=r-c|0,a[m>>2]=r,a[p>>2]=0,c=0),d=f-r|0,u=c-r|0,(r|0)<0?(a[o>>2]=d,a[p>>2]=u,a[m>>2]=0,f=d,r=0):u=c,c=(u|0)<(f|0)?u:f,c=(r|0)<(c|0)?r:c,!((c|0)<=0)&&(a[o>>2]=f-c,a[p>>2]=u-c,a[m>>2]=r-c)}function Oc(o,r){o=o|0,r=r|0;var c=0,u=0,f=0,d=0,p=0,m=0;(r+-1|0)>>>0>=6||(f=(a[15440+(r*12|0)>>2]|0)+(a[o>>2]|0)|0,a[o>>2]=f,m=o+4|0,u=(a[15440+(r*12|0)+4>>2]|0)+(a[m>>2]|0)|0,a[m>>2]=u,p=o+8|0,r=(a[15440+(r*12|0)+8>>2]|0)+(a[p>>2]|0)|0,a[p>>2]=r,c=u-f|0,(f|0)<0?(r=r-f|0,a[m>>2]=c,a[p>>2]=r,a[o>>2]=0,u=0):(c=u,u=f),(c|0)<0&&(u=u-c|0,a[o>>2]=u,r=r-c|0,a[p>>2]=r,a[m>>2]=0,c=0),d=u-r|0,f=c-r|0,(r|0)<0?(a[o>>2]=d,a[m>>2]=f,a[p>>2]=0,u=d,r=0):f=c,c=(f|0)<(u|0)?f:u,c=(r|0)<(c|0)?r:c,!((c|0)<=0)&&(a[o>>2]=u-c,a[m>>2]=f-c,a[p>>2]=r-c))}function Gc(o){o=o|0;var r=0,c=0,u=0,f=0,d=0,p=0,m=0;f=a[o>>2]|0,p=o+4|0,r=a[p>>2]|0,m=o+8|0,c=a[m>>2]|0,u=r+f|0,f=c+f|0,a[o>>2]=f,a[p>>2]=u,r=c+r|0,a[m>>2]=r,c=u-f|0,(f|0)<0?(r=r-f|0,a[p>>2]=c,a[m>>2]=r,a[o>>2]=0,u=0):(c=u,u=f),(c|0)<0&&(u=u-c|0,a[o>>2]=u,r=r-c|0,a[m>>2]=r,a[p>>2]=0,c=0),d=u-r|0,f=c-r|0,(r|0)<0?(a[o>>2]=d,a[p>>2]=f,a[m>>2]=0,u=d,r=0):f=c,c=(f|0)<(u|0)?f:u,c=(r|0)<(c|0)?r:c,!((c|0)<=0)&&(a[o>>2]=u-c,a[p>>2]=f-c,a[m>>2]=r-c)}function Vi(o){o=o|0;var r=0,c=0,u=0,f=0,d=0,p=0,m=0;r=a[o>>2]|0,p=o+4|0,u=a[p>>2]|0,m=o+8|0,c=a[m>>2]|0,f=u+r|0,a[o>>2]=f,u=c+u|0,a[p>>2]=u,r=c+r|0,a[m>>2]=r,c=u-f|0,(f|0)<0?(r=r-f|0,a[p>>2]=c,a[m>>2]=r,a[o>>2]=0,u=0):(c=u,u=f),(c|0)<0&&(u=u-c|0,a[o>>2]=u,r=r-c|0,a[m>>2]=r,a[p>>2]=0,c=0),d=u-r|0,f=c-r|0,(r|0)<0?(a[o>>2]=d,a[p>>2]=f,a[m>>2]=0,u=d,r=0):f=c,c=(f|0)<(u|0)?f:u,c=(r|0)<(c|0)?r:c,!((c|0)<=0)&&(a[o>>2]=u-c,a[p>>2]=f-c,a[m>>2]=r-c)}function Wn(o){switch(o=o|0,o|0){case 1:{o=5;break}case 5:{o=4;break}case 4:{o=6;break}case 6:{o=2;break}case 2:{o=3;break}case 3:{o=1;break}}return o|0}function Fn(o){switch(o=o|0,o|0){case 1:{o=3;break}case 3:{o=2;break}case 2:{o=6;break}case 6:{o=4;break}case 4:{o=5;break}case 5:{o=1;break}}return o|0}function Nc(o){o=o|0;var r=0,c=0,u=0,f=0,d=0,p=0,m=0;r=a[o>>2]|0,p=o+4|0,c=a[p>>2]|0,m=o+8|0,u=a[m>>2]|0,f=c+(r<<1)|0,a[o>>2]=f,c=u+(c<<1)|0,a[p>>2]=c,r=(u<<1)+r|0,a[m>>2]=r,u=c-f|0,(f|0)<0?(r=r-f|0,a[p>>2]=u,a[m>>2]=r,a[o>>2]=0,c=u,u=0):u=f,(c|0)<0&&(u=u-c|0,a[o>>2]=u,r=r-c|0,a[m>>2]=r,a[p>>2]=0,c=0),d=u-r|0,f=c-r|0,(r|0)<0?(a[o>>2]=d,a[p>>2]=f,a[m>>2]=0,u=d,r=0):f=c,c=(f|0)<(u|0)?f:u,c=(r|0)<(c|0)?r:c,!((c|0)<=0)&&(a[o>>2]=u-c,a[p>>2]=f-c,a[m>>2]=r-c)}function Uc(o){o=o|0;var r=0,c=0,u=0,f=0,d=0,p=0,m=0;f=a[o>>2]|0,p=o+4|0,r=a[p>>2]|0,m=o+8|0,c=a[m>>2]|0,u=(r<<1)+f|0,f=c+(f<<1)|0,a[o>>2]=f,a[p>>2]=u,r=(c<<1)+r|0,a[m>>2]=r,c=u-f|0,(f|0)<0?(r=r-f|0,a[p>>2]=c,a[m>>2]=r,a[o>>2]=0,f=0):c=u,(c|0)<0&&(f=f-c|0,a[o>>2]=f,r=r-c|0,a[m>>2]=r,a[p>>2]=0,c=0),d=f-r|0,u=c-r|0,(r|0)<0?(a[o>>2]=d,a[p>>2]=u,a[m>>2]=0,f=d,r=0):u=c,c=(u|0)<(f|0)?u:f,c=(r|0)<(c|0)?r:c,!((c|0)<=0)&&(a[o>>2]=f-c,a[p>>2]=u-c,a[m>>2]=r-c)}function Gr(o,r){o=o|0,r=r|0;var c=0,u=0,f=0,d=0,p=0,m=0;return p=(a[o>>2]|0)-(a[r>>2]|0)|0,m=(p|0)<0,u=(a[o+4>>2]|0)-(a[r+4>>2]|0)-(m?p:0)|0,d=(u|0)<0,f=(m?0-p|0:0)+(a[o+8>>2]|0)-(a[r+8>>2]|0)+(d?0-u|0:0)|0,o=(f|0)<0,r=o?0:f,c=(d?0:u)-(o?f:0)|0,f=(m?0:p)-(d?u:0)-(o?f:0)|0,o=(c|0)<(f|0)?c:f,o=(r|0)<(o|0)?r:o,u=(o|0)>0,r=r-(u?o:0)|0,c=c-(u?o:0)|0,o=f-(u?o:0)|0,o=(o|0)>-1?o:0-o|0,c=(c|0)>-1?c:0-c|0,r=(r|0)>-1?r:0-r|0,r=(c|0)>(r|0)?c:r,((o|0)>(r|0)?o:r)|0}function Qp(o,r){o=o|0,r=r|0;var c=0;c=a[o+8>>2]|0,a[r>>2]=(a[o>>2]|0)-c,a[r+4>>2]=(a[o+4>>2]|0)-c}function Kp(o,r){o=o|0,r=r|0;var c=0,u=0,f=0,d=0,p=0,m=0;u=a[o>>2]|0,a[r>>2]=u,f=a[o+4>>2]|0,p=r+4|0,a[p>>2]=f,m=r+8|0,a[m>>2]=0,c=(f|0)<(u|0),o=c?u:f,c=c?f:u;do if((c|0)<0){if((o|0)>0){if((o|-2147483648|0)<(c|0)&((c|0)!=-2147483648&(2147483647-o|0)>=(c|0)))break;return o=1,o|0}if((c|0)==-2147483648|(-2147483648-o|0)>(c|0))return r=1,r|0;if((o|0)>-1){if((o|-2147483648|0)<(c|0))break;return o=1,o|0}else{if((o^-2147483648|0)<(c|0))o=1;else break;return o|0}}while(!1);return o=f-u|0,(u|0)<0?(c=0-u|0,a[p>>2]=o,a[m>>2]=c,a[r>>2]=0,u=0):(o=f,c=0),(o|0)<0&&(u=u-o|0,a[r>>2]=u,c=c-o|0,a[m>>2]=c,a[p>>2]=0,o=0),d=u-c|0,f=o-c|0,(c|0)<0?(a[r>>2]=d,a[p>>2]=f,a[m>>2]=0,o=f,f=d,c=0):f=u,u=(o|0)<(f|0)?o:f,u=(c|0)<(u|0)?c:u,(u|0)<=0?(r=0,r|0):(a[r>>2]=f-u,a[p>>2]=o-u,a[m>>2]=c-u,r=0,r|0)}function Hc(o){o=o|0;var r=0,c=0,u=0,f=0;r=o+8|0,f=a[r>>2]|0,c=f-(a[o>>2]|0)|0,a[o>>2]=c,u=o+4|0,o=(a[u>>2]|0)-f|0,a[u>>2]=o,a[r>>2]=0-(o+c)}function Wp(o){o=o|0;var r=0,c=0,u=0,f=0,d=0,p=0,m=0;c=a[o>>2]|0,r=0-c|0,a[o>>2]=r,p=o+8|0,a[p>>2]=0,m=o+4|0,u=a[m>>2]|0,f=u+c|0,(c|0)>0?(a[m>>2]=f,a[p>>2]=c,a[o>>2]=0,r=0,u=f):c=0,(u|0)<0?(d=r-u|0,a[o>>2]=d,c=c-u|0,a[p>>2]=c,a[m>>2]=0,f=d-c|0,r=0-c|0,(c|0)<0?(a[o>>2]=f,a[m>>2]=r,a[p>>2]=0,u=r,c=0):(u=0,f=d)):f=r,r=(u|0)<(f|0)?u:f,r=(c|0)<(r|0)?c:r,!((r|0)<=0)&&(a[o>>2]=f-r,a[m>>2]=u-r,a[p>>2]=c-r)}function Xp(o,r,c,u,f){o=o|0,r=r|0,c=c|0,u=u|0,f=f|0;var d=0,p=0,m=0,_=0,b=0,v=0,w=0;if(w=I,I=I+64|0,v=w,m=w+56|0,!(!0&(r&2013265920|0)==134217728&(!0&(u&2013265920|0)==134217728)))return f=5,I=w,f|0;if((o|0)==(c|0)&(r|0)==(u|0))return a[f>>2]=0,f=0,I=w,f|0;if(p=q(o|0,r|0,52)|0,S()|0,p=p&15,b=q(c|0,u|0,52)|0,S()|0,(p|0)!=(b&15|0))return f=12,I=w,f|0;if(d=p+-1|0,p>>>0>1){kr(o,r,d,v)|0,kr(c,u,d,m)|0,b=v,_=a[b>>2]|0,b=a[b+4>>2]|0;e:do if((_|0)==(a[m>>2]|0)&&(b|0)==(a[m+4>>2]|0)){p=(p^15)*3|0,d=q(o|0,r|0,p|0)|0,S()|0,d=d&7,p=q(c|0,u|0,p|0)|0,S()|0,p=p&7;do if((d|0)==0|(p|0)==0)a[f>>2]=1,d=0;else if((d|0)==7)d=5;else{if((d|0)==1|(p|0)==1&&tt(_,b)|0){d=5;break}if((a[15536+(d<<2)>>2]|0)!=(p|0)&&(a[15568+(d<<2)>>2]|0)!=(p|0))break e;a[f>>2]=1,d=0}while(!1);return f=d,I=w,f|0}while(!1)}d=v,p=d+56|0;do a[d>>2]=0,d=d+4|0;while((d|0)<(p|0));return vc(o,r,1,v)|0,r=v,!((a[r>>2]|0)==(c|0)&&(a[r+4>>2]|0)==(u|0))&&(r=v+8|0,!((a[r>>2]|0)==(c|0)&&(a[r+4>>2]|0)==(u|0)))&&(r=v+16|0,!((a[r>>2]|0)==(c|0)&&(a[r+4>>2]|0)==(u|0)))&&(r=v+24|0,!((a[r>>2]|0)==(c|0)&&(a[r+4>>2]|0)==(u|0)))&&(r=v+32|0,!((a[r>>2]|0)==(c|0)&&(a[r+4>>2]|0)==(u|0)))&&(r=v+40|0,!((a[r>>2]|0)==(c|0)&&(a[r+4>>2]|0)==(u|0)))?(d=v+48|0,d=((a[d>>2]|0)==(c|0)?(a[d+4>>2]|0)==(u|0):0)&1):d=1,a[f>>2]=d,f=0,I=w,f|0}function Yp(o,r,c,u,f){return o=o|0,r=r|0,c=c|0,u=u|0,f=f|0,c=Pr(o,r,c,u)|0,(c|0)==7?(f=11,f|0):(u=Ae(c|0,0,56)|0,r=r&-2130706433|(S()|0)|268435456,a[f>>2]=o|u,a[f+4>>2]=r,f=0,f|0)}function $p(o,r,c){return o=o|0,r=r|0,c=c|0,!0&(r&2013265920|0)==268435456?(a[c>>2]=o,a[c+4>>2]=r&-2130706433|134217728,c=0,c|0):(c=6,c|0)}function Zp(o,r,c){o=o|0,r=r|0,c=c|0;var u=0,f=0,d=0;return f=I,I=I+16|0,u=f,a[u>>2]=0,!0&(r&2013265920|0)==268435456?(d=q(o|0,r|0,56)|0,S()|0,u=dt(o,r&-2130706433|134217728,d&7,u,c)|0,I=f,u|0):(u=6,I=f,u|0)}function qp(o,r){o=o|0,r=r|0;var c=0;switch(c=q(o|0,r|0,56)|0,S()|0,c&7){case 0:case 7:return c=0,c|0}return c=r&-2130706433|134217728,!(!0&(r&2013265920|0)==268435456)||!0&(r&117440512|0)==16777216&(tt(o,c)|0)!=0?(c=0,c|0):(c=Hr(o,c)|0,c|0)}function em(o,r,c){o=o|0,r=r|0,c=c|0;var u=0,f=0,d=0,p=0;return f=I,I=I+16|0,u=f,!0&(r&2013265920|0)==268435456?(d=r&-2130706433|134217728,p=c,a[p>>2]=o,a[p+4>>2]=d,a[u>>2]=0,r=q(o|0,r|0,56)|0,S()|0,u=dt(o,d,r&7,u,c+8|0)|0,I=f,u|0):(u=6,I=f,u|0)}function tm(o,r,c){o=o|0,r=r|0,c=c|0;var u=0,f=0;return f=(tt(o,r)|0)==0,r=r&-2130706433,u=c,a[u>>2]=f?o:0,a[u+4>>2]=f?r|285212672:0,u=c+8|0,a[u>>2]=o,a[u+4>>2]=r|301989888,u=c+16|0,a[u>>2]=o,a[u+4>>2]=r|318767104,u=c+24|0,a[u>>2]=o,a[u+4>>2]=r|335544320,u=c+32|0,a[u>>2]=o,a[u+4>>2]=r|352321536,c=c+40|0,a[c>>2]=o,a[c+4>>2]=r|369098752,0}function zi(o,r,c){o=o|0,r=r|0,c=c|0;var u=0,f=0,d=0,p=0;return p=I,I=I+16|0,f=p,d=r&-2130706433|134217728,!0&(r&2013265920|0)==268435456?(u=q(o|0,r|0,56)|0,S()|0,u=e2(o,d,u&7)|0,(u|0)==-1?(a[c>>2]=0,d=6,I=p,d|0):(ps(o,d,f)|0&&pe(23313,22484,282,22499),r=q(o|0,r|0,52)|0,S()|0,r=r&15,tt(o,d)|0?Nr(f,r,u,2,c):Ur(f,r,u,2,c),d=0,I=p,d|0)):(d=6,I=p,d|0)}function nm(o,r,c){o=o|0,r=r|0,c=c|0;var u=0,f=0;u=I,I=I+16|0,f=u,sm(o,r,c,f),Jp(f,c+4|0),I=u}function sm(o,r,c,u){o=o|0,r=r|0,c=c|0,u=u|0;var f=0,d=0,p=0,m=0,_=0;if(m=I,I=I+16|0,_=m,im(o,c,_),d=+Hi(+(1-+M[_>>3]*.5)),d<1e-16){a[u>>2]=0,a[u+4>>2]=0,a[u+8>>2]=0,a[u+12>>2]=0,I=m;return}if(_=a[c>>2]|0,f=+M[15920+(_*24|0)>>3],f=+ci(f-+ci(+Em(15600+(_<<4)|0,o))),$t(r)|0?p=+ci(f+-.3334731722518321):p=f,f=+Xt(+d)/.381966011250105,(r|0)>0){o=0;do f=f*2.6457513110645907,o=o+1|0;while((o|0)!=(r|0))}d=+Ke(+p)*f,M[u>>3]=d,p=+we(+p)*f,M[u+8>>3]=p,I=m}function im(o,r,c){o=o|0,r=r|0,c=c|0;var u=0,f=0,d=0;if(d=I,I=I+32|0,f=d,qm(o,f),a[r>>2]=0,M[c>>3]=5,u=+lt(16400,f),u<+M[c>>3]&&(a[r>>2]=0,M[c>>3]=u),u=+lt(16424,f),u<+M[c>>3]&&(a[r>>2]=1,M[c>>3]=u),u=+lt(16448,f),u<+M[c>>3]&&(a[r>>2]=2,M[c>>3]=u),u=+lt(16472,f),u<+M[c>>3]&&(a[r>>2]=3,M[c>>3]=u),u=+lt(16496,f),u<+M[c>>3]&&(a[r>>2]=4,M[c>>3]=u),u=+lt(16520,f),u<+M[c>>3]&&(a[r>>2]=5,M[c>>3]=u),u=+lt(16544,f),u<+M[c>>3]&&(a[r>>2]=6,M[c>>3]=u),u=+lt(16568,f),u<+M[c>>3]&&(a[r>>2]=7,M[c>>3]=u),u=+lt(16592,f),u<+M[c>>3]&&(a[r>>2]=8,M[c>>3]=u),u=+lt(16616,f),u<+M[c>>3]&&(a[r>>2]=9,M[c>>3]=u),u=+lt(16640,f),u<+M[c>>3]&&(a[r>>2]=10,M[c>>3]=u),u=+lt(16664,f),u<+M[c>>3]&&(a[r>>2]=11,M[c>>3]=u),u=+lt(16688,f),u<+M[c>>3]&&(a[r>>2]=12,M[c>>3]=u),u=+lt(16712,f),u<+M[c>>3]&&(a[r>>2]=13,M[c>>3]=u),u=+lt(16736,f),u<+M[c>>3]&&(a[r>>2]=14,M[c>>3]=u),u=+lt(16760,f),u<+M[c>>3]&&(a[r>>2]=15,M[c>>3]=u),u=+lt(16784,f),u<+M[c>>3]&&(a[r>>2]=16,M[c>>3]=u),u=+lt(16808,f),u<+M[c>>3]&&(a[r>>2]=17,M[c>>3]=u),u=+lt(16832,f),u<+M[c>>3]&&(a[r>>2]=18,M[c>>3]=u),u=+lt(16856,f),!(u<+M[c>>3])){I=d;return}a[r>>2]=19,M[c>>3]=u,I=d}function ri(o,r,c,u,f){o=o|0,r=r|0,c=c|0,u=u|0,f=f|0;var d=0,p=0;if(d=+Zm(o),d<1e-16){r=15600+(r<<4)|0,a[f>>2]=a[r>>2],a[f+4>>2]=a[r+4>>2],a[f+8>>2]=a[r+8>>2],a[f+12>>2]=a[r+12>>2];return}if(p=+Yt(+ +M[o+8>>3],+ +M[o>>3]),(c|0)>0){o=0;do d=d/2.6457513110645907,o=o+1|0;while((o|0)!=(c|0))}u?(d=d/3,c=($t(c)|0)==0,d=+xr(+((c?d:d/2.6457513110645907)*.381966011250105))):(d=+xr(+(d*.381966011250105)),$t(c)|0&&(p=+ci(p+.3334731722518321))),Tm(15600+(r<<4)|0,+ci(+M[15920+(r*24|0)>>3]-p),d,f)}function Am(o,r,c){o=o|0,r=r|0,c=c|0;var u=0,f=0;u=I,I=I+16|0,f=u,Qn(o+4|0,f),ri(f,a[o>>2]|0,r,0,c),I=u}function Nr(o,r,c,u,f){o=o|0,r=r|0,c=c|0,u=u|0,f=f|0;var d=0,p=0,m=0,_=0,b=0,v=0,w=0,P=0,L=0,D=0,H=0,X=0,W=0,J=0,z=0,U=0,ae=0,fe=0,ie=0,ce=0,ze=0,Ge=0,He=0,ve=0,Ee=0,Ie=0,Xe=0,_e=0;if(Ie=I,I=I+272|0,d=Ie+256|0,J=Ie+240|0,He=Ie,ve=Ie+224|0,Ee=Ie+208|0,z=Ie+176|0,U=Ie+160|0,ae=Ie+192|0,fe=Ie+144|0,ie=Ie+128|0,ce=Ie+112|0,ze=Ie+96|0,Ge=Ie+80|0,a[d>>2]=r,a[J>>2]=a[o>>2],a[J+4>>2]=a[o+4>>2],a[J+8>>2]=a[o+8>>2],a[J+12>>2]=a[o+12>>2],kc(J,d,He),a[f>>2]=0,J=u+c+((u|0)==5&1)|0,(J|0)<=(c|0)){I=Ie;return}_=a[d>>2]|0,b=ve+4|0,v=z+4|0,w=c+5|0,P=16880+(_<<2)|0,L=16960+(_<<2)|0,D=ie+8|0,H=ce+8|0,X=ze+8|0,W=Ee+4|0,m=c;e:for(;;){p=He+(((m|0)%5|0)<<4)|0,a[Ee>>2]=a[p>>2],a[Ee+4>>2]=a[p+4>>2],a[Ee+8>>2]=a[p+8>>2],a[Ee+12>>2]=a[p+12>>2];do;while((gs(Ee,_,0,1)|0)==2);if((m|0)>(c|0)&($t(r)|0)!=0){if(a[z>>2]=a[Ee>>2],a[z+4>>2]=a[Ee+4>>2],a[z+8>>2]=a[Ee+8>>2],a[z+12>>2]=a[Ee+12>>2],Qn(b,U),u=a[z>>2]|0,d=a[17040+(u*80|0)+(a[ve>>2]<<2)>>2]|0,a[z>>2]=a[18640+(u*80|0)+(d*20|0)>>2],p=a[18640+(u*80|0)+(d*20|0)+16>>2]|0,(p|0)>0){o=0;do Gc(v),o=o+1|0;while((o|0)<(p|0))}switch(p=18640+(u*80|0)+(d*20|0)+4|0,a[ae>>2]=a[p>>2],a[ae+4>>2]=a[p+4>>2],a[ae+8>>2]=a[p+8>>2],Lc(ae,(a[P>>2]|0)*3|0),Dt(v,ae,v),yt(v),Qn(v,fe),Xe=+(a[L>>2]|0),M[ie>>3]=Xe*3,M[D>>3]=0,_e=Xe*-1.5,M[ce>>3]=_e,M[H>>3]=Xe*2.598076211353316,M[ze>>3]=_e,M[X>>3]=Xe*-2.598076211353316,a[17040+((a[z>>2]|0)*80|0)+(a[Ee>>2]<<2)>>2]|0){case 1:{o=ce,u=ie;break}case 3:{o=ze,u=ce;break}case 2:{o=ie,u=ze;break}default:{o=12;break e}}el(U,fe,u,o,Ge),ri(Ge,a[z>>2]|0,_,1,f+8+(a[f>>2]<<4)|0),a[f>>2]=(a[f>>2]|0)+1}if((m|0)<(w|0)&&(Qn(W,z),ri(z,a[Ee>>2]|0,_,1,f+8+(a[f>>2]<<4)|0),a[f>>2]=(a[f>>2]|0)+1),a[ve>>2]=a[Ee>>2],a[ve+4>>2]=a[Ee+4>>2],a[ve+8>>2]=a[Ee+8>>2],a[ve+12>>2]=a[Ee+12>>2],m=m+1|0,(m|0)>=(J|0)){o=3;break}}if((o|0)==3){I=Ie;return}else(o|0)==12&&pe(22522,22569,571,22579)}function kc(o,r,c){o=o|0,r=r|0,c=c|0;var u=0,f=0,d=0,p=0,m=0,_=0;_=I,I=I+128|0,u=_+64|0,f=_,d=u,p=20240,m=d+60|0;do a[d>>2]=a[p>>2],d=d+4|0,p=p+4|0;while((d|0)<(m|0));d=f,p=20304,m=d+60|0;do a[d>>2]=a[p>>2],d=d+4|0,p=p+4|0;while((d|0)<(m|0));m=($t(a[r>>2]|0)|0)==0,u=m?u:f,f=o+4|0,Nc(f),Uc(f),$t(a[r>>2]|0)|0&&(Kn(f),a[r>>2]=(a[r>>2]|0)+1),a[c>>2]=a[o>>2],r=c+4|0,Dt(f,u,r),yt(r),a[c+16>>2]=a[o>>2],r=c+20|0,Dt(f,u+12|0,r),yt(r),a[c+32>>2]=a[o>>2],r=c+36|0,Dt(f,u+24|0,r),yt(r),a[c+48>>2]=a[o>>2],r=c+52|0,Dt(f,u+36|0,r),yt(r),a[c+64>>2]=a[o>>2],c=c+68|0,Dt(f,u+48|0,c),yt(c),I=_}function gs(o,r,c,u){o=o|0,r=r|0,c=c|0,u=u|0;var f=0,d=0,p=0,m=0,_=0,b=0,v=0,w=0,P=0,L=0,D=0;if(D=I,I=I+32|0,P=D+12|0,m=D,L=o+4|0,w=a[16960+(r<<2)>>2]|0,v=(u|0)!=0,w=v?w*3|0:w,f=a[L>>2]|0,b=o+8|0,p=a[b>>2]|0,v){if(d=o+12|0,u=a[d>>2]|0,f=p+f+u|0,(f|0)==(w|0))return L=1,I=D,L|0;_=d}else _=o+12|0,u=a[_>>2]|0,f=p+f+u|0;if((f|0)<=(w|0))return L=0,I=D,L|0;do if((u|0)>0){if(u=a[o>>2]|0,(p|0)>0){d=18640+(u*80|0)+60|0,u=o;break}u=18640+(u*80|0)+40|0,c?(kp(P,w,0,0),Or(L,P,m),Vi(m),Dt(m,P,L),d=u,u=o):(d=u,u=o)}else d=18640+((a[o>>2]|0)*80|0)+20|0,u=o;while(!1);if(a[u>>2]=a[d>>2],f=d+16|0,(a[f>>2]|0)>0){u=0;do Gc(L),u=u+1|0;while((u|0)<(a[f>>2]|0))}return o=d+4|0,a[P>>2]=a[o>>2],a[P+4>>2]=a[o+4>>2],a[P+8>>2]=a[o+8>>2],r=a[16880+(r<<2)>>2]|0,Lc(P,v?r*3|0:r),Dt(L,P,L),yt(L),v?u=((a[b>>2]|0)+(a[L>>2]|0)+(a[_>>2]|0)|0)==(w|0)?1:2:u=2,L=u,I=D,L|0}function rm(o,r){o=o|0,r=r|0;var c=0;do c=gs(o,r,0,1)|0;while((c|0)==2);return c|0}function Ur(o,r,c,u,f){o=o|0,r=r|0,c=c|0,u=u|0,f=f|0;var d=0,p=0,m=0,_=0,b=0,v=0,w=0,P=0,L=0,D=0,H=0,X=0,W=0,J=0,z=0,U=0,ae=0,fe=0,ie=0,ce=0,ze=0,Ge=0,He=0;if(ze=I,I=I+240|0,d=ze+224|0,ae=ze+208|0,fe=ze,ie=ze+192|0,ce=ze+176|0,X=ze+160|0,W=ze+144|0,J=ze+128|0,z=ze+112|0,U=ze+96|0,a[d>>2]=r,a[ae>>2]=a[o>>2],a[ae+4>>2]=a[o+4>>2],a[ae+8>>2]=a[o+8>>2],a[ae+12>>2]=a[o+12>>2],Jc(ae,d,fe),a[f>>2]=0,H=u+c+((u|0)==6&1)|0,(H|0)<=(c|0)){I=ze;return}_=a[d>>2]|0,b=c+6|0,v=16960+(_<<2)|0,w=W+8|0,P=J+8|0,L=z+8|0,D=ie+4|0,p=0,m=c,u=-1;e:for(;;){if(d=(m|0)%6|0,o=fe+(d<<4)|0,a[ie>>2]=a[o>>2],a[ie+4>>2]=a[o+4>>2],a[ie+8>>2]=a[o+8>>2],a[ie+12>>2]=a[o+12>>2],o=p,p=gs(ie,_,0,1)|0,(m|0)>(c|0)&($t(r)|0)!=0&&(o|0)!=1&&(a[ie>>2]|0)!=(u|0)){switch(Qn(fe+(((d+5|0)%6|0)<<4)+4|0,ce),Qn(fe+(d<<4)+4|0,X),Ge=+(a[v>>2]|0),M[W>>3]=Ge*3,M[w>>3]=0,He=Ge*-1.5,M[J>>3]=He,M[P>>3]=Ge*2.598076211353316,M[z>>3]=He,M[L>>3]=Ge*-2.598076211353316,d=a[ae>>2]|0,a[17040+(d*80|0)+(((u|0)==(d|0)?a[ie>>2]|0:u)<<2)>>2]|0){case 1:{o=J,u=W;break}case 3:{o=z,u=J;break}case 2:{o=W,u=z;break}default:{o=8;break e}}el(ce,X,u,o,U),!(tl(ce,U)|0)&&!(tl(X,U)|0)&&(ri(U,a[ae>>2]|0,_,1,f+8+(a[f>>2]<<4)|0),a[f>>2]=(a[f>>2]|0)+1)}if((m|0)<(b|0)&&(Qn(D,ce),ri(ce,a[ie>>2]|0,_,1,f+8+(a[f>>2]<<4)|0),a[f>>2]=(a[f>>2]|0)+1),m=m+1|0,(m|0)>=(H|0)){o=3;break}else u=a[ie>>2]|0}if((o|0)==3){I=ze;return}else(o|0)==8&&pe(22606,22569,736,22651)}function Jc(o,r,c){o=o|0,r=r|0,c=c|0;var u=0,f=0,d=0,p=0,m=0,_=0;_=I,I=I+160|0,u=_+80|0,f=_,d=u,p=20368,m=d+72|0;do a[d>>2]=a[p>>2],d=d+4|0,p=p+4|0;while((d|0)<(m|0));d=f,p=20448,m=d+72|0;do a[d>>2]=a[p>>2],d=d+4|0,p=p+4|0;while((d|0)<(m|0));m=($t(a[r>>2]|0)|0)==0,u=m?u:f,f=o+4|0,Nc(f),Uc(f),$t(a[r>>2]|0)|0&&(Kn(f),a[r>>2]=(a[r>>2]|0)+1),a[c>>2]=a[o>>2],r=c+4|0,Dt(f,u,r),yt(r),a[c+16>>2]=a[o>>2],r=c+20|0,Dt(f,u+12|0,r),yt(r),a[c+32>>2]=a[o>>2],r=c+36|0,Dt(f,u+24|0,r),yt(r),a[c+48>>2]=a[o>>2],r=c+52|0,Dt(f,u+36|0,r),yt(r),a[c+64>>2]=a[o>>2],r=c+68|0,Dt(f,u+48|0,r),yt(r),a[c+80>>2]=a[o>>2],c=c+84|0,Dt(f,u+60|0,c),yt(c),I=_}function om(o,r){return o=o|0,r=r|0,r=q(o|0,r|0,52)|0,S()|0,r&15|0}function Vc(o,r){return o=o|0,r=r|0,r=q(o|0,r|0,45)|0,S()|0,r&127|0}function Hr(o,r){o=o|0,r=r|0;var c=0,u=0,f=0,d=0,p=0,m=0;if(!(!0&(r&-16777216|0)==134217728)||(p=q(o|0,r|0,45)|0,S()|0,p=p&127,p>>>0>121))return r=0,r|0;c=q(o|0,r|0,52)|0,S()|0,c=c&15;do if(c|0){for(f=1,u=0;;){if(d=q(o|0,r|0,(15-f|0)*3|0)|0,S()|0,d=d&7,(d|0)!=0&(u^1))if((d|0)==1&(et(p)|0)!=0){m=0,u=13;break}else u=1;if((d|0)==7){m=0,u=13;break}if(f>>>0<c>>>0)f=f+1|0;else{u=9;break}}if((u|0)==9){if((c|0)==15)m=1;else break;return m|0}else if((u|0)==13)return m|0}while(!1);for(;;){if(m=q(o|0,r|0,(14-c|0)*3|0)|0,S()|0,!((m&7|0)==7&!0)){m=0,u=13;break}if(c>>>0<14)c=c+1|0;else{m=1,u=13;break}}return(u|0)==13?m|0:0}function kr(o,r,c,u){o=o|0,r=r|0,c=c|0,u=u|0;var f=0,d=0;if(d=q(o|0,r|0,52)|0,S()|0,d=d&15,c>>>0>15)return u=4,u|0;if((d|0)<(c|0))return u=12,u|0;if((d|0)==(c|0))return a[u>>2]=o,a[u+4>>2]=r,u=0,u|0;if(f=Ae(c|0,0,52)|0,f=f|o,o=S()|0|r&-15728641,(d|0)>(c|0))do r=Ae(7,0,(14-c|0)*3|0)|0,c=c+1|0,f=r|f,o=S()|0|o;while((c|0)<(d|0));return a[u>>2]=f,a[u+4>>2]=o,u=0,u|0}function ji(o,r,c,u){o=o|0,r=r|0,c=c|0,u=u|0;var f=0,d=0,p=0;if(d=q(o|0,r|0,52)|0,S()|0,d=d&15,!((c|0)<16&(d|0)<=(c|0)))return u=4,u|0;f=c-d|0,c=q(o|0,r|0,45)|0,S()|0;e:do if(!(et(c&127)|0))c=Ln(7,0,f,((f|0)<0)<<31>>31)|0,f=S()|0;else{t:do if(d|0){for(c=1;p=Ae(7,0,(15-c|0)*3|0)|0,!!((p&o|0)==0&((S()|0)&r|0)==0);)if(c>>>0<d>>>0)c=c+1|0;else break t;c=Ln(7,0,f,((f|0)<0)<<31>>31)|0,f=S()|0;break e}while(!1);c=Ln(7,0,f,((f|0)<0)<<31>>31)|0,c=Et(c|0,S()|0,5,0)|0,c=Pe(c|0,S()|0,-5,-1)|0,c=Yn(c|0,S()|0,6,0)|0,c=Pe(c|0,S()|0,1,0)|0,f=S()|0}while(!1);return p=u,a[p>>2]=c,a[p+4>>2]=f,p=0,p|0}function tt(o,r){o=o|0,r=r|0;var c=0,u=0,f=0;if(f=q(o|0,r|0,45)|0,S()|0,!(et(f&127)|0))return f=0,f|0;f=q(o|0,r|0,52)|0,S()|0,f=f&15;e:do if(!f)c=0;else for(u=1;;){if(c=q(o|0,r|0,(15-u|0)*3|0)|0,S()|0,c=c&7,c|0)break e;if(u>>>0<f>>>0)u=u+1|0;else{c=0;break}}while(!1);return f=(c|0)==0&1,f|0}function am(o,r,c,u){o=o|0,r=r|0,c=c|0,u=u|0;var f=0,d=0,p=0,m=0;if(p=I,I=I+16|0,d=p,Qc(d,o,r,c),r=d,o=a[r>>2]|0,r=a[r+4>>2]|0,(o|0)==0&(r|0)==0)return I=p,0;f=0,c=0;do m=u+(f<<3)|0,a[m>>2]=o,a[m+4>>2]=r,f=Pe(f|0,c|0,1,0)|0,c=S()|0,Kc(d),m=d,o=a[m>>2]|0,r=a[m+4>>2]|0;while(!((o|0)==0&(r|0)==0));return I=p,0}function cm(o,r,c,u){return o=o|0,r=r|0,c=c|0,u=u|0,(u|0)<(c|0)?(c=r,u=o,Se(c|0),u|0):(c=Ae(-1,-1,((u-c|0)*3|0)+3|0)|0,u=Ae(~c|0,~(S()|0)|0,(15-u|0)*3|0)|0,c=~(S()|0)&r,u=~u&o,Se(c|0),u|0)}function lm(o,r,c,u){o=o|0,r=r|0,c=c|0,u=u|0;var f=0;return f=q(o|0,r|0,52)|0,S()|0,f=f&15,(c|0)<16&(f|0)<=(c|0)?((f|0)<(c|0)&&(f=Ae(-1,-1,((c+-1-f|0)*3|0)+3|0)|0,f=Ae(~f|0,~(S()|0)|0,(15-c|0)*3|0)|0,r=~(S()|0)&r,o=~f&o),f=Ae(c|0,0,52)|0,c=r&-15728641|(S()|0),a[u>>2]=o|f,a[u+4>>2]=c,u=0,u|0):(u=4,u|0)}function um(o,r,c,u){o=o|0,r=r|0,c=c|0,u=u|0;var f=0,d=0,p=0,m=0,_=0,b=0,v=0,w=0,P=0,L=0,D=0,H=0,X=0,W=0,J=0,z=0,U=0,ae=0,fe=0,ie=0,ce=0;if((c|0)==0&(u|0)==0)return ie=0,ie|0;if(f=o,d=a[f>>2]|0,f=a[f+4>>2]|0,!0&(f&15728640|0)==0){if(!((u|0)>0|(u|0)==0&c>>>0>0)||(ie=r,a[ie>>2]=d,a[ie+4>>2]=f,(c|0)==1&(u|0)==0))return ie=0,ie|0;f=1;do ae=o+(f<<3)|0,fe=a[ae+4>>2]|0,ie=r+(f<<3)|0,a[ie>>2]=a[ae>>2],a[ie+4>>2]=fe,f=f+1|0;while(0<(u|0)|(u|0)==0&f>>>0<c>>>0);return f=0,f|0}if(U=c<<3,fe=dn(U)|0,!fe)return ie=13,ie|0;if(Wi(fe|0,o|0,U|0)|0,ae=gn(c,8)|0,!ae)return Ce(fe),ie=13,ie|0;e:do if(c|0){t:for(;;){f=fe,W=a[f>>2]|0,f=a[f+4>>2]|0,J=q(W|0,f|0,52)|0,S()|0,J=J&15,z=J+-1|0,X=(c|0)>0;n:do if((J|0)!=0&X){if(L=((c|0)<0)<<31>>31,D=Ae(z|0,0,52)|0,H=S()|0,z>>>0>15){if(!((W|0)==0&(f|0)==0)){ie=17;break t}for(d=0;;){if(d=d+1|0,(d|0)>=(c|0))break n;if(u=fe+(d<<3)|0,H=a[u>>2]|0,u=a[u+4>>2]|0,!((H|0)==0&(u|0)==0)){f=u,ie=17;break t}}}for(d=0,o=W,u=f;;){if(!((o|0)==0&(u|0)==0)){if(!(!0&(u&117440512|0)==0)){ie=22;break t}if(m=q(o|0,u|0,52)|0,S()|0,m=m&15,(m|0)<(z|0)){f=12,ie=28;break t}if((m|0)!=(z|0)&&(o=o|D,u=u&-15728641|H,m>>>0>=J>>>0)){p=z;do P=Ae(7,0,(14-p|0)*3|0)|0,p=p+1|0,o=P|o,u=S()|0|u;while(p>>>0<m>>>0)}if(p=Bs(o|0,u|0,c|0,L|0)|0,S()|0,b=ae+(p<<3)|0,m=b,_=a[m>>2]|0,m=a[m+4>>2]|0,(_|0)==0&(m|0)==0)p=b;else for(P=0;;){if((P|0)>(c|0)){ie=32;break t}if((_|0)==(o|0)&(m&-117440513|0)==(u|0)){v=q(_|0,m|0,56)|0,S()|0,v=v&7,w=v+1|0,ce=q(_|0,m|0,45)|0,S()|0;s:do if(!(et(ce&127)|0))m=7;else{if(_=q(_|0,m|0,52)|0,S()|0,_=_&15,!_){m=6;break}for(m=1;;){if(ce=Ae(7,0,(15-m|0)*3|0)|0,!((ce&o|0)==0&((S()|0)&u|0)==0)){m=7;break s}if(m>>>0<_>>>0)m=m+1|0;else{m=6;break}}}while(!1);if((v+2|0)>>>0>m>>>0){ie=42;break t}ce=Ae(w|0,0,56)|0,u=S()|0|u&-117440513,w=b,a[w>>2]=0,a[w+4>>2]=0,o=ce|o}else p=(p+1|0)%(c|0)|0;if(b=ae+(p<<3)|0,m=b,_=a[m>>2]|0,m=a[m+4>>2]|0,(_|0)==0&(m|0)==0){p=b;break}else P=P+1|0}ce=p,a[ce>>2]=o,a[ce+4>>2]=u}if(d=d+1|0,(d|0)>=(c|0))break n;u=fe+(d<<3)|0,o=a[u>>2]|0,u=a[u+4>>2]|0}}while(!1);if((c+5|0)>>>0<11){ie=85;break}if(H=gn((c|0)/6|0,8)|0,!H){ie=49;break}n:do if(X){P=0,w=0;do{if(m=ae+(P<<3)|0,u=m,d=a[u>>2]|0,u=a[u+4>>2]|0,!((d|0)==0&(u|0)==0)){_=q(d|0,u|0,56)|0,S()|0,_=_&7,o=_+1|0,b=u&-117440513,ce=q(d|0,u|0,45)|0,S()|0;s:do if(et(ce&127)|0){if(v=q(d|0,u|0,52)|0,S()|0,v=v&15,v|0)for(p=1;;){if(ce=Ae(7,0,(15-p|0)*3|0)|0,!((d&ce|0)==0&(b&(S()|0)|0)==0))break s;if(p>>>0<v>>>0)p=p+1|0;else break}u=Ae(o|0,0,56)|0,d=u|d,u=S()|0|b,o=m,a[o>>2]=d,a[o+4>>2]=u,o=_+2|0}while(!1);(o|0)==7&&(ce=H+(w<<3)|0,a[ce>>2]=d,a[ce+4>>2]=u&-117440513,w=w+1|0)}P=P+1|0}while((P|0)!=(c|0));if(X){if(P=((c|0)<0)<<31>>31,L=Ae(z|0,0,52)|0,D=S()|0,z>>>0>15){if(!((W|0)==0&(f|0)==0)){f=4,ie=84;break t}for(f=0;;){if(f=f+1|0,(f|0)>=(c|0)){d=0,f=w;break n}if(ce=fe+(f<<3)|0,!((a[ce>>2]|0)==0&(a[ce+4>>2]|0)==0)){f=4,ie=84;break t}}}for(v=0,d=0,b=W;;){do if(!((b|0)==0&(f|0)==0)){if(m=q(b|0,f|0,52)|0,S()|0,m=m&15,(m|0)<(z|0)){f=12,ie=84;break t}do if((m|0)==(z|0))u=b,m=f;else{if(u=b|L,o=f&-15728641|D,m>>>0<J>>>0){m=o;break}p=z;do ce=Ae(7,0,(14-p|0)*3|0)|0,p=p+1|0,u=ce|u,o=S()|0|o;while(p>>>0<m>>>0);m=o}while(!1);for(p=Bs(u|0,m|0,c|0,P|0)|0,S()|0,o=0;;){if((o|0)>(c|0)){ie=77;break t}if(ce=ae+(p<<3)|0,_=a[ce+4>>2]|0,(_&-117440513|0)==(m|0)&&(a[ce>>2]|0)==(u|0)){ie=79;break}if(p=(p+1|0)%(c|0)|0,ce=ae+(p<<3)|0,(a[ce>>2]|0)==(u|0)&&(a[ce+4>>2]|0)==(m|0))break;o=o+1|0}if((ie|0)==79&&(ie=0,!0&(_&117440512|0)==100663296))break;ce=r+(d<<3)|0,a[ce>>2]=b,a[ce+4>>2]=f,d=d+1|0}while(!1);if(f=v+1|0,(f|0)>=(c|0)){f=w;break n}ce=fe+(f<<3)|0,v=f,b=a[ce>>2]|0,f=a[ce+4>>2]|0}}else d=0,f=w}else d=0,f=0;while(!1);if($n(ae|0,0,U|0)|0,Wi(fe|0,H|0,f<<3|0)|0,Ce(H),f)r=r+(d<<3)|0,c=f;else break e}if((ie|0)==17)!0&(f&117440512|0)==0?(f=4,ie=28):ie=22;else if((ie|0)==32)pe(23313,22674,362,22684);else{if((ie|0)==42)return Ce(fe),Ce(ae),ce=10,ce|0;if((ie|0)==49)return Ce(fe),Ce(ae),ce=13,ce|0;if((ie|0)==77)pe(23313,22674,462,22684);else{if((ie|0)==84)return Ce(H),Ce(fe),Ce(ae),ce=f,ce|0;if((ie|0)==85){Wi(r|0,fe|0,c<<3|0)|0;break}}}if((ie|0)==22)return Ce(fe),Ce(ae),ce=5,ce|0;if((ie|0)==28)return Ce(fe),Ce(ae),ce=f,ce|0}while(!1);return Ce(fe),Ce(ae),ce=0,ce|0}function fm(o,r,c,u,f,d,p){o=o|0,r=r|0,c=c|0,u=u|0,f=f|0,d=d|0,p=p|0;var m=0,_=0,b=0,v=0,w=0,P=0,L=0,D=0,H=0;if(H=I,I=I+16|0,D=H,!((c|0)>0|(c|0)==0&r>>>0>0))return D=0,I=H,D|0;if((p|0)>=16)return D=12,I=H,D|0;P=0,L=0,w=0,m=0;e:for(;;){if(b=o+(P<<3)|0,_=a[b>>2]|0,b=a[b+4>>2]|0,v=q(_|0,b|0,52)|0,S()|0,(v&15|0)>(p|0)){m=12,_=11;break}if(Qc(D,_,b,p),v=D,b=a[v>>2]|0,v=a[v+4>>2]|0,(b|0)==0&(v|0)==0)_=w;else{_=w;do{if(!((m|0)<(d|0)|(m|0)==(d|0)&_>>>0<f>>>0)){_=10;break e}w=u+(_<<3)|0,a[w>>2]=b,a[w+4>>2]=v,_=Pe(_|0,m|0,1,0)|0,m=S()|0,Kc(D),w=D,b=a[w>>2]|0,v=a[w+4>>2]|0}while(!((b|0)==0&(v|0)==0))}if(P=Pe(P|0,L|0,1,0)|0,L=S()|0,(L|0)<(c|0)|(L|0)==(c|0)&P>>>0<r>>>0)w=_;else{m=0,_=11;break}}return(_|0)==10?(D=14,I=H,D|0):(_|0)==11?(I=H,m|0):0}function hm(o,r,c,u,f){o=o|0,r=r|0,c=c|0,u=u|0,f=f|0;var d=0,p=0,m=0,_=0,b=0,v=0,w=0,P=0;P=I,I=I+16|0,w=P;e:do if((c|0)>0|(c|0)==0&r>>>0>0){for(b=0,p=0,d=0,v=0;;){if(_=o+(b<<3)|0,m=a[_>>2]|0,_=a[_+4>>2]|0,!((m|0)==0&(_|0)==0)&&(_=(ji(m,_,u,w)|0)==0,m=w,p=Pe(a[m>>2]|0,a[m+4>>2]|0,p|0,d|0)|0,d=S()|0,!_)){d=12;break}if(b=Pe(b|0,v|0,1,0)|0,v=S()|0,!((v|0)<(c|0)|(v|0)==(c|0)&b>>>0<r>>>0))break e}return I=P,d|0}else p=0,d=0;while(!1);return a[f>>2]=p,a[f+4>>2]=d,f=0,I=P,f|0}function dm(o,r){return o=o|0,r=r|0,r=q(o|0,r|0,52)|0,S()|0,r&1|0}function Lt(o,r){o=o|0,r=r|0;var c=0,u=0,f=0;if(f=q(o|0,r|0,52)|0,S()|0,f=f&15,!f)return f=0,f|0;for(u=1;;){if(c=q(o|0,r|0,(15-u|0)*3|0)|0,S()|0,c=c&7,c|0){u=5;break}if(u>>>0<f>>>0)u=u+1|0;else{c=0,u=5;break}}return(u|0)==5?c|0:0}function Jr(o,r){o=o|0,r=r|0;var c=0,u=0,f=0,d=0,p=0,m=0,_=0;if(_=q(o|0,r|0,52)|0,S()|0,_=_&15,!_)return m=r,_=o,Se(m|0),_|0;for(m=1,c=0;;){d=(15-m|0)*3|0,u=Ae(7,0,d|0)|0,f=S()|0,p=q(o|0,r|0,d|0)|0,S()|0,d=Ae(Wn(p&7)|0,0,d|0)|0,p=S()|0,o=d|o&~u,r=p|r&~f;e:do if(!c)if((d&u|0)==0&(p&f|0)==0)c=0;else if(u=q(o|0,r|0,52)|0,S()|0,u=u&15,!u)c=1;else{c=1;t:for(;;){switch(p=q(o|0,r|0,(15-c|0)*3|0)|0,S()|0,p&7){case 1:break t;case 0:break;default:{c=1;break e}}if(c>>>0<u>>>0)c=c+1|0;else{c=1;break e}}for(c=1;;)if(p=(15-c|0)*3|0,f=q(o|0,r|0,p|0)|0,S()|0,d=Ae(7,0,p|0)|0,r=r&~(S()|0),p=Ae(Wn(f&7)|0,0,p|0)|0,o=o&~d|p,r=r|(S()|0),c>>>0<u>>>0)c=c+1|0;else{c=1;break}}while(!1);if(m>>>0<_>>>0)m=m+1|0;else break}return Se(r|0),o|0}function Xn(o,r){o=o|0,r=r|0;var c=0,u=0,f=0,d=0,p=0;if(u=q(o|0,r|0,52)|0,S()|0,u=u&15,!u)return c=r,u=o,Se(c|0),u|0;for(c=1;d=(15-c|0)*3|0,p=q(o|0,r|0,d|0)|0,S()|0,f=Ae(7,0,d|0)|0,r=r&~(S()|0),d=Ae(Wn(p&7)|0,0,d|0)|0,o=d|o&~f,r=S()|0|r,c>>>0<u>>>0;)c=c+1|0;return Se(r|0),o|0}function gm(o,r){o=o|0,r=r|0;var c=0,u=0,f=0,d=0,p=0,m=0,_=0;if(_=q(o|0,r|0,52)|0,S()|0,_=_&15,!_)return m=r,_=o,Se(m|0),_|0;for(m=1,c=0;;){d=(15-m|0)*3|0,u=Ae(7,0,d|0)|0,f=S()|0,p=q(o|0,r|0,d|0)|0,S()|0,d=Ae(Fn(p&7)|0,0,d|0)|0,p=S()|0,o=d|o&~u,r=p|r&~f;e:do if(!c)if((d&u|0)==0&(p&f|0)==0)c=0;else if(u=q(o|0,r|0,52)|0,S()|0,u=u&15,!u)c=1;else{c=1;t:for(;;){switch(p=q(o|0,r|0,(15-c|0)*3|0)|0,S()|0,p&7){case 1:break t;case 0:break;default:{c=1;break e}}if(c>>>0<u>>>0)c=c+1|0;else{c=1;break e}}for(c=1;;)if(f=(15-c|0)*3|0,d=Ae(7,0,f|0)|0,p=r&~(S()|0),r=q(o|0,r|0,f|0)|0,S()|0,r=Ae(Fn(r&7)|0,0,f|0)|0,o=o&~d|r,r=p|(S()|0),c>>>0<u>>>0)c=c+1|0;else{c=1;break}}while(!1);if(m>>>0<_>>>0)m=m+1|0;else break}return Se(r|0),o|0}function Vr(o,r){o=o|0,r=r|0;var c=0,u=0,f=0,d=0,p=0;if(u=q(o|0,r|0,52)|0,S()|0,u=u&15,!u)return c=r,u=o,Se(c|0),u|0;for(c=1;p=(15-c|0)*3|0,d=Ae(7,0,p|0)|0,f=r&~(S()|0),r=q(o|0,r|0,p|0)|0,S()|0,r=Ae(Fn(r&7)|0,0,p|0)|0,o=r|o&~d,r=S()|0|f,c>>>0<u>>>0;)c=c+1|0;return Se(r|0),o|0}function pm(o,r){o=o|0,r=r|0;var c=0,u=0,f=0,d=0,p=0,m=0,_=0,b=0,v=0;if(_=I,I=I+64|0,m=_+40|0,u=_+24|0,f=_+12|0,d=_,Ae(r|0,0,52)|0,c=S()|0|134225919,!r)return(a[o+4>>2]|0)>2||(a[o+8>>2]|0)>2||(a[o+12>>2]|0)>2?(p=0,m=0,Se(p|0),I=_,m|0):(Ae(Sc(o)|0,0,45)|0,p=S()|0|c,m=-1,Se(p|0),I=_,m|0);if(a[m>>2]=a[o>>2],a[m+4>>2]=a[o+4>>2],a[m+8>>2]=a[o+8>>2],a[m+12>>2]=a[o+12>>2],p=m+4|0,(r|0)>0)for(o=-1;a[u>>2]=a[p>>2],a[u+4>>2]=a[p+4>>2],a[u+8>>2]=a[p+8>>2],r&1?(jp(p),a[f>>2]=a[p>>2],a[f+4>>2]=a[p+4>>2],a[f+8>>2]=a[p+8>>2],Ji(f)):(Rc(p),a[f>>2]=a[p>>2],a[f+4>>2]=a[p+4>>2],a[f+8>>2]=a[p+8>>2],Kn(f)),Or(u,f,d),yt(d),v=(15-r|0)*3|0,b=Ae(7,0,v|0)|0,c=c&~(S()|0),v=Ae(ki(d)|0,0,v|0)|0,o=v|o&~b,c=S()|0|c,(r|0)>1;)r=r+-1|0;else o=-1;e:do if((a[p>>2]|0)<=2&&(a[m+8>>2]|0)<=2&&(a[m+12>>2]|0)<=2){if(u=Sc(m)|0,r=Ae(u|0,0,45)|0,r=r|o,o=S()|0|c&-1040385,d=Rp(m)|0,!(et(u)|0)){if((d|0)<=0)break;for(f=0;;){if(u=q(r|0,o|0,52)|0,S()|0,u=u&15,u)for(c=1;v=(15-c|0)*3|0,m=q(r|0,o|0,v|0)|0,S()|0,b=Ae(7,0,v|0)|0,o=o&~(S()|0),v=Ae(Wn(m&7)|0,0,v|0)|0,r=r&~b|v,o=o|(S()|0),c>>>0<u>>>0;)c=c+1|0;if(f=f+1|0,(f|0)==(d|0))break e}}f=q(r|0,o|0,52)|0,S()|0,f=f&15;t:do if(f){c=1;n:for(;;){switch(v=q(r|0,o|0,(15-c|0)*3|0)|0,S()|0,v&7){case 1:break n;case 0:break;default:break t}if(c>>>0<f>>>0)c=c+1|0;else break t}if(xc(u,a[m>>2]|0)|0)for(c=1;m=(15-c|0)*3|0,b=Ae(7,0,m|0)|0,v=o&~(S()|0),o=q(r|0,o|0,m|0)|0,S()|0,o=Ae(Fn(o&7)|0,0,m|0)|0,r=r&~b|o,o=v|(S()|0),c>>>0<f>>>0;)c=c+1|0;else for(c=1;v=(15-c|0)*3|0,m=q(r|0,o|0,v|0)|0,S()|0,b=Ae(7,0,v|0)|0,o=o&~(S()|0),v=Ae(Wn(m&7)|0,0,v|0)|0,r=r&~b|v,o=o|(S()|0),c>>>0<f>>>0;)c=c+1|0}while(!1);if((d|0)>0){c=0;do r=Jr(r,o)|0,o=S()|0,c=c+1|0;while((c|0)!=(d|0))}}else r=0,o=0;while(!1);return b=o,v=r,Se(b|0),I=_,v|0}function $t(o){return o=o|0,(o|0)%2|0|0}function zc(o,r,c){o=o|0,r=r|0,c=c|0;var u=0,f=0;return f=I,I=I+16|0,u=f,r>>>0>15?(u=4,I=f,u|0):(a[o+4>>2]&2146435072|0)==2146435072||(a[o+8+4>>2]&2146435072|0)==2146435072?(u=3,I=f,u|0):(nm(o,r,u),r=pm(u,r)|0,u=S()|0,a[c>>2]=r,a[c+4>>2]=u,(r|0)==0&(u|0)==0&&pe(23313,22674,786,22697),u=0,I=f,u|0)}function zr(o,r,c){o=o|0,r=r|0,c=c|0;var u=0,f=0,d=0,p=0;if(f=c+4|0,d=q(o|0,r|0,52)|0,S()|0,d=d&15,p=q(o|0,r|0,45)|0,S()|0,u=(d|0)==0,et(p&127)|0){if(u)return p=1,p|0;u=1}else{if(u)return p=0,p|0;(a[f>>2]|0)==0&&(a[c+8>>2]|0)==0?u=(a[c+12>>2]|0)!=0&1:u=1}for(c=1;c&1?Ji(f):Kn(f),p=q(o|0,r|0,(15-c|0)*3|0)|0,S()|0,Oc(f,p&7),c>>>0<d>>>0;)c=c+1|0;return u|0}function ps(o,r,c){o=o|0,r=r|0,c=c|0;var u=0,f=0,d=0,p=0,m=0,_=0,b=0,v=0;if(v=I,I=I+16|0,_=v,b=q(o|0,r|0,45)|0,S()|0,b=b&127,b>>>0>121)return a[c>>2]=0,a[c+4>>2]=0,a[c+8>>2]=0,a[c+12>>2]=0,b=5,I=v,b|0;e:do if((et(b)|0)!=0&&(d=q(o|0,r|0,52)|0,S()|0,d=d&15,(d|0)!=0)){u=1;t:for(;;){switch(m=q(o|0,r|0,(15-u|0)*3|0)|0,S()|0,m&7){case 5:break t;case 0:break;default:{u=r;break e}}if(u>>>0<d>>>0)u=u+1|0;else{u=r;break e}}for(f=1,u=r;r=(15-f|0)*3|0,p=Ae(7,0,r|0)|0,m=u&~(S()|0),u=q(o|0,u|0,r|0)|0,S()|0,u=Ae(Fn(u&7)|0,0,r|0)|0,o=o&~p|u,u=m|(S()|0),f>>>0<d>>>0;)f=f+1|0}else u=r;while(!1);if(m=7696+(b*28|0)|0,a[c>>2]=a[m>>2],a[c+4>>2]=a[m+4>>2],a[c+8>>2]=a[m+8>>2],a[c+12>>2]=a[m+12>>2],!(zr(o,u,c)|0))return b=0,I=v,b|0;if(p=c+4|0,a[_>>2]=a[p>>2],a[_+4>>2]=a[p+4>>2],a[_+8>>2]=a[p+8>>2],d=q(o|0,u|0,52)|0,S()|0,m=d&15,d&1?(Kn(p),d=m+1|0):d=m,!(et(b)|0))u=0;else{e:do if(!m)u=0;else for(r=1;;){if(f=q(o|0,u|0,(15-r|0)*3|0)|0,S()|0,f=f&7,f|0){u=f;break e}if(r>>>0<m>>>0)r=r+1|0;else{u=0;break}}while(!1);u=(u|0)==4&1}if(!(gs(c,d,u,0)|0))(d|0)!=(m|0)&&(a[p>>2]=a[_>>2],a[p+4>>2]=a[_+4>>2],a[p+8>>2]=a[_+8>>2]);else{if(et(b)|0)do;while((gs(c,d,0,0)|0)!=0);(d|0)!=(m|0)&&Rc(p)}return b=0,I=v,b|0}function oi(o,r,c){o=o|0,r=r|0,c=c|0;var u=0,f=0,d=0;return d=I,I=I+16|0,u=d,f=ps(o,r,u)|0,f|0?(I=d,f|0):(f=q(o|0,r|0,52)|0,S()|0,Am(u,f&15,c),f=0,I=d,f|0)}function ai(o,r,c){o=o|0,r=r|0,c=c|0;var u=0,f=0,d=0,p=0,m=0;if(p=I,I=I+16|0,d=p,u=ps(o,r,d)|0,u|0)return d=u,I=p,d|0;u=q(o|0,r|0,45)|0,S()|0,u=(et(u&127)|0)==0,f=q(o|0,r|0,52)|0,S()|0,f=f&15;e:do if(!u){if(f|0)for(u=1;;){if(m=Ae(7,0,(15-u|0)*3|0)|0,!((m&o|0)==0&((S()|0)&r|0)==0))break e;if(u>>>0<f>>>0)u=u+1|0;else break}return Nr(d,f,0,5,c),m=0,I=p,m|0}while(!1);return Ur(d,f,0,6,c),m=0,I=p,m|0}function mm(o,r,c){o=o|0,r=r|0,c=c|0;var u=0,f=0,d=0;if(f=q(o|0,r|0,45)|0,S()|0,!(et(f&127)|0))return f=2,a[c>>2]=f,0;if(f=q(o|0,r|0,52)|0,S()|0,f=f&15,!f)return f=5,a[c>>2]=f,0;for(u=1;;){if(d=Ae(7,0,(15-u|0)*3|0)|0,!((d&o|0)==0&((S()|0)&r|0)==0)){u=2,o=6;break}if(u>>>0<f>>>0)u=u+1|0;else{u=5,o=6;break}}return(o|0)==6&&(a[c>>2]=u),0}function jc(o,r,c){o=o|0,r=r|0,c=c|0;var u=0,f=0,d=0,p=0,m=0,_=0,b=0,v=0,w=0;w=I,I=I+128|0,b=w+112|0,d=w+96|0,v=w,f=q(o|0,r|0,52)|0,S()|0,m=f&15,a[b>>2]=m,p=q(o|0,r|0,45)|0,S()|0,p=p&127;e:do if(et(p)|0){if(m|0)for(u=1;;){if(_=Ae(7,0,(15-u|0)*3|0)|0,!((_&o|0)==0&((S()|0)&r|0)==0)){f=0;break e}if(u>>>0<m>>>0)u=u+1|0;else break}if(f&1)f=1;else return _=Ae(m+1|0,0,52)|0,v=S()|0|r&-15728641,b=Ae(7,0,(14-m|0)*3|0)|0,v=jc((_|o)&~b,v&~(S()|0),c)|0,I=w,v|0}else f=0;while(!1);if(u=ps(o,r,d)|0,!u){f?(kc(d,b,v),_=5):(Jc(d,b,v),_=6);e:do if(et(p)|0)if(!m)o=5;else for(u=1;;){if(p=Ae(7,0,(15-u|0)*3|0)|0,!((p&o|0)==0&((S()|0)&r|0)==0)){o=2;break e}if(u>>>0<m>>>0)u=u+1|0;else{o=5;break}}else o=2;while(!1);$n(c|0,-1,o<<2|0)|0;e:do if(f)for(d=0;;){if(p=v+(d<<4)|0,rm(p,a[b>>2]|0)|0,p=a[p>>2]|0,m=a[c>>2]|0,(m|0)==-1|(m|0)==(p|0))u=c;else{f=0;do{if(f=f+1|0,f>>>0>=o>>>0){u=1;break e}u=c+(f<<2)|0,m=a[u>>2]|0}while(!((m|0)==-1|(m|0)==(p|0)))}if(a[u>>2]=p,d=d+1|0,d>>>0>=_>>>0){u=0;break}}else for(d=0;;){if(p=v+(d<<4)|0,gs(p,a[b>>2]|0,0,1)|0,p=a[p>>2]|0,m=a[c>>2]|0,(m|0)==-1|(m|0)==(p|0))u=c;else{f=0;do{if(f=f+1|0,f>>>0>=o>>>0){u=1;break e}u=c+(f<<2)|0,m=a[u>>2]|0}while(!((m|0)==-1|(m|0)==(p|0)))}if(a[u>>2]=p,d=d+1|0,d>>>0>=_>>>0){u=0;break}}while(!1)}return v=u,I=w,v|0}function Bm(){return 12}function jr(o,r){o=o|0,r=r|0;var c=0,u=0,f=0,d=0,p=0,m=0,_=0;if(o>>>0>15)return m=4,m|0;if(Ae(o|0,0,52)|0,m=S()|0|134225919,!o){c=0,u=0;do et(u)|0&&(Ae(u|0,0,45)|0,p=m|(S()|0),o=r+(c<<3)|0,a[o>>2]=-1,a[o+4>>2]=p,c=c+1|0),u=u+1|0;while((u|0)!=122);return c=0,c|0}c=0,p=0;do{if(et(p)|0){for(Ae(p|0,0,45)|0,u=1,f=-1,d=m|(S()|0);_=Ae(7,0,(15-u|0)*3|0)|0,f=f&~_,d=d&~(S()|0),(u|0)!=(o|0);)u=u+1|0;_=r+(c<<3)|0,a[_>>2]=f,a[_+4>>2]=d,c=c+1|0}p=p+1|0}while((p|0)!=122);return c=0,c|0}function Cm(o,r,c,u){o=o|0,r=r|0,c=c|0,u=u|0;var f=0,d=0,p=0,m=0,_=0,b=0,v=0,w=0,P=0,L=0,D=0,H=0,X=0,W=0,J=0;if(J=I,I=I+16|0,X=J,W=q(o|0,r|0,52)|0,S()|0,W=W&15,c>>>0>15)return W=4,I=J,W|0;if((W|0)<(c|0))return W=12,I=J,W|0;if((W|0)!=(c|0))if(d=Ae(c|0,0,52)|0,d=d|o,m=S()|0|r&-15728641,(W|0)>(c|0)){_=c;do H=Ae(7,0,(14-_|0)*3|0)|0,_=_+1|0,d=H|d,m=S()|0|m;while((_|0)<(W|0));H=d}else H=d;else H=o,m=r;D=q(H|0,m|0,45)|0,S()|0;e:do if(et(D&127)|0){if(_=q(H|0,m|0,52)|0,S()|0,_=_&15,_|0)for(d=1;;){if(D=Ae(7,0,(15-d|0)*3|0)|0,!((D&H|0)==0&((S()|0)&m|0)==0)){b=33;break e}if(d>>>0<_>>>0)d=d+1|0;else break}if(D=u,a[D>>2]=0,a[D+4>>2]=0,(W|0)>(c|0)){for(D=r&-15728641,L=W;;){if(P=L,L=L+-1|0,L>>>0>15|(W|0)<(L|0)){b=19;break}if((W|0)!=(L|0))if(d=Ae(L|0,0,52)|0,d=d|o,_=S()|0|D,(W|0)<(P|0))w=d;else{b=L;do w=Ae(7,0,(14-b|0)*3|0)|0,b=b+1|0,d=w|d,_=S()|0|_;while((b|0)<(W|0));w=d}else w=o,_=r;if(v=q(w|0,_|0,45)|0,S()|0,!(et(v&127)|0))d=0;else{v=q(w|0,_|0,52)|0,S()|0,v=v&15;t:do if(!v)d=0;else for(b=1;;){if(d=q(w|0,_|0,(15-b|0)*3|0)|0,S()|0,d=d&7,d|0)break t;if(b>>>0<v>>>0)b=b+1|0;else{d=0;break}}while(!1);d=(d|0)==0&1}if(_=q(o|0,r|0,(15-P|0)*3|0)|0,S()|0,_=_&7,(_|0)==7){f=5,b=42;break}if(d=(d|0)!=0,(_|0)==1&d){f=5,b=42;break}if(w=_+(((_|0)!=0&d)<<31>>31)|0,w|0&&(b=W-P|0,b=Ln(7,0,b,((b|0)<0)<<31>>31)|0,v=S()|0,d?(d=Et(b|0,v|0,5,0)|0,d=Pe(d|0,S()|0,-5,-1)|0,d=Yn(d|0,S()|0,6,0)|0,d=Pe(d|0,S()|0,1,0)|0,_=S()|0):(d=b,_=v),P=w+-1|0,P=Et(b|0,v|0,P|0,((P|0)<0)<<31>>31|0)|0,P=Pe(d|0,_|0,P|0,S()|0)|0,w=S()|0,v=u,v=Pe(P|0,w|0,a[v>>2]|0,a[v+4>>2]|0)|0,w=S()|0,P=u,a[P>>2]=v,a[P+4>>2]=w),(L|0)<=(c|0)){b=37;break}}if((b|0)==19)pe(23313,22674,1099,22710);else if((b|0)==37){p=u,f=a[p+4>>2]|0,p=a[p>>2]|0;break}else if((b|0)==42)return I=J,f|0}else f=0,p=0}else b=33;while(!1);e:do if((b|0)==33)if(D=u,a[D>>2]=0,a[D+4>>2]=0,(W|0)>(c|0)){for(d=W;;){if(f=q(o|0,r|0,(15-d|0)*3|0)|0,S()|0,f=f&7,(f|0)==7){f=5;break}if(p=W-d|0,p=Ln(7,0,p,((p|0)<0)<<31>>31)|0,f=Et(p|0,S()|0,f|0,0)|0,p=S()|0,D=u,p=Pe(a[D>>2]|0,a[D+4>>2]|0,f|0,p|0)|0,f=S()|0,D=u,a[D>>2]=p,a[D+4>>2]=f,d=d+-1|0,(d|0)<=(c|0))break e}return I=J,f|0}else f=0,p=0;while(!1);return ji(H,m,W,X)|0&&pe(23313,22674,1063,22725),W=X,X=a[W+4>>2]|0,((f|0)>-1|(f|0)==-1&p>>>0>4294967295)&((X|0)>(f|0)|((X|0)==(f|0)?(a[W>>2]|0)>>>0>p>>>0:0))?(W=0,I=J,W|0):(pe(23313,22674,1139,22710),0)}function _m(o,r,c,u,f,d){o=o|0,r=r|0,c=c|0,u=u|0,f=f|0,d=d|0;var p=0,m=0,_=0,b=0,v=0,w=0,P=0,L=0,D=0,H=0;if(w=I,I=I+16|0,p=w,f>>>0>15)return d=4,I=w,d|0;if(m=q(c|0,u|0,52)|0,S()|0,m=m&15,(m|0)>(f|0))return d=12,I=w,d|0;if(ji(c,u,f,p)|0&&pe(23313,22674,1063,22725),v=p,b=a[v+4>>2]|0,!(((r|0)>-1|(r|0)==-1&o>>>0>4294967295)&((b|0)>(r|0)|((b|0)==(r|0)?(a[v>>2]|0)>>>0>o>>>0:0))))return d=2,I=w,d|0;v=f-m|0,f=Ae(f|0,0,52)|0,_=S()|0|u&-15728641,b=d,a[b>>2]=f|c,a[b+4>>2]=_,b=q(c|0,u|0,45)|0,S()|0;e:do if(et(b&127)|0){if(m|0)for(p=1;;){if(b=Ae(7,0,(15-p|0)*3|0)|0,!((b&c|0)==0&((S()|0)&u|0)==0))break e;if(p>>>0<m>>>0)p=p+1|0;else break}if((v|0)<1)return d=0,I=w,d|0;for(b=m^15,u=-1,_=1,p=1;;){m=v-_|0,m=Ln(7,0,m,((m|0)<0)<<31>>31)|0,c=S()|0;do if(p)if(p=Et(m|0,c|0,5,0)|0,p=Pe(p|0,S()|0,-5,-1)|0,p=Yn(p|0,S()|0,6,0)|0,f=S()|0,(r|0)>(f|0)|(r|0)==(f|0)&o>>>0>p>>>0){r=Pe(o|0,r|0,-1,-1)|0,r=bt(r|0,S()|0,p|0,f|0)|0,p=S()|0,P=d,D=a[P>>2]|0,P=a[P+4>>2]|0,H=(b+u|0)*3|0,L=Ae(7,0,H|0)|0,P=P&~(S()|0),u=Yn(r|0,p|0,m|0,c|0)|0,o=S()|0,f=Pe(u|0,o|0,2,0)|0,H=Ae(f|0,S()|0,H|0)|0,P=S()|0|P,f=d,a[f>>2]=H|D&~L,a[f+4>>2]=P,o=Et(u|0,o|0,m|0,c|0)|0,o=bt(r|0,p|0,o|0,S()|0)|0,p=0,r=S()|0;break}else{H=d,L=a[H>>2]|0,H=a[H+4>>2]|0,D=Ae(7,0,(b+u|0)*3|0)|0,H=H&~(S()|0),p=d,a[p>>2]=L&~D,a[p+4>>2]=H,p=1;break}else L=d,f=a[L>>2]|0,L=a[L+4>>2]|0,u=(b+u|0)*3|0,P=Ae(7,0,u|0)|0,L=L&~(S()|0),H=Yn(o|0,r|0,m|0,c|0)|0,p=S()|0,u=Ae(H|0,p|0,u|0)|0,L=S()|0|L,D=d,a[D>>2]=u|f&~P,a[D+4>>2]=L,p=Et(H|0,p|0,m|0,c|0)|0,o=bt(o|0,r|0,p|0,S()|0)|0,p=0,r=S()|0;while(!1);if((v|0)>(_|0))u=~_,_=_+1|0;else{r=0;break}}return I=w,r|0}while(!1);if((v|0)<1)return H=0,I=w,H|0;for(f=m^15,p=1;;)if(D=v-p|0,D=Ln(7,0,D,((D|0)<0)<<31>>31)|0,H=S()|0,_=d,c=a[_>>2]|0,_=a[_+4>>2]|0,m=(f-p|0)*3|0,u=Ae(7,0,m|0)|0,_=_&~(S()|0),P=Yn(o|0,r|0,D|0,H|0)|0,L=S()|0,m=Ae(P|0,L|0,m|0)|0,_=S()|0|_,b=d,a[b>>2]=m|c&~u,a[b+4>>2]=_,H=Et(P|0,L|0,D|0,H|0)|0,o=bt(o|0,r|0,H|0,S()|0)|0,r=S()|0,(v|0)<=(p|0)){r=0;break}else p=p+1|0;return I=w,r|0}function Qc(o,r,c,u){o=o|0,r=r|0,c=c|0,u=u|0;var f=0,d=0;f=q(r|0,c|0,52)|0,S()|0,f=f&15,(r|0)==0&(c|0)==0|((u|0)>15|(f|0)>(u|0))?(u=-1,f=-1,r=0,c=0):(d=cm(r,c,f+1|0,u)|0,c=(S()|0)&-15728641,r=Ae(u|0,0,52)|0,r=d|r,c=c|(S()|0),d=(tt(r,c)|0)==0,u=d?-1:u),d=o,a[d>>2]=r,a[d+4>>2]=c,a[o+8>>2]=f,a[o+12>>2]=u}function Kc(o){o=o|0;var r=0,c=0,u=0,f=0,d=0,p=0,m=0,_=0,b=0;if(c=o,r=a[c>>2]|0,c=a[c+4>>2]|0,!((r|0)==0&(c|0)==0)&&(u=q(r|0,c|0,52)|0,S()|0,u=u&15,m=Ae(1,0,(u^15)*3|0)|0,r=Pe(m|0,S()|0,r|0,c|0)|0,c=S()|0,m=o,a[m>>2]=r,a[m+4>>2]=c,m=o+8|0,p=a[m>>2]|0,!((u|0)<(p|0)))){for(_=o+12|0,d=u;;){if((d|0)==(p|0)){u=5;break}if(b=(d|0)==(a[_>>2]|0),f=(15-d|0)*3|0,u=q(r|0,c|0,f|0)|0,S()|0,u=u&7,b&((u|0)==1&!0)){u=7;break}if(!((u|0)==7&!0)){u=10;break}if(b=Ae(1,0,f|0)|0,r=Pe(r|0,c|0,b|0,S()|0)|0,c=S()|0,b=o,a[b>>2]=r,a[b+4>>2]=c,(d|0)>(p|0))d=d+-1|0;else{u=10;break}}if((u|0)==5){b=o,a[b>>2]=0,a[b+4>>2]=0,a[m>>2]=-1,a[_>>2]=-1;return}else if((u|0)==7){p=Ae(1,0,f|0)|0,p=Pe(r|0,c|0,p|0,S()|0)|0,m=S()|0,b=o,a[b>>2]=p,a[b+4>>2]=m,a[_>>2]=d+-1;return}else if((u|0)==10)return}}function ci(o){o=+o;var r=0;return r=o<0?o+6.283185307179586:o,+(o>=6.283185307179586?r+-6.283185307179586:r)}function ms(o,r){return o=o|0,r=r|0,+De(+(+M[o>>3]-+M[r>>3]))<17453292519943298e-27?(r=+De(+(+M[o+8>>3]-+M[r+8>>3]))<17453292519943298e-27,r|0):(r=0,r|0)}function ym(o,r){o=o|0,r=r|0;var c=0,u=0,f=0,d=0;return f=+M[r>>3],u=+M[o>>3],d=+we(+((f-u)*.5)),c=+we(+((+M[r+8>>3]-+M[o+8>>3])*.5)),c=d*d+c*(+Ke(+f)*+Ke(+u)*c),+(+Yt(+ +Ue(+c),+ +Ue(+(1-c)))*2)}function li(o,r){o=o|0,r=r|0;var c=0,u=0,f=0,d=0;return f=+M[r>>3],u=+M[o>>3],d=+we(+((f-u)*.5)),c=+we(+((+M[r+8>>3]-+M[o+8>>3])*.5)),c=d*d+c*(+Ke(+f)*+Ke(+u)*c),+(+Yt(+ +Ue(+c),+ +Ue(+(1-c)))*2*6371.007180918475)}function bm(o,r){o=o|0,r=r|0;var c=0,u=0,f=0,d=0;return f=+M[r>>3],u=+M[o>>3],d=+we(+((f-u)*.5)),c=+we(+((+M[r+8>>3]-+M[o+8>>3])*.5)),c=d*d+c*(+Ke(+f)*+Ke(+u)*c),+(+Yt(+ +Ue(+c),+ +Ue(+(1-c)))*2*6371.007180918475*1e3)}function Em(o,r){o=o|0,r=r|0;var c=0,u=0,f=0,d=0,p=0;return d=+M[r>>3],u=+Ke(+d),f=+M[r+8>>3]-+M[o+8>>3],p=u*+we(+f),c=+M[o>>3],+ +Yt(+p,+(+we(+d)*+Ke(+c)-+Ke(+f)*(u*+we(+c))))}function Tm(o,r,c,u){o=o|0,r=+r,c=+c,u=u|0;var f=0,d=0,p=0,m=0;if(c<1e-16){a[u>>2]=a[o>>2],a[u+4>>2]=a[o+4>>2],a[u+8>>2]=a[o+8>>2],a[u+12>>2]=a[o+12>>2];return}d=r<0?r+6.283185307179586:r,d=r>=6.283185307179586?d+-6.283185307179586:d;do if(d<1e-16)r=+M[o>>3]+c,M[u>>3]=r,f=u;else{if(f=+De(+(d+-3.141592653589793))<1e-16,r=+M[o>>3],f){r=r-c,M[u>>3]=r,f=u;break}if(p=+Ke(+c),c=+we(+c),r=p*+we(+r)+ +Ke(+d)*(c*+Ke(+r)),r=r>1?1:r,r=+Bp(+(r<-1?-1:r)),M[u>>3]=r,+De(+(r+-1.5707963267948966))<1e-16){M[u>>3]=1.5707963267948966,M[u+8>>3]=0;return}if(+De(+(r+1.5707963267948966))<1e-16){M[u>>3]=-1.5707963267948966,M[u+8>>3]=0;return}if(m=+Ke(+r),d=c*+we(+d)/m,c=+M[o>>3],r=(p-+we(+r)*+we(+c))/+Ke(+c)/m,p=d>1?1:d,r=r>1?1:r,r=+M[o+8>>3]+ +Yt(+(p<-1?-1:p),+(r<-1?-1:r)),r>3.141592653589793)do r=r+-6.283185307179586;while(r>3.141592653589793);if(r<-3.141592653589793)do r=r+6.283185307179586;while(r<-3.141592653589793);M[u+8>>3]=r;return}while(!1);if(+De(+(r+-1.5707963267948966))<1e-16){M[f>>3]=1.5707963267948966,M[u+8>>3]=0;return}if(+De(+(r+1.5707963267948966))<1e-16){M[f>>3]=-1.5707963267948966,M[u+8>>3]=0;return}if(r=+M[o+8>>3],r>3.141592653589793)do r=r+-6.283185307179586;while(r>3.141592653589793);if(r<-3.141592653589793)do r=r+6.283185307179586;while(r<-3.141592653589793);M[u+8>>3]=r}function vm(o,r){return o=o|0,r=r|0,o>>>0>15?(r=4,r|0):(M[r>>3]=+M[20528+(o<<3)>>3],r=0,r|0)}function Im(o,r){return o=o|0,r=r|0,o>>>0>15?(r=4,r|0):(M[r>>3]=+M[20656+(o<<3)>>3],r=0,r|0)}function Mm(o,r){return o=o|0,r=r|0,o>>>0>15?(r=4,r|0):(M[r>>3]=+M[20784+(o<<3)>>3],r=0,r|0)}function wm(o,r){return o=o|0,r=r|0,o>>>0>15?(r=4,r|0):(M[r>>3]=+M[20912+(o<<3)>>3],r=0,r|0)}function Qr(o,r){o=o|0,r=r|0;var c=0;return o>>>0>15?(r=4,r|0):(c=Ln(7,0,o,((o|0)<0)<<31>>31)|0,c=Et(c|0,S()|0,120,0)|0,o=S()|0,a[r>>2]=c|2,a[r+4>>2]=o,r=0,r|0)}function Wc(o,r,c){o=o|0,r=r|0,c=c|0;var u=0,f=0,d=0,p=0,m=0,_=0,b=0,v=0,w=0,P=0;return P=+M[r>>3],v=+M[o>>3],_=+we(+((P-v)*.5)),d=+M[r+8>>3],b=+M[o+8>>3],p=+we(+((d-b)*.5)),m=+Ke(+v),w=+Ke(+P),p=_*_+p*(w*m*p),p=+Yt(+ +Ue(+p),+ +Ue(+(1-p)))*2,_=+M[c>>3],P=+we(+((_-P)*.5)),u=+M[c+8>>3],d=+we(+((u-d)*.5)),f=+Ke(+_),d=P*P+d*(w*f*d),d=+Yt(+ +Ue(+d),+ +Ue(+(1-d)))*2,_=+we(+((v-_)*.5)),u=+we(+((b-u)*.5)),u=_*_+u*(m*f*u),u=+Yt(+ +Ue(+u),+ +Ue(+(1-u)))*2,f=(p+d+u)*.5,+(+xr(+ +Ue(+(+Xt(+(f*.5))*+Xt(+((f-p)*.5))*+Xt(+((f-d)*.5))*+Xt(+((f-u)*.5)))))*4)}function Kr(o,r,c){o=o|0,r=r|0,c=c|0;var u=0,f=0,d=0,p=0,m=0;if(m=I,I=I+192|0,d=m+168|0,p=m,f=oi(o,r,d)|0,f|0)return c=f,I=m,c|0;if(ai(o,r,p)|0&&pe(23313,22742,386,22751),r=a[p>>2]|0,(r|0)>0){if(u=+Wc(p+8|0,p+8+(((r|0)!=1&1)<<4)|0,d)+0,(r|0)!=1){o=1;do f=o,o=o+1|0,u=u+ +Wc(p+8+(f<<4)|0,p+8+(((o|0)%(r|0)|0)<<4)|0,d);while((o|0)<(r|0))}}else u=0;return M[c>>3]=u,c=0,I=m,c|0}function Sm(o,r,c){return o=o|0,r=r|0,c=c|0,o=Kr(o,r,c)|0,o|0||(M[c>>3]=+M[c>>3]*6371.007180918475*6371.007180918475),o|0}function xm(o,r,c){return o=o|0,r=r|0,c=c|0,o=Kr(o,r,c)|0,o|0||(M[c>>3]=+M[c>>3]*6371.007180918475*6371.007180918475*1e3*1e3),o|0}function Dm(o,r,c){o=o|0,r=r|0,c=c|0;var u=0,f=0,d=0,p=0,m=0,_=0,b=0,v=0;if(m=I,I=I+176|0,p=m,o=zi(o,r,p)|0,o|0)return p=o,I=m,p|0;if(M[c>>3]=0,o=a[p>>2]|0,(o|0)<=1)return p=0,I=m,p|0;r=o+-1|0,o=0,u=+M[p+8>>3],f=+M[p+16>>3],d=0;do o=o+1|0,b=u,u=+M[p+8+(o<<4)>>3],v=+we(+((u-b)*.5)),_=f,f=+M[p+8+(o<<4)+8>>3],_=+we(+((f-_)*.5)),_=v*v+_*(+Ke(+u)*+Ke(+b)*_),d=d+ +Yt(+ +Ue(+_),+ +Ue(+(1-_)))*2;while((o|0)<(r|0));return M[c>>3]=d,p=0,I=m,p|0}function Pm(o,r,c){o=o|0,r=r|0,c=c|0;var u=0,f=0,d=0,p=0,m=0,_=0,b=0,v=0;if(m=I,I=I+176|0,p=m,o=zi(o,r,p)|0,o|0)return p=o,d=+M[c>>3],d=d*6371.007180918475,M[c>>3]=d,I=m,p|0;if(M[c>>3]=0,o=a[p>>2]|0,(o|0)<=1)return p=0,d=0,d=d*6371.007180918475,M[c>>3]=d,I=m,p|0;r=o+-1|0,o=0,u=+M[p+8>>3],f=+M[p+16>>3],d=0;do o=o+1|0,b=u,u=+M[p+8+(o<<4)>>3],v=+we(+((u-b)*.5)),_=f,f=+M[p+8+(o<<4)+8>>3],_=+we(+((f-_)*.5)),_=v*v+_*(+Ke(+b)*+Ke(+u)*_),d=d+ +Yt(+ +Ue(+_),+ +Ue(+(1-_)))*2;while((o|0)!=(r|0));return M[c>>3]=d,p=0,v=d,v=v*6371.007180918475,M[c>>3]=v,I=m,p|0}function Fm(o,r,c){o=o|0,r=r|0,c=c|0;var u=0,f=0,d=0,p=0,m=0,_=0,b=0,v=0;if(m=I,I=I+176|0,p=m,o=zi(o,r,p)|0,o|0)return p=o,d=+M[c>>3],d=d*6371.007180918475,d=d*1e3,M[c>>3]=d,I=m,p|0;if(M[c>>3]=0,o=a[p>>2]|0,(o|0)<=1)return p=0,d=0,d=d*6371.007180918475,d=d*1e3,M[c>>3]=d,I=m,p|0;r=o+-1|0,o=0,u=+M[p+8>>3],f=+M[p+16>>3],d=0;do o=o+1|0,b=u,u=+M[p+8+(o<<4)>>3],v=+we(+((u-b)*.5)),_=f,f=+M[p+8+(o<<4)+8>>3],_=+we(+((f-_)*.5)),_=v*v+_*(+Ke(+b)*+Ke(+u)*_),d=d+ +Yt(+ +Ue(+_),+ +Ue(+(1-_)))*2;while((o|0)!=(r|0));return M[c>>3]=d,p=0,v=d,v=v*6371.007180918475,v=v*1e3,M[c>>3]=v,I=m,p|0}function Lm(o){o=o|0;var r=0,c=0,u=0;return r=gn(1,12)|0,r||pe(22832,22787,49,22845),c=o+4|0,u=a[c>>2]|0,u|0?(u=u+8|0,a[u>>2]=r,a[c>>2]=r,r|0):(a[o>>2]|0&&pe(22862,22787,61,22885),u=o,a[u>>2]=r,a[c>>2]=r,r|0)}function Rm(o,r){o=o|0,r=r|0;var c=0,u=0;return u=dn(24)|0,u||pe(22899,22787,78,22913),a[u>>2]=a[r>>2],a[u+4>>2]=a[r+4>>2],a[u+8>>2]=a[r+8>>2],a[u+12>>2]=a[r+12>>2],a[u+16>>2]=0,r=o+4|0,c=a[r>>2]|0,c|0?(a[c+16>>2]=u,a[r>>2]=u,u|0):(a[o>>2]|0&&pe(22928,22787,82,22913),a[o>>2]=u,a[r>>2]=u,u|0)}function Xc(o){o=o|0;var r=0,c=0,u=0,f=0;if(o)for(u=1;;){if(r=a[o>>2]|0,r|0)do{if(c=a[r>>2]|0,c|0)do f=c,c=a[c+16>>2]|0,Ce(f);while((c|0)!=0);f=r,r=a[r+8>>2]|0,Ce(f)}while((r|0)!=0);if(r=o,o=a[o+8>>2]|0,u||Ce(r),o)u=0;else break}}function Om(o){o=o|0;var r=0,c=0,u=0,f=0,d=0,p=0,m=0,_=0,b=0,v=0,w=0,P=0,L=0,D=0,H=0,X=0,W=0,J=0,z=0,U=0,ae=0,fe=0,ie=0,ce=0,ze=0,Ge=0,He=0,ve=0,Ee=0,Ie=0,Xe=0,_e=0;if(f=o+8|0,a[f>>2]|0)return _e=1,_e|0;if(u=a[o>>2]|0,!u)return _e=0,_e|0;r=u,c=0;do c=c+1|0,r=a[r+8>>2]|0;while((r|0)!=0);if(c>>>0<2)return _e=0,_e|0;Ie=dn(c<<2)|0,Ie||pe(22948,22787,317,22967),Ee=dn(c<<5)|0,Ee||pe(22989,22787,321,22967),a[o>>2]=0,fe=o+4|0,a[fe>>2]=0,a[f>>2]=0,c=0,ve=0,ae=0,w=0;e:for(;;){if(v=a[u>>2]|0,v){d=0,p=v;do{if(_=+M[p+8>>3],r=p,p=a[p+16>>2]|0,b=(p|0)==0,f=b?v:p,m=+M[f+8>>3],+De(+(_-m))>3.141592653589793){_e=14;break}d=d+(m-_)*(+M[r>>3]+ +M[f>>3])}while(!b);if((_e|0)==14){_e=0,d=0,r=v;do U=+M[r+8>>3],He=r+16|0,Ge=a[He>>2]|0,Ge=(Ge|0)==0?v:Ge,z=+M[Ge+8>>3],d=d+(+M[r>>3]+ +M[Ge>>3])*((z<0?z+6.283185307179586:z)-(U<0?U+6.283185307179586:U)),r=a[((r|0)==0?u:He)>>2]|0;while((r|0)!=0)}d>0?(a[Ie+(ve<<2)>>2]=u,ve=ve+1|0,f=ae,r=w):_e=19}else _e=19;if((_e|0)==19){_e=0;do if(c){if(r=c+8|0,a[r>>2]|0){_e=21;break e}if(c=gn(1,12)|0,!c){_e=23;break e}a[r>>2]=c,f=c+4|0,p=c,r=w}else if(w){f=fe,p=w+8|0,r=u,c=o;break}else if(a[o>>2]|0){_e=27;break e}else{f=fe,p=o,r=u,c=o;break}while(!1);if(a[p>>2]=u,a[f>>2]=u,p=Ee+(ae<<5)|0,b=a[u>>2]|0,b){for(v=Ee+(ae<<5)+8|0,M[v>>3]=17976931348623157e292,w=Ee+(ae<<5)+24|0,M[w>>3]=17976931348623157e292,M[p>>3]=-17976931348623157e292,P=Ee+(ae<<5)+16|0,M[P>>3]=-17976931348623157e292,W=17976931348623157e292,J=-17976931348623157e292,f=0,L=b,_=17976931348623157e292,H=17976931348623157e292,X=-17976931348623157e292,m=-17976931348623157e292;d=+M[L>>3],U=+M[L+8>>3],L=a[L+16>>2]|0,D=(L|0)==0,z=+M[(D?b:L)+8>>3],d<_&&(M[v>>3]=d,_=d),U<H&&(M[w>>3]=U,H=U),d>X?M[p>>3]=d:d=X,U>m&&(M[P>>3]=U,m=U),W=U>0&U<W?U:W,J=U<0&U>J?U:J,f=f|+De(+(U-z))>3.141592653589793,!D;)X=d;f&&(M[P>>3]=J,M[w>>3]=W)}else a[p>>2]=0,a[p+4>>2]=0,a[p+8>>2]=0,a[p+12>>2]=0,a[p+16>>2]=0,a[p+20>>2]=0,a[p+24>>2]=0,a[p+28>>2]=0;f=ae+1|0}if(He=u+8|0,u=a[He>>2]|0,a[He>>2]=0,u)ae=f,w=r;else{_e=45;break}}if((_e|0)==21)pe(22765,22787,35,22799);else if((_e|0)==23)pe(22819,22787,37,22799);else if((_e|0)==27)pe(22862,22787,61,22885);else if((_e|0)==45){e:do if((ve|0)>0){for(He=(f|0)==0,ze=f<<2,Ge=(o|0)==0,ce=0,r=0;;){if(ie=a[Ie+(ce<<2)>>2]|0,He)_e=73;else{if(ae=dn(ze)|0,!ae){_e=50;break}if(fe=dn(ze)|0,!fe){_e=52;break}t:do if(Ge)c=0;else{for(f=0,c=0,p=o;u=Ee+(f<<5)|0,Yc(a[p>>2]|0,u,a[ie>>2]|0)|0?(a[ae+(c<<2)>>2]=p,a[fe+(c<<2)>>2]=u,D=c+1|0):D=c,p=a[p+8>>2]|0,p;)f=f+1|0,c=D;if((D|0)>0)if(u=a[ae>>2]|0,(D|0)==1)c=u;else for(P=0,L=-1,c=u,w=u;;){for(b=a[w>>2]|0,u=0,p=0;f=a[a[ae+(p<<2)>>2]>>2]|0,(f|0)==(b|0)?v=u:v=u+((Yc(f,a[fe+(p<<2)>>2]|0,a[b>>2]|0)|0)&1)|0,p=p+1|0,(p|0)!=(D|0);)u=v;if(f=(v|0)>(L|0),c=f?w:c,u=P+1|0,(u|0)==(D|0))break t;P=u,L=f?v:L,w=a[ae+(u<<2)>>2]|0}else c=0}while(!1);if(Ce(ae),Ce(fe),c){if(f=c+4|0,u=a[f>>2]|0,u)c=u+8|0;else if(a[c>>2]|0){_e=70;break}a[c>>2]=ie,a[f>>2]=ie}else _e=73}if((_e|0)==73){if(_e=0,r=a[ie>>2]|0,r|0)do fe=r,r=a[r+16>>2]|0,Ce(fe);while((r|0)!=0);Ce(ie),r=1}if(ce=ce+1|0,(ce|0)>=(ve|0)){Xe=r;break e}}(_e|0)==50?pe(23004,22787,249,23023):(_e|0)==52?pe(23042,22787,252,23023):(_e|0)==70&&pe(22862,22787,61,22885)}else Xe=0;while(!1);return Ce(Ie),Ce(Ee),_e=Xe,_e|0}return 0}function Yc(o,r,c){o=o|0,r=r|0,c=c|0;var u=0,f=0,d=0,p=0,m=0,_=0,b=0,v=0;if(!(Pc(r,c)|0)||(r=Dc(r)|0,u=+M[c>>3],f=+M[c+8>>3],f=r&f<0?f+6.283185307179586:f,o=a[o>>2]|0,!o))return o=0,o|0;if(r){r=0,b=f,c=o;e:for(;;){for(;p=+M[c>>3],f=+M[c+8>>3],c=c+16|0,v=a[c>>2]|0,v=(v|0)==0?o:v,d=+M[v>>3],m=+M[v+8>>3],p>d?(_=p,p=m):(_=d,d=p,p=f,f=m),u=u==d|u==_?u+2220446049250313e-31:u,!!(u<d|u>_);)if(c=a[c>>2]|0,!c){c=22;break e}if(m=p<0?p+6.283185307179586:p,p=f<0?f+6.283185307179586:f,b=m==b|p==b?b+-2220446049250313e-31:b,_=m+(p-m)*((u-d)/(_-d)),(_<0?_+6.283185307179586:_)>b&&(r=r^1),c=a[c>>2]|0,!c){c=22;break}}if((c|0)==22)return r|0}else{r=0,b=f,c=o;e:for(;;){for(;p=+M[c>>3],f=+M[c+8>>3],c=c+16|0,v=a[c>>2]|0,v=(v|0)==0?o:v,d=+M[v>>3],m=+M[v+8>>3],p>d?(_=p,p=m):(_=d,d=p,p=f,f=m),u=u==d|u==_?u+2220446049250313e-31:u,!!(u<d|u>_);)if(c=a[c>>2]|0,!c){c=22;break e}if(b=p==b|f==b?b+-2220446049250313e-31:b,p+(f-p)*((u-d)/(_-d))>b&&(r=r^1),c=a[c>>2]|0,!c){c=22;break}}if((c|0)==22)return r|0}return 0}function En(o,r,c,u,f){o=o|0,r=r|0,c=c|0,u=u|0,f=f|0;var d=0,p=0,m=0,_=0,b=0,v=0,w=0,P=0,L=0,D=0,H=0,X=0,W=0,J=0;if(J=I,I=I+32|0,W=J+16|0,X=J,d=q(o|0,r|0,52)|0,S()|0,d=d&15,L=q(c|0,u|0,52)|0,S()|0,(d|0)!=(L&15|0))return W=12,I=J,W|0;if(b=q(o|0,r|0,45)|0,S()|0,b=b&127,v=q(c|0,u|0,45)|0,S()|0,v=v&127,b>>>0>121|v>>>0>121)return W=5,I=J,W|0;if(L=(b|0)!=(v|0),L){if(m=Rr(b,v)|0,(m|0)==7)return W=1,I=J,W|0;_=Rr(v,b)|0,(_|0)==7?pe(23066,23090,161,23100):(D=m,p=_)}else D=0,p=0;w=et(b)|0,P=et(v)|0,a[W>>2]=0,a[W+4>>2]=0,a[W+8>>2]=0,a[W+12>>2]=0;do if(D){if(v=a[4272+(b*28|0)+(D<<2)>>2]|0,m=(v|0)>0,P)if(m){b=0,_=c,m=u;do _=gm(_,m)|0,m=S()|0,p=Fn(p)|0,(p|0)==1&&(p=Fn(1)|0),b=b+1|0;while((b|0)!=(v|0));v=p,b=_,_=m}else v=p,b=c,_=u;else if(m){b=0,_=c,m=u;do _=Vr(_,m)|0,m=S()|0,p=Fn(p)|0,b=b+1|0;while((b|0)!=(v|0));v=p,b=_,_=m}else v=p,b=c,_=u;if(zr(b,_,W)|0,L||pe(23115,23090,191,23100),m=(w|0)!=0,p=(P|0)!=0,m&p&&pe(23142,23090,192,23100),m){if(p=Lt(o,r)|0,(p|0)==7){d=5;break}if(Be[21872+(p*7|0)+D>>0]|0){d=1;break}_=a[21040+(p*28|0)+(D<<2)>>2]|0,b=_}else if(p){if(p=Lt(b,_)|0,(p|0)==7){d=5;break}if(Be[21872+(p*7|0)+v>>0]|0){d=1;break}b=0,_=a[21040+(v*28|0)+(p<<2)>>2]|0}else b=0,_=0;if((b|_|0)<0)d=5;else{if((_|0)>0){m=W+4|0,p=0;do Vi(m),p=p+1|0;while((p|0)!=(_|0))}if(a[X>>2]=0,a[X+4>>2]=0,a[X+8>>2]=0,Oc(X,D),d|0)for(;$t(d)|0?Ji(X):Kn(X),(d|0)>1;)d=d+-1|0;if((b|0)>0){d=0;do Vi(X),d=d+1|0;while((d|0)!=(b|0))}H=W+4|0,Dt(H,X,H),yt(H),H=51}}else if(zr(c,u,W)|0,(w|0)!=0&(P|0)!=0)if((v|0)!=(b|0)&&pe(23173,23090,261,23100),p=Lt(o,r)|0,d=Lt(c,u)|0,(p|0)==7|(d|0)==7)d=5;else if(Be[21872+(p*7|0)+d>>0]|0)d=1;else if(p=a[21040+(p*28|0)+(d<<2)>>2]|0,(p|0)>0){m=W+4|0,d=0;do Vi(m),d=d+1|0;while((d|0)!=(p|0));H=51}else H=51;else H=51;while(!1);return(H|0)==51&&(d=W+4|0,a[f>>2]=a[d>>2],a[f+4>>2]=a[d+4>>2],a[f+8>>2]=a[d+8>>2],d=0),W=d,I=J,W|0}function $c(o,r,c,u){o=o|0,r=r|0,c=c|0,u=u|0;var f=0,d=0,p=0,m=0,_=0,b=0,v=0,w=0,P=0,L=0,D=0,H=0,X=0,W=0,J=0,z=0;if(H=I,I=I+48|0,b=H+36|0,p=H+24|0,m=H+12|0,_=H,f=q(o|0,r|0,52)|0,S()|0,f=f&15,P=q(o|0,r|0,45)|0,S()|0,P=P&127,P>>>0>121)return u=5,I=H,u|0;if(v=et(P)|0,Ae(f|0,0,52)|0,X=S()|0|134225919,d=u,a[d>>2]=-1,a[d+4>>2]=X,!f)return f=ki(c)|0,(f|0)==7||(f=Lr(P,f)|0,(f|0)==127)?(X=1,I=H,X|0):(L=Ae(f|0,0,45)|0,D=S()|0,P=u,D=a[P+4>>2]&-1040385|D,X=u,a[X>>2]=a[P>>2]|L,a[X+4>>2]=D,X=0,I=H,X|0);for(a[b>>2]=a[c>>2],a[b+4>>2]=a[c+4>>2],a[b+8>>2]=a[c+8>>2],c=f;;){if(d=c,c=c+-1|0,a[p>>2]=a[b>>2],a[p+4>>2]=a[b+4>>2],a[p+8>>2]=a[b+8>>2],$t(d)|0){if(f=Vp(b)|0,f|0){c=13;break}a[m>>2]=a[b>>2],a[m+4>>2]=a[b+4>>2],a[m+8>>2]=a[b+8>>2],Ji(m)}else{if(f=zp(b)|0,f|0){c=13;break}a[m>>2]=a[b>>2],a[m+4>>2]=a[b+4>>2],a[m+8>>2]=a[b+8>>2],Kn(m)}if(Or(p,m,_),yt(_),f=u,J=a[f>>2]|0,f=a[f+4>>2]|0,z=(15-d|0)*3|0,W=Ae(7,0,z|0)|0,f=f&~(S()|0),z=Ae(ki(_)|0,0,z|0)|0,f=S()|0|f,X=u,a[X>>2]=z|J&~W,a[X+4>>2]=f,(d|0)<=1){c=14;break}}e:do if((c|0)!=13&&(c|0)==14)if((a[b>>2]|0)<=1&&(a[b+4>>2]|0)<=1&&(a[b+8>>2]|0)<=1){c=ki(b)|0,f=Lr(P,c)|0,(f|0)==127?_=0:_=et(f)|0;t:do if(c){if(v){if(f=Lt(o,r)|0,(f|0)==7){f=5;break e}if(d=a[21248+(f*28|0)+(c<<2)>>2]|0,(d|0)>0){f=c,c=0;do f=Wn(f)|0,c=c+1|0;while((c|0)!=(d|0))}else f=c;if((f|0)==1){f=9;break e}c=Lr(P,f)|0,(c|0)==127&&pe(23200,23090,411,23230),et(c)|0?pe(23245,23090,412,23230):(D=c,L=d,w=f)}else D=f,L=0,w=c;if(m=a[4272+(P*28|0)+(w<<2)>>2]|0,(m|0)<=-1&&pe(23276,23090,419,23230),!_){if((L|0)<0){f=5;break e}if(L|0){d=u,f=0,c=a[d>>2]|0,d=a[d+4>>2]|0;do c=Xn(c,d)|0,d=S()|0,z=u,a[z>>2]=c,a[z+4>>2]=d,f=f+1|0;while((f|0)<(L|0))}if((m|0)<=0){f=D,c=58;break}for(d=u,f=0,c=a[d>>2]|0,d=a[d+4>>2]|0;;)if(c=Xn(c,d)|0,d=S()|0,z=u,a[z>>2]=c,a[z+4>>2]=d,f=f+1|0,(f|0)==(m|0)){f=D,c=58;break t}}if(p=Rr(D,P)|0,(p|0)==7&&pe(23066,23090,428,23230),f=u,c=a[f>>2]|0,f=a[f+4>>2]|0,(m|0)>0){d=0;do c=Xn(c,f)|0,f=S()|0,z=u,a[z>>2]=c,a[z+4>>2]=f,d=d+1|0;while((d|0)!=(m|0))}if(f=Lt(c,f)|0,(f|0)==7&&pe(23313,23090,440,23230),c=Fr(D)|0,c=a[(c?21664:21456)+(p*28|0)+(f<<2)>>2]|0,(c|0)<0&&pe(23313,23090,454,23230),!c)f=D,c=58;else{p=u,f=0,d=a[p>>2]|0,p=a[p+4>>2]|0;do d=Jr(d,p)|0,p=S()|0,z=u,a[z>>2]=d,a[z+4>>2]=p,f=f+1|0;while((f|0)<(c|0));f=D,c=58}}else if((v|0)!=0&(_|0)!=0){if(c=Lt(o,r)|0,d=u,d=Lt(a[d>>2]|0,a[d+4>>2]|0)|0,(c|0)==7|(d|0)==7){f=5;break e}if(d=a[21248+(c*28|0)+(d<<2)>>2]|0,(d|0)<0){f=5;break e}if(!d)c=59;else{m=u,c=0,p=a[m>>2]|0,m=a[m+4>>2]|0;do p=Xn(p,m)|0,m=S()|0,z=u,a[z>>2]=p,a[z+4>>2]=m,c=c+1|0;while((c|0)<(d|0));c=58}}else c=58;while(!1);if((c|0)==58&&_&&(c=59),(c|0)==59&&(z=u,(Lt(a[z>>2]|0,a[z+4>>2]|0)|0)==1)){f=9;break}z=u,W=a[z>>2]|0,z=a[z+4>>2]&-1040385,J=Ae(f|0,0,45)|0,z=z|(S()|0),f=u,a[f>>2]=W|J,a[f+4>>2]=z,f=0}else f=1;while(!1);return z=f,I=H,z|0}function Gm(o,r,c,u,f,d){o=o|0,r=r|0,c=c|0,u=u|0,f=f|0,d=d|0;var p=0,m=0;return m=I,I=I+16|0,p=m,f?o=15:(o=En(o,r,c,u,p)|0,o||(Qp(p,d),o=0)),I=m,o|0}function Nm(o,r,c,u,f){o=o|0,r=r|0,c=c|0,u=u|0,f=f|0;var d=0,p=0;return p=I,I=I+16|0,d=p,u?c=15:(c=Kp(c,d)|0,c||(c=$c(o,r,d,f)|0)),I=p,c|0}function Um(o,r,c,u,f){o=o|0,r=r|0,c=c|0,u=u|0,f=f|0;var d=0,p=0,m=0,_=0;return _=I,I=I+32|0,p=_+12|0,m=_,d=En(o,r,o,r,p)|0,d|0?(m=d,I=_,m|0):(o=En(o,r,c,u,m)|0,o|0?(m=o,I=_,m|0):(p=Gr(p,m)|0,m=f,a[m>>2]=p,a[m+4>>2]=((p|0)<0)<<31>>31,m=0,I=_,m|0))}function Hm(o,r,c,u,f){o=o|0,r=r|0,c=c|0,u=u|0,f=f|0;var d=0,p=0,m=0,_=0;return _=I,I=I+32|0,p=_+12|0,m=_,d=En(o,r,o,r,p)|0,!d&&(d=En(o,r,c,u,m)|0,!d)?(u=Gr(p,m)|0,u=Pe(u|0,((u|0)<0)<<31>>31|0,1,0)|0,p=S()|0,m=f,a[m>>2]=u,a[m+4>>2]=p,m=0,I=_,m|0):(m=d,I=_,m|0)}function km(o,r,c,u,f){o=o|0,r=r|0,c=c|0,u=u|0,f=f|0;var d=0,p=0,m=0,_=0,b=0,v=0,w=0,P=0,L=0,D=0,H=0,X=0,W=0,J=0,z=0,U=0,ae=0,fe=0,ie=0,ce=0;if(ie=I,I=I+48|0,p=ie+24|0,m=ie+12|0,fe=ie,d=En(o,r,o,r,p)|0,!d&&(d=En(o,r,c,u,m)|0,!d)){U=Gr(p,m)|0,ae=((U|0)<0)<<31>>31,a[p>>2]=0,a[p+4>>2]=0,a[p+8>>2]=0,a[m>>2]=0,a[m+4>>2]=0,a[m+8>>2]=0,En(o,r,o,r,p)|0&&pe(23313,23090,691,23299),En(o,r,c,u,m)|0&&pe(23313,23090,696,23299),Hc(p),Hc(m),U?(w=a[p>>2]|0,D=+(U|0),W=p+4|0,P=a[W>>2]|0,J=p+8|0,L=a[J>>2]|0,z=p,u=w,d=P,c=L,H=+((a[m>>2]|0)-w|0)/D,X=+((a[m+4>>2]|0)-P|0)/D,D=+((a[m+8>>2]|0)-L|0)/D):(d=p+4|0,c=p+8|0,W=d,J=c,z=p,u=a[p>>2]|0,d=a[d>>2]|0,c=a[c>>2]|0,H=0,X=0,D=0),a[fe>>2]=u,L=fe+4|0,a[L>>2]=d,P=fe+8|0,a[P>>2]=c;e:do if((U|0)<0)d=0;else for(v=0,w=0,d=u;;){b=+(w>>>0)+4294967296*+(v|0),ce=H*b+ +(d|0),_=X*b+ +(a[W>>2]|0),b=D*b+ +(a[J>>2]|0),c=~~+Ki(+ce),p=~~+Ki(+_),d=~~+Ki(+b),ce=+De(+(+(c|0)-ce)),_=+De(+(+(p|0)-_)),b=+De(+(+(d|0)-b));do if(ce>_&ce>b)c=0-(p+d)|0,u=p;else if(m=0-c|0,_>b){u=m-d|0;break}else{u=p,d=m-p|0;break}while(!1);if(a[fe>>2]=c,a[L>>2]=u,a[P>>2]=d,Wp(fe),d=$c(o,r,fe,f+(w<<3)|0)|0,d|0)break e;if(!((v|0)<(ae|0)|(v|0)==(ae|0)&w>>>0<U>>>0)){d=0;break e}d=Pe(w|0,v|0,1,0)|0,m=S()|0,v=m,w=d,d=a[z>>2]|0}while(!1);return fe=d,I=ie,fe|0}return fe=d,I=ie,fe|0}function Ln(o,r,c,u){o=o|0,r=r|0,c=c|0,u=u|0;var f=0,d=0,p=0;if((c|0)==0&(u|0)==0)return f=0,d=1,Se(f|0),d|0;d=o,f=r,o=1,r=0;do p=(c&1|0)==0&!0,o=Et((p?1:d)|0,(p?0:f)|0,o|0,r|0)|0,r=S()|0,c=ol(c|0,u|0,1)|0,u=S()|0,d=Et(d|0,f|0,d|0,f|0)|0,f=S()|0;while(!((c|0)==0&(u|0)==0));return Se(r|0),o|0}function Zc(o,r,c){o=o|0,r=r|0,c=c|0;var u=0,f=0,d=0,p=0,m=0,_=0,b=0,v=0,w=0,P=0;if(!(Pc(r,c)|0)||(r=Dc(r)|0,u=+M[c>>3],f=+M[c+8>>3],f=r&f<0?f+6.283185307179586:f,P=a[o>>2]|0,(P|0)<=0))return P=0,P|0;if(w=a[o+4>>2]|0,r){r=0,v=f,c=-1,o=0;e:for(;;){for(b=o;p=+M[w+(b<<4)>>3],f=+M[w+(b<<4)+8>>3],o=(c+2|0)%(P|0)|0,d=+M[w+(o<<4)>>3],m=+M[w+(o<<4)+8>>3],p>d?(_=p,p=m):(_=d,d=p,p=f,f=m),u=u==d|u==_?u+2220446049250313e-31:u,!!(u<d|u>_);)if(c=b+1|0,(c|0)>=(P|0)){c=22;break e}else o=b,b=c,c=o;if(m=p<0?p+6.283185307179586:p,p=f<0?f+6.283185307179586:f,v=m==v|p==v?v+-2220446049250313e-31:v,_=m+(p-m)*((u-d)/(_-d)),(_<0?_+6.283185307179586:_)>v&&(r=r^1),o=b+1|0,(o|0)>=(P|0)){c=22;break}else c=b}if((c|0)==22)return r|0}else{r=0,v=f,c=-1,o=0;e:for(;;){for(b=o;p=+M[w+(b<<4)>>3],f=+M[w+(b<<4)+8>>3],o=(c+2|0)%(P|0)|0,d=+M[w+(o<<4)>>3],m=+M[w+(o<<4)+8>>3],p>d?(_=p,p=m):(_=d,d=p,p=f,f=m),u=u==d|u==_?u+2220446049250313e-31:u,!!(u<d|u>_);)if(c=b+1|0,(c|0)>=(P|0)){c=22;break e}else o=b,b=c,c=o;if(v=p==v|f==v?v+-2220446049250313e-31:v,p+(f-p)*((u-d)/(_-d))>v&&(r=r^1),o=b+1|0,(o|0)>=(P|0)){c=22;break}else c=b}if((c|0)==22)return r|0}return 0}function qc(o,r){o=o|0,r=r|0;var c=0,u=0,f=0,d=0,p=0,m=0,_=0,b=0,v=0,w=0,P=0,L=0,D=0,H=0,X=0,W=0,J=0;if(D=a[o>>2]|0,!D){a[r>>2]=0,a[r+4>>2]=0,a[r+8>>2]=0,a[r+12>>2]=0,a[r+16>>2]=0,a[r+20>>2]=0,a[r+24>>2]=0,a[r+28>>2]=0;return}if(H=r+8|0,M[H>>3]=17976931348623157e292,X=r+24|0,M[X>>3]=17976931348623157e292,M[r>>3]=-17976931348623157e292,W=r+16|0,M[W>>3]=-17976931348623157e292,!((D|0)<=0)){for(P=a[o+4>>2]|0,b=17976931348623157e292,v=-17976931348623157e292,w=0,o=-1,d=17976931348623157e292,p=17976931348623157e292,_=-17976931348623157e292,u=-17976931348623157e292,L=0;c=+M[P+(L<<4)>>3],m=+M[P+(L<<4)+8>>3],o=o+2|0,f=+M[P+(((o|0)==(D|0)?0:o)<<4)+8>>3],c<d&&(M[H>>3]=c,d=c),m<p&&(M[X>>3]=m,p=m),c>_?M[r>>3]=c:c=_,m>u&&(M[W>>3]=m,u=m),b=m>0&m<b?m:b,v=m<0&m>v?m:v,w=w|+De(+(m-f))>3.141592653589793,o=L+1|0,(o|0)!=(D|0);)J=L,_=c,L=o,o=J;w&&(M[W>>3]=v,M[X>>3]=b)}}function Jm(o,r){o=o|0,r=r|0;var c=0,u=0,f=0,d=0,p=0,m=0,_=0,b=0,v=0,w=0,P=0,L=0,D=0,H=0,X=0,W=0,J=0,z=0,U=0,ae=0,fe=0,ie=0;if(D=a[o>>2]|0,D){if(H=r+8|0,M[H>>3]=17976931348623157e292,X=r+24|0,M[X>>3]=17976931348623157e292,M[r>>3]=-17976931348623157e292,W=r+16|0,M[W>>3]=-17976931348623157e292,(D|0)>0){for(f=a[o+4>>2]|0,P=17976931348623157e292,L=-17976931348623157e292,u=0,c=-1,_=17976931348623157e292,b=17976931348623157e292,w=-17976931348623157e292,p=-17976931348623157e292,J=0;d=+M[f+(J<<4)>>3],v=+M[f+(J<<4)+8>>3],fe=c+2|0,m=+M[f+(((fe|0)==(D|0)?0:fe)<<4)+8>>3],d<_&&(M[H>>3]=d,_=d),v<b&&(M[X>>3]=v,b=v),d>w?M[r>>3]=d:d=w,v>p&&(M[W>>3]=v,p=v),P=v>0&v<P?v:P,L=v<0&v>L?v:L,u=u|+De(+(v-m))>3.141592653589793,c=J+1|0,(c|0)!=(D|0);)fe=J,w=d,J=c,c=fe;u&&(M[W>>3]=L,M[X>>3]=P)}}else a[r>>2]=0,a[r+4>>2]=0,a[r+8>>2]=0,a[r+12>>2]=0,a[r+16>>2]=0,a[r+20>>2]=0,a[r+24>>2]=0,a[r+28>>2]=0;if(fe=o+8|0,c=a[fe>>2]|0,!((c|0)<=0)){ae=o+12|0,U=0;do if(f=a[ae>>2]|0,u=U,U=U+1|0,X=r+(U<<5)|0,W=a[f+(u<<3)>>2]|0,W){if(J=r+(U<<5)+8|0,M[J>>3]=17976931348623157e292,o=r+(U<<5)+24|0,M[o>>3]=17976931348623157e292,M[X>>3]=-17976931348623157e292,z=r+(U<<5)+16|0,M[z>>3]=-17976931348623157e292,(W|0)>0){for(D=a[f+(u<<3)+4>>2]|0,P=17976931348623157e292,L=-17976931348623157e292,f=0,u=-1,H=0,_=17976931348623157e292,b=17976931348623157e292,v=-17976931348623157e292,p=-17976931348623157e292;d=+M[D+(H<<4)>>3],w=+M[D+(H<<4)+8>>3],u=u+2|0,m=+M[D+(((u|0)==(W|0)?0:u)<<4)+8>>3],d<_&&(M[J>>3]=d,_=d),w<b&&(M[o>>3]=w,b=w),d>v?M[X>>3]=d:d=v,w>p&&(M[z>>3]=w,p=w),P=w>0&w<P?w:P,L=w<0&w>L?w:L,f=f|+De(+(w-m))>3.141592653589793,u=H+1|0,(u|0)!=(W|0);)ie=H,H=u,v=d,u=ie;f&&(M[z>>3]=L,M[o>>3]=P)}}else a[X>>2]=0,a[X+4>>2]=0,a[X+8>>2]=0,a[X+12>>2]=0,a[X+16>>2]=0,a[X+20>>2]=0,a[X+24>>2]=0,a[X+28>>2]=0,c=a[fe>>2]|0;while((U|0)<(c|0))}}function Vm(o,r,c){o=o|0,r=r|0,c=c|0;var u=0,f=0,d=0;if(!(Zc(o,r,c)|0))return f=0,f|0;if(f=o+8|0,(a[f>>2]|0)<=0)return f=1,f|0;for(u=o+12|0,o=0;;){if(d=o,o=o+1|0,Zc((a[u>>2]|0)+(d<<3)|0,r+(o<<5)|0,c)|0){o=0,u=6;break}if((o|0)>=(a[f>>2]|0)){o=1,u=6;break}}return(u|0)==6?o|0:0}function zm(){return 8}function jm(){return 16}function Qm(){return 168}function Km(){return 8}function Wm(){return 16}function Xm(){return 12}function Ym(){return 8}function $m(o){return o=o|0,+(+((a[o>>2]|0)>>>0)+4294967296*+(a[o+4>>2]|0))}function Zm(o){o=o|0;var r=0,c=0;return c=+M[o>>3],r=+M[o+8>>3],+ +Ue(+(c*c+r*r))}function el(o,r,c,u,f){o=o|0,r=r|0,c=c|0,u=u|0,f=f|0;var d=0,p=0,m=0,_=0,b=0,v=0,w=0,P=0;b=+M[o>>3],_=+M[r>>3]-b,m=+M[o+8>>3],p=+M[r+8>>3]-m,w=+M[c>>3],d=+M[u>>3]-w,P=+M[c+8>>3],v=+M[u+8>>3]-P,d=(d*(m-P)-(b-w)*v)/(_*v-p*d),M[f>>3]=b+_*d,M[f+8>>3]=m+p*d}function tl(o,r){return o=o|0,r=r|0,+De(+(+M[o>>3]-+M[r>>3]))<11920928955078125e-23?(r=+De(+(+M[o+8>>3]-+M[r+8>>3]))<11920928955078125e-23,r|0):(r=0,r|0)}function lt(o,r){o=o|0,r=r|0;var c=0,u=0,f=0;return f=+M[o>>3]-+M[r>>3],u=+M[o+8>>3]-+M[r+8>>3],c=+M[o+16>>3]-+M[r+16>>3],+(f*f+u*u+c*c)}function qm(o,r){o=o|0,r=r|0;var c=0,u=0,f=0;c=+M[o>>3],u=+Ke(+c),c=+we(+c),M[r+16>>3]=c,c=+M[o+8>>3],f=u*+Ke(+c),M[r>>3]=f,c=u*+we(+c),M[r+8>>3]=c}function e2(o,r,c){o=o|0,r=r|0,c=c|0;var u=0,f=0,d=0;if(d=I,I=I+16|0,f=d,u=tt(o,r)|0,(c+-1|0)>>>0>5||(u=(u|0)!=0,(c|0)==1&u))return f=-1,I=d,f|0;do if(ui(o,r,f)|0)u=-1;else if(u){u=((a[21936+(c<<2)>>2]|0)+5-(a[f>>2]|0)|0)%5|0;break}else{u=((a[21968+(c<<2)>>2]|0)+6-(a[f>>2]|0)|0)%6|0;break}while(!1);return f=u,I=d,f|0}function ui(o,r,c){o=o|0,r=r|0,c=c|0;var u=0,f=0,d=0,p=0,m=0,_=0,b=0;if(b=I,I=I+32|0,p=b+16|0,m=b,u=ps(o,r,p)|0,u|0)return c=u,I=b,c|0;d=Vc(o,r)|0,_=Lt(o,r)|0,Op(d,m),u=Gp(d,a[p>>2]|0)|0;e:do if(et(d)|0){do switch(d|0){case 4:{o=0;break}case 14:{o=1;break}case 24:{o=2;break}case 38:{o=3;break}case 49:{o=4;break}case 58:{o=5;break}case 63:{o=6;break}case 72:{o=7;break}case 83:{o=8;break}case 97:{o=9;break}case 107:{o=10;break}case 117:{o=11;break}default:{u=1;break e}}while(!1);if(f=a[22e3+(o*24|0)+8>>2]|0,r=a[22e3+(o*24|0)+16>>2]|0,o=a[p>>2]|0,(o|0)!=(a[m>>2]|0)&&(m=Fr(d)|0,o=a[p>>2]|0,m|(o|0)==(r|0)&&(u=(u+1|0)%6|0)),(_|0)==3&(o|0)==(r|0)){u=(u+5|0)%6|0,f=22;break}(_|0)==5&(o|0)==(f|0)&&(u=(u+1|0)%6|0),f=22}else f=22;while(!1);return(f|0)==22&&(a[c>>2]=u,u=0),c=u,I=b,c|0}function Zt(o,r,c,u){o=o|0,r=r|0,c=c|0,u=u|0;var f=0,d=0,p=0,m=0,_=0,b=0,v=0,w=0,P=0,L=0,D=0,H=0,X=0,W=0,J=0,z=0;if(z=I,I=I+32|0,J=z+24|0,X=z+20|0,D=z+8|0,L=z+16|0,P=z,_=(tt(o,r)|0)==0,_=_?6:5,v=q(o|0,r|0,52)|0,S()|0,v=v&15,_>>>0<=c>>>0)return u=2,I=z,u|0;w=(v|0)==0,!w&&(H=Ae(7,0,(v^15)*3|0)|0,(H&o|0)==0&((S()|0)&r|0)==0)?f=c:d=4;e:do if((d|0)==4){if(f=(tt(o,r)|0)!=0,((f?4:5)|0)<(c|0)||ui(o,r,J)|0||(d=(a[J>>2]|0)+c|0,f?f=22288+(((d|0)%5|0)<<2)|0:f=22320+(((d|0)%6|0)<<2)|0,H=a[f>>2]|0,(H|0)==7))return u=1,I=z,u|0;a[X>>2]=0,f=dt(o,r,H,X,D)|0;do if(!f){if(m=D,b=a[m>>2]|0,m=a[m+4>>2]|0,p=m>>>0<r>>>0|(m|0)==(r|0)&b>>>0<o>>>0,d=p?b:o,p=p?m:r,!w&&(w=Ae(7,0,(v^15)*3|0)|0,(b&w|0)==0&(m&(S()|0)|0)==0))f=c;else{if(m=(c+-1+_|0)%(_|0)|0,f=tt(o,r)|0,(m|0)<0&&pe(23313,23315,245,23324),_=(f|0)!=0,((_?4:5)|0)<(m|0)&&pe(23313,23315,245,23324),ui(o,r,J)|0&&pe(23313,23315,245,23324),f=(a[J>>2]|0)+m|0,_?f=22288+(((f|0)%5|0)<<2)|0:f=22320+(((f|0)%6|0)<<2)|0,m=a[f>>2]|0,(m|0)==7&&pe(23313,23315,245,23324),a[L>>2]=0,f=dt(o,r,m,L,P)|0,f|0)break;b=P,_=a[b>>2]|0,b=a[b+4>>2]|0;do if(b>>>0<p>>>0|(b|0)==(p|0)&_>>>0<d>>>0){if(tt(_,b)|0?d=Pr(_,b,o,r)|0:d=a[22384+((((a[L>>2]|0)+(a[22352+(m<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,f=tt(_,b)|0,(d+-1|0)>>>0>5){f=-1,d=_,p=b;break}if(f=(f|0)!=0,(d|0)==1&f){f=-1,d=_,p=b;break}do if(ui(_,b,J)|0)f=-1;else if(f){f=((a[21936+(d<<2)>>2]|0)+5-(a[J>>2]|0)|0)%5|0;break}else{f=((a[21968+(d<<2)>>2]|0)+6-(a[J>>2]|0)|0)%6|0;break}while(!1);d=_,p=b}else f=c;while(!1);m=D,b=a[m>>2]|0,m=a[m+4>>2]|0}if((d|0)==(b|0)&(p|0)==(m|0)){if(_=(tt(b,m)|0)!=0,_?o=Pr(b,m,o,r)|0:o=a[22384+((((a[X>>2]|0)+(a[22352+(H<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,f=tt(b,m)|0,(o+-1|0)>>>0<=5&&(W=(f|0)!=0,!((o|0)==1&W)))do if(ui(b,m,J)|0)f=-1;else if(W){f=((a[21936+(o<<2)>>2]|0)+5-(a[J>>2]|0)|0)%5|0;break}else{f=((a[21968+(o<<2)>>2]|0)+6-(a[J>>2]|0)|0)%6|0;break}while(!1);else f=-1;f=f+1|0,f=(f|0)==6|_&(f|0)==5?0:f}r=p,o=d;break e}while(!1);return u=f,I=z,u|0}while(!1);return W=Ae(f|0,0,56)|0,J=S()|0|r&-2130706433|536870912,a[u>>2]=W|o,a[u+4>>2]=J,u=0,I=z,u|0}function t2(o,r,c){o=o|0,r=r|0,c=c|0;var u=0,f=0,d=0;return d=(tt(o,r)|0)==0,u=Zt(o,r,0,c)|0,f=(u|0)==0,d?!f||(u=Zt(o,r,1,c+8|0)|0,u|0)||(u=Zt(o,r,2,c+16|0)|0,u|0)||(u=Zt(o,r,3,c+24|0)|0,u|0)||(u=Zt(o,r,4,c+32|0)|0,u)?(d=u,d|0):Zt(o,r,5,c+40|0)|0:!f||(u=Zt(o,r,1,c+8|0)|0,u|0)||(u=Zt(o,r,2,c+16|0)|0,u|0)||(u=Zt(o,r,3,c+24|0)|0,u|0)||(u=Zt(o,r,4,c+32|0)|0,u|0)?(d=u,d|0):(d=c+40|0,a[d>>2]=0,a[d+4>>2]=0,d=0,d|0)}function n2(o,r,c){o=o|0,r=r|0,c=c|0;var u=0,f=0,d=0,p=0,m=0,_=0;return _=I,I=I+192|0,f=_,d=_+168|0,p=q(o|0,r|0,56)|0,S()|0,p=p&7,m=r&-2130706433|134217728,u=ps(o,m,d)|0,u|0?(m=u,I=_,m|0):(r=q(o|0,r|0,52)|0,S()|0,r=r&15,tt(o,m)|0?Nr(d,r,p,1,f):Ur(d,r,p,1,f),m=f+8|0,a[c>>2]=a[m>>2],a[c+4>>2]=a[m+4>>2],a[c+8>>2]=a[m+8>>2],a[c+12>>2]=a[m+12>>2],m=0,I=_,m|0)}function s2(o,r){o=o|0,r=r|0;var c=0,u=0,f=0,d=0;return f=I,I=I+16|0,c=f,!(!0&(r&2013265920|0)==536870912)||(u=r&-2130706433|134217728,!(Hr(o,u)|0))?(u=0,I=f,u|0):(d=q(o|0,r|0,56)|0,S()|0,d=(Zt(o,u,d&7,c)|0)==0,u=c,u=d&((a[u>>2]|0)==(o|0)?(a[u+4>>2]|0)==(r|0):0)&1,I=f,u|0)}function nl(o,r,c){o=o|0,r=r|0,c=c|0;var u=0;(r|0)>0?(u=gn(r,4)|0,a[o>>2]=u,u||pe(23337,23360,40,23374)):a[o>>2]=0,a[o+4>>2]=r,a[o+8>>2]=0,a[o+12>>2]=c}function sl(o){o=o|0;var r=0,c=0,u=0,f=0,d=0,p=0,m=0;f=o+4|0,d=o+12|0,p=o+8|0;e:for(;;){for(c=a[f>>2]|0,r=0;;){if((r|0)>=(c|0))break e;if(u=a[o>>2]|0,m=a[u+(r<<2)>>2]|0,!m)r=r+1|0;else break}r=u+(~~(+De(+(+Pn(10,+ +(15-(a[d>>2]|0)|0))*(+M[m>>3]+ +M[m+8>>3])))%+(c|0))>>>0<<2)|0,c=a[r>>2]|0;t:do if(c|0){if(u=m+32|0,(c|0)==(m|0))a[r>>2]=a[u>>2];else{if(c=c+32|0,r=a[c>>2]|0,!r)break;for(;(r|0)!=(m|0);)if(c=r+32|0,r=a[c>>2]|0,!r)break t;a[c>>2]=a[u>>2]}Ce(m),a[p>>2]=(a[p>>2]|0)+-1}while(!1)}Ce(a[o>>2]|0)}function il(o){o=o|0;var r=0,c=0,u=0;for(u=a[o+4>>2]|0,c=0;;){if((c|0)>=(u|0)){r=0,c=4;break}if(r=a[(a[o>>2]|0)+(c<<2)>>2]|0,!r)c=c+1|0;else{c=4;break}}return(c|0)==4?r|0:0}function Al(o,r){o=o|0,r=r|0;var c=0,u=0,f=0,d=0;if(c=~~(+De(+(+Pn(10,+ +(15-(a[o+12>>2]|0)|0))*(+M[r>>3]+ +M[r+8>>3])))%+(a[o+4>>2]|0))>>>0,c=(a[o>>2]|0)+(c<<2)|0,u=a[c>>2]|0,!u)return d=1,d|0;d=r+32|0;do if((u|0)!=(r|0)){if(c=a[u+32>>2]|0,!c)return d=1,d|0;for(f=c;;){if((f|0)==(r|0)){f=8;break}if(c=a[f+32>>2]|0,c)u=f,f=c;else{c=1,f=10;break}}if((f|0)==8){a[u+32>>2]=a[d>>2];break}else if((f|0)==10)return c|0}else a[c>>2]=a[d>>2];while(!1);return Ce(r),d=o+8|0,a[d>>2]=(a[d>>2]|0)+-1,d=0,d|0}function i2(o,r,c){o=o|0,r=r|0,c=c|0;var u=0,f=0,d=0,p=0;d=dn(40)|0,d||pe(23390,23360,98,23403),a[d>>2]=a[r>>2],a[d+4>>2]=a[r+4>>2],a[d+8>>2]=a[r+8>>2],a[d+12>>2]=a[r+12>>2],f=d+16|0,a[f>>2]=a[c>>2],a[f+4>>2]=a[c+4>>2],a[f+8>>2]=a[c+8>>2],a[f+12>>2]=a[c+12>>2],a[d+32>>2]=0,f=~~(+De(+(+Pn(10,+ +(15-(a[o+12>>2]|0)|0))*(+M[r>>3]+ +M[r+8>>3])))%+(a[o+4>>2]|0))>>>0,f=(a[o>>2]|0)+(f<<2)|0,u=a[f>>2]|0;do if(!u)a[f>>2]=d;else{for(;!(ms(u,r)|0&&ms(u+16|0,c)|0);)if(f=a[u+32>>2]|0,u=(f|0)==0?u:f,!(a[u+32>>2]|0)){p=10;break}if((p|0)==10){a[u+32>>2]=d;break}return Ce(d),p=u,p|0}while(!1);return p=o+8|0,a[p>>2]=(a[p>>2]|0)+1,p=d,p|0}function A2(o,r,c){o=o|0,r=r|0,c=c|0;var u=0,f=0;if(f=~~(+De(+(+Pn(10,+ +(15-(a[o+12>>2]|0)|0))*(+M[r>>3]+ +M[r+8>>3])))%+(a[o+4>>2]|0))>>>0,f=a[(a[o>>2]|0)+(f<<2)>>2]|0,!f)return c=0,c|0;if(!c){for(o=f;;){if(ms(o,r)|0){u=10;break}if(o=a[o+32>>2]|0,!o){o=0,u=10;break}}if((u|0)==10)return o|0}for(o=f;;){if(ms(o,r)|0&&ms(o+16|0,c)|0){u=10;break}if(o=a[o+32>>2]|0,!o){o=0,u=10;break}}return(u|0)==10?o|0:0}function r2(o,r){o=o|0,r=r|0;var c=0;if(c=~~(+De(+(+Pn(10,+ +(15-(a[o+12>>2]|0)|0))*(+M[r>>3]+ +M[r+8>>3])))%+(a[o+4>>2]|0))>>>0,o=a[(a[o>>2]|0)+(c<<2)>>2]|0,!o)return c=0,c|0;for(;;){if(ms(o,r)|0){r=5;break}if(o=a[o+32>>2]|0,!o){o=0,r=5;break}}return(r|0)==5?o|0:0}function o2(){return 23424}function a2(o){return o=+o,+ +cl(+o)}function Rn(o){return o=+o,~~+a2(o)|0}function dn(o){o=o|0;var r=0,c=0,u=0,f=0,d=0,p=0,m=0,_=0,b=0,v=0,w=0,P=0,L=0,D=0,H=0,X=0,W=0,J=0,z=0,U=0,ae=0;ae=I,I=I+16|0,P=ae;do if(o>>>0<245){if(b=o>>>0<11?16:o+11&-8,o=b>>>3,w=a[5857]|0,c=w>>>o,c&3|0)return r=(c&1^1)+o|0,o=23468+(r<<1<<2)|0,c=o+8|0,u=a[c>>2]|0,f=u+8|0,d=a[f>>2]|0,(d|0)==(o|0)?a[5857]=w&~(1<<r):(a[d+12>>2]=o,a[c>>2]=d),U=r<<3,a[u+4>>2]=U|3,U=u+U+4|0,a[U>>2]=a[U>>2]|1,U=f,I=ae,U|0;if(v=a[5859]|0,b>>>0>v>>>0){if(c|0)return r=2<<o,r=c<<o&(r|0-r),r=(r&0-r)+-1|0,m=r>>>12&16,r=r>>>m,c=r>>>5&8,r=r>>>c,d=r>>>2&4,r=r>>>d,o=r>>>1&2,r=r>>>o,u=r>>>1&1,u=(c|m|d|o|u)+(r>>>u)|0,r=23468+(u<<1<<2)|0,o=r+8|0,d=a[o>>2]|0,m=d+8|0,c=a[m>>2]|0,(c|0)==(r|0)?(o=w&~(1<<u),a[5857]=o):(a[c+12>>2]=r,a[o>>2]=c,o=w),U=u<<3,p=U-b|0,a[d+4>>2]=b|3,f=d+b|0,a[f+4>>2]=p|1,a[d+U>>2]=p,v|0&&(u=a[5862]|0,r=v>>>3,c=23468+(r<<1<<2)|0,r=1<<r,o&r?(o=c+8|0,r=a[o>>2]|0):(a[5857]=o|r,r=c,o=c+8|0),a[o>>2]=u,a[r+12>>2]=u,a[u+8>>2]=r,a[u+12>>2]=c),a[5859]=p,a[5862]=f,U=m,I=ae,U|0;if(d=a[5858]|0,d){for(c=(d&0-d)+-1|0,f=c>>>12&16,c=c>>>f,u=c>>>5&8,c=c>>>u,p=c>>>2&4,c=c>>>p,m=c>>>1&2,c=c>>>m,_=c>>>1&1,_=a[23732+((u|f|p|m|_)+(c>>>_)<<2)>>2]|0,c=_,m=_,_=(a[_+4>>2]&-8)-b|0;o=a[c+16>>2]|0,!(!o&&(o=a[c+20>>2]|0,!o));)p=(a[o+4>>2]&-8)-b|0,f=p>>>0<_>>>0,c=o,m=f?o:m,_=f?p:_;if(p=m+b|0,p>>>0>m>>>0){f=a[m+24>>2]|0,r=a[m+12>>2]|0;do if((r|0)==(m|0)){if(o=m+20|0,r=a[o>>2]|0,!r&&(o=m+16|0,r=a[o>>2]|0,!r)){c=0;break}for(;;)if(u=r+20|0,c=a[u>>2]|0,c)r=c,o=u;else if(u=r+16|0,c=a[u>>2]|0,c)r=c,o=u;else break;a[o>>2]=0,c=r}else c=a[m+8>>2]|0,a[c+12>>2]=r,a[r+8>>2]=c,c=r;while(!1);do if(f|0){if(r=a[m+28>>2]|0,o=23732+(r<<2)|0,(m|0)==(a[o>>2]|0)){if(a[o>>2]=c,!c){a[5858]=d&~(1<<r);break}}else if(U=f+16|0,a[((a[U>>2]|0)==(m|0)?U:f+20|0)>>2]=c,!c)break;a[c+24>>2]=f,r=a[m+16>>2]|0,r|0&&(a[c+16>>2]=r,a[r+24>>2]=c),r=a[m+20>>2]|0,r|0&&(a[c+20>>2]=r,a[r+24>>2]=c)}while(!1);return _>>>0<16?(U=_+b|0,a[m+4>>2]=U|3,U=m+U+4|0,a[U>>2]=a[U>>2]|1):(a[m+4>>2]=b|3,a[p+4>>2]=_|1,a[p+_>>2]=_,v|0&&(u=a[5862]|0,r=v>>>3,c=23468+(r<<1<<2)|0,r=1<<r,r&w?(o=c+8|0,r=a[o>>2]|0):(a[5857]=r|w,r=c,o=c+8|0),a[o>>2]=u,a[r+12>>2]=u,a[u+8>>2]=r,a[u+12>>2]=c),a[5859]=_,a[5862]=p),U=m+8|0,I=ae,U|0}else w=b}else w=b}else w=b}else if(o>>>0<=4294967231)if(o=o+11|0,b=o&-8,u=a[5858]|0,u){f=0-b|0,o=o>>>8,o?b>>>0>16777215?_=31:(w=(o+1048320|0)>>>16&8,H=o<<w,m=(H+520192|0)>>>16&4,H=H<<m,_=(H+245760|0)>>>16&2,_=14-(m|w|_)+(H<<_>>>15)|0,_=b>>>(_+7|0)&1|_<<1):_=0,c=a[23732+(_<<2)>>2]|0;e:do if(!c)c=0,o=0,H=61;else for(o=0,m=b<<((_|0)==31?0:25-(_>>>1)|0),d=0;;){if(p=(a[c+4>>2]&-8)-b|0,p>>>0<f>>>0)if(p)o=c,f=p;else{o=c,f=0,H=65;break e}if(H=a[c+20>>2]|0,c=a[c+16+(m>>>31<<2)>>2]|0,d=(H|0)==0|(H|0)==(c|0)?d:H,c)m=m<<1;else{c=d,H=61;break}}while(!1);if((H|0)==61){if((c|0)==0&(o|0)==0){if(o=2<<_,o=(o|0-o)&u,!o){w=b;break}w=(o&0-o)+-1|0,p=w>>>12&16,w=w>>>p,d=w>>>5&8,w=w>>>d,m=w>>>2&4,w=w>>>m,_=w>>>1&2,w=w>>>_,c=w>>>1&1,o=0,c=a[23732+((d|p|m|_|c)+(w>>>c)<<2)>>2]|0}c?H=65:(m=o,p=f)}if((H|0)==65)for(d=c;;)if(w=(a[d+4>>2]&-8)-b|0,c=w>>>0<f>>>0,f=c?w:f,o=c?d:o,c=a[d+16>>2]|0,c||(c=a[d+20>>2]|0),c)d=c;else{m=o,p=f;break}if((m|0)!=0&&p>>>0<((a[5859]|0)-b|0)>>>0&&(v=m+b|0,v>>>0>m>>>0)){d=a[m+24>>2]|0,r=a[m+12>>2]|0;do if((r|0)==(m|0)){if(o=m+20|0,r=a[o>>2]|0,!r&&(o=m+16|0,r=a[o>>2]|0,!r)){r=0;break}for(;;)if(f=r+20|0,c=a[f>>2]|0,c)r=c,o=f;else if(f=r+16|0,c=a[f>>2]|0,c)r=c,o=f;else break;a[o>>2]=0}else U=a[m+8>>2]|0,a[U+12>>2]=r,a[r+8>>2]=U;while(!1);do if(d){if(o=a[m+28>>2]|0,c=23732+(o<<2)|0,(m|0)==(a[c>>2]|0)){if(a[c>>2]=r,!r){u=u&~(1<<o),a[5858]=u;break}}else if(U=d+16|0,a[((a[U>>2]|0)==(m|0)?U:d+20|0)>>2]=r,!r)break;a[r+24>>2]=d,o=a[m+16>>2]|0,o|0&&(a[r+16>>2]=o,a[o+24>>2]=r),o=a[m+20>>2]|0,o&&(a[r+20>>2]=o,a[o+24>>2]=r)}while(!1);e:do if(p>>>0<16)U=p+b|0,a[m+4>>2]=U|3,U=m+U+4|0,a[U>>2]=a[U>>2]|1;else{if(a[m+4>>2]=b|3,a[v+4>>2]=p|1,a[v+p>>2]=p,r=p>>>3,p>>>0<256){c=23468+(r<<1<<2)|0,o=a[5857]|0,r=1<<r,o&r?(o=c+8|0,r=a[o>>2]|0):(a[5857]=o|r,r=c,o=c+8|0),a[o>>2]=v,a[r+12>>2]=v,a[v+8>>2]=r,a[v+12>>2]=c;break}if(r=p>>>8,r?p>>>0>16777215?c=31:(z=(r+1048320|0)>>>16&8,U=r<<z,J=(U+520192|0)>>>16&4,U=U<<J,c=(U+245760|0)>>>16&2,c=14-(J|z|c)+(U<<c>>>15)|0,c=p>>>(c+7|0)&1|c<<1):c=0,r=23732+(c<<2)|0,a[v+28>>2]=c,o=v+16|0,a[o+4>>2]=0,a[o>>2]=0,o=1<<c,!(u&o)){a[5858]=u|o,a[r>>2]=v,a[v+24>>2]=r,a[v+12>>2]=v,a[v+8>>2]=v;break}r=a[r>>2]|0;t:do if((a[r+4>>2]&-8|0)!=(p|0)){for(u=p<<((c|0)==31?0:25-(c>>>1)|0);c=r+16+(u>>>31<<2)|0,o=a[c>>2]|0,!!o;)if((a[o+4>>2]&-8|0)==(p|0)){r=o;break t}else u=u<<1,r=o;a[c>>2]=v,a[v+24>>2]=r,a[v+12>>2]=v,a[v+8>>2]=v;break e}while(!1);z=r+8|0,U=a[z>>2]|0,a[U+12>>2]=v,a[z>>2]=v,a[v+8>>2]=U,a[v+12>>2]=r,a[v+24>>2]=0}while(!1);return U=m+8|0,I=ae,U|0}else w=b}else w=b;else w=-1;while(!1);if(c=a[5859]|0,c>>>0>=w>>>0)return r=c-w|0,o=a[5862]|0,r>>>0>15?(U=o+w|0,a[5862]=U,a[5859]=r,a[U+4>>2]=r|1,a[o+c>>2]=r,a[o+4>>2]=w|3):(a[5859]=0,a[5862]=0,a[o+4>>2]=c|3,U=o+c+4|0,a[U>>2]=a[U>>2]|1),U=o+8|0,I=ae,U|0;if(p=a[5860]|0,p>>>0>w>>>0)return J=p-w|0,a[5860]=J,U=a[5863]|0,z=U+w|0,a[5863]=z,a[z+4>>2]=J|1,a[U+4>>2]=w|3,U=U+8|0,I=ae,U|0;if(a[5975]|0?o=a[5977]|0:(a[5977]=4096,a[5976]=4096,a[5978]=-1,a[5979]=-1,a[5980]=0,a[5968]=0,a[5975]=P&-16^1431655768,o=4096),m=w+48|0,_=w+47|0,d=o+_|0,f=0-o|0,b=d&f,b>>>0<=w>>>0||(o=a[5967]|0,o|0&&(v=a[5965]|0,P=v+b|0,P>>>0<=v>>>0|P>>>0>o>>>0)))return U=0,I=ae,U|0;e:do if(a[5968]&4)r=0,H=143;else{c=a[5863]|0;t:do if(c){for(u=23876;P=a[u>>2]|0,!(P>>>0<=c>>>0&&(P+(a[u+4>>2]|0)|0)>>>0>c>>>0);)if(o=a[u+8>>2]|0,o)u=o;else{H=128;break t}if(r=d-p&f,r>>>0<2147483647)if(o=On(r|0)|0,(o|0)==((a[u>>2]|0)+(a[u+4>>2]|0)|0)){if((o|0)!=-1){p=r,d=o,H=145;break e}}else u=o,H=136;else r=0}else H=128;while(!1);do if((H|0)==128)if(c=On(0)|0,(c|0)!=-1&&(r=c,L=a[5976]|0,D=L+-1|0,r=((D&r|0)==0?0:(D+r&0-L)-r|0)+b|0,L=a[5965]|0,D=r+L|0,r>>>0>w>>>0&r>>>0<2147483647)){if(P=a[5967]|0,P|0&&D>>>0<=L>>>0|D>>>0>P>>>0){r=0;break}if(o=On(r|0)|0,(o|0)==(c|0)){p=r,d=c,H=145;break e}else u=o,H=136}else r=0;while(!1);do if((H|0)==136){if(c=0-r|0,!(m>>>0>r>>>0&(r>>>0<2147483647&(u|0)!=-1)))if((u|0)==-1){r=0;break}else{p=r,d=u,H=145;break e}if(o=a[5977]|0,o=_-r+o&0-o,o>>>0>=2147483647){p=r,d=u,H=145;break e}if((On(o|0)|0)==-1){On(c|0)|0,r=0;break}else{p=o+r|0,d=u,H=145;break e}}while(!1);a[5968]=a[5968]|4,H=143}while(!1);if((H|0)==143&&b>>>0<2147483647&&(J=On(b|0)|0,D=On(0)|0,X=D-J|0,W=X>>>0>(w+40|0)>>>0,!((J|0)==-1|W^1|J>>>0<D>>>0&((J|0)!=-1&(D|0)!=-1)^1))&&(p=W?X:r,d=J,H=145),(H|0)==145){r=(a[5965]|0)+p|0,a[5965]=r,r>>>0>(a[5966]|0)>>>0&&(a[5966]=r),_=a[5863]|0;e:do if(_){for(r=23876;;){if(o=a[r>>2]|0,c=a[r+4>>2]|0,(d|0)==(o+c|0)){H=154;break}if(u=a[r+8>>2]|0,u)r=u;else break}if((H|0)==154&&(z=r+4|0,(a[r+12>>2]&8|0)==0)&&d>>>0>_>>>0&o>>>0<=_>>>0){a[z>>2]=c+p,U=(a[5860]|0)+p|0,J=_+8|0,J=(J&7|0)==0?0:0-J&7,z=_+J|0,J=U-J|0,a[5863]=z,a[5860]=J,a[z+4>>2]=J|1,a[_+U+4>>2]=40,a[5864]=a[5979];break}for(d>>>0<(a[5861]|0)>>>0&&(a[5861]=d),c=d+p|0,r=23876;;){if((a[r>>2]|0)==(c|0)){H=162;break}if(o=a[r+8>>2]|0,o)r=o;else break}if((H|0)==162&&(a[r+12>>2]&8|0)==0){a[r>>2]=d,v=r+4|0,a[v>>2]=(a[v>>2]|0)+p,v=d+8|0,v=d+((v&7|0)==0?0:0-v&7)|0,r=c+8|0,r=c+((r&7|0)==0?0:0-r&7)|0,b=v+w|0,m=r-v-w|0,a[v+4>>2]=w|3;t:do if((_|0)==(r|0))U=(a[5860]|0)+m|0,a[5860]=U,a[5863]=b,a[b+4>>2]=U|1;else{if((a[5862]|0)==(r|0)){U=(a[5859]|0)+m|0,a[5859]=U,a[5862]=b,a[b+4>>2]=U|1,a[b+U>>2]=U;break}if(o=a[r+4>>2]|0,(o&3|0)==1){p=o&-8,u=o>>>3;n:do if(o>>>0<256)if(o=a[r+8>>2]|0,c=a[r+12>>2]|0,(c|0)==(o|0)){a[5857]=a[5857]&~(1<<u);break}else{a[o+12>>2]=c,a[c+8>>2]=o;break}else{d=a[r+24>>2]|0,o=a[r+12>>2]|0;do if((o|0)==(r|0)){if(c=r+16|0,u=c+4|0,o=a[u>>2]|0,o)c=u;else if(o=a[c>>2]|0,!o){o=0;break}for(;;)if(f=o+20|0,u=a[f>>2]|0,u)o=u,c=f;else if(f=o+16|0,u=a[f>>2]|0,u)o=u,c=f;else break;a[c>>2]=0}else U=a[r+8>>2]|0,a[U+12>>2]=o,a[o+8>>2]=U;while(!1);if(!d)break;c=a[r+28>>2]|0,u=23732+(c<<2)|0;do if((a[u>>2]|0)!=(r|0)){if(U=d+16|0,a[((a[U>>2]|0)==(r|0)?U:d+20|0)>>2]=o,!o)break n}else{if(a[u>>2]=o,o|0)break;a[5858]=a[5858]&~(1<<c);break n}while(!1);if(a[o+24>>2]=d,c=r+16|0,u=a[c>>2]|0,u|0&&(a[o+16>>2]=u,a[u+24>>2]=o),c=a[c+4>>2]|0,!c)break;a[o+20>>2]=c,a[c+24>>2]=o}while(!1);r=r+p|0,f=p+m|0}else f=m;if(r=r+4|0,a[r>>2]=a[r>>2]&-2,a[b+4>>2]=f|1,a[b+f>>2]=f,r=f>>>3,f>>>0<256){c=23468+(r<<1<<2)|0,o=a[5857]|0,r=1<<r,o&r?(o=c+8|0,r=a[o>>2]|0):(a[5857]=o|r,r=c,o=c+8|0),a[o>>2]=b,a[r+12>>2]=b,a[b+8>>2]=r,a[b+12>>2]=c;break}r=f>>>8;do if(!r)u=0;else{if(f>>>0>16777215){u=31;break}z=(r+1048320|0)>>>16&8,U=r<<z,J=(U+520192|0)>>>16&4,U=U<<J,u=(U+245760|0)>>>16&2,u=14-(J|z|u)+(U<<u>>>15)|0,u=f>>>(u+7|0)&1|u<<1}while(!1);if(r=23732+(u<<2)|0,a[b+28>>2]=u,o=b+16|0,a[o+4>>2]=0,a[o>>2]=0,o=a[5858]|0,c=1<<u,!(o&c)){a[5858]=o|c,a[r>>2]=b,a[b+24>>2]=r,a[b+12>>2]=b,a[b+8>>2]=b;break}r=a[r>>2]|0;n:do if((a[r+4>>2]&-8|0)!=(f|0)){for(u=f<<((u|0)==31?0:25-(u>>>1)|0);c=r+16+(u>>>31<<2)|0,o=a[c>>2]|0,!!o;)if((a[o+4>>2]&-8|0)==(f|0)){r=o;break n}else u=u<<1,r=o;a[c>>2]=b,a[b+24>>2]=r,a[b+12>>2]=b,a[b+8>>2]=b;break t}while(!1);z=r+8|0,U=a[z>>2]|0,a[U+12>>2]=b,a[z>>2]=b,a[b+8>>2]=U,a[b+12>>2]=r,a[b+24>>2]=0}while(!1);return U=v+8|0,I=ae,U|0}for(r=23876;o=a[r>>2]|0,!(o>>>0<=_>>>0&&(U=o+(a[r+4>>2]|0)|0,U>>>0>_>>>0));)r=a[r+8>>2]|0;f=U+-47|0,o=f+8|0,o=f+((o&7|0)==0?0:0-o&7)|0,f=_+16|0,o=o>>>0<f>>>0?_:o,r=o+8|0,c=p+-40|0,J=d+8|0,J=(J&7|0)==0?0:0-J&7,z=d+J|0,J=c-J|0,a[5863]=z,a[5860]=J,a[z+4>>2]=J|1,a[d+c+4>>2]=40,a[5864]=a[5979],c=o+4|0,a[c>>2]=27,a[r>>2]=a[5969],a[r+4>>2]=a[5970],a[r+8>>2]=a[5971],a[r+12>>2]=a[5972],a[5969]=d,a[5970]=p,a[5972]=0,a[5971]=r,r=o+24|0;do z=r,r=r+4|0,a[r>>2]=7;while((z+8|0)>>>0<U>>>0);if((o|0)!=(_|0)){if(d=o-_|0,a[c>>2]=a[c>>2]&-2,a[_+4>>2]=d|1,a[o>>2]=d,r=d>>>3,d>>>0<256){c=23468+(r<<1<<2)|0,o=a[5857]|0,r=1<<r,o&r?(o=c+8|0,r=a[o>>2]|0):(a[5857]=o|r,r=c,o=c+8|0),a[o>>2]=_,a[r+12>>2]=_,a[_+8>>2]=r,a[_+12>>2]=c;break}if(r=d>>>8,r?d>>>0>16777215?u=31:(z=(r+1048320|0)>>>16&8,U=r<<z,J=(U+520192|0)>>>16&4,U=U<<J,u=(U+245760|0)>>>16&2,u=14-(J|z|u)+(U<<u>>>15)|0,u=d>>>(u+7|0)&1|u<<1):u=0,c=23732+(u<<2)|0,a[_+28>>2]=u,a[_+20>>2]=0,a[f>>2]=0,r=a[5858]|0,o=1<<u,!(r&o)){a[5858]=r|o,a[c>>2]=_,a[_+24>>2]=c,a[_+12>>2]=_,a[_+8>>2]=_;break}r=a[c>>2]|0;t:do if((a[r+4>>2]&-8|0)!=(d|0)){for(u=d<<((u|0)==31?0:25-(u>>>1)|0);c=r+16+(u>>>31<<2)|0,o=a[c>>2]|0,!!o;)if((a[o+4>>2]&-8|0)==(d|0)){r=o;break t}else u=u<<1,r=o;a[c>>2]=_,a[_+24>>2]=r,a[_+12>>2]=_,a[_+8>>2]=_;break e}while(!1);z=r+8|0,U=a[z>>2]|0,a[U+12>>2]=_,a[z>>2]=_,a[_+8>>2]=U,a[_+12>>2]=r,a[_+24>>2]=0}}else U=a[5861]|0,(U|0)==0|d>>>0<U>>>0&&(a[5861]=d),a[5969]=d,a[5970]=p,a[5972]=0,a[5866]=a[5975],a[5865]=-1,a[5870]=23468,a[5869]=23468,a[5872]=23476,a[5871]=23476,a[5874]=23484,a[5873]=23484,a[5876]=23492,a[5875]=23492,a[5878]=23500,a[5877]=23500,a[5880]=23508,a[5879]=23508,a[5882]=23516,a[5881]=23516,a[5884]=23524,a[5883]=23524,a[5886]=23532,a[5885]=23532,a[5888]=23540,a[5887]=23540,a[5890]=23548,a[5889]=23548,a[5892]=23556,a[5891]=23556,a[5894]=23564,a[5893]=23564,a[5896]=23572,a[5895]=23572,a[5898]=23580,a[5897]=23580,a[5900]=23588,a[5899]=23588,a[5902]=23596,a[5901]=23596,a[5904]=23604,a[5903]=23604,a[5906]=23612,a[5905]=23612,a[5908]=23620,a[5907]=23620,a[5910]=23628,a[5909]=23628,a[5912]=23636,a[5911]=23636,a[5914]=23644,a[5913]=23644,a[5916]=23652,a[5915]=23652,a[5918]=23660,a[5917]=23660,a[5920]=23668,a[5919]=23668,a[5922]=23676,a[5921]=23676,a[5924]=23684,a[5923]=23684,a[5926]=23692,a[5925]=23692,a[5928]=23700,a[5927]=23700,a[5930]=23708,a[5929]=23708,a[5932]=23716,a[5931]=23716,U=p+-40|0,J=d+8|0,J=(J&7|0)==0?0:0-J&7,z=d+J|0,J=U-J|0,a[5863]=z,a[5860]=J,a[z+4>>2]=J|1,a[d+U+4>>2]=40,a[5864]=a[5979];while(!1);if(r=a[5860]|0,r>>>0>w>>>0)return J=r-w|0,a[5860]=J,U=a[5863]|0,z=U+w|0,a[5863]=z,a[z+4>>2]=J|1,a[U+4>>2]=w|3,U=U+8|0,I=ae,U|0}return U=o2()|0,a[U>>2]=12,U=0,I=ae,U|0}function Ce(o){o=o|0;var r=0,c=0,u=0,f=0,d=0,p=0,m=0,_=0;if(o){c=o+-8|0,f=a[5861]|0,o=a[o+-4>>2]|0,r=o&-8,_=c+r|0;do if(o&1)m=c,p=c;else{if(u=a[c>>2]|0,!(o&3)||(p=c+(0-u)|0,d=u+r|0,p>>>0<f>>>0))return;if((a[5862]|0)==(p|0)){if(o=_+4|0,r=a[o>>2]|0,(r&3|0)!=3){m=p,r=d;break}a[5859]=d,a[o>>2]=r&-2,a[p+4>>2]=d|1,a[p+d>>2]=d;return}if(c=u>>>3,u>>>0<256)if(o=a[p+8>>2]|0,r=a[p+12>>2]|0,(r|0)==(o|0)){a[5857]=a[5857]&~(1<<c),m=p,r=d;break}else{a[o+12>>2]=r,a[r+8>>2]=o,m=p,r=d;break}f=a[p+24>>2]|0,o=a[p+12>>2]|0;do if((o|0)==(p|0)){if(r=p+16|0,c=r+4|0,o=a[c>>2]|0,o)r=c;else if(o=a[r>>2]|0,!o){o=0;break}for(;;)if(u=o+20|0,c=a[u>>2]|0,c)o=c,r=u;else if(u=o+16|0,c=a[u>>2]|0,c)o=c,r=u;else break;a[r>>2]=0}else m=a[p+8>>2]|0,a[m+12>>2]=o,a[o+8>>2]=m;while(!1);if(f){if(r=a[p+28>>2]|0,c=23732+(r<<2)|0,(a[c>>2]|0)==(p|0)){if(a[c>>2]=o,!o){a[5858]=a[5858]&~(1<<r),m=p,r=d;break}}else if(m=f+16|0,a[((a[m>>2]|0)==(p|0)?m:f+20|0)>>2]=o,!o){m=p,r=d;break}a[o+24>>2]=f,r=p+16|0,c=a[r>>2]|0,c|0&&(a[o+16>>2]=c,a[c+24>>2]=o),r=a[r+4>>2]|0,r?(a[o+20>>2]=r,a[r+24>>2]=o,m=p,r=d):(m=p,r=d)}else m=p,r=d}while(!1);if(!(p>>>0>=_>>>0)&&(o=_+4|0,u=a[o>>2]|0,!!(u&1))){if(u&2)a[o>>2]=u&-2,a[m+4>>2]=r|1,a[p+r>>2]=r,f=r;else{if((a[5863]|0)==(_|0)){if(_=(a[5860]|0)+r|0,a[5860]=_,a[5863]=m,a[m+4>>2]=_|1,(m|0)!=(a[5862]|0))return;a[5862]=0,a[5859]=0;return}if((a[5862]|0)==(_|0)){_=(a[5859]|0)+r|0,a[5859]=_,a[5862]=p,a[m+4>>2]=_|1,a[p+_>>2]=_;return}f=(u&-8)+r|0,c=u>>>3;do if(u>>>0<256)if(r=a[_+8>>2]|0,o=a[_+12>>2]|0,(o|0)==(r|0)){a[5857]=a[5857]&~(1<<c);break}else{a[r+12>>2]=o,a[o+8>>2]=r;break}else{d=a[_+24>>2]|0,o=a[_+12>>2]|0;do if((o|0)==(_|0)){if(r=_+16|0,c=r+4|0,o=a[c>>2]|0,o)r=c;else if(o=a[r>>2]|0,!o){c=0;break}for(;;)if(u=o+20|0,c=a[u>>2]|0,c)o=c,r=u;else if(u=o+16|0,c=a[u>>2]|0,c)o=c,r=u;else break;a[r>>2]=0,c=o}else c=a[_+8>>2]|0,a[c+12>>2]=o,a[o+8>>2]=c,c=o;while(!1);if(d|0){if(o=a[_+28>>2]|0,r=23732+(o<<2)|0,(a[r>>2]|0)==(_|0)){if(a[r>>2]=c,!c){a[5858]=a[5858]&~(1<<o);break}}else if(u=d+16|0,a[((a[u>>2]|0)==(_|0)?u:d+20|0)>>2]=c,!c)break;a[c+24>>2]=d,o=_+16|0,r=a[o>>2]|0,r|0&&(a[c+16>>2]=r,a[r+24>>2]=c),o=a[o+4>>2]|0,o|0&&(a[c+20>>2]=o,a[o+24>>2]=c)}}while(!1);if(a[m+4>>2]=f|1,a[p+f>>2]=f,(m|0)==(a[5862]|0)){a[5859]=f;return}}if(o=f>>>3,f>>>0<256){c=23468+(o<<1<<2)|0,r=a[5857]|0,o=1<<o,r&o?(r=c+8|0,o=a[r>>2]|0):(a[5857]=r|o,o=c,r=c+8|0),a[r>>2]=m,a[o+12>>2]=m,a[m+8>>2]=o,a[m+12>>2]=c;return}o=f>>>8,o?f>>>0>16777215?u=31:(p=(o+1048320|0)>>>16&8,_=o<<p,d=(_+520192|0)>>>16&4,_=_<<d,u=(_+245760|0)>>>16&2,u=14-(d|p|u)+(_<<u>>>15)|0,u=f>>>(u+7|0)&1|u<<1):u=0,o=23732+(u<<2)|0,a[m+28>>2]=u,a[m+20>>2]=0,a[m+16>>2]=0,r=a[5858]|0,c=1<<u;e:do if(!(r&c))a[5858]=r|c,a[o>>2]=m,a[m+24>>2]=o,a[m+12>>2]=m,a[m+8>>2]=m;else{o=a[o>>2]|0;t:do if((a[o+4>>2]&-8|0)!=(f|0)){for(u=f<<((u|0)==31?0:25-(u>>>1)|0);c=o+16+(u>>>31<<2)|0,r=a[c>>2]|0,!!r;)if((a[r+4>>2]&-8|0)==(f|0)){o=r;break t}else u=u<<1,o=r;a[c>>2]=m,a[m+24>>2]=o,a[m+12>>2]=m,a[m+8>>2]=m;break e}while(!1);p=o+8|0,_=a[p>>2]|0,a[_+12>>2]=m,a[p>>2]=m,a[m+8>>2]=_,a[m+12>>2]=o,a[m+24>>2]=0}while(!1);if(_=(a[5865]|0)+-1|0,a[5865]=_,!(_|0)){for(o=23884;o=a[o>>2]|0,o;)o=o+8|0;a[5865]=-1}}}}function gn(o,r){o=o|0,r=r|0;var c=0;return o?(c=hn(r,o)|0,(r|o)>>>0>65535&&(c=((c>>>0)/(o>>>0)|0|0)==(r|0)?c:-1)):c=0,o=dn(c)|0,!o||!(a[o+-4>>2]&3)||$n(o|0,0,c|0)|0,o|0}function Pe(o,r,c,u){return o=o|0,r=r|0,c=c|0,u=u|0,c=o+c>>>0,Se(r+u+(c>>>0<o>>>0|0)>>>0|0),c|0|0}function bt(o,r,c,u){return o=o|0,r=r|0,c=c|0,u=u|0,u=r-u-(c>>>0>o>>>0|0)>>>0,Se(u|0),o-c>>>0|0|0}function rl(o){return o=o|0,(o?31-(jn(o^o-1)|0)|0:32)|0}function Wr(o,r,c,u,f){o=o|0,r=r|0,c=c|0,u=u|0,f=f|0;var d=0,p=0,m=0,_=0,b=0,v=0,w=0,P=0,L=0,D=0;if(v=o,_=r,b=_,p=c,P=u,m=P,!b)return d=(f|0)!=0,m?d?(a[f>>2]=o|0,a[f+4>>2]=r&0,P=0,f=0,Se(P|0),f|0):(P=0,f=0,Se(P|0),f|0):(d&&(a[f>>2]=(v>>>0)%(p>>>0),a[f+4>>2]=0),P=0,f=(v>>>0)/(p>>>0)>>>0,Se(P|0),f|0);d=(m|0)==0;do if(p){if(!d){if(d=(jn(m|0)|0)-(jn(b|0)|0)|0,d>>>0<=31){w=d+1|0,m=31-d|0,r=d-31>>31,p=w,o=v>>>(w>>>0)&r|b<<m,r=b>>>(w>>>0)&r,d=0,m=v<<m;break}return f?(a[f>>2]=o|0,a[f+4>>2]=_|r&0,P=0,f=0,Se(P|0),f|0):(P=0,f=0,Se(P|0),f|0)}if(d=p-1|0,d&p|0){m=(jn(p|0)|0)+33-(jn(b|0)|0)|0,D=64-m|0,w=32-m|0,_=w>>31,L=m-32|0,r=L>>31,p=m,o=w-1>>31&b>>>(L>>>0)|(b<<w|v>>>(m>>>0))&r,r=r&b>>>(m>>>0),d=v<<D&_,m=(b<<D|v>>>(L>>>0))&_|v<<w&m-33>>31;break}return f|0&&(a[f>>2]=d&v,a[f+4>>2]=0),(p|0)==1?(L=_|r&0,D=o|0|0,Se(L|0),D|0):(D=rl(p|0)|0,L=b>>>(D>>>0)|0,D=b<<32-D|v>>>(D>>>0)|0,Se(L|0),D|0)}else{if(d)return f|0&&(a[f>>2]=(b>>>0)%(p>>>0),a[f+4>>2]=0),L=0,D=(b>>>0)/(p>>>0)>>>0,Se(L|0),D|0;if(!v)return f|0&&(a[f>>2]=0,a[f+4>>2]=(b>>>0)%(m>>>0)),L=0,D=(b>>>0)/(m>>>0)>>>0,Se(L|0),D|0;if(d=m-1|0,!(d&m))return f|0&&(a[f>>2]=o|0,a[f+4>>2]=d&b|r&0),L=0,D=b>>>((rl(m|0)|0)>>>0),Se(L|0),D|0;if(d=(jn(m|0)|0)-(jn(b|0)|0)|0,d>>>0<=30){r=d+1|0,m=31-d|0,p=r,o=b<<m|v>>>(r>>>0),r=b>>>(r>>>0),d=0,m=v<<m;break}return f?(a[f>>2]=o|0,a[f+4>>2]=_|r&0,L=0,D=0,Se(L|0),D|0):(L=0,D=0,Se(L|0),D|0)}while(!1);if(!p)b=m,_=0,m=0;else{w=c|0|0,v=P|u&0,b=Pe(w|0,v|0,-1,-1)|0,c=S()|0,_=m,m=0;do u=_,_=d>>>31|_<<1,d=m|d<<1,u=o<<1|u>>>31|0,P=o>>>31|r<<1|0,bt(b|0,c|0,u|0,P|0)|0,D=S()|0,L=D>>31|((D|0)<0?-1:0)<<1,m=L&1,o=bt(u|0,P|0,L&w|0,(((D|0)<0?-1:0)>>31|((D|0)<0?-1:0)<<1)&v|0)|0,r=S()|0,p=p-1|0;while((p|0)!=0);b=_,_=0}return p=0,f|0&&(a[f>>2]=o,a[f+4>>2]=r),L=(d|0)>>>31|(b|p)<<1|(p<<1|d>>>31)&0|_,D=(d<<1|0)&-2|m,Se(L|0),D|0}function Yn(o,r,c,u){o=o|0,r=r|0,c=c|0,u=u|0;var f=0,d=0,p=0,m=0,_=0,b=0;return b=r>>31|((r|0)<0?-1:0)<<1,_=((r|0)<0?-1:0)>>31|((r|0)<0?-1:0)<<1,d=u>>31|((u|0)<0?-1:0)<<1,f=((u|0)<0?-1:0)>>31|((u|0)<0?-1:0)<<1,m=bt(b^o|0,_^r|0,b|0,_|0)|0,p=S()|0,o=d^b,r=f^_,bt((Wr(m,p,bt(d^c|0,f^u|0,d|0,f|0)|0,S()|0,0)|0)^o|0,(S()|0)^r|0,o|0,r|0)|0}function c2(o,r){o=o|0,r=r|0;var c=0,u=0,f=0,d=0;return d=o&65535,f=r&65535,c=hn(f,d)|0,u=o>>>16,o=(c>>>16)+(hn(f,u)|0)|0,f=r>>>16,r=hn(f,d)|0,Se((o>>>16)+(hn(f,u)|0)+(((o&65535)+r|0)>>>16)|0),o+r<<16|c&65535|0|0}function Et(o,r,c,u){o=o|0,r=r|0,c=c|0,u=u|0;var f=0,d=0;return f=o,d=c,c=c2(f,d)|0,o=S()|0,Se((hn(r,d)|0)+(hn(u,f)|0)+o|o&0|0),c|0|0|0}function Qi(o,r,c,u){o=o|0,r=r|0,c=c|0,u=u|0;var f=0,d=0,p=0,m=0,_=0,b=0;return f=I,I=I+16|0,m=f|0,p=r>>31|((r|0)<0?-1:0)<<1,d=((r|0)<0?-1:0)>>31|((r|0)<0?-1:0)<<1,b=u>>31|((u|0)<0?-1:0)<<1,_=((u|0)<0?-1:0)>>31|((u|0)<0?-1:0)<<1,o=bt(p^o|0,d^r|0,p|0,d|0)|0,r=S()|0,Wr(o,r,bt(b^c|0,_^u|0,b|0,_|0)|0,S()|0,m)|0,u=bt(a[m>>2]^p|0,a[m+4>>2]^d|0,p|0,d|0)|0,c=S()|0,I=f,Se(c|0),u|0}function Bs(o,r,c,u){o=o|0,r=r|0,c=c|0,u=u|0;var f=0,d=0;return d=I,I=I+16|0,f=d|0,Wr(o,r,c,u,f)|0,I=d,Se(a[f+4>>2]|0),a[f>>2]|0|0}function ol(o,r,c){return o=o|0,r=r|0,c=c|0,(c|0)<32?(Se(r>>c|0),o>>>c|(r&(1<<c)-1)<<32-c):(Se(((r|0)<0?-1:0)|0),r>>c-32|0)}function q(o,r,c){return o=o|0,r=r|0,c=c|0,(c|0)<32?(Se(r>>>c|0),o>>>c|(r&(1<<c)-1)<<32-c):(Se(0),r>>>c-32|0)}function Ae(o,r,c){return o=o|0,r=r|0,c=c|0,(c|0)<32?(Se(r<<c|(o&(1<<c)-1<<32-c)>>>32-c|0),o<<c):(Se(o<<c-32|0),0)}function al(o,r){return o=+o,r=+r,o!=o?+r:r!=r?+o:+Cp(+o,+r)}function Xr(o,r){return o=+o,r=+r,o!=o?+r:r!=r?+o:+Dr(+o,+r)}function Ki(o){return o=+o,o>=0?+ht(o+.5):+ds(o-.5)}function Wi(o,r,c){o=o|0,r=r|0,c=c|0;var u=0,f=0,d=0;if((c|0)>=8192)return yp(o|0,r|0,c|0)|0,o|0;if(d=o|0,f=o+c|0,(o&3)==(r&3)){for(;o&3;){if(!c)return d|0;Be[o>>0]=Be[r>>0]|0,o=o+1|0,r=r+1|0,c=c-1|0}for(c=f&-4|0,u=c-64|0;(o|0)<=(u|0);)a[o>>2]=a[r>>2],a[o+4>>2]=a[r+4>>2],a[o+8>>2]=a[r+8>>2],a[o+12>>2]=a[r+12>>2],a[o+16>>2]=a[r+16>>2],a[o+20>>2]=a[r+20>>2],a[o+24>>2]=a[r+24>>2],a[o+28>>2]=a[r+28>>2],a[o+32>>2]=a[r+32>>2],a[o+36>>2]=a[r+36>>2],a[o+40>>2]=a[r+40>>2],a[o+44>>2]=a[r+44>>2],a[o+48>>2]=a[r+48>>2],a[o+52>>2]=a[r+52>>2],a[o+56>>2]=a[r+56>>2],a[o+60>>2]=a[r+60>>2],o=o+64|0,r=r+64|0;for(;(o|0)<(c|0);)a[o>>2]=a[r>>2],o=o+4|0,r=r+4|0}else for(c=f-4|0;(o|0)<(c|0);)Be[o>>0]=Be[r>>0]|0,Be[o+1>>0]=Be[r+1>>0]|0,Be[o+2>>0]=Be[r+2>>0]|0,Be[o+3>>0]=Be[r+3>>0]|0,o=o+4|0,r=r+4|0;for(;(o|0)<(f|0);)Be[o>>0]=Be[r>>0]|0,o=o+1|0,r=r+1|0;return d|0}function $n(o,r,c){o=o|0,r=r|0,c=c|0;var u=0,f=0,d=0,p=0;if(d=o+c|0,r=r&255,(c|0)>=67){for(;o&3;)Be[o>>0]=r,o=o+1|0;for(u=d&-4|0,p=r|r<<8|r<<16|r<<24,f=u-64|0;(o|0)<=(f|0);)a[o>>2]=p,a[o+4>>2]=p,a[o+8>>2]=p,a[o+12>>2]=p,a[o+16>>2]=p,a[o+20>>2]=p,a[o+24>>2]=p,a[o+28>>2]=p,a[o+32>>2]=p,a[o+36>>2]=p,a[o+40>>2]=p,a[o+44>>2]=p,a[o+48>>2]=p,a[o+52>>2]=p,a[o+56>>2]=p,a[o+60>>2]=p,o=o+64|0;for(;(o|0)<(u|0);)a[o>>2]=p,o=o+4|0}for(;(o|0)<(d|0);)Be[o>>0]=r,o=o+1|0;return d-c|0}function cl(o){return o=+o,o>=0?+ht(o+.5):+ds(o-.5)}function On(o){o=o|0;var r=0,c=0,u=0;return u=_p()|0,c=a[Qe>>2]|0,r=c+o|0,(o|0)>0&(r|0)<(c|0)|(r|0)<0?(Ep(r|0)|0,Tc(12),-1):(r|0)>(u|0)&&!(bp(r|0)|0)?(Tc(12),-1):(a[Qe>>2]=r,c|0)}return{___divdi3:Yn,___muldi3:Et,___remdi3:Qi,___uremdi3:Bs,_areNeighborCells:Xp,_bitshift64Ashr:ol,_bitshift64Lshr:q,_bitshift64Shl:Ae,_calloc:gn,_cellAreaKm2:Sm,_cellAreaM2:xm,_cellAreaRads2:Kr,_cellToBoundary:ai,_cellToCenterChild:lm,_cellToChildPos:Cm,_cellToChildren:am,_cellToChildrenSize:ji,_cellToLatLng:oi,_cellToLocalIj:Gm,_cellToParent:kr,_cellToVertex:Zt,_cellToVertexes:t2,_cellsToDirectedEdge:Yp,_cellsToLinkedMultiPolygon:Lp,_childPosToCell:_m,_compactCells:um,_destroyLinkedMultiPolygon:Xc,_directedEdgeToBoundary:zi,_directedEdgeToCells:em,_edgeLengthKm:Pm,_edgeLengthM:Fm,_edgeLengthRads:Dm,_emscripten_replace_memory:Tp,_free:Ce,_getBaseCellNumber:Vc,_getDirectedEdgeDestination:Zp,_getDirectedEdgeOrigin:$p,_getHexagonAreaAvgKm2:vm,_getHexagonAreaAvgM2:Im,_getHexagonEdgeLengthAvgKm:Mm,_getHexagonEdgeLengthAvgM:wm,_getIcosahedronFaces:jc,_getNumCells:Qr,_getPentagons:jr,_getRes0Cells:Up,_getResolution:om,_greatCircleDistanceKm:li,_greatCircleDistanceM:bm,_greatCircleDistanceRads:ym,_gridDisk:vc,_gridDiskDistances:Ic,_gridDistance:Um,_gridPathCells:km,_gridPathCellsSize:Hm,_gridRingUnsafe:xp,_i64Add:Pe,_i64Subtract:bt,_isPentagon:tt,_isResClassIII:dm,_isValidCell:Hr,_isValidDirectedEdge:qp,_isValidVertex:s2,_latLngToCell:zc,_llvm_maxnum_f64:al,_llvm_minnum_f64:Xr,_llvm_round_f64:Ki,_localIjToCell:Nm,_malloc:dn,_maxFaceCount:mm,_maxGridDiskSize:Sp,_maxPolygonToCellsSize:Dp,_memcpy:Wi,_memset:$n,_originToDirectedEdges:tm,_pentagonCount:Bm,_polygonToCells:Pp,_readInt64AsDoubleFromPointer:$m,_res0CellCount:Np,_round:cl,_sbrk:On,_sizeOfCellBoundary:Qm,_sizeOfCoordIJ:Ym,_sizeOfGeoLoop:Km,_sizeOfGeoPolygon:Wm,_sizeOfH3Index:zm,_sizeOfLatLng:jm,_sizeOfLinkedGeoPolygon:Xm,_uncompactCells:fm,_uncompactCellsSize:hm,_vertexToLatLng:n2,establishStackSpace:wp,stackAlloc:vp,stackRestore:Mp,stackSave:Ip}}(hp,dp,O);e.___divdi3=ee.___divdi3,e.___muldi3=ee.___muldi3,e.___remdi3=ee.___remdi3,e.___uremdi3=ee.___uremdi3,e._areNeighborCells=ee._areNeighborCells,e._bitshift64Ashr=ee._bitshift64Ashr,e._bitshift64Lshr=ee._bitshift64Lshr,e._bitshift64Shl=ee._bitshift64Shl,e._calloc=ee._calloc,e._cellAreaKm2=ee._cellAreaKm2,e._cellAreaM2=ee._cellAreaM2,e._cellAreaRads2=ee._cellAreaRads2,e._cellToBoundary=ee._cellToBoundary,e._cellToCenterChild=ee._cellToCenterChild,e._cellToChildPos=ee._cellToChildPos,e._cellToChildren=ee._cellToChildren,e._cellToChildrenSize=ee._cellToChildrenSize,e._cellToLatLng=ee._cellToLatLng,e._cellToLocalIj=ee._cellToLocalIj,e._cellToParent=ee._cellToParent,e._cellToVertex=ee._cellToVertex,e._cellToVertexes=ee._cellToVertexes,e._cellsToDirectedEdge=ee._cellsToDirectedEdge,e._cellsToLinkedMultiPolygon=ee._cellsToLinkedMultiPolygon,e._childPosToCell=ee._childPosToCell,e._compactCells=ee._compactCells,e._destroyLinkedMultiPolygon=ee._destroyLinkedMultiPolygon,e._directedEdgeToBoundary=ee._directedEdgeToBoundary,e._directedEdgeToCells=ee._directedEdgeToCells,e._edgeLengthKm=ee._edgeLengthKm,e._edgeLengthM=ee._edgeLengthM,e._edgeLengthRads=ee._edgeLengthRads;var gp=e._emscripten_replace_memory=ee._emscripten_replace_memory;e._free=ee._free,e._getBaseCellNumber=ee._getBaseCellNumber,e._getDirectedEdgeDestination=ee._getDirectedEdgeDestination,e._getDirectedEdgeOrigin=ee._getDirectedEdgeOrigin,e._getHexagonAreaAvgKm2=ee._getHexagonAreaAvgKm2,e._getHexagonAreaAvgM2=ee._getHexagonAreaAvgM2,e._getHexagonEdgeLengthAvgKm=ee._getHexagonEdgeLengthAvgKm,e._getHexagonEdgeLengthAvgM=ee._getHexagonEdgeLengthAvgM,e._getIcosahedronFaces=ee._getIcosahedronFaces,e._getNumCells=ee._getNumCells,e._getPentagons=ee._getPentagons,e._getRes0Cells=ee._getRes0Cells,e._getResolution=ee._getResolution,e._greatCircleDistanceKm=ee._greatCircleDistanceKm,e._greatCircleDistanceM=ee._greatCircleDistanceM,e._greatCircleDistanceRads=ee._greatCircleDistanceRads,e._gridDisk=ee._gridDisk,e._gridDiskDistances=ee._gridDiskDistances,e._gridDistance=ee._gridDistance,e._gridPathCells=ee._gridPathCells,e._gridPathCellsSize=ee._gridPathCellsSize,e._gridRingUnsafe=ee._gridRingUnsafe,e._i64Add=ee._i64Add,e._i64Subtract=ee._i64Subtract,e._isPentagon=ee._isPentagon,e._isResClassIII=ee._isResClassIII,e._isValidCell=ee._isValidCell,e._isValidDirectedEdge=ee._isValidDirectedEdge,e._isValidVertex=ee._isValidVertex,e._latLngToCell=ee._latLngToCell,e._llvm_maxnum_f64=ee._llvm_maxnum_f64,e._llvm_minnum_f64=ee._llvm_minnum_f64,e._llvm_round_f64=ee._llvm_round_f64,e._localIjToCell=ee._localIjToCell,e._malloc=ee._malloc,e._maxFaceCount=ee._maxFaceCount,e._maxGridDiskSize=ee._maxGridDiskSize,e._maxPolygonToCellsSize=ee._maxPolygonToCellsSize,e._memcpy=ee._memcpy,e._memset=ee._memset,e._originToDirectedEdges=ee._originToDirectedEdges,e._pentagonCount=ee._pentagonCount,e._polygonToCells=ee._polygonToCells,e._readInt64AsDoubleFromPointer=ee._readInt64AsDoubleFromPointer,e._res0CellCount=ee._res0CellCount,e._round=ee._round,e._sbrk=ee._sbrk,e._sizeOfCellBoundary=ee._sizeOfCellBoundary,e._sizeOfCoordIJ=ee._sizeOfCoordIJ,e._sizeOfGeoLoop=ee._sizeOfGeoLoop,e._sizeOfGeoPolygon=ee._sizeOfGeoPolygon,e._sizeOfH3Index=ee._sizeOfH3Index,e._sizeOfLatLng=ee._sizeOfLatLng,e._sizeOfLinkedGeoPolygon=ee._sizeOfLinkedGeoPolygon,e._uncompactCells=ee._uncompactCells,e._uncompactCellsSize=ee._uncompactCellsSize,e._vertexToLatLng=ee._vertexToLatLng,e.establishStackSpace=ee.establishStackSpace;var _c=e.stackAlloc=ee.stackAlloc,pp=e.stackRestore=ee.stackRestore,mp=e.stackSave=ee.stackSave;if(e.asm=ee,e.cwrap=Y,e.setValue=T,e.getValue=x,yn){Bc(yn)||(yn=A(yn));{np();var wr=function(j){j.byteLength&&(j=new Uint8Array(j)),he.set(j,E),e.memoryInitializerRequest&&delete e.memoryInitializerRequest.response,sp()},yc=function(){l(yn,wr,function(){throw"could not load memory initializer "+yn})},bc=Mr(yn);if(bc)wr(bc.buffer);else if(e.memoryInitializerRequest){var Ec=function(){var j=e.memoryInitializerRequest,Z=j.response;if(j.status!==200&&j.status!==0){var le=Mr(e.memoryInitializerRequestURL);if(le)Z=le.buffer;else{console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+j.status+", retrying "+yn),yc();return}}wr(Z)};e.memoryInitializerRequest.response?setTimeout(Ec,0):e.memoryInitializerRequest.addEventListener("load",Ec)}else yc()}}var Ui;Ai=function j(){Ui||Sr(),Ui||(Ai=j)};function Sr(j){if(zn>0||(Qg(),zn>0))return;function Z(){Ui||(Ui=!0,!F&&(Kg(),Wg(),e.onRuntimeInitialized&&e.onRuntimeInitialized(),Xg()))}e.setStatus?(e.setStatus("Running..."),setTimeout(function(){setTimeout(function(){e.setStatus("")},1),Z()},1)):Z()}e.run=Sr;function hs(j){throw e.onAbort&&e.onAbort(j),j+="",h(j),g(j),F=!0,"abort("+j+"). Build with -s ASSERTIONS=1 for more info."}if(e.abort=hs,e.preInit)for(typeof e.preInit=="function"&&(e.preInit=[e.preInit]);e.preInit.length>0;)e.preInit.pop()();return Sr(),s}(typeof Ve=="object"?Ve:{}),Me="number",me=Me,gi=Me,ye=Me,be=Me,Tt=Me,de=Me,vE=[["sizeOfH3Index",Me],["sizeOfLatLng",Me],["sizeOfCellBoundary",Me],["sizeOfGeoLoop",Me],["sizeOfGeoPolygon",Me],["sizeOfLinkedGeoPolygon",Me],["sizeOfCoordIJ",Me],["readInt64AsDoubleFromPointer",Me],["isValidCell",gi,[ye,be]],["latLngToCell",me,[Me,Me,Tt,de]],["cellToLatLng",me,[ye,be,de]],["cellToBoundary",me,[ye,be,de]],["maxGridDiskSize",me,[Me,de]],["gridDisk",me,[ye,be,Me,de]],["gridDiskDistances",me,[ye,be,Me,de,de]],["gridRingUnsafe",me,[ye,be,Me,de]],["maxPolygonToCellsSize",me,[de,Tt,Me,de]],["polygonToCells",me,[de,Tt,Me,de]],["cellsToLinkedMultiPolygon",me,[de,Me,de]],["destroyLinkedMultiPolygon",null,[de]],["compactCells",me,[de,de,Me,Me]],["uncompactCells",me,[de,Me,Me,de,Me,Tt]],["uncompactCellsSize",me,[de,Me,Me,Tt,de]],["isPentagon",gi,[ye,be]],["isResClassIII",gi,[ye,be]],["getBaseCellNumber",Me,[ye,be]],["getResolution",Me,[ye,be]],["maxFaceCount",me,[ye,be,de]],["getIcosahedronFaces",me,[ye,be,de]],["cellToParent",me,[ye,be,Tt,de]],["cellToChildren",me,[ye,be,Tt,de]],["cellToCenterChild",me,[ye,be,Tt,de]],["cellToChildrenSize",me,[ye,be,Tt,de]],["cellToChildPos",me,[ye,be,Tt,de]],["childPosToCell",me,[Me,Me,ye,be,Tt,de]],["areNeighborCells",me,[ye,be,ye,be,de]],["cellsToDirectedEdge",me,[ye,be,ye,be,de]],["getDirectedEdgeOrigin",me,[ye,be,de]],["getDirectedEdgeDestination",me,[ye,be,de]],["isValidDirectedEdge",gi,[ye,be]],["directedEdgeToCells",me,[ye,be,de]],["originToDirectedEdges",me,[ye,be,de]],["directedEdgeToBoundary",me,[ye,be,de]],["gridDistance",me,[ye,be,ye,be,de]],["gridPathCells",me,[ye,be,ye,be,de]],["gridPathCellsSize",me,[ye,be,ye,be,de]],["cellToLocalIj",me,[ye,be,ye,be,Me,de]],["localIjToCell",me,[ye,be,de,Me,de]],["getHexagonAreaAvgM2",me,[Tt,de]],["getHexagonAreaAvgKm2",me,[Tt,de]],["getHexagonEdgeLengthAvgM",me,[Tt,de]],["getHexagonEdgeLengthAvgKm",me,[Tt,de]],["greatCircleDistanceM",Me,[de,de]],["greatCircleDistanceKm",Me,[de,de]],["greatCircleDistanceRads",Me,[de,de]],["cellAreaM2",me,[ye,be,de]],["cellAreaKm2",me,[ye,be,de]],["cellAreaRads2",me,[ye,be,de]],["edgeLengthM",me,[ye,be,de]],["edgeLengthKm",me,[ye,be,de]],["edgeLengthRads",me,[ye,be,de]],["getNumCells",me,[Tt,de]],["getRes0Cells",me,[de]],["res0CellCount",Me],["getPentagons",me,[Me,de]],["pentagonCount",Me],["cellToVertex",me,[ye,be,Me,de]],["cellToVertexes",me,[ye,be,de]],["vertexToLatLng",me,[ye,be,de]],["isValidVertex",gi,[ye,be]]],IE=0,ME=1,wE=2,SE=3,Wh=4,xE=5,DE=6,PE=7,FE=8,LE=9,RE=10,OE=11,GE=12,NE=13,UE=14,HE=15,_t={};_t[IE]="Success";_t[ME]="The operation failed but a more specific error is not available";_t[wE]="Argument was outside of acceptable range";_t[SE]="Latitude or longitude arguments were outside of acceptable range";_t[Wh]="Resolution argument was outside of acceptable range";_t[xE]="Cell argument was not valid";_t[DE]="Directed edge argument was not valid";_t[PE]="Undirected edge argument was not valid";_t[FE]="Vertex argument was not valid";_t[LE]="Pentagon distortion was encountered";_t[RE]="Duplicate input";_t[OE]="Cell arguments were not neighbors";_t[GE]="Cell arguments had incompatible resolutions";_t[NE]="Memory allocation failed";_t[UE]="Bounds of provided memory were insufficient";_t[HE]="Mode or flags argument was not valid";var Xh=1e3,kE=1001,Yh=1002,ur={};ur[Xh]="Unknown unit";ur[kE]="Array length out of bounds";ur[Yh]="Got unexpected null value for H3 index";var JE="Unknown error";function $h(s,e,t){var n=t&&"value"in t,i=new Error((s[e]||JE)+" (code: "+e+(n?", value: "+t.value:"")+")");return i.code=e,i}function Zh(s,e){var t=arguments.length===2?{value:e}:{};return $h(_t,s,t)}function qh(s,e){var t=arguments.length===2?{value:e}:{};return $h(ur,s,t)}function rs(s){if(s!==0)throw Zh(s)}var ft={};vE.forEach(function(e){ft[e[0]]=Ve.cwrap.apply(Ve,e)});var Ns=16,ed=4,z0=4,kn=8,VE=8,zA=ft.sizeOfH3Index(),td=ft.sizeOfLatLng(),zE=ft.sizeOfCellBoundary();ft.sizeOfGeoPolygon();ft.sizeOfGeoLoop();var jE=ft.sizeOfLinkedGeoPolygon();ft.sizeOfCoordIJ();var j0={m:"m",m2:"m2",km:"km",km2:"km2",rads:"rads",rads2:"rads2"};function QE(s){if(typeof s!="number"||s<0||s>15||Math.floor(s)!==s)throw Zh(Wh,s);return s}function KE(s){if(!s)throw qh(Yh);return s}var WE=/[^0-9a-fA-F]/;function os(s){if(Array.isArray(s)&&s.length===2&&Number.isInteger(s[0])&&Number.isInteger(s[1]))return s;if(typeof s!="string"||WE.test(s))return[0,0];var e=parseInt(s.substring(0,s.length-8),Ns),t=parseInt(s.substring(s.length-8),Ns);return[t,e]}function Q0(s){if(s>=0)return s.toString(Ns);s=s&2147483647;var e=nd(8,s.toString(Ns)),t=(parseInt(e[0],Ns)+8).toString(Ns);return e=t+e.substring(1),e}function XE(s,e){return Q0(e)+nd(8,Q0(s))}function nd(s,e){for(var t=s-e.length,n="",i=0;i<t;i++)n+="0";return n=n+e,n}function YE(s,e){e===void 0&&(e=0);var t=Ve.getValue(s+zA*e,"i32"),n=Ve.getValue(s+zA*e+ed,"i32");return n?XE(t,n):null}function $E(s,e){return e===void 0&&(e=0),Ve.getValue(s+kn*e,"double")}function ZE(s){return ft.readInt64AsDoubleFromPointer(s)}function qE(s,e,t){Ve.HEAPU32.set(os(s),e/ed+2*t)}function eT(s,e){for(var t=e.length,n=0;n<t;n++)qE(e[n],s,n)}function jA(s){return fT(Ve.getValue(s,"double"))}function tT(s){return[jA(s),jA(s+kn)]}function sd(s){return[jA(s+kn),jA(s)]}function nT(s,e,t){for(var n=Ve.getValue(s,"i32"),i=s+kn,A=[],l=sd,h=0;h<n*2;h+=2)A.push(l(i+kn*h));return A.push(A[0]),A}function sT(s,e){for(var t=[],n=sd,i,A,l,h;s;){for(t.push(i=[]),A=Ve.getValue(s,"i8*");A;){for(i.push(l=[]),h=Ve.getValue(A,"i8*");h;)l.push(n(h)),h=Ve.getValue(h+kn*2,"i8*");l.push(l[0]),A=Ve.getValue(A+z0*2,"i8*")}s=Ve.getValue(s+z0*2,"i8*")}return t}function iT(s){var e=os(s),t=e[0],n=e[1];return!!ft.isPentagon(t,n)}function AT(s){var e=os(s),t=e[0],n=e[1];return ft.isValidCell(t,n)?ft.getResolution(t,n):-1}function rT(s,e,t){var n=Ve._malloc(td);Ve.HEAPF64.set([s,e].map(uT),n/kn);var i=Ve._malloc(zA);try{return rs(ft.latLngToCell(n,t,i)),KE(YE(i))}finally{Ve._free(i),Ve._free(n)}}function ka(s){var e=Ve._malloc(td),t=os(s),n=t[0],i=t[1];try{return rs(ft.cellToLatLng(n,i,e)),tT(e)}finally{Ve._free(e)}}function oT(s,e){var t=Ve._malloc(zE),n=os(s),i=n[0],A=n[1];try{return rs(ft.cellToBoundary(i,A,t)),nT(t,e,e)}finally{Ve._free(t)}}function aT(s,e){if(!s||!s.length)return[];var t=s.length,n=Ve._calloc(t,zA);eT(n,s);var i=Ve._calloc(jE);try{return rs(ft.cellsToLinkedMultiPolygon(n,t,i)),sT(i,e)}finally{ft.destroyLinkedMultiPolygon(i),Ve._free(i),Ve._free(n)}}function cT(s,e){var t=os(s),n=t[0],i=t[1],A=os(e),l=A[0],h=A[1],g=Ve._malloc(VE);try{return rs(ft.gridDistance(n,i,l,h,g)),ZE(g)}finally{Ve._free(g)}}function lT(s,e){QE(s);var t=Ve._malloc(kn);try{switch(e){case j0.m:rs(ft.getHexagonEdgeLengthAvgM(s,t));break;case j0.km:rs(ft.getHexagonEdgeLengthAvgKm(s,t));break;default:throw qh(Xh,e)}return $E(t)}finally{Ve._free(t)}}function uT(s){return s*Math.PI/180}function fT(s){return s*180/Math.PI}function Ja(s,e){e=e===void 0?s[0][0]:e;for(const t of s){const n=t[0]-e;n>180?t[0]-=360:n<-180&&(t[0]+=360)}}function hT(s,e,t){const[n,i]=ka(s),A=e.length;Ja(e,i);const l=e[0]===e[A-1]?A-1:A;for(let h=0;h<l;h++)e[h][0]=Hn(i,e[h][0],t),e[h][1]=Hn(n,e[h][1],t)}function dT(s,e,t){const n=s(e,t),[i,A]=ka(n);return[A,i]}function K0(s,e=1){const t=oT(s,!0);return e!==1?hT(s,t,e):Ja(t),t}function gT(s){const e=new Float64Array(s.length*2);let t=0;for(const n of s)e[t++]=n[0],e[t++]=n[1];return e}const pT=10;function mT(s,e){let t;return s==null?t=e:typeof s=="object"?t={...s,coverage:e}:t={getHexagon:s,coverage:e},t}const BT={...Ar.defaultProps,highPrecision:"auto",coverage:{type:"number",min:0,max:1,value:1},centerHexagon:null,getHexagon:{type:"accessor",value:s=>s.hexagon},extruded:!0};class ii extends xn{initializeState(){ii._checkH3Lib(),this.state={edgeLengthKM:0,resolution:-1}}shouldUpdateState({changeFlags:e}){return this._shouldUseHighPrecision()?e.propsOrDataChanged:e.somethingChanged}updateState({props:e,changeFlags:t}){if(e.highPrecision!==!0&&(t.dataChanged||t.updateTriggersChanged&&t.updateTriggersChanged.getHexagon)){const n=this._calculateH3DataProps();this.setState(n)}this._updateVertices(this.context.viewport)}_calculateH3DataProps(){let e=-1,t=!1,n=!1;const{iterable:i,objectInfo:A}=cs(this.props.data);for(const l of i){A.index++;const h=this.props.getHexagon(l,A),g=AT(h);if(e<0){if(e=g,!this.props.highPrecision)break}else if(e!==g){n=!0;break}if(iT(h)){t=!0;break}}return{resolution:e,edgeLengthKM:e>=0?lT(e,"km"):0,hasMultipleRes:n,hasPentagon:t}}_shouldUseHighPrecision(){if(this.props.highPrecision==="auto"){const{resolution:e,hasPentagon:t,hasMultipleRes:n}=this.state,{viewport:i}=this.context;return!!(i!=null&&i.resolution)||n||t||e>=0&&e<=5}return this.props.highPrecision}_updateVertices(e){if(this._shouldUseHighPrecision())return;const{resolution:t,edgeLengthKM:n,centerHex:i}=this.state;if(t<0)return;const A=this.props.centerHexagon||rT(e.latitude,e.longitude,t);if(i===A)return;if(i)try{if(cT(i,A)*n<pT)return}catch{}const{unitsPerMeter:l}=e.distanceScales;let h=K0(A);const[g,B]=ka(A),[C,y]=e.projectFlat([B,g]);h=h.map(E=>{const T=e.projectFlat(E);return[(T[0]-C)/l[0],(T[1]-y)/l[1]]}),this.setState({centerHex:A,vertices:h})}renderLayers(){return this._shouldUseHighPrecision()?this._renderPolygonLayer():this._renderColumnLayer()}_getForwardProps(){const{elevationScale:e,material:t,coverage:n,extruded:i,wireframe:A,stroked:l,filled:h,lineWidthUnits:g,lineWidthScale:B,lineWidthMinPixels:C,lineWidthMaxPixels:y,getFillColor:E,getElevation:T,getLineColor:x,getLineWidth:F,transitions:N,updateTriggers:R}=this.props;return{elevationScale:e,extruded:i,coverage:n,wireframe:A,stroked:l,filled:h,lineWidthUnits:g,lineWidthScale:B,lineWidthMinPixels:C,lineWidthMaxPixels:y,material:t,getElevation:T,getFillColor:E,getLineColor:x,getLineWidth:F,transitions:N,updateTriggers:{getFillColor:R.getFillColor,getElevation:R.getElevation,getLineColor:R.getLineColor,getLineWidth:R.getLineWidth}}}_renderPolygonLayer(){const{data:e,getHexagon:t,updateTriggers:n,coverage:i}=this.props,A=this.getSubLayerClass("hexagon-cell-hifi",Ar),l=this._getForwardProps();return l.updateTriggers.getPolygon=mT(n.getHexagon,i),new A(l,this.getSubLayerProps({id:"hexagon-cell-hifi",updateTriggers:l.updateTriggers}),{data:e,_normalize:!1,_windingOrder:"CCW",positionFormat:"XY",getPolygon:(h,g)=>{const B=t(h,g);return gT(K0(B,i))}})}_renderColumnLayer(){const{data:e,getHexagon:t,updateTriggers:n}=this.props,i=this.getSubLayerClass("hexagon-cell",ni),A=this._getForwardProps();return A.updateTriggers.getPosition=n.getHexagon,new i(A,this.getSubLayerProps({id:"hexagon-cell",flatShading:!0,updateTriggers:A.updateTriggers}),{data:e,diskResolution:6,radius:1,vertices:this.state.vertices,getPosition:dT.bind(null,t)})}}ii.defaultProps=BT;ii.layerName="H3HexagonLayer";ii._checkH3Lib=()=>{};const CT={getHexagons:{type:"accessor",value:s=>s.hexagons}};class id extends si{initializeState(){ii._checkH3Lib()}updateState({props:e,changeFlags:t}){if(t.dataChanged||t.updateTriggersChanged&&t.updateTriggersChanged.getHexagons){const{data:n,getHexagons:i}=e,A=[],{iterable:l,objectInfo:h}=cs(n);for(const g of l){h.index++;const B=i(g,h),C=aT(B,!0);for(const y of C){for(const E of y)Ja(E);A.push(this.getSubLayerRow({polygon:y},g,h.index))}}this.setState({polygons:A})}}indexToBounds(){const{getElevation:e,getFillColor:t,getLineColor:n,getLineWidth:i}=this.props;return{data:this.state.polygons,getPolygon:A=>A.polygon,getElevation:this.getSubLayerAccessor(e),getFillColor:this.getSubLayerAccessor(t),getLineColor:this.getSubLayerAccessor(n),getLineWidth:this.getSubLayerAccessor(i)}}}id.layerName="H3ClusterLayer";id.defaultProps=CT;const lo=Math.PI/180,cA=new Float32Array(16),W0=new Float32Array(12);function X0(s,e,t){const n=e[0]*lo,i=e[1]*lo,A=e[2]*lo,l=Math.sin(A),h=Math.sin(n),g=Math.sin(i),B=Math.cos(A),C=Math.cos(n),y=Math.cos(i),E=t[0],T=t[1],x=t[2];s[0]=E*y*C,s[1]=E*g*C,s[2]=E*-h,s[3]=T*(-g*B+y*h*l),s[4]=T*(y*B+g*h*l),s[5]=T*C*l,s[6]=x*(g*l+y*h*B),s[7]=x*(-y*l+g*h*B),s[8]=x*C*B}function Y0(s){return s[0]=s[0],s[1]=s[1],s[2]=s[2],s[3]=s[4],s[4]=s[5],s[5]=s[6],s[6]=s[8],s[7]=s[9],s[8]=s[10],s[9]=s[12],s[10]=s[13],s[11]=s[14],s.subarray(0,12)}const Ad={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrixCol0:{size:3,elementOffset:0},instanceModelMatrixCol1:{size:3,elementOffset:3},instanceModelMatrixCol2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(s,{startRow:e,endRow:t}){const{data:n,getOrientation:i,getScale:A,getTranslation:l,getTransformMatrix:h}=this.props,g=Array.isArray(h),B=g&&h.length===16,C=Array.isArray(A),y=Array.isArray(i),E=Array.isArray(l),T=B||!g&&!!h(n[0]);T?s.constant=B:s.constant=y&&C&&E;const x=s.value;if(s.constant){let F;T?(cA.set(h),F=Y0(cA)):(F=W0,X0(F,i,A),F.set(l,9)),s.value=new Float32Array(F)}else{let F=e*s.size;const{iterable:N,objectInfo:R}=cs(n,e,t);for(const Q of N){R.index++;let Y;if(T)cA.set(B?h:h(Q,R)),Y=Y0(cA);else{Y=W0;const se=y?i:i(Q,R),re=C?A:A(Q,R);X0(Y,se,re),Y.set(E?l:l(Q,R),9)}x[F++]=Y[0],x[F++]=Y[1],x[F++]=Y[2],x[F++]=Y[3],x[F++]=Y[4],x[F++]=Y[5],x[F++]=Y[6],x[F++]=Y[7],x[F++]=Y[8],x[F++]=Y[9],x[F++]=Y[10],x[F++]=Y[11]}}}};function rd(s,e){return e===pt.CARTESIAN||e===pt.METER_OFFSETS||e===pt.DEFAULT&&!s.isGeospatial}const $0=`uniform simpleMeshUniforms {
  float sizeScale;
  bool composeModelMatrix;
  bool hasTexture;
  bool flatShading;
} simpleMesh;
`,_T={name:"simpleMesh",vs:$0,fs:$0,uniformTypes:{sizeScale:"f32",composeModelMatrix:"f32",hasTexture:"f32",flatShading:"f32"}},yT=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = texCoords;
geometry.pickingColor = instancePickingColors;
vTexCoord = texCoords;
cameraPosition = project.cameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale + instanceTranslation;
if (simpleMesh.composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
geometry.position = position_commonspace;
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
}
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,bT=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform sampler2D sampler;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
geometry.uv = vTexCoord;
vec3 normal;
if (simpleMesh.flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;
DECKGL_FILTER_COLOR(color, geometry);
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * layer.opacity);
}
`;function uo(s){const e=s.positions||s.POSITION;at.assert(e,'no "postions" or "POSITION" attribute in mesh');const t=e.value.length/e.size;let n=s.COLOR_0||s.colors;n||(n={size:3,value:new Float32Array(t*3).fill(1)});let i=s.NORMAL||s.normals;i||(i={size:3,value:new Float32Array(t*3).fill(0)});let A=s.TEXCOORD_0||s.texCoords;return A||(A={size:2,value:new Float32Array(t*2).fill(0)}),{positions:e,colors:n,normals:i,texCoords:A}}function Z0(s){return s instanceof Ht?(s.attributes=uo(s.attributes),s):s.attributes?new Ht({...s,topology:"triangle-list",attributes:uo(s.attributes)}):new Ht({topology:"triangle-list",attributes:uo(s)})}const ET=[0,0,0,255],TT={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:s=>s.position},getColor:{type:"accessor",value:ET},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0,value:null}};class Ii extends sn{getShaders(){return super.getShaders({vs:yT,fs:bT,modules:[St,ba,fn,_T]})}getBounds(){var n;if(this.props._instanced)return super.getBounds();let e=this.state.positionBounds;if(e)return e;const{mesh:t}=this.props;if(!t)return null;if(e=(n=t.header)==null?void 0:n.boundingBox,!e){const{attributes:i}=Z0(t);i.POSITION=i.POSITION||i.positions,e=Ca(i)}return this.state.positionBounds=e,e}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:"float64",fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:"unorm8",transition:!0,size:this.props.colorFormat.length,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:Ad}),this.setState({emptyTexture:this.context.device.createTexture({data:new Uint8Array(4),width:1,height:1})})}updateState(e){var A;super.updateState(e);const{props:t,oldProps:n,changeFlags:i}=e;if(t.mesh!==n.mesh||i.extensionsChanged){if(this.state.positionBounds=null,(A=this.state.model)==null||A.destroy(),t.mesh){this.state.model=this.getModel(t.mesh);const l=t.mesh.attributes||t.mesh;this.setState({hasNormals:!!(l.NORMAL||l.normals)})}this.getAttributeManager().invalidateAll()}t.texture!==n.texture&&t.texture instanceof u1&&this.setTexture(t.texture),this.state.model&&this.state.model.setTopology(this.props.wireframe?"line-strip":"triangle-list")}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw({uniforms:e}){const{model:t}=this.state;if(!t)return;const{viewport:n,renderPass:i}=this.context,{sizeScale:A,coordinateSystem:l,_instanced:h}=this.props,g={sizeScale:A,composeModelMatrix:!h||rd(n,l),flatShading:!this.state.hasNormals};t.shaderInputs.setProps({simpleMesh:g}),t.draw(i)}get isLoaded(){var e;return!!((e=this.state)!=null&&e.model&&super.isLoaded)}getModel(e){const t=new Ct(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:Z0(e),isInstanced:!0}),{texture:n}=this.props,{emptyTexture:i}=this.state,A={sampler:n||i,hasTexture:!!n};return t.shaderInputs.setProps({simpleMesh:A}),t}setTexture(e){const{emptyTexture:t,model:n}=this.state;if(n){const i={sampler:e||t,hasTexture:!!e};n.shaderInputs.setProps({simpleMesh:i})}}}Ii.defaultProps=TT;Ii.layerName="SimpleMeshLayer";var an;(function(s){s[s.FUNC_ADD=32774]="FUNC_ADD",s[s.ONE=1]="ONE",s[s.SRC_ALPHA=770]="SRC_ALPHA",s[s.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",s[s.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",s[s.LINEAR=9729]="LINEAR",s[s.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",s[s.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL"})(an||(an={}));function od(s,e,t,n){const i={defines:{MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},bindings:{},uniforms:{camera:[0,0,0],metallicRoughnessValues:[1,1]},parameters:{},glParameters:{},generatedTextures:[]};i.defines.USE_TEX_LOD=1;const{imageBasedLightingEnvironment:A}=n;return A&&(i.bindings.pbr_diffuseEnvSampler=A.diffuseEnvSampler.texture,i.bindings.pbr_specularEnvSampler=A.specularEnvSampler.texture,i.bindings.pbr_BrdfLUT=A.brdfLutTexture.texture,i.uniforms.scaleIBLAmbient=[1,1]),n!=null&&n.pbrDebug&&(i.defines.PBR_DEBUG=1,i.uniforms.scaleDiffBaseMR=[0,0,0,0],i.uniforms.scaleFGDSpec=[0,0,0,0]),t.NORMAL&&(i.defines.HAS_NORMALS=1),t.TANGENT&&(n!=null&&n.useTangents)&&(i.defines.HAS_TANGENTS=1),t.TEXCOORD_0&&(i.defines.HAS_UV=1),n!=null&&n.imageBasedLightingEnvironment&&(i.defines.USE_IBL=1),n!=null&&n.lights&&(i.defines.USE_LIGHTS=1),e&&vT(s,e,i),i}function vT(s,e,t){if(t.uniforms.unlit=!!e.unlit,e.pbrMetallicRoughness&&IT(s,e.pbrMetallicRoughness,t),e.normalTexture){yi(s,e.normalTexture,"pbr_normalSampler","HAS_NORMALMAP",t);const{scale:n=1}=e.normalTexture;t.uniforms.normalScale=n}if(e.occlusionTexture){yi(s,e.occlusionTexture,"pbr_occlusionSampler","HAS_OCCLUSIONMAP",t);const{strength:n=1}=e.occlusionTexture;t.uniforms.occlusionStrength=n}switch(e.emissiveTexture&&(yi(s,e.emissiveTexture,"pbr_emissiveSampler","HAS_EMISSIVEMAP",t),t.uniforms.emissiveFactor=e.emissiveFactor||[0,0,0]),e.alphaMode){case"MASK":const{alphaCutoff:n=.5}=e;t.defines.ALPHA_CUTOFF=1,t.uniforms.alphaCutoff=n;break;case"BLEND":bi.warn("glTF BLEND alphaMode might not work well because it requires mesh sorting")(),t.parameters.blendColorOperation="add",t.parameters.blendColorSrcFactor="src-alpha",t.parameters.blendColorDstFactor="one-minus-src-alpha",t.parameters.blendAlphaOperation="add",t.parameters.blendAlphaSrcFactor="one",t.parameters.blendAlphaDstFactor="one-minus-src-alpha",t.glParameters.blend=!0,t.glParameters.blendEquation=an.FUNC_ADD,t.glParameters.blendFunc=[an.SRC_ALPHA,an.ONE_MINUS_SRC_ALPHA,an.ONE,an.ONE_MINUS_SRC_ALPHA];break}}function IT(s,e,t){e.baseColorTexture&&yi(s,e.baseColorTexture,"pbr_baseColorSampler","HAS_BASECOLORMAP",t),t.uniforms.baseColorFactor=e.baseColorFactor||[1,1,1,1],e.metallicRoughnessTexture&&yi(s,e.metallicRoughnessTexture,"pbr_metallicRoughnessSampler","HAS_METALROUGHNESSMAP",t);const{metallicFactor:n=1,roughnessFactor:i=1}=e;t.uniforms.metallicRoughnessValues=[n,i]}function yi(s,e,t,n=null,i){var C,y;const A=((y=(C=e==null?void 0:e.texture)==null?void 0:C.sampler)==null?void 0:y.parameters)||{},l=e.texture.source.image;let h,g={};l.compressed?(h=l,g={[an.TEXTURE_MIN_FILTER]:l.data.length>1?an.LINEAR_MIPMAP_NEAREST:an.LINEAR}):h={data:l};const B=s.createTexture({id:e.uniformName||e.id,parameters:{...A,...g},pixelStore:{[an.UNPACK_FLIP_Y_WEBGL]:!1},...h});i.bindings[t]=B,n&&(i.defines[n]=1),i.generatedTextures.push(B)}const MT={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},wT={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};class ST{constructor(e){G(this,"name");G(this,"startTime",0);G(this,"playing",!0);G(this,"speed",1);G(this,"channels",[]);Object.assign(this,e)}animate(e){if(!this.playing)return;const n=(e/1e3-this.startTime)*this.speed;this.channels.forEach(({sampler:i,target:A,path:l})=>{OT(n,i,A,l),PT(A,A._node)})}}class xT{constructor(e){G(this,"animations");this.animations=e.animations.map((t,n)=>{const i=t.name||`Animation-${n}`,A=t.samplers.map(({input:h,interpolation:g="LINEAR",output:B})=>({input:q0(e.accessors[h]),interpolation:g,output:q0(e.accessors[B])})),l=t.channels.map(({sampler:h,target:g})=>({sampler:A[h],target:e.nodes[g.node],path:g.path}));return new ST({name:i,channels:l})})}animate(e){this.setTime(e)}setTime(e){this.animations.forEach(t=>t.animate(e))}getAnimations(){return this.animations}}function q0(s){if(!s._animation){const e=wT[s.componentType],t=MT[s.type],n=t*s.count,{buffer:i,byteOffset:A}=s.bufferView.data,l=new e(i,A+(s.byteOffset||0),n);if(t===1)s._animation=Array.from(l);else{const h=[];for(let g=0;g<l.length;g+=t)h.push(Array.from(l.slice(g,g+t)));s._animation=h}}return s._animation}const DT=new Fe;function PT(s,e){if(e.matrix.identity(),s.translation&&e.matrix.translate(s.translation),s.rotation){const t=DT.fromQuaternion(s.rotation);e.matrix.multiplyRight(t)}s.scale&&e.matrix.scale(s.scale)}const fo=new Ti;function FT(s,e,t,n,i){if(e==="rotation"){fo.slerp({start:t,target:n,ratio:i});for(let A=0;A<fo.length;A++)s[e][A]=fo[A]}else for(let A=0;A<t.length;A++)s[e][A]=i*n[A]+(1-i)*t[A]}function LT(s,e,{p0:t,outTangent0:n,inTangent1:i,p1:A,tDiff:l,ratio:h}){for(let g=0;g<s[e].length;g++){const B=n[g]*l,C=i[g]*l;s[e][g]=(2*Math.pow(h,3)-3*Math.pow(h,2)+1)*t[g]+(Math.pow(h,3)-2*Math.pow(h,2)+h)*B+(-2*Math.pow(h,3)+3*Math.pow(h,2))*A[g]+(Math.pow(h,3)-Math.pow(h,2))*C}}function RT(s,e,t){for(let n=0;n<t.length;n++)s[e][n]=t[n]}function OT(s,{input:e,interpolation:t,output:n},i,A){const l=e[e.length-1],h=s%l,g=e.findIndex(E=>E>=h),B=Math.max(0,g-1);if(!Array.isArray(i[A]))switch(A){case"translation":i[A]=[0,0,0];break;case"rotation":i[A]=[0,0,0,1];break;case"scale":i[A]=[1,1,1];break;default:bi.warn(`Bad animation path ${A}`)()}const C=e[B],y=e[g];switch(t){case"STEP":RT(i,A,n[B]);break;case"LINEAR":if(y>C){const E=(h-C)/(y-C);FT(i,A,n[B],n[g],E)}break;case"CUBICSPLINE":if(y>C){const E=(h-C)/(y-C),T=y-C,x=n[3*B+1],F=n[3*B+2],N=n[3*g+0],R=n[3*g+1];LT(i,A,{p0:x,outTangent0:F,inTangent1:N,p1:R,tDiff:T,ratio:E})}break;default:bi.warn(`Interpolation ${t} not supported`)();break}}const GT=`
layout(0) positions: vec4; // in vec4 POSITION;

  #ifdef HAS_NORMALS
    in vec4 normals; // in vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    in vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // in vec2 TEXCOORD_0;
    in vec2 texCoords;
  #endif

@vertex
  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * positions;
  }

@fragment
  out vec4 fragmentColor;

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`,NT=`#version 300 es

  // in vec4 POSITION;
  in vec4 positions;

  #ifdef HAS_NORMALS
    // in vec4 NORMAL;
    in vec4 normals;
  #endif

  #ifdef HAS_TANGENTS
    in vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // in vec2 TEXCOORD_0;
    in vec2 texCoords;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = pbrProjection.modelViewProjectionMatrix * positions;
  }
`,UT=`#version 300 es
  out vec4 fragmentColor;

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`;function HT(s,e){const{id:t,geometry:n,material:i,vertexCount:A,materialOptions:l,modelOptions:h}=e,g=od(s,i,n.attributes,l);bi.info(4,"createGLTFModel defines: ",g.defines)();const B=[],C={depthWriteEnabled:!0,depthCompare:"less",depthFormat:"depth24plus",cullMode:"back"},y={id:t,source:GT,vs:NT,fs:UT,geometry:n,topology:n.topology,vertexCount:A,modules:[Ea],...h,defines:{...g.defines,...h.defines},parameters:{...C,...g.parameters,...h.parameters}},E=new Ct(s,y),{camera:T,...x}={...g.uniforms,...h.uniforms,...g.bindings,...h.bindings};return E.shaderInputs.setProps({pbrMaterial:x,pbrProjection:{camera:T}}),new Wo({managedResources:B,model:E})}var ts;(function(s){s[s.POINTS=0]="POINTS",s[s.LINES=1]="LINES",s[s.LINE_LOOP=2]="LINE_LOOP",s[s.LINE_STRIP=3]="LINE_STRIP",s[s.TRIANGLES=4]="TRIANGLES",s[s.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",s[s.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(ts||(ts={}));function kT(s){switch(s){case ts.POINTS:return"point-list";case ts.LINES:return"line-list";case ts.LINE_STRIP:return"line-strip";case ts.TRIANGLES:return"triangle-list";case ts.TRIANGLE_STRIP:return"triangle-strip";default:throw new Error(String(s))}}const JT={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class VT{constructor(e,t={}){G(this,"device");G(this,"options");G(this,"gltf");this.device=e,this.options={...JT,...t}}instantiate(e){return this.gltf=ea(e),(this.gltf.scenes||[]).map(n=>this.createScene(n))}createAnimator(){return Array.isArray(this.gltf.animations)?new xT(this.gltf):null}createScene(e){const n=(e.nodes||[]).map(A=>this.createNode(A));return new Js({id:e.name||e.id,children:n})}createNode(e){if(!e._node){const i=(e.children||[]).map(l=>this.createNode(l));e.mesh&&i.push(this.createMesh(e.mesh));const A=new Js({id:e.name||e.id,children:i});if(e.matrix)A.setMatrix(e.matrix);else{if(A.matrix.identity(),e.translation&&A.matrix.translate(e.translation),e.rotation){const l=new Fe().fromQuaternion(e.rotation);A.matrix.multiplyRight(l)}e.scale&&A.matrix.scale(e.scale)}e._node=A}const t=this.gltf.nodes.find(n=>n.id===e.id);return t._node=e._node,e._node}createMesh(e){if(!e._mesh){const n=(e.primitives||[]).map((A,l)=>this.createPrimitive(A,l,e)),i=new Js({id:e.name||e.id,children:n});e._mesh=i}return e._mesh}createPrimitive(e,t,n){const i=e.name||`${n.name||n.id}-primitive-${t}`,A=kT(e.mode||4),l=e.indices?e.indices.count:this.getVertexCount(e.attributes),h=HT(this.device,{id:i,geometry:this.createGeometry(i,e,A),material:e.material,materialOptions:this.options,modelOptions:this.options.modelOptions,vertexCount:l});return h.bounds=[e.attributes.POSITION.min,e.attributes.POSITION.max],h}getVertexCount(e){throw new Error("getVertexCount not implemented")}createGeometry(e,t,n){const i={};for(const[A,l]of Object.entries(t.attributes)){const{components:h,size:g,value:B}=l;i[A]={size:g??h,value:B}}return new Ht({id:e,topology:n,indices:t.indices.value,attributes:i})}createBuffer(e,t){e.bufferView||(e.bufferView={});const{bufferView:n}=e;return n.lumaBuffers||(n.lumaBuffers={}),n.lumaBuffers[t]||(n.lumaBuffers[t]=this.device.createBuffer({id:`from-${n.id}`,data:n.data||e.value})),n.lumaBuffers[t]}createSampler(e){return e}needsPOT(){return!1}}function ea(s){if(ArrayBuffer.isView(s)||s instanceof ArrayBuffer||s instanceof ImageBitmap)return s;if(Array.isArray(s))return s.map(ea);if(s&&typeof s=="object"){const e={};for(const t in s)e[t]=ea(s[t]);return e}return s}function zT(s,e,t){const n=new VT(s,t),i=n.instantiate(e),A=n.createAnimator();return{scenes:i,animator:A}}function Qt(s,e){if(!s)throw new Error(e||"assert failed: gltf")}const ad={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},cd={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},eu=["SCALAR","VEC2","VEC3","VEC4"],jT=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],QT=new Map(jT),KT={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},WT={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},XT={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function ld(s){return eu[s-1]||eu[0]}function fr(s){const e=QT.get(s.constructor);if(!e)throw new Error("Illegal typed array");return e}function Va(s,e){const t=XT[s.componentType],n=KT[s.type],i=WT[s.componentType],A=s.count*n,l=s.count*n*i;Qt(l>=0&&l<=e.byteLength);const h=cd[s.componentType],g=ad[s.type];return{ArrayType:t,length:A,byteLength:l,componentByteSize:h,numberOfComponentsInElement:g}}function YT(s,e,t){const n=s.bufferViews[t];Qt(n);const i=n.buffer,A=e[i];Qt(A);const l=(n.byteOffset||0)+A.byteOffset;return new Uint8Array(A.arrayBuffer,l,n.byteLength)}function $T(s,e,t){var F,N;const n=typeof t=="number"?(F=s.accessors)==null?void 0:F[t]:t;if(!n)throw new Error(`No gltf accessor ${JSON.stringify(t)}`);const i=(N=s.bufferViews)==null?void 0:N[n.bufferView||0];if(!i)throw new Error(`No gltf buffer view for accessor ${i}`);const{arrayBuffer:A,byteOffset:l}=e[i.buffer],h=(l||0)+(n.byteOffset||0)+(i.byteOffset||0),{ArrayType:g,length:B,componentByteSize:C,numberOfComponentsInElement:y}=Va(n,i),E=C*y,T=i.byteStride||E;if(typeof i.byteStride>"u"||i.byteStride===E)return new g(A,h,B);const x=new g(B);for(let R=0;R<n.count;R++){const Q=new g(A,h+R*T,y);x.set(Q,R*y)}return x}function ZT(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}let mt=class{constructor(e){G(this,"gltf");G(this,"sourceBuffers");G(this,"byteLength");this.gltf={json:(e==null?void 0:e.json)||ZT(),buffers:(e==null?void 0:e.buffers)||[],images:(e==null?void 0:e.images)||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){const t=this.getUsedExtensions().find(i=>i===e),n=this.getRequiredExtensions().find(i=>i===e);return typeof t=="string"||typeof n=="string"}getExtension(e){const t=this.getUsedExtensions().find(i=>i===e),n=this.json.extensions||{};return t?n[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(n=>n===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if(typeof t=="object")return t;const n=this.json[e]&&this.json[e][t];if(!n)throw new Error(`glTF file error: Could not find ${e}[${t}]`);return n}getTypedArrayForBufferView(e){e=this.getBufferView(e);const t=e.buffer,n=this.gltf.buffers[t];Qt(n);const i=(e.byteOffset||0)+n.byteOffset;return new Uint8Array(n.arrayBuffer,i,e.byteLength)}getTypedArrayForAccessor(e){const t=this.getAccessor(e);return $T(this.gltf.json,this.gltf.buffers,t)}getTypedArrayForImageData(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),i=this.getBuffer(t.buffer).data,A=t.byteOffset||0;return new Uint8Array(i,A,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,n){return e.extensions=e.extensions||{},e.extensions[t]=n,this.registerUsedExtension(t),this}setObjectExtension(e,t,n){const i=e.extensions||{};i[t]=n}removeObjectExtension(e,t){const n=(e==null?void 0:e.extensions)||{};if(n[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const i=this.json.extensionsRemoved;i.includes(t)||i.push(t)}delete n[t]}addExtension(e,t={}){return Qt(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e,t={}){return Qt(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(t=>t===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(t=>t===e)||this.json.extensionsRequired.push(e)}removeExtension(e){var t;if((t=this.json.extensions)!=null&&t[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const n=this.json.extensionsRemoved;n.includes(e)||n.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:t}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:t}),this.json.scenes.length-1}addNode(e){const{meshIndex:t,matrix:n}=e;this.json.nodes=this.json.nodes||[];const i={mesh:t};return n&&(i.matrix=n),this.json.nodes.push(i),this.json.nodes.length-1}addMesh(e){const{attributes:t,indices:n,material:i,mode:A=4}=e,h={primitives:[{attributes:this._addAttributes(t),mode:A}]};if(n){const g=this._addIndices(n);h.primitives[0].indices=g}return Number.isFinite(i)&&(h.primitives[0].material=i),this.json.meshes=this.json.meshes||[],this.json.meshes.push(h),this.json.meshes.length-1}addPointCloud(e){const n={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(n),this.json.meshes.length-1}addImage(e,t){const n=Hf(e),i=t||(n==null?void 0:n.mimeType),l={bufferView:this.addBufferView(e),mimeType:i};return this.json.images=this.json.images||[],this.json.images.push(l),this.json.images.length-1}addBufferView(e,t=0,n=this.byteLength){const i=e.byteLength;Qt(Number.isFinite(i)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const A={buffer:t,byteOffset:n,byteLength:i};return this.byteLength+=Dn(i,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(A),this.json.bufferViews.length-1}addAccessor(e,t){const n={bufferView:e,type:ld(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(n),this.json.accessors.length-1}addBinaryBuffer(e,t={size:3}){const n=this.addBufferView(e);let i={min:t.min,max:t.max};(!i.min||!i.max)&&(i=this._getAccessorMinMax(e,t.size));const A={size:t.size,componentType:fr(e),count:Math.round(e.length/t.size),min:i.min,max:i.max};return this.addAccessor(n,Object.assign(A,t))}addTexture(e){const{imageIndex:t}=e,n={source:t};return this.json.textures=this.json.textures||[],this.json.textures.push(n),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var A,l;const e=this.byteLength,t=new ArrayBuffer(e),n=new Uint8Array(t);let i=0;for(const h of this.sourceBuffers||[])i=Wf(h,n,i);(l=(A=this.json)==null?void 0:A.buffers)!=null&&l[0]?this.json.buffers[0].byteLength=e:this.json.buffers=[{byteLength:e}],this.gltf.binary=t,this.sourceBuffers=[t],this.gltf.buffers=[{arrayBuffer:t,byteOffset:0,byteLength:t.byteLength}]}_removeStringFromArray(e,t){let n=!0;for(;n;){const i=e.indexOf(t);i>-1?e.splice(i,1):n=!1}}_addAttributes(e={}){const t={};for(const n in e){const i=e[n],A=this._getGltfAttributeName(n),l=this.addBinaryBuffer(i.value,i);t[A]=l}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,t){const n={min:null,max:null};if(e.length<t)return n;n.min=[],n.max=[];const i=e.subarray(0,t);for(const A of i)n.min.push(A),n.max.push(A);for(let A=t;A<e.length;A+=t)for(let l=0;l<t;l++)n.min[0+l]=Math.min(n.min[0+l],e[A+l]),n.max[0+l]=Math.max(n.max[0+l],e[A+l]);return n}};function tu(s){return(s%1+1)%1}const ud={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},qT={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},fd={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function za(s,e){return fd[e]*ud[s]}function hr(s,e,t,n){if(t!=="UINT8"&&t!=="UINT16"&&t!=="UINT32"&&t!=="UINT64")return null;const i=s.getTypedArrayForBufferView(e),A=dr(i,"SCALAR",t,n+1);return A instanceof BigInt64Array||A instanceof BigUint64Array?null:A}function dr(s,e,t,n=1){const i=ud[e],A=qT[t],l=fd[t],h=n*i,g=h*l;let B=s.buffer,C=s.byteOffset;return C%l!==0&&(B=new Uint8Array(B).slice(C,C+g).buffer,C=0),new A(B,C,h)}function ja(s,e,t){var B,C,y,E,T;const n=`TEXCOORD_${e.texCoord||0}`,i=t.attributes[n],A=s.getTypedArrayForAccessor(i),l=s.gltf.json,h=e.index,g=(C=(B=l.textures)==null?void 0:B[h])==null?void 0:C.source;if(typeof g<"u"){const x=(E=(y=l.images)==null?void 0:y[g])==null?void 0:E.mimeType,F=(T=s.gltf.images)==null?void 0:T[g];if(F&&typeof F.width<"u"){const N=[];for(let R=0;R<A.length;R+=2){const Q=ev(F,x,A,R,e.channels);N.push(Q)}return N}}return[]}function hd(s,e,t,n,i){if(!(t!=null&&t.length))return;const A=[];for(const C of t){let y=n.findIndex(E=>E===C);y===-1&&(y=n.push(C)-1),A.push(y)}const l=new Uint32Array(A),h=s.gltf.buffers.push({arrayBuffer:l.buffer,byteOffset:l.byteOffset,byteLength:l.byteLength})-1,g=s.addBufferView(l,h,0),B=s.addAccessor(g,{size:1,componentType:fr(l),count:l.length});i.attributes[e]=B}function ev(s,e,t,n,i=[0]){const A={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},l=t[n],h=t[n+1];let g=1;e&&(e.indexOf("image/jpeg")!==-1||e.indexOf("image/png")!==-1)&&(g=4);const B=tv(l,h,s,g);let C=0;for(const y of i){const E=typeof y=="number"?Object.values(A)[y]:A[y],T=B+E.offset,x=kf(s);if(x.data.length<=T)throw new Error(`${x.data.length} <= ${T}`);const F=x.data[T];C|=F<<E.shift}return C}function tv(s,e,t,n=1){const i=t.width,A=tu(s)*(i-1),l=Math.round(A),h=t.height,g=tu(e)*(h-1),B=Math.round(g),C=t.components?t.components:n;return(B*i+l)*C}function dd(s,e,t,n,i){const A=[];for(let l=0;l<e;l++){const h=t[l],g=t[l+1]-t[l];if(g+h>n)break;const B=h/i,C=g/i;A.push(s.slice(B,B+C))}return A}function gd(s,e,t){const n=[];for(let i=0;i<e;i++){const A=i*t;n.push(s.slice(A,A+t))}return n}function pd(s,e,t,n){if(t)throw new Error("Not implemented - arrayOffsets for strings is specified");if(n){const i=[],A=new TextDecoder("utf8");let l=0;for(let h=0;h<s;h++){const g=n[h+1]-n[h];if(g+l<=e.length){const B=e.subarray(l,g+l),C=A.decode(B);i.push(C),l+=g}}return i}return[]}const zs="EXT_mesh_features",nv=zs;async function sv(s,e){const t=new mt(s);Av(t,e)}function iv(s,e){const t=new mt(s);return ov(t),t.createBinaryChunk(),t.gltf}function Av(s,e){const t=s.gltf.json;if(t.meshes)for(const n of t.meshes)for(const i of n.primitives)rv(s,i,e)}function rv(s,e,t){var A,l,h;if(!((A=t==null?void 0:t.gltf)!=null&&A.loadBuffers))return;const n=(l=e.extensions)==null?void 0:l[zs],i=n==null?void 0:n.featureIds;if(i)for(const g of i){let B;if(typeof g.attribute<"u"){const C=`_FEATURE_ID_${g.attribute}`,y=e.attributes[C];B=s.getTypedArrayForAccessor(y)}else typeof g.texture<"u"&&((h=t==null?void 0:t.gltf)!=null&&h.loadImages)?B=ja(s,g.texture,e):B=[];g.data=B}}function ov(s,e){const t=s.gltf.json.meshes;if(t)for(const n of t)for(const i of n.primitives)cv(s,i)}function av(s,e,t,n){e.extensions||(e.extensions={});let i=e.extensions[zs];i||(i={featureIds:[]},e.extensions[zs]=i);const{featureIds:A}=i,l={featureCount:t.length,propertyTable:n,data:t};A.push(l),s.addObjectExtension(e,zs,i)}function cv(s,e){var i;const t=(i=e.extensions)==null?void 0:i[zs];if(!t)return;const n=t.featureIds;n.forEach((A,l)=>{if(A.data){const{accessorKey:h,index:g}=lv(e.attributes),B=new Uint32Array(A.data);n[l]={featureCount:B.length,propertyTable:A.propertyTable,attribute:g},s.gltf.buffers.push({arrayBuffer:B.buffer,byteOffset:B.byteOffset,byteLength:B.byteLength});const C=s.addBufferView(B),y=s.addAccessor(C,{size:1,componentType:fr(B),count:B.length});e.attributes[h]=y}})}function lv(s){const e="_FEATURE_ID_",t=Object.keys(s).filter(A=>A.indexOf(e)===0);let n=-1;for(const A of t){const l=Number(A.substring(e.length));l>n&&(n=l)}return n++,{accessorKey:`${e}${n}`,index:n}}const uv=Object.freeze(Object.defineProperty({__proto__:null,createExtMeshFeatures:av,decode:sv,encode:iv,name:nv},Symbol.toStringTag,{value:"Module"})),Ws="EXT_structural_metadata",fv=Ws;async function hv(s,e){const t=new mt(s);gv(t,e)}function dv(s,e){const t=new mt(s);return Dv(t),t.createBinaryChunk(),t.gltf}function gv(s,e){var n,i;if(!((n=e.gltf)!=null&&n.loadBuffers))return;const t=s.getExtension(Ws);t&&((i=e.gltf)!=null&&i.loadImages&&pv(s,t),mv(s,t))}function pv(s,e){const t=e.propertyTextures,n=s.gltf.json;if(t&&n.meshes)for(const i of n.meshes)for(const A of i.primitives)Cv(s,t,A,e)}function mv(s,e){const t=e.schema;if(!t)return;const n=t.classes,i=e.propertyTables;if(n&&i)for(const A in n){const l=Bv(i,A);l&&yv(s,t,l)}}function Bv(s,e){for(const t of s)if(t.class===e)return t;return null}function Cv(s,e,t,n){var l;if(!e)return;const i=(l=t.extensions)==null?void 0:l[Ws],A=i==null?void 0:i.propertyTextures;if(A)for(const h of A){const g=e[h];_v(s,g,t,n)}}function _v(s,e,t,n){var A;if(!e.properties)return;n.dataAttributeNames||(n.dataAttributeNames=[]);const i=e.class;for(const l in e.properties){const h=`${i}_${l}`,g=(A=e.properties)==null?void 0:A[l];if(!g)continue;g.data||(g.data=[]);const B=g.data,C=ja(s,g,t);C!==null&&(hd(s,h,C,B,t),g.data=B,n.dataAttributeNames.push(h))}}function yv(s,e,t){var A,l;const n=(A=e.classes)==null?void 0:A[t.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${t.class}`);const i=t.count;for(const h in n.properties){const g=n.properties[h],B=(l=t.properties)==null?void 0:l[h];if(B){const C=bv(s,e,g,i,B);B.data=C}}}function bv(s,e,t,n,i){let A=[];const l=i.values,h=s.getTypedArrayForBufferView(l),g=Ev(s,t,i,n),B=Tv(s,i,n);switch(t.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{A=vv(t,n,h,g);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${t.type}`);case"STRING":{A=pd(n,h,g,B);break}case"ENUM":{A=Iv(e,t,n,h,g);break}default:throw new Error(`Unknown classProperty type ${t.type}`)}return A}function Ev(s,e,t,n){return e.array&&typeof e.count>"u"&&typeof t.arrayOffsets<"u"?hr(s,t.arrayOffsets,t.arrayOffsetType||"UINT32",n):null}function Tv(s,e,t){return typeof e.stringOffsets<"u"?hr(s,e.stringOffsets,e.stringOffsetType||"UINT32",t):null}function vv(s,e,t,n){const i=s.array,A=s.count,l=za(s.type,s.componentType),h=t.byteLength/l;let g;return s.componentType?g=dr(t,s.type,s.componentType,h):g=t,i?n?dd(g,e,n,t.length,l):A?gd(g,e,A):[]:g}function Iv(s,e,t,n,i){var y;const A=e.enumType;if(!A)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const l=(y=s.enums)==null?void 0:y[A];if(!l)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${A}`);const h=l.valueType||"UINT16",g=za(e.type,h),B=n.byteLength/g;let C=dr(n,e.type,h,B);if(C||(C=n),e.array){if(i)return Mv({valuesData:C,numberOfElements:t,arrayOffsets:i,valuesDataBytesLength:n.length,elementSize:g,enumEntry:l});const E=e.count;return E?wv(C,t,E,l):[]}return Qa(C,0,t,l)}function Mv(s){const{valuesData:e,numberOfElements:t,arrayOffsets:n,valuesDataBytesLength:i,elementSize:A,enumEntry:l}=s,h=[];for(let g=0;g<t;g++){const B=n[g],C=n[g+1]-n[g];if(C+B>i)break;const y=B/A,E=C/A,T=Qa(e,y,E,l);h.push(T)}return h}function wv(s,e,t,n){const i=[];for(let A=0;A<e;A++){const l=t*A,h=Qa(s,l,t,n);i.push(h)}return i}function Qa(s,e,t,n){const i=[];for(let A=0;A<t;A++)if(s instanceof BigInt64Array||s instanceof BigUint64Array)i.push("");else{const l=s[e+A],h=Sv(n,l);h?i.push(h.name):i.push("")}return i}function Sv(s,e){for(const t of s.values)if(t.value===e)return t;return null}const xv="schemaClassId";function Dv(s,e){var n,i;const t=s.getExtension(Ws);if(t&&t.propertyTables)for(const A of t.propertyTables){const l=A.class,h=(i=(n=t.schema)==null?void 0:n.classes)==null?void 0:i[l];A.properties&&h&&Pv(A,h,s)}}function Pv(s,e,t){for(const n in s.properties){const i=s.properties[n].data;if(i){const A=e.properties[n];if(A){const l=Ov(i,A,t);s.properties[n]=l}}}}function Fv(s,e,t=xv){let n=s.getExtension(Ws);n||(n=s.addExtension(Ws)),n.schema=Lv(e,t,n.schema);const i=Rv(e,t,n.schema);return n.propertyTables||(n.propertyTables=[]),n.propertyTables.push(i)-1}function Lv(s,e,t){const n=t??{id:"schema_id"},i={properties:{}};for(const A of s){const l={type:A.elementType,componentType:A.componentType};i.properties[A.name]=l}return n.classes={},n.classes[e]=i,n}function Rv(s,e,t){var l;const n={class:e,count:0};let i=0;const A=(l=t.classes)==null?void 0:l[e];for(const h of s){if(i===0&&(i=h.values.length),i!==h.values.length&&h.values.length)throw new Error("Illegal values in attributes");(A==null?void 0:A.properties[h.name])&&(n.properties||(n.properties={}),n.properties[h.name]={values:0,data:h.values})}return n.count=i,n}function Ov(s,e,t){const n={values:0};if(e.type==="STRING"){const{stringData:i,stringOffsets:A}=Uv(s);n.stringOffsets=ho(A,t),n.values=ho(i,t)}else if(e.type==="SCALAR"&&e.componentType){const i=Nv(s,e.componentType);n.values=ho(i,t)}return n}const Gv={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function Nv(s,e){const t=[];for(const i of s)t.push(Number(i));const n=Gv[e];if(!n)throw new Error("Illegal component type");return new n(t)}function Uv(s){const e=new TextEncoder,t=[];let n=0;for(const g of s){const B=e.encode(g);n+=B.length,t.push(B)}const i=new Uint8Array(n),A=[];let l=0;for(const g of t)i.set(g,l),A.push(l),l+=g.length;A.push(l);const h=new Uint32Array(A);return{stringData:i,stringOffsets:h}}function ho(s,e){return e.gltf.buffers.push({arrayBuffer:s.buffer,byteOffset:s.byteOffset,byteLength:s.byteLength}),e.addBufferView(s)}const Hv=Object.freeze(Object.defineProperty({__proto__:null,createExtStructuralMetadata:Fv,decode:hv,encode:dv,name:fv},Symbol.toStringTag,{value:"Module"})),md="EXT_feature_metadata",kv=md;async function Jv(s,e){const t=new mt(s);Vv(t,e)}function Vv(s,e){var n,i;if(!((n=e.gltf)!=null&&n.loadBuffers))return;const t=s.getExtension(md);t&&((i=e.gltf)!=null&&i.loadImages&&zv(s,t),jv(s,t))}function zv(s,e){const t=e.schema;if(!t)return;const n=t.classes,{featureTextures:i}=e;if(n&&i)for(const A in n){const l=n[A],h=Kv(i,A);h&&Xv(s,h,l)}}function jv(s,e){const t=e.schema;if(!t)return;const n=t.classes,i=e.featureTables;if(n&&i)for(const A in n){const l=Qv(i,A);l&&Wv(s,t,l)}}function Qv(s,e){for(const t in s){const n=s[t];if(n.class===e)return n}return null}function Kv(s,e){for(const t in s){const n=s[t];if(n.class===e)return n}return null}function Wv(s,e,t){var A,l;if(!t.class)return;const n=(A=e.classes)==null?void 0:A[t.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${t.class}`);const i=t.count;for(const h in n.properties){const g=n.properties[h],B=(l=t.properties)==null?void 0:l[h];if(B){const C=Yv(s,e,g,i,B);B.data=C}}}function Xv(s,e,t){var i;const n=e.class;for(const A in t.properties){const l=(i=e==null?void 0:e.properties)==null?void 0:i[A];if(l){const h=tI(s,l,n);l.data=h}}}function Yv(s,e,t,n,i){let A=[];const l=i.bufferView,h=s.getTypedArrayForBufferView(l),g=$v(s,t,i,n),B=Zv(s,t,i,n);return t.type==="STRING"||t.componentType==="STRING"?A=pd(n,h,g,B):qv(t)&&(A=eI(t,n,h,g)),A}function $v(s,e,t,n){return e.type==="ARRAY"&&typeof e.componentCount>"u"&&typeof t.arrayOffsetBufferView<"u"?hr(s,t.arrayOffsetBufferView,t.offsetType||"UINT32",n):null}function Zv(s,e,t,n){return typeof t.stringOffsetBufferView<"u"?hr(s,t.stringOffsetBufferView,t.offsetType||"UINT32",n):null}function qv(s){const e=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return e.includes(s.type)||typeof s.componentType<"u"&&e.includes(s.componentType)}function eI(s,e,t,n){const i=s.type==="ARRAY",A=s.componentCount,l="SCALAR",h=s.componentType||s.type,g=za(l,h),B=t.byteLength/g,C=dr(t,l,h,B);return i?n?dd(C,e,n,t.length,g):A?gd(C,e,A):[]:C}function tI(s,e,t){const n=s.gltf.json;if(!n.meshes)return[];const i=[];for(const A of n.meshes)for(const l of A.primitives)nI(s,t,e,i,l);return i}function nI(s,e,t,n,i){const A={channels:t.channels,...t.texture},l=ja(s,A,i);l&&hd(s,e,l,n,i)}const sI=Object.freeze(Object.defineProperty({__proto__:null,decode:Jv,name:kv},Symbol.toStringTag,{value:"Module"})),iI="4.3.2",AI="4.3.2",QA={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let nu;async function su(s){jf(s.modules);const e=Qf("basis");return e||(nu||(nu=rI(s)),await nu)}async function rI(s){let e=null,t=null;return[e,t]=await Promise.all([await kt(QA.TRANSCODER,"textures",s),await kt(QA.TRANSCODER_WASM,"textures",s)]),e=e||globalThis.BASIS,await oI(e,t)}function oI(s,e){const t={};return e&&(t.wasmBinary=e),new Promise(n=>{s(t).then(i=>{const{BasisFile:A,initializeBasis:l}=i;l(),n({BasisFile:A})})})}let go;async function iu(s){const e=s.modules||{};return e.basisEncoder?e.basisEncoder:(go=go||aI(s),await go)}async function aI(s){let e=null,t=null;return[e,t]=await Promise.all([await kt(QA.ENCODER,"textures",s),await kt(QA.ENCODER_WASM,"textures",s)]),e=e||globalThis.BASIS,await cI(e,t)}function cI(s,e){const t={};return e&&(t.wasmBinary=e),new Promise(n=>{s(t).then(i=>{const{BasisFile:A,KTX2File:l,initializeBasis:h,BasisEncoder:g}=i;h(),n({BasisFile:A,KTX2File:l,BasisEncoder:g})})})}const Ss={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_ASTC_4X4_KHR:37808},lI=["","WEBKIT_","MOZ_"],Au={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let lA=null;function uI(s){if(!lA){s=s||fI()||void 0,lA=new Set;for(const e of lI)for(const t in Au)if(s&&s.getExtension(`${e}${t}`)){const n=Au[t];lA.add(n)}}return lA}function fI(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}const Jt=[171,75,84,88,32,50,48,187,13,10,26,10];function hI(s){const e=new Uint8Array(s);return!(e.byteLength<Jt.length||e[0]!==Jt[0]||e[1]!==Jt[1]||e[2]!==Jt[2]||e[3]!==Jt[3]||e[4]!==Jt[4]||e[5]!==Jt[5]||e[6]!==Jt[6]||e[7]!==Jt[7]||e[8]!==Jt[8]||e[9]!==Jt[9]||e[10]!==Jt[10]||e[11]!==Jt[11])}const dI={etc1:{basisFormat:0,compressed:!0,format:Ss.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:Ss.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:Ss.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:Ss.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:Ss.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:Ss.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function gI(s,e){if(e.basis.containerFormat==="auto"){if(hI(s)){const n=await iu(e);return ru(n.KTX2File,s,e)}const{BasisFile:t}=await su(e);return po(t,s,e)}switch(e.basis.module){case"encoder":const t=await iu(e);switch(e.basis.containerFormat){case"ktx2":return ru(t.KTX2File,s,e);case"basis":default:return po(t.BasisFile,s,e)}case"transcoder":default:const{BasisFile:n}=await su(e);return po(n,s,e)}}function po(s,e,t){const n=new s(new Uint8Array(e));try{if(!n.startTranscoding())throw new Error("Failed to start basis transcoding");const i=n.getNumImages(),A=[];for(let l=0;l<i;l++){const h=n.getNumLevels(l),g=[];for(let B=0;B<h;B++)g.push(pI(n,l,B,t));A.push(g)}return A}finally{n.close(),n.delete()}}function pI(s,e,t,n){const i=s.getImageWidth(e,t),A=s.getImageHeight(e,t),l=s.getHasAlpha(),{compressed:h,format:g,basisFormat:B}=Bd(n,l),C=s.getImageTranscodedSizeInBytes(e,t,B),y=new Uint8Array(C);if(!s.transcodeImage(y,e,t,B,0,0))throw new Error("failed to start Basis transcoding");return{width:i,height:A,data:y,compressed:h,format:g,hasAlpha:l}}function ru(s,e,t){const n=new s(new Uint8Array(e));try{if(!n.startTranscoding())throw new Error("failed to start KTX2 transcoding");const i=n.getLevels(),A=[];for(let l=0;l<i;l++)A.push(mI(n,l,t));return[A]}finally{n.close(),n.delete()}}function mI(s,e,t){const{alphaFlag:n,height:i,width:A}=s.getImageLevelInfo(e,0,0),{compressed:l,format:h,basisFormat:g}=Bd(t,n),B=s.getImageTranscodedSizeInBytes(e,0,0,g),C=new Uint8Array(B);if(!s.transcodeImage(C,e,0,0,g,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:A,height:i,data:C,compressed:l,levelSize:B,hasAlpha:n,format:h}}function Bd(s,e){let t=s&&s.basis&&s.basis.format;return t==="auto"&&(t=Cd()),typeof t=="object"&&(t=e?t.alpha:t.noAlpha),t=t.toLowerCase(),dI[t]}function Cd(){const s=uI();return s.has("astc")?"astc-4x4":s.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:s.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:s.has("etc1")?"etc1":s.has("etc2")?"etc2":"rgb565"}const BI={dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:AI,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},CI={...BI,parse:gI},Xs=!0,ou=1735152710,Ka=12,KA=8,_I=1313821514,yI=5130562,bI=0,EI=0,TI=1;function vI(s,e=0){return`${String.fromCharCode(s.getUint8(e+0))}${String.fromCharCode(s.getUint8(e+1))}${String.fromCharCode(s.getUint8(e+2))}${String.fromCharCode(s.getUint8(e+3))}`}function II(s,e=0,t={}){const n=new DataView(s),{magic:i=ou}=t,A=n.getUint32(e,!1);return A===i||A===ou}function MI(s,e,t=0,n={}){const i=new DataView(e),A=vI(i,t+0),l=i.getUint32(t+4,Xs),h=i.getUint32(t+8,Xs);switch(Object.assign(s,{header:{byteOffset:t,byteLength:h,hasBinChunk:!1},type:A,version:l,json:{},binChunks:[]}),t+=Ka,s.version){case 1:return wI(s,i,t);case 2:return SI(s,i,t,n={});default:throw new Error(`Invalid GLB version ${s.version}. Only supports version 1 and 2.`)}}function wI(s,e,t){nt(s.header.byteLength>Ka+KA);const n=e.getUint32(t+0,Xs),i=e.getUint32(t+4,Xs);return t+=KA,nt(i===bI),ta(s,e,t,n),t+=n,t+=na(s,e,t,s.header.byteLength),t}function SI(s,e,t,n){return nt(s.header.byteLength>Ka+KA),xI(s,e,t,n),t+s.header.byteLength}function xI(s,e,t,n){for(;t+8<=s.header.byteLength;){const i=e.getUint32(t+0,Xs),A=e.getUint32(t+4,Xs);switch(t+=KA,A){case _I:ta(s,e,t,i);break;case yI:na(s,e,t,i);break;case EI:n.strict||ta(s,e,t,i);break;case TI:n.strict||na(s,e,t,i);break}t+=Dn(i,4)}return t}function ta(s,e,t,n){const i=new Uint8Array(e.buffer,t,n),l=new TextDecoder("utf8").decode(i);return s.json=JSON.parse(l),Dn(n,4)}function na(s,e,t,n){return s.header.hasBinChunk=!0,s.binChunks.push({byteOffset:t,byteLength:n,arrayBuffer:e.buffer}),Dn(n,4)}function _d(s,e){if(s.startsWith("data:")||s.startsWith("http:")||s.startsWith("https:"))return s;const n=e.baseUri||e.uri;if(!n)throw new Error(`'baseUri' must be provided to resolve relative url ${s}`);return n.substr(0,n.lastIndexOf("/")+1)+s}const DI="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",PI="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",FI=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),LI=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),RI={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},OI={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function GI(s,e,t,n,i,A="NONE"){const l=await NI();kI(l,l.exports[OI[i]],s,e,t,n,l.exports[RI[A||"NONE"]])}let mo;async function NI(){return mo||(mo=UI()),mo}async function UI(){let s=DI;WebAssembly.validate(FI)&&(s=PI,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(HI(s),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function HI(s){const e=new Uint8Array(s.length);for(let n=0;n<s.length;++n){const i=s.charCodeAt(n);e[n]=i>96?i-71:i>64?i-65:i>47?i+4:i>46?63:62}let t=0;for(let n=0;n<s.length;++n)e[t++]=e[n]<60?LI[e[n]]:(e[n]-60)*64+e[++n];return e.buffer.slice(0,t)}function kI(s,e,t,n,i,A,l){const h=s.exports.sbrk,g=n+3&-4,B=h(g*i),C=h(A.length),y=new Uint8Array(s.exports.memory.buffer);y.set(A,C);const E=e(B,n,i,C,A.length);if(E===0&&l&&l(B,g,i),t.set(y.subarray(B,B+n*i)),h(B-h(0)),E!==0)throw new Error(`Malformed buffer data: ${E}`)}const WA="EXT_meshopt_compression",JI=WA;async function VI(s,e){var i,A;const t=new mt(s);if(!((i=e==null?void 0:e.gltf)!=null&&i.decompressMeshes)||!((A=e.gltf)!=null&&A.loadBuffers))return;const n=[];for(const l of s.json.bufferViews||[])n.push(zI(t,l));await Promise.all(n),t.removeExtension(WA)}async function zI(s,e){const t=s.getObjectExtension(e,WA);if(t){const{byteOffset:n=0,byteLength:i=0,byteStride:A,count:l,mode:h,filter:g="NONE",buffer:B}=t,C=s.gltf.buffers[B],y=new Uint8Array(C.arrayBuffer,C.byteOffset+n,i),E=new Uint8Array(s.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);await GI(E,l,A,y,h,g),s.removeObjectExtension(e,WA)}}const jI=Object.freeze(Object.defineProperty({__proto__:null,decode:VI,name:JI},Symbol.toStringTag,{value:"Module"})),Fs="EXT_texture_webp",QI=Fs;function KI(s,e){const t=new mt(s);if(!$f("image/webp")){if(t.getRequiredExtensions().includes(Fs))throw new Error(`gltf: Required extension ${Fs} not supported by browser`);return}const{json:n}=t;for(const i of n.textures||[]){const A=t.getObjectExtension(i,Fs);A&&(i.source=A.source),t.removeObjectExtension(i,Fs)}t.removeExtension(Fs)}const WI=Object.freeze(Object.defineProperty({__proto__:null,name:QI,preprocess:KI},Symbol.toStringTag,{value:"Module"})),MA="KHR_texture_basisu",XI=MA;function YI(s,e){const t=new mt(s),{json:n}=t;for(const i of n.textures||[]){const A=t.getObjectExtension(i,MA);A&&(i.source=A.source,t.removeObjectExtension(i,MA))}t.removeExtension(MA)}const $I=Object.freeze(Object.defineProperty({__proto__:null,name:XI,preprocess:YI},Symbol.toStringTag,{value:"Module"})),ZI="4.3.2",qI={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:ZI,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function eM(s,e,t){const n=yd(e.metadata),i=[],A=tM(e.attributes);for(const l in s){const h=s[l],g=au(l,h,A[l]);i.push(g)}if(t){const l=au("indices",t);i.push(l)}return{fields:i,metadata:n}}function tM(s){const e={};for(const t in s){const n=s[t];e[n.name||"undefined"]=n}return e}function au(s,e,t){const n=t?yd(t.metadata):void 0;return Yf(s,e,n)}function yd(s){Object.entries(s);const e={};for(const t in s)e[`${t}.string`]=JSON.stringify(s[t]);return e}const cu={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},nM={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},sM=4;let iM=class{constructor(e){G(this,"draco");G(this,"decoder");G(this,"metadataQuerier");this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e,t={}){const n=new this.draco.DecoderBuffer;n.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(t);const i=this.decoder.GetEncodedGeometryType(n),A=i===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let l;switch(i){case this.draco.TRIANGULAR_MESH:l=this.decoder.DecodeBufferToMesh(n,A);break;case this.draco.POINT_CLOUD:l=this.decoder.DecodeBufferToPointCloud(n,A);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!l.ok()||!A.ptr){const E=`DRACO decompression failed: ${l.error_msg()}`;throw new Error(E)}const h=this._getDracoLoaderData(A,i,t),g=this._getMeshData(A,h,t),B=Ca(g.attributes),C=eM(g.attributes,h,g.indices);return{loader:"draco",loaderData:h,header:{vertexCount:A.num_points(),boundingBox:B},...g,schema:C}}finally{this.draco.destroy(n),A&&this.draco.destroy(A)}}_getDracoLoaderData(e,t,n){const i=this._getTopLevelMetadata(e),A=this._getDracoAttributes(e,n);return{geometry_type:t,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:i,attributes:A}}_getDracoAttributes(e,t){const n={};for(let i=0;i<e.num_attributes();i++){const A=this.decoder.GetAttribute(e,i),l=this._getAttributeMetadata(e,i);n[A.unique_id()]={unique_id:A.unique_id(),attribute_type:A.attribute_type(),data_type:A.data_type(),num_components:A.num_components(),byte_offset:A.byte_offset(),byte_stride:A.byte_stride(),normalized:A.normalized(),attribute_index:i,metadata:l};const h=this._getQuantizationTransform(A,t);h&&(n[A.unique_id()].quantization_transform=h);const g=this._getOctahedronTransform(A,t);g&&(n[A.unique_id()].octahedron_transform=g)}return n}_getMeshData(e,t,n){const i=this._getMeshAttributes(t,e,n);if(!i.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(n.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:i,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:i,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:i}}_getMeshAttributes(e,t,n){const i={};for(const A of Object.values(e.attributes)){const l=this._deduceAttributeName(A,n);A.name=l;const h=this._getAttributeValues(t,A);if(h){const{value:g,size:B}=h;i[l]={value:g,size:B,byteOffset:A.byte_offset,byteStride:A.byte_stride,normalized:A.normalized}}}return i}_getTriangleListIndices(e){const n=e.num_faces()*3,i=n*sM,A=this.draco._malloc(i);try{return this.decoder.GetTrianglesUInt32Array(e,i,A),new Uint32Array(this.draco.HEAPF32.buffer,A,n).slice()}finally{this.draco._free(A)}}_getTriangleStripIndices(e){const t=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,t),oM(t)}finally{this.draco.destroy(t)}}_getAttributeValues(e,t){const n=nM[t.data_type];if(!n)return console.warn(`DRACO: Unsupported attribute type ${t.data_type}`),null;const i=t.num_components,l=e.num_points()*i,h=l*n.BYTES_PER_ELEMENT,g=AM(this.draco,n);let B;const C=this.draco._malloc(h);try{const y=this.decoder.GetAttribute(e,t.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,y,g,h,C),B=new n(this.draco.HEAPF32.buffer,C,l).slice()}finally{this.draco._free(C)}return{value:B,size:i}}_deduceAttributeName(e,t){const n=e.unique_id;for(const[l,h]of Object.entries(t.extraAttributes||{}))if(h===n)return l;const i=e.attribute_type;for(const l in cu)if(this.draco[l]===i)return cu[l];const A=t.attributeNameEntry||"name";return e.metadata[A]?e.metadata[A].string:`CUSTOM_ATTRIBUTE_${n}`}_getTopLevelMetadata(e){const t=this.decoder.GetMetadata(e);return this._getDracoMetadata(t)}_getAttributeMetadata(e,t){const n=this.decoder.GetAttributeMetadata(e,t);return this._getDracoMetadata(n)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const t={},n=this.metadataQuerier.NumEntries(e);for(let i=0;i<n;i++){const A=this.metadataQuerier.GetEntryName(e,i);t[A]=this._getDracoMetadataField(e,A)}return t}_getDracoMetadataField(e,t){const n=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,t,n);const i=rM(n);return{int:this.metadataQuerier.GetIntEntry(e,t),string:this.metadataQuerier.GetStringEntry(e,t),double:this.metadataQuerier.GetDoubleEntry(e,t),intArray:i}}finally{this.draco.destroy(n)}}_disableAttributeTransforms(e){const{quantizedAttributes:t=[],octahedronAttributes:n=[]}=e,i=[...t,...n];for(const A of i)this.decoder.SkipAttributeTransform(this.draco[A])}_getQuantizationTransform(e,t){const{quantizedAttributes:n=[]}=t,i=e.attribute_type();if(n.map(l=>this.decoder[l]).includes(i)){const l=new this.draco.AttributeQuantizationTransform;try{if(l.InitFromAttribute(e))return{quantization_bits:l.quantization_bits(),range:l.range(),min_values:new Float32Array([1,2,3]).map(h=>l.min_value(h))}}finally{this.draco.destroy(l)}}return null}_getOctahedronTransform(e,t){const{octahedronAttributes:n=[]}=t,i=e.attribute_type();if(n.map(l=>this.decoder[l]).includes(i)){const l=new this.draco.AttributeQuantizationTransform;try{if(l.InitFromAttribute(e))return{quantization_bits:l.quantization_bits()}}finally{this.draco.destroy(l)}}return null}};function AM(s,e){switch(e){case Float32Array:return s.DT_FLOAT32;case Int8Array:return s.DT_INT8;case Int16Array:return s.DT_INT16;case Int32Array:return s.DT_INT32;case Uint8Array:return s.DT_UINT8;case Uint16Array:return s.DT_UINT16;case Uint32Array:return s.DT_UINT32;default:return s.DT_INVALID}}function rM(s){const e=s.size(),t=new Int32Array(e);for(let n=0;n<e;n++)t[n]=s.GetValue(n);return t}function oM(s){const e=s.size(),t=new Int32Array(e);for(let n=0;n<e;n++)t[n]=s.GetValue(n);return t}const aM="1.5.6",cM="1.4.1",Bo=`https://www.gstatic.com/draco/versioned/decoders/${aM}`,Gt={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},Co={[Gt.DECODER]:`${Bo}/${Gt.DECODER}`,[Gt.DECODER_WASM]:`${Bo}/${Gt.DECODER_WASM}`,[Gt.FALLBACK_DECODER]:`${Bo}/${Gt.FALLBACK_DECODER}`,[Gt.ENCODER]:`https://raw.githubusercontent.com/google/draco/${cM}/javascript/${Gt.ENCODER}`};let _o;async function lM(s){const e=s.modules||{};return e.draco3d?_o||(_o=e.draco3d.createDecoderModule({}).then(t=>({draco:t}))):_o||(_o=uM(s)),await _o}async function uM(s){let e,t;switch(s.draco&&s.draco.decoderType){case"js":e=await kt(Co[Gt.FALLBACK_DECODER],"draco",s,Gt.FALLBACK_DECODER);break;case"wasm":default:[e,t]=await Promise.all([await kt(Co[Gt.DECODER],"draco",s,Gt.DECODER),await kt(Co[Gt.DECODER_WASM],"draco",s,Gt.DECODER_WASM)])}return e=e||globalThis.DracoDecoderModule,await fM(e,t)}function fM(s,e){const t={};return e&&(t.wasmBinary=e),new Promise(n=>{s({...t,onModuleLoaded:i=>n({draco:i})})})}const hM={...qI,parse:dM};async function dM(s,e){const{draco:t}=await lM(e),n=new iM(t);try{return n.parseSync(s,e==null?void 0:e.draco)}finally{n.destroy()}}function gM(s){const e={};for(const t in s){const n=s[t];if(t!=="indices"){const i=bd(n);e[t]=i}}return e}function bd(s){const{buffer:e,size:t,count:n}=pM(s);return{value:e,size:t,byteOffset:0,count:n,type:ld(t),componentType:fr(e)}}function pM(s){let e=s,t=1,n=0;return s&&s.value&&(e=s.value,t=s.size||1),e&&(ArrayBuffer.isView(e)||(e=mM(e,Float32Array)),n=e.length/t),{buffer:e,size:t,count:n}}function mM(s,e,t=!1){return s?Array.isArray(s)?new e(s):t&&!(s instanceof e)?new e(s):s:null}const Jn="KHR_draco_mesh_compression",BM=Jn;function CM(s,e,t){const n=new mt(s);for(const i of Ed(n))n.getObjectExtension(i,Jn)}async function _M(s,e,t){var A;if(!((A=e==null?void 0:e.gltf)!=null&&A.decompressMeshes))return;const n=new mt(s),i=[];for(const l of Ed(n))n.getObjectExtension(l,Jn)&&i.push(bM(n,l,e,t));await Promise.all(i),n.removeExtension(Jn)}function yM(s,e={}){const t=new mt(s);for(const n of t.json.meshes||[])EM(n),t.addRequiredExtension(Jn)}async function bM(s,e,t,n){const i=s.getObjectExtension(e,Jn);if(!i)return;const A=s.getTypedArrayForBufferView(i.bufferView),l=Pi(A.buffer,A.byteOffset),h={...t};delete h["3d-tiles"];const g=await ls(l,hM,h,n),B=gM(g.attributes);for(const[C,y]of Object.entries(B))if(C in e.attributes){const E=e.attributes[C],T=s.getAccessor(E);T!=null&&T.min&&(T!=null&&T.max)&&(y.min=T.min,y.max=T.max)}e.attributes=B,g.indices&&(e.indices=bd(g.indices)),s.removeObjectExtension(e,Jn),TM(e)}function EM(s,e,t=4,n,i){var C;if(!n.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const A=n.DracoWriter.encodeSync({attributes:s}),l=(C=i==null?void 0:i.parseSync)==null?void 0:C.call(i,{attributes:s}),h=n._addFauxAttributes(l.attributes),g=n.addBufferView(A);return{primitives:[{attributes:h,mode:t,extensions:{[Jn]:{bufferView:g,attributes:h}}}]}}function TM(s){if(!s.attributes&&Object.keys(s.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*Ed(s){for(const e of s.json.meshes||[])for(const t of e.primitives)yield t}const vM=Object.freeze(Object.defineProperty({__proto__:null,decode:_M,encode:yM,name:BM,preprocess:CM},Symbol.toStringTag,{value:"Module"})),gr="KHR_texture_transform",IM=gr,uA=new k,MM=new At,wM=new At;async function SM(s,e){var A;if(!new mt(s).hasExtension(gr)||!((A=e.gltf)!=null&&A.loadBuffers))return;const i=s.json.materials||[];for(let l=0;l<i.length;l++)xM(l,s)}function xM(s,e){var A,l,h,g;const t=(A=e.json.materials)==null?void 0:A[s],n=[(l=t==null?void 0:t.pbrMetallicRoughness)==null?void 0:l.baseColorTexture,t==null?void 0:t.emissiveTexture,t==null?void 0:t.normalTexture,t==null?void 0:t.occlusionTexture,(h=t==null?void 0:t.pbrMetallicRoughness)==null?void 0:h.metallicRoughnessTexture],i=[];for(const B of n)B&&((g=B==null?void 0:B.extensions)!=null&&g[gr])&&DM(e,s,B,i)}function DM(s,e,t,n){const i=PM(t,n);if(!i)return;const A=s.json.meshes||[];for(const l of A)for(const h of l.primitives){const g=h.material;Number.isFinite(g)&&e===g&&FM(s,h,i)}}function PM(s,e){var l;const t=(l=s.extensions)==null?void 0:l[gr],{texCoord:n=0}=s,{texCoord:i=n}=t;if(!(e.findIndex(([h,g])=>h===n&&g===i)!==-1)){const h=OM(t);return n!==i&&(s.texCoord=i),e.push([n,i]),{originalTexCoord:n,texCoord:i,matrix:h}}return null}function FM(s,e,t){var h,g;const{originalTexCoord:n,texCoord:i,matrix:A}=t,l=e.attributes[`TEXCOORD_${n}`];if(Number.isFinite(l)){const B=(h=s.json.accessors)==null?void 0:h[l];if(B&&B.bufferView){const C=(g=s.json.bufferViews)==null?void 0:g[B.bufferView];if(C){const{arrayBuffer:y,byteOffset:E}=s.buffers[C.buffer],T=(E||0)+(B.byteOffset||0)+(C.byteOffset||0),{ArrayType:x,length:F}=Va(B,C),N=cd[B.componentType],R=ad[B.type],Q=C.byteStride||N*R,Y=new Float32Array(F);for(let se=0;se<B.count;se++){const re=new x(y,T+se*Q,2);uA.set(re[0],re[1],1),uA.transformByMatrix3(A),Y.set([uA[0],uA[1]],se*R)}n===i?LM(B,C,s.buffers,Y):RM(i,B,e,s,Y)}}}}function LM(s,e,t,n){s.componentType=5126,t.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength}),e.buffer=t.length-1,e.byteLength=n.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function RM(s,e,t,n,i){n.buffers.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength});const A=n.json.bufferViews;if(!A)return;A.push({buffer:n.buffers.length-1,byteLength:i.buffer.byteLength,byteOffset:0});const l=n.json.accessors;l&&(l.push({bufferView:(A==null?void 0:A.length)-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),t.attributes[`TEXCOORD_${s}`]=l.length-1)}function OM(s){const{offset:e=[0,0],rotation:t=0,scale:n=[1,1]}=s,i=new At().set(1,0,0,0,1,0,e[0],e[1],1),A=MM.set(Math.cos(t),Math.sin(t),0,-Math.sin(t),Math.cos(t),0,0,0,1),l=wM.set(n[0],0,0,0,n[1],0,0,0,1);return i.multiplyRight(A).multiplyRight(l)}const GM=Object.freeze(Object.defineProperty({__proto__:null,decode:SM,name:IM},Symbol.toStringTag,{value:"Module"})),ss="KHR_lights_punctual",NM=ss;async function UM(s){const e=new mt(s),{json:t}=e,n=e.getExtension(ss);n&&(e.json.lights=n.lights,e.removeExtension(ss));for(const i of t.nodes||[]){const A=e.getObjectExtension(i,ss);A&&(i.light=A.light),e.removeObjectExtension(i,ss)}}async function HM(s){const e=new mt(s),{json:t}=e;if(t.lights){const n=e.addExtension(ss);Qt(!n.lights),n.lights=t.lights,delete t.lights}if(e.json.lights){for(const n of e.json.lights){const i=n.node;e.addObjectExtension(i,ss,n)}delete e.json.lights}}const kM=Object.freeze(Object.defineProperty({__proto__:null,decode:UM,encode:HM,name:NM},Symbol.toStringTag,{value:"Module"})),Mi="KHR_materials_unlit",JM=Mi;async function VM(s){const e=new mt(s),{json:t}=e;for(const n of t.materials||[])n.extensions&&n.extensions.KHR_materials_unlit&&(n.unlit=!0),e.removeObjectExtension(n,Mi);e.removeExtension(Mi)}function zM(s){const e=new mt(s),{json:t}=e;if(e.materials)for(const n of t.materials||[])n.unlit&&(delete n.unlit,e.addObjectExtension(n,Mi,{}),e.addExtension(Mi))}const jM=Object.freeze(Object.defineProperty({__proto__:null,decode:VM,encode:zM,name:JM},Symbol.toStringTag,{value:"Module"})),Ci="KHR_techniques_webgl",QM=Ci;async function KM(s){const e=new mt(s),{json:t}=e,n=e.getExtension(Ci);if(n){const i=XM(n,e);for(const A of t.materials||[]){const l=e.getObjectExtension(A,Ci);l&&(A.technique=Object.assign({},l,i[l.technique]),A.technique.values=YM(A.technique,e)),e.removeObjectExtension(A,Ci)}e.removeExtension(Ci)}}async function WM(s,e){}function XM(s,e){const{programs:t=[],shaders:n=[],techniques:i=[]}=s,A=new TextDecoder;return n.forEach(l=>{if(Number.isFinite(l.bufferView))l.code=A.decode(e.getTypedArrayForBufferView(l.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),t.forEach(l=>{l.fragmentShader=n[l.fragmentShader],l.vertexShader=n[l.vertexShader]}),i.forEach(l=>{l.program=t[l.program]}),i}function YM(s,e){const t=Object.assign({},s.values);return Object.keys(s.uniforms||{}).forEach(n=>{s.uniforms[n].value&&!(n in t)&&(t[n]=s.uniforms[n].value)}),Object.keys(t).forEach(n=>{typeof t[n]=="object"&&t[n].index!==void 0&&(t[n].texture=e.getTexture(t[n].index))}),t}const $M=Object.freeze(Object.defineProperty({__proto__:null,decode:KM,encode:WM,name:QM},Symbol.toStringTag,{value:"Module"})),Td=[Hv,uv,jI,WI,$I,vM,kM,jM,$M,GM,sI];function ZM(s,e={},t){var i;const n=Td.filter(A=>vd(A.name,e));for(const A of n)(i=A.preprocess)==null||i.call(A,s,e,t)}async function qM(s,e={},t){var i;const n=Td.filter(A=>vd(A.name,e));for(const A of n)await((i=A.decode)==null?void 0:i.call(A,s,e,t))}function vd(s,e){var i;const t=((i=e==null?void 0:e.gltf)==null?void 0:i.excludeExtensions)||{};return!(s in t&&!t[s])}const yo="KHR_binary_glTF";function ew(s){const e=new mt(s),{json:t}=e;for(const n of t.images||[]){const i=e.getObjectExtension(n,yo);i&&Object.assign(n,i),e.removeObjectExtension(n,yo)}t.buffers&&t.buffers[0]&&delete t.buffers[0].uri,e.removeExtension(yo)}const lu={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},tw={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};let nw=class{constructor(){G(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}});G(this,"json")}normalize(e,t){this.json=e.json;const n=e.json;switch(n.asset&&n.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${n.asset.version}`);return}if(!t.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(n),this._convertTopLevelObjectsToArrays(n),ew(e),this._convertObjectIdsToArrayIndices(n),this._updateObjects(n),this._updateMaterial(n)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const t in lu)this._convertTopLevelObjectToArray(e,t)}_convertTopLevelObjectToArray(e,t){const n=e[t];if(!(!n||Array.isArray(n))){e[t]=[];for(const i in n){const A=n[i];A.id=A.id||i;const l=e[t].length;e[t].push(A),this.idToIndexMap[t][i]=l}}}_convertObjectIdsToArrayIndices(e){for(const t in lu)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const t of e.textures)this._convertTextureIds(t);for(const t of e.meshes)this._convertMeshIds(t);for(const t of e.nodes)this._convertNodeIds(t);for(const t of e.scenes)this._convertSceneIds(t)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const t of e.primitives){const{attributes:n,indices:i,material:A}=t;for(const l in n)n[l]=this._convertIdToIndex(n[l],"accessor");i&&(t.indices=this._convertIdToIndex(i,"accessor")),A&&(t.material=this._convertIdToIndex(A,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(t=>this._convertIdToIndex(t,"node"))),e.meshes&&(e.meshes=e.meshes.map(t=>this._convertIdToIndex(t,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(t=>this._convertIdToIndex(t,"node")))}_convertIdsToIndices(e,t){e[t]||(console.warn(`gltf v1: json doesn't contain attribute ${t}`),e[t]=[]);for(const n of e[t])for(const i in n){const A=n[i],l=this._convertIdToIndex(A,i);n[i]=l}}_convertIdToIndex(e,t){const n=tw[t];if(n in this.idToIndexMap){const i=this.idToIndexMap[n][e];if(!Number.isFinite(i))throw new Error(`gltf v1: failed to resolve ${t} with id ${e}`);return i}return e}_updateObjects(e){for(const t of this.json.buffers)delete t.type}_updateMaterial(e){var t,n,i;for(const A of e.materials){A.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const l=((t=A.values)==null?void 0:t.tex)||((n=A.values)==null?void 0:n.texture2d_0)||((i=A.values)==null?void 0:i.diffuseTex),h=e.textures.findIndex(g=>g.id===l);h!==-1&&(A.pbrMetallicRoughness.baseColorTexture={index:h})}}};function sw(s,e={}){return new nw().normalize(s,e)}async function iw(s,e,t=0,n,i){var A,l,h;return Aw(s,e,t,n),sw(s,{normalize:(A=n==null?void 0:n.gltf)==null?void 0:A.normalize}),ZM(s,n,i),(l=n==null?void 0:n.gltf)!=null&&l.loadBuffers&&s.json.buffers&&await rw(s,n,i),(h=n==null?void 0:n.gltf)!=null&&h.loadImages&&await ow(s,n,i),await qM(s,n,i),s}function Aw(s,e,t,n){if(n.uri&&(s.baseUri=n.uri),e instanceof ArrayBuffer&&!II(e,t,n)&&(e=new TextDecoder().decode(e)),typeof e=="string")s.json=Kf(e);else if(e instanceof ArrayBuffer){const l={};t=MI(l,e,t,n.glb),Qt(l.type==="glTF",`Invalid GLB magic string ${l.type}`),s._glb=l,s.json=l.json}else Qt(!1,"GLTF: must be ArrayBuffer or string");const i=s.json.buffers||[];if(s.buffers=new Array(i.length).fill(null),s._glb&&s._glb.header.hasBinChunk){const{binChunks:l}=s._glb;s.buffers[0]={arrayBuffer:l[0].arrayBuffer,byteOffset:l[0].byteOffset,byteLength:l[0].byteLength}}const A=s.json.images||[];s.images=new Array(A.length).fill({})}async function rw(s,e,t){var i,A;const n=s.json.buffers||[];for(let l=0;l<n.length;++l){const h=n[l];if(h.uri){const{fetch:g}=t;Qt(g);const B=_d(h.uri,e),C=await((i=t==null?void 0:t.fetch)==null?void 0:i.call(t,B)),y=await((A=C==null?void 0:C.arrayBuffer)==null?void 0:A.call(C));s.buffers[l]={arrayBuffer:y,byteOffset:0,byteLength:y.byteLength},delete h.uri}else s.buffers[l]===null&&(s.buffers[l]={arrayBuffer:new ArrayBuffer(h.byteLength),byteOffset:0,byteLength:h.byteLength})}}async function ow(s,e,t){const n=aw(s),i=s.json.images||[],A=[];for(const l of n)A.push(cw(s,i[l],l,e,t));return await Promise.all(A)}function aw(s){const e=new Set,t=s.json.textures||[];for(const n of t)n.source!==void 0&&e.add(n.source);return Array.from(e).sort()}async function cw(s,e,t,n,i){let A;if(e.uri&&!e.hasOwnProperty("bufferView")){const h=_d(e.uri,n),{fetch:g}=i;A=await(await g(h)).arrayBuffer(),e.bufferView={data:A}}if(Number.isFinite(e.bufferView)){const h=YT(s.json,s.buffers,e.bufferView);A=Pi(h.buffer,h.byteOffset,h.byteLength)}Qt(A,"glTF image has no data");let l=await ls(A,[Jf,CI],{...n,mimeType:e.mimeType,basis:n.basis||{format:Cd()}},i);l&&l[0]&&(l={compressed:!0,mipmaps:!1,width:l[0].width,height:l[0].height,data:l[0]}),s.images=s.images||[],s.images[t]=l}const sa={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:iI,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:lw,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function lw(s,e={},t){e={...sa.options,...e},e.gltf={...sa.options.gltf,...e.gltf};const{byteOffset:n=0}=e;return await iw({},s,n,e,t)}const uw={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},fw={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},qt={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},hw={magFilter:qt.TEXTURE_MAG_FILTER,minFilter:qt.TEXTURE_MIN_FILTER,wrapS:qt.TEXTURE_WRAP_S,wrapT:qt.TEXTURE_WRAP_T},dw={[qt.TEXTURE_MAG_FILTER]:qt.LINEAR,[qt.TEXTURE_MIN_FILTER]:qt.NEAREST_MIPMAP_LINEAR,[qt.TEXTURE_WRAP_S]:qt.REPEAT,[qt.TEXTURE_WRAP_T]:qt.REPEAT};function gw(){return{id:"default-sampler",parameters:dw}}function pw(s){return fw[s]}function mw(s){return uw[s]}let Bw=class{constructor(){G(this,"baseUri","");G(this,"jsonUnprocessed");G(this,"json");G(this,"buffers",[]);G(this,"images",[])}postProcess(e,t={}){const{json:n,buffers:i=[],images:A=[]}=e,{baseUri:l=""}=e;return Qt(n),this.baseUri=l,this.buffers=i,this.images=A,this.jsonUnprocessed=n,this.json=this._resolveTree(e.json,t),this.json}_resolveTree(e,t={}){const n={...e};return this.json=n,e.bufferViews&&(n.bufferViews=e.bufferViews.map((i,A)=>this._resolveBufferView(i,A))),e.images&&(n.images=e.images.map((i,A)=>this._resolveImage(i,A))),e.samplers&&(n.samplers=e.samplers.map((i,A)=>this._resolveSampler(i,A))),e.textures&&(n.textures=e.textures.map((i,A)=>this._resolveTexture(i,A))),e.accessors&&(n.accessors=e.accessors.map((i,A)=>this._resolveAccessor(i,A))),e.materials&&(n.materials=e.materials.map((i,A)=>this._resolveMaterial(i,A))),e.meshes&&(n.meshes=e.meshes.map((i,A)=>this._resolveMesh(i,A))),e.nodes&&(n.nodes=e.nodes.map((i,A)=>this._resolveNode(i,A)),n.nodes=n.nodes.map((i,A)=>this._resolveNodeChildren(i))),e.skins&&(n.skins=e.skins.map((i,A)=>this._resolveSkin(i,A))),e.scenes&&(n.scenes=e.scenes.map((i,A)=>this._resolveScene(i,A))),typeof this.json.scene=="number"&&n.scenes&&(n.scene=n.scenes[this.json.scene]),n}getScene(e){return this._get(this.json.scenes,e)}getNode(e){return this._get(this.json.nodes,e)}getSkin(e){return this._get(this.json.skins,e)}getMesh(e){return this._get(this.json.meshes,e)}getMaterial(e){return this._get(this.json.materials,e)}getAccessor(e){return this._get(this.json.accessors,e)}getCamera(e){return this._get(this.json.cameras,e)}getTexture(e){return this._get(this.json.textures,e)}getSampler(e){return this._get(this.json.samplers,e)}getImage(e){return this._get(this.json.images,e)}getBufferView(e){return this._get(this.json.bufferViews,e)}getBuffer(e){return this._get(this.json.buffers,e)}_get(e,t){if(typeof t=="object")return t;const n=e&&e[t];return n||console.warn(`glTF file error: Could not find ${e}[${t}]`),n}_resolveScene(e,t){return{...e,id:e.id||`scene-${t}`,nodes:(e.nodes||[]).map(n=>this.getNode(n))}}_resolveNode(e,t){const n={...e,id:(e==null?void 0:e.id)||`node-${t}`};return e.mesh!==void 0&&(n.mesh=this.getMesh(e.mesh)),e.camera!==void 0&&(n.camera=this.getCamera(e.camera)),e.skin!==void 0&&(n.skin=this.getSkin(e.skin)),e.meshes!==void 0&&e.meshes.length&&(n.mesh=e.meshes.reduce((i,A)=>{const l=this.getMesh(A);return i.id=l.id,i.primitives=i.primitives.concat(l.primitives),i},{primitives:[]})),n}_resolveNodeChildren(e){return e.children&&(e.children=e.children.map(t=>this.getNode(t))),e}_resolveSkin(e,t){const n=typeof e.inverseBindMatrices=="number"?this.getAccessor(e.inverseBindMatrices):void 0;return{...e,id:e.id||`skin-${t}`,inverseBindMatrices:n}}_resolveMesh(e,t){const n={...e,id:e.id||`mesh-${t}`,primitives:[]};return e.primitives&&(n.primitives=e.primitives.map(i=>{const A={...i,attributes:{},indices:void 0,material:void 0},l=i.attributes;for(const h in l)A.attributes[h]=this.getAccessor(l[h]);return i.indices!==void 0&&(A.indices=this.getAccessor(i.indices)),i.material!==void 0&&(A.material=this.getMaterial(i.material)),A})),n}_resolveMaterial(e,t){const n={...e,id:e.id||`material-${t}`};if(n.normalTexture&&(n.normalTexture={...n.normalTexture},n.normalTexture.texture=this.getTexture(n.normalTexture.index)),n.occlusionTexture&&(n.occlusionTexture={...n.occlusionTexture},n.occlusionTexture.texture=this.getTexture(n.occlusionTexture.index)),n.emissiveTexture&&(n.emissiveTexture={...n.emissiveTexture},n.emissiveTexture.texture=this.getTexture(n.emissiveTexture.index)),n.emissiveFactor||(n.emissiveFactor=n.emissiveTexture?[1,1,1]:[0,0,0]),n.pbrMetallicRoughness){n.pbrMetallicRoughness={...n.pbrMetallicRoughness};const i=n.pbrMetallicRoughness;i.baseColorTexture&&(i.baseColorTexture={...i.baseColorTexture},i.baseColorTexture.texture=this.getTexture(i.baseColorTexture.index)),i.metallicRoughnessTexture&&(i.metallicRoughnessTexture={...i.metallicRoughnessTexture},i.metallicRoughnessTexture.texture=this.getTexture(i.metallicRoughnessTexture.index))}return n}_resolveAccessor(e,t){const n=pw(e.componentType),i=mw(e.type),A=n*i,l={...e,id:e.id||`accessor-${t}`,bytesPerComponent:n,components:i,bytesPerElement:A,value:void 0,bufferView:void 0,sparse:void 0};if(e.bufferView!==void 0&&(l.bufferView=this.getBufferView(e.bufferView)),l.bufferView){const h=l.bufferView.buffer,{ArrayType:g,byteLength:B}=Va(l,l.bufferView),C=(l.bufferView.byteOffset||0)+(l.byteOffset||0)+h.byteOffset;let y=h.arrayBuffer.slice(C,C+B);l.bufferView.byteStride&&(y=this._getValueFromInterleavedBuffer(h,C,l.bufferView.byteStride,l.bytesPerElement,l.count)),l.value=new g(y)}return l}_getValueFromInterleavedBuffer(e,t,n,i,A){const l=new Uint8Array(A*i);for(let h=0;h<A;h++){const g=t+h*n;l.set(new Uint8Array(e.arrayBuffer.slice(g,g+i)),h*i)}return l.buffer}_resolveTexture(e,t){return{...e,id:e.id||`texture-${t}`,sampler:typeof e.sampler=="number"?this.getSampler(e.sampler):gw(),source:typeof e.source=="number"?this.getImage(e.source):void 0}}_resolveSampler(e,t){const n={id:e.id||`sampler-${t}`,...e,parameters:{}};for(const i in n){const A=this._enumSamplerParameter(i);A!==void 0&&(n.parameters[A]=n[i])}return n}_enumSamplerParameter(e){return hw[e]}_resolveImage(e,t){const n={...e,id:e.id||`image-${t}`,image:null,bufferView:e.bufferView!==void 0?this.getBufferView(e.bufferView):void 0},i=this.images[t];return i&&(n.image=i),n}_resolveBufferView(e,t){const n=e.buffer,i=this.buffers[n].arrayBuffer;let A=this.buffers[n].byteOffset||0;return e.byteOffset&&(A+=e.byteOffset),{id:`bufferView-${t}`,...e,buffer:this.buffers[n],data:new Uint8Array(i,A,e.byteLength)}}_resolveCamera(e,t){const n={...e,id:e.id||`camera-${t}`};return n.perspective,n.orthographic,n}};function Cw(s,e){return new Bw().postProcess(s,e)}async function _w(s){const e=[];return s.scenes.forEach(t=>{t.traverse(n=>{Object.values(n.model.uniforms).forEach(i=>{i.loaded===!1&&e.push(i)})})}),await yw(()=>e.some(t=>!t.loaded))}async function yw(s){for(;s();)await new Promise(e=>requestAnimationFrame(e))}const uu=`uniform scenegraphUniforms {
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  mat4 sceneModelMatrix;
  bool composeModelMatrix;
} scenegraph;
`,bw={name:"scenegraph",vs:uu,fs:uu,uniformTypes:{sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",sceneModelMatrix:"mat4x4<f32>",composeModelMatrix:"f32"}},Ew=`#version 300 es
#define SHADER_NAME scenegraph-layer-vertex-shader
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
in vec3 positions;
#ifdef HAS_UV
in vec2 texCoords;
#endif
#ifdef LIGHTING_PBR
#ifdef HAS_NORMALS
in vec3 normals;
#endif
#endif
out vec4 vColor;
#ifndef LIGHTING_PBR
#ifdef HAS_UV
out vec2 vTEXCOORD_0;
#endif
#endif
void main(void) {
#if defined(HAS_UV) && !defined(LIGHTING_PBR)
vTEXCOORD_0 = texCoords;
geometry.uv = texCoords;
#endif
geometry.worldPosition = instancePositions;
geometry.pickingColor = instancePickingColors;
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 normal = vec3(0.0, 0.0, 1.0);
#ifdef LIGHTING_PBR
#ifdef HAS_NORMALS
normal = instanceModelMatrix * (scenegraph.sceneModelMatrix * vec4(normals, 0.0)).xyz;
#endif
#endif
float originalSize = project_size_to_pixel(scenegraph.sizeScale);
float clampedSize = clamp(originalSize, scenegraph.sizeMinPixels, scenegraph.sizeMaxPixels);
vec3 pos = (instanceModelMatrix * (scenegraph.sceneModelMatrix * vec4(positions, 1.0)).xyz) * scenegraph.sizeScale * (clampedSize / originalSize) + instanceTranslation;
if(scenegraph.composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
geometry.normal = project_normal(normal);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
geometry.normal = project_normal(normal);
}
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef LIGHTING_PBR
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = texCoords;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Tw=`#version 300 es
#define SHADER_NAME scenegraph-layer-fragment-shader
in vec4 vColor;
out vec4 fragColor;
#ifndef LIGHTING_PBR
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
in vec2 vTEXCOORD_0;
uniform sampler2D pbr_baseColorSampler;
#endif
#endif
void main(void) {
#ifdef LIGHTING_PBR
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
#else
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
fragColor = vColor * texture(pbr_baseColorSampler, vTEXCOORD_0);
geometry.uv = vTEXCOORD_0;
#else
fragColor = vColor;
#endif
#endif
fragColor.a *= layer.opacity;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Id=[255,255,255,255],vw={scenegraph:{type:"object",value:null,async:!0},getScene:s=>s&&s.scenes?typeof s.scene=="object"?s.scene:s.scenes[s.scene||0]:s,getAnimator:s=>s&&s.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:s=>s.position},getColor:{type:"accessor",value:Id},_lighting:"flat",_imageBasedLightingEnvironment:void 0,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[sa]};class Wa extends sn{getShaders(){const e={};let t;this.props._lighting==="pbr"?(t=Ea,e.LIGHTING_PBR=1):t={name:"pbrMaterial"};const n=[St,fn,bw,t];return super.getShaders({defines:e,vs:Ew,fs:Tw,modules:n})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:"unorm8",size:this.props.colorFormat.length,accessor:"getColor",defaultValue:Id,transition:!0},instanceModelMatrix:Ad})}updateState(e){super.updateState(e);const{props:t,oldProps:n}=e;t.scenegraph!==n.scenegraph?this._updateScenegraph():t._animations!==n._animations&&this._applyAnimationsProp(this.state.animator,t._animations)}finalizeState(e){var t;super.finalizeState(e),(t=this.state.scenegraph)==null||t.destroy()}get isLoaded(){var e;return!!((e=this.state)!=null&&e.scenegraph&&super.isLoaded)}_updateScenegraph(){var h;const e=this.props,{device:t}=this.context;let n=null;if(e.scenegraph instanceof RA)n={scenes:[e.scenegraph]};else if(e.scenegraph&&typeof e.scenegraph=="object"){const g=e.scenegraph,B=g.json?Cw(g):g,C=zT(t,B,this._getModelOptions());n={gltf:B,...C},_w(C).then(()=>{this.setNeedsRedraw()}).catch(y=>{this.raiseError(y,"loading glTF")})}const i={layer:this,device:this.context.device},A=e.getScene(n,i),l=e.getAnimator(n,i);if(A instanceof Js){(h=this.state.scenegraph)==null||h.destroy(),this._applyAnimationsProp(l,e._animations);const g=[];A.traverse(B=>{B instanceof Wo&&g.push(B.model)}),this.setState({scenegraph:A,animator:l,models:g}),this.getAttributeManager().invalidateAll()}else A!==null&&at.warn("invalid scenegraph:",A)()}_applyAnimationsProp(e,t){if(!e||!t)return;const n=e.getAnimations();Object.keys(t).sort().forEach(i=>{const A=t[i];if(i==="*")n.forEach(l=>{Object.assign(l,A)});else if(Number.isFinite(Number(i))){const l=Number(i);l>=0&&l<n.length?Object.assign(n[l],A):at.warn(`animation ${i} not found`)()}else{const l=n.find(({name:h})=>h===i);l?Object.assign(l,A):at.warn(`animation ${i} not found`)()}})}_getModelOptions(){const{_imageBasedLightingEnvironment:e}=this.props;let t;return e&&(typeof e=="function"?t=e({gl:this.context.gl,layer:this}):t=e),{imageBasedLightingEnvironment:t,modelOptions:{id:this.props.id,isInstanced:!0,bufferLayout:this.getAttributeManager().getBufferLayouts(),...this.getShaders()},useTangents:!1}}draw({context:e}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(e.timeline.getTime()),this.setNeedsRedraw());const{viewport:t,renderPass:n}=this.context,{sizeScale:i,sizeMinPixels:A,sizeMaxPixels:l,coordinateSystem:h}=this.props,g=this.getNumInstances();this.state.scenegraph.traverse((B,{worldMatrix:C})=>{if(B instanceof Wo){const{model:y}=B;y.setInstanceCount(g);const E={camera:y.uniforms.cameraPosition},T={sizeScale:i,sizeMinPixels:A,sizeMaxPixels:l,composeModelMatrix:rd(t,h),sceneModelMatrix:C};y.shaderInputs.setProps({pbrProjection:E,scenegraph:T}),y.draw(n)}})}}Wa.defaultProps=vw;Wa.layerName="ScenegraphLayer";const fu=`uniform meshUniforms {
  bool pickFeatureIds;
} mesh;
`,Iw={name:"mesh",vs:fu,fs:fu,uniformTypes:{pickFeatureIds:"f32"}},Mw=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
vec2 applyUVRegion(vec2 uv) {
#ifdef HAS_UV_REGIONS
return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
#else
return uv;
#endif
}
void main(void) {
vec2 uv = applyUVRegion(texCoords);
geometry.uv = uv;
if (mesh.pickFeatureIds) {
geometry.pickingColor = featureIdsPickingColors;
} else {
geometry.pickingColor = instancePickingColors;
}
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vTexCoord = uv;
cameraPosition = project.cameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
vec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale;
vec3 projectedPosition = project_position(positions);
position_commonspace = vec4(projectedPosition, 1.0);
gl_Position = project_common_position_to_clipspace(position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef MODULE_PBRMATERIAL
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = uv;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,ww=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform sampler2D sampler;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
#ifdef MODULE_PBRMATERIAL
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
fragColor.a *= layer.opacity;
#else
geometry.uv = vTexCoord;
vec3 normal;
if (simpleMesh.flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * layer.opacity);
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function Sw(s){const e=s.positions||s.POSITION,t=e.value.length/e.size;s.COLOR_0||s.colors||(s.colors={size:4,value:new Uint8Array(t*4).fill(255),normalized:!0})}const xw={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class Xa extends Ii{getShaders(){const e=super.getShaders();return e.modules.push(Ea,Iw),{...e,vs:Mw,fs:ww}}initializeState(){const{featureIds:e}=this.props;super.initializeState();const t=this.getAttributeManager();e&&t.add({featureIdsPickingColors:{type:"uint8",size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(e){super.updateState(e);const{props:t,oldProps:n}=e;t.pbrMaterial!==n.pbrMaterial&&this.updatePbrMaterialUniforms(t.pbrMaterial)}draw(e){const{featureIds:t}=this.props,{model:n}=this.state;if(!n)return;const i={pickFeatureIds:!!t},A={camera:n.uniforms.cameraPosition};n.shaderInputs.setProps({pbrProjection:A,mesh:i}),super.draw(e)}getModel(e){const{id:t}=this.props,n=this.parseMaterial(this.props.pbrMaterial,e);this.setState({parsedPBRMaterial:n});const i=this.getShaders();return Sw(e.attributes),new Ct(this.context.device,{...this.getShaders(),id:t,geometry:e,bufferLayout:this.getAttributeManager().getBufferLayouts(),defines:{...i.defines,...n==null?void 0:n.defines,HAS_UV_REGIONS:e.attributes.uvRegions?1:0},parameters:n==null?void 0:n.parameters,isInstanced:!0})}updatePbrMaterialUniforms(e){const{model:t}=this.state;if(t){const{mesh:n}=this.props,i=this.parseMaterial(e,n);this.setState({parsedPBRMaterial:i});const{pbr_baseColorSampler:A}=i.bindings,{emptyTexture:l}=this.state,h={sampler:A||l,hasTexture:!!A},{camera:g,...B}={...i.bindings,...i.uniforms};t.shaderInputs.setProps({simpleMesh:h,pbrMaterial:B})}}parseMaterial(e,t){const n=!!(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return od(this.context.device,{unlit:n,...e},{NORMAL:t.attributes.normals,TEXCOORD_0:t.attributes.texCoords},{pbrDebug:!1,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(e){const t=this.props.featureIds,n=new Uint8ClampedArray(t.length*e.size),i=[];for(let A=0;A<t.length;A++)this.encodePickingColor(t[A],i),n[A*3]=i[0],n[A*3+1]=i[1],n[A*3+2]=i[2];e.value=n}finalizeState(e){var t;super.finalizeState(e),(t=this.state.parsedPBRMaterial)==null||t.generatedTextures.forEach(n=>n.destroy()),this.setState({parsedPBRMaterial:null})}}Xa.layerName="MeshLayer";Xa.defaultProps=xw;const Dw=6378137,Pw=6378137,Fw=6356752314245179e-9;function pr(s){return s}new k;function Lw(s,e=[],t=pr){return"longitude"in s?(e[0]=t(s.longitude),e[1]=t(s.latitude),e[2]=s.height):"x"in s?(e[0]=t(s.x),e[1]=t(s.y),e[2]=s.z):(e[0]=t(s[0]),e[1]=t(s[1]),e[2]=s[2]),e}function Rw(s,e=[]){return Lw(s,e,As._cartographicRadians?pr:h1)}function Ow(s,e,t=pr){return"longitude"in e?(e.longitude=t(s[0]),e.latitude=t(s[1]),e.height=s[2]):"x"in e?(e.x=t(s[0]),e.y=t(s[1]),e.z=s[2]):(e[0]=t(s[0]),e[1]=t(s[1]),e[2]=s[2]),e}function Gw(s,e){return Ow(s,e,As._cartographicRadians?pr:f1)}const hu=1e-14,Nw=new k,du={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},bo={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},pi={east:new k,north:new k,up:new k,west:new k,south:new k,down:new k},Uw=new k,Hw=new k,kw=new k;function gu(s,e,t,n,i,A){const l=du[e]&&du[e][t];vn(l&&(!n||n===l));let h,g,B;const C=Nw.copy(i);if(Cn(C.x,0,hu)&&Cn(C.y,0,hu)){const E=Math.sign(C.z);h=Uw.fromArray(bo[e]),e!=="east"&&e!=="west"&&h.scale(E),g=Hw.fromArray(bo[t]),t!=="east"&&t!=="west"&&g.scale(E),B=kw.fromArray(bo[n]),n!=="east"&&n!=="west"&&B.scale(E)}else{const{up:E,east:T,north:x}=pi;T.set(-C.y,C.x,0).normalize(),s.geodeticSurfaceNormal(C,E),x.copy(E).cross(T);const{down:F,west:N,south:R}=pi;F.copy(E).scale(-1),N.copy(T).scale(-1),R.copy(x).scale(-1),h=pi[e],g=pi[t],B=pi[n]}return A[0]=h.x,A[1]=h.y,A[2]=h.z,A[3]=0,A[4]=g.x,A[5]=g.y,A[6]=g.z,A[7]=0,A[8]=B.x,A[9]=B.y,A[10]=B.z,A[11]=0,A[12]=C.x,A[13]=C.y,A[14]=C.z,A[15]=1,A}const xs=new k,Jw=new k,Vw=new k;function zw(s,e,t=[]){const{oneOverRadii:n,oneOverRadiiSquared:i,centerToleranceSquared:A}=e;xs.from(s);const l=xs.x,h=xs.y,g=xs.z,B=n.x,C=n.y,y=n.z,E=l*l*B*B,T=h*h*C*C,x=g*g*y*y,F=E+T+x,N=Math.sqrt(1/F);if(!Number.isFinite(N))return;const R=Jw;if(R.copy(s).scale(N),F<A)return R.to(t);const Q=i.x,Y=i.y,se=i.z,re=Vw;re.set(R.x*Q*2,R.y*Y*2,R.z*se*2);let ue=(1-N)*xs.len()/(.5*re.len()),Te=0,ge,$,K,O;do{ue-=Te,ge=1/(1+ue*Q),$=1/(1+ue*Y),K=1/(1+ue*se);const ne=ge*ge,he=$*$,Le=K*K,Re=ne*ge,Ye=he*$,it=Le*K;O=E*ne+T*he+x*Le-1;const ct=-2*(E*Re*Q+T*Ye*Y+x*it*se);Te=O/ct}while(Math.abs(O)>AB);return xs.scale([ge,$,K]).to(t)}const fA=new k,pu=new k,jw=new k,rn=new k,Qw=new k,hA=new k;class Ze{constructor(e=0,t=0,n=0){this.centerToleranceSquared=iB,vn(e>=0),vn(t>=0),vn(n>=0),this.radii=new k(e,t,n),this.radiiSquared=new k(e*e,t*t,n*n),this.radiiToTheFourth=new k(e*e*e*e,t*t*t*t,n*n*n*n),this.oneOverRadii=new k(e===0?0:1/e,t===0?0:1/t,n===0?0:1/n),this.oneOverRadiiSquared=new k(e===0?0:1/(e*e),t===0?0:1/(t*t),n===0?0:1/(n*n)),this.minimumRadius=Math.min(e,t,n),this.maximumRadius=Math.max(e,t,n),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||!!(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e,t=[0,0,0]){const n=pu,i=jw,[,,A]=e;this.geodeticSurfaceNormalCartographic(e,n),i.copy(this.radiiSquared).scale(n);const l=Math.sqrt(n.dot(i));return i.scale(1/l),n.scale(A),i.add(n),i.to(t)}cartesianToCartographic(e,t=[0,0,0]){hA.from(e);const n=this.scaleToGeodeticSurface(hA,rn);if(!n)return;const i=this.geodeticSurfaceNormal(n,pu),A=Qw;A.copy(hA).subtract(n);const l=Math.atan2(i.y,i.x),h=Math.asin(i.z),g=Math.sign(xf(A,hA))*Pf(A);return Gw([l,h,g],t)}eastNorthUpToFixedFrame(e,t=new Fe){return gu(this,"east","north","up",e,t)}localFrameToFixedFrame(e,t,n,i,A=new Fe){return gu(this,e,t,n,i,A)}geocentricSurfaceNormal(e,t=[0,0,0]){return fA.from(e).normalize().to(t)}geodeticSurfaceNormalCartographic(e,t=[0,0,0]){const n=Rw(e),i=n[0],A=n[1],l=Math.cos(A);return fA.set(l*Math.cos(i),l*Math.sin(i),Math.sin(A)).normalize(),fA.to(t)}geodeticSurfaceNormal(e,t=[0,0,0]){return fA.from(e).scale(this.oneOverRadiiSquared).normalize().to(t)}scaleToGeodeticSurface(e,t){return zw(e,this,t)}scaleToGeocentricSurface(e,t=[0,0,0]){rn.from(e);const n=rn.x,i=rn.y,A=rn.z,l=this.oneOverRadiiSquared,h=1/Math.sqrt(n*n*l.x+i*i*l.y+A*A*l.z);return rn.multiplyScalar(h).to(t)}transformPositionToScaledSpace(e,t=[0,0,0]){return rn.from(e).scale(this.oneOverRadii).to(t)}transformPositionFromScaledSpace(e,t=[0,0,0]){return rn.from(e).scale(this.radii).to(t)}getSurfaceNormalIntersectionWithZAxis(e,t=0,n=[0,0,0]){vn(Cn(this.radii.x,this.radii.y,th)),vn(this.radii.z>0),rn.from(e);const i=rn.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(i)>=this.radii.z-t))return rn.set(0,0,i).to(n)}}Ze.WGS84=new Ze(Dw,Pw,Fw);class Kw{constructor(e,t,n){G(this,"item");G(this,"previous");G(this,"next");this.item=e,this.previous=t,this.next=n}}class Ww{constructor(){G(this,"head",null);G(this,"tail",null);G(this,"_length",0)}get length(){return this._length}add(e){const t=new Kw(e,this.tail,null);return this.tail?(this.tail.next=t,this.tail=t):(this.head=t,this.tail=t),++this._length,t}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,t){e!==t&&(this.remove(t),this._insert(e,t))}_insert(e,t){const n=e.next;e.next=t,this.tail===e?this.tail=t:n.previous=t,t.next=n,t.previous=e,++this._length}}class Xw{constructor(){G(this,"_list");G(this,"_sentinel");G(this,"_trimTiles");this._list=new Ww,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){const t=e._cacheNode;t&&this._list.splice(this._sentinel,t)}add(e,t,n){t._cacheNode||(t._cacheNode=this._list.add(t),n&&n(e,t))}unloadTile(e,t,n){const i=t._cacheNode;i&&(this._list.remove(i),t._cacheNode=null,n&&n(e,t))}unloadTiles(e,t){const n=this._trimTiles;this._trimTiles=!1;const i=this._list,A=e.maximumMemoryUsage*1024*1024,l=this._sentinel;let h=i.head;for(;h!==l&&(e.gpuMemoryUsageInBytes>A||n);){const g=h.item;h=h.next,this.unloadTile(e,g,t)}}trim(){this._trimTiles=!0}}function Yw(s,e){nt(s),nt(e);const{rtcCenter:t,gltfUpAxis:n}=e,{computedTransform:i,boundingVolume:{center:A}}=s;let l=new Fe(i);switch(t&&l.translate(t),n){case"Z":break;case"Y":const y=new Fe().rotateX(Math.PI/2);l=l.multiplyRight(y);break;case"X":const E=new Fe().rotateY(-Math.PI/2);l=l.multiplyRight(E);break}e.isQuantized&&l.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);const h=new k(A);e.cartesianModelMatrix=l,e.cartesianOrigin=h;const g=Ze.WGS84.cartesianToCartographic(h,new k),C=Ze.WGS84.eastNorthUpToFixedFrame(h).invert();e.cartographicModelMatrix=C.multiplyRight(l),e.cartographicOrigin=g,e.coordinateSystem||(e.modelMatrix=e.cartographicModelMatrix)}const mu=new k,Eo=new k,ia=new jt([new on,new on,new on,new on,new on,new on]);function $w(s,e){const{cameraDirection:t,cameraUp:n,height:i}=s,{metersPerUnit:A}=s.distanceScales,l=wA(s,s.center),h=Ze.WGS84.eastNorthUpToFixedFrame(l),g=s.unprojectPosition(s.cameraPosition),B=Ze.WGS84.cartographicToCartesian(g,new k),C=new k(h.transformAsVector(new k(t).scale(A))).normalize(),y=new k(h.transformAsVector(new k(n).scale(A))).normalize();qw(s);const E=s.constructor,{longitude:T,latitude:x,width:F,bearing:N,zoom:R}=s,Q=new E({longitude:T,latitude:x,height:i,width:F,bearing:N,zoom:R,pitch:0});return{camera:{position:B,direction:C,up:y},viewport:s,topDownViewport:Q,height:i,cullingVolume:ia,frameNumber:e,sseDenominator:1.15}}function Zw(s,e,t){if(t===0||s.length<=t)return[s,[]];const n=[],{longitude:i,latitude:A}=e.viewport;for(const[B,C]of s.entries()){const[y,E]=C.header.mbs,T=Math.abs(i-y),x=Math.abs(A-E),F=Math.sqrt(x*x+T*T);n.push([B,F])}const l=n.sort((B,C)=>B[1]-C[1]),h=[];for(let B=0;B<t;B++)h.push(s[l[B][0]]);const g=[];for(let B=t;B<l.length;B++)g.push(s[l[B][0]]);return[h,g]}function qw(s){const e=s.getFrustumPlanes(),t=Bu(e.near,s.cameraPosition),n=wA(s,t),i=wA(s,s.cameraPosition,Eo);let A=0;ia.planes[A++].fromPointNormal(n,mu.copy(n).subtract(i));for(const l in e){if(l==="near")continue;const h=e[l],g=Bu(h,t,Eo),B=wA(s,g,Eo);ia.planes[A++].fromPointNormal(B,mu.copy(n).subtract(B))}}function Bu(s,e,t=new k){const n=s.normal.dot(e);return t.copy(s.normal).scale(s.distance-n).add(e),t}function wA(s,e,t=new k){const n=s.unprojectPosition(e);return Ze.WGS84.cartographicToCartesian(n,t)}const eS=6378137,tS=6378137,Aa=6356752314245179e-9,Us=new k;function nS(s,e){if(s instanceof Gi){const{halfAxes:t}=s,n=iS(t);return Math.log2(Aa/(n+e[2]))}else if(s instanceof Oi){const{radius:t}=s;return Math.log2(Aa/(t+e[2]))}else if(s.width&&s.height){const{width:t,height:n}=s,i=Math.log2(eS/t),A=Math.log2(tS/n);return(i+A)/2}return 1}function Md(s,e,t){Ze.WGS84.cartographicToCartesian([s.xmax,s.ymax,s.zmax],Us);const n=Math.sqrt(Math.pow(Us[0]-t[0],2)+Math.pow(Us[1]-t[1],2)+Math.pow(Us[2]-t[2],2));return Math.log2(Aa/(n+e[2]))}function sS(s,e,t){const[n,i,A,l]=s;return Md({xmax:A,ymax:l,zmax:0},e,t)}function iS(s){s.getColumn(0,Us);const e=s.getColumn(1),t=s.getColumn(2);return Us.add(e).add(t).len()}const Vt={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5};var un;(function(s){s[s.ADD=1]="ADD",s[s.REPLACE=2]="REPLACE"})(un||(un={}));var In;(function(s){s.EMPTY="empty",s.SCENEGRAPH="scenegraph",s.POINTCLOUD="pointcloud",s.MESH="mesh"})(In||(In={}));var Ot;(function(s){s.I3S="I3S",s.TILES3D="TILES3D"})(Ot||(Ot={}));var Ys;(function(s){s.GEOMETRIC_ERROR="geometricError",s.MAX_SCREEN_THRESHOLD="maxScreenThreshold"})(Ys||(Ys={}));const AS={USE_OPTIMIZATION:1};function wd(s){return s!=null}const It=new k,SA=new k,rS=new k,oS=new k,qn=new k,Cu=new k,_u=new k,yu=new k;function To(s,e,t){if(nt(s,"3D Tile: boundingVolume must be defined"),s.box)return Sd(s.box,e,t);if(s.region)return lS(s.region);if(s.sphere)return cS(s.sphere,e,t);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function aS(s,e){if(s.box)return uS(e);if(s.region){const[t,n,i,A,l,h]=s.region;return[[Mt(t),Mt(n),l],[Mt(i),Mt(A),h]]}if(s.sphere)return fS(e);throw new Error("Unkown boundingVolume type")}function Sd(s,e,t){const n=new k(s[0],s[1],s[2]);e.transform(n,n);let i=[];if(s.length===10){const B=s.slice(3,6),C=new Ti;C.fromArray(s,6);const y=new k([1,0,0]),E=new k([0,1,0]),T=new k([0,0,1]);y.transformByQuaternion(C),y.scale(B[0]),E.transformByQuaternion(C),E.scale(B[1]),T.transformByQuaternion(C),T.scale(B[2]),i=[...y.toArray(),...E.toArray(),...T.toArray()]}else i=[...s.slice(3,6),...s.slice(6,9),...s.slice(9,12)];const A=e.transformAsVector(i.slice(0,3)),l=e.transformAsVector(i.slice(3,6)),h=e.transformAsVector(i.slice(6,9)),g=new At([A[0],A[1],A[2],l[0],l[1],l[2],h[0],h[1],h[2]]);return wd(t)?(t.center=n,t.halfAxes=g,t):new Gi(n,g)}function cS(s,e,t){const n=new k(s[0],s[1],s[2]);e.transform(n,n);const i=e.getScale(SA),A=Math.max(Math.max(i[0],i[1]),i[2]),l=s[3]*A;return wd(t)?(t.center=n,t.radius=l,t):new Oi(n,l)}function lS(s){const[e,t,n,i,A,l]=s,h=Ze.WGS84.cartographicToCartesian([Mt(e),Mt(i),A],rS),g=Ze.WGS84.cartographicToCartesian([Mt(n),Mt(t),l],oS),B=new k().addVectors(h,g).multiplyByScalar(.5);return Ze.WGS84.cartesianToCartographic(B,qn),Ze.WGS84.cartographicToCartesian([Mt(n),qn[1],qn[2]],Cu),Ze.WGS84.cartographicToCartesian([qn[0],Mt(i),qn[2]],_u),Ze.WGS84.cartographicToCartesian([qn[0],qn[1],l],yu),Sd([...B,...Cu.subtract(B),..._u.subtract(B),...yu.subtract(B)],new Fe)}function uS(s){const e=xd(),{halfAxes:t}=s,n=new k(t.getColumn(0)),i=new k(t.getColumn(1)),A=new k(t.getColumn(2));for(let l=0;l<2;l++){for(let h=0;h<2;h++){for(let g=0;g<2;g++)It.copy(s.center),It.add(n),It.add(i),It.add(A),Dd(e,It),A.negate();i.negate()}n.negate()}return e}function fS(s){const e=xd(),{center:t,radius:n}=s,i=Ze.WGS84.scaleToGeodeticSurface(t,It);let A;i?A=Ze.WGS84.geodeticSurfaceNormal(i):A=new k(0,0,1);let l=new k(A[2],-A[1],0);l.len()>0?l.normalize():l=new k(0,1,0);const h=l.clone().cross(A);for(const g of[l,h,A]){SA.copy(g).scale(n);for(let B=0;B<2;B++)It.copy(t),It.add(SA),Dd(e,It),SA.negate()}return e}function xd(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function Dd(s,e){Ze.WGS84.cartesianToCartographic(e,It),s[0][0]=Math.min(s[0][0],It[0]),s[0][1]=Math.min(s[0][1],It[1]),s[0][2]=Math.min(s[0][2],It[2]),s[1][0]=Math.max(s[1][0],It[0]),s[1][1]=Math.max(s[1][1],It[1]),s[1][2]=Math.max(s[1][2],It[2])}new k;new k;new Fe;new k;new k;new k;function hS(s,e){const t=s*e;return 1-Math.exp(-(t*t))}function dS(s,e){if(s.dynamicScreenSpaceError&&s.dynamicScreenSpaceErrorComputedDensity){const t=s.dynamicScreenSpaceErrorComputedDensity,n=s.dynamicScreenSpaceErrorFactor;return hS(e,t)*n}return 0}function gS(s,e,t){const n=s.tileset,i=s.parent&&s.parent.lodMetricValue||s.lodMetricValue,A=t?i:s.lodMetricValue;if(A===0)return 0;const l=Math.max(s._distanceToCamera,1e-7),{height:h,sseDenominator:g}=e,{viewDistanceScale:B}=n.options;let C=A*h*(B||1)/(l*g);return C-=dS(n,l),C}const vo=new k,bu=new k,Nn=new k,Eu=new k,pS=new k,Io=new Fe,Tu=new Fe;function mS(s,e){if(s.lodMetricValue===0||isNaN(s.lodMetricValue))return"DIG";const t=2*Pd(s,e);return t<2?"OUT":!s.header.children||t<=s.lodMetricValue?"DRAW":s.header.children?"DIG":"OUT"}function Pd(s,e){const{topDownViewport:t}=e,n=s.header.mbs[1],i=s.header.mbs[0],A=s.header.mbs[2],l=s.header.mbs[3],h=[...s.boundingVolume.center],g=t.unprojectPosition(t.cameraPosition);Ze.WGS84.cartographicToCartesian(g,vo),bu.copy(vo).subtract(h).normalize(),Ze.WGS84.eastNorthUpToFixedFrame(h,Io),Tu.copy(Io).invert(),Nn.copy(vo).transform(Tu);const B=Math.sqrt(Nn[0]*Nn[0]+Nn[1]*Nn[1]),C=B*B/Nn[2];Eu.copy([Nn[0],Nn[1],C]);const E=Eu.transform(Io).subtract(h).normalize(),x=bu.cross(E).normalize().scale(l).add(h),F=Ze.WGS84.cartesianToCartographic(x),N=t.project([i,n,A]),R=t.project(F);return pS.copy(N).subtract(R).magnitude()}function BS(s){return{assetGltfUpAxis:s.asset&&s.asset.gltfUpAxis||"Y"}}class vu{constructor(e=0){G(this,"_map",new Map);G(this,"_array");G(this,"_length");this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return nt(e<this._array.length),this._array[e]}set(e,t){nt(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=t,this._map.set(t,e)}delete(e){const t=this._map.get(e);t>=0&&(this._array.splice(t,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){const t=this.length++;this._array[t]=e,this._map.set(e,t)}}pop(){const e=this._array[--this.length];return this._map.delete(e),e}reserve(e){nt(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){nt(e>=0),this.length=e}trim(e){e==null&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}}const CS={loadSiblings:!1,skipLevelOfDetail:!1,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class mr{constructor(e){G(this,"options");G(this,"root",null);G(this,"selectedTiles",{});G(this,"requestedTiles",{});G(this,"emptyTiles",{});G(this,"lastUpdate",new Date().getTime());G(this,"updateDebounceTime",1e3);G(this,"_traversalStack",new vu);G(this,"_emptyTraversalStack",new vu);G(this,"_frameNumber",null);this.options={...CS,...e}}traversalFinished(e){return!0}traverse(e,t,n){this.root=e,this.options={...this.options,...n},this.reset(),this.updateTile(e,t),this._frameNumber=t.frameNumber,this.executeTraversal(e,t)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,t){const n=this._traversalStack;for(e._selectionDepth=1,n.push(e);n.length>0;){const A=n.pop();let l=!1;this.canTraverse(A,t)&&(this.updateChildTiles(A,t),l=this.updateAndPushChildren(A,t,n,A.hasRenderContent?A._selectionDepth+1:A._selectionDepth));const h=A.parent,g=!!(!h||h._shouldRefine),B=!l;A.hasRenderContent?A.refine===un.ADD?(this.loadTile(A,t),this.selectTile(A,t)):A.refine===un.REPLACE&&(this.loadTile(A,t),B&&this.selectTile(A,t)):(this.emptyTiles[A.id]=A,this.loadTile(A,t),B&&this.selectTile(A,t)),this.touchTile(A,t),A._shouldRefine=l&&g}const i=new Date().getTime();(this.traversalFinished(t)||i-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=i,this.options.onTraversalEnd(t))}updateChildTiles(e,t){const n=e.children;for(const i of n)this.updateTile(i,t)}updateAndPushChildren(e,t,n,i){const{loadSiblings:A,skipLevelOfDetail:l}=this.options,h=e.children;h.sort(this.compareDistanceToCamera.bind(this));const g=e.refine===un.REPLACE&&e.hasRenderContent&&!l;let B=!1,C=!0;for(const y of h)if(y._selectionDepth=i,y.isVisibleAndInRequestVolume?(n.find(y)&&n.delete(y),n.push(y),B=!0):(g||A)&&(this.loadTile(y,t),this.touchTile(y,t)),g){let E;if(y._inRequestVolume?y.hasRenderContent?E=y.contentAvailable:E=this.executeEmptyTraversal(y,t):E=!1,C=C&&E,!C)return!1}return B||(C=!1),C}updateTile(e,t){this.updateTileVisibility(e,t)}selectTile(e,t){this.shouldSelectTile(e)&&(e._selectedFrame=t.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,t){this.shouldLoadTile(e)&&(e._requestedFrame=t.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,t){e.tileset._cache.touch(e),e._touchedFrame=t.frameNumber}canTraverse(e,t){return e.hasChildren?e.hasTilesetContent?!e.contentExpired:this.shouldRefine(e,t):!1}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,t,n=!1){let i=e._screenSpaceError;return n&&(i=e.getScreenSpaceError(t,!0)),i>e.tileset.memoryAdjustedScreenSpaceError}updateTileVisibility(e,t){const n=[];if(this.options.viewportTraversersMap)for(const i in this.options.viewportTraversersMap)this.options.viewportTraversersMap[i]===t.viewport.id&&n.push(i);else n.push(t.viewport.id);e.updateVisibility(t,n)}compareDistanceToCamera(e,t){return e._distanceToCamera-t._distanceToCamera}anyChildrenVisible(e,t){let n=!1;for(const i of e.children)i.updateVisibility(t),n=n||i.isVisibleAndInRequestVolume;return n}executeEmptyTraversal(e,t){let n=!0;const i=this._emptyTraversalStack;for(i.push(e);i.length>0;){const A=i.pop(),l=!A.hasRenderContent&&this.canTraverse(A,t),h=!A.hasRenderContent&&A.children.length===0;if(!l&&!A.contentAvailable&&!h&&(n=!1),this.updateTile(A,t),A.isVisibleAndInRequestVolume||(this.loadTile(A,t),this.touchTile(A,t)),l){const g=A.children;for(const B of g)i.push(B)}}return n}}const Iu=new k;function _S(s){return s!=null}class ra{constructor(e,t,n,i=""){G(this,"tileset");G(this,"header");G(this,"id");G(this,"url");G(this,"parent");G(this,"refine");G(this,"type");G(this,"contentUrl");G(this,"lodMetricType","geometricError");G(this,"lodMetricValue",0);G(this,"boundingVolume",null);G(this,"content",null);G(this,"contentState",Vt.UNLOADED);G(this,"gpuMemoryUsageInBytes",0);G(this,"children",[]);G(this,"depth",0);G(this,"viewportIds",[]);G(this,"transform",new Fe);G(this,"extensions",null);G(this,"implicitTiling",null);G(this,"userData",{});G(this,"computedTransform");G(this,"hasEmptyContent",!1);G(this,"hasTilesetContent",!1);G(this,"traverser",new mr({}));G(this,"_cacheNode",null);G(this,"_frameNumber",null);G(this,"_expireDate",null);G(this,"_expiredContent",null);G(this,"_boundingBox");G(this,"_distanceToCamera",0);G(this,"_screenSpaceError",0);G(this,"_visibilityPlaneMask");G(this,"_visible");G(this,"_contentBoundingVolume");G(this,"_viewerRequestVolume");G(this,"_initialTransform",new Fe);G(this,"_priority",0);G(this,"_selectedFrame",0);G(this,"_requestedFrame",0);G(this,"_selectionDepth",0);G(this,"_touchedFrame",0);G(this,"_centerZDepth",0);G(this,"_shouldRefine",!1);G(this,"_stackLength",0);G(this,"_visitedFrame",0);G(this,"_inRequestVolume",!1);G(this,"_lodJudge",null);this.header=t,this.tileset=e,this.id=i||t.id,this.url=t.url,this.parent=n,this.refine=this._getRefine(t.refine),this.type=t.type,this.contentUrl=t.contentUrl,this._initializeLodMetric(t),this._initializeTransforms(t),this._initializeBoundingVolumes(t),this._initializeContent(t),this._initializeRenderingState(t),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===Vt.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===Vt.UNLOADED}get contentExpired(){return this.contentState===Vt.EXPIRED}get contentFailed(){return this.contentState===Vt.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=aS(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(e,t){switch(this.tileset.type){case Ot.I3S:return Pd(this,e);case Ot.TILES3D:return gS(this,e,t);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const e=this.tileset._traverser,{skipLevelOfDetail:t}=e.options,n=this.refine===un.ADD||t;if(n&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===Vt.UNLOADED)return-1;const i=this.parent,l=i&&(!n||this._screenSpaceError===0||i.hasTilesetContent)?i._screenSpaceError:this._screenSpaceError,h=e.root?e.root._screenSpaceError:0;return Math.max(h-l,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=Vt.LOADING;const t=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!t)return this.contentState=Vt.UNLOADED,!1;try{const n=this.tileset.getTileUrl(this.contentUrl),i=this.tileset.loader,A={...this.tileset.loadOptions,[i.id]:{...this.tileset.loadOptions[i.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(i.id)}};return this.content=await ti(n,i,A),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=Vt.READY,this._onContentLoaded(),!0}catch(n){throw this.contentState=Vt.FAILED,n}finally{t.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=Vt.UNLOADED,!0}updateVisibility(e,t){if(this._frameNumber===e.frameNumber)return;const n=this.parent,i=n?n._visibilityPlaneMask:jt.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const A=n?n.computedTransform:this.tileset.modelMatrix;this._updateTransform(A)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,i),this._visible=this._visibilityPlaneMask!==jt.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=t}visibility(e,t){const{cullingVolume:n}=e,{boundingVolume:i}=this;return n.computeVisibilityWithPlaneMask(i,t)}contentVisibility(){return!0}distanceToTile(e){const t=this.boundingVolume;return Math.sqrt(Math.max(t.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth({camera:e}){const t=this.boundingVolume;return Iu.subVectors(t.center,e.position),e.direction.dot(Iu)}insideViewerRequestVolume(e){const t=this._viewerRequestVolume;return!t||t.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(_S(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=Vt.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new Fe(e.transform):new Fe;const t=this.parent,n=this.tileset,i=t&&t.computedTransform?t.computedTransform.clone():n.modelMatrix.clone();this.computedTransform=new Fe(i).multiplyRight(this.transform);const A=t&&t._initialTransform?t._initialTransform.clone():new Fe;this._initialTransform=new Fe(A).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=Vt.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=jt.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||un.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(e){this.boundingVolume=To(e.boundingVolume,this.computedTransform,this.boundingVolume);const t=e.content;t&&(t.boundingVolume&&(this._contentBoundingVolume=To(t.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=To(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(e=new Fe){const t=e.clone().multiplyRight(this.transform);t.equals(this.computedTransform)||(this.computedTransform=t,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){switch(e){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return BS(this.tileset.tileset)}}}class yS extends mr{compareDistanceToCamera(e,t){return t._distanceToCamera===0&&e._distanceToCamera===0?t._centerZDepth-e._centerZDepth:t._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,t){if(super.updateTileVisibility(e,t),!e.isVisibleAndInRequestVolume)return;const n=e.children.length>0;if(e.hasTilesetContent&&n){const l=e.children[0];this.updateTileVisibility(l,t),e._visible=l._visible;return}if(this.meetsScreenSpaceErrorEarly(e,t)){e._visible=!1;return}const i=e.refine===un.REPLACE,A=e._optimChildrenWithinParent===AS.USE_OPTIMIZATION;if(i&&A&&n&&!this.anyChildrenVisible(e,t)){e._visible=!1;return}}meetsScreenSpaceErrorEarly(e,t){const{parent:n}=e;return!n||n.hasTilesetContent||n.refine!==un.ADD?!1:!this.shouldRefine(e,t,!0)}}class bS{constructor(){G(this,"frameNumberMap",new Map)}register(e,t){const n=this.frameNumberMap.get(e)||new Map,i=n.get(t)||0;n.set(t,i+1),this.frameNumberMap.set(e,n)}deregister(e,t){const n=this.frameNumberMap.get(e);if(!n)return;const i=n.get(t)||1;n.set(t,i-1)}isZero(e,t){var i;return(((i=this.frameNumberMap.get(e))==null?void 0:i.get(t))||0)===0}}const Mo={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class ES{constructor(){G(this,"_statusMap");G(this,"pendingTilesRegister",new bS);this._statusMap={}}add(e,t,n,i){if(!this._statusMap[t]){const{frameNumber:A,viewport:{id:l}}=i;this._statusMap[t]={request:e,callback:n,key:t,frameState:i,status:Mo.REQUESTED},this.pendingTilesRegister.register(l,A),e().then(h=>{this._statusMap[t].status=Mo.COMPLETED;const{frameNumber:g,viewport:{id:B}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(B,g),this._statusMap[t].callback(h,i)}).catch(h=>{this._statusMap[t].status=Mo.ERROR;const{frameNumber:g,viewport:{id:B}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(B,g),n(h)})}}update(e,t){if(this._statusMap[e]){const{frameNumber:n,viewport:{id:i}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(i,n);const{frameNumber:A,viewport:{id:l}}=t;this.pendingTilesRegister.register(l,A),this._statusMap[e].frameState=t}}find(e){return this._statusMap[e]}hasPendingTiles(e,t){return!this.pendingTilesRegister.isZero(e,t)}}class TS extends mr{constructor(t){super(t);G(this,"_tileManager");this._tileManager=new ES}traversalFinished(t){return!this._tileManager.hasPendingTiles(t.viewport.id,this._frameNumber||0)}shouldRefine(t,n){return t._lodJudge=mS(t,n),t._lodJudge==="DIG"}updateChildTiles(t,n){const i=t.header.children||[],A=t.children,l=t.tileset;for(const h of i){const g=`${h.id}-${n.viewport.id}`,B=A&&A.find(C=>C.id===g);if(B)B&&this.updateTile(B,n);else{let C=()=>this._loadTile(h.id,l);this._tileManager.find(g)?this._tileManager.update(g,n):(l.tileset.nodePages&&(C=()=>l.tileset.nodePagesTile.formTileFromNodePages(h.id)),this._tileManager.add(C,g,E=>this._onTileLoad(E,t,g),n))}}return!1}async _loadTile(t,n){const{loader:i}=n,A=n.getTileUrl(`${n.url}/nodes/${t}`),l={...n.loadOptions,i3s:{...n.loadOptions.i3s,isTileHeader:!0}};return await ti(A,i,l)}_onTileLoad(t,n,i){const A=new ra(n.tileset,t,n,i);n.children.push(A);const l=this._tileManager.find(A.id).frameState;this.updateTile(A,l),this._frameNumber===l.frameNumber&&(this.traversalFinished(l)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(A,l)}}const vS={description:"",ellipsoid:Ze.WGS84,modelMatrix:new Fe,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,memoryCacheOverflow:1,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:s=>s,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,memoryAdjustedScreenSpaceError:!1,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},dA="Tiles In Tileset(s)",wo="Tiles In Memory",Mu="Tiles In View",wu="Tiles To Render",Su="Tiles Loaded",So="Tiles Loading",xu="Tiles Unloaded",Du="Failed Tile Loads",Pu="Points/Vertices",xo="Tile Memory Use",Fu="Maximum Screen Space Error";class IS{constructor(e,t){G(this,"options");G(this,"loadOptions");G(this,"type");G(this,"tileset");G(this,"loader");G(this,"url");G(this,"basePath");G(this,"modelMatrix");G(this,"ellipsoid");G(this,"lodMetricType");G(this,"lodMetricValue");G(this,"refine");G(this,"root",null);G(this,"roots",{});G(this,"asset",{});G(this,"description","");G(this,"properties");G(this,"extras",null);G(this,"attributions",{});G(this,"credits",{});G(this,"stats");G(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1});G(this,"cartographicCenter",null);G(this,"cartesianCenter",null);G(this,"zoom",1);G(this,"boundingVolume",null);G(this,"dynamicScreenSpaceErrorComputedDensity",0);G(this,"maximumMemoryUsage",32);G(this,"gpuMemoryUsageInBytes",0);G(this,"memoryAdjustedScreenSpaceError",0);G(this,"_cacheBytes",0);G(this,"_cacheOverflowBytes",0);G(this,"_frameNumber",0);G(this,"_queryParams",{});G(this,"_extensionsUsed",[]);G(this,"_tiles",{});G(this,"_pendingCount",0);G(this,"selectedTiles",[]);G(this,"traverseCounter",0);G(this,"geometricError",0);G(this,"lastUpdatedVieports",null);G(this,"_requestedTiles",[]);G(this,"_emptyTiles",[]);G(this,"frameStateData",{});G(this,"_traverser");G(this,"_cache",new Xw);G(this,"_requestScheduler");G(this,"updatePromise",null);G(this,"tilesetInitializationPromise");this.options={...vS,...t},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||Vf(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new Xf({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.memoryAdjustedScreenSpaceError=this.options.maximumScreenSpaceError,this._cacheBytes=this.options.maximumMemoryUsage*1024*1024,this._cacheOverflowBytes=this.options.memoryCacheOverflow*1024*1024,this.stats=new Ef({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(e){this.options={...this.options,...e}}getTileUrl(e){if(e.startsWith("data:"))return e;let n=e;return this.queryParams.length&&(n=`${e}${e.includes("?")?"&":"?"}${this.queryParams}`),n}hasExtension(e){return this._extensionsUsed.indexOf(e)>-1}update(e=null){this.tilesetInitializationPromise.then(()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)})}async selectTiles(e=null){return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise(t=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),t(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}adjustScreenSpaceError(){this.gpuMemoryUsageInBytes<this._cacheBytes?this.memoryAdjustedScreenSpaceError=Math.max(this.memoryAdjustedScreenSpaceError/1.02,this.options.maximumScreenSpaceError):this.gpuMemoryUsageInBytes>this._cacheBytes+this._cacheOverflowBytes&&(this.memoryAdjustedScreenSpaceError*=1.02)}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const t=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=t.length;const n=[];for(const i of t){const A=i.id;this._needTraverse(A)?n.push(A):this.traverseCounter--}for(const i of t){const A=i.id;if(this.roots[A]||(this.roots[A]=this._initializeTileHeaders(this.tileset,null)),!n.includes(A))continue;const l=$w(i,this._frameNumber);this._traverser.traverse(this.roots[A],l,this.options)}}_needTraverse(e){let t=e;return this.options.viewportTraversersMap&&(t=this.options.viewportTraversersMap[e]),t===e}_onTraversalEnd(e){const t=e.viewport.id;this.frameStateData[t]||(this.frameStateData[t]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const n=this.frameStateData[t],i=Object.values(this._traverser.selectedTiles),[A,l]=Zw(i,e,this.options.maximumTilesSelected);n.selectedTiles=A;for(const h of l)h.unselect();n._requestedTiles=Object.values(this._traverser.requestedTiles),n._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const e in this.frameStateData){const t=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(t.selectedTiles),this._requestedTiles=this._requestedTiles.concat(t._requestedTiles),this._emptyTiles=this._emptyTiles.concat(t._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,t){if(e.length!==t.length)return!0;const n=new Set(e.map(l=>l.id)),i=new Set(t.map(l=>l.id));let A=e.filter(l=>!i.has(l.id)).length>0;return A=A||t.filter(l=>!n.has(l.id)).length>0,A}_loadTiles(){for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,(e,t)=>e._unloadTile(t))}_updateStats(){let e=0,t=0;for(const n of this.selectedTiles)n.contentAvailable&&n.content&&(e++,n.content.pointCount?t+=n.content.pointCount:t+=n.content.vertexCount);this.stats.get(Mu).count=this.selectedTiles.length,this.stats.get(wu).count=e,this.stats.get(Pu).count=t,this.stats.get(Fu).count=this.memoryAdjustedScreenSpaceError}async _initializeTileSet(e){this.type===Ot.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===Ot.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===Ot.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var n;const e=this.tileset.fullExtent;if(e){const{xmin:i,xmax:A,ymin:l,ymax:h,zmin:g,zmax:B}=e;this.cartographicCenter=new k(i+(A-i)/2,l+(h-l)/2,g+(B-g)/2),this.cartesianCenter=new k,Ze.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=Md(e,this.cartographicCenter,this.cartesianCenter);return}const t=(n=this.tileset.store)==null?void 0:n.extent;if(t){const[i,A,l,h]=t;this.cartographicCenter=new k(i+(l-i)/2,A+(h-A)/2,0),this.cartesianCenter=new k,Ze.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=sS(t,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new k,this.zoom=1}calculateViewPropsTiles3D(){const e=this.root,{center:t}=e.boundingVolume;if(!t){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new k,this.zoom=1;return}t[0]!==0||t[1]!==0||t[2]!==0?(this.cartographicCenter=new k,Ze.WGS84.cartesianToCartographic(t,this.cartographicCenter)):this.cartographicCenter=new k(0,0,-Ze.WGS84.radii[0]),this.cartesianCenter=t,this.zoom=nS(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(dA),this.stats.get(So),this.stats.get(wo),this.stats.get(Mu),this.stats.get(wu),this.stats.get(Su),this.stats.get(xu),this.stats.get(Du),this.stats.get(Pu),this.stats.get(xo,"memory"),this.stats.get(Fu)}_initializeTileHeaders(e,t){var i;const n=new ra(this,e.root,t);if(t&&(t.children.push(n),n.depth=t.depth+1),this.type===Ot.TILES3D){const A=[];for(A.push(n);A.length>0;){const l=A.pop();this.stats.get(dA).incrementCount();const h=l.header.children||[];for(const g of h){const B=new ra(this,g,l);if((i=B.contentUrl)!=null&&i.includes("?session=")){const y=new URL(B.contentUrl).searchParams.get("session");y&&(this._queryParams.session=y)}l.children.push(B),B.depth=l.depth+1,A.push(B)}}}return n}_initializeTraverser(){let e;switch(this.type){case Ot.TILES3D:e=yS;break;case Ot.I3S:e=TS;break;default:e=mr}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let t;try{this._onStartTileLoading(),t=await e.loadContent()}catch(n){this._onTileLoadError(e,n instanceof Error?n:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(e,t)}}_onTileLoadError(e,t){this.stats.get(Du).incrementCount();const n=t.message||t.toString(),i=e.url;console.error(`A 3D tile failed to load: ${e.url} ${n}`),this.options.onTileError(e,n,i)}_onTileLoad(e,t){var n,i;if(t){if(this.type===Ot.I3S){const A=((i=(n=this.tileset)==null?void 0:n.nodePagesTile)==null?void 0:i.nodesInNodePages)||0;this.stats.get(dA).reset(),this.stats.get(dA).addCount(A)}e&&e.content&&Yw(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}updateContentTypes(e){var t;if(this.type===Ot.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===Ot.TILES3D){const{extensionsRemoved:n=[]}=((t=e.content)==null?void 0:t.gltf)||{};n.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),n.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),n.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(So).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(So).decrementCount()}_addTileToCache(e){this._cache.add(this,e,t=>t._updateCacheStats(e))}_updateCacheStats(e){this.stats.get(Su).incrementCount(),this.stats.get(wo).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get(xo).count=this.gpuMemoryUsageInBytes,this.options.memoryAdjustedScreenSpaceError&&this.adjustScreenSpaceError()}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get(wo).decrementCount(),this.stats.get(xu).incrementCount(),this.stats.get(xo).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){const e=[];for(this.root&&e.push(this.root);e.length>0;){const t=e.pop();for(const n of t.children)e.push(n);this._destroyTile(t)}this.root=null}_destroySubtree(e){const t=e,n=[];for(n.push(t);n.length>0;){e=n.pop();for(const i of e.children)n.push(i);e!==t&&this._destroyTile(e)}t.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(e.queryString){const t=new URLSearchParams(e.queryString),n=Object.fromEntries(t.entries());this._queryParams={...this._queryParams,...n}}if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0"&&this.asset.version!=="1.1")throw new Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const Fd="4.3.2",mi={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GLTF:"glTF"};function Ld(s,e,t){nt(s instanceof ArrayBuffer);const n=new TextDecoder("utf8"),i=new Uint8Array(s,e,t);return n.decode(i)}function MS(s,e=0){const t=new DataView(s);return`${String.fromCharCode(t.getUint8(e+0))}${String.fromCharCode(t.getUint8(e+1))}${String.fromCharCode(t.getUint8(e+2))}${String.fromCharCode(t.getUint8(e+3))}`}const wS="4.3.2",SS={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:wS,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function xS(s,e,t){const n=Rd(e.metadata),i=[],A=DS(e.attributes);for(const l in s){const h=s[l],g=Lu(l,h,A[l]);i.push(g)}if(t){const l=Lu("indices",t);i.push(l)}return{fields:i,metadata:n}}function DS(s){const e={};for(const t in s){const n=s[t];e[n.name||"undefined"]=n}return e}function Lu(s,e,t){const n=t?Rd(t.metadata):void 0;return Yf(s,e,n)}function Rd(s){Object.entries(s);const e={};for(const t in s)e[`${t}.string`]=JSON.stringify(s[t]);return e}const Ru={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},PS={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},FS=4;class LS{constructor(e){G(this,"draco");G(this,"decoder");G(this,"metadataQuerier");this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e,t={}){const n=new this.draco.DecoderBuffer;n.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(t);const i=this.decoder.GetEncodedGeometryType(n),A=i===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let l;switch(i){case this.draco.TRIANGULAR_MESH:l=this.decoder.DecodeBufferToMesh(n,A);break;case this.draco.POINT_CLOUD:l=this.decoder.DecodeBufferToPointCloud(n,A);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!l.ok()||!A.ptr){const E=`DRACO decompression failed: ${l.error_msg()}`;throw new Error(E)}const h=this._getDracoLoaderData(A,i,t),g=this._getMeshData(A,h,t),B=Ca(g.attributes),C=xS(g.attributes,h,g.indices);return{loader:"draco",loaderData:h,header:{vertexCount:A.num_points(),boundingBox:B},...g,schema:C}}finally{this.draco.destroy(n),A&&this.draco.destroy(A)}}_getDracoLoaderData(e,t,n){const i=this._getTopLevelMetadata(e),A=this._getDracoAttributes(e,n);return{geometry_type:t,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:i,attributes:A}}_getDracoAttributes(e,t){const n={};for(let i=0;i<e.num_attributes();i++){const A=this.decoder.GetAttribute(e,i),l=this._getAttributeMetadata(e,i);n[A.unique_id()]={unique_id:A.unique_id(),attribute_type:A.attribute_type(),data_type:A.data_type(),num_components:A.num_components(),byte_offset:A.byte_offset(),byte_stride:A.byte_stride(),normalized:A.normalized(),attribute_index:i,metadata:l};const h=this._getQuantizationTransform(A,t);h&&(n[A.unique_id()].quantization_transform=h);const g=this._getOctahedronTransform(A,t);g&&(n[A.unique_id()].octahedron_transform=g)}return n}_getMeshData(e,t,n){const i=this._getMeshAttributes(t,e,n);if(!i.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(n.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:i,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:i,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:i}}_getMeshAttributes(e,t,n){const i={};for(const A of Object.values(e.attributes)){const l=this._deduceAttributeName(A,n);A.name=l;const h=this._getAttributeValues(t,A);if(h){const{value:g,size:B}=h;i[l]={value:g,size:B,byteOffset:A.byte_offset,byteStride:A.byte_stride,normalized:A.normalized}}}return i}_getTriangleListIndices(e){const n=e.num_faces()*3,i=n*FS,A=this.draco._malloc(i);try{return this.decoder.GetTrianglesUInt32Array(e,i,A),new Uint32Array(this.draco.HEAPF32.buffer,A,n).slice()}finally{this.draco._free(A)}}_getTriangleStripIndices(e){const t=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,t),GS(t)}finally{this.draco.destroy(t)}}_getAttributeValues(e,t){const n=PS[t.data_type];if(!n)return console.warn(`DRACO: Unsupported attribute type ${t.data_type}`),null;const i=t.num_components,l=e.num_points()*i,h=l*n.BYTES_PER_ELEMENT,g=RS(this.draco,n);let B;const C=this.draco._malloc(h);try{const y=this.decoder.GetAttribute(e,t.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,y,g,h,C),B=new n(this.draco.HEAPF32.buffer,C,l).slice()}finally{this.draco._free(C)}return{value:B,size:i}}_deduceAttributeName(e,t){const n=e.unique_id;for(const[l,h]of Object.entries(t.extraAttributes||{}))if(h===n)return l;const i=e.attribute_type;for(const l in Ru)if(this.draco[l]===i)return Ru[l];const A=t.attributeNameEntry||"name";return e.metadata[A]?e.metadata[A].string:`CUSTOM_ATTRIBUTE_${n}`}_getTopLevelMetadata(e){const t=this.decoder.GetMetadata(e);return this._getDracoMetadata(t)}_getAttributeMetadata(e,t){const n=this.decoder.GetAttributeMetadata(e,t);return this._getDracoMetadata(n)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const t={},n=this.metadataQuerier.NumEntries(e);for(let i=0;i<n;i++){const A=this.metadataQuerier.GetEntryName(e,i);t[A]=this._getDracoMetadataField(e,A)}return t}_getDracoMetadataField(e,t){const n=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,t,n);const i=OS(n);return{int:this.metadataQuerier.GetIntEntry(e,t),string:this.metadataQuerier.GetStringEntry(e,t),double:this.metadataQuerier.GetDoubleEntry(e,t),intArray:i}}finally{this.draco.destroy(n)}}_disableAttributeTransforms(e){const{quantizedAttributes:t=[],octahedronAttributes:n=[]}=e,i=[...t,...n];for(const A of i)this.decoder.SkipAttributeTransform(this.draco[A])}_getQuantizationTransform(e,t){const{quantizedAttributes:n=[]}=t,i=e.attribute_type();if(n.map(l=>this.decoder[l]).includes(i)){const l=new this.draco.AttributeQuantizationTransform;try{if(l.InitFromAttribute(e))return{quantization_bits:l.quantization_bits(),range:l.range(),min_values:new Float32Array([1,2,3]).map(h=>l.min_value(h))}}finally{this.draco.destroy(l)}}return null}_getOctahedronTransform(e,t){const{octahedronAttributes:n=[]}=t,i=e.attribute_type();if(n.map(l=>this.decoder[l]).includes(i)){const l=new this.draco.AttributeQuantizationTransform;try{if(l.InitFromAttribute(e))return{quantization_bits:l.quantization_bits()}}finally{this.draco.destroy(l)}}return null}}function RS(s,e){switch(e){case Float32Array:return s.DT_FLOAT32;case Int8Array:return s.DT_INT8;case Int16Array:return s.DT_INT16;case Int32Array:return s.DT_INT32;case Uint8Array:return s.DT_UINT8;case Uint16Array:return s.DT_UINT16;case Uint32Array:return s.DT_UINT32;default:return s.DT_INVALID}}function OS(s){const e=s.size(),t=new Int32Array(e);for(let n=0;n<e;n++)t[n]=s.GetValue(n);return t}function GS(s){const e=s.size(),t=new Int32Array(e);for(let n=0;n<e;n++)t[n]=s.GetValue(n);return t}const NS="1.5.6",US="1.4.1",Do=`https://www.gstatic.com/draco/versioned/decoders/${NS}`,Nt={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},Po={[Nt.DECODER]:`${Do}/${Nt.DECODER}`,[Nt.DECODER_WASM]:`${Do}/${Nt.DECODER_WASM}`,[Nt.FALLBACK_DECODER]:`${Do}/${Nt.FALLBACK_DECODER}`,[Nt.ENCODER]:`https://raw.githubusercontent.com/google/draco/${US}/javascript/${Nt.ENCODER}`};let Fo;async function HS(s){const e=s.modules||{};return e.draco3d?Fo||(Fo=e.draco3d.createDecoderModule({}).then(t=>({draco:t}))):Fo||(Fo=kS(s)),await Fo}async function kS(s){let e,t;switch(s.draco&&s.draco.decoderType){case"js":e=await kt(Po[Nt.FALLBACK_DECODER],"draco",s,Nt.FALLBACK_DECODER);break;case"wasm":default:[e,t]=await Promise.all([await kt(Po[Nt.DECODER],"draco",s,Nt.DECODER),await kt(Po[Nt.DECODER_WASM],"draco",s,Nt.DECODER_WASM)])}return e=e||globalThis.DracoDecoderModule,await JS(e,t)}function JS(s,e){const t={};return e&&(t.wasmBinary=e),new Promise(n=>{s({...t,onModuleLoaded:i=>n({draco:i})})})}const Od={...SS,parse:VS};async function VS(s,e){const{draco:t}=await HS(e),n=new LS(t);try{return n.parseSync(s,e==null?void 0:e.draco)}finally{n.destroy()}}const zS={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},ut={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},ke={...zS,...ut},Lo={[ut.DOUBLE]:Float64Array,[ut.FLOAT]:Float32Array,[ut.UNSIGNED_SHORT]:Uint16Array,[ut.UNSIGNED_INT]:Uint32Array,[ut.UNSIGNED_BYTE]:Uint8Array,[ut.BYTE]:Int8Array,[ut.SHORT]:Int16Array,[ut.INT]:Int32Array},jS={DOUBLE:ut.DOUBLE,FLOAT:ut.FLOAT,UNSIGNED_SHORT:ut.UNSIGNED_SHORT,UNSIGNED_INT:ut.UNSIGNED_INT,UNSIGNED_BYTE:ut.UNSIGNED_BYTE,BYTE:ut.BYTE,SHORT:ut.SHORT,INT:ut.INT},Ro="Failed to convert GL type";class Bn{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const t in Lo)if(Lo[t]===e)return t;throw new Error(Ro)}static fromName(e){const t=jS[e];if(!t)throw new Error(Ro);return t}static getArrayType(e){switch(e){case ut.UNSIGNED_SHORT_5_6_5:case ut.UNSIGNED_SHORT_4_4_4_4:case ut.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const t=Lo[e];if(!t)throw new Error(Ro);return t}}static getByteSize(e){return Bn.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return!!Bn.getArrayType(e)}static createTypedArray(e,t,n=0,i){i===void 0&&(i=(t.byteLength-n)/Bn.getByteSize(e));const A=Bn.getArrayType(e);return new A(t,n,i)}}function QS(s,e){if(!s)throw new Error(`math.gl assertion failed. ${e}`)}function KS(s,e=[0,0,0]){const t=s>>11&31,n=s>>5&63,i=s&31;return e[0]=t<<3,e[1]=n<<2,e[2]=i<<3,e}new _a;new k;new _a;new _a;function Ou(s,e=255){return Ft(s,0,e)/e*2-1}function Gu(s){return s<0?-1:1}function WS(s,e,t,n){if(QS(n),s<0||s>t||e<0||e>t)throw new Error(`x and y must be unsigned normalized integers between 0 and ${t}`);if(n.x=Ou(s,t),n.y=Ou(e,t),n.z=1-(Math.abs(n.x)+Math.abs(n.y)),n.z<0){const i=n.x;n.x=(1-Math.abs(n.y))*Gu(i),n.y=(1-Math.abs(i))*Gu(n.y)}return n.normalize()}function XS(s,e,t){return WS(s,e,255,t)}class Ya{constructor(e,t){G(this,"json");G(this,"buffer");G(this,"featuresLength",0);G(this,"_cachedTypedArrays",{});this.json=e,this.buffer=t}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return!!this.json[e]}getGlobalProperty(e,t=ke.UNSIGNED_INT,n=1){const i=this.json[e];return i&&Number.isFinite(i.byteOffset)?this._getTypedArrayFromBinary(e,t,n,1,i.byteOffset):i}getPropertyArray(e,t,n){const i=this.json[e];return i&&Number.isFinite(i.byteOffset)?("componentType"in i&&(t=Bn.fromName(i.componentType)),this._getTypedArrayFromBinary(e,t,n,this.featuresLength,i.byteOffset)):this._getTypedArrayFromArray(e,t,i)}getProperty(e,t,n,i,A){const l=this.json[e];if(!l)return l;const h=this.getPropertyArray(e,t,n);if(n===1)return h[i];for(let g=0;g<n;++g)A[g]=h[n*i+g];return A}_getTypedArrayFromBinary(e,t,n,i,A){const l=this._cachedTypedArrays;let h=l[e];return h||(h=Bn.createTypedArray(t,this.buffer.buffer,this.buffer.byteOffset+A,i*n),l[e]=h),h}_getTypedArrayFromArray(e,t,n){const i=this._cachedTypedArrays;let A=i[e];return A||(A=Bn.createTypedArray(t,n),i[e]=A),A}}const YS={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},$S={SCALAR:(s,e)=>s[e],VEC2:(s,e)=>[s[2*e+0],s[2*e+1]],VEC3:(s,e)=>[s[3*e+0],s[3*e+1],s[3*e+2]],VEC4:(s,e)=>[s[4*e+0],s[4*e+1],s[4*e+2],s[4*e+3]],MAT2:(s,e)=>[s[4*e+0],s[4*e+1],s[4*e+2],s[4*e+3]],MAT3:(s,e)=>[s[9*e+0],s[9*e+1],s[9*e+2],s[9*e+3],s[9*e+4],s[9*e+5],s[9*e+6],s[9*e+7],s[9*e+8]],MAT4:(s,e)=>[s[16*e+0],s[16*e+1],s[16*e+2],s[16*e+3],s[16*e+4],s[16*e+5],s[16*e+6],s[16*e+7],s[16*e+8],s[16*e+9],s[16*e+10],s[16*e+11],s[16*e+12],s[16*e+13],s[16*e+14],s[16*e+15]]},ZS={SCALAR:(s,e,t)=>{e[t]=s},VEC2:(s,e,t)=>{e[2*t+0]=s[0],e[2*t+1]=s[1]},VEC3:(s,e,t)=>{e[3*t+0]=s[0],e[3*t+1]=s[1],e[3*t+2]=s[2]},VEC4:(s,e,t)=>{e[4*t+0]=s[0],e[4*t+1]=s[1],e[4*t+2]=s[2],e[4*t+3]=s[3]},MAT2:(s,e,t)=>{e[4*t+0]=s[0],e[4*t+1]=s[1],e[4*t+2]=s[2],e[4*t+3]=s[3]},MAT3:(s,e,t)=>{e[9*t+0]=s[0],e[9*t+1]=s[1],e[9*t+2]=s[2],e[9*t+3]=s[3],e[9*t+4]=s[4],e[9*t+5]=s[5],e[9*t+6]=s[6],e[9*t+7]=s[7],e[9*t+8]=s[8],e[9*t+9]=s[9]},MAT4:(s,e,t)=>{e[16*t+0]=s[0],e[16*t+1]=s[1],e[16*t+2]=s[2],e[16*t+3]=s[3],e[16*t+4]=s[4],e[16*t+5]=s[5],e[16*t+6]=s[6],e[16*t+7]=s[7],e[16*t+8]=s[8],e[16*t+9]=s[9],e[16*t+10]=s[10],e[16*t+11]=s[11],e[16*t+12]=s[12],e[16*t+13]=s[13],e[16*t+14]=s[14],e[16*t+15]=s[15]}};function qS(s,e,t,n){const{componentType:i}=s;nt(s.componentType);const A=typeof i=="string"?Bn.fromName(i):i,l=YS[s.type],h=$S[s.type],g=ZS[s.type];return t+=s.byteOffset,{values:Bn.createTypedArray(A,e,t,l*n),type:A,size:l,unpacker:h,packer:g}}const mn=s=>s!==void 0;function e3(s,e,t){if(!e)return null;let n=s.getExtension("3DTILES_batch_table_hierarchy");const i=e.HIERARCHY;return i&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=i,n=i),n?t3(n,t):null}function t3(s,e){let t,n,i;const A=s.instancesLength,l=s.classes;let h=s.classIds,g=s.parentCounts,B=s.parentIds,C=A;mn(h.byteOffset)&&(h.componentType=defaultValue(h.componentType,GL.UNSIGNED_SHORT),h.type=AttributeType.SCALAR,i=getBinaryAccessor(h),h=i.createArrayBufferView(e.buffer,e.byteOffset+h.byteOffset,A));let y;if(mn(g))for(mn(g.byteOffset)&&(g.componentType=defaultValue(g.componentType,GL.UNSIGNED_SHORT),g.type=AttributeType.SCALAR,i=getBinaryAccessor(g),g=i.createArrayBufferView(e.buffer,e.byteOffset+g.byteOffset,A)),y=new Uint16Array(A),C=0,t=0;t<A;++t)y[t]=C,C+=g[t];mn(B)&&mn(B.byteOffset)&&(B.componentType=defaultValue(B.componentType,GL.UNSIGNED_SHORT),B.type=AttributeType.SCALAR,i=getBinaryAccessor(B),B=i.createArrayBufferView(e.buffer,e.byteOffset+B.byteOffset,C));const E=l.length;for(t=0;t<E;++t){const N=l[t].length,R=l[t].instances,Q=getBinaryProperties(N,R,e);l[t].instances=combine(Q,R)}const T=new Array(E).fill(0),x=new Uint16Array(A);for(t=0;t<A;++t)n=h[t],x[t]=T[n],++T[n];const F={classes:l,classIds:h,classIndexes:x,parentCounts:g,parentIndexes:y,parentIds:B};return i3(F),F}function Bi(s,e,t){if(!s)return;const n=s.parentCounts;return s.parentIds?t(s,e):n>0?n3(s,e,t):s3(s,e,t)}function n3(s,e,t){const n=s.classIds,i=s.parentCounts,A=s.parentIds,l=s.parentIndexes,h=n.length,g=scratchVisited;g.length=Math.max(g.length,h);const B=++marker,C=scratchStack;for(C.length=0,C.push(e);C.length>0;){if(e=C.pop(),g[e]===B)continue;g[e]=B;const y=t(s,e);if(mn(y))return y;const E=i[e],T=l[e];for(let x=0;x<E;++x){const F=A[T+x];F!==e&&C.push(F)}}return null}function s3(s,e,t){let n=!0;for(;n;){const i=t(s,e);if(mn(i))return i;const A=s.parentIds[e];n=A!==e,e=A}throw new Error("traverseHierarchySingleParent")}function i3(s){const t=s.classIds.length;for(let n=0;n<t;++n)Gd(s,n,stack)}function Gd(s,e,t){const n=s.parentCounts,i=s.parentIds,A=s.parentIndexes,h=s.classIds.length;if(!mn(i))return;assert(e<h,`Parent index ${e} exceeds the total number of instances: ${h}`),assert(t.indexOf(e)===-1,"Circular dependency detected in the batch table hierarchy."),t.push(e);const g=mn(n)?n[e]:1,B=mn(n)?A[e]:e;for(let C=0;C<g;++C){const y=i[B+C];y!==e&&Gd(s,y,t)}t.pop(e)}function Rt(s){return s!=null}const gA=(s,e)=>s,A3={HIERARCHY:!0,extensions:!0,extras:!0};class Nd{constructor(e,t,n,i={}){G(this,"json");G(this,"binary");G(this,"featureCount");G(this,"_extensions");G(this,"_properties");G(this,"_binaryProperties");G(this,"_hierarchy");var A;nt(n>=0),this.json=e||{},this.binary=t,this.featureCount=n,this._extensions=((A=this.json)==null?void 0:A.extensions)||{},this._properties={};for(const l in this.json)A3[l]||(this._properties[l]=this.json[l]);this._binaryProperties=this._initializeBinaryProperties(),i["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=e3(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,t){if(this._checkBatchId(e),nt(typeof t=="string",t),this._hierarchy){const n=Bi(this._hierarchy,e,(i,A)=>{const l=i.classIds[A];return i.classes[l].name===t});return Rt(n)}return!1}isExactClass(e,t){return nt(typeof t=="string",t),this.getExactClassName(e)===t}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){const t=this._hierarchy.classIds[e];return this._hierarchy.classes[t].name}}hasProperty(e,t){return this._checkBatchId(e),nt(typeof t=="string",t),Rt(this._properties[t])||this._hasPropertyInHierarchy(e,t)}getPropertyNames(e,t){this._checkBatchId(e),t=Rt(t)?t:[],t.length=0;const n=Object.keys(this._properties);return t.push(...n),this._hierarchy&&this._getPropertyNamesInHierarchy(e,t),t}getProperty(e,t){if(this._checkBatchId(e),nt(typeof t=="string",t),this._binaryProperties){const i=this._binaryProperties[t];if(Rt(i))return this._getBinaryProperty(i,e)}const n=this._properties[t];if(Rt(n))return gA(n[e]);if(this._hierarchy){const i=this._getHierarchyProperty(e,t);if(Rt(i))return i}}setProperty(e,t,n){const i=this.featureCount;if(this._checkBatchId(e),nt(typeof t=="string",t),this._binaryProperties){const l=this._binaryProperties[t];if(l){this._setBinaryProperty(l,e,n);return}}if(this._hierarchy&&this._setHierarchyProperty(this,e,t,n))return;let A=this._properties[t];Rt(A)||(this._properties[t]=new Array(i),A=this._properties[t]),A[e]=gA(n)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,t){return e.unpack(e.typedArray,t)}_setBinaryProperty(e,t,n){e.pack(n,e.typedArray,t)}_initializeBinaryProperties(){let e=null;for(const t in this._properties){const n=this._properties[t],i=this._initializeBinaryProperty(t,n);i&&(e=e||{},e[t]=i)}return e}_initializeBinaryProperty(e,t){if("byteOffset"in t){const n=t;nt(this.binary,`Property ${e} requires a batch table binary.`),nt(n.type,`Property ${e} requires a type.`);const i=qS(n,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:i.values,componentCount:i.size,unpack:i.unpacker,pack:i.packer}}return null}_hasPropertyInHierarchy(e,t){if(!this._hierarchy)return!1;const n=Bi(this._hierarchy,e,(i,A)=>{const l=i.classIds[A],h=i.classes[l].instances;return Rt(h[t])});return Rt(n)}_getPropertyNamesInHierarchy(e,t){Bi(this._hierarchy,e,(n,i)=>{const A=n.classIds[i],l=n.classes[A].instances;for(const h in l)l.hasOwnProperty(h)&&t.indexOf(h)===-1&&t.push(h)})}_getHierarchyProperty(e,t){return Bi(this._hierarchy,e,(n,i)=>{const A=n.classIds[i],l=n.classes[A],h=n.classIndexes[i],g=l.instances[t];return Rt(g)?Rt(g.typedArray)?this._getBinaryProperty(g,h):gA(g[h]):null})}_setHierarchyProperty(e,t,n,i){const A=Bi(this._hierarchy,t,(l,h)=>{const g=l.classIds[h],B=l.classes[g],C=l.classIndexes[h],y=B.instances[n];return Rt(y)?(nt(h===t,`Inherited property "${n}" is read-only.`),Rt(y.typedArray)?this._setBinaryProperty(y,C,i):y[C]=gA(i),!0):!1});return Rt(A)}}const Oo=4;function Br(s,e,t=0){const n=new DataView(e);if(s.magic=n.getUint32(t,!0),t+=Oo,s.version=n.getUint32(t,!0),t+=Oo,s.byteLength=n.getUint32(t,!0),t+=Oo,s.version!==1)throw new Error(`3D Tile Version ${s.version} not supported`);return t}const Ds=4,Nu="b3dm tile in legacy format.";function $a(s,e,t){const n=new DataView(e);let i;s.header=s.header||{};let A=n.getUint32(t,!0);t+=Ds;let l=n.getUint32(t,!0);t+=Ds;let h=n.getUint32(t,!0);t+=Ds;let g=n.getUint32(t,!0);return t+=Ds,h>=570425344?(t-=Ds*2,i=A,h=l,g=0,A=0,l=0,console.warn(Nu)):g>=570425344&&(t-=Ds,i=h,h=A,g=l,A=0,l=0,console.warn(Nu)),s.header.featureTableJsonByteLength=A,s.header.featureTableBinaryByteLength=l,s.header.batchTableJsonByteLength=h,s.header.batchTableBinaryByteLength=g,s.header.batchLength=i,t}function Za(s,e,t,n){return t=r3(s,e,t),t=o3(s,e,t),t}function r3(s,e,t,n){const{featureTableJsonByteLength:i,featureTableBinaryByteLength:A,batchLength:l}=s.header||{};if(s.featureTableJson={BATCH_LENGTH:l||0},i&&i>0){const h=Ld(e,t,i);s.featureTableJson=JSON.parse(h)}return t+=i||0,s.featureTableBinary=new Uint8Array(e,t,A),t+=A||0,t}function o3(s,e,t,n){const{batchTableJsonByteLength:i,batchTableBinaryByteLength:A}=s.header||{};if(i&&i>0){const l=Ld(e,t,i);s.batchTableJson=JSON.parse(l),t+=i,A&&A>0&&(s.batchTableBinary=new Uint8Array(e,t,A),s.batchTableBinary=new Uint8Array(s.batchTableBinary),t+=A)}return t}function Ud(s,e,t){if(!e&&(!s||!s.batchIds||!t))return null;const{batchIds:n,isRGB565:i,pointCount:A=0}=s;if(n&&t){const l=new Uint8ClampedArray(A*3);for(let h=0;h<A;h++){const g=n[h],C=t.getProperty(g,"dimensions").map(y=>y*255);l[h*3]=C[0],l[h*3+1]=C[1],l[h*3+2]=C[2]}return{type:ke.UNSIGNED_BYTE,value:l,size:3,normalized:!0}}if(e&&i){const l=new Uint8ClampedArray(A*3);for(let h=0;h<A;h++){const g=KS(e[h]);l[h*3]=g[0],l[h*3+1]=g[1],l[h*3+2]=g[2]}return{type:ke.UNSIGNED_BYTE,value:l,size:3,normalized:!0}}return e&&e.length===A*3?{type:ke.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:ke.UNSIGNED_BYTE,value:e||new Uint8ClampedArray,size:4,normalized:!0}}const Uu=new k;function a3(s,e){if(!e)return null;if(s.isOctEncoded16P){const t=new Float32Array((s.pointsLength||0)*3);for(let n=0;n<(s.pointsLength||0);n++)XS(e[n*2],e[n*2+1],Uu),Uu.toArray(t,n*3);return{type:ke.FLOAT,size:2,value:t}}return{type:ke.FLOAT,size:2,value:e}}function c3(s,e,t){return s.isQuantized?t["3d-tiles"]&&t["3d-tiles"].decodeQuantizedPositions?(s.isQuantized=!1,l3(s,e)):{type:ke.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}function l3(s,e){const t=new k,n=new Float32Array(s.pointCount*3);for(let i=0;i<s.pointCount;i++)t.set(e[i*3],e[i*3+1],e[i*3+2]).scale(1/s.quantizedRange).multiply(s.quantizedVolumeScale).add(s.quantizedVolumeOffset).toArray(n,i*3);return n}async function u3(s,e,t,n,i){t=Br(s,e,t),t=$a(s,e,t),t=Za(s,e,t),f3(s);const{featureTable:A,batchTable:l}=h3(s);return await B3(s,A,l,n,i),d3(s,A,n),g3(s,A,l),p3(s,A),t}function f3(s){s.attributes={positions:null,colors:null,normals:null,batchIds:null},s.isQuantized=!1,s.isTranslucent=!1,s.isRGB565=!1,s.isOctEncoded16P=!1}function h3(s){const e=new Ya(s.featureTableJson,s.featureTableBinary),t=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(t))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=t,s.featuresLength=t,s.pointsLength=t,s.pointCount=t,s.rtcCenter=e.getGlobalProperty("RTC_CENTER",ke.FLOAT,3);const n=m3(s,e);return{featureTable:e,batchTable:n}}function d3(s,e,t){if(s.attributes=s.attributes||{positions:null,colors:null,normals:null,batchIds:null},!s.attributes.positions){if(e.hasProperty("POSITION"))s.attributes.positions=e.getPropertyArray("POSITION",ke.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const n=e.getPropertyArray("POSITION_QUANTIZED",ke.UNSIGNED_SHORT,3);if(s.isQuantized=!0,s.quantizedRange=65535,s.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",ke.FLOAT,3),!s.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(s.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",ke.FLOAT,3),!s.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");s.attributes.positions=c3(s,n,t)}}if(!s.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function g3(s,e,t){if(s.attributes=s.attributes||{positions:null,colors:null,normals:null,batchIds:null},!s.attributes.colors){let n=null;e.hasProperty("RGBA")?(n=e.getPropertyArray("RGBA",ke.UNSIGNED_BYTE,4),s.isTranslucent=!0):e.hasProperty("RGB")?n=e.getPropertyArray("RGB",ke.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(n=e.getPropertyArray("RGB565",ke.UNSIGNED_SHORT,1),s.isRGB565=!0),s.attributes.colors=Ud(s,n,t)}e.hasProperty("CONSTANT_RGBA")&&(s.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",ke.UNSIGNED_BYTE,4))}function p3(s,e){if(s.attributes=s.attributes||{positions:null,colors:null,normals:null,batchIds:null},!s.attributes.normals){let t=null;e.hasProperty("NORMAL")?t=e.getPropertyArray("NORMAL",ke.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(t=e.getPropertyArray("NORMAL_OCT16P",ke.UNSIGNED_BYTE,2),s.isOctEncoded16P=!0),s.attributes.normals=a3(s,t)}}function m3(s,e){let t=null;if(!s.batchIds&&e.hasProperty("BATCH_ID")&&(s.batchIds=e.getPropertyArray("BATCH_ID",ke.UNSIGNED_SHORT,1),s.batchIds)){const n=e.getGlobalProperty("BATCH_LENGTH");if(!n)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:i,batchTableBinary:A}=s;t=new Nd(i,A,n)}return t}async function B3(s,e,t,n,i){let A,l,h;const g=s.batchTableJson&&s.batchTableJson.extensions&&s.batchTableJson.extensions["3DTILES_draco_point_compression"];g&&(h=g.properties);const B=e.getExtension("3DTILES_draco_point_compression");if(B){l=B.properties;const y=B.byteOffset,E=B.byteLength;if(!l||!Number.isFinite(y)||!E)throw new Error("Draco properties, byteOffset, and byteLength must be defined");A=(s.featureTableBinary||[]).slice(y,y+E),s.hasPositions=Number.isFinite(l.POSITION),s.hasColors=Number.isFinite(l.RGB)||Number.isFinite(l.RGBA),s.hasNormals=Number.isFinite(l.NORMAL),s.hasBatchIds=Number.isFinite(l.BATCH_ID),s.isTranslucent=Number.isFinite(l.RGBA)}if(!A)return!0;const C={buffer:A,properties:{...l,...h},batchTableProperties:h};return await C3(s,C,n,i)}async function C3(s,e,t,n){if(!n)return;const i={...t,draco:{...t==null?void 0:t.draco,extraAttributes:e.batchTableProperties||{}}};delete i["3d-tiles"];const A=await ls(e.buffer,Od,i,n),l=A.attributes.POSITION&&A.attributes.POSITION.value,h=A.attributes.COLOR_0&&A.attributes.COLOR_0.value,g=A.attributes.NORMAL&&A.attributes.NORMAL.value,B=A.attributes.BATCH_ID&&A.attributes.BATCH_ID.value,C=l&&A.attributes.POSITION.value.quantization,y=g&&A.attributes.NORMAL.value.quantization;if(C){const T=A.POSITION.data.quantization,x=T.range;s.quantizedVolumeScale=new k(x,x,x),s.quantizedVolumeOffset=new k(T.minValues),s.quantizedRange=(1<<T.quantizationBits)-1,s.isQuantizedDraco=!0}y&&(s.octEncodedRange=(1<<A.NORMAL.data.quantization.quantizationBits)-1,s.isOctEncodedDraco=!0);const E={};if(e.batchTableProperties)for(const T of Object.keys(e.batchTableProperties))A.attributes[T]&&A.attributes[T].value&&(E[T.toLowerCase()]=A.attributes[T].value);s.attributes={positions:l,colors:Ud(s,h,void 0),normals:g,batchIds:B,...E}}function Kt(s,e){if(!s)throw new Error(e||"assert failed: gltf")}const Hd={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},kd={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},_3=1.33,Hu=["SCALAR","VEC2","VEC3","VEC4"],y3=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],b3=new Map(y3),E3={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},T3={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},v3={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function Jd(s){return Hu[s-1]||Hu[0]}function Cr(s){const e=b3.get(s.constructor);if(!e)throw new Error("Illegal typed array");return e}function qa(s,e){const t=v3[s.componentType],n=E3[s.type],i=T3[s.componentType],A=s.count*n,l=s.count*n*i;Kt(l>=0&&l<=e.byteLength);const h=kd[s.componentType],g=Hd[s.type];return{ArrayType:t,length:A,byteLength:l,componentByteSize:h,numberOfComponentsInElement:g}}function Vd(s){let{images:e,bufferViews:t}=s;e=e||[],t=t||[];const n=e.map(l=>l.bufferView);t=t.filter(l=>!n.includes(l));const i=t.reduce((l,h)=>l+h.byteLength,0),A=e.reduce((l,h)=>{const{width:g,height:B}=h.image;return l+g*B},0);return i+Math.ceil(4*A*_3)}function I3(s,e,t){const n=s.bufferViews[t];Kt(n);const i=n.buffer,A=e[i];Kt(A);const l=(n.byteOffset||0)+A.byteOffset;return new Uint8Array(A.arrayBuffer,l,n.byteLength)}function M3(s,e,t){var F,N;const n=typeof t=="number"?(F=s.accessors)==null?void 0:F[t]:t;if(!n)throw new Error(`No gltf accessor ${JSON.stringify(t)}`);const i=(N=s.bufferViews)==null?void 0:N[n.bufferView||0];if(!i)throw new Error(`No gltf buffer view for accessor ${i}`);const{arrayBuffer:A,byteOffset:l}=e[i.buffer],h=(l||0)+(n.byteOffset||0)+(i.byteOffset||0),{ArrayType:g,length:B,componentByteSize:C,numberOfComponentsInElement:y}=qa(n,i),E=C*y,T=i.byteStride||E;if(typeof i.byteStride>"u"||i.byteStride===E)return new g(A,h,B);const x=new g(B);for(let R=0;R<n.count;R++){const Q=new g(A,h+R*T,y);x.set(Q,R*y)}return x}function w3(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}class Bt{constructor(e){G(this,"gltf");G(this,"sourceBuffers");G(this,"byteLength");this.gltf={json:(e==null?void 0:e.json)||w3(),buffers:(e==null?void 0:e.buffers)||[],images:(e==null?void 0:e.images)||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){const t=this.getUsedExtensions().find(i=>i===e),n=this.getRequiredExtensions().find(i=>i===e);return typeof t=="string"||typeof n=="string"}getExtension(e){const t=this.getUsedExtensions().find(i=>i===e),n=this.json.extensions||{};return t?n[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(n=>n===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if(typeof t=="object")return t;const n=this.json[e]&&this.json[e][t];if(!n)throw new Error(`glTF file error: Could not find ${e}[${t}]`);return n}getTypedArrayForBufferView(e){e=this.getBufferView(e);const t=e.buffer,n=this.gltf.buffers[t];Kt(n);const i=(e.byteOffset||0)+n.byteOffset;return new Uint8Array(n.arrayBuffer,i,e.byteLength)}getTypedArrayForAccessor(e){const t=this.getAccessor(e);return M3(this.gltf.json,this.gltf.buffers,t)}getTypedArrayForImageData(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),i=this.getBuffer(t.buffer).data,A=t.byteOffset||0;return new Uint8Array(i,A,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,n){return e.extensions=e.extensions||{},e.extensions[t]=n,this.registerUsedExtension(t),this}setObjectExtension(e,t,n){const i=e.extensions||{};i[t]=n}removeObjectExtension(e,t){const n=(e==null?void 0:e.extensions)||{};if(n[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const i=this.json.extensionsRemoved;i.includes(t)||i.push(t)}delete n[t]}addExtension(e,t={}){return Kt(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e,t={}){return Kt(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(t=>t===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(t=>t===e)||this.json.extensionsRequired.push(e)}removeExtension(e){var t;if((t=this.json.extensions)!=null&&t[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const n=this.json.extensionsRemoved;n.includes(e)||n.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:t}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:t}),this.json.scenes.length-1}addNode(e){const{meshIndex:t,matrix:n}=e;this.json.nodes=this.json.nodes||[];const i={mesh:t};return n&&(i.matrix=n),this.json.nodes.push(i),this.json.nodes.length-1}addMesh(e){const{attributes:t,indices:n,material:i,mode:A=4}=e,h={primitives:[{attributes:this._addAttributes(t),mode:A}]};if(n){const g=this._addIndices(n);h.primitives[0].indices=g}return Number.isFinite(i)&&(h.primitives[0].material=i),this.json.meshes=this.json.meshes||[],this.json.meshes.push(h),this.json.meshes.length-1}addPointCloud(e){const n={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(n),this.json.meshes.length-1}addImage(e,t){const n=Hf(e),i=t||(n==null?void 0:n.mimeType),l={bufferView:this.addBufferView(e),mimeType:i};return this.json.images=this.json.images||[],this.json.images.push(l),this.json.images.length-1}addBufferView(e,t=0,n=this.byteLength){const i=e.byteLength;Kt(Number.isFinite(i)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const A={buffer:t,byteOffset:n,byteLength:i};return this.byteLength+=Dn(i,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(A),this.json.bufferViews.length-1}addAccessor(e,t){const n={bufferView:e,type:Jd(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(n),this.json.accessors.length-1}addBinaryBuffer(e,t={size:3}){const n=this.addBufferView(e);let i={min:t.min,max:t.max};(!i.min||!i.max)&&(i=this._getAccessorMinMax(e,t.size));const A={size:t.size,componentType:Cr(e),count:Math.round(e.length/t.size),min:i.min,max:i.max};return this.addAccessor(n,Object.assign(A,t))}addTexture(e){const{imageIndex:t}=e,n={source:t};return this.json.textures=this.json.textures||[],this.json.textures.push(n),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var A,l;const e=this.byteLength,t=new ArrayBuffer(e),n=new Uint8Array(t);let i=0;for(const h of this.sourceBuffers||[])i=Wf(h,n,i);(l=(A=this.json)==null?void 0:A.buffers)!=null&&l[0]?this.json.buffers[0].byteLength=e:this.json.buffers=[{byteLength:e}],this.gltf.binary=t,this.sourceBuffers=[t],this.gltf.buffers=[{arrayBuffer:t,byteOffset:0,byteLength:t.byteLength}]}_removeStringFromArray(e,t){let n=!0;for(;n;){const i=e.indexOf(t);i>-1?e.splice(i,1):n=!1}}_addAttributes(e={}){const t={};for(const n in e){const i=e[n],A=this._getGltfAttributeName(n),l=this.addBinaryBuffer(i.value,i);t[A]=l}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,t){const n={min:null,max:null};if(e.length<t)return n;n.min=[],n.max=[];const i=e.subarray(0,t);for(const A of i)n.min.push(A),n.max.push(A);for(let A=t;A<e.length;A+=t)for(let l=0;l<t;l++)n.min[0+l]=Math.min(n.min[0+l],e[A+l]),n.max[0+l]=Math.max(n.max[0+l],e[A+l]);return n}}function ku(s){return(s%1+1)%1}const zd={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},S3={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},jd={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function ec(s,e){return jd[e]*zd[s]}function _r(s,e,t,n){if(t!=="UINT8"&&t!=="UINT16"&&t!=="UINT32"&&t!=="UINT64")return null;const i=s.getTypedArrayForBufferView(e),A=yr(i,"SCALAR",t,n+1);return A instanceof BigInt64Array||A instanceof BigUint64Array?null:A}function yr(s,e,t,n=1){const i=zd[e],A=S3[t],l=jd[t],h=n*i,g=h*l;let B=s.buffer,C=s.byteOffset;return C%l!==0&&(B=new Uint8Array(B).slice(C,C+g).buffer,C=0),new A(B,C,h)}function tc(s,e,t){var B,C,y,E,T;const n=`TEXCOORD_${e.texCoord||0}`,i=t.attributes[n],A=s.getTypedArrayForAccessor(i),l=s.gltf.json,h=e.index,g=(C=(B=l.textures)==null?void 0:B[h])==null?void 0:C.source;if(typeof g<"u"){const x=(E=(y=l.images)==null?void 0:y[g])==null?void 0:E.mimeType,F=(T=s.gltf.images)==null?void 0:T[g];if(F&&typeof F.width<"u"){const N=[];for(let R=0;R<A.length;R+=2){const Q=x3(F,x,A,R,e.channels);N.push(Q)}return N}}return[]}function Qd(s,e,t,n,i){if(!(t!=null&&t.length))return;const A=[];for(const C of t){let y=n.findIndex(E=>E===C);y===-1&&(y=n.push(C)-1),A.push(y)}const l=new Uint32Array(A),h=s.gltf.buffers.push({arrayBuffer:l.buffer,byteOffset:l.byteOffset,byteLength:l.byteLength})-1,g=s.addBufferView(l,h,0),B=s.addAccessor(g,{size:1,componentType:Cr(l),count:l.length});i.attributes[e]=B}function x3(s,e,t,n,i=[0]){const A={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},l=t[n],h=t[n+1];let g=1;e&&(e.indexOf("image/jpeg")!==-1||e.indexOf("image/png")!==-1)&&(g=4);const B=D3(l,h,s,g);let C=0;for(const y of i){const E=typeof y=="number"?Object.values(A)[y]:A[y],T=B+E.offset,x=kf(s);if(x.data.length<=T)throw new Error(`${x.data.length} <= ${T}`);const F=x.data[T];C|=F<<E.shift}return C}function D3(s,e,t,n=1){const i=t.width,A=ku(s)*(i-1),l=Math.round(A),h=t.height,g=ku(e)*(h-1),B=Math.round(g),C=t.components?t.components:n;return(B*i+l)*C}function Kd(s,e,t,n,i){const A=[];for(let l=0;l<e;l++){const h=t[l],g=t[l+1]-t[l];if(g+h>n)break;const B=h/i,C=g/i;A.push(s.slice(B,B+C))}return A}function Wd(s,e,t){const n=[];for(let i=0;i<e;i++){const A=i*t;n.push(s.slice(A,A+t))}return n}function Xd(s,e,t,n){if(t)throw new Error("Not implemented - arrayOffsets for strings is specified");if(n){const i=[],A=new TextDecoder("utf8");let l=0;for(let h=0;h<s;h++){const g=n[h+1]-n[h];if(g+l<=e.length){const B=e.subarray(l,g+l),C=A.decode(B);i.push(C),l+=g}}return i}return[]}const js="EXT_mesh_features",P3=js;async function F3(s,e){const t=new Bt(s);R3(t,e)}function L3(s,e){const t=new Bt(s);return G3(t),t.createBinaryChunk(),t.gltf}function R3(s,e){const t=s.gltf.json;if(t.meshes)for(const n of t.meshes)for(const i of n.primitives)O3(s,i,e)}function O3(s,e,t){var A,l,h;if(!((A=t==null?void 0:t.gltf)!=null&&A.loadBuffers))return;const n=(l=e.extensions)==null?void 0:l[js],i=n==null?void 0:n.featureIds;if(i)for(const g of i){let B;if(typeof g.attribute<"u"){const C=`_FEATURE_ID_${g.attribute}`,y=e.attributes[C];B=s.getTypedArrayForAccessor(y)}else typeof g.texture<"u"&&((h=t==null?void 0:t.gltf)!=null&&h.loadImages)?B=tc(s,g.texture,e):B=[];g.data=B}}function G3(s,e){const t=s.gltf.json.meshes;if(t)for(const n of t)for(const i of n.primitives)U3(s,i)}function N3(s,e,t,n){e.extensions||(e.extensions={});let i=e.extensions[js];i||(i={featureIds:[]},e.extensions[js]=i);const{featureIds:A}=i,l={featureCount:t.length,propertyTable:n,data:t};A.push(l),s.addObjectExtension(e,js,i)}function U3(s,e){var i;const t=(i=e.extensions)==null?void 0:i[js];if(!t)return;const n=t.featureIds;n.forEach((A,l)=>{if(A.data){const{accessorKey:h,index:g}=H3(e.attributes),B=new Uint32Array(A.data);n[l]={featureCount:B.length,propertyTable:A.propertyTable,attribute:g},s.gltf.buffers.push({arrayBuffer:B.buffer,byteOffset:B.byteOffset,byteLength:B.byteLength});const C=s.addBufferView(B),y=s.addAccessor(C,{size:1,componentType:Cr(B),count:B.length});e.attributes[h]=y}})}function H3(s){const e="_FEATURE_ID_",t=Object.keys(s).filter(A=>A.indexOf(e)===0);let n=-1;for(const A of t){const l=Number(A.substring(e.length));l>n&&(n=l)}return n++,{accessorKey:`${e}${n}`,index:n}}const k3=Object.freeze(Object.defineProperty({__proto__:null,createExtMeshFeatures:N3,decode:F3,encode:L3,name:P3},Symbol.toStringTag,{value:"Module"})),$s="EXT_structural_metadata",J3=$s;async function V3(s,e){const t=new Bt(s);j3(t,e)}function z3(s,e){const t=new Bt(s);return ox(t),t.createBinaryChunk(),t.gltf}function j3(s,e){var n,i;if(!((n=e.gltf)!=null&&n.loadBuffers))return;const t=s.getExtension($s);t&&((i=e.gltf)!=null&&i.loadImages&&Q3(s,t),K3(s,t))}function Q3(s,e){const t=e.propertyTextures,n=s.gltf.json;if(t&&n.meshes)for(const i of n.meshes)for(const A of i.primitives)X3(s,t,A,e)}function K3(s,e){const t=e.schema;if(!t)return;const n=t.classes,i=e.propertyTables;if(n&&i)for(const A in n){const l=W3(i,A);l&&$3(s,t,l)}}function W3(s,e){for(const t of s)if(t.class===e)return t;return null}function X3(s,e,t,n){var l;if(!e)return;const i=(l=t.extensions)==null?void 0:l[$s],A=i==null?void 0:i.propertyTextures;if(A)for(const h of A){const g=e[h];Y3(s,g,t,n)}}function Y3(s,e,t,n){var A;if(!e.properties)return;n.dataAttributeNames||(n.dataAttributeNames=[]);const i=e.class;for(const l in e.properties){const h=`${i}_${l}`,g=(A=e.properties)==null?void 0:A[l];if(!g)continue;g.data||(g.data=[]);const B=g.data,C=tc(s,g,t);C!==null&&(Qd(s,h,C,B,t),g.data=B,n.dataAttributeNames.push(h))}}function $3(s,e,t){var A,l;const n=(A=e.classes)==null?void 0:A[t.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${t.class}`);const i=t.count;for(const h in n.properties){const g=n.properties[h],B=(l=t.properties)==null?void 0:l[h];if(B){const C=Z3(s,e,g,i,B);B.data=C}}}function Z3(s,e,t,n,i){let A=[];const l=i.values,h=s.getTypedArrayForBufferView(l),g=q3(s,t,i,n),B=ex(s,i,n);switch(t.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{A=tx(t,n,h,g);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${t.type}`);case"STRING":{A=Xd(n,h,g,B);break}case"ENUM":{A=nx(e,t,n,h,g);break}default:throw new Error(`Unknown classProperty type ${t.type}`)}return A}function q3(s,e,t,n){return e.array&&typeof e.count>"u"&&typeof t.arrayOffsets<"u"?_r(s,t.arrayOffsets,t.arrayOffsetType||"UINT32",n):null}function ex(s,e,t){return typeof e.stringOffsets<"u"?_r(s,e.stringOffsets,e.stringOffsetType||"UINT32",t):null}function tx(s,e,t,n){const i=s.array,A=s.count,l=ec(s.type,s.componentType),h=t.byteLength/l;let g;return s.componentType?g=yr(t,s.type,s.componentType,h):g=t,i?n?Kd(g,e,n,t.length,l):A?Wd(g,e,A):[]:g}function nx(s,e,t,n,i){var y;const A=e.enumType;if(!A)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const l=(y=s.enums)==null?void 0:y[A];if(!l)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${A}`);const h=l.valueType||"UINT16",g=ec(e.type,h),B=n.byteLength/g;let C=yr(n,e.type,h,B);if(C||(C=n),e.array){if(i)return sx({valuesData:C,numberOfElements:t,arrayOffsets:i,valuesDataBytesLength:n.length,elementSize:g,enumEntry:l});const E=e.count;return E?ix(C,t,E,l):[]}return nc(C,0,t,l)}function sx(s){const{valuesData:e,numberOfElements:t,arrayOffsets:n,valuesDataBytesLength:i,elementSize:A,enumEntry:l}=s,h=[];for(let g=0;g<t;g++){const B=n[g],C=n[g+1]-n[g];if(C+B>i)break;const y=B/A,E=C/A,T=nc(e,y,E,l);h.push(T)}return h}function ix(s,e,t,n){const i=[];for(let A=0;A<e;A++){const l=t*A,h=nc(s,l,t,n);i.push(h)}return i}function nc(s,e,t,n){const i=[];for(let A=0;A<t;A++)if(s instanceof BigInt64Array||s instanceof BigUint64Array)i.push("");else{const l=s[e+A],h=Ax(n,l);h?i.push(h.name):i.push("")}return i}function Ax(s,e){for(const t of s.values)if(t.value===e)return t;return null}const rx="schemaClassId";function ox(s,e){var n,i;const t=s.getExtension($s);if(t&&t.propertyTables)for(const A of t.propertyTables){const l=A.class,h=(i=(n=t.schema)==null?void 0:n.classes)==null?void 0:i[l];A.properties&&h&&ax(A,h,s)}}function ax(s,e,t){for(const n in s.properties){const i=s.properties[n].data;if(i){const A=e.properties[n];if(A){const l=fx(i,A,t);s.properties[n]=l}}}}function cx(s,e,t=rx){let n=s.getExtension($s);n||(n=s.addExtension($s)),n.schema=lx(e,t,n.schema);const i=ux(e,t,n.schema);return n.propertyTables||(n.propertyTables=[]),n.propertyTables.push(i)-1}function lx(s,e,t){const n=t??{id:"schema_id"},i={properties:{}};for(const A of s){const l={type:A.elementType,componentType:A.componentType};i.properties[A.name]=l}return n.classes={},n.classes[e]=i,n}function ux(s,e,t){var l;const n={class:e,count:0};let i=0;const A=(l=t.classes)==null?void 0:l[e];for(const h of s){if(i===0&&(i=h.values.length),i!==h.values.length&&h.values.length)throw new Error("Illegal values in attributes");(A==null?void 0:A.properties[h.name])&&(n.properties||(n.properties={}),n.properties[h.name]={values:0,data:h.values})}return n.count=i,n}function fx(s,e,t){const n={values:0};if(e.type==="STRING"){const{stringData:i,stringOffsets:A}=gx(s);n.stringOffsets=Go(A,t),n.values=Go(i,t)}else if(e.type==="SCALAR"&&e.componentType){const i=dx(s,e.componentType);n.values=Go(i,t)}return n}const hx={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function dx(s,e){const t=[];for(const i of s)t.push(Number(i));const n=hx[e];if(!n)throw new Error("Illegal component type");return new n(t)}function gx(s){const e=new TextEncoder,t=[];let n=0;for(const g of s){const B=e.encode(g);n+=B.length,t.push(B)}const i=new Uint8Array(n),A=[];let l=0;for(const g of t)i.set(g,l),A.push(l),l+=g.length;A.push(l);const h=new Uint32Array(A);return{stringData:i,stringOffsets:h}}function Go(s,e){return e.gltf.buffers.push({arrayBuffer:s.buffer,byteOffset:s.byteOffset,byteLength:s.byteLength}),e.addBufferView(s)}const px=Object.freeze(Object.defineProperty({__proto__:null,createExtStructuralMetadata:cx,decode:V3,encode:z3,name:J3},Symbol.toStringTag,{value:"Module"})),Yd="EXT_feature_metadata",mx=Yd;async function Bx(s,e){const t=new Bt(s);Cx(t,e)}function Cx(s,e){var n,i;if(!((n=e.gltf)!=null&&n.loadBuffers))return;const t=s.getExtension(Yd);t&&((i=e.gltf)!=null&&i.loadImages&&_x(s,t),yx(s,t))}function _x(s,e){const t=e.schema;if(!t)return;const n=t.classes,{featureTextures:i}=e;if(n&&i)for(const A in n){const l=n[A],h=Ex(i,A);h&&vx(s,h,l)}}function yx(s,e){const t=e.schema;if(!t)return;const n=t.classes,i=e.featureTables;if(n&&i)for(const A in n){const l=bx(i,A);l&&Tx(s,t,l)}}function bx(s,e){for(const t in s){const n=s[t];if(n.class===e)return n}return null}function Ex(s,e){for(const t in s){const n=s[t];if(n.class===e)return n}return null}function Tx(s,e,t){var A,l;if(!t.class)return;const n=(A=e.classes)==null?void 0:A[t.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${t.class}`);const i=t.count;for(const h in n.properties){const g=n.properties[h],B=(l=t.properties)==null?void 0:l[h];if(B){const C=Ix(s,e,g,i,B);B.data=C}}}function vx(s,e,t){var i;const n=e.class;for(const A in t.properties){const l=(i=e==null?void 0:e.properties)==null?void 0:i[A];if(l){const h=Dx(s,l,n);l.data=h}}}function Ix(s,e,t,n,i){let A=[];const l=i.bufferView,h=s.getTypedArrayForBufferView(l),g=Mx(s,t,i,n),B=wx(s,t,i,n);return t.type==="STRING"||t.componentType==="STRING"?A=Xd(n,h,g,B):Sx(t)&&(A=xx(t,n,h,g)),A}function Mx(s,e,t,n){return e.type==="ARRAY"&&typeof e.componentCount>"u"&&typeof t.arrayOffsetBufferView<"u"?_r(s,t.arrayOffsetBufferView,t.offsetType||"UINT32",n):null}function wx(s,e,t,n){return typeof t.stringOffsetBufferView<"u"?_r(s,t.stringOffsetBufferView,t.offsetType||"UINT32",n):null}function Sx(s){const e=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return e.includes(s.type)||typeof s.componentType<"u"&&e.includes(s.componentType)}function xx(s,e,t,n){const i=s.type==="ARRAY",A=s.componentCount,l="SCALAR",h=s.componentType||s.type,g=ec(l,h),B=t.byteLength/g,C=yr(t,l,h,B);return i?n?Kd(C,e,n,t.length,g):A?Wd(C,e,A):[]:C}function Dx(s,e,t){const n=s.gltf.json;if(!n.meshes)return[];const i=[];for(const A of n.meshes)for(const l of A.primitives)Px(s,t,e,i,l);return i}function Px(s,e,t,n,i){const A={channels:t.channels,...t.texture},l=tc(s,A,i);l&&Qd(s,e,l,n,i)}const Fx=Object.freeze(Object.defineProperty({__proto__:null,decode:Bx,name:mx},Symbol.toStringTag,{value:"Module"})),Lx="4.3.2",Rx="4.3.2",XA={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let Ju;async function Vu(s){jf(s.modules);const e=Qf("basis");return e||(Ju||(Ju=Ox(s)),await Ju)}async function Ox(s){let e=null,t=null;return[e,t]=await Promise.all([await kt(XA.TRANSCODER,"textures",s),await kt(XA.TRANSCODER_WASM,"textures",s)]),e=e||globalThis.BASIS,await Gx(e,t)}function Gx(s,e){const t={};return e&&(t.wasmBinary=e),new Promise(n=>{s(t).then(i=>{const{BasisFile:A,initializeBasis:l}=i;l(),n({BasisFile:A})})})}let No;async function zu(s){const e=s.modules||{};return e.basisEncoder?e.basisEncoder:(No=No||Nx(s),await No)}async function Nx(s){let e=null,t=null;return[e,t]=await Promise.all([await kt(XA.ENCODER,"textures",s),await kt(XA.ENCODER_WASM,"textures",s)]),e=e||globalThis.BASIS,await Ux(e,t)}function Ux(s,e){const t={};return e&&(t.wasmBinary=e),new Promise(n=>{s(t).then(i=>{const{BasisFile:A,KTX2File:l,initializeBasis:h,BasisEncoder:g}=i;h(),n({BasisFile:A,KTX2File:l,BasisEncoder:g})})})}const Ps={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_ASTC_4X4_KHR:37808},Hx=["","WEBKIT_","MOZ_"],ju={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let pA=null;function kx(s){if(!pA){s=s||Jx()||void 0,pA=new Set;for(const e of Hx)for(const t in ju)if(s&&s.getExtension(`${e}${t}`)){const n=ju[t];pA.add(n)}}return pA}function Jx(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}const zt=[171,75,84,88,32,50,48,187,13,10,26,10];function Vx(s){const e=new Uint8Array(s);return!(e.byteLength<zt.length||e[0]!==zt[0]||e[1]!==zt[1]||e[2]!==zt[2]||e[3]!==zt[3]||e[4]!==zt[4]||e[5]!==zt[5]||e[6]!==zt[6]||e[7]!==zt[7]||e[8]!==zt[8]||e[9]!==zt[9]||e[10]!==zt[10]||e[11]!==zt[11])}const zx={etc1:{basisFormat:0,compressed:!0,format:Ps.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:Ps.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:Ps.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:Ps.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:Ps.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:Ps.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function jx(s,e){if(e.basis.containerFormat==="auto"){if(Vx(s)){const n=await zu(e);return Qu(n.KTX2File,s,e)}const{BasisFile:t}=await Vu(e);return Uo(t,s,e)}switch(e.basis.module){case"encoder":const t=await zu(e);switch(e.basis.containerFormat){case"ktx2":return Qu(t.KTX2File,s,e);case"basis":default:return Uo(t.BasisFile,s,e)}case"transcoder":default:const{BasisFile:n}=await Vu(e);return Uo(n,s,e)}}function Uo(s,e,t){const n=new s(new Uint8Array(e));try{if(!n.startTranscoding())throw new Error("Failed to start basis transcoding");const i=n.getNumImages(),A=[];for(let l=0;l<i;l++){const h=n.getNumLevels(l),g=[];for(let B=0;B<h;B++)g.push(Qx(n,l,B,t));A.push(g)}return A}finally{n.close(),n.delete()}}function Qx(s,e,t,n){const i=s.getImageWidth(e,t),A=s.getImageHeight(e,t),l=s.getHasAlpha(),{compressed:h,format:g,basisFormat:B}=$d(n,l),C=s.getImageTranscodedSizeInBytes(e,t,B),y=new Uint8Array(C);if(!s.transcodeImage(y,e,t,B,0,0))throw new Error("failed to start Basis transcoding");return{width:i,height:A,data:y,compressed:h,format:g,hasAlpha:l}}function Qu(s,e,t){const n=new s(new Uint8Array(e));try{if(!n.startTranscoding())throw new Error("failed to start KTX2 transcoding");const i=n.getLevels(),A=[];for(let l=0;l<i;l++)A.push(Kx(n,l,t));return[A]}finally{n.close(),n.delete()}}function Kx(s,e,t){const{alphaFlag:n,height:i,width:A}=s.getImageLevelInfo(e,0,0),{compressed:l,format:h,basisFormat:g}=$d(t,n),B=s.getImageTranscodedSizeInBytes(e,0,0,g),C=new Uint8Array(B);if(!s.transcodeImage(C,e,0,0,g,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:A,height:i,data:C,compressed:l,levelSize:B,hasAlpha:n,format:h}}function $d(s,e){let t=s&&s.basis&&s.basis.format;return t==="auto"&&(t=Zd()),typeof t=="object"&&(t=e?t.alpha:t.noAlpha),t=t.toLowerCase(),zx[t]}function Zd(){const s=kx();return s.has("astc")?"astc-4x4":s.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:s.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:s.has("etc1")?"etc1":s.has("etc2")?"etc2":"rgb565"}const Wx={dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:Rx,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},Xx={...Wx,parse:jx},Zs=!0,Ku=1735152710,sc=12,YA=8,Yx=1313821514,$x=5130562,Zx=0,qx=0,eD=1;function tD(s,e=0){return`${String.fromCharCode(s.getUint8(e+0))}${String.fromCharCode(s.getUint8(e+1))}${String.fromCharCode(s.getUint8(e+2))}${String.fromCharCode(s.getUint8(e+3))}`}function nD(s,e=0,t={}){const n=new DataView(s),{magic:i=Ku}=t,A=n.getUint32(e,!1);return A===i||A===Ku}function sD(s,e,t=0,n={}){const i=new DataView(e),A=tD(i,t+0),l=i.getUint32(t+4,Zs),h=i.getUint32(t+8,Zs);switch(Object.assign(s,{header:{byteOffset:t,byteLength:h,hasBinChunk:!1},type:A,version:l,json:{},binChunks:[]}),t+=sc,s.version){case 1:return iD(s,i,t);case 2:return AD(s,i,t,n={});default:throw new Error(`Invalid GLB version ${s.version}. Only supports version 1 and 2.`)}}function iD(s,e,t){nt(s.header.byteLength>sc+YA);const n=e.getUint32(t+0,Zs),i=e.getUint32(t+4,Zs);return t+=YA,nt(i===Zx),oa(s,e,t,n),t+=n,t+=aa(s,e,t,s.header.byteLength),t}function AD(s,e,t,n){return nt(s.header.byteLength>sc+YA),rD(s,e,t,n),t+s.header.byteLength}function rD(s,e,t,n){for(;t+8<=s.header.byteLength;){const i=e.getUint32(t+0,Zs),A=e.getUint32(t+4,Zs);switch(t+=YA,A){case Yx:oa(s,e,t,i);break;case $x:aa(s,e,t,i);break;case qx:n.strict||oa(s,e,t,i);break;case eD:n.strict||aa(s,e,t,i);break}t+=Dn(i,4)}return t}function oa(s,e,t,n){const i=new Uint8Array(e.buffer,t,n),l=new TextDecoder("utf8").decode(i);return s.json=JSON.parse(l),Dn(n,4)}function aa(s,e,t,n){return s.header.hasBinChunk=!0,s.binChunks.push({byteOffset:t,byteLength:n,arrayBuffer:e.buffer}),Dn(n,4)}function qd(s,e){if(s.startsWith("data:")||s.startsWith("http:")||s.startsWith("https:"))return s;const n=e.baseUri||e.uri;if(!n)throw new Error(`'baseUri' must be provided to resolve relative url ${s}`);return n.substr(0,n.lastIndexOf("/")+1)+s}const oD="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",aD="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",cD=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),lD=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),uD={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},fD={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function hD(s,e,t,n,i,A="NONE"){const l=await dD();mD(l,l.exports[fD[i]],s,e,t,n,l.exports[uD[A||"NONE"]])}let Ho;async function dD(){return Ho||(Ho=gD()),Ho}async function gD(){let s=oD;WebAssembly.validate(cD)&&(s=aD,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(pD(s),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function pD(s){const e=new Uint8Array(s.length);for(let n=0;n<s.length;++n){const i=s.charCodeAt(n);e[n]=i>96?i-71:i>64?i-65:i>47?i+4:i>46?63:62}let t=0;for(let n=0;n<s.length;++n)e[t++]=e[n]<60?lD[e[n]]:(e[n]-60)*64+e[++n];return e.buffer.slice(0,t)}function mD(s,e,t,n,i,A,l){const h=s.exports.sbrk,g=n+3&-4,B=h(g*i),C=h(A.length),y=new Uint8Array(s.exports.memory.buffer);y.set(A,C);const E=e(B,n,i,C,A.length);if(E===0&&l&&l(B,g,i),t.set(y.subarray(B,B+n*i)),h(B-h(0)),E!==0)throw new Error(`Malformed buffer data: ${E}`)}const $A="EXT_meshopt_compression",BD=$A;async function CD(s,e){var i,A;const t=new Bt(s);if(!((i=e==null?void 0:e.gltf)!=null&&i.decompressMeshes)||!((A=e.gltf)!=null&&A.loadBuffers))return;const n=[];for(const l of s.json.bufferViews||[])n.push(_D(t,l));await Promise.all(n),t.removeExtension($A)}async function _D(s,e){const t=s.getObjectExtension(e,$A);if(t){const{byteOffset:n=0,byteLength:i=0,byteStride:A,count:l,mode:h,filter:g="NONE",buffer:B}=t,C=s.gltf.buffers[B],y=new Uint8Array(C.arrayBuffer,C.byteOffset+n,i),E=new Uint8Array(s.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);await hD(E,l,A,y,h,g),s.removeObjectExtension(e,$A)}}const yD=Object.freeze(Object.defineProperty({__proto__:null,decode:CD,name:BD},Symbol.toStringTag,{value:"Module"})),Ls="EXT_texture_webp",bD=Ls;function ED(s,e){const t=new Bt(s);if(!$f("image/webp")){if(t.getRequiredExtensions().includes(Ls))throw new Error(`gltf: Required extension ${Ls} not supported by browser`);return}const{json:n}=t;for(const i of n.textures||[]){const A=t.getObjectExtension(i,Ls);A&&(i.source=A.source),t.removeObjectExtension(i,Ls)}t.removeExtension(Ls)}const TD=Object.freeze(Object.defineProperty({__proto__:null,name:bD,preprocess:ED},Symbol.toStringTag,{value:"Module"})),xA="KHR_texture_basisu",vD=xA;function ID(s,e){const t=new Bt(s),{json:n}=t;for(const i of n.textures||[]){const A=t.getObjectExtension(i,xA);A&&(i.source=A.source,t.removeObjectExtension(i,xA))}t.removeExtension(xA)}const MD=Object.freeze(Object.defineProperty({__proto__:null,name:vD,preprocess:ID},Symbol.toStringTag,{value:"Module"}));function wD(s){const e={};for(const t in s){const n=s[t];if(t!=="indices"){const i=eg(n);e[t]=i}}return e}function eg(s){const{buffer:e,size:t,count:n}=SD(s);return{value:e,size:t,byteOffset:0,count:n,type:Jd(t),componentType:Cr(e)}}function SD(s){let e=s,t=1,n=0;return s&&s.value&&(e=s.value,t=s.size||1),e&&(ArrayBuffer.isView(e)||(e=xD(e,Float32Array)),n=e.length/t),{buffer:e,size:t,count:n}}function xD(s,e,t=!1){return s?Array.isArray(s)?new e(s):t&&!(s instanceof e)?new e(s):s:null}const Vn="KHR_draco_mesh_compression",DD=Vn;function PD(s,e,t){const n=new Bt(s);for(const i of tg(n))n.getObjectExtension(i,Vn)}async function FD(s,e,t){var A;if(!((A=e==null?void 0:e.gltf)!=null&&A.decompressMeshes))return;const n=new Bt(s),i=[];for(const l of tg(n))n.getObjectExtension(l,Vn)&&i.push(RD(n,l,e,t));await Promise.all(i),n.removeExtension(Vn)}function LD(s,e={}){const t=new Bt(s);for(const n of t.json.meshes||[])OD(n),t.addRequiredExtension(Vn)}async function RD(s,e,t,n){const i=s.getObjectExtension(e,Vn);if(!i)return;const A=s.getTypedArrayForBufferView(i.bufferView),l=Pi(A.buffer,A.byteOffset),h={...t};delete h["3d-tiles"];const g=await ls(l,Od,h,n),B=wD(g.attributes);for(const[C,y]of Object.entries(B))if(C in e.attributes){const E=e.attributes[C],T=s.getAccessor(E);T!=null&&T.min&&(T!=null&&T.max)&&(y.min=T.min,y.max=T.max)}e.attributes=B,g.indices&&(e.indices=eg(g.indices)),s.removeObjectExtension(e,Vn),GD(e)}function OD(s,e,t=4,n,i){var C;if(!n.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const A=n.DracoWriter.encodeSync({attributes:s}),l=(C=i==null?void 0:i.parseSync)==null?void 0:C.call(i,{attributes:s}),h=n._addFauxAttributes(l.attributes),g=n.addBufferView(A);return{primitives:[{attributes:h,mode:t,extensions:{[Vn]:{bufferView:g,attributes:h}}}]}}function GD(s){if(!s.attributes&&Object.keys(s.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*tg(s){for(const e of s.json.meshes||[])for(const t of e.primitives)yield t}const ND=Object.freeze(Object.defineProperty({__proto__:null,decode:FD,encode:LD,name:DD,preprocess:PD},Symbol.toStringTag,{value:"Module"})),br="KHR_texture_transform",UD=br,mA=new k,HD=new At,kD=new At;async function JD(s,e){var A;if(!new Bt(s).hasExtension(br)||!((A=e.gltf)!=null&&A.loadBuffers))return;const i=s.json.materials||[];for(let l=0;l<i.length;l++)VD(l,s)}function VD(s,e){var A,l,h,g;const t=(A=e.json.materials)==null?void 0:A[s],n=[(l=t==null?void 0:t.pbrMetallicRoughness)==null?void 0:l.baseColorTexture,t==null?void 0:t.emissiveTexture,t==null?void 0:t.normalTexture,t==null?void 0:t.occlusionTexture,(h=t==null?void 0:t.pbrMetallicRoughness)==null?void 0:h.metallicRoughnessTexture],i=[];for(const B of n)B&&((g=B==null?void 0:B.extensions)!=null&&g[br])&&zD(e,s,B,i)}function zD(s,e,t,n){const i=jD(t,n);if(!i)return;const A=s.json.meshes||[];for(const l of A)for(const h of l.primitives){const g=h.material;Number.isFinite(g)&&e===g&&QD(s,h,i)}}function jD(s,e){var l;const t=(l=s.extensions)==null?void 0:l[br],{texCoord:n=0}=s,{texCoord:i=n}=t;if(!(e.findIndex(([h,g])=>h===n&&g===i)!==-1)){const h=XD(t);return n!==i&&(s.texCoord=i),e.push([n,i]),{originalTexCoord:n,texCoord:i,matrix:h}}return null}function QD(s,e,t){var h,g;const{originalTexCoord:n,texCoord:i,matrix:A}=t,l=e.attributes[`TEXCOORD_${n}`];if(Number.isFinite(l)){const B=(h=s.json.accessors)==null?void 0:h[l];if(B&&B.bufferView){const C=(g=s.json.bufferViews)==null?void 0:g[B.bufferView];if(C){const{arrayBuffer:y,byteOffset:E}=s.buffers[C.buffer],T=(E||0)+(B.byteOffset||0)+(C.byteOffset||0),{ArrayType:x,length:F}=qa(B,C),N=kd[B.componentType],R=Hd[B.type],Q=C.byteStride||N*R,Y=new Float32Array(F);for(let se=0;se<B.count;se++){const re=new x(y,T+se*Q,2);mA.set(re[0],re[1],1),mA.transformByMatrix3(A),Y.set([mA[0],mA[1]],se*R)}n===i?KD(B,C,s.buffers,Y):WD(i,B,e,s,Y)}}}}function KD(s,e,t,n){s.componentType=5126,t.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength}),e.buffer=t.length-1,e.byteLength=n.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function WD(s,e,t,n,i){n.buffers.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength});const A=n.json.bufferViews;if(!A)return;A.push({buffer:n.buffers.length-1,byteLength:i.buffer.byteLength,byteOffset:0});const l=n.json.accessors;l&&(l.push({bufferView:(A==null?void 0:A.length)-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),t.attributes[`TEXCOORD_${s}`]=l.length-1)}function XD(s){const{offset:e=[0,0],rotation:t=0,scale:n=[1,1]}=s,i=new At().set(1,0,0,0,1,0,e[0],e[1],1),A=HD.set(Math.cos(t),Math.sin(t),0,-Math.sin(t),Math.cos(t),0,0,0,1),l=kD.set(n[0],0,0,0,n[1],0,0,0,1);return i.multiplyRight(A).multiplyRight(l)}const YD=Object.freeze(Object.defineProperty({__proto__:null,decode:JD,name:UD},Symbol.toStringTag,{value:"Module"})),is="KHR_lights_punctual",$D=is;async function ZD(s){const e=new Bt(s),{json:t}=e,n=e.getExtension(is);n&&(e.json.lights=n.lights,e.removeExtension(is));for(const i of t.nodes||[]){const A=e.getObjectExtension(i,is);A&&(i.light=A.light),e.removeObjectExtension(i,is)}}async function qD(s){const e=new Bt(s),{json:t}=e;if(t.lights){const n=e.addExtension(is);Kt(!n.lights),n.lights=t.lights,delete t.lights}if(e.json.lights){for(const n of e.json.lights){const i=n.node;e.addObjectExtension(i,is,n)}delete e.json.lights}}const eP=Object.freeze(Object.defineProperty({__proto__:null,decode:ZD,encode:qD,name:$D},Symbol.toStringTag,{value:"Module"})),wi="KHR_materials_unlit",tP=wi;async function nP(s){const e=new Bt(s),{json:t}=e;for(const n of t.materials||[])n.extensions&&n.extensions.KHR_materials_unlit&&(n.unlit=!0),e.removeObjectExtension(n,wi);e.removeExtension(wi)}function sP(s){const e=new Bt(s),{json:t}=e;if(e.materials)for(const n of t.materials||[])n.unlit&&(delete n.unlit,e.addObjectExtension(n,wi,{}),e.addExtension(wi))}const iP=Object.freeze(Object.defineProperty({__proto__:null,decode:nP,encode:sP,name:tP},Symbol.toStringTag,{value:"Module"})),_i="KHR_techniques_webgl",AP=_i;async function rP(s){const e=new Bt(s),{json:t}=e,n=e.getExtension(_i);if(n){const i=aP(n,e);for(const A of t.materials||[]){const l=e.getObjectExtension(A,_i);l&&(A.technique=Object.assign({},l,i[l.technique]),A.technique.values=cP(A.technique,e)),e.removeObjectExtension(A,_i)}e.removeExtension(_i)}}async function oP(s,e){}function aP(s,e){const{programs:t=[],shaders:n=[],techniques:i=[]}=s,A=new TextDecoder;return n.forEach(l=>{if(Number.isFinite(l.bufferView))l.code=A.decode(e.getTypedArrayForBufferView(l.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),t.forEach(l=>{l.fragmentShader=n[l.fragmentShader],l.vertexShader=n[l.vertexShader]}),i.forEach(l=>{l.program=t[l.program]}),i}function cP(s,e){const t=Object.assign({},s.values);return Object.keys(s.uniforms||{}).forEach(n=>{s.uniforms[n].value&&!(n in t)&&(t[n]=s.uniforms[n].value)}),Object.keys(t).forEach(n=>{typeof t[n]=="object"&&t[n].index!==void 0&&(t[n].texture=e.getTexture(t[n].index))}),t}const lP=Object.freeze(Object.defineProperty({__proto__:null,decode:rP,encode:oP,name:AP},Symbol.toStringTag,{value:"Module"})),ng=[px,k3,yD,TD,MD,ND,eP,iP,lP,YD,Fx];function uP(s,e={},t){var i;const n=ng.filter(A=>sg(A.name,e));for(const A of n)(i=A.preprocess)==null||i.call(A,s,e,t)}async function fP(s,e={},t){var i;const n=ng.filter(A=>sg(A.name,e));for(const A of n)await((i=A.decode)==null?void 0:i.call(A,s,e,t))}function sg(s,e){var i;const t=((i=e==null?void 0:e.gltf)==null?void 0:i.excludeExtensions)||{};return!(s in t&&!t[s])}const ko="KHR_binary_glTF";function hP(s){const e=new Bt(s),{json:t}=e;for(const n of t.images||[]){const i=e.getObjectExtension(n,ko);i&&Object.assign(n,i),e.removeObjectExtension(n,ko)}t.buffers&&t.buffers[0]&&delete t.buffers[0].uri,e.removeExtension(ko)}const Wu={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},dP={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class gP{constructor(){G(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}});G(this,"json")}normalize(e,t){this.json=e.json;const n=e.json;switch(n.asset&&n.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${n.asset.version}`);return}if(!t.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(n),this._convertTopLevelObjectsToArrays(n),hP(e),this._convertObjectIdsToArrayIndices(n),this._updateObjects(n),this._updateMaterial(n)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const t in Wu)this._convertTopLevelObjectToArray(e,t)}_convertTopLevelObjectToArray(e,t){const n=e[t];if(!(!n||Array.isArray(n))){e[t]=[];for(const i in n){const A=n[i];A.id=A.id||i;const l=e[t].length;e[t].push(A),this.idToIndexMap[t][i]=l}}}_convertObjectIdsToArrayIndices(e){for(const t in Wu)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const t of e.textures)this._convertTextureIds(t);for(const t of e.meshes)this._convertMeshIds(t);for(const t of e.nodes)this._convertNodeIds(t);for(const t of e.scenes)this._convertSceneIds(t)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const t of e.primitives){const{attributes:n,indices:i,material:A}=t;for(const l in n)n[l]=this._convertIdToIndex(n[l],"accessor");i&&(t.indices=this._convertIdToIndex(i,"accessor")),A&&(t.material=this._convertIdToIndex(A,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(t=>this._convertIdToIndex(t,"node"))),e.meshes&&(e.meshes=e.meshes.map(t=>this._convertIdToIndex(t,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(t=>this._convertIdToIndex(t,"node")))}_convertIdsToIndices(e,t){e[t]||(console.warn(`gltf v1: json doesn't contain attribute ${t}`),e[t]=[]);for(const n of e[t])for(const i in n){const A=n[i],l=this._convertIdToIndex(A,i);n[i]=l}}_convertIdToIndex(e,t){const n=dP[t];if(n in this.idToIndexMap){const i=this.idToIndexMap[n][e];if(!Number.isFinite(i))throw new Error(`gltf v1: failed to resolve ${t} with id ${e}`);return i}return e}_updateObjects(e){for(const t of this.json.buffers)delete t.type}_updateMaterial(e){var t,n,i;for(const A of e.materials){A.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const l=((t=A.values)==null?void 0:t.tex)||((n=A.values)==null?void 0:n.texture2d_0)||((i=A.values)==null?void 0:i.diffuseTex),h=e.textures.findIndex(g=>g.id===l);h!==-1&&(A.pbrMetallicRoughness.baseColorTexture={index:h})}}}function pP(s,e={}){return new gP().normalize(s,e)}async function mP(s,e,t=0,n,i){var A,l,h;return BP(s,e,t,n),pP(s,{normalize:(A=n==null?void 0:n.gltf)==null?void 0:A.normalize}),uP(s,n,i),(l=n==null?void 0:n.gltf)!=null&&l.loadBuffers&&s.json.buffers&&await CP(s,n,i),(h=n==null?void 0:n.gltf)!=null&&h.loadImages&&await _P(s,n,i),await fP(s,n,i),s}function BP(s,e,t,n){if(n.uri&&(s.baseUri=n.uri),e instanceof ArrayBuffer&&!nD(e,t,n)&&(e=new TextDecoder().decode(e)),typeof e=="string")s.json=Kf(e);else if(e instanceof ArrayBuffer){const l={};t=sD(l,e,t,n.glb),Kt(l.type==="glTF",`Invalid GLB magic string ${l.type}`),s._glb=l,s.json=l.json}else Kt(!1,"GLTF: must be ArrayBuffer or string");const i=s.json.buffers||[];if(s.buffers=new Array(i.length).fill(null),s._glb&&s._glb.header.hasBinChunk){const{binChunks:l}=s._glb;s.buffers[0]={arrayBuffer:l[0].arrayBuffer,byteOffset:l[0].byteOffset,byteLength:l[0].byteLength}}const A=s.json.images||[];s.images=new Array(A.length).fill({})}async function CP(s,e,t){var i,A;const n=s.json.buffers||[];for(let l=0;l<n.length;++l){const h=n[l];if(h.uri){const{fetch:g}=t;Kt(g);const B=qd(h.uri,e),C=await((i=t==null?void 0:t.fetch)==null?void 0:i.call(t,B)),y=await((A=C==null?void 0:C.arrayBuffer)==null?void 0:A.call(C));s.buffers[l]={arrayBuffer:y,byteOffset:0,byteLength:y.byteLength},delete h.uri}else s.buffers[l]===null&&(s.buffers[l]={arrayBuffer:new ArrayBuffer(h.byteLength),byteOffset:0,byteLength:h.byteLength})}}async function _P(s,e,t){const n=yP(s),i=s.json.images||[],A=[];for(const l of n)A.push(bP(s,i[l],l,e,t));return await Promise.all(A)}function yP(s){const e=new Set,t=s.json.textures||[];for(const n of t)n.source!==void 0&&e.add(n.source);return Array.from(e).sort()}async function bP(s,e,t,n,i){let A;if(e.uri&&!e.hasOwnProperty("bufferView")){const h=qd(e.uri,n),{fetch:g}=i;A=await(await g(h)).arrayBuffer(),e.bufferView={data:A}}if(Number.isFinite(e.bufferView)){const h=I3(s.json,s.buffers,e.bufferView);A=Pi(h.buffer,h.byteOffset,h.byteLength)}Kt(A,"glTF image has no data");let l=await ls(A,[Jf,Xx],{...n,mimeType:e.mimeType,basis:n.basis||{format:Zd()}},i);l&&l[0]&&(l={compressed:!0,mipmaps:!1,width:l[0].width,height:l[0].height,data:l[0]}),s.images=s.images||[],s.images[t]=l}const ZA={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:Lx,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:EP,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function EP(s,e={},t){e={...ZA.options,...e},e.gltf={...ZA.options.gltf,...e.gltf};const{byteOffset:n=0}=e;return await mP({},s,n,e,t)}const TP={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},vP={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},en={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},IP={magFilter:en.TEXTURE_MAG_FILTER,minFilter:en.TEXTURE_MIN_FILTER,wrapS:en.TEXTURE_WRAP_S,wrapT:en.TEXTURE_WRAP_T},MP={[en.TEXTURE_MAG_FILTER]:en.LINEAR,[en.TEXTURE_MIN_FILTER]:en.NEAREST_MIPMAP_LINEAR,[en.TEXTURE_WRAP_S]:en.REPEAT,[en.TEXTURE_WRAP_T]:en.REPEAT};function wP(){return{id:"default-sampler",parameters:MP}}function SP(s){return vP[s]}function xP(s){return TP[s]}class DP{constructor(){G(this,"baseUri","");G(this,"jsonUnprocessed");G(this,"json");G(this,"buffers",[]);G(this,"images",[])}postProcess(e,t={}){const{json:n,buffers:i=[],images:A=[]}=e,{baseUri:l=""}=e;return Kt(n),this.baseUri=l,this.buffers=i,this.images=A,this.jsonUnprocessed=n,this.json=this._resolveTree(e.json,t),this.json}_resolveTree(e,t={}){const n={...e};return this.json=n,e.bufferViews&&(n.bufferViews=e.bufferViews.map((i,A)=>this._resolveBufferView(i,A))),e.images&&(n.images=e.images.map((i,A)=>this._resolveImage(i,A))),e.samplers&&(n.samplers=e.samplers.map((i,A)=>this._resolveSampler(i,A))),e.textures&&(n.textures=e.textures.map((i,A)=>this._resolveTexture(i,A))),e.accessors&&(n.accessors=e.accessors.map((i,A)=>this._resolveAccessor(i,A))),e.materials&&(n.materials=e.materials.map((i,A)=>this._resolveMaterial(i,A))),e.meshes&&(n.meshes=e.meshes.map((i,A)=>this._resolveMesh(i,A))),e.nodes&&(n.nodes=e.nodes.map((i,A)=>this._resolveNode(i,A)),n.nodes=n.nodes.map((i,A)=>this._resolveNodeChildren(i))),e.skins&&(n.skins=e.skins.map((i,A)=>this._resolveSkin(i,A))),e.scenes&&(n.scenes=e.scenes.map((i,A)=>this._resolveScene(i,A))),typeof this.json.scene=="number"&&n.scenes&&(n.scene=n.scenes[this.json.scene]),n}getScene(e){return this._get(this.json.scenes,e)}getNode(e){return this._get(this.json.nodes,e)}getSkin(e){return this._get(this.json.skins,e)}getMesh(e){return this._get(this.json.meshes,e)}getMaterial(e){return this._get(this.json.materials,e)}getAccessor(e){return this._get(this.json.accessors,e)}getCamera(e){return this._get(this.json.cameras,e)}getTexture(e){return this._get(this.json.textures,e)}getSampler(e){return this._get(this.json.samplers,e)}getImage(e){return this._get(this.json.images,e)}getBufferView(e){return this._get(this.json.bufferViews,e)}getBuffer(e){return this._get(this.json.buffers,e)}_get(e,t){if(typeof t=="object")return t;const n=e&&e[t];return n||console.warn(`glTF file error: Could not find ${e}[${t}]`),n}_resolveScene(e,t){return{...e,id:e.id||`scene-${t}`,nodes:(e.nodes||[]).map(n=>this.getNode(n))}}_resolveNode(e,t){const n={...e,id:(e==null?void 0:e.id)||`node-${t}`};return e.mesh!==void 0&&(n.mesh=this.getMesh(e.mesh)),e.camera!==void 0&&(n.camera=this.getCamera(e.camera)),e.skin!==void 0&&(n.skin=this.getSkin(e.skin)),e.meshes!==void 0&&e.meshes.length&&(n.mesh=e.meshes.reduce((i,A)=>{const l=this.getMesh(A);return i.id=l.id,i.primitives=i.primitives.concat(l.primitives),i},{primitives:[]})),n}_resolveNodeChildren(e){return e.children&&(e.children=e.children.map(t=>this.getNode(t))),e}_resolveSkin(e,t){const n=typeof e.inverseBindMatrices=="number"?this.getAccessor(e.inverseBindMatrices):void 0;return{...e,id:e.id||`skin-${t}`,inverseBindMatrices:n}}_resolveMesh(e,t){const n={...e,id:e.id||`mesh-${t}`,primitives:[]};return e.primitives&&(n.primitives=e.primitives.map(i=>{const A={...i,attributes:{},indices:void 0,material:void 0},l=i.attributes;for(const h in l)A.attributes[h]=this.getAccessor(l[h]);return i.indices!==void 0&&(A.indices=this.getAccessor(i.indices)),i.material!==void 0&&(A.material=this.getMaterial(i.material)),A})),n}_resolveMaterial(e,t){const n={...e,id:e.id||`material-${t}`};if(n.normalTexture&&(n.normalTexture={...n.normalTexture},n.normalTexture.texture=this.getTexture(n.normalTexture.index)),n.occlusionTexture&&(n.occlusionTexture={...n.occlusionTexture},n.occlusionTexture.texture=this.getTexture(n.occlusionTexture.index)),n.emissiveTexture&&(n.emissiveTexture={...n.emissiveTexture},n.emissiveTexture.texture=this.getTexture(n.emissiveTexture.index)),n.emissiveFactor||(n.emissiveFactor=n.emissiveTexture?[1,1,1]:[0,0,0]),n.pbrMetallicRoughness){n.pbrMetallicRoughness={...n.pbrMetallicRoughness};const i=n.pbrMetallicRoughness;i.baseColorTexture&&(i.baseColorTexture={...i.baseColorTexture},i.baseColorTexture.texture=this.getTexture(i.baseColorTexture.index)),i.metallicRoughnessTexture&&(i.metallicRoughnessTexture={...i.metallicRoughnessTexture},i.metallicRoughnessTexture.texture=this.getTexture(i.metallicRoughnessTexture.index))}return n}_resolveAccessor(e,t){const n=SP(e.componentType),i=xP(e.type),A=n*i,l={...e,id:e.id||`accessor-${t}`,bytesPerComponent:n,components:i,bytesPerElement:A,value:void 0,bufferView:void 0,sparse:void 0};if(e.bufferView!==void 0&&(l.bufferView=this.getBufferView(e.bufferView)),l.bufferView){const h=l.bufferView.buffer,{ArrayType:g,byteLength:B}=qa(l,l.bufferView),C=(l.bufferView.byteOffset||0)+(l.byteOffset||0)+h.byteOffset;let y=h.arrayBuffer.slice(C,C+B);l.bufferView.byteStride&&(y=this._getValueFromInterleavedBuffer(h,C,l.bufferView.byteStride,l.bytesPerElement,l.count)),l.value=new g(y)}return l}_getValueFromInterleavedBuffer(e,t,n,i,A){const l=new Uint8Array(A*i);for(let h=0;h<A;h++){const g=t+h*n;l.set(new Uint8Array(e.arrayBuffer.slice(g,g+i)),h*i)}return l.buffer}_resolveTexture(e,t){return{...e,id:e.id||`texture-${t}`,sampler:typeof e.sampler=="number"?this.getSampler(e.sampler):wP(),source:typeof e.source=="number"?this.getImage(e.source):void 0}}_resolveSampler(e,t){const n={id:e.id||`sampler-${t}`,...e,parameters:{}};for(const i in n){const A=this._enumSamplerParameter(i);A!==void 0&&(n.parameters[A]=n[i])}return n}_enumSamplerParameter(e){return IP[e]}_resolveImage(e,t){const n={...e,id:e.id||`image-${t}`,image:null,bufferView:e.bufferView!==void 0?this.getBufferView(e.bufferView):void 0},i=this.images[t];return i&&(n.image=i),n}_resolveBufferView(e,t){const n=e.buffer,i=this.buffers[n].arrayBuffer;let A=this.buffers[n].byteOffset||0;return e.byteOffset&&(A+=e.byteOffset),{id:`bufferView-${t}`,...e,buffer:this.buffers[n],data:new Uint8Array(i,A,e.byteLength)}}_resolveCamera(e,t){const n={...e,id:e.id||`camera-${t}`};return n.perspective,n.orthographic,n}}function ig(s,e){return new DP().postProcess(s,e)}const ca={URI:0,EMBEDDED:1};function Ag(s,e,t,n){s.rotateYtoZ=!0;const i=(s.byteOffset||0)+(s.byteLength||0)-t;if(i===0)throw new Error("glTF byte length must be greater than 0.");return s.gltfUpAxis=n!=null&&n["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y",s.gltfArrayBuffer=Pi(e,t,i),s.gltfByteOffset=0,s.gltfByteLength=i,t%4===0||console.warn(`${s.type}: embedded glb is not aligned to a 4-byte boundary.`),(s.byteOffset||0)+(s.byteLength||0)}async function rg(s,e,t,n){const i=(t==null?void 0:t["3d-tiles"])||{};if(PP(s,e),i.loadGLTF){if(!n)return;if(s.gltfUrl){const{fetch:A}=n,l=await A(s.gltfUrl,t);s.gltfArrayBuffer=await l.arrayBuffer(),s.gltfByteOffset=0}if(s.gltfArrayBuffer){const A=await ls(s.gltfArrayBuffer,ZA,t,n);s.gltf=ig(A),s.gpuMemoryUsageInBytes=Vd(s.gltf),delete s.gltfArrayBuffer,delete s.gltfByteOffset,delete s.gltfByteLength}}}function PP(s,e,t){switch(e){case ca.URI:if(s.gltfArrayBuffer){const n=new Uint8Array(s.gltfArrayBuffer,s.gltfByteOffset),A=new TextDecoder().decode(n);s.gltfUrl=A.replace(/[\s\0]+$/,"")}delete s.gltfArrayBuffer,delete s.gltfByteOffset,delete s.gltfByteLength;break;case ca.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function FP(s,e,t,n,i){var l;t=LP(s,e,t,n),await rg(s,ca.EMBEDDED,n,i);const A=(l=s==null?void 0:s.gltf)==null?void 0:l.extensions;return A&&A.CESIUM_RTC&&(s.rtcCenter=A.CESIUM_RTC.center),t}function LP(s,e,t,n,i){t=Br(s,e,t),t=$a(s,e,t),t=Za(s,e,t),t=Ag(s,e,t,n);const A=new Ya(s.featureTableJson,s.featureTableBinary);return s.rtcCenter=A.getGlobalProperty("RTC_CENTER",ke.FLOAT,3),t}async function RP(s,e,t,n,i){return t=OP(s,e,t,n),await rg(s,s.gltfFormat||0,n,i),t}function OP(s,e,t,n,i){var B;if(t=Br(s,e,t),s.version!==1)throw new Error(`Instanced 3D Model version ${s.version} is not supported`);t=$a(s,e,t);const A=new DataView(e);if(s.gltfFormat=A.getUint32(t,!0),t+=4,t=Za(s,e,t),t=Ag(s,e,t,n),!((B=s==null?void 0:s.header)!=null&&B.featureTableJsonByteLength)||s.header.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const l=new Ya(s.featureTableJson,s.featureTableBinary),h=l.getGlobalProperty("INSTANCES_LENGTH");if(l.featuresLength=h,!Number.isFinite(h))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");s.eastNorthUp=l.getGlobalProperty("EAST_NORTH_UP"),s.rtcCenter=l.getGlobalProperty("RTC_CENTER",ke.FLOAT,3);const g=new Nd(s.batchTableJson,s.batchTableBinary,h);return GP(s,l,g,h),t}function GP(s,e,t,n){const i=new Array(n),A=new k;new k,new k,new k;const l=new At,h=new Ti,g=new k,B={},C=new Fe,y=[],E=[],T=[],x=[];for(let F=0;F<n;F++){let N;if(e.hasProperty("POSITION"))N=e.getProperty("POSITION",ke.FLOAT,3,F,A);else if(e.hasProperty("POSITION_QUANTIZED")){N=e.getProperty("POSITION_QUANTIZED",ke.UNSIGNED_SHORT,3,F,A);const ue=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",ke.FLOAT,3);if(!ue)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const Te=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",ke.FLOAT,3);if(!Te)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const ge=65535;for(let $=0;$<3;$++)N[$]=N[$]/ge*Te[$]+ue[$]}if(!N)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(A.copy(N),B.translation=A,s.normalUp=e.getProperty("NORMAL_UP",ke.FLOAT,3,F,y),s.normalRight=e.getProperty("NORMAL_RIGHT",ke.FLOAT,3,F,E),s.normalUp){if(!s.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");s.hasCustomOrientation=!0}else{if(s.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",ke.UNSIGNED_SHORT,2,F,y),s.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",ke.UNSIGNED_SHORT,2,F,E),s.octNormalUp)throw s.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");s.eastNorthUp?(Ze.WGS84.eastNorthUpToFixedFrame(A,C),C.getRotationMatrix3(l)):l.identity()}h.fromMatrix3(l),B.rotation=h,g.set(1,1,1);const R=e.getProperty("SCALE",ke.FLOAT,1,F,T);Number.isFinite(R)&&g.multiplyByScalar(R);const Q=e.getProperty("SCALE_NON_UNIFORM",ke.FLOAT,3,F,y);Q&&g.scale(Q),B.scale=g;let Y=e.getProperty("BATCH_ID",ke.UNSIGNED_SHORT,1,F,x);Y===void 0&&(Y=F);const se=new Fe().fromQuaternion(B.rotation);C.identity(),C.translate(B.translation),C.multiplyRight(se),C.scale(B.scale);const re=C.clone();i[F]={modelMatrix:re,batchId:Y}}s.instances=i}async function NP(s,e,t,n,i,A){t=Br(s,e,t);const l=new DataView(e);for(s.tilesLength=l.getUint32(t,!0),t+=4,s.tiles=[];s.tiles.length<s.tilesLength&&(s.byteLength||0)-t>12;){const h={shape:"tile3d"};s.tiles.push(h),t=await A(e,t,n,i,h)}return t}async function UP(s,e,t,n){var i,A;if(s.rotateYtoZ=!0,s.gltfUpAxis=(i=t==null?void 0:t["3d-tiles"])!=null&&i.assetGltfUpAxis?t["3d-tiles"].assetGltfUpAxis:"Y",(A=t==null?void 0:t["3d-tiles"])!=null&&A.loadGLTF){if(!n)return e.byteLength;const l=await ls(e,ZA,t,n);s.gltf=ig(l),s.gpuMemoryUsageInBytes=Vd(s.gltf)}else s.gltfArrayBuffer=e;return e.byteLength}async function og(s,e=0,t,n,i={shape:"tile3d"}){switch(i.byteOffset=e,i.type=MS(s,e),i.type){case mi.COMPOSITE:return await NP(i,s,e,t,n,og);case mi.BATCHED_3D_MODEL:return await FP(i,s,e,t,n);case mi.GLTF:return await UP(i,s,t,n);case mi.INSTANCED_3D_MODEL:return await RP(i,s,e,t,n);case mi.POINT_CLOUD:return await u3(i,s,e,t,n);default:throw new Error(`3DTileLoader: unknown type ${i.type}`)}}const HP=1952609651,kP=1;async function JP(s,e,t){if(new Uint32Array(s.slice(0,4))[0]!==HP)throw new Error("Wrong subtree file magic number");if(new Uint32Array(s.slice(4,8))[0]!==kP)throw new Error("Wrong subtree file verson, must be 1");const A=Xu(s.slice(8,16)),l=new Uint8Array(s,24,A),g=new TextDecoder("utf8").decode(l),B=JSON.parse(g),C=Xu(s.slice(16,24));let y=new ArrayBuffer(0);if(C&&(y=s.slice(24+A)),await BA(B,B.tileAvailability,y,t),Array.isArray(B.contentAvailability))for(const E of B.contentAvailability)await BA(B,E,y,t);else await BA(B,B.contentAvailability,y,t);return await BA(B,B.childSubtreeAvailability,y,t),B}async function BA(s,e,t,n){const i=Number.isFinite(e.bitstream)?e.bitstream:e.bufferView;if(typeof i!="number")return;const A=s.bufferViews[i],l=s.buffers[A.buffer];if(!(n!=null&&n.baseUrl))throw new Error("Url is not provided");if(!n.fetch)throw new Error("fetch is not provided");if(l.uri){const g=`${(n==null?void 0:n.baseUrl)||""}/${l.uri}`,C=await(await n.fetch(g)).arrayBuffer();e.explicitBitstream=new Uint8Array(C,A.byteOffset,A.byteLength);return}const h=s.buffers.slice(0,A.buffer).reduce((g,B)=>g+B.byteLength,0);e.explicitBitstream=new Uint8Array(t.slice(h,h+l.byteLength),A.byteOffset,A.byteLength)}function Xu(s){const e=new DataView(s),t=e.getUint32(0,!0),n=e.getUint32(4,!0);return t+2**32*n}const ag={dataType:null,batchType:null,id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:Fd,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:JP,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var tn=null;try{tn=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function je(s,e,t){this.low=s|0,this.high=e|0,this.unsigned=!!t}je.prototype.__isLong__;Object.defineProperty(je.prototype,"__isLong__",{value:!0});function xt(s){return(s&&s.__isLong__)===!0}function Yu(s){var e=Math.clz32(s&-s);return s?31-e:e}je.isLong=xt;var $u={},Zu={};function us(s,e){var t,n,i;return e?(s>>>=0,(i=0<=s&&s<256)&&(n=Zu[s],n)?n:(t=Je(s,0,!0),i&&(Zu[s]=t),t)):(s|=0,(i=-128<=s&&s<128)&&(n=$u[s],n)?n:(t=Je(s,s<0?-1:0,!1),i&&($u[s]=t),t))}je.fromInt=us;function nn(s,e){if(isNaN(s))return e?Mn:ln;if(e){if(s<0)return Mn;if(s>=cg)return fg}else{if(s<=-9223372036854776e3)return Ut;if(s+1>=zP)return ug}return s<0?nn(-s,e).neg():Je(s%qs|0,s/qs|0,e)}je.fromNumber=nn;function Je(s,e,t){return new je(s,e,t)}je.fromBits=Je;var qA=Math.pow;function ic(s,e,t){if(s.length===0)throw Error("empty string");if(typeof e=="number"?(t=e,e=!1):e=!!e,s==="NaN"||s==="Infinity"||s==="+Infinity"||s==="-Infinity")return e?Mn:ln;if(t=t||10,t<2||36<t)throw RangeError("radix");var n;if((n=s.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return ic(s.substring(1),e,t).neg();for(var i=nn(qA(t,8)),A=ln,l=0;l<s.length;l+=8){var h=Math.min(8,s.length-l),g=parseInt(s.substring(l,l+h),t);if(h<8){var B=nn(qA(t,h));A=A.mul(B).add(nn(g))}else A=A.mul(i),A=A.add(nn(g))}return A.unsigned=e,A}je.fromString=ic;function An(s,e){return typeof s=="number"?nn(s,e):typeof s=="string"?ic(s,e):Je(s.low,s.high,typeof e=="boolean"?e:s.unsigned)}je.fromValue=An;var qu=65536,VP=1<<24,qs=qu*qu,cg=qs*qs,zP=cg/2,ef=us(VP),ln=us(0);je.ZERO=ln;var Mn=us(0,!0);je.UZERO=Mn;var Hs=us(1);je.ONE=Hs;var lg=us(1,!0);je.UONE=lg;var la=us(-1);je.NEG_ONE=la;var ug=Je(-1,2147483647,!1);je.MAX_VALUE=ug;var fg=Je(-1,-1,!0);je.MAX_UNSIGNED_VALUE=fg;var Ut=Je(0,-2147483648,!1);je.MIN_VALUE=Ut;var te=je.prototype;te.toInt=function(){return this.unsigned?this.low>>>0:this.low};te.toNumber=function(){return this.unsigned?(this.high>>>0)*qs+(this.low>>>0):this.high*qs+(this.low>>>0)};te.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Ut)){var t=nn(e),n=this.div(t),i=n.mul(t).sub(this);return n.toString(e)+i.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var A=nn(qA(e,6),this.unsigned),l=this,h="";;){var g=l.div(A),B=l.sub(g.mul(A)).toInt()>>>0,C=B.toString(e);if(l=g,l.isZero())return C+h;for(;C.length<6;)C="0"+C;h=""+C+h}};te.getHighBits=function(){return this.high};te.getHighBitsUnsigned=function(){return this.high>>>0};te.getLowBits=function(){return this.low};te.getLowBitsUnsigned=function(){return this.low>>>0};te.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Ut)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};te.isSafeInteger=function(){var e=this.high>>21;return e?this.unsigned?!1:e===-1&&!(this.low===0&&this.high===-2097152):!0};te.isZero=function(){return this.high===0&&this.low===0};te.eqz=te.isZero;te.isNegative=function(){return!this.unsigned&&this.high<0};te.isPositive=function(){return this.unsigned||this.high>=0};te.isOdd=function(){return(this.low&1)===1};te.isEven=function(){return(this.low&1)===0};te.equals=function(e){return xt(e)||(e=An(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};te.eq=te.equals;te.notEquals=function(e){return!this.eq(e)};te.neq=te.notEquals;te.ne=te.notEquals;te.lessThan=function(e){return this.comp(e)<0};te.lt=te.lessThan;te.lessThanOrEqual=function(e){return this.comp(e)<=0};te.lte=te.lessThanOrEqual;te.le=te.lessThanOrEqual;te.greaterThan=function(e){return this.comp(e)>0};te.gt=te.greaterThan;te.greaterThanOrEqual=function(e){return this.comp(e)>=0};te.gte=te.greaterThanOrEqual;te.ge=te.greaterThanOrEqual;te.compare=function(e){if(xt(e)||(e=An(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};te.comp=te.compare;te.negate=function(){return!this.unsigned&&this.eq(Ut)?Ut:this.not().add(Hs)};te.neg=te.negate;te.add=function(e){xt(e)||(e=An(e));var t=this.high>>>16,n=this.high&65535,i=this.low>>>16,A=this.low&65535,l=e.high>>>16,h=e.high&65535,g=e.low>>>16,B=e.low&65535,C=0,y=0,E=0,T=0;return T+=A+B,E+=T>>>16,T&=65535,E+=i+g,y+=E>>>16,E&=65535,y+=n+h,C+=y>>>16,y&=65535,C+=t+l,C&=65535,Je(E<<16|T,C<<16|y,this.unsigned)};te.subtract=function(e){return xt(e)||(e=An(e)),this.add(e.neg())};te.sub=te.subtract;te.multiply=function(e){if(this.isZero())return this;if(xt(e)||(e=An(e)),tn){var t=tn.mul(this.low,this.high,e.low,e.high);return Je(t,tn.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?Mn:ln;if(this.eq(Ut))return e.isOdd()?Ut:ln;if(e.eq(Ut))return this.isOdd()?Ut:ln;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(ef)&&e.lt(ef))return nn(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,i=this.high&65535,A=this.low>>>16,l=this.low&65535,h=e.high>>>16,g=e.high&65535,B=e.low>>>16,C=e.low&65535,y=0,E=0,T=0,x=0;return x+=l*C,T+=x>>>16,x&=65535,T+=A*C,E+=T>>>16,T&=65535,T+=l*B,E+=T>>>16,T&=65535,E+=i*C,y+=E>>>16,E&=65535,E+=A*B,y+=E>>>16,E&=65535,E+=l*g,y+=E>>>16,E&=65535,y+=n*C+i*B+A*g+l*h,y&=65535,Je(T<<16|x,y<<16|E,this.unsigned)};te.mul=te.multiply;te.divide=function(e){if(xt(e)||(e=An(e)),e.isZero())throw Error("division by zero");if(tn){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?tn.div_u:tn.div_s)(this.low,this.high,e.low,e.high);return Je(t,tn.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Mn:ln;var n,i,A;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Mn;if(e.gt(this.shru(1)))return lg;A=Mn}else{if(this.eq(Ut)){if(e.eq(Hs)||e.eq(la))return Ut;if(e.eq(Ut))return Hs;var l=this.shr(1);return n=l.div(e).shl(1),n.eq(ln)?e.isNegative()?Hs:la:(i=this.sub(e.mul(n)),A=n.add(i.div(e)),A)}else if(e.eq(Ut))return this.unsigned?Mn:ln;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();A=ln}for(i=this;i.gte(e);){n=Math.max(1,Math.floor(i.toNumber()/e.toNumber()));for(var h=Math.ceil(Math.log(n)/Math.LN2),g=h<=48?1:qA(2,h-48),B=nn(n),C=B.mul(e);C.isNegative()||C.gt(i);)n-=g,B=nn(n,this.unsigned),C=B.mul(e);B.isZero()&&(B=Hs),A=A.add(B),i=i.sub(C)}return A};te.div=te.divide;te.modulo=function(e){if(xt(e)||(e=An(e)),tn){var t=(this.unsigned?tn.rem_u:tn.rem_s)(this.low,this.high,e.low,e.high);return Je(t,tn.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};te.mod=te.modulo;te.rem=te.modulo;te.not=function(){return Je(~this.low,~this.high,this.unsigned)};te.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};te.clz=te.countLeadingZeros;te.countTrailingZeros=function(){return this.low?Yu(this.low):Yu(this.high)+32};te.ctz=te.countTrailingZeros;te.and=function(e){return xt(e)||(e=An(e)),Je(this.low&e.low,this.high&e.high,this.unsigned)};te.or=function(e){return xt(e)||(e=An(e)),Je(this.low|e.low,this.high|e.high,this.unsigned)};te.xor=function(e){return xt(e)||(e=An(e)),Je(this.low^e.low,this.high^e.high,this.unsigned)};te.shiftLeft=function(e){return xt(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Je(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Je(0,this.low<<e-32,this.unsigned)};te.shl=te.shiftLeft;te.shiftRight=function(e){return xt(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Je(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Je(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};te.shr=te.shiftRight;te.shiftRightUnsigned=function(e){return xt(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Je(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?Je(this.high,0,this.unsigned):Je(this.high>>>e-32,0,this.unsigned)};te.shru=te.shiftRightUnsigned;te.shr_u=te.shiftRightUnsigned;te.rotateLeft=function(e){var t;return xt(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?Je(this.high,this.low,this.unsigned):e<32?(t=32-e,Je(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,Je(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))};te.rotl=te.rotateLeft;te.rotateRight=function(e){var t;return xt(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?Je(this.high,this.low,this.unsigned):e<32?(t=32-e,Je(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,Je(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))};te.rotr=te.rotateRight;te.toSigned=function(){return this.unsigned?Je(this.low,this.high,!1):this};te.toUnsigned=function(){return this.unsigned?this:Je(this.low,this.high,!0)};te.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};te.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};te.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};je.fromBytes=function(e,t,n){return n?je.fromBytesLE(e,t):je.fromBytesBE(e,t)};je.fromBytesLE=function(e,t){return new je(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};je.fromBytesBE=function(e,t){return new je(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};typeof BigInt=="function"&&(je.fromBigInt=function(e,t){var n=Number(BigInt.asIntN(32,e)),i=Number(BigInt.asIntN(32,e>>BigInt(32)));return Je(n,i,t)},je.fromValue=function(e,t){return typeof e=="bigint"?fromBigInt(e,t):An(e,t)},te.toBigInt=function(){var e=BigInt(this.low>>>0),t=BigInt(this.unsigned?this.high>>>0:this.high);return t<<BigInt(32)|e});const jP=16;function hg(s){s==="X"&&(s="");const e=s.padEnd(jP,"0");return je.fromString(e,!0,16)}function QP(s){if(s.isZero())return"X";let e=s.countTrailingZeros();const t=e%4;e=(e-t)/4;const n=e;e*=4;const A=s.shiftRightUnsigned(e).toString(16).replace(/0+$/,"");return Array(17-n-A.length).join("0")+A}function KP(s,e){const t=WP(s).shiftRightUnsigned(2);return s.add(je.fromNumber(2*e+1-4).multiply(t))}function WP(s){return s.and(s.not().add(1))}const XP=3,YP=30,$P=2*YP+1,tf=180/Math.PI;function ZP(s){if(s.length===0)throw new Error(`Invalid Hilbert quad key ${s}`);const e=s.split("/"),t=parseInt(e[0],10),n=e[1],i=n.length;let A=0;const l=[0,0];for(let h=i-1;h>=0;h--){A=i-h;const g=n[h];let B=0,C=0;g==="1"?C=1:g==="2"?(B=1,C=1):g==="3"&&(B=1);const y=Math.pow(2,A-1);eF(y,l,B,C),l[0]+=y*B,l[1]+=y*C}if(t%2===1){const h=l[0];l[0]=l[1],l[1]=h}return{face:t,ij:l,level:A}}function qP(s){if(s.isZero())return"";let e=s.toString(2);for(;e.length<XP+$P;)e="0"+e;const t=e.lastIndexOf("1"),n=e.substring(0,3),i=e.substring(3,t),A=i.length/2,l=je.fromString(n,!0,2).toString(10);let h="";if(A!==0)for(h=je.fromString(i,!0,2).toString(4);h.length<A;)h="0"+h;return`${l}/${h}`}function dg(s,e,t){const n=1<<e;return[(s[0]+t[0])/n,(s[1]+t[1])/n]}function nf(s){return s>=.5?1/3*(4*s*s-1):1/3*(1-4*(1-s)*(1-s))}function gg(s){return[nf(s[0]),nf(s[1])]}function pg(s,[e,t]){switch(s){case 0:return[1,e,t];case 1:return[-e,1,t];case 2:return[-e,-t,1];case 3:return[-1,-t,-e];case 4:return[t,-1,-e];case 5:return[t,e,-1];default:throw new Error("Invalid face")}}function mg([s,e,t]){const n=Math.atan2(t,Math.sqrt(s*s+e*e));return[Math.atan2(e,s)*tf,n*tf]}function eF(s,e,t,n){if(n===0){t===1&&(e[0]=s-1-e[0],e[1]=s-1-e[1]);const i=e[0];e[0]=e[1],e[1]=i}}function tF(s){const e=dg(s.ij,s.level,[.5,.5]),t=gg(e),n=pg(s.face,t);return mg(n)}const nF=100;function sf(s){const{face:e,ij:t,level:n}=s,i=[[0,0],[0,1],[1,1],[1,0],[0,0]],A=Math.max(1,Math.ceil(nF*Math.pow(2,-n))),l=new Float64Array(4*A*2+2);let h=0,g=0;for(let B=0;B<4;B++){const C=i[B].slice(0),y=i[B+1],E=(y[0]-C[0])/A,T=(y[1]-C[1])/A;for(let x=0;x<A;x++){C[0]+=E,C[1]+=T;const F=dg(t,n,C),N=gg(F),R=pg(e,N),Q=mg(R);Math.abs(Q[1])>89.999&&(Q[0]=g);const Y=Q[0]-g;Q[0]+=Y>180?-360:Y<-180?360:0,l[h++]=Q[0],l[h++]=Q[1],g=Q[0]}}return l[h++]=l[0],l[h++]=l[1],l}function Ac(s){const e=sF(s);return ZP(e)}function sF(s){if(s.indexOf("/")>0)return s;const e=hg(s);return qP(e)}function iF(s){const e=Ac(s);return tF(e)}function AF(s){let e;if(s.face===2||s.face===5){let t=null,n=0;for(let i=0;i<4;i++){const A=`${s.face}/${i}`,l=Ac(A),h=sf(l);(typeof t>"u"||t===null)&&(t=new Float64Array(4*h.length)),t.set(h,n),n+=h.length}e=Af(t)}else{const t=sf(s);e=Af(t)}return e}function Af(s){if(s.length%2!==0)throw new Error("Invalid corners");const e=[],t=[];for(let n=0;n<s.length;n+=2)e.push(s[n]),t.push(s[n+1]);return e.sort((n,i)=>n-i),t.sort((n,i)=>n-i),{west:e[0],east:e[e.length-1],north:t[t.length-1],south:t[0]}}function rF(s,e){const t=(e==null?void 0:e.minimumHeight)||0,n=(e==null?void 0:e.maximumHeight)||0,i=Ac(s),A=AF(i),l=A.west,h=A.south,g=A.east,B=A.north,C=[];return C.push(new k(l,B,t)),C.push(new k(g,B,t)),C.push(new k(g,h,t)),C.push(new k(l,h,t)),C.push(new k(l,B,n)),C.push(new k(g,B,n)),C.push(new k(g,h,n)),C.push(new k(l,h,n)),C}function Bg(s){const e=s.token,t={minimumHeight:s.minimumHeight,maximumHeight:s.maximumHeight},n=rF(e,t),i=iF(e),A=i[0],l=i[1],h=Ze.WGS84.cartographicToCartesian([A,l,t.maximumHeight]),g=new k(h[0],h[1],h[2]);n.push(g);const B=Jh(n);return[...B.center,...B.halfAxes]}const oF=4,aF=8,cF={QUADTREE:oF,OCTREE:aF};function lF(s,e,t){if(s!=null&&s.box){const n=hg(s.s2VolumeInfo.token),i=KP(n,e),A=QP(i),l={...s.s2VolumeInfo};switch(l.token=A,t){case"OCTREE":const B=s.s2VolumeInfo,C=B.maximumHeight-B.minimumHeight,y=C/2,E=B.minimumHeight+C/2;B.minimumHeight=E-y,B.maximumHeight=E+y;break}return{box:Bg(l),s2VolumeInfo:l}}}async function Cg(s){const{subtree:e,subtreeData:t={level:0,x:0,y:0,z:0},parentData:n={mortonIndex:0,localLevel:-1,localX:0,localY:0,localZ:0},childIndex:i=0,implicitOptions:A,loaderOptions:l,s2VolumeBox:h}=s,{subdivisionScheme:g,subtreeLevels:B,maximumLevel:C,contentUrlTemplate:y,subtreesUriTemplate:E,basePath:T}=A,x={children:[],lodMetricValue:0,contentUrl:""};if(!C)return zf.once(`Missing 'maximumLevel' or 'availableLevels' property. The subtree ${y} won't be loaded...`),x;const F=n.localLevel+1,N=t.level+F;if(N>C)return x;const R=cF[g],Q=Math.log2(R),Y=i&1,se=i>>1&1,re=i>>2&1,ue=es(n.localX,Y,1),Te=es(n.localY,se,1),ge=es(n.localZ,re,1),$=es(t.x,ue,F),K=es(t.y,Te,F),O=es(t.z,ge,F),ne=es(n.mortonIndex,i,Q),he=F===B&&Jo(e.childSubtreeAvailability,ne);let Le,Re,Ye,it;if(he){const We=`${T}/${E}`,qe=ua(We,N,$,K,O);Le=await ti(qe,ag,l),it=0,Re={level:N,x:$,y:K,z:O},Ye={mortonIndex:0,localLevel:0,localX:0,localY:0,localZ:0}}else Le=e,it=(R**F-1)/(R-1)+ne,Re=t,Ye={mortonIndex:ne,localLevel:F,localX:ue,localY:Te,localZ:ge};if(!Jo(Le.tileAvailability,it))return x;Jo(Le.contentAvailability,it)&&(x.contentUrl=ua(y,N,$,K,O));for(let We=0;We<R;We++){const qe=lF(h,We,g),rt=await Cg({subtree:Le,subtreeData:Re,parentData:Ye,childIndex:We,implicitOptions:A,loaderOptions:l,s2VolumeBox:qe});(rt.contentUrl||rt.children.length)&&x.children.push(rt)}return x.contentUrl||x.children.length?uF(x,{level:N,x:$,y:K,z:O},A,h):x}function Jo(s,e){let t;return Array.isArray(s)?(t=s[0],s.length>1&&zf.once('Not supported extension "3DTILES_multiple_contents" has been detected')):t=s,"constant"in t?!!t.constant:t.explicitBitstream?dF(e,t.explicitBitstream):!1}function uF(s,e,t,n){const{basePath:i,refine:A,getRefine:l,lodMetricType:h,getTileType:g,rootLodMetricValue:B,rootBoundingVolume:C}=t,y=s.contentUrl&&s.contentUrl.replace(`${i}/`,""),E=B/2**e.level,T=n!=null&&n.box?{box:n.box}:C,x=fF(T,e,t.subdivisionScheme);return{children:s.children,contentUrl:s.contentUrl,content:{uri:y},id:s.contentUrl,refine:l(A),type:g(s),lodMetricType:h,lodMetricValue:E,geometricError:E,transform:s.transform,boundingVolume:x}}function fF(s,e,t){if(s.region){const{level:n,x:i,y:A,z:l}=e,[h,g,B,C,y,E]=s.region,T=2**n,x=(B-h)/T,[F,N]=[h+x*i,h+x*(i+1)],R=(C-g)/T,[Q,Y]=[g+R*A,g+R*(A+1)];let se,re;if(t==="OCTREE"){const ue=(E-y)/T;[se,re]=[y+ue*l,y+ue*(l+1)]}else[se,re]=[y,E];return{region:[F,Q,N,Y,se,re]}}if(s.box)return s;throw new Error(`Unsupported bounding volume type ${JSON.stringify(s)}`)}function es(s,e,t){return(s<<t)+e}function ua(s,e,t,n,i){const A=hF({level:e,x:t,y:n,z:i});return s.replace(/{level}|{x}|{y}|{z}/gi,l=>A[l])}function hF(s){const e={};for(const t in s)e[`{${t}}`]=s[t];return e}function dF(s,e){const t=Math.floor(s/8),n=s%8;return(e[t]>>n&1)===1}function rc(s,e=""){if(!e)return In.EMPTY;const n=e.split("?")[0].split(".").pop();switch(n){case"pnts":return In.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return In.SCENEGRAPH;default:return n||In.EMPTY}}function oc(s){switch(s){case"REPLACE":case"replace":return un.REPLACE;case"ADD":case"add":return un.ADD;default:return s}}function fa(s,e){if(/^[a-z][0-9a-z+.-]*:/i.test(e)){const n=new URL(s,`${e}/`);return decodeURI(n.toString())}else if(s.startsWith("/"))return s;return d1(e,s)}function rf(s,e){var i;if(!s)return null;let t;if(s.content){const A=s.content.uri||((i=s.content)==null?void 0:i.url);typeof A<"u"&&(t=fa(A,e))}return{...s,id:t,contentUrl:t,lodMetricType:Ys.GEOMETRIC_ERROR,lodMetricValue:s.geometricError,transformMatrix:s.transform,type:rc(s,t),refine:oc(s.refine)}}async function gF(s,e,t){let n=null;const i=af(s.root);i&&s.root?n=await of(s.root,s,e,i,t):n=rf(s.root,e);const A=[];for(A.push(n);A.length>0;){const l=A.pop()||{},h=l.children||[],g=[];for(const B of h){const C=af(B);let y;C?y=await of(B,s,e,C,t):y=rf(B,e),y&&(g.push(y),A.push(y))}l.children=g}return n}async function of(s,e,t,n,i){var se,re,ue;const{subdivisionScheme:A,maximumLevel:l,availableLevels:h,subtreeLevels:g,subtrees:{uri:B}}=n,C=ua(B,0,0,0,0),y=fa(C,t),E=await ti(y,ag,i),T=(se=s.content)==null?void 0:se.uri,x=T?fa(T,t):"",F=(re=e==null?void 0:e.root)==null?void 0:re.refine,N=s.geometricError,R=(ue=s.boundingVolume.extensions)==null?void 0:ue["3DTILES_bounding_volume_S2"];if(R){const ge={box:Bg(R),s2VolumeInfo:R};s.boundingVolume=ge}const Q=s.boundingVolume,Y={contentUrlTemplate:x,subtreesUriTemplate:B,subdivisionScheme:A,subtreeLevels:g,maximumLevel:Number.isFinite(h)?h-1:l,refine:F,basePath:t,lodMetricType:Ys.GEOMETRIC_ERROR,rootLodMetricValue:N,rootBoundingVolume:Q,getTileType:rc,getRefine:oc};return await pF(s,t,E,Y,i)}async function pF(s,e,t,n,i){if(!s)return null;const{children:A,contentUrl:l}=await Cg({subtree:t,implicitOptions:n,loaderOptions:i});let h,g=null;return l&&(h=l,g={uri:l.replace(`${e}/`,"")}),{...s,id:h,contentUrl:h,lodMetricType:Ys.GEOMETRIC_ERROR,lodMetricValue:s.geometricError,transformMatrix:s.transform,type:rc(s,h),refine:oc(s.refine),content:g||s.content,children:A}}function af(s){var e;return((e=s==null?void 0:s.extensions)==null?void 0:e["3DTILES_implicit_tiling"])||(s==null?void 0:s.implicitTiling)}const _g={dataType:null,batchType:null,id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:Fd,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:mF,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};async function mF(s,e={},t){const n=e["3d-tiles"]||{};let i;return n.isTileset==="auto"?i=(t==null?void 0:t.url)&&t.url.indexOf(".json")!==-1:i=n.isTileset,i?BF(s,e,t):CF(s,e,t)}async function BF(s,e,t){var g;const n=JSON.parse(new TextDecoder().decode(s)),i=(t==null?void 0:t.url)||"",A=_F(i),l=await gF(n,A,e||{});return{...n,shape:"tileset3d",loader:_g,url:i,queryString:(t==null?void 0:t.queryString)||"",basePath:A,root:l||n.root,type:Ot.TILES3D,lodMetricType:Ys.GEOMETRIC_ERROR,lodMetricValue:((g=n.root)==null?void 0:g.geometricError)||0}}async function CF(s,e,t){const n={content:{shape:"tile3d",featureIds:null}};return await og(s,0,e,t,n.content),n.content}function _F(s){return Vf(s)}const cf=[0],yF={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:_g,onTilesetLoad:{type:"function",value:s=>{}},onTileLoad:{type:"function",value:s=>{}},onTileUnload:{type:"function",value:s=>{}},onTileError:{type:"function",value:(s,e,t)=>{}},_getMeshColor:{type:"function",value:s=>[255,255,255]}};class yg extends xn{initializeState(){"onTileLoadFail"in this.props&&at.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){var e,t;return!!((t=(e=this.state)==null?void 0:e.tileset3d)!=null&&t.isLoaded()&&super.isLoaded)}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({props:e,oldProps:t,changeFlags:n}){if(e.data&&e.data!==t.data&&this._loadTileset(e.data),n.viewportChanged){const{activeViewports:i}=this.state;Object.keys(i).length&&(this._updateTileset(i),this.state.lastUpdatedViewports=i,this.state.activeViewports={})}if(n.propsChanged){const{layerMap:i}=this.state;for(const A in i)i[A].needsUpdate=!0}}activateViewport(e){const{activeViewports:t,lastUpdatedViewports:n}=this.state;this.internalState.viewport=e,t[e.id]=e;const i=n==null?void 0:n[e.id];(!i||!e.equals(i))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo({info:e,sourceLayer:t}){const n=t&&t.props.tile;return e.picked&&(e.object=n),e.sourceTile=n,e}filterSubLayer({layer:e,viewport:t}){const{tile:n}=e.props,{id:i}=t;return n.selected&&n.viewportIds.includes(i)}_updateAutoHighlight(e){const t=e.sourceTile,n=this.state.layerMap[t==null?void 0:t.id];n&&n.layer&&n.layer.updateAutoHighlight(e)}async _loadTileset(e){const{loadOptions:t={}}=this.props,n=this.props.loader||this.props.loaders,i=Array.isArray(n)?n[0]:n,A={loadOptions:{...t}};let l=e;if(i.preload){const B=await i.preload(e,t);B.url&&(l=B.url),B.headers&&(A.loadOptions.fetch={...A.loadOptions.fetch,headers:B.headers}),Object.assign(A,B)}const h=await ti(l,i,A.loadOptions),g=new IS(h,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...A});this.setState({tileset3d:g,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(g)}_onTileLoad(e){const{lastUpdatedViewports:t}=this.state;this.props.onTileLoad(e),this._updateTileset(t),this.setNeedsUpdate()}_onTileUnload(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)}_updateTileset(e){if(!e)return;const{tileset3d:t}=this.state,{timeline:n}=this.context,i=Object.keys(e).length;!n||!i||!t||t.selectTiles(Object.values(e)).then(A=>{this.state.frameNumber!==A&&this.setState({frameNumber:A})})}_getSubLayer(e,t){if(!e.content)return null;switch(e.type){case In.POINTCLOUD:return this._makePointCloudLayer(e,t);case In.SCENEGRAPH:return this._make3DModelLayer(e);case In.MESH:return this._makeSimpleMeshLayer(e,t);default:throw new Error(`Tile3DLayer: Failed to render layer of type ${e.content.type}`)}}_makePointCloudLayer(e,t){const{attributes:n,pointCount:i,constantRGBA:A,cartographicOrigin:l,modelMatrix:h}=e.content,{positions:g,normals:B,colors:C}=n;if(!g)return null;const y=t&&t.props.data||{header:{vertexCount:i},attributes:{POSITION:g,NORMAL:B,COLOR_0:C}},{pointSize:E,getPointColor:T}=this.props,x=this.getSubLayerClass("pointcloud",Sa);return new x({pointSize:E},this.getSubLayerProps({id:"pointcloud"}),{id:`${this.id}-pointcloud-${e.id}`,tile:e,data:y,coordinateSystem:pt.METER_OFFSETS,coordinateOrigin:l,modelMatrix:h,getColor:A||T,_offset:0})}_make3DModelLayer(e){const{gltf:t,instances:n,cartographicOrigin:i,modelMatrix:A}=e.content,l=this.getSubLayerClass("scenegraph",Wa);return new l({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:`${this.id}-scenegraph-${e.id}`,tile:e,data:n||cf,scenegraph:t,coordinateSystem:pt.METER_OFFSETS,coordinateOrigin:i,modelMatrix:A,getTransformMatrix:h=>h.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(e,t){const n=e.content,{attributes:i,indices:A,modelMatrix:l,cartographicOrigin:h,coordinateSystem:g=pt.METER_OFFSETS,material:B,featureIds:C}=n,{_getMeshColor:y}=this.props,E=t&&t.props.mesh||new Ht({topology:"triangle-list",attributes:bF(i),indices:A}),T=this.getSubLayerClass("mesh",Xa);return new T(this.getSubLayerProps({id:"mesh"}),{id:`${this.id}-mesh-${e.id}`,tile:e,mesh:E,data:cf,getColor:y(e),pbrMaterial:B,modelMatrix:l,coordinateOrigin:h,coordinateSystem:g,featureIds:C,_offset:0})}renderLayers(){const{tileset3d:e,layerMap:t}=this.state;return e?e.tiles.map(n=>{const i=t[n.id]=t[n.id]||{tile:n};let{layer:A}=i;return n.selected&&(A?i.needsUpdate&&(A=this._getSubLayer(n,A),i.needsUpdate=!1):A=this._getSubLayer(n)),i.layer=A,A}).filter(Boolean):null}}yg.defaultProps=yF;yg.layerName="Tile3DLayer";function bF(s){const e={};return e.positions={...s.positions,value:new Float32Array(s.positions.value)},s.normals&&(e.normals=s.normals),s.texCoords&&(e.texCoords=s.texCoords),s.colors&&(e.colors=s.colors),s.uvRegions&&(e.uvRegions=s.uvRegions),e}const EF="4.3.2",bg={dataType:null,batchType:null,name:"Terrain",id:"terrain",module:"terrain",version:EF,worker:!0,extensions:["png","pngraw","jpg","jpeg","gif","webp","bmp"],mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp"],options:{terrain:{tesselator:"auto",bounds:void 0,meshMaxError:10,elevationDecoder:{rScaler:1,gScaler:0,bScaler:0,offset:0},skirtHeight:void 0}}};({...bg});const lf=[1],TF={...Ni.defaultProps,elevationData:JA,texture:{...JA,optional:!0},meshMaxError:{type:"number",value:4},bounds:{type:"array",value:null,optional:!0,compare:!0},color:{type:"color",value:[255,255,255]},elevationDecoder:{type:"object",value:{rScaler:1,gScaler:0,bScaler:0,offset:0}},workerUrl:"",wireframe:!1,material:!0,loaders:[bg]};function uf(s){return Array.isArray(s)?s.join(";"):s||""}class Eg extends xn{updateState({props:e,oldProps:t}){const n=e.elevationData!==t.elevationData;if(n){const{elevationData:A}=e,l=A&&(Array.isArray(A)||A.includes("{x}")&&A.includes("{y}"));this.setState({isTiled:l})}const i=n||e.meshMaxError!==t.meshMaxError||e.elevationDecoder!==t.elevationDecoder||e.bounds!==t.bounds;if(!this.state.isTiled&&i){const A=this.loadTerrain(e);this.setState({terrain:A})}e.workerUrl&&at.removed("workerUrl","loadOptions.terrain.workerUrl")()}loadTerrain({elevationData:e,bounds:t,elevationDecoder:n,meshMaxError:i,signal:A}){if(!e)return null;let l=this.getLoadOptions();l={...l,terrain:{skirtHeight:this.state.isTiled?i*2:0,...l==null?void 0:l.terrain,bounds:t,meshMaxError:i,elevationDecoder:n}};const{fetch:h}=this.props;return h(e,{propName:"elevationData",layer:this,loadOptions:l,signal:A})}getTiledTerrainData(e){const{elevationData:t,fetch:n,texture:i,elevationDecoder:A,meshMaxError:l}=this.props,{viewport:h}=this.context,g=VA(t,e),B=i&&VA(i,e),{signal:C}=e;let y=[0,0],E=[0,0];if(h.isGeospatial){const N=e.bbox;y=h.projectFlat([N.west,N.south]),E=h.projectFlat([N.east,N.north])}else{const N=e.bbox;y=[N.left,N.bottom],E=[N.right,N.top]}const T=[y[0],y[1],E[0],E[1]],x=this.loadTerrain({elevationData:g,bounds:T,elevationDecoder:A,meshMaxError:l,signal:C}),F=B?n(B,{propName:"texture",layer:this,loaders:[],signal:C}).catch(N=>null):Promise.resolve(null);return Promise.all([x,F])}renderSubLayers(e){const t=this.getSubLayerClass("mesh",Ii),{color:n,wireframe:i,material:A}=this.props,{data:l}=e;if(!l)return null;const[h,g]=l;return new t(e,{data:lf,mesh:h,texture:g,_instanced:!1,coordinateSystem:pt.CARTESIAN,getPosition:B=>[0,0,0],getColor:n,wireframe:i,material:A})}onViewportLoad(e){if(!e)return;const{zRange:t}=this.state,n=e.map(l=>l.content).filter(Boolean).map(l=>l[0].header.boundingBox.map(g=>g[2]));if(n.length===0)return;const i=Math.min(...n.map(l=>l[0])),A=Math.max(...n.map(l=>l[1]));(!t||i<t[0]||A>t[1])&&this.setState({zRange:[i,A]})}renderLayers(){const{color:e,material:t,elevationData:n,texture:i,wireframe:A,meshMaxError:l,elevationDecoder:h,tileSize:g,maxZoom:B,minZoom:C,extent:y,maxRequests:E,onTileLoad:T,onTileUnload:x,onTileError:F,maxCacheSize:N,maxCacheByteSize:R,refinementStrategy:Q}=this.props;if(this.state.isTiled)return new Ni(this.getSubLayerProps({id:"tiles"}),{getTileData:this.getTiledTerrainData.bind(this),renderSubLayers:this.renderSubLayers.bind(this),updateTriggers:{getTileData:{elevationData:uf(n),texture:uf(i),meshMaxError:l,elevationDecoder:h}},onViewportLoad:this.onViewportLoad.bind(this),zRange:this.state.zRange||null,tileSize:g,maxZoom:B,minZoom:C,extent:y,maxRequests:E,onTileLoad:T,onTileUnload:x,onTileError:F,maxCacheSize:N,maxCacheByteSize:R,refinementStrategy:Q});if(!n)return null;const Y=this.getSubLayerClass("mesh",Ii);return new Y(this.getSubLayerProps({id:"mesh"}),{data:lf,mesh:this.state.terrain,texture:i,_instanced:!1,getPosition:se=>[0,0,0],getColor:e,material:t,wireframe:A})}}Eg.defaultProps=TF;Eg.layerName="TerrainLayer";const vF={clipBounds:[0,0,1,1],clipByInstance:void 0},Tg=`
uniform clipUniforms {
  vec4 bounds;
} clip;

bool clip_isInBounds(vec2 position) {
  return position.x >= clip.bounds[0] && position.y >= clip.bounds[1] && position.x < clip.bounds[2] && position.y < clip.bounds[3];
}
`,IF={name:"clip",vs:Tg,uniformTypes:{bounds:"vec4<f32>"}},MF={"vs:#decl":`
out float clip_isVisible;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_isVisible = float(clip_isInBounds(geometry.worldPosition.xy));
`,"fs:#decl":`
in float clip_isVisible;
`,"fs:DECKGL_FILTER_COLOR":`
  if (clip_isVisible < 0.5) discard;
`},wF={name:"clip",fs:Tg,uniformTypes:{bounds:"vec4<f32>"}},SF={"vs:#decl":`
out vec2 clip_commonPosition;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_commonPosition = geometry.position.xy;
`,"fs:#decl":`
in vec2 clip_commonPosition;
`,"fs:DECKGL_FILTER_COLOR":`
  if (!clip_isInBounds(clip_commonPosition)) discard;
`};class ac extends Ia{getShaders(){let e="instancePositions"in this.getAttributeManager().attributes;return this.props.clipByInstance!==void 0&&(e=!!this.props.clipByInstance),this.state.clipByInstance=e,e?{modules:[IF],inject:MF}:{modules:[wF],inject:SF}}draw(){const{clipBounds:e}=this.props,t={};if(this.state.clipByInstance)t.bounds=e;else{const n=this.projectPosition([e[0],e[1],0]),i=this.projectPosition([e[2],e[3],0]);t.bounds=[Math.min(n[0],i[0]),Math.min(n[1],i[1]),Math.max(n[0],i[0]),Math.max(n[1],i[1])]}this.setShaderModuleProps({clip:t})}}ac.defaultProps=vF;ac.extensionName="ClipExtension";function ff(s,e){const t=e==null?void 0:e.globalFeatureId;return t!==void 0?xF(s,t):DF(s,e==null?void 0:e.type)}function xF(s,e){const t=vg(s);for(const n of t){let i=0,A=n.featureIds.value[0];for(let l=0;l<n.featureIds.value.length;l++){const h=n.featureIds.value[l];if(h!==A){if(e===n.globalFeatureIds.value[i])return er(n,i,l);i=l,A=h}}if(e===n.globalFeatureIds.value[i])return er(n,i,n.featureIds.value.length)}throw new Error(`featureId:${e} not found`)}function DF(s,e){const t=vg(s);return FF(t)}function PF(s,e,t){switch(s.type){case"Point":return GF(s,e,t);case"LineString":return OF(s,e,t);case"Polygon":return Ig(s,e,t);default:const n=s;throw new Error(`Unsupported geometry type: ${n==null?void 0:n.type}`)}}function vg(s,e){const t=[];return s.points&&(s.points.type="Point",t.push(s.points)),s.lines&&(s.lines.type="LineString",t.push(s.lines)),s.polygons&&(s.polygons.type="Polygon",t.push(s.polygons)),t}function FF(s){const e=[];for(const t of s){if(t.featureIds.value.length===0)continue;let n=0,i=t.featureIds.value[0];for(let A=0;A<t.featureIds.value.length;A++){const l=t.featureIds.value[A];l!==i&&(e.push(er(t,n,A)),n=A,i=l)}e.push(er(t,n,t.featureIds.value.length))}return e}function er(s,e,t){const n=PF(s,e,t),i=RF(s,e),A=LF(s,e);return{type:"Feature",geometry:n,properties:i,...A}}function LF(s,e=0,t){return s.fields&&s.fields[s.featureIds.value[e]]}function RF(s,e=0,t){const n=Object.assign({},s.properties[s.featureIds.value[e]]);for(const i in s.numericProps)n[i]=s.numericProps[i].value[e];return n}function Ig(s,e=-1/0,t=1/0){const{positions:n}=s,i=s.polygonIndices.value.filter(g=>g>=e&&g<=t),A=s.primitivePolygonIndices.value.filter(g=>g>=e&&g<=t);if(!(i.length>2)){const g=[];for(let B=0;B<A.length-1;B++){const C=A[B],y=A[B+1],E=tr(n,C,y);g.push(E)}return{type:"Polygon",coordinates:g}}const h=[];for(let g=0;g<i.length-1;g++){const B=i[g],C=i[g+1],y=Ig(s,B,C).coordinates;h.push(y)}return{type:"MultiPolygon",coordinates:h}}function OF(s,e=-1/0,t=1/0){const{positions:n}=s,i=s.pathIndices.value.filter(h=>h>=e&&h<=t);if(!(i.length>2))return{type:"LineString",coordinates:tr(n,i[0],i[1])};const l=[];for(let h=0;h<i.length-1;h++){const g=tr(n,i[h],i[h+1]);l.push(g)}return{type:"MultiLineString",coordinates:l}}function GF(s,e,t){const{positions:n}=s,i=tr(n,e,t);return i.length>1?{type:"MultiPoint",coordinates:i}:{type:"Point",coordinates:i[0]}}function tr(s,e,t){e=e||0,t=t||s.value.length/s.size;const n=[];for(let i=e;i<t;i++){const A=Array();for(let l=i*s.size;l<(i+1)*s.size;l++)A.push(Number(s.value[l]));n.push(A)}return n}const NF="4.3.2",Mg={dataType:null,batchType:null,name:"Mapbox Vector Tile",id:"mvt",module:"mvt",version:NF,extensions:["mvt","pbf"],mimeTypes:["application/vnd.mapbox-vector-tile","application/x-protobuf"],worker:!0,category:"geometry",options:{mvt:{shape:"geojson",coordinates:"local",layerProperty:"layerName",layers:void 0,tileIndex:void 0}}};({...Mg});const UF={Point:wg,MultiPoint:HF,LineString:Sg,MultiLineString:kF,Polygon:xg,MultiPolygon:JF};function wg([s,e],[t,n],i){const A=Hn(t[0],n[0],s),l=Hn(t[1],n[1],e);return i.unprojectFlat([A,l])}function cc(s,e,t){return s.map(n=>wg(n,e,t))}function HF(s,e,t){return cc(s,e,t)}function Sg(s,e,t){return cc(s,e,t)}function kF(s,e,t){return s.map(n=>Sg(n,e,t))}function xg(s,e,t){return s.map(n=>cc(n,e,t))}function JF(s,e,t){return s.map(n=>xg(n,e,t))}function VF(s,e,t){const n=t.projectFlat([e.west,e.north]),i=t.projectFlat([e.east,e.south]),A=[n,i];return{...s,coordinates:UF[s.type](s.coordinates,A,t)}}const zF=["points","lines","polygons"];function jF(s,e,t,n){for(const i of zF){const A=s[i]&&QF(s[i],e,t,n);if(A>=0)return A}return-1}function QF(s,e,t,n){const i=s.featureIds.value;if(!i.length)return-1;let A=0,l=i[i.length-1]+1;if(n){const g=KF(s,n);if(g)A=g[0],l=g[1]+1;else return-1}let h=-1;if(e in s.numericProps){const g=s.numericProps[e].value.findIndex((B,C)=>B===t&&i[C]>=A&&i[C]<l);return g>=0?s.globalFeatureIds.value[g]:-1}else e?h=hf(s.properties,g=>g[e]===t,A,l):s.fields&&(h=hf(s.fields,g=>g.id===t,A,l));return h>=0?WF(s,h):-1}function KF(s,e){if(!s.__layers){const t={},{properties:n}=s;for(let i=0;i<n.length;i++){const{layerName:A}=n[i];A&&(t[A]?t[A][1]=i:t[A]=[i,i])}s.__layers=t}return s.__layers[e]}function WF(s,e){if(!s.__ids){const t=[],n=s.featureIds.value,i=s.globalFeatureIds.value;for(let A=0;A<n.length;A++)t[n[A]]=i[A];s.__ids=t}return s.__ids[e]}function hf(s,e,t,n){for(let i=t;i<n;i++)if(e(s[i],i))return i;return-1}const Vo=512,XF={...Fi.defaultProps,data:JA,onDataLoad:{type:"function",value:null,optional:!0,compare:!1},uniqueIdProperty:"",highlightedFeatureId:null,loaders:[Mg],binary:!0};class Dg extends Ni{initializeState(){super.initializeState();const e=this.context.viewport.resolution!==void 0?!1:this.props.binary;this.setState({binary:e,data:null,tileJSON:null,hoveredFeatureId:null,hoveredFeatureLayerName:null})}get isLoaded(){var e;return!!((e=this.state)!=null&&e.data&&super.isLoaded)}updateState({props:e,oldProps:t,context:n,changeFlags:i}){var l;i.dataChanged&&this._updateTileData(),(l=this.state)!=null&&l.data&&(super.updateState({props:e,oldProps:t,context:n,changeFlags:i}),this._setWGS84PropertyForTiles());const{highlightColor:A}=e;A!==t.highlightColor&&Array.isArray(A)&&this.setState({highlightColor:A})}async _updateTileData(){let e=this.props.data,t=null;if(typeof e=="string"&&!lE(e)){const{onDataLoad:n,fetch:i}=this.props;this.setState({data:null,tileJSON:null});try{t=await i(e,{propName:"data",layer:this,loaders:[]})}catch(A){this.raiseError(A,"loading TileJSON"),e=null}n&&n(t,{propName:"data",layer:this})}else e&&typeof e=="object"&&"tilejson"in e&&(t=e);t&&(e=t.tiles),this.setState({data:e,tileJSON:t})}_getTilesetOptions(){const e=super._getTilesetOptions(),t=this.state.tileJSON,{minZoom:n,maxZoom:i}=this.props;return t&&(Number.isFinite(t.minzoom)&&t.minzoom>n&&(e.minZoom=t.minzoom),Number.isFinite(t.maxzoom)&&(!Number.isFinite(i)||t.maxzoom<i)&&(e.maxZoom=t.maxzoom)),e}renderLayers(){var e;return(e=this.state)!=null&&e.data?super.renderLayers():null}getTileData(e){const{data:t,binary:n}=this.state,{index:i,signal:A}=e,l=VA(t,e);if(!l)return Promise.reject("Invalid URL");let h=this.getLoadOptions();const{fetch:g}=this.props;return h={...h,mimeType:"application/x-protobuf",mvt:{...h==null?void 0:h.mvt,coordinates:this.context.viewport.resolution?"wgs84":"local",tileIndex:i},gis:n?{format:"binary"}:{}},g(l,{propName:"data",layer:this,loadOptions:h,signal:A})}renderSubLayers(e){const{x:t,y:n,z:i}=e.tile.index,A=Math.pow(2,i),l=Vo/A,h=-l,g=Vo*t/A,B=Vo*(1-n/A),C=new Fe().scale([l,h,1]);e.autoHighlight=!1,this.context.viewport.resolution||(e.modelMatrix=C,e.coordinateOrigin=[g,B,0],e.coordinateSystem=pt.CARTESIAN,e.extensions=[...e.extensions||[],new ac]);const y=super.renderSubLayers(e);return this.state.binary&&!(y instanceof Fi)&&at.warn("renderSubLayers() must return GeoJsonLayer when using binary:true")(),y}_updateAutoHighlight(e){const{uniqueIdProperty:t}=this.props,{hoveredFeatureId:n,hoveredFeatureLayerName:i}=this.state,A=e.object;let l=null,h=null;A&&(l=zo(A,t),h=df(A));let{highlightColor:g}=this.props;typeof g=="function"&&(g=g(e)),(n!==l||i!==h)&&this.setState({highlightColor:g,hoveredFeatureId:l,hoveredFeatureLayerName:h})}_isWGS84(){return!!this.context.viewport.resolution}getPickingInfo(e){const t=super.getPickingInfo(e);if(this.state.binary&&t.index!==-1){const{data:n}=e.sourceLayer.props;t.object=ff(n,{globalFeatureId:t.index})}return t.object&&!this._isWGS84()&&(t.object=pf(t.object,t.tile.bbox,this.context.viewport)),t}getSubLayerPropsByTile(e){return{highlightedObjectIndex:this.getHighlightedObjectIndex(e),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(e){const{hoveredFeatureId:t,hoveredFeatureLayerName:n,binary:i}=this.state,{uniqueIdProperty:A,highlightedFeatureId:l}=this.props,h=e.content,g=gf(l);if(!(gf(t)||g))return-1;const C=g?l:t;return Array.isArray(h)?h.findIndex(y=>{const E=zo(y,A)===C,T=g||df(y)===n;return E&&T}):h&&i?jF(h,A,C,g?"":n):-1}_pickObjects(e){const{deck:t,viewport:n}=this.context,i=n.width,A=n.height,l=n.x,h=n.y,g=[this.id];return t.pickObjects({x:l,y:h,width:i,height:A,layerIds:g,maxObjects:e})}getRenderedFeatures(e=null){const t=this._pickObjects(e),n=new Set,i=[];for(const A of t){const l=zo(A.object,this.props.uniqueIdProperty);l===void 0?i.push(A.object):n.has(l)||(n.add(l),i.push(A.object))}return i}_setWGS84PropertyForTiles(){const e="dataInWGS84";this.state.tileset.selectedTiles.forEach(n=>{n.hasOwnProperty(e)||Object.defineProperty(n,e,{get:()=>{if(!n.content)return null;if(this.state.binary&&Array.isArray(n.content)&&!n.content.length)return[];const{bbox:i}=n;if(n._contentWGS84===void 0&&uE(i)){const A=this.state.binary?ff(n.content):n.content;n._contentWGS84=A.map(l=>pf(l,i,this.context.viewport))}return n._contentWGS84}})})}}Dg.layerName="MVTLayer";Dg.defaultProps=XF;function zo(s,e){if(s.properties&&e)return s.properties[e];if("id"in s)return s.id}function df(s){var e;return((e=s.properties)==null?void 0:e.layerName)||null}function gf(s){return s!=null&&s!==""}function pf(s,e,t){const n={...s,geometry:{type:s.geometry.type}};return Object.defineProperty(n.geometry,"coordinates",{get:()=>VF(s.geometry,e,t).coordinates}),n}const mf="0123456789bcdefghjkmnpqrstuvwxyz",Pg={};for(let s=0;s<mf.length;s++)Pg[mf.charAt(s)]=s;const YF=-90,$F=90,ZF=-180,qF=180;function eL(s){let e=!0,t=$F,n=YF,i=qF,A=ZF,l,h=0;for(let g=0,B=s.length;g<B;g++){const C=s[g].toLowerCase();h=Pg[C];for(let y=4;y>=0;y--){const E=h>>y&1;e?(l=(i+A)/2,E===1?A=l:i=l):(l=(t+n)/2,E===1?n=l:t=l),e=!e}}return[n,A,t,i]}function tL(s){const[e,t,n,i]=eL(s);return[i,n,i,e,t,e,t,n,i,n]}const nL={getGeohash:{type:"accessor",value:s=>s.geohash}};class Fg extends si{indexToBounds(){const{data:e,getGeohash:t}=this.props;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(n,i)=>tL(t(n,i))}}}Fg.layerName="GeohashLayer";Fg.defaultProps=nL;var Er,st,Lg,ns,Bf,Rg,Og,Gg,lc,ha,da,Si={},Ng=[],sL=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,uc=Array.isArray;function Un(s,e){for(var t in e)s[t]=e[t];return s}function fc(s){s&&s.parentNode&&s.parentNode.removeChild(s)}function iL(s,e,t){var n,i,A,l={};for(A in e)A=="key"?n=e[A]:A=="ref"?i=e[A]:l[A]=e[A];if(arguments.length>2&&(l.children=arguments.length>3?Er.call(arguments,2):t),typeof s=="function"&&s.defaultProps!=null)for(A in s.defaultProps)l[A]===void 0&&(l[A]=s.defaultProps[A]);return DA(s,l,n,i,null)}function DA(s,e,t,n,i){var A={type:s,props:e,key:t,ref:n,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:i??++Lg,__i:-1,__u:0};return i==null&&st.vnode!=null&&st.vnode(A),A}function Tr(s){return s.children}function PA(s,e){this.props=s,this.context=e}function ei(s,e){if(e==null)return s.__?ei(s.__,s.__i+1):null;for(var t;e<s.__k.length;e++)if((t=s.__k[e])!=null&&t.__e!=null)return t.__e;return typeof s.type=="function"?ei(s):null}function Ug(s){var e,t;if((s=s.__)!=null&&s.__c!=null){for(s.__e=s.__c.base=null,e=0;e<s.__k.length;e++)if((t=s.__k[e])!=null&&t.__e!=null){s.__e=s.__c.base=t.__e;break}return Ug(s)}}function Cf(s){(!s.__d&&(s.__d=!0)&&ns.push(s)&&!nr.__r++||Bf!==st.debounceRendering)&&((Bf=st.debounceRendering)||Rg)(nr)}function nr(){for(var s,e,t,n,i,A,l,h=1;ns.length;)ns.length>h&&ns.sort(Og),s=ns.shift(),h=ns.length,s.__d&&(t=void 0,i=(n=(e=s).__v).__e,A=[],l=[],e.__P&&((t=Un({},n)).__v=n.__v+1,st.vnode&&st.vnode(t),hc(e.__P,t,n,e.__n,e.__P.namespaceURI,32&n.__u?[i]:null,A,i??ei(n),!!(32&n.__u),l),t.__v=n.__v,t.__.__k[t.__i]=t,Jg(A,t,l),t.__e!=i&&Ug(t)));nr.__r=0}function Hg(s,e,t,n,i,A,l,h,g,B,C){var y,E,T,x,F,N,R=n&&n.__k||Ng,Q=e.length;for(g=AL(t,e,R,g,Q),y=0;y<Q;y++)(T=t.__k[y])!=null&&(E=T.__i===-1?Si:R[T.__i]||Si,T.__i=y,N=hc(s,T,E,i,A,l,h,g,B,C),x=T.__e,T.ref&&E.ref!=T.ref&&(E.ref&&dc(E.ref,null,T),C.push(T.ref,T.__c||x,T)),F==null&&x!=null&&(F=x),4&T.__u||E.__k===T.__k?g=kg(T,g,s):typeof T.type=="function"&&N!==void 0?g=N:x&&(g=x.nextSibling),T.__u&=-7);return t.__e=F,g}function AL(s,e,t,n,i){var A,l,h,g,B,C=t.length,y=C,E=0;for(s.__k=new Array(i),A=0;A<i;A++)(l=e[A])!=null&&typeof l!="boolean"&&typeof l!="function"?(g=A+E,(l=s.__k[A]=typeof l=="string"||typeof l=="number"||typeof l=="bigint"||l.constructor==String?DA(null,l,null,null,null):uc(l)?DA(Tr,{children:l},null,null,null):l.constructor===void 0&&l.__b>0?DA(l.type,l.props,l.key,l.ref?l.ref:null,l.__v):l).__=s,l.__b=s.__b+1,h=null,(B=l.__i=rL(l,t,g,y))!==-1&&(y--,(h=t[B])&&(h.__u|=2)),h==null||h.__v===null?(B==-1&&(i>C?E--:i<C&&E++),typeof l.type!="function"&&(l.__u|=4)):B!=g&&(B==g-1?E--:B==g+1?E++:(B>g?E--:E++,l.__u|=4))):s.__k[A]=null;if(y)for(A=0;A<C;A++)(h=t[A])!=null&&(2&h.__u)==0&&(h.__e==n&&(n=ei(h)),Vg(h,h));return n}function kg(s,e,t){var n,i;if(typeof s.type=="function"){for(n=s.__k,i=0;n&&i<n.length;i++)n[i]&&(n[i].__=s,e=kg(n[i],e,t));return e}s.__e!=e&&(e&&s.type&&!t.contains(e)&&(e=ei(s)),t.insertBefore(s.__e,e||null),e=s.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function rL(s,e,t,n){var i,A,l=s.key,h=s.type,g=e[t];if(g===null&&s.key==null||g&&l==g.key&&h===g.type&&(2&g.__u)==0)return t;if(n>(g!=null&&(2&g.__u)==0?1:0))for(i=t-1,A=t+1;i>=0||A<e.length;){if(i>=0){if((g=e[i])&&(2&g.__u)==0&&l==g.key&&h===g.type)return i;i--}if(A<e.length){if((g=e[A])&&(2&g.__u)==0&&l==g.key&&h===g.type)return A;A++}}return-1}function _f(s,e,t){e[0]=="-"?s.setProperty(e,t??""):s[e]=t==null?"":typeof t!="number"||sL.test(e)?t:t+"px"}function CA(s,e,t,n,i){var A;e:if(e=="style")if(typeof t=="string")s.style.cssText=t;else{if(typeof n=="string"&&(s.style.cssText=n=""),n)for(e in n)t&&e in t||_f(s.style,e,"");if(t)for(e in t)n&&t[e]===n[e]||_f(s.style,e,t[e])}else if(e[0]=="o"&&e[1]=="n")A=e!=(e=e.replace(Gg,"$1")),e=e.toLowerCase()in s||e=="onFocusOut"||e=="onFocusIn"?e.toLowerCase().slice(2):e.slice(2),s.l||(s.l={}),s.l[e+A]=t,t?n?t.u=n.u:(t.u=lc,s.addEventListener(e,A?da:ha,A)):s.removeEventListener(e,A?da:ha,A);else{if(i=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in s)try{s[e]=t??"";break e}catch{}typeof t=="function"||(t==null||t===!1&&e[4]!="-"?s.removeAttribute(e):s.setAttribute(e,e=="popover"&&t==1?"":t))}}function yf(s){return function(e){if(this.l){var t=this.l[e.type+s];if(e.t==null)e.t=lc++;else if(e.t<t.u)return;return t(st.event?st.event(e):e)}}}function hc(s,e,t,n,i,A,l,h,g,B){var C,y,E,T,x,F,N,R,Q,Y,se,re,ue,Te,ge,$,K,O,ne=e.type;if(e.constructor!==void 0)return null;128&t.__u&&(g=!!(32&t.__u),A=[h=e.__e=t.__e]),(C=st.__b)&&C(e);e:if(typeof ne=="function")try{if(R=e.props,Q="prototype"in ne&&ne.prototype.render,Y=(C=ne.contextType)&&n[C.__c],se=C?Y?Y.props.value:C.__:n,t.__c?N=(y=e.__c=t.__c).__=y.__E:(Q?e.__c=y=new ne(R,se):(e.__c=y=new PA(R,se),y.constructor=ne,y.render=aL),Y&&Y.sub(y),y.props=R,y.state||(y.state={}),y.context=se,y.__n=n,E=y.__d=!0,y.__h=[],y._sb=[]),Q&&y.__s==null&&(y.__s=y.state),Q&&ne.getDerivedStateFromProps!=null&&(y.__s==y.state&&(y.__s=Un({},y.__s)),Un(y.__s,ne.getDerivedStateFromProps(R,y.__s))),T=y.props,x=y.state,y.__v=e,E)Q&&ne.getDerivedStateFromProps==null&&y.componentWillMount!=null&&y.componentWillMount(),Q&&y.componentDidMount!=null&&y.__h.push(y.componentDidMount);else{if(Q&&ne.getDerivedStateFromProps==null&&R!==T&&y.componentWillReceiveProps!=null&&y.componentWillReceiveProps(R,se),!y.__e&&(y.shouldComponentUpdate!=null&&y.shouldComponentUpdate(R,y.__s,se)===!1||e.__v==t.__v)){for(e.__v!=t.__v&&(y.props=R,y.state=y.__s,y.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.some(function(he){he&&(he.__=e)}),re=0;re<y._sb.length;re++)y.__h.push(y._sb[re]);y._sb=[],y.__h.length&&l.push(y);break e}y.componentWillUpdate!=null&&y.componentWillUpdate(R,y.__s,se),Q&&y.componentDidUpdate!=null&&y.__h.push(function(){y.componentDidUpdate(T,x,F)})}if(y.context=se,y.props=R,y.__P=s,y.__e=!1,ue=st.__r,Te=0,Q){for(y.state=y.__s,y.__d=!1,ue&&ue(e),C=y.render(y.props,y.state,y.context),ge=0;ge<y._sb.length;ge++)y.__h.push(y._sb[ge]);y._sb=[]}else do y.__d=!1,ue&&ue(e),C=y.render(y.props,y.state,y.context),y.state=y.__s;while(y.__d&&++Te<25);y.state=y.__s,y.getChildContext!=null&&(n=Un(Un({},n),y.getChildContext())),Q&&!E&&y.getSnapshotBeforeUpdate!=null&&(F=y.getSnapshotBeforeUpdate(T,x)),K=($=C!=null&&C.type===Tr&&C.key==null)?C.props.children:C,$&&(C.props.children=null),h=Hg(s,uc(K)?K:[K],e,t,n,i,A,l,h,g,B),y.base=e.__e,e.__u&=-161,y.__h.length&&l.push(y),N&&(y.__E=y.__=null)}catch(he){if(e.__v=null,g||A!=null)if(he.then){for(e.__u|=g?160:128;h&&h.nodeType==8&&h.nextSibling;)h=h.nextSibling;A[A.indexOf(h)]=null,e.__e=h}else for(O=A.length;O--;)fc(A[O]);else e.__e=t.__e,e.__k=t.__k;st.__e(he,e,t)}else A==null&&e.__v==t.__v?(e.__k=t.__k,e.__e=t.__e):h=e.__e=oL(t.__e,e,t,n,i,A,l,g,B);return(C=st.diffed)&&C(e),128&e.__u?void 0:h}function Jg(s,e,t){for(var n=0;n<t.length;n++)dc(t[n],t[++n],t[++n]);st.__c&&st.__c(e,s),s.some(function(i){try{s=i.__h,i.__h=[],s.some(function(A){A.call(i)})}catch(A){st.__e(A,i.__v)}})}function oL(s,e,t,n,i,A,l,h,g){var B,C,y,E,T,x,F,N=t.props,R=e.props,Q=e.type;if(Q=="svg"?i="http://www.w3.org/2000/svg":Q=="math"?i="http://www.w3.org/1998/Math/MathML":i||(i="http://www.w3.org/1999/xhtml"),A!=null){for(B=0;B<A.length;B++)if((T=A[B])&&"setAttribute"in T==!!Q&&(Q?T.localName==Q:T.nodeType==3)){s=T,A[B]=null;break}}if(s==null){if(Q==null)return document.createTextNode(R);s=document.createElementNS(i,Q,R.is&&R),h&&(st.__m&&st.__m(e,A),h=!1),A=null}if(Q===null)N===R||h&&s.data===R||(s.data=R);else{if(A=A&&Er.call(s.childNodes),N=t.props||Si,!h&&A!=null)for(N={},B=0;B<s.attributes.length;B++)N[(T=s.attributes[B]).name]=T.value;for(B in N)if(T=N[B],B!="children"){if(B=="dangerouslySetInnerHTML")y=T;else if(!(B in R)){if(B=="value"&&"defaultValue"in R||B=="checked"&&"defaultChecked"in R)continue;CA(s,B,null,T,i)}}for(B in R)T=R[B],B=="children"?E=T:B=="dangerouslySetInnerHTML"?C=T:B=="value"?x=T:B=="checked"?F=T:h&&typeof T!="function"||N[B]===T||CA(s,B,T,N[B],i);if(C)h||y&&(C.__html===y.__html||C.__html===s.innerHTML)||(s.innerHTML=C.__html),e.__k=[];else if(y&&(s.innerHTML=""),Hg(e.type==="template"?s.content:s,uc(E)?E:[E],e,t,n,Q=="foreignObject"?"http://www.w3.org/1999/xhtml":i,A,l,A?A[0]:t.__k&&ei(t,0),h,g),A!=null)for(B=A.length;B--;)fc(A[B]);h||(B="value",Q=="progress"&&x==null?s.removeAttribute("value"):x!==void 0&&(x!==s[B]||Q=="progress"&&!x||Q=="option"&&x!==N[B])&&CA(s,B,x,N[B],i),B="checked",F!==void 0&&F!==s[B]&&CA(s,B,F,N[B],i))}return s}function dc(s,e,t){try{if(typeof s=="function"){var n=typeof s.__u=="function";n&&s.__u(),n&&e==null||(s.__u=s(e))}else s.current=e}catch(i){st.__e(i,t)}}function Vg(s,e,t){var n,i;if(st.unmount&&st.unmount(s),(n=s.ref)&&(n.current&&n.current!==s.__e||dc(n,null,e)),(n=s.__c)!=null){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(A){st.__e(A,e)}n.base=n.__P=null}if(n=s.__k)for(i=0;i<n.length;i++)n[i]&&Vg(n[i],e,t||typeof s.type!="function");t||fc(s.__e),s.__c=s.__=s.__e=void 0}function aL(s,e,t){return this.constructor(s,t)}function gc(s,e,t){var n,i,A,l;e==document&&(e=document.documentElement),st.__&&st.__(s,e),i=(n=!1)?null:e.__k,A=[],l=[],hc(e,s=e.__k=iL(Tr,null,[s]),i||Si,Si,e.namespaceURI,i?null:e.firstChild?Er.call(e.childNodes):null,A,i?i.__e:e.firstChild,n,l),Jg(A,s,l)}Er=Ng.slice,st={__e:function(s,e,t,n){for(var i,A,l;e=e.__;)if((i=e.__c)&&!i.__)try{if((A=i.constructor)&&A.getDerivedStateFromError!=null&&(i.setState(A.getDerivedStateFromError(s)),l=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(s,n||{}),l=i.__d),l)return i.__E=i}catch(h){s=h}throw s}},Lg=0,PA.prototype.setState=function(s,e){var t;t=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=Un({},this.state),typeof s=="function"&&(s=s(Un({},t),this.props)),s&&Un(t,s),s!=null&&this.__v&&(e&&this._sb.push(e),Cf(this))},PA.prototype.forceUpdate=function(s){this.__v&&(this.__e=!0,s&&this.__h.push(s),Cf(this))},PA.prototype.render=Tr,ns=[],Rg=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Og=function(s,e){return s.__v.__b-e.__v.__b},nr.__r=0,Gg=/(PointerCapture)$|Capture$/i,lc=0,ha=yf(!1),da=yf(!0);var cL=0;function wt(s,e,t,n,i,A){e||(e={});var l,h,g=e;if("ref"in g)for(h in g={},e)h=="ref"?l=e[h]:g[h]=e[h];var B={type:s,props:g,key:t,ref:l,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--cL,__i:-1,__u:0,__source:i,__self:A};if(typeof s=="function"&&(l=s.defaultProps))for(h in l)g[h]===void 0&&(g[h]=l[h]);return st.vnode&&st.vnode(B),B}const lL=s=>{const{className:e,label:t,onClick:n}=s;return wt("div",{className:"deck-widget-button",children:wt("button",{className:`deck-widget-icon-button ${e}`,type:"button",onClick:n,title:t,children:wt("div",{className:"deck-widget-icon"})})})},uL=s=>{const{children:e,orientation:t}=s;return wt("div",{className:`deck-widget-button-group ${t}`,children:e})},bf=s=>{const{className:e,label:t,onClick:n}=s;return wt("button",{className:`deck-widget-icon-button ${e}`,type:"button",onClick:n,title:t,children:wt("div",{className:"deck-widget-icon"})})};class vL{constructor(e){this.id="fullscreen",this.placement="top-left",this.fullscreen=!1,this.id=e.id??this.id,this.placement=e.placement??this.placement,this.props={...e,enterLabel:e.enterLabel??"Enter Fullscreen",exitLabel:e.exitLabel??"Exit Fullscreen",style:e.style??{}}}onAdd({deck:e}){const{style:t,className:n}=this.props,i=document.createElement("div");return i.classList.add("deck-widget","deck-widget-fullscreen"),n&&i.classList.add(n),Ks(i,t),this.deck=e,this.element=i,this.update(),document.addEventListener("fullscreenchange",this.onFullscreenChange.bind(this)),i}onRemove(){this.deck=void 0,this.element=void 0,document.removeEventListener("fullscreenchange",this.onFullscreenChange.bind(this))}update(){const{enterLabel:e,exitLabel:t}=this.props,n=this.element;if(!n)return;const i=wt(lL,{onClick:this.handleClick.bind(this),label:this.fullscreen?t:e,className:this.fullscreen?"deck-widget-fullscreen-exit":"deck-widget-fullscreen-enter"});gc(i,n)}setProps(e){this.placement=e.placement??this.placement;const t=this.props,n=this.element;n&&(t.className!==e.className&&(t.className&&n.classList.remove(t.className),e.className&&n.classList.add(e.className)),wn(t.style,e.style,1)||(Ma(n,t.style),Ks(n,e.style))),Object.assign(this.props,e),this.update()}getContainer(){var e,t;return this.props.container||((t=(e=this.deck)==null?void 0:e.getCanvas())==null?void 0:t.parentElement)}onFullscreenChange(){const e=this.fullscreen,t=document.fullscreenElement===this.getContainer();e!==t&&(this.fullscreen=!this.fullscreen),this.update()}async handleClick(){this.fullscreen?await this.exitFullscreen():await this.requestFullscreen(),this.update()}async requestFullscreen(){const e=this.getContainer();e!=null&&e.requestFullscreen?await e.requestFullscreen({navigationUI:"hide"}):this.togglePseudoFullscreen()}async exitFullscreen(){document.exitFullscreen?await document.exitFullscreen():this.togglePseudoFullscreen()}togglePseudoFullscreen(){var e;(e=this.getContainer())==null||e.classList.toggle("deck-pseudo-fullscreen")}}class IL{constructor(e){this.id="compass",this.placement="top-left",this.viewId=null,this.viewports={},this.id=e.id??this.id,this.viewId=e.viewId??this.viewId,this.placement=e.placement??this.placement,this.props={...e,transitionDuration:e.transitionDuration??200,label:e.label??"Reset Compass",style:e.style??{}}}setProps(e){this.placement=e.placement??this.placement,this.viewId=e.viewId??this.viewId;const t=this.props,n=this.element;n&&(t.className!==e.className&&(t.className&&n.classList.remove(t.className),e.className&&n.classList.add(e.className)),wn(t.style,e.style,1)||(Ma(n,t.style),Ks(n,e.style))),Object.assign(this.props,e),this.update()}onViewportChange(e){e.equals(this.viewports[e.id])||(this.viewports[e.id]=e,this.update())}onAdd({deck:e}){const{style:t,className:n}=this.props,i=document.createElement("div");return i.classList.add("deck-widget","deck-widget-compass"),n&&i.classList.add(n),Ks(i,t),this.deck=e,this.element=i,this.update(),i}getRotation(e){return e instanceof Ei?[-e.bearing,e.pitch]:e instanceof Ta?[0,Math.max(-80,Math.min(80,e.latitude))]:[0,0]}update(){var h;const e=this.viewId||((h=Object.values(this.viewports)[0])==null?void 0:h.id)||"default-view",t=this.viewports[e],[n,i]=this.getRotation(t),A=this.element;if(!A)return;const l=wt("div",{className:"deck-widget-button",style:{perspective:100},children:wt("button",{type:"button",onClick:()=>{for(const g of Object.values(this.viewports))this.handleCompassReset(g)},title:this.props.label,style:{transform:`rotateX(${i}deg)`},children:wt("svg",{fill:"none",width:"100%",height:"100%",viewBox:"0 0 26 26",children:wt("g",{transform:`rotate(${n},13,13)`,children:[wt("path",{d:"M10 13.0001L12.9999 5L15.9997 13.0001H10Z",fill:"var(--icon-compass-north-color, #F05C44)"}),wt("path",{d:"M16.0002 12.9999L13.0004 21L10.0005 12.9999H16.0002Z",fill:"var(--icon-compass-south-color, #C2C2CC)"})]})})})});gc(l,A)}onRemove(){this.deck=void 0,this.element=void 0}handleCompassReset(e){const t=this.viewId||e.id||"default-view";if(e instanceof Ei){const n={...e,bearing:0,...this.getRotation(e)[0]===0?{pitch:0}:{},transitionDuration:this.props.transitionDuration,transitionInterpolator:new fh};this.deck._onViewStateChange({viewId:t,viewState:n,interactionState:{}})}}}class pc{constructor(e={}){this.id="zoom",this.placement="top-left",this.viewId=null,this.viewports={},this.id=e.id??this.id,this.viewId=e.viewId??this.viewId,this.placement=e.placement??this.placement,this.props={...pc.defaultProps,...e}}onAdd({deck:e}){const{style:t,className:n}=this.props,i=document.createElement("div");return i.classList.add("deck-widget","deck-widget-zoom"),n&&i.classList.add(n),Ks(i,t),this.deck=e,this.element=i,this.update(),i}onRemove(){this.deck=void 0,this.element=void 0}setProps(e){this.placement=e.placement??this.placement,this.viewId=e.viewId??this.viewId;const t=this.props,n=this.element;n&&(t.className!==e.className&&(t.className&&n.classList.remove(t.className),e.className&&n.classList.add(e.className)),wn(t.style,e.style,1)||(Ma(n,t.style),Ks(n,e.style))),Object.assign(this.props,e),this.update()}onViewportChange(e){this.viewports[e.id]=e}handleZoom(e,t){const n=this.viewId||(e==null?void 0:e.id)||"default-view",i={...e,zoom:t};this.props.transitionDuration>0&&(i.transitionDuration=this.props.transitionDuration,i.transitionInterpolator="latitude"in i?new fh:new Di),this.setViewState(n,i)}handleZoomIn(){for(const e of Object.values(this.viewports))this.handleZoom(e,e.zoom+1)}handleZoomOut(){for(const e of Object.values(this.viewports))this.handleZoom(e,e.zoom-1)}setViewState(e,t){this.deck._onViewStateChange({viewId:e,viewState:t,interactionState:{}})}update(){const e=this.element;if(!e)return;const t=wt(uL,{orientation:this.props.orientation,children:[wt(bf,{onClick:()=>this.handleZoomIn(),label:this.props.zoomInLabel,className:"deck-widget-zoom-in"}),wt(bf,{onClick:()=>this.handleZoomOut(),label:this.props.zoomOutLabel,className:"deck-widget-zoom-out"})]});gc(t,e)}}pc.defaultProps={id:"zoom-widget",style:{},placement:"top-left",className:void 0,orientation:"vertical",transitionDuration:200,zoomInLabel:"Zoom In",zoomOutLabel:"Zoom Out",viewId:void 0};export{SL as AmbientLight,wa as ArcLayer,xL as Attribute,Ba as AttributeManager,hh as BitmapLayer,pt as COORDINATE_SYSTEM,Li as CPUAggregator,ni as ColumnLayer,IL as CompassWidget,xn as CompositeLayer,Fh as ContourLayer,sr as Controller,DL as Deck,PL as DeckGL,FL as DeckRenderer,LL as DirectionalLight,$B as FirstPersonController,ZB as FirstPersonView,YB as FirstPersonViewport,fh as FlyToInterpolator,vL as FullscreenWidget,Fi as GeoJsonLayer,Fg as GeohashLayer,Uh as GreatCircleLayer,Bh as GridCellLayer,Rh as GridLayer,id as H3ClusterLayer,ii as H3HexagonLayer,Nh as HeatmapLayer,Ph as HexagonLayer,rr as IconLayer,sn as Layer,Ia as LayerExtension,RL as LayerManager,OL as LightingEffect,gh as LineLayer,Di as LinearInterpolator,Dg as MVTLayer,NL as MapController,UL as MapView,HL as OPERATION,qB as OrbitController,eC as OrbitView,QB as OrbitViewport,nC as OrthographicController,sC as OrthographicView,XB as OrthographicViewport,ma as PathLayer,Sa as PointCloudLayer,pL as PointLight,Ar as PolygonLayer,mL as PostProcessEffect,kh as QuadkeyLayer,Hh as S2Layer,xa as ScatterplotLayer,Wa as ScenegraphLayer,Sh as ScreenGridLayer,Ii as SimpleMeshLayer,Uf as SolidPolygonLayer,kL as TRANSITION_EVENTS,Eg as TerrainLayer,JL as Tesselator,Fa as TextLayer,yg as Tile3DLayer,Ni as TileLayer,n1 as TransitionInterpolator,Kh as TripsLayer,_n as UNIT,VL as VERSION,ir as View,as as Viewport,cn as WebGLAggregator,Ei as WebMercatorViewport,pc as ZoomWidget,AC as _GlobeController,rC as _GlobeView,Ta as _GlobeViewport,CE as _Tileset2D,zL as assert,cs as createIterable,jL as default,QL as fp64LowPart,KL as getShaderAssembler,dL as gouraudLighting,at as log,gL as phongLighting,fn as picking,WL as project,St as project32,XL as shadow};
